let e,i;var r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k,L,D,z,F,B,N,j,V,U,G,q,$,H,Z,W,X,Y,K,J,Q,ee,et,ei,er,en,eo,ea,es,el,eh,eu,ec,ed,ep,ef,em,eg,e_,ey,ev,ex,eb,ew,eT,eS,eE,eI,eC,eA,eR,eM,eP,eO,ek,eL,eD,ez,eF,eB,eN,ej,eV,eU,eG,eq,e$,eH,eZ,eW,eX,eY,eK,eJ,eQ=globalThis;function e0(e,i,r,n){Object.defineProperty(e,i,{get:r,set:n,enumerable:!0,configurable:!0})}function e1(e){return e&&e.__esModule?e.default:e}var e2={},e3={},e5=eQ.parcelRequire271a;null==e5&&((e5=function(e){if(e in e2)return e2[e].exports;if(e in e3){var i=e3[e];delete e3[e];var r={id:e,exports:{}};return e2[e]=r,i.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,i){e3[e]=i},eQ.parcelRequire271a=e5);var e4=e5.register;e4("484LI",function(e,i){e0(e.exports,"latest",()=>s),e0(e.exports,"Color",()=>ee),e0(e.exports,"featureFilter",()=>tQ),e0(e.exports,"derefLayers",()=>t9),e0(e.exports,"expression",()=>ip),e0(e.exports,"function",()=>im),e5("awmEs").Buffer;var r,n,o,a,s={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90Â° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features. Note: fog is renamed to atmosphere in the Android and iOS SDKs and planned to be changed in GL-JS v.3.0.0."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Mercator, Globe, Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Natural Earth, and Winkel Tripel. Terrain, sky and fog are supported by only Mercator and globe. CustomLayerInterface is not supported outside of Mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers. If specified as an object only specified source layers will have id overriden, others will fallback to original feature id"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) â it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,doc:"Radius of a fill extrusion edge in meters. If not zero, rounds extrusion edges for a smoother appearance.","sdk-support":{"basic functionality":{js:"v2.10.0",android:"10.7.0",ios:"10.7.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0",android:"10.0.0",ios:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesnât support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] â  value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] â¥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] â¤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] â {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] â {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 â§ ... â§ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 â¨ ... â¨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `Â¬f0 â§ ... â§ Â¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `unit` argument specifies a [simple ECMAScript unit](https://tc39.es/proposal-unified-intl-numberformat/section6/locales-currencies-tz_proposed_out.html#sec-issanctionedsimpleunitidentifier) to use for unit-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0",android:"10.0.0",ios:"10.0.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `LineString` or `Polygon`. `Multi*` feature types return the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0",ios:"4.1.0",macos:"0.8.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region immediately below the horizon and within the `range` and above the horizon and within `horizon-blend`. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region above the horizon, `high-color` extends further above the horizon than the `color` property and its spread can be controlled with `horizon-blend`. The opacity can be set to `0` to remove the high atmosphere color contribution.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the region above the horizon and after the end of the `horizon-blend` contribution. The opacity can be set to `0` to have a transparent background.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the atmosphere to the color of space. A value of zero leaves a sharp transition from atmosphere to space. Increasing the value blends the color of atmosphere into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"A value controlling the star intensity where `0` will show no stars and `1` will show stars at their maximum intensity.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0Â° (0Â° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0Â° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0Â°, directly above, to 180Â°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate CarrÃ©e projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.",requires:["source"],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Controls the intensity of shading near ground and concave angles between walls. Default value 0.0 disables ambient occlusion and values around 0.3 provide the most plausible results for buildings.","sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Shades area near ground and concave angles between walls where the radius defines only vertical impact. Default value 3.0 corresponds to height of one floor and brings the most plausible results for buildings.",requires:["fill-extrusion-edge-radius"],"sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",doc:"The line part between [trim-start, trim-end] will be marked as transparent to make a route vanishing effect. The line trim-off offset is based on the whole line range [0.0, 1.0].",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"2.9.0",android:"10.5.0",ios:"10.5.0",macos:"10.5.0"}},"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0Â° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0Â° is directly above, at zenith, and 90Â° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0Â° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0Â° is directly above, at zenith, and 90Â° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==eQ?eQ:"undefined"!=typeof self?self:{},h={},u={exports:{}};n=u.exports,function(e){var i=n&&!n.nodeType&&n,r=u&&!u.nodeType&&u,o="object"==typeof l&&l;(o.global===o||o.window===o||o.self===o)&&(e=o);var a,s,h=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(p[e])}function _(e,i){for(var r=e.length,n=[];r--;)n[r]=i(e[r]);return n}function y(e,i){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+_((e=e.replace(d,".")).split("."),i).join(".")}function v(e){for(var i,r,n=[],o=0,a=e.length;o<a;)(i=e.charCodeAt(o++))>=55296&&i<=56319&&o<a?(64512&(r=e.charCodeAt(o++)))==56320?n.push(((1023&i)<<10)+(1023&r)+65536):(n.push(i),o--):n.push(i);return n}function x(e){return _(e,function(e){var i="";return e>65535&&(e-=65536,i+=m(e>>>10&1023|55296),e=56320|1023&e),i+=m(e)}).join("")}function b(e,i){return e+22+75*(e<26)-((0!=i)<<5)}function w(e,i,r){var n=0;for(e=r?f(e/700):e>>1,e+=f(e/i);e>455;n+=36)e=f(e/35);return f(n+36*e/(e+38))}function T(e){var i,r,n,o,a,s,l,h,u,c,d,p=[],m=e.length,_=0,y=128,v=72;for((n=e.lastIndexOf("-"))<0&&(n=0),o=0;o<n;++o)e.charCodeAt(o)>=128&&g("not-basic"),p.push(e.charCodeAt(o));for(a=n>0?n+1:0;a<m;){for(s=_,l=1,h=36;a>=m&&g("invalid-input"),((u=(i=e.charCodeAt(a++))-48<10?i-22:i-65<26?i-65:i-97<26?i-97:36)>=36||u>f((0x7fffffff-_)/l))&&g("overflow"),_+=u*l,!(u<(c=h<=v?1:h>=v+26?26:h-v));h+=36){;l>f(0x7fffffff/(d=36-c))&&g("overflow"),l*=d}v=w(_-s,r=p.length+1,0==s),f(_/r)>0x7fffffff-y&&g("overflow"),y+=f(_/r),_%=r,p.splice(_++,0,y)}return x(p)}function S(e){var i,r,n,o,a,s,l,h,u,c,d,p,_,y,x,T=[];for(s=0,p=(e=v(e)).length,i=128,r=0,a=72;s<p;++s)(d=e[s])<128&&T.push(m(d));for(n=o=T.length,o&&T.push("-");n<p;){for(l=0x7fffffff,s=0;s<p;++s)(d=e[s])>=i&&d<l&&(l=d);for(l-i>f((0x7fffffff-r)/(_=n+1))&&g("overflow"),r+=(l-i)*_,i=l,s=0;s<p;++s)if((d=e[s])<i&&++r>0x7fffffff&&g("overflow"),d==i){for(h=r,u=36;!(h<(c=u<=a?1:u>=a+26?26:u-a));u+=36)x=h-c,y=36-c,T.push(m(b(c+x%y,0))),h=f(x/y);T.push(m(b(h,0))),a=w(r,_,n==o),r=0,++n}++r,++i}return T.join("")}if(a={version:"1.3.2",ucs2:{decode:v,encode:x},decode:T,encode:S,toASCII:function(e){return y(e,function(e){return c.test(e)?"xn--"+S(e):e})},toUnicode:function(e){return y(e,function(e){return h.test(e)?T(e.slice(4).toLowerCase()):e})}},i&&r)if(u.exports==i)r.exports=a;else for(s in a)a.hasOwnProperty(s)&&(i[s]=a[s]);else e.punycode=a}(l);var c={},d=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};c.decode=c.parse=function(e,i,r,n){i=i||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(i);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var l=e.length;s>0&&l>s&&(l=s);for(var h=0;h<l;++h){var u,c,d,p,f=e[h].replace(a,"%20"),m=f.indexOf(r);(m>=0?(u=f.substr(0,m),c=f.substr(m+1)):(u=f,c=""),d=decodeURIComponent(u),p=decodeURIComponent(c),Object.prototype.hasOwnProperty.call(o,d))?Array.isArray(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o},c.encode=c.stringify=function(e,i,r,n){return(i=i||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e)?Object.keys(e).map(function(n){var o=encodeURIComponent(d(n))+r;return Array.isArray(e[n])?e[n].map(function(e){return o+encodeURIComponent(d(e))}).join(i):o+encodeURIComponent(d(e[n]))}).join(i):n?encodeURIComponent(d(n))+r+encodeURIComponent(d(e)):""};var p=u.exports,f={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}};function m(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}h.parse=C,h.resolve=function(e,i){return C(e,!1,!0).resolve(i)},h.resolveObject=function(e,i){return e?C(e,!1,!0).resolveObject(i):i},h.format=function(e){return(f.isString(e)&&(e=C(e)),e instanceof m)?e.format():m.prototype.format.call(e)},h.Url=m;var g=/^([a-z0-9.+-]+:)/i,_=/:[0-9]*$/,y=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,v=["'"].concat(["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","	"])),x=["%","/","?",";","#"].concat(v),b=["/","?","#"],w=/^[+a-z0-9A-Z_-]{0,63}$/,T=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,S={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},I={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function C(e,i,r){if(e&&f.isObject(e)&&e instanceof m)return e;var n=new m;return n.parse(e,i,r),n}function A(e,...i){for(let r of i)for(let i in r)e[i]=r[i];return e}m.prototype.parse=function(e,i,r){if(!f.isString(e))throw TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",a=e.split(o);a[0]=a[0].replace(/\\/g,"/");var s=e=a.join(o);if(s=s.trim(),!r&&1===e.split("#").length){var l=y.exec(s);if(l)return this.path=s,this.href=s,this.pathname=l[1],l[2]?(this.search=l[2],i?this.query=c.parse(this.search.substr(1)):this.query=this.search.substr(1)):i&&(this.search="",this.query={}),this}var h=g.exec(s);if(h){var u=(h=h[0]).toLowerCase();this.protocol=u,s=s.substr(h.length)}if(r||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var d="//"===s.substr(0,2);d&&!(h&&E[h])&&(s=s.substr(2),this.slashes=!0)}if(!E[h]&&(d||h&&!I[h])){for(var m,_,C=-1,A=0;A<b.length;A++){var R=s.indexOf(b[A]);-1!==R&&(-1===C||R<C)&&(C=R)}-1!==(_=-1===C?s.lastIndexOf("@"):s.lastIndexOf("@",C))&&(m=s.slice(0,_),s=s.slice(_+1),this.auth=decodeURIComponent(m)),C=-1;for(var A=0;A<x.length;A++){var R=s.indexOf(x[A]);-1!==R&&(-1===C||R<C)&&(C=R)}-1===C&&(C=s.length),this.host=s.slice(0,C),s=s.slice(C),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var P=this.hostname.split(/\./),A=0,O=P.length;A<O;A++){var k=P[A];if(k&&!k.match(w)){for(var L="",D=0,z=k.length;D<z;D++)k.charCodeAt(D)>127?L+="x":L+=k[D];if(!L.match(w)){var F=P.slice(0,A),B=P.slice(A+1),N=k.match(T);N&&(F.push(N[1]),B.unshift(N[2])),B.length&&(s="/"+B.join(".")+s),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=p.toASCII(this.hostname));var j=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+j,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!S[u])for(var A=0,O=v.length;A<O;A++){var U=v[A];if(-1!==s.indexOf(U)){var G=encodeURIComponent(U);G===U&&(G=escape(U)),s=s.split(U).join(G)}}var q=s.indexOf("#");-1!==q&&(this.hash=s.substr(q),s=s.slice(0,q));var $=s.indexOf("?");if(-1!==$?(this.search=s.substr($),this.query=s.substr($+1),i&&(this.query=c.parse(this.query)),s=s.slice(0,$)):i&&(this.search="",this.query={}),s&&(this.pathname=s),I[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",H=this.search||"";this.path=j+H}return this.href=this.format(),this},m.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":")+"@");var i=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&f.isObject(this.query)&&Object.keys(this.query).length&&(a=c.stringify(this.query));var s=this.search||a&&"?"+a||"";return i&&":"!==i.substr(-1)&&(i+=":"),this.slashes||(!i||I[i])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),i+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+n},m.prototype.resolve=function(e){return this.resolveObject(C(e,!1,!0)).format()},m.prototype.resolveObject=function(e){if(f.isString(e)){var i=new m;i.parse(e,!1,!0),e=i}for(var r=new m,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var h=s[l];"protocol"!==h&&(r[h]=e[h])}return I[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!I[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var d=u[c];r[d]=e[d]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||E[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",_=r.search||"";r.path=g+_}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var y=r.pathname&&"/"===r.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=v||y||r.host&&e.pathname,b=x,w=r.pathname&&r.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],T=r.protocol&&!I[r.protocol];if(T&&(r.hostname="",r.port=null,r.host&&(""===w[0]?w[0]=r.host:w.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),x=x&&(""===p[0]||""===w[0])),v)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),r.search=e.search,r.query=e.query;else if(!f.isNullOrUndefined(e.search)){if(T){r.hostname=r.host=w.shift();var S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");S&&(r.auth=S.shift(),r.host=r.hostname=S.shift())}return r.search=e.search,r.query=e.query,f.isNull(r.pathname)&&f.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!w.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var C=w.slice(-1)[0],A=(r.host||e.host||w.length>1)&&("."===C||".."===C)||""===C,R=0,M=w.length;M>=0;M--)"."===(C=w[M])?w.splice(M,1):".."===C?(w.splice(M,1),R++):R&&(w.splice(M,1),R--);if(!x&&!b)for(;R--;)w.unshift("..");x&&""!==w[0]&&(!w[0]||"/"!==w[0].charAt(0))&&w.unshift(""),A&&"/"!==w.join("/").substr(-1)&&w.push("");var P=""===w[0]||w[0]&&"/"===w[0].charAt(0);if(T){r.hostname=r.host=P?"":w.length?w.shift():"";var S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");S&&(r.auth=S.shift(),r.host=r.hostname=S.shift())}return(x=x||r.host&&w.length)&&!P&&w.unshift(""),w.length?r.pathname=w.join("/"):(r.pathname=null,r.path=null),f.isNull(r.pathname)&&f.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},m.prototype.parseHost=function(){var e=this.host,i=_.exec(e);i&&(":"!==(i=i[0])&&(this.port=i.substr(1)),e=e.substr(0,e.length-i.length)),e&&(this.hostname=e)};var R=class extends Error{constructor(e,i){super(i),this.message=i,this.key=e}};class M{constructor(e,i=[]){for(let[r,n]of(this.parent=e,this.bindings={},i))this.bindings[r]=n}concat(e){return new M(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let P={kind:"null"},O={kind:"number"},k={kind:"string"},L={kind:"boolean"},D={kind:"color"},z={kind:"object"},F={kind:"value"},B={kind:"collator"},N={kind:"formatted"},j={kind:"resolvedImage"};function V(e,i){return{kind:"array",itemType:e,N:i}}function U(e){if("array"!==e.kind)return e.kind;{let i=U(e.itemType);return"number"==typeof e.N?`array<${i}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${i}>`}}let G=[P,O,k,L,D,N,z,V(F),j];function q(e,i){if("error"===i.kind)return null;if("array"===e.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!q(e.itemType,i.itemType))&&("number"!=typeof e.N||e.N===i.N))return null}else if(e.kind===i.kind)return null;else if("value"===e.kind){for(let e of G)if(!q(e,i))return null}return`Expected ${U(e)} but found ${U(i)} instead.`}function $(e,i){return i.some(i=>i.kind===e.kind)}function H(e,i){return i.some(i=>"null"===i?null===e:"array"===i?Array.isArray(e):"object"===i?e&&!Array.isArray(e)&&"object"==typeof e:i===typeof e)}var Z={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function W(e){return(e=Math.round(e))<0?0:e>255?255:e}function X(e){return e<0?0:e>1?1:e}function Y(e){return"%"===e[e.length-1]?W(parseFloat(e)/100*255):W(parseInt(e))}function K(e){return"%"===e[e.length-1]?X(parseFloat(e)/100):X(parseFloat(e))}function J(e,i,r){return(r<0?r+=1:r>1&&(r-=1),6*r<1)?e+(i-e)*r*6:2*r<1?i:3*r<2?e+(i-e)*(2/3-r)*6:e}try{r=({}).parseCSSColor=function(e){var i=e.replace(/ /g,"").toLowerCase();if(i in Z)return Z[i].slice();if("#"===i[0]){if(4===i.length){var r=parseInt(i.substr(1),16);return r>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null}if(7===i.length){var r=parseInt(i.substr(1),16);return r>=0&&r<=0xffffff?[(0xff0000&r)>>16,(65280&r)>>8,255&r,1]:null}return null}var n=i.indexOf("("),o=i.indexOf(")");if(-1!==n&&o+1===i.length){var a=i.substr(0,n),s=i.substr(n+1,o-(n+1)).split(","),l=1;switch(a){case"rgba":if(4!==s.length)break;l=K(s.pop());case"rgb":if(3!==s.length)break;return[Y(s[0]),Y(s[1]),Y(s[2]),l];case"hsla":if(4!==s.length)break;l=K(s.pop());case"hsl":if(3!==s.length)break;var h=(parseFloat(s[0])%360+360)%360/360,u=K(s[1]),c=K(s[2]),d=c<=.5?c*(u+1):c+u-c*u,p=2*c-d;return[W(255*J(p,d,h+1/3)),W(255*J(p,d,h)),W(255*J(p,d,h-1/3)),l]}}return null}}catch(e){}class Q{constructor(e,i,r,n=1){this.r=e,this.g=i,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof Q)return e;if("string"!=typeof e)return;let i=r(e);if(i)return new Q(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3])}toString(){let[e,i,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${n})`}toArray(){let{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*i/n,255*r/n,n]}toArray01(){let{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,i/n,r/n,n]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:r,a:n}=this;return[e,i,r,n]}}Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0),Q.red=new Q(1,0,0,1),Q.blue=new Q(0,0,1,1);var ee=Q;class et{constructor(e,i,r){e?this.sensitivity=i?"variant":"case":this.sensitivity=i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ei{constructor(e,i,r,n,o){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=n,this.textColor=o}}class er{constructor(e){this.sections=e}static fromString(e){return new er([new ei(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof er?e:er.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);let r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class en{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new en({name:e,available:!1}):null}serialize(){return["image",this.name]}}function eo(e,i,r,n){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof r&&r>=0&&r<=255)){let o="number"==typeof n?[e,i,r,n]:[e,i,r];return`Invalid rgba value [${o.join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,i,r,n].join(", ")}]: 'a' must be between 0 and 1.`}function ea(e){if(null===e||"string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ee)return!0;else if(e instanceof et)return!0;else if(e instanceof er)return!0;else if(e instanceof en)return!0;else if(Array.isArray(e)){for(let i of e)if(!ea(i))return!1;return!0}else{if("object"!=typeof e)return!1;for(let i in e)if(!ea(e[i]))return!1;return!0}}function es(e){if(null===e)return P;if("string"==typeof e)return k;if("boolean"==typeof e)return L;{let i;if("number"==typeof e)return O;if(e instanceof ee)return D;if(e instanceof et)return B;if(e instanceof er)return N;if(e instanceof en)return j;if(!Array.isArray(e))return z;let r=e.length;for(let r of e){let e=es(r);if(i){if(i===e)continue;i=F;break}i=e}return V(i||F,r)}}function el(e){let i=typeof e;return null===e?"":"string"===i||"number"===i||"boolean"===i?String(e):e instanceof ee||e instanceof er||e instanceof en?e.toString():JSON.stringify(e)}class eh{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ea(e[1]))return i.error("invalid value");let r=e[1],n=es(r),o=i.expectedType;return"array"===n.kind&&0===n.N&&o&&"array"===o.kind&&("number"!=typeof o.N||0===o.N)&&(n=o),new eh(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ee?["rgba"].concat(this.value.toArray()):this.value instanceof er?this.value.serialize():this.value}}var eu=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};let ec={string:k,number:O,boolean:L,object:z};class ed{constructor(e,i){this.type=e,this.args=i}static parse(e,i){let r;if(e.length<2)return i.error("Expected at least one argument.");let n=1,o=e[0];if("array"===o){let o,a;if(e.length>2){let r=e[1];if("string"!=typeof r||!(r in ec)||"object"===r)return i.error('The item type argument of "array" must be one of string, number, boolean',1);o=ec[r],n++}else o=F;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);a=e[2],n++}r=V(o,a)}else r=ec[o];let a=[];for(;n<e.length;n++){let r=i.parse(e[n],n,F);if(!r)return null;a.push(r)}return new ed(r,a)}evaluate(e){for(let i=0;i<this.args.length;i++){let r=this.args[i].evaluate(e);if(!q(this.type,es(r)))return r;if(i===this.args.length-1)throw new eu(`Expected value to be of type ${U(this.type)}, but found ${U(es(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if("array"===e.kind){let r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);let n=e.N;("number"==typeof n||this.args.length>1)&&i.push(n)}}return i.concat(this.args.map(e=>e.serialize()))}}class ep{constructor(e){this.type=N,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");let n=[],o=!1;for(let r=1;r<=e.length-1;++r){let a=e[r];if(o&&"object"==typeof a&&!Array.isArray(a)){o=!1;let e=null;if(a["font-scale"]&&!(e=i.parse(a["font-scale"],1,O)))return null;let r=null;if(a["text-font"]&&!(r=i.parse(a["text-font"],1,V(k))))return null;let s=null;if(a["text-color"]&&!(s=i.parse(a["text-color"],1,D)))return null;let l=n[n.length-1];l.scale=e,l.font=r,l.textColor=s}else{let a=i.parse(e[r],1,F);if(!a)return null;let s=a.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,n.push({content:a,scale:null,font:null,textColor:null})}}return new ep(n)}evaluate(e){return new er(this.sections.map(i=>{let r=i.content.evaluate(e);return es(r)===j?new ei("",r,null,null,null):new ei(el(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class ef{constructor(e){this.type=j,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");let r=i.parse(e[1],1,k);return r?new ef(r):i.error("No image name provided.")}evaluate(e){let i=this.input.evaluate(e),r=en.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let em={"to-boolean":L,"to-color":D,"to-number":O,"to-string":k};class eg{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");let n=em[r],o=[];for(let r=1;r<e.length;r++){let n=i.parse(e[r],r,F);if(!n)return null;o.push(n)}return new eg(n,o)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,r;for(let n of this.args){if(i=n.evaluate(e),r=null,i instanceof ee)return i;if("string"==typeof i){let r=e.parseColor(i);if(r)return r}else if(Array.isArray(i)&&!(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:eo(i[0],i[1],i[2],i[3])))return new ee(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new eu(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(let r of this.args){if(null===(i=r.evaluate(e)))return 0;let n=Number(i);if(!isNaN(n))return n}throw new eu(`Could not convert ${JSON.stringify(i)} to number.`)}if("formatted"===this.type.kind)return er.fromString(el(this.args[0].evaluate(e)));if("resolvedImage"===this.type.kind)return en.fromString(el(this.args[0].evaluate(e)));else return el(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ep([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ef(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}let e_=["Unknown","Point","LineString","Polygon"];var ey=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?e_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord,o=r*i-e[0],a=n*i-e[1],s=this.featureDistanceData.bearing[0];return s*o+this.featureDistanceData.bearing[1]*a}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=ee.parse(e)),i}};class ev{constructor(e,i,r,n){this.name=e,this.type=i,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let r=e[0],n=ev.definitions[r];if(!n)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);let o=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=a.filter(([i])=>!Array.isArray(i)||i.length===e.length-1),l=null;for(let[n,a]of s){l=new eF(i.registry,i.path,null,i.scope);let s=[],h=!1;for(let i=1;i<e.length;i++){let r=e[i],o=Array.isArray(n)?n[i-1]:n.type,a=l.parse(r,1+s.length,o);if(!a){h=!0;break}s.push(a)}if(!h){if(Array.isArray(n)&&n.length!==s.length){l.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);continue}for(let e=0;e<s.length;e++){let i=Array.isArray(n)?n[e]:n.type,r=s[e];l.concat(e+1).checkSubtype(i,r.type)}if(0===l.errors.length)return new ev(r,o,a,s)}}if(1===s.length)i.errors.push(...l.errors);else{let r=(s.length?s:a).map(([e])=>{var i;return Array.isArray(i=e)?`(${i.map(U).join(", ")})`:`(${U(i.type)}...)`}).join(" | "),n=[];for(let r=1;r<e.length;r++){let o=i.parse(e[r],1+n.length);if(!o)return null;n.push(U(o.type))}i.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,i){for(let r in ev.definitions=i,i)e[r]=ev}}class ex{constructor(e,i,r){this.type=B,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");let r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");let n=i.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,L);if(!n)return null;let o=i.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,L);if(!o)return null;let a=null;return!r.locale||(a=i.parse(r.locale,1,k))?new ex(n,o,a):null}evaluate(e){return new et(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function eb(e,i){e[0]=Math.min(e[0],i[0]),e[1]=Math.min(e[1],i[1]),e[2]=Math.max(e[2],i[0]),e[3]=Math.max(e[3],i[1])}function ew(e,i){return!(e[0]<=i[0])&&!(e[2]>=i[2])&&!(e[1]<=i[1])&&!(e[3]>=i[3])}function eT(e,i){let r=!1;for(let a=0,s=i.length;a<s;a++){let s=i[a];for(let i=0,a=s.length;i<a-1;i++){var n,o;if(function(e,i,r){let n=e[0]-i[0],o=e[1]-i[1],a=e[0]-r[0],s=e[1]-r[1];return n*s-a*o==0&&n*a<=0&&o*s<=0}(e,s[i],s[i+1]))return!1;n=s[i],o=s[i+1],n[1]>e[1]!=o[1]>e[1]&&e[0]<(o[0]-n[0])*(e[1]-n[1])/(o[1]-n[1])+n[0]&&(r=!r)}}return r}function eS(e,i,r,n){let o=e[0]-r[0],a=e[1]-r[1],s=i[0]-r[0],l=i[1]-r[1],h=n[0]-r[0],u=n[1]-r[1],c=o*u-h*a,d=s*u-h*l;return!!(c>0)&&!!(d<0)||!!(c<0)&&!!(d>0)}function eE(e,i){for(let r=0;r<e.length;++r)if(!eT(e[r],i))return!1;for(let r=0;r<e.length-1;++r)if(function(e,i,r){for(let n of r)for(let r=0;r<n.length-1;++r)if(function(e,i,r,n){var o;let a=[i[0]-e[0],i[1]-e[1]];return 0!=(o=[n[0]-r[0],n[1]-r[1]],o[0]*a[1]-o[1]*a[0])&&!!(eS(e,i,r,n)&&eS(r,n,e,i))}(e,i,n[r],n[r+1]))return!0;return!1}(e[r],e[r+1],i))return!1;return!0}function eI(e,i,r){let n=[];for(let o=0;o<e.length;o++){let a=[];for(let n=0;n<e[o].length;n++){let s=function(e,i){let r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,o=Math.pow(2,i.z);return[Math.round(r*o*8192),Math.round(n*o*8192)]}(e[o][n],r);eb(i,s),a.push(s)}n.push(a)}return n}function eC(e,i,r){let n=[];for(let o=0;o<e.length;o++){let a=eI(e[o],i,r);n.push(a)}return n}function eA(e,i,r,n){if(e[0]<r[0]||e[0]>r[2]){let i=.5*n,o=e[0]-r[0]>i?-n:r[0]-e[0]>i?n:0;0===o&&(o=e[0]-r[2]>i?-n:r[2]-e[0]>i?n:0),e[0]+=o}eb(i,e)}function eR(e,i,r,n){let o=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(let n of e)for(let e of n){let n=[e.x+a[0],e.y+a[1]];eA(n,i,r,o),s.push(n)}return s}function eM(e,i,r,n){let o=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(let r of e){let e=[];for(let n of r){let r=[n.x+a[0],n.y+a[1]];eb(i,r),e.push(r)}s.push(e)}if(i[2]-i[0]<=o/2){for(let e of(i[0]=i[1]=1/0,i[2]=i[3]=-1/0,s))for(let n of e)eA(n,i,r,o)}return s}class eP{constructor(e,i){this.type=L,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ea(e[1])){let i=e[1];if("FeatureCollection"===i.type)for(let e=0;e<i.features.length;++e){let r=i.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new eP(i,i.features[e].geometry)}else if("Feature"===i.type){let e=i.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new eP(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new eP(i,i)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,i){let r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=e.canonicalID();if(!o)return!1;if("Polygon"===i.type){let a=eI(i.coordinates,n,o),s=eR(e.geometry(),r,n,o);if(!ew(r,n))return!1;for(let e of s)if(!eT(e,a))return!1}if("MultiPolygon"===i.type){let a=eC(i.coordinates,n,o),s=eR(e.geometry(),r,n,o);if(!ew(r,n))return!1;for(let e of s)if(!function(e,i){for(let r=0;r<i.length;r++)if(eT(e,i[r]))return!0;return!1}(e,a))return!1}return!0}(e,this.geometries);else if("LineString"===e.geometryType())return function(e,i){let r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=e.canonicalID();if(!o)return!1;if("Polygon"===i.type){let a=eI(i.coordinates,n,o),s=eM(e.geometry(),r,n,o);if(!ew(r,n))return!1;for(let e of s)if(!eE(e,a))return!1}if("MultiPolygon"===i.type){let a=eC(i.coordinates,n,o),s=eM(e.geometry(),r,n,o);if(!ew(r,n))return!1;for(let e of s)if(!function(e,i){for(let r=0;r<i.length;r++)if(eE(e,i[r]))return!0;return!1}(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function eO(e){if(e instanceof ev){if("get"===e.name&&1===e.args.length)return!1;else if("feature-state"===e.name)return!1;else if("has"===e.name&&1===e.args.length)return!1;else if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;else if(/^filter-/.test(e.name))return!1}if(e instanceof eP)return!1;let i=!0;return e.eachChild(e=>{i&&!eO(e)&&(i=!1)}),i}function ek(e){if(e instanceof ev&&"feature-state"===e.name)return!1;let i=!0;return e.eachChild(e=>{i&&!ek(e)&&(i=!1)}),i}function eL(e,i){if(e instanceof ev&&i.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(e=>{r&&!eL(e,i)&&(r=!1)}),r}class eD{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");let r=e[1];return i.scope.has(r)?new eD(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ez{constructor(e,i=[],r,n=new M,o=[]){this.registry=e,this.path=i,this.key=i.map(e=>`[${e}]`).join(""),this.scope=n,this.errors=o,this.expectedType=r}parse(e,i,r,n,o={}){return i?this.concat(i,r,n)._parse(e,o):this._parse(e,o)}_parse(e,i){function r(e,i,r){return"assert"===r?new ed(i,[e]):"coerce"===r?new eg(i,[e]):e}if((null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e)&&(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let o=this.registry[n];if(o){let n=o.parse(e,this);if(!n)return null;if(this.expectedType){let e=this.expectedType,o=n.type;if(("string"===e.kind||"number"===e.kind||"boolean"===e.kind||"object"===e.kind||"array"===e.kind)&&"value"===o.kind)n=r(n,e,i.typeAnnotation||"assert");else if(("color"===e.kind||"formatted"===e.kind||"resolvedImage"===e.kind)&&("value"===o.kind||"string"===o.kind))n=r(n,e,i.typeAnnotation||"coerce");else if(this.checkSubtype(e,o))return null}if(!(n instanceof eh)&&"resolvedImage"!==n.type.kind&&function e(i){if(i instanceof eD)return e(i.boundExpression);if(i instanceof ev&&"error"===i.name)return!1;if(i instanceof ex)return!1;if(i instanceof eP)return!1;let r=i instanceof eg||i instanceof ed,n=!0;return i.eachChild(i=>{n=r?n&&e(i):n&&i instanceof eh}),!!n&&eO(i)&&eL(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}(n)){let e=new ey;try{n=new eh(n.type,n.evaluate(e))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){let n="number"==typeof e?this.path.concat(e):this.path,o=r?this.scope.concat(r):this.scope;return new ez(this.registry,n,i||null,o,this.errors)}error(e,...i){let r=`${this.key}${i.map(e=>`[${e}]`).join("")}`;this.errors.push(new R(r,e))}checkSubtype(e,i){let r=q(e,i);return r&&this.error(r),r}}var eF=ez;function eB(e,i){let r,n,o=e.length-1,a=0,s=o,l=0;for(;a<=s;)if(r=e[l=Math.floor((a+s)/2)],n=e[l+1],r<=i){if(l===o||i<n)return l;a=l+1}else if(r>i)s=l-1;else throw new eu("Input is not a number.");return 0}class eN{constructor(e,i,r){for(let[n,o]of(this.type=e,this.input=i,this.labels=[],this.outputs=[],r))this.labels.push(n),this.outputs.push(o)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let r=i.parse(e[1],1,O);if(!r)return null;let n=[],o=null;i.expectedType&&"value"!==i.expectedType.kind&&(o=i.expectedType);for(let r=1;r<e.length;r+=2){let a=1===r?-1/0:e[r],s=e[r+1],l=r,h=r+1;if("number"!=typeof a)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=a)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);let u=i.parse(s,h,o);if(!u)return null;o=o||u.type,n.push([a,u])}return new eN(o,r,n)}evaluate(e){let i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);let n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);let o=i.length;return n>=i[o-1]?r[o-1].evaluate(e):r[eB(i,n)].evaluate(e)}eachChild(e){for(let i of(e(this.input),this.outputs))e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function ej(e,i,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(n-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=r,this.p2y=n}function eV(e,i,r){return e*(1-r)+i*r}ej.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(void 0===i&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var o=this.sampleCurveX(r)-e;if(Math.abs(o)<i)return r;var a=this.sampleCurveDerivativeX(r);if(1e-6>Math.abs(a))break;r-=o/a}var s=0,l=1;for(n=0,r=e;n<20&&!(Math.abs((o=this.sampleCurveX(r))-e)<i);n++)e>o?s=r:l=r,r=(l-s)*.5+s;return r},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}};var eU=Object.freeze({__proto__:null,number:eV,color:function(e,i,r){return new ee(eV(e.r,i.r,r),eV(e.g,i.g,r),eV(e.b,i.b,r),eV(e.a,i.a,r))},array:function(e,i,r){return e.map((e,n)=>eV(e,i[n],r))}});let eG=4/29,eq=6/29,e$=6/29*3*(6/29),eH=6/29*(6/29)*(6/29),eZ=Math.PI/180,eW=180/Math.PI;function eX(e){return e>eH?Math.pow(e,1/3):e/e$+eG}function eY(e){return e>eq?e*e*e:e$*(e-eG)}function eK(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function eJ(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function e1(e){let i=eJ(e.r),r=eJ(e.g),n=eJ(e.b),o=eX((.4124564*i+.3575761*r+.1804375*n)/.95047),a=eX((.2126729*i+.7151522*r+.072175*n)/1);return{l:116*a-16,a:500*(o-a),b:200*(a-eX((.0193339*i+.119192*r+.9503041*n)/1.08883)),alpha:e.a}}function e2(e){let i=(e.l+16)/116,r=isNaN(e.a)?i:i+e.a/500,n=isNaN(e.b)?i:i-e.b/200;return i=+eY(i),new ee(eK(3.2404542*(r=.95047*eY(r))-1.5371385*i-.4985314*(n=1.08883*eY(n))),eK(-.969266*r+1.8760108*i+.041556*n),eK(.0556434*r-.2040259*i+1.0572252*n),e.alpha)}let e3={forward:e1,reverse:e2,interpolate:function(e,i,r){return{l:eV(e.l,i.l,r),a:eV(e.a,i.a,r),b:eV(e.b,i.b,r),alpha:eV(e.alpha,i.alpha,r)}}},e4={forward:function(e){let{l:i,a:r,b:n}=e1(e),o=Math.atan2(n,r)*eW;return{h:o<0?o+360:o,c:Math.sqrt(r*r+n*n),l:i,alpha:e.a}},reverse:function(e){let i=e.h*eZ,r=e.c;return e2({l:e.l,a:Math.cos(i)*r,b:Math.sin(i)*r,alpha:e.alpha})},interpolate:function(e,i,r){return{h:function(e,i,r){let n=i-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}(e.h,i.h,r),c:eV(e.c,i.c,r),l:eV(e.l,i.l,r),alpha:eV(e.alpha,i.alpha,r)}}};var e6=Object.freeze({__proto__:null,lab:e3,hcl:e4});class e8{constructor(e,i,r,n,o){for(let[a,s]of(this.type=e,this.operator=i,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[],o))this.labels.push(a),this.outputs.push(s)}static interpolationFactor(e,i,r,n){let o=0;if("exponential"===e.name)o=e9(i,e.base,r,n);else if("linear"===e.name)o=e9(i,1,r,n);else if("cubic-bezier"===e.name){let a=e.controlPoints;o=new ej(a[0],a[1],a[2],a[3]).solve(e9(i,1,r,n))}return o}static parse(e,i){let[r,n,o,...a]=e;if(!Array.isArray(n)||0===n.length)return i.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){let e=n[1];if("number"!=typeof e)return i.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return i.error(`Unknown interpolation type ${String(n[0])}`,1,0);let e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(!(o=i.parse(o,2,O)))return null;let s=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=D:i.expectedType&&"value"!==i.expectedType.kind&&(l=i.expectedType);for(let e=0;e<a.length;e+=2){let r=a[e],n=a[e+1],o=e+3,h=e+4;if("number"!=typeof r)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(s.length&&s[s.length-1][0]>=r)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',o);let u=i.parse(n,h,l);if(!u)return null;l=l||u.type,s.push([r,u])}return"number"!==l.kind&&"color"!==l.kind&&("array"!==l.kind||"number"!==l.itemType.kind||"number"!=typeof l.N)?i.error(`Type ${U(l)} is not interpolatable.`):new e8(l,r,n,o,s)}evaluate(e){let i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);let n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);let o=i.length;if(n>=i[o-1])return r[o-1].evaluate(e);let a=eB(i,n),s=i[a],l=i[a+1],h=e8.interpolationFactor(this.interpolation,n,s,l),u=r[a].evaluate(e),c=r[a+1].evaluate(e);return"interpolate"===this.operator?eU[this.type.kind.toLowerCase()](u,c,h):"interpolate-hcl"===this.operator?e4.reverse(e4.interpolate(e4.forward(u),e4.forward(c),h)):e3.reverse(e3.interpolate(e3.forward(u),e3.forward(c),h))}eachChild(e){for(let i of(e(this.input),this.outputs))e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)i.push(this.labels[e],this.outputs[e].serialize());return i}}function e9(e,i,r,n){let o=n-r,a=e-r;return 0===o?0:1===i?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1)}class e7{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null,n=i.expectedType;n&&"value"!==n.kind&&(r=n);let o=[];for(let n of e.slice(1)){let e=i.parse(n,1+o.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,o.push(e)}return n&&o.some(e=>q(n,e.type))?new e7(F,o):new e7(r,o)}evaluate(e){let i,r=null,n=0;for(let o of this.args){if(n++,(r=o.evaluate(e))&&r instanceof en&&!r.available&&(i||(i=r),r=null,n===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class te{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let r=[];for(let n=1;n<e.length-1;n+=2){let o=e[n];if("string"!=typeof o)return i.error(`Expected string, but found ${typeof o} instead.`,n);if(/[^a-zA-Z0-9_]/.test(o))return i.error("Variable names must contain only alphanumeric characters or '_'.",n);let a=i.parse(e[n+1],n+1);if(!a)return null;r.push([o,a])}let n=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return n?new te(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}class tt{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,O),n=i.parse(e[2],2,V(i.expectedType||F));return r&&n?new tt(n.type.itemType,r,n):null}evaluate(e){let i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new eu(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new eu(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new eu(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ti{constructor(e,i){this.type=L,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,F),n=i.parse(e[2],2,F);return r&&n?$(r.type,[L,k,O,P,F])?new ti(r,n):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${U(r.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!H(i,["boolean","string","number","null"]))throw new eu(`Expected first argument to be of type boolean, string, number or null, but found ${U(es(i))} instead.`);if(!H(r,["string","array"]))throw new eu(`Expected second argument to be of type array or string, but found ${U(es(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class tr{constructor(e,i,r){this.type=O,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,F),n=i.parse(e[2],2,F);if(!r||!n)return null;if(!$(r.type,[L,k,O,P,F]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${U(r.type)} instead`);if(4!==e.length)return new tr(r,n);{let o=i.parse(e[3],3,O);return o?new tr(r,n,o):null}}evaluate(e){let i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!H(i,["boolean","string","number","null"]))throw new eu(`Expected first argument to be of type boolean, string, number or null, but found ${U(es(i))} instead.`);if(!H(r,["string","array"]))throw new eu(`Expected second argument to be of type array or string, but found ${U(es(r))} instead.`);if(this.fromIndex){let n=this.fromIndex.evaluate(e);return r.indexOf(i,n)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class tn{constructor(e,i,r,n,o,a){this.inputType=e,this.type=i,this.input=r,this.cases=n,this.outputs=o,this.otherwise=a}static parse(e,i){let r,n;if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");i.expectedType&&"value"!==i.expectedType.kind&&(n=i.expectedType);let o={},a=[];for(let s=2;s<e.length-1;s+=2){let l=e[s],h=e[s+1];Array.isArray(l)||(l=[l]);let u=i.concat(s);if(0===l.length)return u.error("Expected at least one branch label.");for(let e of l){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");else if(r){if(u.checkSubtype(r,es(e)))return null}else r=es(e);if(void 0!==o[String(e)])return u.error("Branch labels must be unique.");o[String(e)]=a.length}let c=i.parse(h,s,n);if(!c)return null;n=n||c.type,a.push(c)}let s=i.parse(e[1],1,F);if(!s)return null;let l=i.parse(e[e.length-1],e.length-1,n);return!l||"value"!==s.type.kind&&i.concat(1).checkSubtype(r,s.type)?null:new tn(r,n,s,o,a,l)}evaluate(e){let i=this.input.evaluate(e);return(es(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],n={};for(let e of i){let i=n[this.cases[e]];void 0===i?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[i][1].push(e)}let o=e=>"number"===this.inputType.kind?Number(e):e;for(let[i,n]of r)1===n.length?e.push(o(n[0])):e.push(n.map(o)),e.push(this.outputs[i].serialize());return e.push(this.otherwise.serialize()),e}}class to{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){let r;if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);let n=[];for(let o=1;o<e.length-1;o+=2){let a=i.parse(e[o],o,L);if(!a)return null;let s=i.parse(e[o+1],o+1,r);if(!s)return null;n.push([a,s]),r=r||s.type}let o=i.parse(e[e.length-1],e.length-1,r);return o?new to(r,n,o):null}evaluate(e){for(let[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ta{constructor(e,i,r,n){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,F),n=i.parse(e[2],2,O);if(!r||!n)return null;if(!$(r.type,[V(F),k,F]))return i.error(`Expected first argument to be of type array or string, but found ${U(r.type)} instead`);if(4!==e.length)return new ta(r.type,r,n);{let o=i.parse(e[3],3,O);return o?new ta(r.type,r,n,o):null}}evaluate(e){let i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!H(i,["string","array"]))throw new eu(`Expected first argument to be of type array or string, but found ${U(es(i))} instead.`);if(this.endIndex){let n=this.endIndex.evaluate(e);return i.slice(r,n)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ts(e,i){return"=="===e||"!="===e?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function tl(e,i,r,n){return 0===n.compare(i,r)}function th(e,i,r){let n="=="!==e&&"!="!==e;return class o{constructor(e,i,r){this.type=L,this.lhs=e,this.rhs=i,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===i.type.kind}static parse(e,i){if(3!==e.length&&4!==e.length)return i.error("Expected two or three arguments.");let r=e[0],a=i.parse(e[1],1,F);if(!a)return null;if(!ts(r,a.type))return i.concat(1).error(`"${r}" comparisons are not supported for type '${U(a.type)}'.`);let s=i.parse(e[2],2,F);if(!s)return null;if(!ts(r,s.type))return i.concat(2).error(`"${r}" comparisons are not supported for type '${U(s.type)}'.`);if(a.type.kind!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return i.error(`Cannot compare types '${U(a.type)}' and '${U(s.type)}'.`);n&&("value"===a.type.kind&&"value"!==s.type.kind?a=new ed(s.type,[a]):"value"!==a.type.kind&&"value"===s.type.kind&&(s=new ed(a.type,[s])));let l=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return i.error("Cannot use collator to compare non-string types.");if(!(l=i.parse(e[3],3,B)))return null}return new o(a,s,l)}evaluate(o){let a=this.lhs.evaluate(o),s=this.rhs.evaluate(o);if(n&&this.hasUntypedArgument){let i=es(a),r=es(s);if(i.kind!==r.kind||"string"!==i.kind&&"number"!==i.kind)throw new eu(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${i.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let e=es(a),r=es(s);if("string"!==e.kind||"string"!==r.kind)return i(o,a,s)}return this.collator?r(o,a,s,this.collator.evaluate(o)):i(o,a,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){let i=[e];return this.eachChild(e=>{i.push(e.serialize())}),i}}}let tu=th("==",function(e,i,r){return i===r},tl),tc=th("!=",function(e,i,r){return i!==r},function(e,i,r,n){return!tl(e,i,r,n)}),td=th("<",function(e,i,r){return i<r},function(e,i,r,n){return 0>n.compare(i,r)}),tp=th(">",function(e,i,r){return i>r},function(e,i,r,n){return n.compare(i,r)>0}),tf=th("<=",function(e,i,r){return i<=r},function(e,i,r,n){return 0>=n.compare(i,r)}),tm=th(">=",function(e,i,r){return i>=r},function(e,i,r,n){return n.compare(i,r)>=0});class tg{constructor(e,i,r,n,o,a){this.type=k,this.number=e,this.locale=i,this.currency=r,this.unit=n,this.minFractionDigits=o,this.maxFractionDigits=a}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");let r=i.parse(e[1],1,O);if(!r)return null;let n=e[2];if("object"!=typeof n||Array.isArray(n))return i.error("NumberFormat options argument must be an object.");let o=null;if(n.locale&&!(o=i.parse(n.locale,1,k)))return null;let a=null;if(n.currency&&!(a=i.parse(n.currency,1,k)))return null;let s=null;if(n.unit&&!(s=i.parse(n.unit,1,k)))return null;let l=null;if(n["min-fraction-digits"]&&!(l=i.parse(n["min-fraction-digits"],1,O)))return null;let h=null;return!n["max-fraction-digits"]||(h=i.parse(n["max-fraction-digits"],1,O))?new tg(r,o,a,s,l,h):null}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class t_{constructor(e){this.type=O,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${U(r.type)} instead.`):new t_(r):null}evaluate(e){let i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new eu(`Expected value to be of type string or array, but found ${U(es(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}let ty={"==":tu,"!=":tc,">":tp,"<":td,">=":tm,"<=":tf,array:ed,at:tt,boolean:ed,case:to,coalesce:e7,collator:ex,format:ep,image:ef,in:ti,"index-of":tr,interpolate:e8,"interpolate-hcl":e8,"interpolate-lab":e8,length:t_,let:te,literal:eh,match:tn,number:ed,"number-format":tg,object:ed,slice:ta,step:eN,string:ed,"to-boolean":eg,"to-color":eg,"to-number":eg,"to-string":eg,var:eD,within:eP};function tv(e,[i,r,n,o]){i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);let a=o?o.evaluate(e):1,s=eo(i,r,n,a);if(s)throw new eu(s);return new ee(i/255*a,r/255*a,n/255*a,a)}function tx(e,i){let r=i[e];return void 0===r?null:r}function tb(e){return{type:e}}function tw(e){return{result:"success",value:e}}function tT(e){return{result:"error",value:e}}function tS(e){return"data-driven"===e["property-type"]}function tE(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function tI(e){return!!e.expression&&e.expression.interpolated}function tC(e){if(e instanceof Number)return"number";if(e instanceof String)return"string";if(e instanceof Boolean)return"boolean";if(Array.isArray(e))return"array";if(null===e)return"null";else return typeof e}function tA(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function tR(e){return e}function tM(e,i){let r,n,o,a="color"===i.type,s=e.stops&&"object"==typeof e.stops[0][0],l=s||void 0!==e.property,h=e.type||(tI(i)?"exponential":"interval");if(a&&((e=A({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],ee.parse(e[1])])),e.default?e.default=ee.parse(e.default):e.default=ee.parse(i.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!e6[e.colorSpace])throw Error(`Unknown color space: ${e.colorSpace}`);if("exponential"===h)r=tL;else if("interval"===h)r=tk;else if("categorical"===h){for(let i of(r=tO,n=Object.create(null),e.stops))n[i[0]]=i[1];o=typeof e.stops[0][0]}else if("identity"===h)r=tD;else throw Error(`Unknown function type "${h}"`);if(s){let r={},n=[];for(let i=0;i<e.stops.length;i++){let o=e.stops[i],a=o[0].zoom;void 0===r[a]&&(r[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},n.push(a)),r[a].stops.push([o[0].value,o[1]])}let o=[];for(let e of n)o.push([r[e].zoom,tM(r[e],i)]);let a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:e8.interpolationFactor.bind(void 0,a),zoomStops:o.map(e=>e[0]),evaluate:({zoom:r},n)=>tL({stops:o,base:e.base},i,r).evaluate(r,n)}}if(!s&&l)return{kind:"source",evaluate(a,s){let l=s&&s.properties?s.properties[e.property]:void 0;return void 0===l?tP(e.default,i.default):r(e,i,l,n,o)}};{let a="exponential"===h?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:a,interpolationFactor:e8.interpolationFactor.bind(void 0,a),zoomStops:e.stops.map(e=>e[0]),evaluate:({zoom:a})=>r(e,i,a,n,o)}}}function tP(e,i,r){return void 0!==e?e:void 0!==i?i:void 0!==r?r:void 0}function tO(e,i,r,n,o){return tP(typeof r===o?n[r]:void 0,e.default,i.default)}function tk(e,i,r){if("number"!==tC(r))return tP(e.default,i.default);let n=e.stops.length;if(1===n||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];let o=eB(e.stops.map(e=>e[0]),r);return e.stops[o][1]}function tL(e,i,r){let n=void 0!==e.base?e.base:1;if("number"!==tC(r))return tP(e.default,i.default);let o=e.stops.length;if(1===o||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[o-1][0])return e.stops[o-1][1];let a=eB(e.stops.map(e=>e[0]),r),s=function(e,i,r,n){let o=n-r,a=e-r;return 0===o?0:1===i?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1)}(r,n,e.stops[a][0],e.stops[a+1][0]),l=e.stops[a][1],h=e.stops[a+1][1],u=eU[i.type]||tR;if(e.colorSpace&&"rgb"!==e.colorSpace){let i=e6[e.colorSpace];u=(e,r)=>i.reverse(i.interpolate(i.forward(e),i.forward(r),s))}return"function"==typeof l.evaluate?{evaluate(...e){let i=l.evaluate.apply(void 0,e),r=h.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return u(i,r,s)}}:u(l,h,s)}function tD(e,i,r){return"color"===i.type?r=ee.parse(r):"formatted"===i.type?r=er.fromString(r.toString()):"resolvedImage"===i.type?r=en.fromString(r.toString()):tC(r)===i.type||"enum"===i.type&&i.values[r]||(r=void 0),tP(r,e.default,i.default)}ev.register(ty,{error:[{kind:"error"},[k],(e,[i])=>{throw new eu(i.evaluate(e))}],typeof:[k,[F],(e,[i])=>U(es(i.evaluate(e)))],"to-rgba":[V(O,4),[D],(e,[i])=>i.evaluate(e).toArray()],rgb:[D,[O,O,O],tv],rgba:[D,[O,O,O,O],tv],has:{type:L,overloads:[[[k],(e,[i])=>i.evaluate(e)in e.properties()],[[k,z],(e,[i,r])=>i.evaluate(e)in r.evaluate(e)]]},get:{type:F,overloads:[[[k],(e,[i])=>tx(i.evaluate(e),e.properties())],[[k,z],(e,[i,r])=>tx(i.evaluate(e),r.evaluate(e))]]},"feature-state":[F,[k],(e,[i])=>tx(i.evaluate(e),e.featureState||{})],properties:[z,[],e=>e.properties()],"geometry-type":[k,[],e=>e.geometryType()],id:[F,[],e=>e.id()],zoom:[O,[],e=>e.globals.zoom],pitch:[O,[],e=>e.globals.pitch||0],"distance-from-center":[O,[],e=>e.distanceFromCenter()],"heatmap-density":[O,[],e=>e.globals.heatmapDensity||0],"line-progress":[O,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[O,[],e=>e.globals.skyRadialProgress||0],accumulated:[F,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[O,tb(O),(e,i)=>{let r=0;for(let n of i)r+=n.evaluate(e);return r}],"*":[O,tb(O),(e,i)=>{let r=1;for(let n of i)r*=n.evaluate(e);return r}],"-":{type:O,overloads:[[[O,O],(e,[i,r])=>i.evaluate(e)-r.evaluate(e)],[[O],(e,[i])=>-i.evaluate(e)]]},"/":[O,[O,O],(e,[i,r])=>i.evaluate(e)/r.evaluate(e)],"%":[O,[O,O],(e,[i,r])=>i.evaluate(e)%r.evaluate(e)],ln2:[O,[],()=>Math.LN2],pi:[O,[],()=>Math.PI],e:[O,[],()=>Math.E],"^":[O,[O,O],(e,[i,r])=>Math.pow(i.evaluate(e),r.evaluate(e))],sqrt:[O,[O],(e,[i])=>Math.sqrt(i.evaluate(e))],log10:[O,[O],(e,[i])=>Math.log(i.evaluate(e))/Math.LN10],ln:[O,[O],(e,[i])=>Math.log(i.evaluate(e))],log2:[O,[O],(e,[i])=>Math.log(i.evaluate(e))/Math.LN2],sin:[O,[O],(e,[i])=>Math.sin(i.evaluate(e))],cos:[O,[O],(e,[i])=>Math.cos(i.evaluate(e))],tan:[O,[O],(e,[i])=>Math.tan(i.evaluate(e))],asin:[O,[O],(e,[i])=>Math.asin(i.evaluate(e))],acos:[O,[O],(e,[i])=>Math.acos(i.evaluate(e))],atan:[O,[O],(e,[i])=>Math.atan(i.evaluate(e))],min:[O,tb(O),(e,i)=>Math.min(...i.map(i=>i.evaluate(e)))],max:[O,tb(O),(e,i)=>Math.max(...i.map(i=>i.evaluate(e)))],abs:[O,[O],(e,[i])=>Math.abs(i.evaluate(e))],round:[O,[O],(e,[i])=>{let r=i.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[O,[O],(e,[i])=>Math.floor(i.evaluate(e))],ceil:[O,[O],(e,[i])=>Math.ceil(i.evaluate(e))],"filter-==":[L,[k,F],(e,[i,r])=>e.properties()[i.value]===r.value],"filter-id-==":[L,[F],(e,[i])=>e.id()===i.value],"filter-type-==":[L,[k],(e,[i])=>e.geometryType()===i.value],"filter-<":[L,[k,F],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n<o}],"filter-id-<":[L,[F],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[L,[k,F],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n>o}],"filter-id->":[L,[F],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[L,[k,F],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[L,[F],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[L,[k,F],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[L,[F],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[L,[F],(e,[i])=>i.value in e.properties()],"filter-has-id":[L,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[L,[V(k)],(e,[i])=>i.value.indexOf(e.geometryType())>=0],"filter-id-in":[L,[V(F)],(e,[i])=>i.value.indexOf(e.id())>=0],"filter-in-small":[L,[k,V(F)],(e,[i,r])=>r.value.indexOf(e.properties()[i.value])>=0],"filter-in-large":[L,[k,V(F)],(e,[i,r])=>(function(e,i,r,n){for(;r<=n;){let o=r+n>>1;if(i[o]===e)return!0;i[o]>e?n=o-1:r=o+1}return!1})(e.properties()[i.value],r.value,0,r.value.length-1)],all:{type:L,overloads:[[[L,L],(e,[i,r])=>i.evaluate(e)&&r.evaluate(e)],[tb(L),(e,i)=>{for(let r of i)if(!r.evaluate(e))return!1;return!0}]]},any:{type:L,overloads:[[[L,L],(e,[i,r])=>i.evaluate(e)||r.evaluate(e)],[tb(L),(e,i)=>{for(let r of i)if(r.evaluate(e))return!0;return!1}]]},"!":[L,[L],(e,[i])=>!i.evaluate(e)],"is-supported-script":[L,[k],(e,[i])=>{let r=e.globals&&e.globals.isSupportedScript;return!r||r(i.evaluate(e))}],upcase:[k,[k],(e,[i])=>i.evaluate(e).toUpperCase()],downcase:[k,[k],(e,[i])=>i.evaluate(e).toLowerCase()],concat:[k,tb(F),(e,i)=>i.map(i=>el(i.evaluate(e))).join("")],"resolved-locale":[k,[B],(e,[i])=>i.evaluate(e).resolvedLocale()]});class tz{constructor(e,i){var r;this.expression=e,this._warningHistory={},this._evaluator=new ey,this._defaultValue=i?"color"===(r=i).type&&(tA(r.default)||Array.isArray(r.default))?new ee(0,0,0,0):"color"===r.type?ee.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,r,n,o,a,s,l){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,n,o,a,s,l){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=l||null;try{let e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new eu(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function tF(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in ty}function tB(e,i){let r=new eF(ty,[],i?function(e){let i={color:D,string:k,number:O,enum:k,boolean:L,formatted:N,resolvedImage:j};return"array"===e.type?V(i[e.value]||F,e.length):i[e.type]}(i):void 0),n=r.parse(e,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return n?tw(new tz(n,i)):tT(r.errors)}class tN{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!ek(i.expression)}evaluateWithoutErrorHandling(e,i,r,n,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,o,a)}evaluate(e,i,r,n,o,a){return this._styleExpression.evaluate(e,i,r,n,o,a)}}class tj{constructor(e,i,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!ek(i.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,i,r,n,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,o,a)}evaluate(e,i,r,n,o,a){return this._styleExpression.evaluate(e,i,r,n,o,a)}interpolationFactor(e,i,r){return this.interpolationType?e8.interpolationFactor(this.interpolationType,e,i,r):0}}function tV(e,i){if("error"===(e=tB(e,i)).result)return e;let r=e.value.expression,n=eO(r);if(!n&&!tS(i))return tT([new R("","data expressions not supported")]);let o=eL(r,["zoom","pitch","distance-from-center"]);if(!o&&!tE(i))return tT([new R("","zoom expressions not supported")]);let a=function e(i){let r=null;if(i instanceof te)r=e(i.result);else if(i instanceof e7){for(let n of i.args)if(r=e(n))break}else(i instanceof eN||i instanceof e8)&&i.input instanceof ev&&"zoom"===i.input.name&&(r=i);return r instanceof R||i.eachChild(i=>{let n=e(i);n instanceof R?r=n:!r&&n?r=new R("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new R("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}(r);if(!a&&!o)return tT([new R("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(a instanceof R)return tT([a]);if(a instanceof e8&&!tI(i))return tT([new R("",'"interpolate" expressions cannot be used with this property')]);if(!a)return tw(n?new tN("constant",e.value):new tN("source",e.value));let s=a instanceof e8?a.interpolation:void 0;return tw(n?new tj("camera",e.value,a.labels,s):new tj("composite",e.value,a.labels,s))}class tU{constructor(e,i){this._parameters=e,this._specification=i,A(this,tM(this._parameters,this._specification))}static deserialize(e){return new tU(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function tG(e){return"object"==typeof e?["literal",e]:e}function tq(e){switch(e.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function t$(e,i){var r,n;let o=tG((r=e.default,n=i.default,void 0!==r?r:void 0!==n?n:void 0));return void 0===o&&"resolvedImage"===i.type?"":o}function tH(e,i,r){let n=tX(e,i),o=["get",e.property];if("categorical"===n&&"boolean"==typeof r[0][0]){let n=["case"];for(let e of r)n.push(["==",o,e[0]],e[1]);return n.push(t$(e,i)),n}if("categorical"===n){let n=["match",o];for(let e of r)tW(n,e[0],e[1],!1);return n.push(t$(e,i)),n}if("interval"===n){let i=["step",["number",o]];for(let e of r)tW(i,e[0],e[1],!0);return tZ(i),void 0===e.default?i:["case",["==",["typeof",o],"number"],i,tG(e.default)]}if("exponential"===n){let i=void 0!==e.base?e.base:1,n=[tq(e),1===i?["linear"]:["exponential",i],["number",o]];for(let e of r)tW(n,e[0],e[1],!1);return void 0===e.default?n:["case",["==",["typeof",o],"number"],n,tG(e.default)]}throw Error(`Unknown property function type ${n}`)}function tZ(e){"step"===e[0]&&3===e.length&&(e.push(0),e.push(e[3]))}function tW(e,i,r,n){e.length>3&&i===e[e.length-2]||(n&&2===e.length||e.push(i),e.push(r))}function tX(e,i){return e.type?e.type:i.expression.interpolated?"exponential":"interval"}function tY(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function tK(e){if(Array.isArray(e))return e.map(tK);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let i={};for(let r in e)i[r]=tK(e[r]);return i}return tY(e)}function tJ(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let i of e.slice(1))if(!tJ(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function tQ(e,i="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};tJ(e)||(e=function e(i){if(!i)return!0;let r=i[0];return i.length<=1?"any"!==r:"=="===r?t3(i[1],i[2],"=="):"!="===r?t6(t3(i[1],i[2],"==")):"<"===r||">"===r||"<="===r||">="===r?t3(i[1],i[2],r):"any"===r?["any"].concat(i.slice(1).map(e)):"all"===r?["all"].concat(i.slice(1).map(e)):"none"===r?["all"].concat(i.slice(1).map(e).map(t6)):"in"===r?t5(i[1],i.slice(2)):"!in"===r?t6(t5(i[1],i.slice(2))):"has"===r?t4(i[1]):"!has"===r?t6(t4(i[1])):"within"!==r||i}(e));let r=e,n=!0;try{n=function(e){if(!t0(e))return e;let i=tK(e);return function e(i){let r=!1,n=[];if("case"===i[0]){for(let e=1;e<i.length-1;e+=2)r=r||t0(i[e]),n.push(i[e+1]);n.push(i[i.length-1])}else if("match"===i[0]){r=r||t0(i[1]);for(let e=2;e<i.length-1;e+=2)n.push(i[e+1]);n.push(i[i.length-1])}else if("step"===i[0]){r=r||t0(i[1]);for(let e=1;e<i.length-1;e+=2)n.push(i[e+1])}r&&(i.length=0,i.push("any",...n));for(let r=1;r<i.length;r++)e(i[r])}(i),i=function e(i){if(!Array.isArray(i))return i;let r=function(e){if(t1.has(e[0])){for(let i=1;i<e.length;i++)if(t0(e[i]))return!0}return e}(i);return!0===r?r:r.map(i=>e(i))}(i)}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}let o=s[`filter_${i}`],a=tB(n,o),l=null;if("error"===a.result)throw Error(a.value.map(e=>`${e.key}: ${e.message}`).join(", "));l=(e,i,r)=>a.value.evaluate(e,i,{},r);let h=null,u=null;if(n!==r){let e=tB(r,o);if("error"===e.result)throw Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));h=(i,r,n,o,a)=>e.value.evaluate(i,r,{},n,void 0,void 0,o,a),u=!eO(e.value.expression)}return{filter:l,dynamicFilter:h||void 0,needGeometry:function e(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let r=1;r<i.length;r++)if(e(i[r]))return!0;return!1}(n),needFeature:!!u}}function t0(e){var i;if(!Array.isArray(e))return!1;if("pitch"===(i=e[0])||"distance-from-center"===i)return!0;for(let i=1;i<e.length;i++)if(t0(e[i]))return!0;return!1}let t1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function t2(e,i){return e<i?-1:+(e>i)}function t3(e,i,r){switch(e){case"$type":return[`filter-type-${r}`,i];case"$id":return[`filter-id-${r}`,i];default:return[`filter-${r}`,e,i]}}function t5(e,i){if(0===i.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:if(i.length>200&&!i.some(e=>typeof e!=typeof i[0]))return["filter-in-large",e,["literal",i.sort(t2)]];return["filter-in-small",e,["literal",i]]}}function t4(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function t6(e){return["!",e]}var t8=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function t9(e){e=e.slice();let i=Object.create(null);for(let r=0;r<e.length;r++)i[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=function(e,i){let r={};for(let i in e)"ref"!==i&&(r[i]=e[i]);return t8.forEach(e=>{e in i&&(r[e]=i[e])}),r}(e[r],i[e[r].ref]));return e}class t7{constructor(e,i,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=i&&i.__line__&&(this.line=i.__line__)}}function ie(e){let i=e.key,r=e.value,n=e.valueSpec||{},o=e.objectElementValidators||{},a=e.style,s=e.styleSpec,l=[],h=tC(r);if("object"!==h)return[new t7(i,r,`object expected, ${h} found`)];for(let e in r){let h,u=e.split(".")[0],c=n[u]||n["*"];if(o[u]?h=o[u]:n[u]?h=id:o["*"]?h=o["*"]:n["*"]&&(h=id),!h){l.push(new t7(i,r[e],`unknown property "${e}"`));continue}l=l.concat(h({key:(i?`${i}.`:i)+e,value:r[e],valueSpec:c,style:a,styleSpec:s,object:r,objectKey:e},r))}for(let e in n)!o[e]&&n[e].required&&void 0===n[e].default&&void 0===r[e]&&l.push(new t7(i,r,`missing required property "${e}"`));return l}function it(e){let i=e.value,r=e.valueSpec,n=e.style,o=e.styleSpec,a=e.key,s=e.arrayElementValidator||id;if("array"!==tC(i))return[new t7(a,i,`array expected, ${tC(i)} found`)];if(r.length&&i.length!==r.length)return[new t7(a,i,`array length ${r.length} expected, length ${i.length} found`)];if(r["min-length"]&&i.length<r["min-length"])return[new t7(a,i,`array length at least ${r["min-length"]} expected, length ${i.length} found`)];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};o.$version<7&&(l.function=r.function),"object"===tC(r.value)&&(l=r.value);let h=[];for(let e=0;e<i.length;e++)h=h.concat(s({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:n,styleSpec:o,key:`${a}[${e}]`}));return h}function ii(e){let i=e.key,r=e.value,n=e.valueSpec,o=tC(r);if("number"===o&&r!=r&&(o="NaN"),"number"!==o)return[new t7(i,r,`number expected, ${o} found`)];if("minimum"in n){let o=n.minimum;if("array"===tC(n.minimum)){let i=e.arrayIndex;o=n.minimum[i]}if(r<o)return[new t7(i,r,`${r} is less than the minimum value ${o}`)]}if("maximum"in n){let o=n.maximum;if("array"===tC(n.maximum)){let i=e.arrayIndex;o=n.maximum[i]}if(r>o)return[new t7(i,r,`${r} is greater than the maximum value ${o}`)]}return[]}function ir(e){let i,r,n,o=e.valueSpec,a=tY(e.value.type),s={},l="categorical"!==a&&void 0===e.value.property,h="array"===tC(e.value.stops)&&"array"===tC(e.value.stops[0])&&"object"===tC(e.value.stops[0][0]),u=ie({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new t7(e.key,e.value,'identity function may not have a "stops" property')];let i=[],r=e.value;return i=i.concat(it({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:c})),"array"===tC(r)&&0===r.length&&i.push(new t7(e.key,r,"array must have at least one stop")),i},default:function(e){return id({key:e.key,value:e.value,valueSpec:o,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&l&&u.push(new t7(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||u.push(new t7(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!tI(e.valueSpec)&&u.push(new t7(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l||tS(e.valueSpec)?l&&!tE(e.valueSpec)&&u.push(new t7(e.key,e.value,"zoom functions not supported")):u.push(new t7(e.key,e.value,"property functions not supported"))),("categorical"===a||h)&&void 0===e.value.property&&u.push(new t7(e.key,e.value,'"property" property is required')),u;function c(e){let i=[],a=e.value,l=e.key;if("array"!==tC(a))return[new t7(l,a,`array expected, ${tC(a)} found`)];if(2!==a.length)return[new t7(l,a,`array length 2 expected, length ${a.length} found`)];if(h){if("object"!==tC(a[0]))return[new t7(l,a,`object expected, ${tC(a[0])} found`)];if(void 0===a[0].zoom)return[new t7(l,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new t7(l,a,"object stop key must have value")];let o=tY(a[0].zoom);if("number"!=typeof o)return[new t7(l,a[0].zoom,"stop zoom values must be numbers")];if(n&&n>o)return[new t7(l,a[0].zoom,"stop zoom values must appear in ascending order")];o!==n&&(n=o,r=void 0,s={}),i=i.concat(ie({key:`${l}[0]`,value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:ii,value:d}}))}else i=i.concat(d({key:`${l}[0]`,value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return tF(tK(a[1]))?i.concat([new t7(`${l}[1]`,a[1],"expressions are not allowed in function stops.")]):i.concat(id({key:`${l}[1]`,value:a[1],valueSpec:o,style:e.style,styleSpec:e.styleSpec}))}function d(e,n){let l=tC(e.value),h=tY(e.value),u=null!==e.value?e.value:n;if(i){if(l!==i)return[new t7(e.key,u,`${l} stop domain type must match previous stop domain type ${i}`)]}else i=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof h&&"string"!=typeof h&&"boolean"!=typeof h)return[new t7(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==a){let i=`number expected, ${l} found`;return tS(o)&&void 0===a&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t7(e.key,u,i)]}return"categorical"!==a||"number"!==l||"number"==typeof h&&isFinite(h)&&Math.floor(h)===h?"categorical"!==a&&"number"===l&&"number"==typeof h&&"number"==typeof r&&void 0!==r&&h<r?[new t7(e.key,u,"stop domain values must appear in ascending order")]:(r=h,"categorical"===a&&h in s)?[new t7(e.key,u,"stop domain values must be unique")]:(s[h]=!0,[]):[new t7(e.key,u,`integer expected, found ${String(h)}`)]}}function io(e){let i=("property"===e.expressionContext?tV:tB)(tK(e.value),e.valueSpec);if("error"===i.result)return i.value.map(i=>new t7(`${e.key}${i.key}`,e.value,i.message));let r=i.value.expression||i.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new t7(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ek(r))return[new t7(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return function e(i,r){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(let e of r.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];let o=[];return i instanceof ev&&n.has(i.name)?[new t7(r.key,r.value,`["${i.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(i.eachChild(i=>{o.push(...e(i,r))}),o)}(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!eL(r,["zoom","feature-state"]))return[new t7(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!eO(r))return[new t7(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ia(e){let i=e.key,r=e.value,n=e.valueSpec,o=[];return Array.isArray(n.values)?-1===n.values.indexOf(tY(r))&&o.push(new t7(i,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(tY(r))&&o.push(new t7(i,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function is(e){if(!tJ(tK(e.value)))return function e(i){let r,n=i.value,o=i.key;if("array"!==tC(n))return[new t7(o,n,`array expected, ${tC(n)} found`)];let a=i.styleSpec,s=[];if(n.length<1)return[new t7(o,n,"filter array must have at least 1 element")];switch(s=s.concat(ia({key:`${o}[0]`,value:n[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),tY(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===tY(n[1])&&s.push(new t7(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&s.push(new t7(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&"string"!==(r=tC(n[1]))&&s.push(new t7(`${o}[1]`,n[1],`string expected, ${r} found`));for(let e=2;e<n.length;e++)r=tC(n[e]),"$type"===tY(n[1])?s=s.concat(ia({key:`${o}[${e}]`,value:n[e],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&s.push(new t7(`${o}[${e}]`,n[e],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let r=1;r<n.length;r++)s=s.concat(e({key:`${o}[${r}]`,value:n[r],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":r=tC(n[1]),2!==n.length?s.push(new t7(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==r&&s.push(new t7(`${o}[1]`,n[1],`string expected, ${r} found`));break;case"within":r=tC(n[1]),2!==n.length?s.push(new t7(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==r&&s.push(new t7(`${o}[1]`,n[1],`object expected, ${r} found`))}return s}(e);{let i=e.layerType||"fill";return io(A({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${i}`]}))}}function il(e,i){let r,n=e.key,o=e.style,a=e.styleSpec,s=e.value,l=e.objectKey,h=a[`${i}_${e.layerType}`];if(!h)return[];let u=l.match(/^(.*)-transition$/);if("paint"===i&&u&&h[u[1]]&&h[u[1]].transition)return id({key:n,value:s,valueSpec:a.transition,style:o,styleSpec:a});let c=e.valueSpec||h[l];if(!c)return[new t7(n,s,`unknown property "${l}"`)];if("string"===tC(s)&&tS(c)&&!c.tokens&&(r=/^{([^}]+)}$/.exec(s)))return[new t7(n,s,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(r[1])} }\`.`)];let d=[];return"symbol"===e.layerType&&("text-field"===l&&o&&!o.glyphs&&d.push(new t7(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&tA(tK(s))&&"identity"===tY(s.type)&&d.push(new t7(n,s,'"text-font" does not support identity functions'))),d.concat(id({key:e.key,value:s,valueSpec:c,style:o,styleSpec:a,expressionContext:"property",propertyType:i,propertyKey:l}))}function ih(e){let i=e.value,r=e.key,n=tC(i);return"string"!==n?[new t7(r,i,`string expected, ${n} found`)]:[]}let iu={promoteId:function({key:e,value:i}){if("string"===tC(i))return ih({key:e,value:i});{let r=[];for(let n in i)r.push(...ih({key:`${e}.${n}`,value:i[n]}));return r}}},ic={"*":()=>[],array:it,boolean:function(e){let i=e.value,r=e.key,n=tC(i);return"boolean"!==n?[new t7(r,i,`boolean expected, ${n} found`)]:[]},number:ii,color:function(e){let i=e.key,n=e.value,o=tC(n);return"string"!==o?[new t7(i,n,`color expected, ${o} found`)]:null===r(n)?[new t7(i,n,`color expected, "${n}" found`)]:[]},enum:ia,filter:is,function:ir,layer:function(e){let i=[],r=e.value,n=e.key,o=e.style,a=e.styleSpec;r.type||r.ref||i.push(new t7(n,r,'either "type" or "ref" is required'));let s=tY(r.type),l=tY(r.ref);if(r.id){let a=tY(r.id);for(let s=0;s<e.arrayIndex;s++){let e=o.layers[s];tY(e.id)===a&&i.push(new t7(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach(e=>{e in r&&i.push(new t7(n,r[e],`"${e}" is prohibited for ref layers`))}),o.layers.forEach(i=>{tY(i.id)===l&&(e=i)}),e?e.ref?i.push(new t7(n,r.ref,"ref cannot reference another ref layer")):s=tY(e.type):"string"==typeof l&&i.push(new t7(n,r.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s)if(r.source){let e=o.sources&&o.sources[r.source],a=e&&tY(e.type);e?"vector"===a&&"raster"===s?i.push(new t7(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===a&&"raster"!==s?i.push(new t7(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==a||r["source-layer"]?"raster-dem"===a&&"hillshade"!==s?i.push(new t7(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===s&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&("geojson"!==a||!e.lineMetrics)&&i.push(new t7(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new t7(n,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new t7(n,r.source,`source "${r.source}" not found`))}else i.push(new t7(n,r,'missing required property "source"'));return i=i.concat(ie({key:n,value:r,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>id({key:`${n}.type`,value:r.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:e=>is(A({layerType:s},e)),layout:e=>ie({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>il(A({layerType:s},e),"layout")}}),paint:e=>ie({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>il(A({layerType:s},e),"paint")}})}}))},object:ie,source:function(e){let i,r=e.value,n=e.key,o=e.styleSpec,a=e.style;if(!r.type)return[new t7(n,r,'"type" is required')];let s=tY(r.type);switch(s){case"vector":case"raster":case"raster-dem":return ie({key:n,value:r,valueSpec:o[`source_${s.replace("-","_")}`],style:e.style,styleSpec:o,objectElementValidators:iu});case"geojson":if(i=ie({key:n,value:r,valueSpec:o.source_geojson,style:a,styleSpec:o,objectElementValidators:iu}),r.cluster)for(let e in r.clusterProperties){let[o,a]=r.clusterProperties[e],s="string"==typeof o?[o,["accumulated"],["get",e]]:o;i.push(...io({key:`${n}.${e}.map`,value:a,expressionContext:"cluster-map"})),i.push(...io({key:`${n}.${e}.reduce`,value:s,expressionContext:"cluster-reduce"}))}return i;case"video":return ie({key:n,value:r,valueSpec:o.source_video,style:a,styleSpec:o});case"image":return ie({key:n,value:r,valueSpec:o.source_image,style:a,styleSpec:o});case"canvas":return[new t7(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:var l;return ia({key:`${n}.type`,value:r.type,valueSpec:{values:(l=o).source.reduce((e,i)=>{let r=l[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e},[])},style:a,styleSpec:o})}},light:function(e){let i=e.value,r=e.styleSpec,n=r.light,o=e.style,a=[],s=tC(i);if(void 0===i)return a;if("object"!==s)return a.concat([new t7("light",i,`object expected, ${s} found`)]);for(let e in i){let s=e.match(/^(.*)-transition$/);a=s&&n[s[1]]&&n[s[1]].transition?a.concat(id({key:e,value:i[e],valueSpec:r.transition,style:o,styleSpec:r})):n[e]?a.concat(id({key:e,value:i[e],valueSpec:n[e],style:o,styleSpec:r})):a.concat([new t7(e,i[e],`unknown property "${e}"`)])}return a},terrain:function(e){let i=e.value,r=e.key,n=e.style,o=e.styleSpec,a=o.terrain,s=[],l=tC(i);if(void 0===i)return s;if("object"!==l)return s.concat([new t7("terrain",i,`object expected, ${l} found`)]);for(let e in i){let r=e.match(/^(.*)-transition$/);s=r&&a[r[1]]&&a[r[1]].transition?s.concat(id({key:e,value:i[e],valueSpec:o.transition,style:n,styleSpec:o})):a[e]?s.concat(id({key:e,value:i[e],valueSpec:a[e],style:n,styleSpec:o})):s.concat([new t7(e,i[e],`unknown property "${e}"`)])}if(i.source){let e=n.sources&&n.sources[i.source],o=e&&tY(e.type);e?"raster-dem"!==o&&s.push(new t7(r,i.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):s.push(new t7(r,i.source,`source "${i.source}" not found`))}else s.push(new t7(r,i,'terrain is missing required property "source"'));return s},fog:function(e){let i=e.value,r=e.style,n=e.styleSpec,o=n.fog,a=[],s=tC(i);if(void 0===i)return a;if("object"!==s)return a.concat([new t7("fog",i,`object expected, ${s} found`)]);for(let e in i){let s=e.match(/^(.*)-transition$/);a=s&&o[s[1]]&&o[s[1]].transition?a.concat(id({key:e,value:i[e],valueSpec:n.transition,style:r,styleSpec:n})):o[e]?a.concat(id({key:e,value:i[e],valueSpec:o[e],style:r,styleSpec:n})):a.concat([new t7(e,i[e],`unknown property "${e}"`)])}return a},string:ih,formatted:function(e){return 0===ih(e).length?[]:io(e)},resolvedImage:function(e){return 0===ih(e).length?[]:io(e)},projection:function(e){let i=e.value,r=e.styleSpec,n=r.projection,o=e.style,a=[],s=tC(i);if("object"===s)for(let e in i)a=a.concat(id({key:e,value:i[e],valueSpec:n[e],style:o,styleSpec:r}));else"string"!==s&&(a=a.concat([new t7("projection",i,`object or string expected, ${s} found`)]));return a}};function id(e){let i=e.value,r=e.valueSpec,n=e.styleSpec;return r.expression&&tA(tY(i))?ir(e):r.expression&&tF(tK(i))?io(e):r.type&&ic[r.type]?ic[r.type](e):ie(A({},e,{valueSpec:r.type?n[r.type]:r}))}(o={}).parser=a=function(){var e=function(e,i,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=i);return r},i=[1,12],r=[1,13],n=[1,9],o=[1,10],a=[1,11],s=[1,14],l=[1,15],h=[14,18,22,24],u=[18,22],c=[22,24],d={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,i,r,n,o,a,s){var l=a.length-1;switch(o){case 1:this.$=new String(e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(e),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=a[l-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=a[l-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[a[l-2],a[l]];break;case 16:this.$={},this.$[a[l][0]]=a[l][1];break;case 17:this.$=a[l-2],a[l-2][a[l][0]]=a[l][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[a[l]];break;case 21:this.$=a[l-2],a[l-2].push(a[l])}},table:[{3:5,4:i,5:6,6:r,7:3,8:n,9:4,10:o,11:a,12:1,13:2,15:7,16:8,17:s,23:l},{1:[3]},{14:[1,16]},e(h,[2,7]),e(h,[2,8]),e(h,[2,9]),e(h,[2,10]),e(h,[2,11]),e(h,[2,12]),e(h,[2,3]),e(h,[2,4]),e(h,[2,5]),e([14,18,21,22,24],[2,1]),e(h,[2,2]),{3:20,4:i,18:[1,17],19:18,20:19},{3:5,4:i,5:6,6:r,7:3,8:n,9:4,10:o,11:a,13:23,15:7,16:8,17:s,23:l,24:[1,21],25:22},{1:[2,6]},e(h,[2,13]),{18:[1,24],22:[1,25]},e(u,[2,16]),{21:[1,26]},e(h,[2,18]),{22:[1,28],24:[1,27]},e(c,[2,20]),e(h,[2,14]),{3:20,4:i,20:29},{3:5,4:i,5:6,6:r,7:3,8:n,9:4,10:o,11:a,13:30,15:7,16:8,17:s,23:l},e(h,[2,19]),{3:5,4:i,5:6,6:r,7:3,8:n,9:4,10:o,11:a,13:31,15:7,16:8,17:s,23:l},e(u,[2,17]),e(u,[2,15]),e(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,i){if(i.recoverable)this.trace(e);else throw Error(e)},parse:function(e){var i=this,r=[0],n=[null],o=[],a=this.table,s="",l=0,h=0,u=o.slice.call(arguments,1),c=Object.create(this.lexer),d={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(d.yy[p]=this.yy[p]);c.setInput(e,d.yy),d.yy.lexer=c,d.yy.parser=this,void 0===c.yylloc&&(c.yylloc={});var f=c.yylloc;o.push(f);var m=c.options&&c.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,_,y,v,x,b,w,T,S={};;){if(_=r[r.length-1],this.defaultActions[_]?y=this.defaultActions[_]:(null==g&&(g=function(){var e;return"number"!=typeof(e=c.lex()||1)&&(e=i.symbols_[e]||e),e}()),y=a[_]&&a[_][g]),void 0===y||!y.length||!y[0]){var E="";for(x in T=[],a[_])this.terminals_[x]&&x>2&&T.push("'"+this.terminals_[x]+"'");E=c.showPosition?"Parse error on line "+(l+1)+":\n"+c.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==g?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(E,{text:c.match,token:this.terminals_[g]||g,line:c.yylineno,loc:f,expected:T})}if(y[0]instanceof Array&&y.length>1)throw Error("Parse Error: multiple actions possible at state: "+_+", token: "+g);switch(y[0]){case 1:r.push(g),n.push(c.yytext),o.push(c.yylloc),r.push(y[1]),g=null,h=c.yyleng,s=c.yytext,l=c.yylineno,f=c.yylloc;break;case 2:if(b=this.productions_[y[1]][1],S.$=n[n.length-b],S._$={first_line:o[o.length-(b||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(b||1)].first_column,last_column:o[o.length-1].last_column},m&&(S._$.range=[o[o.length-(b||1)].range[0],o[o.length-1].range[1]]),void 0!==(v=this.performAction.apply(S,[s,h,l,d.yy,y[1],n,o].concat(u))))return v;b&&(r=r.slice(0,-1*b*2),n=n.slice(0,-1*b),o=o.slice(0,-1*b)),r.push(this.productions_[y[1]][0]),n.push(S.$),o.push(S._$),w=a[r[r.length-2]][r[r.length-1]],r.push(w);break;case 3:return!0}}return!0}};function p(){this.yy={}}return d.lexer={EOF:1,parseError:function(e,i){if(this.yy.parser)this.yy.parser.parseError(e,i);else throw Error(e)},setInput:function(e,i){return this.yy=i||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var i=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-i),this.offset-=i;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-i},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-i]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),i=Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+i+"^"},test_match:function(e,i){var r,n,o;if(this.options.backtrack_lexer&&(o={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(o.yylloc.range=this.yylloc.range.slice(0))),(n=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,i,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack)for(var a in o)this[a]=o[a];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var e,i,r,n,o=this._currentRules(),a=0;a<o.length;a++)if((r=this._input.match(this.rules[o[a]]))&&(!i||r[0].length>i[0].length)){if(i=r,n=a,this.options.backtrack_lexer){if(!1!==(e=this.test_match(r,o[a])))return e;if(!this._backtrack)return!1;i=!1;continue}if(!this.options.flex)break}return i?!1!==(e=this.test_match(i,o[n]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,i,r,n){switch(r){case 0:break;case 1:return 6;case 2:return i.yytext=i.yytext.substr(1,i.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},p.prototype=d,d.Parser=p,new p}(),o.Parser=a.Parser,o.parse=function(){return a.parse.apply(a,arguments)};let ip={StyleExpression:tz,isExpression:tF,isExpressionFilter:tJ,createExpression:tB,createPropertyExpression:tV,normalizePropertyExpression:function(e,i){if(tA(e))return new tU(e,i);if(tF(e)){let r=tV(e,i);if("error"===r.result)throw Error(r.value.map(e=>`${e.key}: ${e.message}`).join(", "));return r.value}{let r=e;return"string"==typeof e&&"color"===i.type&&(r=ee.parse(e)),{kind:"constant",evaluate:()=>r}}},ZoomConstantExpression:tN,ZoomDependentExpression:tj,StylePropertyFunction:tU},im={convertFunction:function(e,i){let r=e.stops;if(!r){var n=e,o=i;let r=["get",n.property];if(void 0===n.default)return"string"===o.type?["string",r]:r;{if("enum"===o.type)return["match",r,Object.keys(o.values),r,n.default];let e=["color"===o.type?"to-color":o.type,r,tG(n.default)];return"array"===o.type&&e.splice(1,0,o.value,o.length||null),e}}let a=r&&"object"==typeof r[0][0],s=a||void 0!==e.property;return(r=r.map(e=>!s&&i.tokens&&"string"==typeof e[1]?[e[0],function(e){let i=["concat"],r=/{([^{}]+)}/g,n=0;for(let o=r.exec(e);null!==o;o=r.exec(e)){let a=e.slice(n,r.lastIndex-o[0].length);n=r.lastIndex,a.length>0&&i.push(a),i.push(["get",o[1]])}if(1===i.length)return e;if(n<e.length)i.push(e.slice(n));else if(2===i.length)return["to-string",i[1]];return i}(e[1])]:[e[0],tG(e[1])]),a)?function(e,i,r){let n={},o={},a=[];for(let i=0;i<r.length;i++){let s=r[i],l=s[0].zoom;void 0===n[l]&&(n[l]={zoom:l,type:e.type,property:e.property,default:e.default},o[l]=[],a.push(l)),o[l].push([s[0].value,s[1]])}if("exponential"===tX({},i)){let r=[tq(e),["linear"],["zoom"]];for(let e of a){let a=tH(n[e],i,o[e]);tW(r,e,a,!1)}return r}{let e=["step",["zoom"]];for(let r of a){let a=tH(n[r],i,o[r]);tW(e,r,a,!0)}return tZ(e),e}}(e,i,r):a||!s?function(e,i,r,n=["zoom"]){let o,a=tX(e,i),s=!1;if("interval"===a)o=["step",n],s=!0;else if("exponential"===a){let i=void 0!==e.base?e.base:1;o=[tq(e),1===i?["linear"]:["exponential",i],n]}else throw Error(`Unknown zoom function type "${a}"`);for(let e of r)tW(o,e[0],e[1],s);return tZ(o),o}(e,i,r):tH(e,i,r)},createFunction:tM,isFunction:tA}}),e4("awmEs",function(e,i){e0(e.exports,"Buffer",()=>r,e=>r=e),e0(e.exports,"INSPECT_MAX_BYTES",()=>n,e=>n=e);var r,n,o=e5("cK8LV"),a=e5("7y6mg");let s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function l(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let i=new Uint8Array(e);return Object.setPrototypeOf(i,h.prototype),i}function h(e,i,r){if("number"==typeof e){if("string"==typeof i)throw TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,i,r)}function u(e,i,r){if("string"==typeof e){var n=e,o=i;if(("string"!=typeof o||""===o)&&(o="utf8"),!h.isEncoding(o))throw TypeError("Unknown encoding: "+o);let r=0|g(n,o),a=l(r),s=a.write(n,o);return s!==r&&(a=a.slice(0,s)),a}if(ArrayBuffer.isView(e)){var a=e;if(N(a,Uint8Array)){let e=new Uint8Array(a);return f(e.buffer,e.byteOffset,e.byteLength)}return p(a)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return f(e,i,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return h.from(s,i,r);let u=function(e){if(h.isBuffer(e)){let i=0|m(e.length),r=l(i);return 0===r.length||e.copy(r,0,0,i),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?l(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(u)return u;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return h.from(e[Symbol.toPrimitive]("string"),i,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return c(e),l(e<0?0:0|m(e))}function p(e){let i=e.length<0?0:0|m(e.length),r=l(i);for(let n=0;n<i;n+=1)r[n]=255&e[n];return r}function f(e,i,r){let n;if(i<0||e.byteLength<i)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<i+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===i&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,i):new Uint8Array(e,i,r),h.prototype),n}function m(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function g(e,i){if(h.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let o=!1;for(;;)switch(i){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(o)return n?-1:z(e).length;i=(""+i).toLowerCase(),o=!0}}function _(e,i,r){let n=!1;if((void 0===i||i<0)&&(i=0),i>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(i>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,i,r){let n=e.length;(!i||i<0)&&(i=0),(!r||r<0||r>n)&&(r=n);let o="";for(let n=i;n<r;++n)o+=j[e[n]];return o}(this,i,r);case"utf8":case"utf-8":return b(this,i,r);case"ascii":return function(e,i,r){let n="";r=Math.min(e.length,r);for(let o=i;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}(this,i,r);case"latin1":case"binary":return function(e,i,r){let n="";r=Math.min(e.length,r);for(let o=i;o<r;++o)n+=String.fromCharCode(e[o]);return n}(this,i,r);case"base64":var a,s,l;return a=this,s=i,l=r,0===s&&l===a.length?o.fromByteArray(a):o.fromByteArray(a.slice(s,l));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,i,r){let n=e.slice(i,r),o="";for(let e=0;e<n.length-1;e+=2)o+=String.fromCharCode(n[e]+256*n[e+1]);return o}(this,i,r);default:if(n)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function y(e,i,r){let n=e[i];e[i]=e[r],e[r]=n}function v(e,i,r,n,o){var a;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(a=r*=1)!=a&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(o)return -1;else r=e.length-1;else if(r<0)if(!o)return -1;else r=0;if("string"==typeof i&&(i=h.from(i,n)),h.isBuffer(i))return 0===i.length?-1:x(e,i,r,n,o);if("number"==typeof i){if(i&=255,"function"==typeof Uint8Array.prototype.indexOf)if(o)return Uint8Array.prototype.indexOf.call(e,i,r);else return Uint8Array.prototype.lastIndexOf.call(e,i,r);return x(e,[i],r,n,o)}throw TypeError("val must be string, number or Buffer")}function x(e,i,r,n,o){let a,s=1,l=e.length,h=i.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||i.length<2)return -1;s=2,l/=2,h/=2,r/=2}function u(e,i){return 1===s?e[i]:e.readUInt16BE(i*s)}if(o){let n=-1;for(a=r;a<l;a++)if(u(e,a)===u(i,-1===n?0:a-n)){if(-1===n&&(n=a),a-n+1===h)return n*s}else -1!==n&&(a-=a-n),n=-1}else for(r+h>l&&(r=l-h),a=r;a>=0;a--){let r=!0;for(let n=0;n<h;n++)if(u(e,a+n)!==u(i,n)){r=!1;break}if(r)return a}return -1}function b(e,i,r){r=Math.min(e.length,r);let n=[],o=i;for(;o<r;){let i=e[o],a=null,s=i>239?4:i>223?3:i>191?2:1;if(o+s<=r){let r,n,l,h;switch(s){case 1:i<128&&(a=i);break;case 2:(192&(r=e[o+1]))==128&&(h=(31&i)<<6|63&r)>127&&(a=h);break;case 3:r=e[o+1],n=e[o+2],(192&r)==128&&(192&n)==128&&(h=(15&i)<<12|(63&r)<<6|63&n)>2047&&(h<55296||h>57343)&&(a=h);break;case 4:r=e[o+1],n=e[o+2],l=e[o+3],(192&r)==128&&(192&n)==128&&(192&l)==128&&(h=(15&i)<<18|(63&r)<<12|(63&n)<<6|63&l)>65535&&h<1114112&&(a=h)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),o+=s}var a=n;let s=a.length;if(s<=4096)return String.fromCharCode.apply(String,a);let l="",h=0;for(;h<s;)l+=String.fromCharCode.apply(String,a.slice(h,h+=4096));return l}function w(e,i,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+i>r)throw RangeError("Trying to access beyond buffer length")}function T(e,i,r,n,o,a){if(!h.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(i>o||i<a)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function S(e,i,r,n,o){O(i,n,o,e,r,7);let a=Number(i&BigInt(0xffffffff));e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a;let s=Number(i>>BigInt(32)&BigInt(0xffffffff));return e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,r}function E(e,i,r,n,o){O(i,n,o,e,r,7);let a=Number(i&BigInt(0xffffffff));e[r+7]=a,a>>=8,e[r+6]=a,a>>=8,e[r+5]=a,a>>=8,e[r+4]=a;let s=Number(i>>BigInt(32)&BigInt(0xffffffff));return e[r+3]=s,s>>=8,e[r+2]=s,s>>=8,e[r+1]=s,s>>=8,e[r]=s,r+8}function I(e,i,r,n,o,a){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function C(e,i,r,n,o){return i*=1,r>>>=0,o||I(e,i,r,4,34028234663852886e22,-34028234663852886e22),a.write(e,i,r,n,23,4),r+4}function A(e,i,r,n,o){return i*=1,r>>>=0,o||I(e,i,r,8,17976931348623157e292,-17976931348623157e292),a.write(e,i,r,n,52,8),r+8}r=h,n=50,h.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(e,i),42===e.foo()}catch(e){return!1}}(),h.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(e,i,r){return u(e,i,r)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(e,i,r){return(c(e),e<=0)?l(e):void 0!==i?"string"==typeof r?l(e).fill(i,r):l(e).fill(i):l(e)},h.allocUnsafe=function(e){return d(e)},h.allocUnsafeSlow=function(e){return d(e)},h.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==h.prototype},h.compare=function(e,i){if(N(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),N(i,Uint8Array)&&(i=h.from(i,i.offset,i.byteLength)),!h.isBuffer(e)||!h.isBuffer(i))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===i)return 0;let r=e.length,n=i.length;for(let o=0,a=Math.min(r,n);o<a;++o)if(e[o]!==i[o]){r=e[o],n=i[o];break}return r<n?-1:+(n<r)},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,i){let r;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);if(void 0===i)for(r=0,i=0;r<e.length;++r)i+=e[r].length;let n=h.allocUnsafe(i),o=0;for(r=0;r<e.length;++r){let i=e[r];if(N(i,Uint8Array))o+i.length>n.length?(h.isBuffer(i)||(i=h.from(i)),i.copy(n,o)):Uint8Array.prototype.set.call(n,i,o);else if(h.isBuffer(i))i.copy(n,o);else throw TypeError('"list" argument must be an Array of Buffers');o+=i.length}return n},h.byteLength=g,h.prototype._isBuffer=!0,h.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<e;i+=2)y(this,i,i+1);return this},h.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<e;i+=4)y(this,i,i+3),y(this,i+1,i+2);return this},h.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<e;i+=8)y(this,i,i+7),y(this,i+1,i+6),y(this,i+2,i+5),y(this,i+3,i+4);return this},h.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):_.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(e){if(!h.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){let e="",i=n;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},s&&(h.prototype[s]=h.prototype.inspect),h.prototype.compare=function(e,i,r,n,o){if(N(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),i<0||r>e.length||n<0||o>this.length)throw RangeError("out of range index");if(n>=o&&i>=r)return 0;if(n>=o)return -1;if(i>=r)return 1;if(i>>>=0,r>>>=0,n>>>=0,o>>>=0,this===e)return 0;let a=o-n,s=r-i,l=Math.min(a,s),u=this.slice(n,o),c=e.slice(i,r);for(let e=0;e<l;++e)if(u[e]!==c[e]){a=u[e],s=c[e];break}return a<s?-1:+(s<a)},h.prototype.includes=function(e,i,r){return -1!==this.indexOf(e,i,r)},h.prototype.indexOf=function(e,i,r){return v(this,e,i,r,!0)},h.prototype.lastIndexOf=function(e,i,r){return v(this,e,i,r,!1)},h.prototype.write=function(e,i,r,n){var o,a,s,l,h,u,c,d;if(void 0===i)n="utf8",r=this.length,i=0;else if(void 0===r&&"string"==typeof i)n=i,r=this.length,i=0;else if(isFinite(i))i>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let p=this.length-i;if((void 0===r||r>p)&&(r=p),e.length>0&&(r<0||i<0)||i>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let f=!1;for(;;)switch(n){case"hex":return function(e,i,r,n){let o;r=Number(r)||0;let a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;let s=i.length;for(n>s/2&&(n=s/2),o=0;o<n;++o){var l;let n=parseInt(i.substr(2*o,2),16);if((l=n)!=l)break;e[r+o]=n}return o}(this,e,i,r);case"utf8":case"utf-8":return o=i,a=r,B(z(e,this.length-o),this,o,a);case"ascii":case"latin1":case"binary":return s=i,l=r,B(function(e){let i=[];for(let r=0;r<e.length;++r)i.push(255&e.charCodeAt(r));return i}(e),this,s,l);case"base64":return h=i,u=r,B(F(e),this,h,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=i,d=r,B(function(e,i){let r,n,o=[];for(let a=0;a<e.length&&!((i-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,o.push(r%256),o.push(n);return o}(e,this.length-c),this,c,d);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(e,i){let r=this.length;e=~~e,i=void 0===i?r:~~i,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),i<0?(i+=r)<0&&(i=0):i>r&&(i=r),i<e&&(i=e);let n=this.subarray(e,i);return Object.setPrototypeOf(n,h.prototype),n},h.prototype.readUintLE=h.prototype.readUIntLE=function(e,i,r){e>>>=0,i>>>=0,r||w(e,i,this.length);let n=this[e],o=1,a=0;for(;++a<i&&(o*=256);)n+=this[e+a]*o;return n},h.prototype.readUintBE=h.prototype.readUIntBE=function(e,i,r){e>>>=0,i>>>=0,r||w(e,i,this.length);let n=this[e+--i],o=1;for(;i>0&&(o*=256);)n+=this[e+--i]*o;return n},h.prototype.readUint8=h.prototype.readUInt8=function(e,i){return e>>>=0,i||w(e,1,this.length),this[e]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,i){return e>>>=0,i||w(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,i){return e>>>=0,i||w(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,i){return e>>>=0,i||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,i){return e>>>=0,i||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readBigUInt64LE=V(function(e){k(e>>>=0,"offset");let i=this[e],r=this[e+7];(void 0===i||void 0===r)&&L(e,this.length-8);let n=i+256*this[++e]+65536*this[++e]+0x1000000*this[++e],o=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*r;return BigInt(n)+(BigInt(o)<<BigInt(32))}),h.prototype.readBigUInt64BE=V(function(e){k(e>>>=0,"offset");let i=this[e],r=this[e+7];(void 0===i||void 0===r)&&L(e,this.length-8);let n=0x1000000*i+65536*this[++e]+256*this[++e]+this[++e],o=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(o)}),h.prototype.readIntLE=function(e,i,r){e>>>=0,i>>>=0,r||w(e,i,this.length);let n=this[e],o=1,a=0;for(;++a<i&&(o*=256);)n+=this[e+a]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*i)),n},h.prototype.readIntBE=function(e,i,r){e>>>=0,i>>>=0,r||w(e,i,this.length);let n=i,o=1,a=this[e+--n];for(;n>0&&(o*=256);)a+=this[e+--n]*o;return a>=(o*=128)&&(a-=Math.pow(2,8*i)),a},h.prototype.readInt8=function(e,i){return(e>>>=0,i||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},h.prototype.readInt16LE=function(e,i){e>>>=0,i||w(e,2,this.length);let r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},h.prototype.readInt16BE=function(e,i){e>>>=0,i||w(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},h.prototype.readInt32LE=function(e,i){return e>>>=0,i||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,i){return e>>>=0,i||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readBigInt64LE=V(function(e){k(e>>>=0,"offset");let i=this[e],r=this[e+7];return(void 0===i||void 0===r)&&L(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24))<<BigInt(32))+BigInt(i+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),h.prototype.readBigInt64BE=V(function(e){k(e>>>=0,"offset");let i=this[e],r=this[e+7];return(void 0===i||void 0===r)&&L(e,this.length-8),(BigInt((i<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+r)}),h.prototype.readFloatLE=function(e,i){return e>>>=0,i||w(e,4,this.length),a.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,i){return e>>>=0,i||w(e,4,this.length),a.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,i){return e>>>=0,i||w(e,8,this.length),a.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,i){return e>>>=0,i||w(e,8,this.length),a.read(this,e,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,i,r,n){if(e*=1,i>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;T(this,e,i,r,n,0)}let o=1,a=0;for(this[i]=255&e;++a<r&&(o*=256);)this[i+a]=e/o&255;return i+r},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,i,r,n){if(e*=1,i>>>=0,r>>>=0,!n){let n=Math.pow(2,8*r)-1;T(this,e,i,r,n,0)}let o=r-1,a=1;for(this[i+o]=255&e;--o>=0&&(a*=256);)this[i+o]=e/a&255;return i+r},h.prototype.writeUint8=h.prototype.writeUInt8=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,1,255,0),this[i]=255&e,i+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,2,65535,0),this[i]=255&e,this[i+1]=e>>>8,i+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,2,65535,0),this[i]=e>>>8,this[i+1]=255&e,i+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,4,0xffffffff,0),this[i+3]=e>>>24,this[i+2]=e>>>16,this[i+1]=e>>>8,this[i]=255&e,i+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,4,0xffffffff,0),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=255&e,i+4},h.prototype.writeBigUInt64LE=V(function(e,i=0){return S(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeBigUInt64BE=V(function(e,i=0){return E(this,e,i,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeIntLE=function(e,i,r,n){if(e*=1,i>>>=0,!n){let n=Math.pow(2,8*r-1);T(this,e,i,r,n-1,-n)}let o=0,a=1,s=0;for(this[i]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[i+o-1]&&(s=1),this[i+o]=(e/a|0)-s&255;return i+r},h.prototype.writeIntBE=function(e,i,r,n){if(e*=1,i>>>=0,!n){let n=Math.pow(2,8*r-1);T(this,e,i,r,n-1,-n)}let o=r-1,a=1,s=0;for(this[i+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[i+o+1]&&(s=1),this[i+o]=(e/a|0)-s&255;return i+r},h.prototype.writeInt8=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,1,127,-128),e<0&&(e=255+e+1),this[i]=255&e,i+1},h.prototype.writeInt16LE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,2,32767,-32768),this[i]=255&e,this[i+1]=e>>>8,i+2},h.prototype.writeInt16BE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,2,32767,-32768),this[i]=e>>>8,this[i+1]=255&e,i+2},h.prototype.writeInt32LE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,4,0x7fffffff,-0x80000000),this[i]=255&e,this[i+1]=e>>>8,this[i+2]=e>>>16,this[i+3]=e>>>24,i+4},h.prototype.writeInt32BE=function(e,i,r){return e*=1,i>>>=0,r||T(this,e,i,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[i]=e>>>24,this[i+1]=e>>>16,this[i+2]=e>>>8,this[i+3]=255&e,i+4},h.prototype.writeBigInt64LE=V(function(e,i=0){return S(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeBigInt64BE=V(function(e,i=0){return E(this,e,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeFloatLE=function(e,i,r){return C(this,e,i,!0,r)},h.prototype.writeFloatBE=function(e,i,r){return C(this,e,i,!1,r)},h.prototype.writeDoubleLE=function(e,i,r){return A(this,e,i,!0,r)},h.prototype.writeDoubleBE=function(e,i,r){return A(this,e,i,!1,r)},h.prototype.copy=function(e,i,r,n){if(!h.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),i>=e.length&&(i=e.length),i||(i=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(i<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-i<n-r&&(n=e.length-i+r);let o=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(i,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),i),o},h.prototype.fill=function(e,i,r,n){let o;if("string"==typeof e){if("string"==typeof i?(n=i,i=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){let i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(i<0||this.length<i||this.length<r)throw RangeError("Out of range index");if(r<=i)return this;if(i>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=i;o<r;++o)this[o]=e;else{let a=h.isBuffer(e)?e:h.from(e,n),s=a.length;if(0===s)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-i;++o)this[o+i]=a[o%s]}return this};let R={};function M(e,i,r){R[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:i.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function P(e){let i="",r=e.length,n=+("-"===e[0]);for(;r>=n+4;r-=3)i=`_${e.slice(r-3,r)}${i}`;return`${e.slice(0,r)}${i}`}function O(e,i,r,n,o,a){if(e>r||e<i){let n,o="bigint"==typeof i?"n":"";throw n=a>3?0===i||i===BigInt(0)?`>= 0${o} and < 2${o} ** ${(a+1)*8}${o}`:`>= -(2${o} ** ${(a+1)*8-1}${o}) and < 2 ** ${(a+1)*8-1}${o}`:`>= ${i}${o} and <= ${r}${o}`,new R.ERR_OUT_OF_RANGE("value",n,e)}k(o,"offset"),(void 0===n[o]||void 0===n[o+a])&&L(o,n.length-(a+1))}function k(e,i){if("number"!=typeof e)throw new R.ERR_INVALID_ARG_TYPE(i,"number",e)}function L(e,i,r){if(Math.floor(e)!==e)throw k(e,r),new R.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(i<0)throw new R.ERR_BUFFER_OUT_OF_BOUNDS;throw new R.ERR_OUT_OF_RANGE(r||"offset",`>= ${+!!r} and <= ${i}`,e)}M("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),M("ERR_INVALID_ARG_TYPE",function(e,i){return`The "${e}" argument must be of type number. Received type ${typeof i}`},TypeError),M("ERR_OUT_OF_RANGE",function(e,i,r){let n=`The value of "${e}" is out of range.`,o=r;return Number.isInteger(r)&&Math.abs(r)>0x100000000?o=P(String(r)):"bigint"==typeof r&&(o=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(o=P(o)),o+="n"),n+=` It must be ${i}. Received ${o}`},RangeError);let D=/[^+/0-9A-Za-z-_]/g;function z(e,i){let r;i=i||1/0;let n=e.length,o=null,a=[];for(let s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!o){if(r>56319||s+1===n){(i-=3)>-1&&a.push(239,191,189);continue}o=r;continue}if(r<56320){(i-=3)>-1&&a.push(239,191,189),o=r;continue}r=(o-55296<<10|r-56320)+65536}else o&&(i-=3)>-1&&a.push(239,191,189);if(o=null,r<128){if((i-=1)<0)break;a.push(r)}else if(r<2048){if((i-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((i-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((i-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function F(e){return o.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,i,r,n){let o;for(o=0;o<n&&!(o+r>=i.length)&&!(o>=e.length);++o)i[o+r]=e[o];return o}function N(e,i){return e instanceof i||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===i.name}let j=function(){let e="0123456789abcdef",i=Array(256);for(let r=0;r<16;++r){let n=16*r;for(let o=0;o<16;++o)i[n+o]=e[r]+e[o]}return i}();function V(e){return"undefined"==typeof BigInt?U:e}function U(){throw Error("BigInt not supported")}}),e4("cK8LV",function(e,i){e0(e.exports,"toByteArray",()=>r,e=>r=e),e0(e.exports,"fromByteArray",()=>n,e=>n=e);for(var r=function(e){var i,r,n=function(e){var i=e.length;if(i%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=i);var n=r===i?0:4-r%4;return[r,n]}(e),o=n[0],l=n[1],h=new s((o+l)*3/4-l),u=0,c=l>0?o-4:o;for(r=0;r<c;r+=4)i=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],h[u++]=i>>16&255,h[u++]=i>>8&255,h[u++]=255&i;return 2===l&&(i=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,h[u++]=255&i),1===l&&(i=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,h[u++]=i>>8&255,h[u++]=255&i),h},n=function(e){for(var i,r=e.length,n=r%3,a=[],s=0,l=r-n;s<l;s+=16383)a.push(function(e,i,r){for(var n,a=[],s=i;s<r;s+=3)n=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(o[n>>18&63]+o[n>>12&63]+o[n>>6&63]+o[63&n]);return a.join("")}(e,s,s+16383>l?l:s+16383));return 1===n?a.push(o[(i=e[r-1])>>2]+o[i<<4&63]+"=="):2===n&&a.push(o[(i=(e[r-2]<<8)+e[r-1])>>10]+o[i>>4&63]+o[i<<2&63]+"="),a.join("")},o=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,u=l.length;h<u;++h)o[h]=l[h],a[l.charCodeAt(h)]=h;a[45]=62,a[95]=63}),e4("7y6mg",function(e,i){var r,n;e0(e.exports,"read",()=>r,e=>r=e),e0(e.exports,"write",()=>n,e=>n=e),r=function(e,i,r,n,o){var a,s,l=8*o-n-1,h=(1<<l)-1,u=h>>1,c=-7,d=r?o-1:0,p=r?-1:1,f=e[i+d];for(d+=p,a=f&(1<<-c)-1,f>>=-c,c+=l;c>0;a=256*a+e[i+d],d+=p,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[i+d],d+=p,c-=8);if(0===a)a=1-u;else{if(a===h)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=u}return(f?-1:1)*s*Math.pow(2,a-n)},n=function(e,i,r,n,o,a){var s,l,h,u=8*a-o-1,c=(1<<u)-1,d=c>>1,p=5960464477539062e-23*(23===o),f=n?0:a-1,m=n?1:-1,g=+(i<0||0===i&&1/i<0);for(isNaN(i=Math.abs(i))||i===1/0?(l=+!!isNaN(i),s=c):(s=Math.floor(Math.log(i)/Math.LN2),i*(h=Math.pow(2,-s))<1&&(s--,h*=2),s+d>=1?i+=p/h:i+=p*Math.pow(2,1-d),i*h>=2&&(s++,h/=2),s+d>=c?(l=0,s=c):s+d>=1?(l=(i*h-1)*Math.pow(2,o),s+=d):(l=i*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[r+f]=255&l,f+=m,l/=256,o-=8);for(s=s<<o|l,u+=o;u>0;e[r+f]=255&s,f+=m,s/=256,u-=8);e[r+f-m]|=128*g}}),e4("f9AGe",function(e,i){!function(r){var n=e&&e.exports==i&&e,o="object"==typeof eQ&&eQ;(o.global===o||o.window===o)&&(r=o);var a=function(e){this.message=e};a.prototype=Error(),a.prototype.name="InvalidCharacterError";var s=function(e){throw new a(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=/[\t\n\f\r ]/g,u={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var i,r,n,o=e.length%3,a="",h=-1,u=e.length-o;++h<u;)i=e.charCodeAt(h)<<16,n=i+(r=e.charCodeAt(++h)<<8)+e.charCodeAt(++h),a+=l.charAt(n>>18&63)+l.charAt(n>>12&63)+l.charAt(n>>6&63)+l.charAt(63&n);return 2==o?(n=(i=e.charCodeAt(h)<<8)+(r=e.charCodeAt(++h)),a+=l.charAt(n>>10)+l.charAt(n>>4&63)+l.charAt(n<<2&63)+"="):1==o&&(n=e.charCodeAt(h),a+=l.charAt(n>>2)+l.charAt(n<<4&63)+"=="),a},decode:function(e){var i,r,n=(e=String(e).replace(h,"")).length;n%4==0&&(n=(e=e.replace(/==?$/,"")).length),(n%4==1||/[^+a-zA-Z0-9/]/.test(e))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var o=0,a="",u=-1;++u<n;)r=l.indexOf(e.charAt(u)),i=o%4?64*i+r:r,o++%4&&(a+=String.fromCharCode(255&i>>(-2*o&6)));return a},version:"0.1.0"};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return u});else if(i&&!i.nodeType)if(n)n.exports=u;else for(var c in u)u.hasOwnProperty(c)&&(i[c]=u[c]);else r.base64=u}(this)});var e6={DEGREES:"degrees",FEET:"ft",METERS:"m",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},e8={};e8[e6.DEGREES]=2*Math.PI*6370997/360,e8[e6.FEET]=.3048,e8[e6.METERS]=1,e8[e6.USFEET]=1200/3937;var e9=function(){function e(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}return e.prototype.canWrapX=function(){return this.canWrapX_},e.prototype.getCode=function(){return this.code_},e.prototype.getExtent=function(){return this.extent_},e.prototype.getUnits=function(){return this.units_},e.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||e8[this.units_]},e.prototype.getWorldExtent=function(){return this.worldExtent_},e.prototype.getAxisOrientation=function(){return this.axisOrientation_},e.prototype.isGlobal=function(){return this.global_},e.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)},e.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},e.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},e.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)},e.prototype.setWorldExtent=function(e){this.worldExtent_=e},e.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},e.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},e}();function e7(e,i,r){return Math.min(Math.max(e,i),r)}var te="cosh"in Math?Math.cosh:function(e){var i=Math.exp(e);return(i+1/i)/2},tt="log2"in Math?Math.log2:function(e){return Math.log(e)*Math.LOG2E};function ti(e,i,r,n){var o=r-e,a=n-i;return o*o+a*a}function tr(e){return e*Math.PI/180}function tn(e,i){var r=e%i;return r*i<0?r+i:r}var to=(o=function(e,i){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ta=6378137*Math.PI,ts=[-ta,-ta,ta,ta],tl=[-180,-85,180,85],th=function(e){function i(i){return e.call(this,{code:i,units:e6.METERS,extent:ts,global:!0,worldExtent:tl,getPointResolution:function(e,i){return e/te(i[1]/6378137)}})||this}return to(i,e),i}(e9),tu=[new th("EPSG:3857"),new th("EPSG:102100"),new th("EPSG:102113"),new th("EPSG:900913"),new th("urn:ogc:def:crs:EPSG:6.18:3:3857"),new th("urn:ogc:def:crs:EPSG::3857"),new th("http://www.opengis.net/gml/srs/epsg.xml#3857")],tc=(a=function(e,i){return(a=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}a(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),td=[-180,-90,180,90],tp=6378137*Math.PI/180,tf=function(e){function i(i,r){return e.call(this,{code:i,units:e6.DEGREES,extent:td,axisOrientation:r,global:!0,metersPerUnit:tp,worldExtent:td})||this}return tc(i,e),i}(e9),tm=[new tf("CRS:84"),new tf("EPSG:4326","neu"),new tf("urn:ogc:def:crs:EPSG::4326","neu"),new tf("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new tf("urn:ogc:def:crs:OGC:1.3:CRS84"),new tf("urn:ogc:def:crs:OGC:2:84"),new tf("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new tf("urn:x-ogc:def:crs:EPSG:4326","neu")],tg={},t_="function"==typeof Object.assign?Object.assign:function(e,i){if(null==e)throw TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1,o=arguments.length;n<o;++n){var a=arguments[n];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(r[s]=a[s])}return r};function ty(e){for(var i in e)delete e[i]}var tv="function"==typeof Object.values?Object.values:function(e){var i=[];for(var r in e)i.push(e[r]);return i};function tx(e){var i;for(i in e)return!1;return!i}var tb={};function tw(e,i,r){var n=e.getCode(),o=i.getCode();n in tb||(tb[n]={}),tb[n][o]=r}var tT={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},tS={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function tE(){throw Error("Unimplemented abstract method.")}var tI=0;function tC(e){return e.ol_uid||(e.ol_uid=String(++tI))}var tA=(s=function(e,i){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}s(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),tR=function(e){function i(i){var r=this,n="Assertion failed. See https://openlayers.org/en/v"+"6.4.3".split("-")[0]+"/doc/errors/#"+i+" for details.";return(r=e.call(this,n)||this).code=i,r.name="AssertionError",r.message=n,r}return tA(i,e),i}(Error);function tM(e,i){if(!e)throw new tR(i)}function tP(e){for(var i=tN(),r=0,n=e.length;r<n;++r)t$(i,e[r]);return i}function tO(e,i,r){return r?(r[0]=e[0]-i,r[1]=e[1]-i,r[2]=e[2]+i,r[3]=e[3]+i,r):[e[0]-i,e[1]-i,e[2]+i,e[3]+i]}function tk(e,i){return i?(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i):e.slice()}function tL(e,i,r){var n,o;return(n=i<e[0]?e[0]-i:e[2]<i?i-e[2]:0)*n+(o=r<e[1]?e[1]-r:e[3]<r?r-e[3]:0)*o}function tD(e,i){return tF(e,i[0],i[1])}function tz(e,i){return e[0]<=i[0]&&i[2]<=e[2]&&e[1]<=i[1]&&i[3]<=e[3]}function tF(e,i,r){return e[0]<=i&&i<=e[2]&&e[1]<=r&&r<=e[3]}function tB(e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=i[0],l=i[1],h=tS.UNKNOWN;return s<r?h|=tS.LEFT:s>o&&(h|=tS.RIGHT),l<n?h|=tS.BELOW:l>a&&(h|=tS.ABOVE),h===tS.UNKNOWN&&(h=tS.INTERSECTING),h}function tN(){return[1/0,1/0,-1/0,-1/0]}function tj(e,i,r,n,o){return o?(o[0]=e,o[1]=i,o[2]=r,o[3]=n,o):[e,i,r,n]}function tV(e){return tj(1/0,1/0,-1/0,-1/0,e)}function tU(e,i){var r=e[0],n=e[1];return tj(r,n,r,n,i)}function tG(e,i){return e[0]==i[0]&&e[2]==i[2]&&e[1]==i[1]&&e[3]==i[3]}function tq(e,i){return i[0]<e[0]&&(e[0]=i[0]),i[2]>e[2]&&(e[2]=i[2]),i[1]<e[1]&&(e[1]=i[1]),i[3]>e[3]&&(e[3]=i[3]),e}function t$(e,i){i[0]<e[0]&&(e[0]=i[0]),i[0]>e[2]&&(e[2]=i[0]),i[1]<e[1]&&(e[1]=i[1]),i[1]>e[3]&&(e[3]=i[1])}function tH(e,i,r,n,o){for(;r<n;r+=o){var a,s,l;a=e,s=i[r],l=i[r+1],a[0]=Math.min(a[0],s),a[1]=Math.min(a[1],l),a[2]=Math.max(a[2],s),a[3]=Math.max(a[3],l)}return e}function tZ(e,i){var r;return!!((r=i(tX(e)))||(r=i(tY(e)))||(r=i(t2(e)))||(r=i(t1(e))))&&r}function tW(e){var i=0;return t4(e)||(i=t3(e)*tQ(e)),i}function tX(e){return[e[0],e[1]]}function tY(e){return[e[2],e[1]]}function tK(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function tJ(e,i,r,n,o){var a=i*n[0]/2,s=i*n[1]/2,l=Math.cos(r),h=Math.sin(r),u=a*l,c=a*h,d=s*l,p=s*h,f=e[0],m=e[1],g=f-u+p,_=f-u-p,y=f+u-p,v=f+u+p,x=m-c-d,b=m-c+d,w=m+c+d,T=m+c-d;return tj(Math.min(g,_,y,v),Math.min(x,b,w,T),Math.max(g,_,y,v),Math.max(x,b,w,T),o)}function tQ(e){return e[3]-e[1]}function t0(e,i,r){var n=r||tN();return t5(e,i)?(e[0]>i[0]?n[0]=e[0]:n[0]=i[0],e[1]>i[1]?n[1]=e[1]:n[1]=i[1],e[2]<i[2]?n[2]=e[2]:n[2]=i[2],e[3]<i[3]?n[3]=e[3]:n[3]=i[3]):tV(n),n}function t1(e){return[e[0],e[3]]}function t2(e){return[e[2],e[3]]}function t3(e){return e[2]-e[0]}function t5(e,i){return e[0]<=i[2]&&e[2]>=i[0]&&e[1]<=i[3]&&e[3]>=i[1]}function t4(e){return e[2]<e[0]||e[3]<e[1]}function t6(e,i,r,n){var o=[];if(n>1)for(var a=e[2]-e[0],s=e[3]-e[1],l=0;l<n;++l)o.push(e[0]+a*l/n,e[1],e[2],e[1]+s*l/n,e[2]-a*l/n,e[3],e[0],e[3]-s*l/n);else o=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];i(o,o,2);for(var h=[],u=[],l=0,c=o.length;l<c;l+=2)h.push(o[l]),u.push(o[l+1]);return tj(Math.min.apply(null,h),Math.min.apply(null,u),Math.max.apply(null,h),Math.max.apply(null,u),r)}var t8={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};function t9(e,i,r){var n=tr(e[1]),o=tr(i[1]),a=(o-n)/2,s=tr(i[0]-e[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(o);return 2*(r||6371008.8)*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function t7(e,i){for(var r=!0,n=e.length-1;n>=0;--n)if(e[n]!=i[n]){r=!1;break}return r}function ie(e,i){var r=Math.cos(i),n=Math.sin(i),o=e[0]*r-e[1]*n,a=e[1]*r+e[0]*n;return e[0]=o,e[1]=a,e}function it(e,i){if(i.canWrapX()){var r=t3(i.getExtent()),n=function(e,i,r){var n=i.getExtent(),o=0;if(i.canWrapX()&&(e[0]<n[0]||e[0]>n[2])){var a=r||t3(n);o=Math.floor((e[0]-n[0])/a)}return o}(e,i,r);n&&(e[0]-=n*r)}return e}function ii(e,i,r){var n;if(void 0!==i){for(var o=0,a=e.length;o<a;++o)i[o]=e[o];n=i}else n=e.slice();return n}function ir(e,i,r){if(void 0!==i&&e!==i){for(var n=0,o=e.length;n<o;++n)i[n]=e[n];e=i}return e}function io(e){var i;i=e.getCode(),tg[i]=e,tw(e,e,ii)}function ia(e){return"string"==typeof e?tg[e]||null:e||null}function is(e,i,r,n){var o,a=(e=ia(e)).getPointResolutionFunc();if(a){if(o=a(i,r),n&&n!==e.getUnits()){var s=e.getMetersPerUnit();s&&(o=o*s/e8[n])}}else if((e.getUnits()!=e6.DEGREES||n)&&n!=e6.DEGREES){var l=id(e,ia("EPSG:4326")),h=[r[0]-i/2,r[1],r[0]+i/2,r[1],r[0],r[1]-i/2,r[0],r[1]+i/2];o=(t9((h=l(h,h,2)).slice(0,2),h.slice(2,4))+t9(h.slice(4,6),h.slice(6,8)))/2;var s=n?e8[n]:e.getMetersPerUnit();void 0!==s&&(o/=s)}else o=i;return o}function il(e){e.forEach(io),e.forEach(function(i){e.forEach(function(e){i!==e&&tw(i,e,ii)})})}function ih(e,i){return e?"string"==typeof e?ia(e):e:ia(i)}function iu(e,i){return im(e,"EPSG:4326",void 0!==i?i:"EPSG:3857")}function ic(e,i){if(e===i)return!0;var r=e.getUnits()===i.getUnits();return e.getCode()===i.getCode()?r:id(e,i)===ii&&r}function id(e,i){var r,n=e.getCode(),o=i.getCode(),a=(n in tb&&o in tb[n]&&(r=tb[n][o]),r);return a||(a=ir),a}function ip(e,i){return id(ia(e),ia(i))}function im(e,i,r){return ip(i,r)(e,void 0,e.length)}function ig(e,i,r,n){return t6(e,ip(i,r),void 0,n)}var i_=null;function iy(e,i){return i_?im(e,i,i_):e}function iv(e,i){return i_?im(e,i_,i):e}function ix(e,i){return i_?ig(e,i,i_):e}function ib(e,i){return i_?ig(e,i_,i):e}il(tu),il(tm),l=function(e,i,r){var n=e.length,o=r>1?r:2,a=i;void 0===a&&(a=o>2?e.slice():Array(n));for(var s=0;s<n;s+=o){a[s]=ta*e[s]/180;var l=6378137*Math.log(Math.tan(Math.PI*(+e[s+1]+90)/360));l>ta?l=ta:l<-ta&&(l=-ta),a[s+1]=l}return a},h=function(e,i,r){var n=e.length,o=r>1?r:2,a=i;void 0===a&&(a=o>2?e.slice():Array(n));for(var s=0;s<n;s+=o)a[s]=180*e[s]/ta,a[s+1]=360*Math.atan(Math.exp(e[s+1]/6378137))/Math.PI-90;return a},tm.forEach(function(e){tu.forEach(function(i){tw(e,i,l),tw(i,e,h)})});var iw=function(){function e(e){this.propagationStopped,this.type=e,this.target=null}return e.prototype.preventDefault=function(){this.propagationStopped=!0},e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}(),iT={PROPERTYCHANGE:"propertychange"},iS=function(){function e(){this.disposed=!1}return e.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},e.prototype.disposeInternal=function(){},e}();function iE(e,i){return e>i?1:e<i?-1:0}function iI(e,i,r){var n=e.length;if(e[0]<=i)return 0;if(i<=e[n-1])return n-1;var o=void 0;if(r>0){for(o=1;o<n;++o)if(e[o]<i)return o-1}else if(r<0){for(o=1;o<n;++o)if(e[o]<=i)return o}else for(o=1;o<n;++o)if(e[o]==i)return o;else if(e[o]<i)if(e[o-1]-i<i-e[o])return o-1;else return o;return n-1}function iC(e,i){for(var r=Array.isArray(i)?i:[i],n=r.length,o=0;o<n;o++)e[e.length]=r[o]}function iA(e,i){var r=e.length;if(r!==i.length)return!1;for(var n=0;n<r;n++)if(e[n]!==i[n])return!1;return!0}function iR(){return!0}function iM(){return!1}function iP(){}var iO=(u=function(e,i){return(u=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}u(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ik=function(e){function i(i){var r=e.call(this)||this;return r.eventTarget_=i,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return iO(i,e),i.prototype.addEventListener=function(e,i){if(e&&i){var r=this.listeners_||(this.listeners_={}),n=r[e]||(r[e]=[]);-1===n.indexOf(i)&&n.push(i)}},i.prototype.dispatchEvent=function(e){var i,r="string"==typeof e?new iw(e):e,n=r.type;r.target||(r.target=this.eventTarget_||this);var o=this.listeners_&&this.listeners_[n];if(o){var a=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,s[n]=0),++a[n];for(var l=0,h=o.length;l<h;++l)if(!1===(i="handleEvent"in o[l]?o[l].handleEvent(r):o[l].call(this,r))||r.propagationStopped){i=!1;break}if(--a[n],0===a[n]){var u=s[n];for(delete s[n];u--;)this.removeEventListener(n,iP);delete a[n]}return i}},i.prototype.disposeInternal=function(){this.listeners_&&ty(this.listeners_)},i.prototype.getListeners=function(e){return this.listeners_&&this.listeners_[e]||void 0},i.prototype.hasListener=function(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)},i.prototype.removeEventListener=function(e,i){var r=this.listeners_&&this.listeners_[e];if(r){var n=r.indexOf(i);-1!==n&&(this.pendingRemovals_&&e in this.pendingRemovals_?(r[n]=iP,++this.pendingRemovals_[e]):(r.splice(n,1),0===r.length&&delete this.listeners_[e]))}},i}(iS),iL={CHANGE:"change",ERROR:"error",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function iD(e,i,r,n,o){if(n&&n!==e&&(r=r.bind(n)),o){var a=r;r=function(){e.removeEventListener(i,r),a.apply(this,arguments)}}var s={target:e,type:i,listener:r};return e.addEventListener(i,r),s}function iz(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),ty(e))}var iF=(c=function(e,i){return(c=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}c(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),iB=function(e){function i(){var i=e.call(this)||this;return i.revision_=0,i}return iF(i,e),i.prototype.changed=function(){++this.revision_,this.dispatchEvent(iL.CHANGE)},i.prototype.getRevision=function(){return this.revision_},i.prototype.on=function(e,i){if(!Array.isArray(e))return iD(this,e,i);for(var r=e.length,n=Array(r),o=0;o<r;++o)n[o]=iD(this,e[o],i);return n},i.prototype.once=function(e,i){if(Array.isArray(e)){var r,n=e.length;r=Array(n);for(var o=0;o<n;++o){r[o]=iD(this,e[o],i,void 0,!0)}}else r=iD(this,e,i,void 0,!0);return i.ol_key=r,r},i.prototype.un=function(e,i){var r=i.ol_key;if(r)iN(r);else if(Array.isArray(e))for(var n=0,o=e.length;n<o;++n)this.removeEventListener(e[n],i);else this.removeEventListener(e,i)},i}(ik);function iN(e){if(Array.isArray(e))for(var i=0,r=e.length;i<r;++i)iz(e[i]);else iz(e)}var ij=(d=function(e,i){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}d(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),iV=function(e){function i(i,r,n){var o=e.call(this,i)||this;return o.key=r,o.oldValue=n,o}return ij(i,e),i}(iw),iU=function(e){function i(i){var r=e.call(this)||this;return tC(r),r.values_=null,void 0!==i&&r.setProperties(i),r}return ij(i,e),i.prototype.get=function(e){var i;return this.values_&&this.values_.hasOwnProperty(e)&&(i=this.values_[e]),i},i.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},i.prototype.getProperties=function(){return this.values_&&t_({},this.values_)||{}},i.prototype.hasProperties=function(){return!!this.values_},i.prototype.notify=function(e,i){var r;r=iq(e),this.dispatchEvent(new iV(r,e,i)),r=iT.PROPERTYCHANGE,this.dispatchEvent(new iV(r,e,i))},i.prototype.set=function(e,i,r){var n=this.values_||(this.values_={});if(r)n[e]=i;else{var o=n[e];n[e]=i,o!==i&&this.notify(e,o)}},i.prototype.setProperties=function(e,i){for(var r in e)this.set(r,e[r],i)},i.prototype.unset=function(e,i){if(this.values_&&e in this.values_){var r=this.values_[e];delete this.values_[e],tx(this.values_)&&(this.values_=null),i||this.notify(e,r)}},i}(iB),iG={};function iq(e){return iG.hasOwnProperty(e)?iG[e]:iG[e]="change:"+e}var i$={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},iH={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},iZ="ol-hidden",iW="ol-unselectable",iX="ol-control",iY="ol-collapsed",iK=RegExp("^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$","i"),iJ=["style","variant","weight","size","lineHeight","family"],iQ=function(e){var i=e.match(iK);if(!i)return null;for(var r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,o=iJ.length;n<o;++n){var a=i[n+1];void 0!==a&&(r[iJ[n]]=a)}return r.families=r.family.split(/,\s?/),r},i0="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",i1=-1!==i0.indexOf("firefox");-1!==i0.indexOf("safari")&&i0.indexOf("chrom");var i2=-1!==i0.indexOf("webkit")&&-1==i0.indexOf("edge"),i3=-1!==i0.indexOf("macintosh"),i5="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,i4="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,i6="undefined"!=typeof Image&&Image.prototype.decode,i8=function(){var e=!1;try{var i=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch(e){}return e}();function i9(e,i,r){var n=r&&r.length?r.shift():i4?new OffscreenCanvas(e||300,i||300):document.createElement("canvas");return e&&(n.width=e),i&&(n.height=i),n.getContext("2d")}function i7(e,i){var r=i.parentNode;r&&r.replaceChild(e,i)}function re(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function rt(e){for(;e.lastChild;)e.removeChild(e.lastChild)}var ri=(p=function(e,i){return(p=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}p(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),rr={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},rn=function(e){function i(i){var r=e.call(this)||this;r.options=i,r.id=i.id,r.insertFirst=void 0===i.insertFirst||i.insertFirst,r.stopEvent=void 0===i.stopEvent||i.stopEvent,r.element=document.createElement("div"),r.element.className=void 0!==i.className?i.className:"ol-overlay-container ol-selectable",r.element.style.position="absolute",r.element.style.pointerEvents="auto";var n=i.autoPan;return n&&"object"!=typeof n&&(n={animation:i.autoPanAnimation,margin:i.autoPanMargin}),r.autoPan=n||!1,r.rendered={transform_:"",visible:!0},r.mapPostrenderListenerKey=null,r.addEventListener(iq(rr.ELEMENT),r.handleElementChanged),r.addEventListener(iq(rr.MAP),r.handleMapChanged),r.addEventListener(iq(rr.OFFSET),r.handleOffsetChanged),r.addEventListener(iq(rr.POSITION),r.handlePositionChanged),r.addEventListener(iq(rr.POSITIONING),r.handlePositioningChanged),void 0!==i.element&&r.setElement(i.element),r.setOffset(void 0!==i.offset?i.offset:[0,0]),r.setPositioning(void 0!==i.positioning?i.positioning:iH.TOP_LEFT),void 0!==i.position&&r.setPosition(i.position),r}return ri(i,e),i.prototype.getElement=function(){return this.get(rr.ELEMENT)},i.prototype.getId=function(){return this.id},i.prototype.getMap=function(){return this.get(rr.MAP)},i.prototype.getOffset=function(){return this.get(rr.OFFSET)},i.prototype.getPosition=function(){return this.get(rr.POSITION)},i.prototype.getPositioning=function(){return this.get(rr.POSITIONING)},i.prototype.handleElementChanged=function(){rt(this.element);var e=this.getElement();e&&this.element.appendChild(e)},i.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(re(this.element),iz(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var e=this.getMap();if(e){this.mapPostrenderListenerKey=iD(e,i$.POSTRENDER,this.render,this),this.updatePixelPosition();var i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}},i.prototype.render=function(){this.updatePixelPosition()},i.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},i.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},i.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},i.prototype.setElement=function(e){this.set(rr.ELEMENT,e)},i.prototype.setMap=function(e){this.set(rr.MAP,e)},i.prototype.setOffset=function(e){this.set(rr.OFFSET,e)},i.prototype.setPosition=function(e){this.set(rr.POSITION,e)},i.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},i.prototype.panIntoView=function(e){var i=this.getMap();if(i&&i.getTargetElement()&&this.get(rr.POSITION)){var r,n,o,a,s=this.getRect(i.getTargetElement(),i.getSize()),l=this.getElement(),h=this.getRect(l,[r=l.offsetWidth+(parseInt((n=getComputedStyle(l)).marginLeft,10)+parseInt(n.marginRight,10)),o=l.offsetHeight+(parseInt((a=getComputedStyle(l)).marginTop,10)+parseInt(a.marginBottom,10))]),u=e||{},c=void 0===u.margin?20:u.margin;if(!tz(s,h)){var d=h[0]-s[0],p=s[2]-h[2],f=h[1]-s[1],m=s[3]-h[3],g=[0,0];if(d<0?g[0]=d-c:p<0&&(g[0]=Math.abs(p)+c),f<0?g[1]=f-c:m<0&&(g[1]=Math.abs(m)+c),0!==g[0]||0!==g[1]){var _=i.getView().getCenterInternal(),y=i.getPixelFromCoordinateInternal(_),v=[y[0]+g[0],y[1]+g[1]],x=u.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(v),duration:x.duration,easing:x.easing})}}}},i.prototype.getRect=function(e,i){var r=e.getBoundingClientRect(),n=r.left+window.pageXOffset,o=r.top+window.pageYOffset;return[n,o,n+i[0],o+i[1]]},i.prototype.setPositioning=function(e){this.set(rr.POSITIONING,e)},i.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)},i.prototype.updatePixelPosition=function(){var e=this.getMap(),i=this.getPosition();if(!e||!e.isRendered()||!i)return void this.setVisible(!1);var r=e.getPixelFromCoordinate(i),n=e.getSize();this.updateRenderedPosition(r,n)},i.prototype.updateRenderedPosition=function(e,i){var r=this.element.style,n=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var a=Math.round(e[0]+n[0])+"px",s=Math.round(e[1]+n[1])+"px",l="0%",h="0%";o==iH.BOTTOM_RIGHT||o==iH.CENTER_RIGHT||o==iH.TOP_RIGHT?l="-100%":(o==iH.BOTTOM_CENTER||o==iH.CENTER_CENTER||o==iH.TOP_CENTER)&&(l="-50%"),o==iH.BOTTOM_LEFT||o==iH.BOTTOM_CENTER||o==iH.BOTTOM_RIGHT?h="-100%":(o==iH.CENTER_LEFT||o==iH.CENTER_CENTER||o==iH.CENTER_RIGHT)&&(h="-50%");var u="translate("+l+", "+h+") translate("+a+", "+s+")";this.rendered.transform_!=u&&(this.rendered.transform_=u,r.transform=u,r.msTransform=u)},i.prototype.getOptions=function(){return this.options},i}(iU),ro="opacity",ra="visible",rs="extent",rl="zIndex",rh="maxResolution",ru="minResolution",rc="maxZoom",rd="minZoom",rp="source",rf=(f=function(e,i){return(f=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}f(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),rm=function(e){function i(i){var r=e.call(this)||this,n=t_({},i);return n[ro]=void 0!==i.opacity?i.opacity:1,tM("number"==typeof n[ro],64),n[ra]=void 0===i.visible||i.visible,n[rl]=i.zIndex,n[rh]=void 0!==i.maxResolution?i.maxResolution:1/0,n[ru]=void 0!==i.minResolution?i.minResolution:0,n[rd]=void 0!==i.minZoom?i.minZoom:-1/0,n[rc]=void 0!==i.maxZoom?i.maxZoom:1/0,r.className_=void 0!==n.className?i.className:"ol-layer",delete n.className,r.setProperties(n),r.state_=null,r}return rf(i,e),i.prototype.getClassName=function(){return this.className_},i.prototype.getLayerState=function(e){var i=this.state_||{layer:this,managed:void 0===e||e},r=this.getZIndex();return i.opacity=e7(Math.round(100*this.getOpacity())/100,0,1),i.sourceState=this.getSourceState(),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=void 0!==r?r:!1===i.managed?1/0:0,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i,i},i.prototype.getLayersArray=function(e){return tE()},i.prototype.getLayerStatesArray=function(e){return tE()},i.prototype.getExtent=function(){return this.get(rs)},i.prototype.getMaxResolution=function(){return this.get(rh)},i.prototype.getMinResolution=function(){return this.get(ru)},i.prototype.getMinZoom=function(){return this.get(rd)},i.prototype.getMaxZoom=function(){return this.get(rc)},i.prototype.getOpacity=function(){return this.get(ro)},i.prototype.getSourceState=function(){return tE()},i.prototype.getVisible=function(){return this.get(ra)},i.prototype.getZIndex=function(){return this.get(rl)},i.prototype.setExtent=function(e){this.set(rs,e)},i.prototype.setMaxResolution=function(e){this.set(rh,e)},i.prototype.setMinResolution=function(e){this.set(ru,e)},i.prototype.setMaxZoom=function(e){this.set(rc,e)},i.prototype.setMinZoom=function(e){this.set(rd,e)},i.prototype.setOpacity=function(e){tM("number"==typeof e,64),this.set(ro,e)},i.prototype.setVisible=function(e){this.set(ra,e)},i.prototype.setZIndex=function(e){this.set(rl,e)},i.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),e.prototype.disposeInternal.call(this)},i}(iU),rg={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},r_={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},ry=(m=function(e,i){return(m=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}m(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),rv=function(e){function i(i){var r=this,n=t_({},i);delete n.source,(r=e.call(this,n)||this).mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,i.render&&(r.render=i.render),i.map&&r.setMap(i.map),r.addEventListener(iq(rp),r.handleSourcePropertyChange_);var o=i.source?i.source:null;return r.setSource(o),r}return ry(i,e),i.prototype.getLayersArray=function(e){var i=e||[];return i.push(this),i},i.prototype.getLayerStatesArray=function(e){var i=e||[];return i.push(this.getLayerState()),i},i.prototype.getSource=function(){return this.get(rp)||null},i.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():r_.UNDEFINED},i.prototype.handleSourceChange_=function(){this.changed()},i.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(iz(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=iD(e,iL.CHANGE,this.handleSourceChange_,this)),this.changed()},i.prototype.getFeatures=function(e){return this.renderer_.getFeatures(e)},i.prototype.render=function(e,i){var r=this.getRenderer();if(r.prepareFrame(e))return r.renderFrame(e,i)},i.prototype.setMap=function(e){this.mapPrecomposeKey_&&(iz(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(iz(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=iD(e,rg.PRECOMPOSE,function(e){var i=e.frameState.layerStatesArray,r=this.getLayerState(!1);tM(!i.some(function(e){return e.layer===r.layer}),67),i.push(r)},this),this.mapRenderKey_=iD(this,iL.CHANGE,e.render,e),this.changed())},i.prototype.setSource=function(e){this.set(rp,e)},i.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},i.prototype.hasRenderer=function(){return!!this.renderer_},i.prototype.createRenderer=function(){return null},i.prototype.disposeInternal=function(){this.setSource(null),e.prototype.disposeInternal.call(this)},i}(rm);function rx(e,i){if(!e.visible)return!1;var r=i.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;var n=i.zoom;return n>e.minZoom&&n<=e.maxZoom}var rb={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function rw(e,i){return Array.isArray(e)?e:(void 0===i?i=[e,e]:(i[0]=e,i[1]=e),i)}var rT=function(){function e(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=rw(e.scale),this.displacement_=e.displacement}return e.prototype.clone=function(){var i=this.getScale();return new e({opacity:this.getOpacity(),scale:Array.isArray(i)?i.slice():i,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},e.prototype.getOpacity=function(){return this.opacity_},e.prototype.getRotateWithView=function(){return this.rotateWithView_},e.prototype.getRotation=function(){return this.rotation_},e.prototype.getScale=function(){return this.scale_},e.prototype.getScaleArray=function(){return this.scaleArray_},e.prototype.getDisplacement=function(){return this.displacement_},e.prototype.getAnchor=function(){return tE()},e.prototype.getImage=function(e){return tE()},e.prototype.getHitDetectionImage=function(){return tE()},e.prototype.getPixelRatio=function(e){return 1},e.prototype.getImageState=function(){return tE()},e.prototype.getImageSize=function(){return tE()},e.prototype.getHitDetectionImageSize=function(){return tE()},e.prototype.getOrigin=function(){return tE()},e.prototype.getSize=function(){return tE()},e.prototype.setOpacity=function(e){this.opacity_=e},e.prototype.setRotateWithView=function(e){this.rotateWithView_=e},e.prototype.setRotation=function(e){this.rotation_=e},e.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=rw(e)},e.prototype.listenImageChange=function(e){tE()},e.prototype.load=function(){tE()},e.prototype.unlistenImageChange=function(e){tE()},e}(),rS=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,rE=/^([a-z]*)$|^hsla?\(.*\)$/i,rI=(g={},_=0,function(e){var i;if(g.hasOwnProperty(e))i=g[e];else{if(_>=1024){var r=0;for(var n in g)(3&r++)==0&&(delete g[n],--_)}i=function(e){var i,r,n,o,a;if(rE.exec(e)&&(e=function(e){var i=document.createElement("div");if(i.style.color=e,""===i.style.color)return"";document.body.appendChild(i);var r=getComputedStyle(i).color;return document.body.removeChild(i),r}(e)),rS.exec(e)){var s=e.length-1,l=void 0;l=s<=4?1:2;var h=4===s||8===s;i=parseInt(e.substr(1+0*l,l),16),r=parseInt(e.substr(1+ +l,l),16),n=parseInt(e.substr(1+2*l,l),16),o=h?parseInt(e.substr(1+3*l,l),16):255,1==l&&(i=(i<<4)+i,r=(r<<4)+r,n=(n<<4)+n,h&&(o=(o<<4)+o)),a=[i,r,n,o/255]}else 0==e.indexOf("rgba(")?rA(a=e.slice(5,-1).split(",").map(Number)):0==e.indexOf("rgb(")?((a=e.slice(4,-1).split(",").map(Number)).push(1),rA(a)):tM(!1,14);return a}(e),g[e]=i,++_}return i});function rC(e){return Array.isArray(e)?e:rI(e)}function rA(e){return e[0]=e7(e[0]+.5|0,0,255),e[1]=e7(e[1]+.5|0,0,255),e[2]=e7(e[2]+.5|0,0,255),e[3]=e7(e[3],0,1),e}function rR(e){var i=e[0];i!=(0|i)&&(i=i+.5|0);var r=e[1];r!=(0|r)&&(r=r+.5|0);var n=e[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+i+","+r+","+n+","+(void 0===e[3]?1:e[3])+")"}function rM(e){return Array.isArray(e)?rR(e):e}var rP=Array(6);function rO(){return[1,0,0,1,0,0]}function rk(e){return rD(e,1,0,0,1,0,0)}function rL(e,i){var r=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],h=i[0],u=i[1],c=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*h+o*u,e[1]=n*h+a*u,e[2]=r*c+o*d,e[3]=n*c+a*d,e[4]=r*p+o*f+s,e[5]=n*p+a*f+l,e}function rD(e,i,r,n,o,a,s){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=a,e[5]=s,e}function rz(e,i){var r=i[0],n=i[1];return i[0]=e[0]*r+e[2]*n+e[4],i[1]=e[1]*r+e[3]*n+e[5],i}function rF(e,i,r){return rL(e,rD(rP,i,0,0,r,0,0))}function rB(e,i,r,n,o,a,s,l){var h=Math.sin(a),u=Math.cos(a);return e[0]=n*u,e[1]=o*h,e[2]=-n*h,e[3]=o*u,e[4]=s*n*u-l*n*h+i,e[5]=s*o*h+l*o*u+r,e}function rN(e,i){var r,n=(r=i)[0]*r[3]-r[1]*r[2];tM(0!==n,32);var o=i[0],a=i[1],s=i[2],l=i[3],h=i[4],u=i[5];return e[0]=l/n,e[1]=-a/n,e[2]=-s/n,e[3]=o/n,e[4]=(s*u-l*h)/n,e[5]=-(o*u-a*h)/n,e}function rj(e){return"matrix("+e.join(", ")+")"}var rV="10px sans-serif",rU="#000",rG="round",rq=[],r$="round",rH="#000",rZ="center",rW="middle",rX=[0,0,0,0],rY=new iU,rK=new ik;rK.setSize=function(){console.warn("labelCache is deprecated.")};var rJ=null,rQ={},r0=function(){var e,i,r="32px ",n=["monospace","serif"],o=n.length,a="wmytzilWMYTZIL@#/&?$%10ï";function s(e,s,l){for(var h=!0,u=0;u<o;++u){var c=n[u];if(i=r3(e+" "+s+" "+r+c,a),l!=c){var d=r3(e+" "+s+" "+r+l+","+c,a);h=h&&d!=i}}return!!h}function l(){for(var i=!0,r=rY.getKeys(),n=0,o=r.length;n<o;++n){var a=r[n];100>rY.get(a)&&(s.apply(this,a.split("\n"))?(ty(rQ),rJ=null,eH=void 0,rY.set(a,100)):(rY.set(a,rY.get(a)+1,!0),i=!1))}i&&(clearInterval(e),e=void 0)}return function(i){var r=iQ(i);if(r)for(var n=r.families,o=0,a=n.length;o<a;++o){var h=n[o],u=r.style+"\n"+r.weight+"\n"+h;void 0===rY.get(u)&&(rY.set(u,100,!0),s(r.style,r.weight,h)||(rY.set(u,0,!0),void 0===e&&(e=setInterval(l,32))))}}}(),r1=function(e){var i=rQ[e];if(void 0==i)if(i4){var r=iQ(e),n=r2(e,"Å½g"),o=isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight);rQ[e]=o*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else y||((y=document.createElement("div")).innerHTML="M",y.style.margin="0 !important",y.style.padding="0 !important",y.style.position="absolute !important",y.style.left="-99999px !important"),y.style.font=e,document.body.appendChild(y),i=y.offsetHeight,rQ[e]=i,document.body.removeChild(y);return i};function r2(e,i){return rJ||(rJ=i9(1,1)),e!=eH&&(rJ.font=e,eH=rJ.font),rJ.measureText(i)}function r3(e,i){return r2(e,i).width}function r5(e,i,r){if(i in r)return r[i];var n=r3(e,i);return r[i]=n,n}function r4(e,i,r,n){0!==i&&(e.translate(r,n),e.rotate(i),e.translate(-r,-n))}function r6(e,i,r,n,o,a,s,l,h,u,c){e.save(),1!==r&&(e.globalAlpha*=r),i&&e.setTransform.apply(e,i),n.contextInstructions?(e.translate(h,u),e.scale(c[0],c[1]),function(e,i){for(var r=e.contextInstructions,n=0,o=r.length;n<o;n+=2)Array.isArray(r[n+1])?i[r[n]].apply(i,r[n+1]):i[r[n]]=r[n+1]}(n,e)):c[0]<0||c[1]<0?(e.translate(h,u),e.scale(c[0],c[1]),e.drawImage(n,o,a,s,l,0,0,s,l)):e.drawImage(n,o,a,s,l,h,u,s*c[0],l*c[1]),e.restore()}var r8=null,r9=(v=function(e,i){return(v=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}v(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),r7=function(e){function i(i){var r=this,n=void 0!==i.rotateWithView&&i.rotateWithView;return(r=e.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==i.rotation?i.rotation:0,scale:1,displacement:void 0!==i.displacement?i.displacement:[0,0]})||this).canvas_={},r.hitDetectionCanvas_=null,r.fill_=void 0!==i.fill?i.fill:null,r.origin_=[0,0],r.points_=i.points,r.radius_=void 0!==i.radius?i.radius:i.radius1,r.radius2_=i.radius2,r.angle_=void 0!==i.angle?i.angle:0,r.stroke_=void 0!==i.stroke?i.stroke:null,r.anchor_=null,r.size_=null,r.imageSize_=null,r.hitDetectionImageSize_=null,r.render(),r}return r9(i,e),i.prototype.clone=function(){var e=new i({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},i.prototype.getAnchor=function(){return this.anchor_},i.prototype.getAngle=function(){return this.angle_},i.prototype.getFill=function(){return this.fill_},i.prototype.getHitDetectionImage=function(){if(!this.hitDetectionCanvas_){var e=this.createRenderOptions();this.createHitDetectionCanvas_(e)}return this.hitDetectionCanvas_},i.prototype.getImage=function(e){if(!this.canvas_[e||1]){var i=this.createRenderOptions(),r=i9(i.size*e||1,i.size*e||1);this.draw_(i,r,0,0,e||1),this.canvas_[e||1]=r.canvas}return this.canvas_[e||1]},i.prototype.getPixelRatio=function(e){return e},i.prototype.getImageSize=function(){return this.imageSize_},i.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},i.prototype.getImageState=function(){return rb.LOADED},i.prototype.getOrigin=function(){return this.origin_},i.prototype.getPoints=function(){return this.points_},i.prototype.getRadius=function(){return this.radius_},i.prototype.getRadius2=function(){return this.radius2_},i.prototype.getSize=function(){return this.size_},i.prototype.getStroke=function(){return this.stroke_},i.prototype.listenImageChange=function(e){},i.prototype.load=function(){},i.prototype.unlistenImageChange=function(e){},i.prototype.createRenderOptions=function(){var e,i=rG,r=r$,n=0,o=null,a=0,s=0;this.stroke_&&(null===(e=this.stroke_.getColor())&&(e=rH),e=rM(e),void 0===(s=this.stroke_.getWidth())&&(s=1),o=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset(),void 0===(r=this.stroke_.getLineJoin())&&(r=r$),void 0===(i=this.stroke_.getLineCap())&&(i=rG),void 0===(n=this.stroke_.getMiterLimit())&&(n=10));var l=2*(this.radius_+s)+1;return{strokeStyle:e,strokeWidth:s,size:l,lineCap:i,lineDash:o,lineDashOffset:a,lineJoin:r,miterLimit:n}},i.prototype.render=function(){var e=this.createRenderOptions(),i=i9(e.size,e.size);this.draw_(e,i,0,0,1),this.canvas_[1]=i.canvas;var r=i.canvas.width,n=this.getDisplacement();this.hitDetectionImageSize_=[e.size,e.size],this.createHitDetectionCanvas_(e),this.anchor_=[r/2-n[0],r/2+n[1]],this.size_=[r,r],this.imageSize_=[r,r]},i.prototype.draw_=function(e,i,r,n,o){i.setTransform(o,0,0,o,0,0),i.translate(r,n),i.beginPath();var a,s,l,h=this.points_;if(h===1/0)i.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{var u=void 0!==this.radius2_?this.radius2_:this.radius_;for(u!==this.radius_&&(h*=2),a=0;a<=h;a++)s=2*a*Math.PI/h-Math.PI/2+this.angle_,l=a%2==0?this.radius_:u,i.lineTo(e.size/2+l*Math.cos(s),e.size/2+l*Math.sin(s))}if(this.fill_){var c=this.fill_.getColor();null===c&&(c=rU),i.fillStyle=rM(c),i.fill()}this.stroke_&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,i.setLineDash&&e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineCap=e.lineCap,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,i.stroke()),i.closePath()},i.prototype.createHitDetectionCanvas_=function(e){if(this.hitDetectionCanvas_=this.getImage(1),this.fill_){var i=this.fill_.getColor(),r=0;if("string"==typeof i&&(i=rC(i)),null===i?r=1:Array.isArray(i)&&(r=4===i.length?i[3]:1),0===r){var n=i9(e.size,e.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(e,n,0,0)}}},i.prototype.drawHitDetectionCanvas_=function(e,i,r,n){i.translate(r,n),i.beginPath();var o=this.points_;if(o===1/0)i.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{var a=void 0!==this.radius2_?this.radius2_:this.radius_;a!==this.radius_&&(o*=2);var s=void 0,l=void 0,h=void 0;for(s=0;s<=o;s++)h=2*s*Math.PI/o-Math.PI/2+this.angle_,l=s%2==0?this.radius_:a,i.lineTo(e.size/2+l*Math.cos(h),e.size/2+l*Math.sin(h))}i.fillStyle=rU,i.fill(),this.stroke_&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.strokeWidth,e.lineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.stroke()),i.closePath()},i}(rT),ne=(x=function(e,i){return(x=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}x(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nt=function(e){function i(i){var r=this,n=i||{};return e.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,displacement:void 0!==n.displacement?n.displacement:[0,0]})||this}return ne(i,e),i.prototype.clone=function(){var e=new i({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},i.prototype.setRadius=function(e){this.radius_=e,this.render()},i}(r7),ni=function(){function e(e){var i=e||{};this.color_=void 0!==i.color?i.color:null}return e.prototype.clone=function(){var i=this.getColor();return new e({color:Array.isArray(i)?i.slice():i||void 0})},e.prototype.getColor=function(){return this.color_},e.prototype.setColor=function(e){this.color_=e},e}(),nr=function(){function e(e){var i=e||{};this.color_=void 0!==i.color?i.color:null,this.lineCap_=i.lineCap,this.lineDash_=void 0!==i.lineDash?i.lineDash:null,this.lineDashOffset_=i.lineDashOffset,this.lineJoin_=i.lineJoin,this.miterLimit_=i.miterLimit,this.width_=i.width}return e.prototype.clone=function(){var i=this.getColor();return new e({color:Array.isArray(i)?i.slice():i||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},e.prototype.getColor=function(){return this.color_},e.prototype.getLineCap=function(){return this.lineCap_},e.prototype.getLineDash=function(){return this.lineDash_},e.prototype.getLineDashOffset=function(){return this.lineDashOffset_},e.prototype.getLineJoin=function(){return this.lineJoin_},e.prototype.getMiterLimit=function(){return this.miterLimit_},e.prototype.getWidth=function(){return this.width_},e.prototype.setColor=function(e){this.color_=e},e.prototype.setLineCap=function(e){this.lineCap_=e},e.prototype.setLineDash=function(e){this.lineDash_=e},e.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e},e.prototype.setLineJoin=function(e){this.lineJoin_=e},e.prototype.setMiterLimit=function(e){this.miterLimit_=e},e.prototype.setWidth=function(e){this.width_=e},e}(),nn=function(){function e(e){var i=e||{};this.geometry_=null,this.geometryFunction_=ns,void 0!==i.geometry&&this.setGeometry(i.geometry),this.fill_=void 0!==i.fill?i.fill:null,this.image_=void 0!==i.image?i.image:null,this.renderer_=void 0!==i.renderer?i.renderer:null,this.stroke_=void 0!==i.stroke?i.stroke:null,this.text_=void 0!==i.text?i.text:null,this.zIndex_=i.zIndex}return e.prototype.clone=function(){var i=this.getGeometry();return i&&"object"==typeof i&&(i=i.clone()),new e({geometry:i,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.setRenderer=function(e){this.renderer_=e},e.prototype.getGeometry=function(){return this.geometry_},e.prototype.getGeometryFunction=function(){return this.geometryFunction_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(e){this.fill_=e},e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(e){this.image_=e},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(e){this.stroke_=e},e.prototype.getText=function(){return this.text_},e.prototype.setText=function(e){this.text_=e},e.prototype.getZIndex=function(){return this.zIndex_},e.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(i){return i.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=ns,this.geometry_=e},e.prototype.setZIndex=function(e){this.zIndex_=e},e}(),no=null;function na(e,i){if(!no){var r=new ni({color:"rgba(255,255,255,0.4)"}),n=new nr({color:"#3399CC",width:1.25});no=[new nn({image:new nt({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return no}function ns(e){return e.getGeometry()}var nl=(b=function(e,i){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}b(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nh="renderOrder",nu=function(e){function i(i){var r=this,n=i||{},o=t_({},n);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,(r=e.call(this,o)||this).declutter_=void 0!==n.declutter&&n.declutter,r.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,r.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,r}return nl(i,e),i.prototype.getDeclutter=function(){return this.declutter_},i.prototype.getFeatures=function(i){return e.prototype.getFeatures.call(this,i)},i.prototype.getRenderBuffer=function(){return this.renderBuffer_},i.prototype.getRenderOrder=function(){return this.get(nh)},i.prototype.getStyle=function(){return this.style_},i.prototype.getStyleFunction=function(){return this.styleFunction_},i.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},i.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},i.prototype.setRenderOrder=function(e){this.set(nh,e)},i.prototype.setStyle=function(e){this.style_=void 0!==e?e:na,this.styleFunction_=null===e?void 0:function(e){if("function"==typeof e)i=e;else{if(Array.isArray(e))r=e;else{var i,r;tM("function"==typeof e.getZIndex,41),r=[e]}i=function(){return r}}return i}(this.style_),this.changed()},i}(rv),nc={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},nd=[nc.FILL],np=[nc.STROKE],nf=[nc.BEGIN_PATH],nm=[nc.CLOSE_PATH],ng=function(){function e(){}return e.prototype.drawCustom=function(e,i,r){},e.prototype.drawGeometry=function(e){},e.prototype.setStyle=function(e){},e.prototype.drawCircle=function(e,i){},e.prototype.drawFeature=function(e,i){},e.prototype.drawGeometryCollection=function(e,i){},e.prototype.drawLineString=function(e,i){},e.prototype.drawMultiLineString=function(e,i){},e.prototype.drawMultiPoint=function(e,i){},e.prototype.drawMultiPolygon=function(e,i){},e.prototype.drawPoint=function(e,i){},e.prototype.drawPolygon=function(e,i){},e.prototype.drawText=function(e,i){},e.prototype.setFillStrokeStyle=function(e,i){},e.prototype.setImageStyle=function(e,i){},e.prototype.setTextStyle=function(e,i){},e}();function n_(e,i,r,n,o){for(var a=void 0!==o?o:[],s=0,l=i;l<r;l+=n)a[s++]=e.slice(l,l+n);return a.length=s,a}function ny(e,i,r,n,o){for(var a=void 0!==o?o:[],s=0,l=0,h=r.length;l<h;++l){var u=r[l];a[s++]=n_(e,i,u,n,a[s]),i=u}return a.length=s,a}function nv(e,i,r,n,o){for(var a=void 0!==o?o:[],s=0,l=0,h=r.length;l<h;++l){var u=r[l];a[s++]=ny(e,i,u,n,a[s]),i=u[u.length-1]}return a.length=s,a}var nx=(w=function(e,i){return(w=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}w(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nb=function(e){function i(i,r,n,o){var a=e.call(this)||this;return a.tolerance=i,a.maxExtent=r,a.pixelRatio=o,a.maxLineWidth=0,a.resolution=n,a.beginGeometryInstruction1_=null,a.beginGeometryInstruction2_=null,a.bufferedMaxExtent_=null,a.instructions=[],a.coordinates=[],a.tmpCoordinate_=[],a.hitDetectionInstructions=[],a.state={},a}return nx(i,e),i.prototype.applyPixelRatio=function(e){var i=this.pixelRatio;return 1==i?e:e.map(function(e){return e*i})},i.prototype.appendFlatCoordinates=function(e,i,r,n,o,a){var s,l,h,u=this.coordinates.length,c=this.getBufferedMaxExtent();a&&(i+=n);var d=e[i],p=e[i+1],f=this.tmpCoordinate_,m=!0;for(s=i+n;s<r;s+=n)f[0]=e[s],f[1]=e[s+1],(h=tB(c,f))!==l?(m&&(this.coordinates[u++]=d,this.coordinates[u++]=p),this.coordinates[u++]=f[0],this.coordinates[u++]=f[1],m=!1):h===tS.INTERSECTING?(this.coordinates[u++]=f[0],this.coordinates[u++]=f[1],m=!1):m=!0,d=f[0],p=f[1],l=h;return(o&&m||s===i+n)&&(this.coordinates[u++]=d,this.coordinates[u++]=p),u},i.prototype.drawCustomCoordinates_=function(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){var l=r[a],h=this.appendFlatCoordinates(e,i,l,n,!1,!1);o.push(h),i=l}return i},i.prototype.drawCustom=function(e,i,r){this.beginGeometry(e,i);var n,o,a,s,l,h=e.getType(),u=e.getStride(),c=this.coordinates.length;if(h==t8.MULTI_POLYGON){n=e.getOrientedFlatCoordinates(),s=[];var d=e.getEndss();l=0;for(var p=0,f=d.length;p<f;++p){var m=[];l=this.drawCustomCoordinates_(n,l,d[p],u,m),s.push(m)}this.instructions.push([nc.CUSTOM,c,s,e,r,nv])}else h==t8.POLYGON||h==t8.MULTI_LINE_STRING?(a=[],n=h==t8.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),l=this.drawCustomCoordinates_(n,0,e.getEnds(),u,a),this.instructions.push([nc.CUSTOM,c,a,e,r,ny])):h==t8.LINE_STRING||h==t8.MULTI_POINT?(n=e.getFlatCoordinates(),o=this.appendFlatCoordinates(n,0,n.length,u,!1,!1),this.instructions.push([nc.CUSTOM,c,o,e,r,n_])):h==t8.POINT&&(n=e.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),o=this.coordinates.length,this.instructions.push([nc.CUSTOM,c,o,e,r]));this.endGeometry(i)},i.prototype.beginGeometry=function(e,i){var r=e.getExtent();this.beginGeometryInstruction1_=[nc.BEGIN_GEOMETRY,i,0,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[nc.BEGIN_GEOMETRY,i,0,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},i.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},i.prototype.reverseHitDetectionInstructions=function(){var e,i,r,n=this.hitDetectionInstructions;n.reverse();var o=n.length,a=-1;for(e=0;e<o;++e)if((r=(i=n[e])[0])==nc.END_GEOMETRY)a=e;else if(r==nc.BEGIN_GEOMETRY){i[2]=e;for(var s=this.hitDetectionInstructions,l=a,h=e;l<h;){var u=s[l];s[l]=s[h],s[h]=u,++l,--h}a=-1}},i.prototype.setFillStrokeStyle=function(e,i){var r=this.state;if(e?r.fillStyle=rM(e.getColor()||rU):r.fillStyle=void 0,i){r.strokeStyle=rM(i.getColor()||rH);var n=i.getLineCap();r.lineCap=void 0!==n?n:rG;var o=i.getLineDash();r.lineDash=o?o.slice():rq,r.lineDashOffset=i.getLineDashOffset()||0;var a=i.getLineJoin();r.lineJoin=void 0!==a?a:r$;var s=i.getWidth();r.lineWidth=void 0!==s?s:1;var l=i.getMiterLimit();r.miterLimit=void 0!==l?l:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},i.prototype.createFill=function(e){var i=e.fillStyle,r=[nc.SET_FILL_STYLE,i];return"string"!=typeof i&&r.push(!0),r},i.prototype.applyStroke=function(e){this.instructions.push(this.createStroke(e))},i.prototype.createStroke=function(e){return[nc.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]},i.prototype.updateFillStyle=function(e,i){var r=e.fillStyle;("string"!=typeof r||e.currentFillStyle!=r)&&(void 0!==r&&this.instructions.push(i.call(this,e)),e.currentFillStyle=r)},i.prototype.updateStrokeStyle=function(e,i){var r=e.strokeStyle,n=e.lineCap,o=e.lineDash,a=e.lineDashOffset,s=e.lineJoin,l=e.lineWidth,h=e.miterLimit;e.currentStrokeStyle==r&&e.currentLineCap==n&&(o==e.currentLineDash||iA(e.currentLineDash,o))&&e.currentLineDashOffset==a&&e.currentLineJoin==s&&e.currentLineWidth==l&&e.currentMiterLimit==h||(void 0!==r&&i.call(this,e),e.currentStrokeStyle=r,e.currentLineCap=n,e.currentLineDash=o,e.currentLineDashOffset=a,e.currentLineJoin=s,e.currentLineWidth=l,e.currentMiterLimit=h)},i.prototype.endGeometry=function(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var i=[nc.END_GEOMETRY,e];this.instructions.push(i),this.hitDetectionInstructions.push(i)},i.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=tk(this.maxExtent),this.maxLineWidth>0)){var e=this.resolution*(this.maxLineWidth+1)/2;tO(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},i}(ng),nw=(T=function(e,i){return(T=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}T(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nT=function(e){function i(i,r,n,o){var a=e.call(this,i,r,n,o)||this;return a.declutterGroups_=null,a.hitDetectionImage_=null,a.image_=null,a.imagePixelRatio_=void 0,a.anchorX_=void 0,a.anchorY_=void 0,a.height_=void 0,a.opacity_=void 0,a.originX_=void 0,a.originY_=void 0,a.rotateWithView_=void 0,a.rotation_=void 0,a.scale_=void 0,a.width_=void 0,a}return nw(i,e),i.prototype.drawCoordinates_=function(e,i,r,n){return this.appendFlatCoordinates(e,i,r,n,!1,!1)},i.prototype.drawPoint=function(e,i){if(this.image_){this.beginGeometry(e,i);var r=e.getFlatCoordinates(),n=e.getStride(),o=this.coordinates.length,a=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([nc.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.hitDetectionInstructions.push([nc.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(i)}},i.prototype.drawMultiPoint=function(e,i){if(this.image_){this.beginGeometry(e,i);var r=e.getFlatCoordinates(),n=e.getStride(),o=this.coordinates.length,a=this.drawCoordinates_(r,0,r.length,n);this.instructions.push([nc.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.hitDetectionInstructions.push([nc.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(i)}},i.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,e.prototype.finish.call(this)},i.prototype.setImageStyle=function(e,i){var r=e.getAnchor(),n=e.getSize(),o=e.getHitDetectionImage(),a=e.getImage(this.pixelRatio),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.declutterGroups_=i,this.hitDetectionImage_=o,this.image_=a,this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0]},i}(nb),nS=(S=function(e,i){return(S=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}S(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nE=function(e){function i(i,r,n,o){return e.call(this,i,r,n,o)||this}return nS(i,e),i.prototype.drawFlatCoordinates_=function(e,i,r,n){var o=this.coordinates.length,a=this.appendFlatCoordinates(e,i,r,n,!1,!1),s=[nc.MOVE_TO_LINE_TO,o,a];return this.instructions.push(s),this.hitDetectionInstructions.push(s),r},i.prototype.drawLineString=function(e,i){var r=this.state,n=r.strokeStyle,o=r.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,i),this.hitDetectionInstructions.push([nc.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],nf);var a=e.getFlatCoordinates(),s=e.getStride();this.drawFlatCoordinates_(a,0,a.length,s),this.hitDetectionInstructions.push(np),this.endGeometry(i)}},i.prototype.drawMultiLineString=function(e,i){var r=this.state,n=r.strokeStyle,o=r.lineWidth;if(void 0!==n&&void 0!==o){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,i),this.hitDetectionInstructions.push([nc.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],nf);for(var a=e.getEnds(),s=e.getFlatCoordinates(),l=e.getStride(),h=0,u=0,c=a.length;u<c;++u)h=this.drawFlatCoordinates_(s,h,a[u],l);this.hitDetectionInstructions.push(np),this.endGeometry(i)}},i.prototype.finish=function(){var i=this.state;return void 0!=i.lastStroke&&i.lastStroke!=this.coordinates.length&&this.instructions.push(np),this.reverseHitDetectionInstructions(),this.state=null,e.prototype.finish.call(this)},i.prototype.applyStroke=function(i){void 0!=i.lastStroke&&i.lastStroke!=this.coordinates.length&&(this.instructions.push(np),i.lastStroke=this.coordinates.length),i.lastStroke=0,e.prototype.applyStroke.call(this,i),this.instructions.push(nf)},i}(nb);function nI(e,i,r,n,o,a,s){var l=(r-i)/n;if(l<3){for(;i<r;i+=n)a[s++]=e[i],a[s++]=e[i+1];return s}var h=Array(l);h[0]=1,h[l-1]=1;for(var u=[i,r-n],c=0;u.length>0;){for(var d=u.pop(),p=u.pop(),f=0,m=e[p],g=e[p+1],_=e[d],y=e[d+1],v=p+n;v<d;v+=n){var x=function(e,i,r,n,o,a){var s=o-r,l=a-n;if(0!==s||0!==l){var h=((e-r)*s+(i-n)*l)/(s*s+l*l);h>1?(r=o,n=a):h>0&&(r+=s*h,n+=l*h)}return ti(e,i,r,n)}(e[v],e[v+1],m,g,_,y);x>f&&(c=v,f=x)}f>o&&(h[(c-i)/n]=1,p+n<c&&u.push(p,c),c+n<d&&u.push(c,d))}for(var v=0;v<l;++v)h[v]&&(a[s++]=e[i+v*n],a[s++]=e[i+v*n+1]);return s}function nC(e,i){return i*Math.round(e/i)}function nA(e,i,r,n,o,a,s,l){for(var h=0,u=r.length;h<u;++h){var c=r[h];s=function(e,i,r,n,o,a,s){if(i==r)return s;var l,h,u=nC(e[i],o),c=nC(e[i+1],o);i+=n,a[s++]=u,a[s++]=c;do if(l=nC(e[i],o),h=nC(e[i+1],o),(i+=n)==r)return a[s++]=l,a[s++]=h,s;while(l==u&&h==c)for(;i<r;){var d=nC(e[i],o),p=nC(e[i+1],o);if(i+=n,d!=l||p!=h){var f=l-u,m=h-c,g=d-u,_=p-c;if(f*_==m*g&&(f<0&&g<f||f==g||f>0&&g>f)&&(m<0&&_<m||m==_||m>0&&_>m)){l=d,h=p;continue}a[s++]=l,a[s++]=h,u=l,c=h,l=d,h=p}}return a[s++]=l,a[s++]=h,s}(e,i,c,n,o,a,s),l.push(s),i=c}return s}var nR=(E=function(e,i){return(E=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}E(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nM=function(e){function i(i,r,n,o){return e.call(this,i,r,n,o)||this}return nR(i,e),i.prototype.drawFlatCoordinatess_=function(e,i,r,n){var o=this.state,a=void 0!==o.fillStyle,s=void 0!==o.strokeStyle,l=r.length;this.instructions.push(nf),this.hitDetectionInstructions.push(nf);for(var h=0;h<l;++h){var u=r[h],c=this.coordinates.length,d=this.appendFlatCoordinates(e,i,u,n,!0,!s),p=[nc.MOVE_TO_LINE_TO,c,d];this.instructions.push(p),this.hitDetectionInstructions.push(p),s&&(this.instructions.push(nm),this.hitDetectionInstructions.push(nm)),i=u}return a&&(this.instructions.push(nd),this.hitDetectionInstructions.push(nd)),s&&(this.instructions.push(np),this.hitDetectionInstructions.push(np)),i},i.prototype.drawCircle=function(e,i){var r=this.state,n=r.fillStyle,o=r.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(e,i),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([nc.SET_FILL_STYLE,rU]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([nc.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var a=e.getFlatCoordinates(),s=e.getStride(),l=this.coordinates.length;this.appendFlatCoordinates(a,0,a.length,s,!1,!1);var h=[nc.CIRCLE,l];this.instructions.push(nf,h),this.hitDetectionInstructions.push(nf,h),void 0!==r.fillStyle&&(this.instructions.push(nd),this.hitDetectionInstructions.push(nd)),void 0!==r.strokeStyle&&(this.instructions.push(np),this.hitDetectionInstructions.push(np)),this.endGeometry(i)}},i.prototype.drawPolygon=function(e,i){var r=this.state,n=r.fillStyle,o=r.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(e,i),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([nc.SET_FILL_STYLE,rU]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([nc.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var a=e.getEnds(),s=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(s,0,a,l),this.endGeometry(i)}},i.prototype.drawMultiPolygon=function(e,i){var r=this.state,n=r.fillStyle,o=r.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(e,i),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([nc.SET_FILL_STYLE,rU]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([nc.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var a=e.getEndss(),s=e.getOrientedFlatCoordinates(),l=e.getStride(),h=0,u=0,c=a.length;u<c;++u)h=this.drawFlatCoordinatess_(s,h,a[u],l);this.endGeometry(i)}},i.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var i=this.tolerance;if(0!==i)for(var r=this.coordinates,n=0,o=r.length;n<o;++n)r[n]=nC(r[n],i);return e.prototype.finish.call(this)},i.prototype.setFillStrokeStyles_=function(){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},i}(nb),nP={POINT:"point",LINE:"line"},nO=(I=function(e,i){return(I=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}I(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nk={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},nL=function(e){function i(i,r,n,o){var a=e.call(this,i,r,n,o)||this;return a.declutterGroups_,a.labels_=null,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=void 0,a.textRotation_=0,a.textFillState_=null,a.fillStates={},a.textStrokeState_=null,a.strokeStates={},a.textState_={},a.textStates={},a.textKey_="",a.fillKey_="",a.strokeKey_="",a}return nO(i,e),i.prototype.finish=function(){var i=e.prototype.finish.call(this);return i.textStates=this.textStates,i.fillStates=this.fillStates,i.strokeStates=this.strokeStates,i},i.prototype.drawText=function(e,i){var r,n,o=this.textFillState_,a=this.textStrokeState_,s=this.textState_;if(""!==this.text_&&s&&(o||a)){var l=this.coordinates.length,h=e.getType(),u=null,c=2,d=e.getStride();if(s.placement===nP.LINE){if(!t5(this.getBufferedMaxExtent(),e.getExtent()))return;var p=void 0;if(u=e.getFlatCoordinates(),h==t8.LINE_STRING)p=[u.length];else if(h==t8.MULTI_LINE_STRING)p=e.getEnds();else if(h==t8.POLYGON)p=e.getEnds().slice(0,1);else if(h==t8.MULTI_POLYGON){var f=e.getEndss();for(r=0,p=[],n=f.length;r<n;++r)p.push(f[r][0])}this.beginGeometry(e,i);for(var m=s.textAlign,g=0,_=void 0,y=0,v=p.length;y<v;++y){if(void 0==m){var x=function(e,i,r,n,o){var a,s,l,h,u,c,d,p,f,m=r,g=r,_=0,y=0,v=r;for(a=r;a<n;a+=o){var x=i[a],b=i[a+1];void 0!==h&&(l=Math.sqrt((p=x-h)*p+(f=b-u)*f),void 0!==c&&(y+=s,Math.acos((c*p+d*f)/(s*l))>e&&(y>_&&(_=y,m=v,g=a),y=0,v=a-o)),s=l,c=p,d=f),h=x,u=b}return(y+=l)>_?[v,a]:[m,g]}(s.maxAngle,u,g,p[y],d);g=x[0],_=x[1]}else _=p[y];for(r=g;r<_;r+=d)this.coordinates.push(u[r],u[r+1]);c=this.coordinates.length,g=p[y];var b=this.declutterGroups_?0===y?this.declutterGroups_[0]:[].concat(this.declutterGroups_[0]):null;this.drawChars_(l,c,b),l=c}this.endGeometry(i)}else{var w=null;switch(!s.overflow&&(w=[]),h){case t8.POINT:case t8.MULTI_POINT:c=(u=e.getFlatCoordinates()).length;break;case t8.LINE_STRING:u=e.getFlatMidpoint();break;case t8.CIRCLE:u=e.getCenter();break;case t8.MULTI_LINE_STRING:u=e.getFlatMidpoints(),d=2,c=u.length;break;case t8.POLYGON:u=e.getFlatInteriorPoint(),s.overflow||w.push(u[2]/this.resolution),d=3;break;case t8.MULTI_POLYGON:var T=e.getFlatInteriorPoints();for(r=0,u=[],n=T.length;r<n;r+=3)s.overflow||w.push(T[r+2]/this.resolution),u.push(T[r],T[r+1]);if(d=2,0==(c=u.length))return}c=this.appendFlatCoordinates(u,0,c,d,!1,!1),this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,i);var S=s.padding;if(S!=rX&&(s.scale[0]<0||s.scale[1]<0)){var E=s.padding[0],I=s.padding[1],C=s.padding[2],A=s.padding[3];s.scale[0]<0&&(I=-I,A=-A),s.scale[1]<0&&(E=-E,C=-C),S=[E,I,C,A]}var R=this.pixelRatio;this.instructions.push([nc.DRAW_IMAGE,l,c,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,S==rX?rX:S.map(function(e){return e*R}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]);var M=1/R;this.hitDetectionInstructions.push([nc.DRAW_IMAGE,l,c,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[M,M],NaN,S,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]),this.endGeometry(i)}}},i.prototype.saveTextStates_=function(){var e=this.textStrokeState_,i=this.textState_,r=this.textFillState_,n=this.strokeKey_;!e||n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash});var o=this.textKey_;o in this.textStates||(this.textStates[o]={font:i.font,textAlign:i.textAlign||rZ,textBaseline:i.textBaseline||rW,scale:i.scale});var a=this.fillKey_;!r||a in this.fillStates||(this.fillStates[a]={fillStyle:r.fillStyle})},i.prototype.drawChars_=function(e,i,r){var n=this.textStrokeState_,o=this.textState_,a=this.strokeKey_,s=this.textKey_,l=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,u=nk[o.textBaseline],c=this.textOffsetY_*h,d=this.text_,p=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([nc.DRAW_CHARS,e,i,u,r,o.overflow,l,o.maxAngle,h,c,a,p*h,d,s,1]),this.hitDetectionInstructions.push([nc.DRAW_CHARS,e,i,u,r,o.overflow,l,o.maxAngle,1,c,a,p,d,s,1/h])},i.prototype.setTextStyle=function(e,i){var r,n,o;if(e){this.declutterGroups_=i;var a=e.getFill();a?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=rM(a.getColor()||rU)):(n=null,this.textFillState_=n);var s=e.getStroke();if(s){(o=this.textStrokeState_)||(o={},this.textStrokeState_=o);var l=s.getLineDash(),h=s.getLineDashOffset(),u=s.getWidth(),c=s.getMiterLimit();o.lineCap=s.getLineCap()||rG,o.lineDash=l?l.slice():rq,o.lineDashOffset=void 0===h?0:h,o.lineJoin=s.getLineJoin()||r$,o.lineWidth=void 0===u?1:u,o.miterLimit=void 0===c?10:c,o.strokeStyle=rM(s.getColor()||rH)}else o=null,this.textStrokeState_=o;r=this.textState_;var d=e.getFont()||rV;r0(d);var p=e.getScaleArray();r.overflow=e.getOverflow(),r.font=d,r.maxAngle=e.getMaxAngle(),r.placement=e.getPlacement(),r.textAlign=e.getTextAlign(),r.textBaseline=e.getTextBaseline()||rW,r.backgroundFill=e.getBackgroundFill(),r.backgroundStroke=e.getBackgroundStroke(),r.padding=e.getPadding()||rX,r.scale=void 0===p?[1,1]:p;var f=e.getOffsetX(),m=e.getOffsetY(),g=e.getRotateWithView(),_=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===m?0:m,this.textRotateWithView_=void 0!==g&&g,this.textRotation_=void 0===_?0:_,this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:tC(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+tC(n.fillStyle):""}else this.text_=""},i}(nb),nD={Circle:nM,Default:nb,Image:nT,LineString:nE,Polygon:nM,Text:nL},nz=function(){function e(e,i,r,n,o){this.declutter_=o,this.declutterGroups_=null,this.tolerance_=e,this.maxExtent_=i,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}return e.prototype.addDeclutter=function(e){var i=null;return this.declutter_&&(e?(i=this.declutterGroups_,i[0][0]++):(i=[[1]],this.declutterGroups_=i)),i},e.prototype.finish=function(){var e={};for(var i in this.buildersByZIndex_){e[i]=e[i]||{};var r=this.buildersByZIndex_[i];for(var n in r){var o=r[n].finish();e[i][n]=o}}return e},e.prototype.getBuilder=function(e,i){var r=void 0!==e?e.toString():"0",n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);var o=n[i];return void 0===o&&(o=new nD[i](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[i]=o),o},e}(),nF=(C=function(e,i){return(C=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}C(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nB=function(e){function i(i){var r=e.call(this)||this;return r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=i,r}return nF(i,e),i.prototype.getFeatures=function(e){return tE()},i.prototype.prepareFrame=function(e){return tE()},i.prototype.renderFrame=function(e,i){return tE()},i.prototype.loadedTileCallback=function(e,i,r){e[i]||(e[i]={}),e[i][r.tileCoord.toString()]=r},i.prototype.createLoadedTileFinder=function(e,i,r){return(function(n,o){var a=this.loadedTileCallback.bind(this,r,n);return e.forEachLoadedTile(i,n,o,a)}).bind(this)},i.prototype.forEachFeatureAtCoordinate=function(e,i,r,n,o){},i.prototype.getDataAtPixel=function(e,i,r){return tE()},i.prototype.getLayer=function(){return this.layer_},i.prototype.handleFontsChanged=function(){},i.prototype.handleImageChange_=function(e){e.target.getState()===rb.LOADED&&this.renderIfReadyAndVisible()},i.prototype.loadImage=function(e){var i=e.getState();return i!=rb.LOADED&&i!=rb.ERROR&&e.addEventListener(iL.CHANGE,this.boundHandleImageChange_),i==rb.IDLE&&(e.load(),i=e.getState()),i==rb.LOADED},i.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&e.getSourceState()==r_.READY&&e.changed()},i}(iB),nN=(A=function(e,i){return(A=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}A(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nj=function(e){function i(i,r,n,o){var a=e.call(this,i)||this;return a.inversePixelTransform=r,a.frameState=n,a.context=o,a}return nN(i,e),i}(iw),nV=(R=function(e,i){return(R=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}R(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),nU=function(e){function i(i){var r=e.call(this,i)||this;return r.container=null,r.renderedResolution,r.tempTransform=rO(),r.pixelTransform=rO(),r.inversePixelTransform=rO(),r.context=null,r.containerReused=!1,r}return nV(i,e),i.prototype.useContainer=function(e,i,r){var n,o,a=this.getLayer().getClassName();if(e&&""===e.style.opacity&&e.className===a){var s=e.firstElementChild;s instanceof HTMLCanvasElement&&(o=s.getContext("2d"))}if(o&&(0===o.canvas.width||o.canvas.style.transform===i)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement("div")).className=a;var l=n.style;l.position="absolute",l.width="100%",l.height="100%";var s=(o=i9()).canvas;n.appendChild(s),(l=s.style).position="absolute",l.left="0",l.transformOrigin="top left",this.container=n,this.context=o}},i.prototype.clip=function(e,i,r){var n=i.pixelRatio,o=i.size[0]*n/2,a=i.size[1]*n/2,s=i.viewState.rotation,l=t1(r),h=t2(r),u=tY(r),c=tX(r);rz(i.coordinateToPixelTransform,l),rz(i.coordinateToPixelTransform,h),rz(i.coordinateToPixelTransform,u),rz(i.coordinateToPixelTransform,c),e.save(),r4(e,-s,o,a),e.beginPath(),e.moveTo(l[0]*n,l[1]*n),e.lineTo(h[0]*n,h[1]*n),e.lineTo(u[0]*n,u[1]*n),e.lineTo(c[0]*n,c[1]*n),e.clip(),r4(e,s,o,a)},i.prototype.clipUnrotated=function(e,i,r){var n=t1(r),o=t2(r),a=tY(r),s=tX(r);rz(i.coordinateToPixelTransform,n),rz(i.coordinateToPixelTransform,o),rz(i.coordinateToPixelTransform,a),rz(i.coordinateToPixelTransform,s);var l=this.inversePixelTransform;rz(l,n),rz(l,o),rz(l,a),rz(l,s),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.clip()},i.prototype.dispatchRenderEvent_=function(e,i,r){var n=this.getLayer();if(n.hasListener(e)){var o=new nj(e,this.inversePixelTransform,r,i);n.dispatchEvent(o)}},i.prototype.preRender=function(e,i){this.dispatchRenderEvent_(rg.PRERENDER,e,i)},i.prototype.postRender=function(e,i){this.dispatchRenderEvent_(rg.POSTRENDER,e,i)},i.prototype.getRenderTransform=function(e,i,r,n,o,a,s){var l=n/i,h=-e[0]+s,u=-e[1];return rB(this.tempTransform,o/2,a/2,l,-l,-r,h,u)},i.prototype.getDataAtPixel=function(e,i,r){var n,o=rz(this.inversePixelTransform,e.slice()),a=this.context;try{var s=Math.round(o[0]),l=Math.round(o[1]),h=document.createElement("canvas"),u=h.getContext("2d");h.width=1,h.height=1,u.clearRect(0,0,1,1),u.drawImage(a.canvas,s,l,1,1,0,0,1,1),n=u.getImageData(0,0,1,1).data}catch(e){if("SecurityError"===e.name)return new Uint8Array;return n}return 0===n[3]?null:n},i}(nB),nG={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"},nq={};function n$(e,i,r,n,o,a){for(var s=a||[],l=0,h=i;h<r;h+=n){var u=e[h],c=e[h+1];s[l++]=o[0]*u+o[2]*c+o[4],s[l++]=o[1]*u+o[3]*c+o[5]}return a&&s.length!=l&&(s.length=l),s}function nH(e,i,r,n,o,a,s){for(var l=s||[],h=Math.cos(o),u=Math.sin(o),c=a[0],d=a[1],p=0,f=i;f<r;f+=n){var m=e[f]-c,g=e[f+1]-d;l[p++]=c+m*h-g*u,l[p++]=d+m*u+g*h;for(var _=f+2;_<f+n;++_)l[p++]=e[_]}return s&&l.length!=p&&(l.length=p),l}function nZ(e,i,r,n){for(var o=e[i],a=e[i+1],s=0,l=i+n;l<r;l+=n){var h=e[l],u=e[l+1];s+=Math.sqrt((h-o)*(h-o)+(u-a)*(u-a)),o=h,a=u}return s}nq=function(){function e(e,i,r){var n=e[i];e[i]=e[r],e[r]=n}function i(e,i){return e<i?-1:+(e>i)}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,i){o(e,0,e.children.length,i,e)}function o(e,i,r,n,o){o||(o=p(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var s=i;s<r;s++){var l=e.children[s];a(o,e.leaf?n(l):l)}return o}function a(e,i){return e.minX=Math.min(e.minX,i.minX),e.minY=Math.min(e.minY,i.minY),e.maxX=Math.max(e.maxX,i.maxX),e.maxY=Math.max(e.maxY,i.maxY),e}function s(e,i){return e.minX-i.minX}function l(e,i){return e.minY-i.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function c(e,i){return e.minX<=i.minX&&e.minY<=i.minY&&i.maxX<=e.maxX&&i.maxY<=e.maxY}function d(e,i){return i.minX<=e.maxX&&i.minY<=e.maxY&&i.maxX>=e.minX&&i.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(r,n,o,a,s){for(var l=[n,o];l.length;)if(!((o=l.pop())-(n=l.pop())<=a)){var h=n+Math.ceil((o-n)/a/2)*a;(function i(r,n,o,a,s){for(;a>o;){if(a-o>600){var l=a-o+1,h=n-o+1,u=Math.log(l),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(l-c)/l)*(h-l/2<0?-1:1),p=Math.max(o,Math.floor(n-h*c/l+d)),f=Math.min(a,Math.floor(n+(l-h)*c/l+d));i(r,n,p,f,s)}var m=r[n],g=o,_=a;for(e(r,o,n),s(r[a],m)>0&&e(r,o,a);g<_;){for(e(r,g,_),g++,_--;0>s(r[g],m);)g++;for(;s(r[_],m)>0;)_--}0===s(r[o],m)?e(r,o,_):e(r,++_,a),_<=n&&(o=_+1),n<=_&&(a=_-1)}})(r,h,n||0,o||r.length-1,s||i),l.push(n,h,h,o)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var i=this.data,r=[];if(!d(e,i))return r;for(var n=this.toBBox,o=[];i;){for(var a=0;a<i.children.length;a++){var s=i.children[a],l=i.leaf?n(s):s;d(e,l)&&(i.leaf?r.push(s):c(e,l)?this._all(s,r):o.push(s))}i=o.pop()}return r},r.prototype.collides=function(e){var i=this.data;if(!d(e,i))return!1;for(var r=[];i;){for(var n=0;n<i.children.length;n++){var o=i.children[n],a=i.leaf?this.toBBox(o):o;if(d(e,a)){if(i.leaf||c(e,a))return!0;r.push(o)}}i=r.pop()}return!1},r.prototype.load=function(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(var i=0;i<e.length;i++)this.insert(e[i]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(e,i){if(!e)return this;for(var r,n,o,a=this.data,s=this.toBBox(e),l=[],h=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],r=h.pop(),o=!0),a.leaf){var u=function(e,i,r){if(!r)return i.indexOf(e);for(var n=0;n<i.length;n++)if(r(e,i[n]))return n;return -1}(e,a.children,i);if(-1!==u){a.children.splice(u,1),l.push(a),this._condense(l);break}}!o&&!a.leaf&&c(a,s)?(l.push(a),h.push(r),r=0,n=a,a=a.children[0]):n?(r++,a=n.children[r],o=!1):a=null}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,i){return e.minX-i.minX},r.prototype.compareMinY=function(e,i){return e.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,i){for(var r=[];e;)e.leaf?i.push.apply(i,e.children):r.push.apply(r,e.children),e=r.pop();return i},r.prototype._build=function(e,i,r,o){var a,s=r-i+1,l=this._maxEntries;if(s<=l)return n(a=p(e.slice(i,r+1)),this.toBBox),a;o||(o=Math.ceil(Math.log(s)/Math.log(l)),l=Math.ceil(s/Math.pow(l,o-1))),(a=p([])).leaf=!1,a.height=o;var h=Math.ceil(s/l),u=h*Math.ceil(Math.sqrt(l));f(e,i,r,u,this.compareMinX);for(var c=i;c<=r;c+=u){var d=Math.min(c+u-1,r);f(e,c,d,h,this.compareMinY);for(var m=c;m<=d;m+=h){var g=Math.min(m+h-1,d);a.children.push(this._build(e,m,g,o-1))}}return n(a,this.toBBox),a},r.prototype._chooseSubtree=function(e,i,r,n){for(;n.push(i),!i.leaf&&n.length-1!==r;){for(var o=1/0,a=1/0,s=void 0,l=0;l<i.children.length;l++){var u,c,d=i.children[l],p=h(d),f=(u=e,(Math.max((c=d).maxX,u.maxX)-Math.min(c.minX,u.minX))*(Math.max(c.maxY,u.maxY)-Math.min(c.minY,u.minY))-p);f<a?(a=f,o=p<o?p:o,s=d):f===a&&p<o&&(o=p,s=d)}i=s||i.children[0]}return i},r.prototype._insert=function(e,i,r){var n=r?e:this.toBBox(e),o=[],s=this._chooseSubtree(n,this.data,i,o);for(s.children.push(e),a(s,n);i>=0;)if(o[i].children.length>this._maxEntries)this._split(o,i),i--;else break;this._adjustParentBBoxes(n,o,i)},r.prototype._split=function(e,i){var r=e[i],o=r.children.length,a=this._minEntries;this._chooseSplitAxis(r,a,o);var s=this._chooseSplitIndex(r,a,o),l=p(r.children.splice(s,r.children.length-s));l.height=r.height,l.leaf=r.leaf,n(r,this.toBBox),n(l,this.toBBox),i?e[i-1].children.push(l):this._splitRoot(r,l)},r.prototype._splitRoot=function(e,i){this.data=p([e,i]),this.data.height=e.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,i,r){for(var n,a=1/0,s=1/0,l=i;l<=r-i;l++){var u=o(e,0,l,this.toBBox),c=o(e,l,r,this.toBBox),d=function(e,i){var r=Math.max(e.minX,i.minX),n=Math.max(e.minY,i.minY);return Math.max(0,Math.min(e.maxX,i.maxX)-r)*Math.max(0,Math.min(e.maxY,i.maxY)-n)}(u,c),p=h(u)+h(c);d<a?(a=d,n=l,s=p<s?p:s):d===a&&p<s&&(s=p,n=l)}return n||r-i},r.prototype._chooseSplitAxis=function(e,i,r){var n=e.leaf?this.compareMinX:s,o=e.leaf?this.compareMinY:l;this._allDistMargin(e,i,r,n)<this._allDistMargin(e,i,r,o)&&e.children.sort(n)},r.prototype._allDistMargin=function(e,i,r,n){e.children.sort(n);for(var s=this.toBBox,l=o(e,0,i,s),h=o(e,r-i,r,s),c=u(l)+u(h),d=i;d<r-i;d++){var p=e.children[d];a(l,e.leaf?s(p):p),c+=u(l)}for(var f=r-i-1;f>=i;f--){var m=e.children[f];a(h,e.leaf?s(m):m),c+=u(h)}return c},r.prototype._adjustParentBBoxes=function(e,i,r){for(var n=r;n>=0;n--)a(i[n],e)},r.prototype._condense=function(e){for(var i=e.length-1,r=void 0;i>=0;i--)0===e[i].children.length?i>0?(r=e[i-1].children).splice(r.indexOf(e[i]),1):this.clear():n(e[i],this.toBBox)},r}();var nW=tN(),nX=rO(),nY=[],nK=[],nJ=[],nQ=[],n0=function(){function e(e,i,r,n,o){this.overlaps=r,this.pixelRatio=i,this.resolution=e,this.alignFill_,this.declutterItems=[],this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderBuffer_=o,this.renderedTransform_=rO(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return e.prototype.createLabel=function(e,i,r,n){var o,a=e+i+r+n;if(this.labels_[a])return this.labels_[a];var s=n?this.strokeStates[n]:null,l=r?this.fillStates[r]:null,h=this.textStates[i],u=this.pixelRatio,c=[h.scale[0]*u,h.scale[1]*u],d=nk[h.textAlign||rZ],p=n&&s.lineWidth?s.lineWidth:0,f=e.split("\n"),m=f.length,g=[],_=function(e,i,r){for(var n=i.length,o=0,a=0;a<n;++a){var s=r3(e,i[a]);o=Math.max(o,s),r.push(s)}return o}(h.font,f,g),y=r1(h.font),v=_+p,x=[],b=(v+2)*c[0],w=(y*m+p)*c[1],T={width:b<0?Math.floor(b):Math.ceil(b),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:x};(1!=c[0]||1!=c[1])&&x.push("scale",c),x.push("font",h.font),n&&(x.push("strokeStyle",s.strokeStyle),x.push("lineWidth",p),x.push("lineCap",s.lineCap),x.push("lineJoin",s.lineJoin),x.push("miterLimit",s.miterLimit),(i4?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(x.push("setLineDash",[s.lineDash]),x.push("lineDashOffset",s.lineDashOffset))),r&&x.push("fillStyle",l.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");var S=.5-d,E=d*v+S*p;if(n)for(o=0;o<m;++o)x.push("strokeText",[f[o],E+S*g[o],.5*(p+y)+o*y]);if(r)for(o=0;o<m;++o)x.push("fillText",[f[o],E+S*g[o],.5*(p+y)+o*y]);return this.labels_[a]=T,T},e.prototype.replayTextBackground_=function(e,i,r,n,o,a,s,l){e.beginPath(),e.moveTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,n),e.lineTo.apply(e,o),e.lineTo.apply(e,i),a&&(this.alignFill_=a[2],l&&(e.fillStyle=a[1]),this.fill_(e)),s&&(this.setStrokeStyle_(e,s),e.stroke())},e.prototype.replayImageOrLabel_=function(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v){var x=y||v;a*=f[0],s*=f[1],r-=a,n-=s;var b=g+c>o.width?o.width-c:g,w=h+d>o.height?o.height-d:h,T=_[3]+b*f[0]+_[1],S=_[0]+w*f[1]+_[2],E=r-_[3],I=n-_[0];(x||0!==p)&&(nY[0]=E,nQ[0]=E,nY[1]=I,nK[1]=I,nK[0]=E+T,nJ[0]=nK[0],nJ[1]=I+S,nQ[1]=nJ[1]);var C=null;if(0!==p){var A=r+a,R=n+s;C=rB(nX,A,R,1,1,p,-A,-R),rz(nX,nY),rz(nX,nK),rz(nX,nJ),rz(nX,nQ),tj(Math.min(nY[0],nK[0],nJ[0],nQ[0]),Math.min(nY[1],nK[1],nJ[1],nQ[1]),Math.max(nY[0],nK[0],nJ[0],nQ[0]),Math.max(nY[1],nK[1],nJ[1],nQ[1]),nW)}else tj(E,I,E+T,I+S,nW);var M=0,P=0;if(l){var O=this.renderBuffer_;O[0]=Math.max(O[0],t3(nW)),M=O[0],O[1]=Math.max(O[1],tQ(nW)),P=O[1]}var k=e.canvas,L=v?v[2]*f[0]/2:0,D=nW[0]-L<=(k.width+M)/i&&nW[2]+L>=-M/i&&nW[1]-L<=(k.height+P)/i&&nW[3]+L>=-P/i;if(m&&(r=Math.round(r),n=Math.round(n)),l){if(!D&&1==l[0])return!1;var z=D?[e,C?C.slice(0):null,u,o,c,d,b,w,r,n,f,nW.slice()]:null;z&&(x&&z.push(y,v,nY.slice(0),nK.slice(0),nJ.slice(0),nQ.slice(0)),l.push(z))}else D&&(x&&this.replayTextBackground_(e,nY,nK,nJ,nQ,y,v,!1),r6(e,C,u,o,c,d,b,w,r,n,f));return!0},e.prototype.fill_=function(e){if(this.alignFill_){var i=rz(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(i[0]%r,i[1]%r),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()},e.prototype.setStrokeStyle_=function(e,i){e.strokeStyle=i[1],e.lineWidth=i[2],e.lineCap=i[3],e.lineJoin=i[4],e.miterLimit=i[5],e.setLineDash&&(e.lineDashOffset=i[7],e.setLineDash(i[6]))},e.prototype.renderDeclutter=function(e,i,r,n){for(var o=[],a=1,s=e.length;a<s;++a){var l=e[a],h=l[11];o.push({minX:h[0],minY:h[1],maxX:h[2],maxY:h[3],value:i})}n||(n=new(e1(nq))(9));for(var u=!1,a=0,s=o.length;a<s;++a)if(n.collides(o[a])){u=!0;break}if(!u){n.load(o);for(var c=1,d=e.length;c<d;++c){var l=e[c],p=l[0],f=p.globalAlpha;f!==r&&(p.globalAlpha=r),l.length>12&&this.replayTextBackground_(l[0],l[14],l[15],l[16],l[17],l[12],l[13],!0),r6.apply(void 0,l),f!==r&&(p.globalAlpha=f)}}return e.length=1,n},e.prototype.drawLabelWithPointPlacement_=function(e,i,r,n){var o=this.textStates[i],a=this.createLabel(e,i,n,r),s=this.strokeStates[r],l=this.pixelRatio,h=nk[o.textAlign||rZ],u=nk[o.textBaseline||rW],c=s&&s.lineWidth?s.lineWidth:0,d=a.width/l-2*o.scale[0],p=u*a.height/l+2*(.5-u)*c;return{label:a,anchorX:h*d+2*(.5-h)*c,anchorY:p}},e.prototype.execute_=function(e,i,r,n,o,a,s){if(this.declutterItems.length=0,this.pixelCoordinates_&&iA(r,this.renderedTransform_))h=this.pixelCoordinates_;else{var l;this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=n$(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),l=this.renderedTransform_,l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5]}for(var h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C=0,A=n.length,R=0,M=0,P=0,O=null,k=null,L=this.coordinateCache_,D=this.viewRotation_,z=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},B=this.instructions!=n||this.overlaps?0:200;C<A;){var N=n[C];switch(N[0]){case nc.BEGIN_GEOMETRY:(S=N[1]).getGeometry()?void 0===s||t5(s,N[3])?++C:C=N[2]+1:C=N[2];break;case nc.BEGIN_PATH:M>B&&(this.fill_(e),M=0),P>B&&(e.stroke(),P=0),M||P||(e.beginPath(),p=NaN,f=NaN),++C;break;case nc.CIRCLE:var j=h[R=N[1]],V=h[R+1],U=h[R+2],G=h[R+3],q=U-j,$=G-V,H=Math.sqrt(q*q+$*$);e.moveTo(j+H,V),e.arc(j,V,H,0,2*Math.PI,!0),++C;break;case nc.CLOSE_PATH:e.closePath(),++C;break;case nc.CUSTOM:R=N[1],u=N[2];var Z=N[3],W=N[4],X=6==N.length?N[5]:void 0;F.geometry=Z,F.feature=S,C in L||(L[C]=[]);var Y=L[C];X?X(h,R,u,2,Y):(Y[0]=h[R],Y[1]=h[R+1],Y.length=2),W(Y,F),++C;break;case nc.DRAW_IMAGE:R=N[1],u=N[2],v=N[3],c=N[4],d=N[5],y=a?null:N[6];var K=N[7],J=N[8],Q=N[9],ee=N[10],et=N[11],ei=N[12],er=N[13],en=N[14];if(!v&&N.length>=19){x=N[18],b=N[19],w=N[20],T=N[21];var eo=this.drawLabelWithPointPlacement_(x,b,w,T);v=eo.label,N[3]=v;var ea=N[22];c=(eo.anchorX-ea)*this.pixelRatio,N[4]=c;var es=N[23];d=(eo.anchorY-es)*this.pixelRatio,N[5]=d,K=v.height,N[7]=K,en=v.width,N[14]=en}var el=void 0;N.length>24&&(el=N[24]);var eh=void 0,eu=void 0,ec=void 0;N.length>16?(eh=N[15],eu=N[16],ec=N[17]):(eh=rX,eu=!1,ec=!1),et&&z?ei+=D:et||z||(ei-=D);for(var ed=0,ep=0;R<u;R+=2)if(!el||!(el[ed++]<en/this.pixelRatio)){if(y){var ef=Math.floor(ep);_=y.length<ef+1?[y[0][0]]:y[ef]}var em=this.replayImageOrLabel_(e,i,h[R],h[R+1],v,c,d,_,K,J,Q,ee,ei,er,o,en,eh,eu?O:null,ec?k:null);em&&_&&y[y.length-1]!==_&&y.push(_),_&&(_.length-1===_[0]&&this.declutterItems.push(this,_,S),ep+=1/_[0])}++C;break;case nc.DRAW_CHARS:var eg=N[1],e_=N[2],ey=N[3];_=a?null:N[4];var ev=N[5];T=N[6];var ex=N[7],eb=N[8],ew=N[9];w=N[10];var eT=N[11];x=N[12],b=N[13];var eS=[N[14],N[14]],eE=this.textStates[b],eI=eE.font,eC=[eE.scale[0]*eb,eE.scale[1]*eb],eA=void 0;eI in this.widths_?eA=this.widths_[eI]:(eA={},this.widths_[eI]=eA);var eR=nZ(h,eg,e_,2),eM=Math.abs(eC[0])*r5(eI,x,eA);if(ev||eM<=eR){var eP=function(e,i,r,n,o,a,s,l,h,u,c,d){var p,f,m,g=[];if(d){var _=nH(e,i,r,2,d,[e[i],e[i+1]]);p=_[0]>_[_.length-2]}else p=e[i]>e[r-n];for(var y=o.length,v=e[i],x=e[i+1],b=e[i+=n],w=e[i+1],T=0,S=Math.sqrt(Math.pow(b-v,2)+Math.pow(w-x,2)),E=!1,I=0;I<y;++I){for(var C,A,R=o[f=p?y-I-1:I],M=l*h(u,R,c),P=a+M/2;i<r-n&&T+S<P;)v=b,x=w,i+=n,b=e[i],w=e[i+1],T+=S,S=Math.sqrt(Math.pow(b-v,2)+Math.pow(w-x,2));var O=P-T,k=Math.atan2(w-x,b-v);if(p&&(k+=k>0?-Math.PI:Math.PI),void 0!==m){var L=k-m;if(E=E||0!==L,Math.abs(L+=L>Math.PI?-2*Math.PI:L<-Math.PI?2*Math.PI:0)>s)return null}m=k;var D=O/S,z=(C=v)+D*(b-C),F=(A=x)+D*(w-A);g[f]=[z,F,M/2,k,R],a+=M}return E?g:[[g[0][0],g[0][1],g[0][2],g[0][3],o]]}(h,eg,e_,2,x,(eR-eM)*nk[this.textStates[b].textAlign],ex,Math.abs(eC[0]),r5,eI,eA,z?0:this.viewRotation_);if(eP){var em=!1,eO=void 0,ek=void 0,eL=void 0,eD=void 0,ez=void 0;if(w)for(eO=0,ek=eP.length;eO<ek;++eO)eL=(ez=eP[eO])[4],eD=this.createLabel(eL,b,"",w),c=ez[2]+eT,d=ey*eD.height+(.5-ey)*2*eT*eC[1]/eC[0]-ew,em=this.replayImageOrLabel_(e,i,ez[0],ez[1],eD,c,d,_,eD.height,1,0,0,ez[3],eS,!1,eD.width,rX,null,null)||em;if(T)for(eO=0,ek=eP.length;eO<ek;++eO)eL=(ez=eP[eO])[4],eD=this.createLabel(eL,b,T,""),c=ez[2],d=ey*eD.height-ew,em=this.replayImageOrLabel_(e,i,ez[0],ez[1],eD,c,d,_,eD.height,1,0,0,ez[3],eS,!1,eD.width,rX,null,null)||em;em&&this.declutterItems.push(this,_,S)}}++C;break;case nc.END_GEOMETRY:if(void 0!==a){var eF=a(S=N[1]);if(eF)return eF}++C;break;case nc.FILL:B?M++:this.fill_(e),++C;break;case nc.MOVE_TO_LINE_TO:for(R=N[1],u=N[2],E=h[R],I=h[R+1],m=E+.5|0,g=I+.5|0,(m!==p||g!==f)&&(e.moveTo(E,I),p=m,f=g),R+=2;R<u;R+=2)E=h[R],I=h[R+1],m=E+.5|0,g=I+.5|0,(R==u-2||m!==p||g!==f)&&(e.lineTo(E,I),p=m,f=g);++C;break;case nc.SET_FILL_STYLE:O=N,this.alignFill_=N[2],M&&(this.fill_(e),M=0,P&&(e.stroke(),P=0)),e.fillStyle=N[1],++C;break;case nc.SET_STROKE_STYLE:k=N,P&&(e.stroke(),P=0),this.setStrokeStyle_(e,N),++C;break;case nc.STROKE:B?P++:e.stroke(),++C;break;default:++C}}M&&this.fill_(e),P&&e.stroke()},e.prototype.execute=function(e,i,r,n,o){this.viewRotation_=n,this.execute_(e,i,r,this.instructions,o,void 0,void 0)},e.prototype.executeHitDetection=function(e,i,r,n,o){return this.viewRotation_=r,this.execute_(e,1,i,this.hitDetectionInstructions,!0,n,o)},e}(),n1=[nG.POLYGON,nG.CIRCLE,nG.LINE_STRING,nG.IMAGE,nG.TEXT,nG.DEFAULT],n2=function(){function e(e,i,r,n,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=i,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=rO(),this.createExecutors_(o)}return e.prototype.clip=function(e,i){var r=this.getClipCoords(i);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()},e.prototype.createExecutors_=function(e){for(var i in e){var r=this.executorsByZIndex_[i];void 0===r&&(r={},this.executorsByZIndex_[i]=r);var n=e[i],o=[this.renderBuffer_||0,this.renderBuffer_||0];for(var a in n){var s=n[a];r[a]=new n0(this.resolution_,this.pixelRatio_,this.overlaps_,s,o)}}},e.prototype.hasExecutors=function(e){for(var i in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[i],n=0,o=e.length;n<o;++n)if(e[n]in r)return!0;return!1},e.prototype.forEachFeatureAtCoordinate=function(e,i,r,n,o,a){var s,l,h,u,c,d,p,f=2*(n=Math.round(n))+1,m=rB(this.hitDetectionTransform_,n+.5,n+.5,1/i,-1/i,-r,-e[0],-e[1]);this.hitDetectionContext_||(this.hitDetectionContext_=i9(f,f));var g=this.hitDetectionContext_;g.canvas.width!==f||g.canvas.height!==f?(g.canvas.width=f,g.canvas.height=f):g.clearRect(0,0,f,f),void 0!==this.renderBuffer_&&(t$(s=tN(),e),tO(s,i*(this.renderBuffer_+n),s));var _=function(e){if(void 0!==n3[e])return n3[e];for(var i=2*e+1,r=Array(i),n=0;n<i;n++)r[n]=Array(i);for(var o=e,a=0,s=0;o>=a;)n5(r,e+o,e+a),n5(r,e+a,e+o),n5(r,e-a,e+o),n5(r,e-o,e+a),n5(r,e-o,e-a),n5(r,e-a,e-o),n5(r,e+a,e-o),n5(r,e+o,e-a),2*((s+=1+2*++a)-o)+1>0&&(o-=1,s+=1-2*o);return n3[e]=r,r}(n);function y(e){for(var i=g.getImageData(0,0,f,f).data,r=0;r<f;r++)for(var n=0;n<f;n++)if(_[r][n]&&i[(n*f+r)*4+3]>0){var s=void 0;if(a&&(l==nG.IMAGE||l==nG.TEXT)&&-1===a.indexOf(e)||(s=o(e)),s)return s;return void g.clearRect(0,0,f,f)}}var v=Object.keys(this.executorsByZIndex_).map(Number);for(v.sort(iE),h=v.length-1;h>=0;--h){var x=v[h].toString();for(c=this.executorsByZIndex_[x],u=n1.length-1;u>=0;--u)if(void 0!==(d=c[l=n1[u]])&&(p=d.executeHitDetection(g,m,r,y,s)))return p}},e.prototype.getClipCoords=function(e){var i=this.maxExtent_;if(!i)return null;var r=i[0],n=i[1],o=i[2],a=i[3],s=[r,n,r,a,o,a,o,n];return n$(s,0,8,2,e,s),s},e.prototype.isEmpty=function(){return tx(this.executorsByZIndex_)},e.prototype.execute=function(e,i,r,n,o,a,s){var l,h,u,c,d,p,f=Object.keys(this.executorsByZIndex_).map(Number);f.sort(iE),this.maxExtent_&&(e.save(),this.clip(e,r));var m=a||n1;for(l=0,h=f.length;l<h;++l){var g=f[l].toString();for(u=0,d=this.executorsByZIndex_[g],c=m.length;u<c;++u){var _=m[u];if(void 0!==(p=d[_]))if(s&&(_==nG.IMAGE||_==nG.TEXT)){var y=s[g];y?y.push(p,r.slice(0)):s[g]=[p,r.slice(0)]}else p.execute(e,i,r,n,o)}}this.maxExtent_&&e.restore()},e}(),n3={0:[[!0]]};function n5(e,i,r){var n,o=Math.floor(e.length/2);if(i>=o)for(n=o;n<i;n++)e[n][r]=!0;else if(i<o)for(n=i+1;n<o;n++)e[n][r]=!0}function n4(e,i,r,n,o,a){for(var s=Object.keys(e).map(Number).sort(iE),l=0,h=s.length;l<h;++l)for(var u=e[s[l].toString()],c=void 0,d=0,p=u.length;d<p;){var f=u[d++],m=u[d++];f.execute(i,1,m,r,o),f!==c&&f.declutterItems.length>0&&(c=f,a.push({items:f.declutterItems,opacity:n}))}}var n6={ANIMATING:0,INTERACTING:1},n8=(M=function(e,i){return(M=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}M(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),n9=rO(),n7=function(e){function i(){var i,r,n,o,a,s=e.call(this)||this;return s.extent_=tN(),s.extentRevision_=-1,s.simplifiedGeometryMaxMinSquaredTolerance=0,s.simplifiedGeometryRevision=0,i=function(e,i,r){if(!r)return this.getSimplifiedGeometry(i);var n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(i)},a=!1,s.simplifyTransformedInternal=function(){var e=Array.prototype.slice.call(arguments);return a&&this===o&&iA(e,n)||(a=!0,o=this,n=e,r=i.apply(this,arguments)),r},s}return n8(i,e),i.prototype.simplifyTransformed=function(e,i){return this.simplifyTransformedInternal(this.getRevision(),e,i)},i.prototype.clone=function(){return tE()},i.prototype.closestPointXY=function(e,i,r,n){return tE()},i.prototype.containsXY=function(e,i){var r=this.getClosestPoint([e,i]);return r[0]===e&&r[1]===i},i.prototype.getClosestPoint=function(e,i){var r=i||[NaN,NaN];return this.closestPointXY(e[0],e[1],r,1/0),r},i.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},i.prototype.computeExtent=function(e){return tE()},i.prototype.getExtent=function(e){if(this.extentRevision_!=this.getRevision()){var i,r=this.computeExtent(this.extent_);(isNaN(r[0])||isNaN(r[1]))&&tV(r),this.extentRevision_=this.getRevision()}return i=this.extent_,e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i},i.prototype.rotate=function(e,i){tE()},i.prototype.scale=function(e,i,r){tE()},i.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},i.prototype.getSimplifiedGeometry=function(e){return tE()},i.prototype.getType=function(){return tE()},i.prototype.applyTransform=function(e){tE()},i.prototype.intersectsExtent=function(e){return tE()},i.prototype.translate=function(e,i){tE()},i.prototype.transform=function(e,i){var r=ia(e),n=r.getUnits()==e6.TILE_PIXELS?function(e,n,o){var a=r.getExtent(),s=r.getWorldExtent(),l=tQ(s)/tQ(a);return rB(n9,s[0],s[3],l,-l,0,0,0),n$(e,0,e.length,o,n9,n),ip(r,i)(e,n,o)}:ip(r,i);return this.applyTransform(n),this},i}(iU),oe={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},ot=(P=function(e,i){return(P=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}P(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oi=function(e){function i(){var i=e.call(this)||this;return i.layout=oe.XY,i.stride=2,i.flatCoordinates=null,i}return ot(i,e),i.prototype.computeExtent=function(e){var i,r,n;return i=this.flatCoordinates,r=this.flatCoordinates.length,n=this.stride,tH(tV(e),i,0,r,n)},i.prototype.getCoordinates=function(){return tE()},i.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},i.prototype.getFlatCoordinates=function(){return this.flatCoordinates},i.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},i.prototype.getLayout=function(){return this.layout},i.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var i=this.getSimplifiedGeometryInternal(e);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)},i.prototype.getSimplifiedGeometryInternal=function(e){return this},i.prototype.getStride=function(){return this.stride},i.prototype.setFlatCoordinates=function(e,i){this.stride=or(e),this.layout=e,this.flatCoordinates=i},i.prototype.setCoordinates=function(e,i){tE()},i.prototype.setLayout=function(e,i,r){var n;if(e)n=or(e);else{for(var o,a,s=0;s<r;++s)if(0===i.length){this.layout=oe.XY,this.stride=2;return}else i=i[0];2==(o=n=i.length)?a=oe.XY:3==o?a=oe.XYZ:4==o&&(a=oe.XYZM),e=a}this.layout=e,this.stride=n},i.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},i.prototype.rotate=function(e,i){var r=this.getFlatCoordinates();if(r){var n=this.getStride();nH(r,0,r.length,n,e,i,r),this.changed()}},i.prototype.scale=function(e,i,r){var n=i;void 0===n&&(n=e);var o=r;o||(o=tK(this.getExtent()));var a=this.getFlatCoordinates();if(a){var s=this.getStride();!function(e,i,r,n,o,a,s,l){for(var h=l||[],u=s[0],c=s[1],d=0,p=0;p<r;p+=n){var f=e[p]-u,m=e[p+1]-c;h[d++]=u+o*f,h[d++]=c+a*m;for(var g=p+2;g<p+n;++g)h[d++]=e[g]}l&&h.length!=d&&(h.length=d)}(a,0,a.length,s,e,n,o,a),this.changed()}},i.prototype.translate=function(e,i){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(e,i,r,n,o,a,s){for(var l=s||[],h=0,u=0;u<r;u+=n){l[h++]=e[u]+o,l[h++]=e[u+1]+a;for(var c=u+2;c<u+n;++c)l[h++]=e[c]}s&&l.length!=h&&(l.length=h)}(r,0,r.length,n,e,i,r),this.changed()}},i}(n7);function or(e){var i;return e==oe.XY?i=2:e==oe.XYZ||e==oe.XYM?i=3:e==oe.XYZM&&(i=4),i}var on=(O=function(e,i){return(O=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}O(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oo=function(e){function i(i,r,n,o,a,s,l){var h=e.call(this)||this;return h.context_=i,h.pixelRatio_=r,h.extent_=n,h.transform_=o,h.viewRotation_=a,h.squaredTolerance_=s,h.userTransform_=l,h.contextFillState_=null,h.contextStrokeState_=null,h.contextTextState_=null,h.fillState_=null,h.strokeState_=null,h.image_=null,h.imageAnchorX_=0,h.imageAnchorY_=0,h.imageHeight_=0,h.imageOpacity_=0,h.imageOriginX_=0,h.imageOriginY_=0,h.imageRotateWithView_=!1,h.imageRotation_=0,h.imageScale_=[0,0],h.imageWidth_=0,h.text_="",h.textOffsetX_=0,h.textOffsetY_=0,h.textRotateWithView_=!1,h.textRotation_=0,h.textScale_=[0,0],h.textFillState_=null,h.textStrokeState_=null,h.textState_=null,h.pixelCoordinates_=[],h.tmpLocalTransform_=rO(),h}return on(i,e),i.prototype.drawImages_=function(e,i,r,n){if(this.image_){var o=n$(e,i,r,2,this.transform_,this.pixelCoordinates_),a=this.context_,s=this.tmpLocalTransform_,l=a.globalAlpha;1!=this.imageOpacity_&&(a.globalAlpha=l*this.imageOpacity_);var h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(var u=0,c=o.length;u<c;u+=2){var d=o[u]-this.imageAnchorX_,p=o[u+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var f=d+this.imageAnchorX_,m=p+this.imageAnchorY_;rB(s,f,m,1,1,h,-f,-m),a.setTransform.apply(a,s),a.translate(f,m),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.setTransform(1,0,0,1,0,0)}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,p,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(a.globalAlpha=l)}},i.prototype.drawText_=function(e,i,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var o=n$(e,i,r,n,this.transform_,this.pixelCoordinates_),a=this.context_,s=this.textRotation_;for(this.textRotateWithView_&&(s+=this.viewRotation_);i<r;i+=n){var l=o[i]+this.textOffsetX_,h=o[i+1]+this.textOffsetY_;if(0!==s||1!=this.textScale_[0]||1!=this.textScale_[1]){var u=rB(this.tmpLocalTransform_,l,h,1,1,s,-l,-h);a.setTransform.apply(a,u),a.translate(l,h),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&a.strokeText(this.text_,l,h),this.textFillState_&&a.fillText(this.text_,l,h)}}},i.prototype.moveToLineTo_=function(e,i,r,n,o){var a=this.context_,s=n$(e,i,r,n,this.transform_,this.pixelCoordinates_);a.moveTo(s[0],s[1]);var l=s.length;o&&(l-=2);for(var h=2;h<l;h+=2)a.lineTo(s[h],s[h+1]);return o&&a.closePath(),r},i.prototype.drawRings_=function(e,i,r,n){for(var o=0,a=r.length;o<a;++o)i=this.moveToLineTo_(e,i,r[o],n,!0);return i},i.prototype.drawCircle=function(e){if(t5(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=function(e,i,r){var n=e.getFlatCoordinates();if(!n)return null;var o=e.getStride();return n$(n,0,n.length,o,i,r)}(e,this.transform_,this.pixelCoordinates_),r=i[2]-i[0],n=i[3]-i[1],o=Math.sqrt(r*r+n*n),a=this.context_;a.beginPath(),a.arc(i[0],i[1],o,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}},i.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},i.prototype.setTransform=function(e){this.transform_=e},i.prototype.drawGeometry=function(e){switch(e.getType()){case t8.POINT:this.drawPoint(e);break;case t8.LINE_STRING:this.drawLineString(e);break;case t8.POLYGON:this.drawPolygon(e);break;case t8.MULTI_POINT:this.drawMultiPoint(e);break;case t8.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case t8.MULTI_POLYGON:this.drawMultiPolygon(e);break;case t8.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case t8.CIRCLE:this.drawCircle(e)}},i.prototype.drawFeature=function(e,i){var r=i.getGeometryFunction()(e);r&&t5(this.extent_,r.getExtent())&&(this.setStyle(i),this.drawGeometry(r))},i.prototype.drawGeometryCollection=function(e){for(var i=e.getGeometriesArray(),r=0,n=i.length;r<n;++r)this.drawGeometry(i[r])},i.prototype.drawPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(i,0,i.length,r),""!==this.text_&&this.drawText_(i,0,i.length,r)},i.prototype.drawMultiPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(i,0,i.length,r),""!==this.text_&&this.drawText_(i,0,i.length,r)},i.prototype.drawLineString=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),t5(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=e.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(r,0,r.length,e.getStride(),!1),i.stroke()}if(""!==this.text_){var n=e.getFlatMidpoint();this.drawText_(n,0,2,2)}}},i.prototype.drawMultiLineString=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=e.getExtent();if(t5(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=e.getFlatCoordinates(),o=0,a=e.getEnds(),s=e.getStride();r.beginPath();for(var l=0,h=a.length;l<h;++l)o=this.moveToLineTo_(n,o,a[l],s,!1);r.stroke()}if(""!==this.text_){var u=e.getFlatMidpoints();this.drawText_(u,0,u.length,2)}}},i.prototype.drawPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),t5(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_;i.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(""!==this.text_){var r=e.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},i.prototype.drawMultiPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),t5(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=e.getOrientedFlatCoordinates(),n=0,o=e.getEndss(),a=e.getStride();i.beginPath();for(var s=0,l=o.length;s<l;++s){var h=o[s];n=this.drawRings_(r,n,h,a)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(""!==this.text_){var u=e.getFlatInteriorPoints();this.drawText_(u,0,u.length,2)}}},i.prototype.setContextFillState_=function(e){var i=this.context_,r=this.contextFillState_;r?r.fillStyle!=e.fillStyle&&(r.fillStyle=e.fillStyle,i.fillStyle=e.fillStyle):(i.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})},i.prototype.setContextStrokeState_=function(e){var i=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=e.lineCap&&(r.lineCap=e.lineCap,i.lineCap=e.lineCap),i.setLineDash&&(iA(r.lineDash,e.lineDash)||i.setLineDash(r.lineDash=e.lineDash),r.lineDashOffset!=e.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset,i.lineDashOffset=e.lineDashOffset)),r.lineJoin!=e.lineJoin&&(r.lineJoin=e.lineJoin,i.lineJoin=e.lineJoin),r.lineWidth!=e.lineWidth&&(r.lineWidth=e.lineWidth,i.lineWidth=e.lineWidth),r.miterLimit!=e.miterLimit&&(r.miterLimit=e.miterLimit,i.miterLimit=e.miterLimit),r.strokeStyle!=e.strokeStyle&&(r.strokeStyle=e.strokeStyle,i.strokeStyle=e.strokeStyle)):(i.lineCap=e.lineCap,i.setLineDash&&(i.setLineDash(e.lineDash),i.lineDashOffset=e.lineDashOffset),i.lineJoin=e.lineJoin,i.lineWidth=e.lineWidth,i.miterLimit=e.miterLimit,i.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})},i.prototype.setContextTextState_=function(e){var i=this.context_,r=this.contextTextState_,n=e.textAlign?e.textAlign:rZ;r?(r.font!=e.font&&(r.font=e.font,i.font=e.font),r.textAlign!=n&&(r.textAlign=n,i.textAlign=n),r.textBaseline!=e.textBaseline&&(r.textBaseline=e.textBaseline,i.textBaseline=e.textBaseline)):(i.font=e.font,i.textAlign=n,i.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})},i.prototype.setFillStrokeStyle=function(e,i){if(e){var r=e.getColor();this.fillState_={fillStyle:rM(r||rU)}}else this.fillState_=null;if(i){var n=i.getColor(),o=i.getLineCap(),a=i.getLineDash(),s=i.getLineDashOffset(),l=i.getLineJoin(),h=i.getWidth(),u=i.getMiterLimit();this.strokeState_={lineCap:void 0!==o?o:rG,lineDash:a||rq,lineDashOffset:s||0,lineJoin:void 0!==l?l:r$,lineWidth:this.pixelRatio_*(void 0!==h?h:1),miterLimit:void 0!==u?u:10,strokeStyle:rM(n||rH)}}else this.strokeState_=null},i.prototype.setImageStyle=function(e){if(e){var i=e.getSize();if(i){var r=e.getAnchor(),n=e.getImage(1),o=e.getOrigin(),a=e.getScaleArray();this.imageAnchorX_=r[0],this.imageAnchorY_=r[1],this.imageHeight_=i[1],this.image_=n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation(),this.imageScale_=[this.pixelRatio_*a[0],this.pixelRatio_*a[1]],this.imageWidth_=i[0]}else this.image_=null}else this.image_=null},i.prototype.setTextStyle=function(e){if(e){var i=e.getFill();if(i){var r=i.getColor();this.textFillState_={fillStyle:rM(r||rU)}}else this.textFillState_=null;var n=e.getStroke();if(n){var o=n.getColor(),a=n.getLineCap(),s=n.getLineDash(),l=n.getLineDashOffset(),h=n.getLineJoin(),u=n.getWidth(),c=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==a?a:rG,lineDash:s||rq,lineDashOffset:l||0,lineJoin:void 0!==h?h:r$,lineWidth:void 0!==u?u:1,miterLimit:void 0!==c?c:10,strokeStyle:rM(o||rH)}}else this.textStrokeState_=null;var d=e.getFont(),p=e.getOffsetX(),f=e.getOffsetY(),m=e.getRotateWithView(),g=e.getRotation(),_=e.getScaleArray(),y=e.getText(),v=e.getTextAlign(),x=e.getTextBaseline();this.textState_={font:void 0!==d?d:rV,textAlign:void 0!==v?v:rZ,textBaseline:void 0!==x?x:rW},this.text_=void 0!==y?y:"",this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0,this.textOffsetY_=void 0!==f?this.pixelRatio_*f:0,this.textRotateWithView_=void 0!==m&&m,this.textRotation_=void 0!==g?g:0,this.textScale_=[this.pixelRatio_*_[0],this.pixelRatio_*_[1]]}else this.text_=""},i}(ng),oa={FRACTION:"fraction",PIXELS:"pixels"},os={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};function ol(e,i,r){return i+":"+e+":"+(r?"string"==typeof r?r:rR(r):"null")}var oh=new(function(){function e(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return e.prototype.clear=function(){this.cache_={},this.cacheSize_=0},e.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},e.prototype.expire=function(){if(this.canExpireCache()){var e=0;for(var i in this.cache_){var r=this.cache_[i];(3&e++)==0&&!r.hasListener()&&(delete this.cache_[i],--this.cacheSize_)}}},e.prototype.get=function(e,i,r){var n=ol(e,i,r);return n in this.cache_?this.cache_[n]:null},e.prototype.set=function(e,i,r,n){var o=ol(e,i,r);this.cache_[o]=n,++this.cacheSize_},e.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()},e}()),ou=(k=function(e,i){return(k=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}k(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oc=function(e){function i(i,r,n,o){var a=e.call(this)||this;return a.extent=i,a.pixelRatio_=n,a.resolution=r,a.state=o,a}return ou(i,e),i.prototype.changed=function(){this.dispatchEvent(iL.CHANGE)},i.prototype.getExtent=function(){return this.extent},i.prototype.getImage=function(){return tE()},i.prototype.getPixelRatio=function(){return this.pixelRatio_},i.prototype.getResolution=function(){return this.resolution},i.prototype.getState=function(){return this.state},i.prototype.load=function(){tE()},i}(ik);function od(e,i,r,n,o,a){var s=oc.call(this,e,i,r,rb.IDLE)||this;return s.src_=n,s.image_=new Image,null!==o&&(s.image_.crossOrigin=o),s.unlisten_=null,s.state=rb.IDLE,s.imageLoadFunction_=a,s}function op(e,i,r){if(e.src&&i6){var n=e.decode(),o=!0;return n.then(function(){o&&i()}).catch(function(e){o&&("EncodingError"===e.name&&"Invalid image type."===e.message?i():r())}),function(){o=!1}}var a=[iD(e,iL.LOAD,i,void 0,!0),iD(e,iL.ERROR,r,void 0,!0)];return function(){a.forEach(iz)}}(L=function(e,i){return(L=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}L(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)})(od,oc),od.prototype.getImage=function(){return this.image_},od.prototype.handleImageError_=function(){this.state=rb.ERROR,this.unlistenImage_(),this.changed()},od.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=tQ(this.extent)/this.image_.height),this.state=rb.LOADED,this.unlistenImage_(),this.changed()},od.prototype.load=function(){(this.state==rb.IDLE||this.state==rb.ERROR)&&(this.state=rb.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=op(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},od.prototype.setImage=function(e){this.image_=e},od.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)};var of=(D=function(e,i){return(D=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}D(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),om=null,og=function(e){function i(i,r,n,o,a,s){var l=e.call(this)||this;return l.hitDetectionImage_=null,l.image_=i||new Image,null!==o&&(l.image_.crossOrigin=o),l.canvas_={},l.color_=s,l.unlisten_=null,l.imageState_=a,l.size_=n,l.src_=r,l.tainted_,l}return of(i,e),i.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===rb.LOADED){om||(om=i9(1,1)),om.drawImage(this.image_,0,0);try{om.getImageData(0,0,1,1),this.tainted_=!1}catch(e){om=null,this.tainted_=!0}}return!0===this.tainted_},i.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(iL.CHANGE)},i.prototype.handleImageError_=function(){this.imageState_=rb.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},i.prototype.handleImageLoad_=function(){this.imageState_=rb.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},i.prototype.getImage=function(e){return this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_},i.prototype.getPixelRatio=function(e){return this.replaceColor_(e),this.canvas_[e]?e:1},i.prototype.getImageState=function(){return this.imageState_},i.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],i=this.size_[1],r=i9(e,i);r.fillRect(0,0,e,i),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},i.prototype.getSize=function(){return this.size_},i.prototype.getSrc=function(){return this.src_},i.prototype.load=function(){if(this.imageState_==rb.IDLE){this.imageState_=rb.LOADING;try{this.image_.src=this.src_}catch(e){this.handleImageError_()}this.unlisten_=op(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},i.prototype.replaceColor_=function(e){if(this.color_&&!this.canvas_[e]){var i=document.createElement("canvas");this.canvas_[e]=i,i.width=Math.ceil(this.image_.width*e),i.height=Math.ceil(this.image_.height*e);var r=i.getContext("2d");if(r.scale(e,e),r.drawImage(this.image_,0,0),this.isTainted_()){var n=this.color_;r.globalCompositeOperation="multiply",r.fillStyle="rgb("+n[0]+","+n[1]+","+n[2]+")",r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-in",r.drawImage(this.image_,0,0);return}for(var o=r.getImageData(0,0,i.width,i.height),a=o.data,s=this.color_[0]/255,l=this.color_[1]/255,h=this.color_[2]/255,u=0,c=a.length;u<c;u+=4)a[u]*=s,a[u+1]*=l,a[u+2]*=h;r.putImageData(o,0,0)}},i.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},i}(ik),o_=(z=function(e,i){return(z=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}z(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oy=function(e){function i(i){var r,n,o,a,s=this,l=i||{},h=void 0!==l.opacity?l.opacity:1,u=void 0!==l.rotation?l.rotation:0,c=void 0!==l.scale?l.scale:1,d=void 0!==l.rotateWithView&&l.rotateWithView;(s=e.call(this,{opacity:h,rotation:u,scale:c,displacement:void 0!==l.displacement?l.displacement:[0,0],rotateWithView:d})||this).anchor_=void 0!==l.anchor?l.anchor:[.5,.5],s.normalizedAnchor_=null,s.anchorOrigin_=void 0!==l.anchorOrigin?l.anchorOrigin:os.TOP_LEFT,s.anchorXUnits_=void 0!==l.anchorXUnits?l.anchorXUnits:oa.FRACTION,s.anchorYUnits_=void 0!==l.anchorYUnits?l.anchorYUnits:oa.FRACTION,s.crossOrigin_=void 0!==l.crossOrigin?l.crossOrigin:null;var p=void 0!==l.img?l.img:null,f=void 0!==l.imgSize?l.imgSize:null,m=l.src;tM(!(void 0!==m&&p),4),tM(!p||p&&f,5),(void 0===m||0===m.length)&&p&&(m=p.src||tC(p)),tM(void 0!==m&&m.length>0,6);var g=void 0!==l.src?rb.IDLE:rb.LOADED;return s.color_=void 0!==l.color?rC(l.color):null,s.iconImage_=(r=m,n=s.crossOrigin_,o=s.color_,(a=oh.get(r,n,o))||(a=new og(p,r,f,n,g,o),oh.set(r,n,o,a)),a),s.offset_=void 0!==l.offset?l.offset:[0,0],s.offsetOrigin_=void 0!==l.offsetOrigin?l.offsetOrigin:os.TOP_LEFT,s.origin_=null,s.size_=void 0!==l.size?l.size:null,s}return o_(i,e),i.prototype.clone=function(){var e=this.getScale();return new i({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},i.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var e=this.anchor_,i=this.getSize();if(this.anchorXUnits_==oa.FRACTION||this.anchorYUnits_==oa.FRACTION){if(!i)return null;e=this.anchor_.slice(),this.anchorXUnits_==oa.FRACTION&&(e[0]*=i[0]),this.anchorYUnits_==oa.FRACTION&&(e[1]*=i[1])}if(this.anchorOrigin_!=os.TOP_LEFT){if(!i)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_==os.TOP_RIGHT||this.anchorOrigin_==os.BOTTOM_RIGHT)&&(e[0]=-e[0]+i[0]),(this.anchorOrigin_==os.BOTTOM_LEFT||this.anchorOrigin_==os.BOTTOM_RIGHT)&&(e[1]=-e[1]+i[1])}return this.normalizedAnchor_=e,this.normalizedAnchor_},i.prototype.setAnchor=function(e){this.anchor_=e,this.normalizedAnchor_=null},i.prototype.getColor=function(){return this.color_},i.prototype.getImage=function(e){return this.iconImage_.getImage(e)},i.prototype.getPixelRatio=function(e){return this.iconImage_.getPixelRatio(e)},i.prototype.getImageSize=function(){return this.iconImage_.getSize()},i.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},i.prototype.getImageState=function(){return this.iconImage_.getImageState()},i.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},i.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var e=this.offset_,i=this.getDisplacement();if(this.offsetOrigin_!=os.TOP_LEFT){var r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;e=e.slice(),(this.offsetOrigin_==os.TOP_RIGHT||this.offsetOrigin_==os.BOTTOM_RIGHT)&&(e[0]=n[0]-r[0]-e[0]),(this.offsetOrigin_==os.BOTTOM_LEFT||this.offsetOrigin_==os.BOTTOM_RIGHT)&&(e[1]=n[1]-r[1]-e[1])}return e[0]+=i[0],e[1]+=i[1],this.origin_=e,this.origin_},i.prototype.getSrc=function(){return this.iconImage_.getSrc()},i.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},i.prototype.listenImageChange=function(e){this.iconImage_.addEventListener(iL.CHANGE,e)},i.prototype.load=function(){this.iconImage_.load()},i.prototype.unlistenImageChange=function(e){this.iconImage_.removeEventListener(iL.CHANGE,e)},i}(rT);function ov(e,i,r,n,o,a,s){var l=i9(e[0]/2,e[1]/2);l.imageSmoothingEnabled=!1;for(var h=l.canvas,u=new oo(l,.5,o,null,s),c=r.length,d=Math.floor(0xffffff/c),p={},f=1;f<=c;++f){var m=r[f-1],g=m.getStyleFunction()||n;if(n){var _=g(m,a);if(_){Array.isArray(_)||(_=[_]);for(var y="#"+("000000"+(f*d).toString(16)).slice(-6),v=0,x=_.length;v<x;++v){var b=_[v],w=b.clone(),T=w.getFill();T&&T.setColor(y);var S=w.getStroke();S&&S.setColor(y),w.setText(void 0);var E=b.getImage();if(E){var I=E.getImageSize();if(!I)continue;var C=document.createElement("canvas");C.width=I[0],C.height=I[1];var A=C.getContext("2d",{alpha:!1});A.fillStyle=y;var R=A.canvas;A.fillRect(0,0,R.width,R.height),i9(I?I[0]:R.width,I?I[1]:R.height).drawImage(R,0,0),w.setImage(new oy({img:R,imgSize:I,anchor:E.getAnchor(),anchorXUnits:oa.PIXELS,anchorYUnits:oa.PIXELS,offset:E.getOrigin(),size:E.getSize(),opacity:E.getOpacity(),scale:E.getScale(),rotation:E.getRotation(),rotateWithView:E.getRotateWithView()}))}var M=Number(w.getZIndex()),P=p[M];P||(P={},p[M]=P,P[t8.POLYGON]=[],P[t8.CIRCLE]=[],P[t8.LINE_STRING]=[],P[t8.POINT]=[]);var O=w.getGeometryFunction()(m);O&&t5(o,O.getExtent())&&P[O.getType().replace("Multi","")].push(O,w)}}}}for(var k=Object.keys(p).map(Number).sort(iE),f=0,L=k.length;f<L;++f){var P=p[k[f]];for(var D in P)for(var z=P[D],v=0,x=z.length;v<x;v+=2){u.setStyle(z[v+1]);for(var F=0,B=i.length;F<B;++F)u.setTransform(i[F]),u.drawGeometry(z[v])}}return l.getImageData(0,0,h.width,h.height)}function ox(e,i,r){var n=[];if(r){var o=(Math.round(e[0]/2)+Math.round(e[1]/2)*r.width)*4,a=r.data[o],s=r.data[o+1],l=r.data[o+2]+256*(s+256*a),h=Math.floor(0xffffff/i.length);l&&l%h==0&&n.push(i[l/h-1])}return n}var ob={Point:function(e,i,r,n){var o=r.getImage();if(o){if(o.getImageState()!=rb.LOADED)return;var a=e.getBuilder(r.getZIndex(),nG.IMAGE);a.setImageStyle(o,e.addDeclutter(!1)),a.drawPoint(i,n)}var s=r.getText();if(s){var l=e.getBuilder(r.getZIndex(),nG.TEXT);l.setTextStyle(s,e.addDeclutter(!!o)),l.drawText(i,n)}},LineString:function(e,i,r,n){var o=r.getStroke();if(o){var a=e.getBuilder(r.getZIndex(),nG.LINE_STRING);a.setFillStrokeStyle(null,o),a.drawLineString(i,n)}var s=r.getText();if(s){var l=e.getBuilder(r.getZIndex(),nG.TEXT);l.setTextStyle(s,e.addDeclutter(!1)),l.drawText(i,n)}},Polygon:function(e,i,r,n){var o=r.getFill(),a=r.getStroke();if(o||a){var s=e.getBuilder(r.getZIndex(),nG.POLYGON);s.setFillStrokeStyle(o,a),s.drawPolygon(i,n)}var l=r.getText();if(l){var h=e.getBuilder(r.getZIndex(),nG.TEXT);h.setTextStyle(l,e.addDeclutter(!1)),h.drawText(i,n)}},MultiPoint:function(e,i,r,n){var o=r.getImage();if(o){if(o.getImageState()!=rb.LOADED)return;var a=e.getBuilder(r.getZIndex(),nG.IMAGE);a.setImageStyle(o,e.addDeclutter(!1)),a.drawMultiPoint(i,n)}var s=r.getText();if(s){var l=e.getBuilder(r.getZIndex(),nG.TEXT);l.setTextStyle(s,e.addDeclutter(!!o)),l.drawText(i,n)}},MultiLineString:function(e,i,r,n){var o=r.getStroke();if(o){var a=e.getBuilder(r.getZIndex(),nG.LINE_STRING);a.setFillStrokeStyle(null,o),a.drawMultiLineString(i,n)}var s=r.getText();if(s){var l=e.getBuilder(r.getZIndex(),nG.TEXT);l.setTextStyle(s,e.addDeclutter(!1)),l.drawText(i,n)}},MultiPolygon:function(e,i,r,n){var o=r.getFill(),a=r.getStroke();if(a||o){var s=e.getBuilder(r.getZIndex(),nG.POLYGON);s.setFillStrokeStyle(o,a),s.drawMultiPolygon(i,n)}var l=r.getText();if(l){var h=e.getBuilder(r.getZIndex(),nG.TEXT);h.setTextStyle(l,e.addDeclutter(!1)),h.drawText(i,n)}},GeometryCollection:function(e,i,r,n){var o,a,s=i.getGeometriesArray();for(o=0,a=s.length;o<a;++o)(0,ob[s[o].getType()])(e,s[o],r,n)},Circle:function(e,i,r,n){var o=r.getFill(),a=r.getStroke();if(o||a){var s=e.getBuilder(r.getZIndex(),nG.CIRCLE);s.setFillStrokeStyle(o,a),s.drawCircle(i,n)}var l=r.getText();if(l){var h=e.getBuilder(r.getZIndex(),nG.TEXT);h.setTextStyle(l,e.addDeclutter(!1)),h.drawText(i,n)}}};function ow(e,i){return parseInt(tC(e),10)-parseInt(tC(i),10)}function oT(e,i){var r=.5*e/i;return r*r}function oS(e,i,r,n,o,a){var s=!1,l=r.getImage();if(l){var h=l.getImageState();h==rb.LOADED||h==rb.ERROR?l.unlistenImageChange(o):(h==rb.IDLE&&l.load(),h=l.getImageState(),l.listenImageChange(o),s=!0)}return function(e,i,r,n,o){var a=r.getGeometryFunction()(i);if(a){var s=a.simplifyTransformed(n,o);r.getRenderer()?function e(i,r,n,o){if(r.getType()==t8.GEOMETRY_COLLECTION){for(var a=r.getGeometries(),s=0,l=a.length;s<l;++s)e(i,a[s],n,o);return}i.getBuilder(n.getZIndex(),nG.DEFAULT).drawCustom(r,o,n.getRenderer())}(e,s,r,i):(0,ob[s.getType()])(e,s,r,i)}}(e,i,r,n,a),s}var oE=(F=function(e,i){return(F=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}F(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oI=function(e){function i(i){var r=e.call(this,i)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.dirty_=!1,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=tN(),r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r.clipping=!0,r}return oE(i,e),i.prototype.useContainer=function(i,r,n){n<1&&(i=null),e.prototype.useContainer.call(this,i,r,n)},i.prototype.renderFrame=function(e,i){var r=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];rD(this.pixelTransform,1/r,0,0,1/r,0,0),rN(this.inversePixelTransform,this.pixelTransform);var o=rj(this.pixelTransform);this.useContainer(i,o,n.opacity);var a=this.context,s=a.canvas,l=this.replayGroup_;if(!l||l.isEmpty())return!this.containerReused&&s.width>0&&(s.width=0),this.container;var h=Math.round(e.size[0]*r),u=Math.round(e.size[1]*r);s.width!=h||s.height!=u?(s.width=h,s.height=u,s.style.transform!==o&&(s.style.transform=o)):this.containerReused||a.clearRect(0,0,h,u),this.preRender(a,e);var c=e.extent,d=e.viewState,p=d.center,f=d.resolution,m=d.projection,g=d.rotation,_=m.getExtent(),y=this.getLayer().getSource(),v=!1;if(n.extent&&this.clipping){var x=ib(n.extent,m);(v=!tz(x,e.extent)&&t5(x,e.extent))&&this.clipUnrotated(a,e,x)}var b=e.viewHints,w=!(b[n6.ANIMATING]||b[n6.INTERACTING]),T=this.getRenderTransform(p,f,g,r,h,u,0),S=this.getLayer().getDeclutter()?{}:null;if(l.execute(a,1,T,g,w,void 0,S),y.getWrapX()&&m.canWrapX()&&!tz(_,c)){for(var E=c[0],I=t3(_),C=0,A=void 0;E<_[0];){A=I*--C;var R=this.getRenderTransform(p,f,g,r,h,u,A);l.execute(a,1,R,g,w,void 0,S),E+=I}for(C=0,E=c[2];E>_[2];){A=I*++C;var M=this.getRenderTransform(p,f,g,r,h,u,A);l.execute(a,1,M,g,w,void 0,S),E-=I}}if(S){var P=e.viewHints;n4(S,a,g,1,!(P[n6.ANIMATING]||P[n6.INTERACTING]),e.declutterItems)}v&&a.restore(),this.postRender(a,e);var O=n.opacity,k=this.container;return O!==parseFloat(k.style.opacity)&&(k.style.opacity=1===O?"":String(O)),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container},i.prototype.getFeatures=function(e){return new Promise((function(i,r){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];rz(this.pixelTransform,n);var o=this.renderedCenter_,a=this.renderedResolution_,s=this.renderedRotation_,l=this.renderedProjection_,h=this.renderedExtent_,u=this.getLayer(),c=[],d=n[0]/2,p=n[1]/2;c.push(this.getRenderTransform(o,a,s,.5,d,p,0).slice());var f=u.getSource(),m=l.getExtent();if(f.getWrapX()&&l.canWrapX()&&!tz(m,h)){for(var g=h[0],_=t3(m),y=0,v=void 0;g<m[0];)v=_*--y,c.push(this.getRenderTransform(o,a,s,.5,d,p,v).slice()),g+=_;for(y=0,g=h[2];g>m[2];)v=_*++y,c.push(this.getRenderTransform(o,a,s,.5,d,p,v).slice()),g-=_}this.hitDetectionImageData_=ov(n,c,this.renderedFeatures_,u.getStyleFunction(),h,a,s)}i(ox(e,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))},i.prototype.forEachFeatureAtCoordinate=function(e,i,r,n,o){if(this.replayGroup_){var a=i.viewState.resolution,s=i.viewState.rotation,l=this.getLayer(),h={};return this.replayGroup_.forEachFeatureAtCoordinate(e,a,s,r,function(e){var i=tC(e);if(!(i in h))return h[i]=!0,n(e,l)},l.getDeclutter()?o:null)}},i.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},i.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},i.prototype.prepareFrame=function(e){var i,r=this.getLayer(),n=r.getSource();if(!n)return!1;var o=e.viewHints[n6.ANIMATING],a=e.viewHints[n6.INTERACTING],s=r.getUpdateWhileAnimating(),l=r.getUpdateWhileInteracting();if(!this.dirty_&&!s&&o||!l&&a)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var h=e.extent,u=e.viewState,c=u.projection,d=u.resolution,p=e.pixelRatio,f=r.getRevision(),m=r.getRenderBuffer(),g=r.getRenderOrder();void 0===g&&(g=ow);var _=u.center.slice(),y=tO(h,m*d),v=[y.slice()],x=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!tz(x,e.extent)){var b=t3(x),w=Math.max(t3(y)/2,b);y[0]=x[0]-w,y[2]=x[2]+w,it(_,c);var T=function(e,i){var r=i.getExtent(),n=tK(e);if(i.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){var o=t3(r),a=Math.floor((n[0]-r[0])/o)*o;e[0]-=a,e[2]-=a}return e}(v[0],c);T[0]<x[0]&&T[2]<x[2]?v.push([T[0]+b,T[1],T[2]+b,T[3]]):T[0]>x[0]&&T[2]>x[2]&&v.push([T[0]-b,T[1],T[2]-b,T[3]])}if(!this.dirty_&&this.renderedResolution_==d&&this.renderedRevision_==f&&this.renderedRenderOrder_==g&&tz(this.renderedExtent_,y))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var S=new nz(.5*d/p,y,d,p,r.getDeclutter()),E=i_;if(E){for(var I=0,C=v.length;I<C;++I)n.loadFeatures(ix(v[I],c),d,E);i=id(E,c)}else for(var I=0,C=v.length;I<C;++I)n.loadFeatures(v[I],d,c);var A=oT(d,p),R=(function(e){var n,o=e.getStyleFunction()||r.getStyleFunction();if(o&&(n=o(e,d)),n){var a=this.renderFeature(e,A,n,S,i);this.dirty_=this.dirty_||a}}).bind(this),M=ix(y,c),P=n.getFeaturesInExtent(M);g&&P.sort(g);for(var I=0,C=P.length;I<C;++I)R(P[I]);this.renderedFeatures_=P;var O=S.finish(),k=new n2(y,d,p,n.getOverlaps(),O,r.getRenderBuffer());return this.renderedResolution_=d,this.renderedRevision_=f,this.renderedRenderOrder_=g,this.renderedExtent_=y,this.renderedCenter_=_,this.renderedProjection_=c,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},i.prototype.renderFeature=function(e,i,r,n,o){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var s=0,l=r.length;s<l;++s)a=oS(n,e,r[s],i,this.boundHandleStyleImageChange_,o)||a;else a=oS(n,e,r,i,this.boundHandleStyleImageChange_,o);return a},i}(nU),oC=(B=function(e,i){return(B=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}B(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oA=function(e){function i(i){return e.call(this,i)||this}return oC(i,e),i.prototype.createRenderer=function(){return new oI(this)},i}(nu),oR={ADD:"add",REMOVE:"remove"},oM=(N=function(e,i){return(N=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}N(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oP="length",oO=function(e){function i(i,r,n){var o=e.call(this,i)||this;return o.element=r,o.index=n,o}return oM(i,e),i}(iw),ok=function(e){function i(i,r){var n=e.call(this)||this;if(n.unique_=!!(r||{}).unique,n.array_=i||[],n.unique_)for(var o=0,a=n.array_.length;o<a;++o)n.assertUnique_(n.array_[o],o);return n.updateLength_(),n}return oM(i,e),i.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},i.prototype.extend=function(e){for(var i=0,r=e.length;i<r;++i)this.push(e[i]);return this},i.prototype.forEach=function(e){for(var i=this.array_,r=0,n=i.length;r<n;++r)e(i[r],r,i)},i.prototype.getArray=function(){return this.array_},i.prototype.item=function(e){return this.array_[e]},i.prototype.getLength=function(){return this.get(oP)},i.prototype.insertAt=function(e,i){this.unique_&&this.assertUnique_(i),this.array_.splice(e,0,i),this.updateLength_(),this.dispatchEvent(new oO(oR.ADD,i,e))},i.prototype.pop=function(){return this.removeAt(this.getLength()-1)},i.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var i=this.getLength();return this.insertAt(i,e),this.getLength()},i.prototype.remove=function(e){for(var i=this.array_,r=0,n=i.length;r<n;++r)if(i[r]===e)return this.removeAt(r)},i.prototype.removeAt=function(e){var i=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new oO(oR.REMOVE,i,e)),i},i.prototype.setAt=function(e,i){var r=this.getLength();if(e<r){this.unique_&&this.assertUnique_(i,e);var n=this.array_[e];this.array_[e]=i,this.dispatchEvent(new oO(oR.REMOVE,n,e)),this.dispatchEvent(new oO(oR.ADD,i,e))}else{for(var o=r;o<e;++o)this.insertAt(o,void 0);this.insertAt(e,i)}},i.prototype.updateLength_=function(){this.set(oP,this.array_.length)},i.prototype.assertUnique_=function(e,i){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===e&&r!==i)throw new tR(58)},i}(iU),oL=function(){function e(e){this.rbush_=new(e1(nq))(e),this.items_={}}return e.prototype.insert=function(e,i){var r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:i};this.rbush_.insert(r),this.items_[tC(i)]=r},e.prototype.load=function(e,i){for(var r=Array(i.length),n=0,o=i.length;n<o;n++){var a=e[n],s=i[n],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};r[n]=l,this.items_[tC(s)]=l}this.rbush_.load(r)},e.prototype.remove=function(e){var i=tC(e),r=this.items_[i];return delete this.items_[i],null!==this.rbush_.remove(r)},e.prototype.update=function(e,i){var r=this.items_[tC(i)];tG([r.minX,r.minY,r.maxX,r.maxY],e)||(this.remove(i),this.insert(e,i))},e.prototype.getAll=function(){return this.rbush_.all().map(function(e){return e.value})},e.prototype.getInExtent=function(e){var i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(i).map(function(e){return e.value})},e.prototype.forEach=function(e){return this.forEach_(this.getAll(),e)},e.prototype.forEachInExtent=function(e,i){return this.forEach_(this.getInExtent(e),i)},e.prototype.forEach_=function(e,i){for(var r,n=0,o=e.length;n<o&&!(r=i(e[n]));n++);return r},e.prototype.isEmpty=function(){return tx(this.items_)},e.prototype.clear=function(){this.rbush_.clear(),this.items_={}},e.prototype.getExtent=function(e){var i=this.rbush_.toJSON();return tj(i.minX,i.minY,i.maxX,i.maxY,e)},e.prototype.concat=function(e){for(var i in this.rbush_.load(e.rbush_.all()),e.items_)this.items_[i]=e.items_[i]},e}(),oD=(j=function(e,i){return(j=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}j(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oz=function(e){function i(i){var r=e.call(this)||this;return r.projection_=ia(i.projection),r.attributions_=oF(i.attributions),r.attributionsCollapsible_=void 0===i.attributionsCollapsible||i.attributionsCollapsible,r.loading=!1,r.state_=void 0!==i.state?i.state:r_.READY,r.wrapX_=void 0!==i.wrapX&&i.wrapX,r}return oD(i,e),i.prototype.getAttributions=function(){return this.attributions_},i.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},i.prototype.getProjection=function(){return this.projection_},i.prototype.getResolutions=function(){return tE()},i.prototype.getState=function(){return this.state_},i.prototype.getWrapX=function(){return this.wrapX_},i.prototype.getContextOptions=function(){},i.prototype.refresh=function(){this.changed()},i.prototype.setAttributions=function(e){this.attributions_=oF(e),this.changed()},i.prototype.setState=function(e){this.state_=e,this.changed()},i}(iU);function oF(e){return e?Array.isArray(e)?function(i){return e}:"function"==typeof e?e:function(i){return[e]}:null}var oB={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};function oN(e,i){return[[-1/0,-1/0,1/0,1/0]]}var oj={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function oV(e,i,r,n){return function(o,a,s){var l=new XMLHttpRequest;l.open("GET","function"==typeof e?e(o,a,s):e,!0),i.getType()==oj.ARRAY_BUFFER&&(l.responseType="arraybuffer"),l.withCredentials=!1,l.onload=(function(e){if(!l.status||l.status>=200&&l.status<300){var a=i.getType(),h=void 0;a==oj.JSON||a==oj.TEXT?h=l.responseText:a==oj.XML?(h=l.responseXML)||(h=new DOMParser().parseFromString(l.responseText,"application/xml")):a==oj.ARRAY_BUFFER&&(h=l.response),h?r.call(this,i.readFeatures(h,{extent:o,featureProjection:s}),i.readProjection(h)):n.call(this)}else n.call(this)}).bind(this),l.onerror=(function(){n.call(this)}).bind(this),l.send()}}function oU(e,i){return oV(e,i,function(e,i){"function"==typeof this.addFeatures&&this.addFeatures(e)},iP)}var oG=(V=function(e,i){return(V=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}V(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oq=function(e){function i(i,r){var n=e.call(this,i)||this;return n.feature=r,n}return oG(i,e),i}(iw),o$=function(e){function i(i){var r,n,o=this,a=i||{};(o=e.call(this,{attributions:a.attributions,projection:void 0,state:r_.READY,wrapX:void 0===a.wrapX||a.wrapX})||this).loader_=iP,o.format_=a.format,o.overlaps_=void 0===a.overlaps||a.overlaps,o.url_=a.url,void 0!==a.loader?o.loader_=a.loader:void 0!==o.url_&&(tM(o.format_,7),o.loader_=oU(o.url_,o.format_)),o.strategy_=void 0!==a.strategy?a.strategy:oN;var s=void 0===a.useSpatialIndex||a.useSpatialIndex;return o.featuresRtree_=s?new oL:null,o.loadedExtentsRtree_=new oL,o.nullGeometryFeatures_={},o.idIndex_={},o.uidIndex_={},o.featureChangeKeys_={},o.featuresCollection_=null,Array.isArray(a.features)?n=a.features:a.features&&(n=(r=a.features).getArray()),s||void 0!==r||(r=new ok(n)),void 0!==n&&o.addFeaturesInternal(n),void 0!==r&&o.bindFeaturesCollection_(r),o}return oG(i,e),i.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},i.prototype.addFeatureInternal=function(e){var i=tC(e);if(!this.addToIndex_(i,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(i,e);var r=e.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[i]=e;this.dispatchEvent(new oq(oB.ADDFEATURE,e))},i.prototype.setupChangeEvents_=function(e,i){this.featureChangeKeys_[e]=[iD(i,iL.CHANGE,this.handleFeatureChange_,this),iD(i,iT.PROPERTYCHANGE,this.handleFeatureChange_,this)]},i.prototype.addToIndex_=function(e,i){var r=!0,n=i.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=i),r&&(tM(!(e in this.uidIndex_),30),this.uidIndex_[e]=i),r},i.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},i.prototype.addFeaturesInternal=function(e){for(var i=[],r=[],n=[],o=0,a=e.length;o<a;o++){var s=e[o],l=tC(s);this.addToIndex_(l,s)&&r.push(s)}for(var o=0,h=r.length;o<h;o++){var s=r[o],l=tC(s);this.setupChangeEvents_(l,s);var u=s.getGeometry();if(u){var c=u.getExtent();i.push(c),n.push(s)}else this.nullGeometryFeatures_[l]=s}this.featuresRtree_&&this.featuresRtree_.load(i,n);for(var o=0,d=r.length;o<d;o++)this.dispatchEvent(new oq(oB.ADDFEATURE,r[o]))},i.prototype.bindFeaturesCollection_=function(e){var i=!1;this.addEventListener(oB.ADDFEATURE,function(r){i||(i=!0,e.push(r.feature),i=!1)}),this.addEventListener(oB.REMOVEFEATURE,function(r){i||(i=!0,e.remove(r.feature),i=!1)}),e.addEventListener(oR.ADD,(function(e){i||(i=!0,this.addFeature(e.element),i=!1)}).bind(this)),e.addEventListener(oR.REMOVE,(function(e){i||(i=!0,this.removeFeature(e.element),i=!1)}).bind(this)),this.featuresCollection_=e},i.prototype.clear=function(e){if(e){for(var i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(iz);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var r in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var n=new oq(oB.CLEAR);this.dispatchEvent(n),this.changed()},i.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},i.prototype.forEachFeatureAtCoordinateDirect=function(e,i){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(e)?i(r):void 0})},i.prototype.forEachFeatureInExtent=function(e,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)},i.prototype.forEachFeatureIntersectingExtent=function(e,i){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)){var n=i(r);if(n)return n}})},i.prototype.getFeaturesCollection=function(){return this.featuresCollection_},i.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray():this.featuresRtree_&&(e=this.featuresRtree_.getAll(),tx(this.nullGeometryFeatures_)||iC(e,tv(this.nullGeometryFeatures_))),e},i.prototype.getFeaturesAtCoordinate=function(e){var i=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){i.push(e)}),i},i.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_?this.featuresRtree_.getInExtent(e):this.featuresCollection_?this.featuresCollection_.getArray():[]},i.prototype.getClosestFeatureToCoordinate=function(e,i){var r=e[0],n=e[1],o=null,a=[NaN,NaN],s=1/0,l=[-1/0,-1/0,1/0,1/0],h=i||iR;return this.featuresRtree_.forEachInExtent(l,function(e){if(h(e)){var i=e.getGeometry(),u=s;if((s=i.closestPointXY(r,n,a,s))<u){o=e;var c=Math.sqrt(s);l[0]=r-c,l[1]=n-c,l[2]=r+c,l[3]=n+c}}}),o},i.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},i.prototype.getFeatureById=function(e){var i=this.idIndex_[e.toString()];return void 0!==i?i:null},i.prototype.getFeatureByUid=function(e){var i=this.uidIndex_[e];return void 0!==i?i:null},i.prototype.getFormat=function(){return this.format_},i.prototype.getOverlaps=function(){return this.overlaps_},i.prototype.getUrl=function(){return this.url_},i.prototype.handleFeatureChange_=function(e){var i=e.target,r=tC(i),n=i.getGeometry();if(n){var o=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,i)):this.featuresRtree_&&this.featuresRtree_.update(o,i)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[r]=i);var a=i.getId();if(void 0!==a){var s=a.toString();this.idIndex_[s]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[s]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[r]=i;this.changed(),this.dispatchEvent(new oq(oB.CHANGEFEATURE,i))},i.prototype.hasFeature=function(e){var i=e.getId();return void 0!==i?i in this.idIndex_:tC(e)in this.uidIndex_},i.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&tx(this.nullGeometryFeatures_)},i.prototype.loadFeatures=function(e,i,r){var n=this.loadedExtentsRtree_,o=this.strategy_(e,i);this.loading=!1;for(var a=this,s=0,l=o.length;s<l;++s)!function(e,s){var l=o[e];n.forEachInExtent(l,function(e){return tz(e.extent,l)})||(a.loader_.call(a,l,i,r),n.insert(l,{extent:l.slice()}),a.loading=a.loader_!==iP)}(s,0)},i.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),e.prototype.refresh.call(this)},i.prototype.removeLoadedExtent=function(e){var i,r=this.loadedExtentsRtree_;r.forEachInExtent(e,function(r){if(tG(r.extent,e))return i=r,!0}),i&&r.remove(i)},i.prototype.removeFeature=function(e){var i=tC(e);i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},i.prototype.removeFeatureInternal=function(e){var i=tC(e);this.featureChangeKeys_[i].forEach(iz),delete this.featureChangeKeys_[i];var r=e.getId();void 0!==r&&delete this.idIndex_[r.toString()],delete this.uidIndex_[i],this.dispatchEvent(new oq(oB.REMOVEFEATURE,e))},i.prototype.removeFromIdIndex_=function(e){var i=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],i=!0;break}return i},i.prototype.setLoader=function(e){this.loader_=e},i.prototype.setUrl=function(e){tM(this.format_,7),this.setLoader(oU(e,this.format_))},i}(oz),oH=(U=function(e,i){return(U=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}U(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oZ=function(e){function i(i){var r=e.call(this)||this;return r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addEventListener(iq(r.geometryName_),r.handleGeometryChanged_),i&&("function"==typeof i.getSimplifiedGeometry?r.setGeometry(i):r.setProperties(i)),r}return oH(i,e),i.prototype.clone=function(){var e=new i(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&e.setGeometry(r.clone());var n=this.getStyle();return n&&e.setStyle(n),e},i.prototype.getGeometry=function(){return this.get(this.geometryName_)},i.prototype.getId=function(){return this.id_},i.prototype.getGeometryName=function(){return this.geometryName_},i.prototype.getStyle=function(){return this.style_},i.prototype.getStyleFunction=function(){return this.styleFunction_},i.prototype.handleGeometryChange_=function(){this.changed()},i.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(iz(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=iD(e,iL.CHANGE,this.handleGeometryChange_,this)),this.changed()},i.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},i.prototype.setStyle=function(e){var i,r;this.style_=e,this.styleFunction_=e?"function"==typeof(i=e)?i:(Array.isArray(i)?r=i:(tM("function"==typeof i.getZIndex,41),r=[i]),function(){return r}):void 0,this.changed()},i.prototype.setId=function(e){this.id_=e,this.changed()},i.prototype.setGeometryName=function(e){this.removeEventListener(iq(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=e,this.addEventListener(iq(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},i}(iU);function oW(e,i,r,n){for(var o=0,a=r.length;o<a;++o)for(var s=r[o],l=0;l<n;++l)e[i++]=s[l];return i}function oX(e,i,r,n,o){for(var a=o||[],s=0,l=0,h=r.length;l<h;++l){var u=oW(e,i,r[l],n);a[s++]=u,i=u}return a.length=s,a}var oY=(G=function(e,i){return(G=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}G(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oK=function(e){function i(i,r){var n=e.call(this)||this;return n.setCoordinates(i,r),n}return oY(i,e),i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(e,i,r,n){var o=this.flatCoordinates,a=ti(e,i,o[0],o[1]);if(!(a<n))return n;for(var s=this.stride,l=0;l<s;++l)r[l]=o[l];return r.length=s,a},i.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},i.prototype.computeExtent=function(e){return tU(this.flatCoordinates,e)},i.prototype.getType=function(){return t8.POINT},i.prototype.intersectsExtent=function(e){return tF(e,this.flatCoordinates[0],this.flatCoordinates[1])},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(e,i,r,n){for(var o=0,a=r.length;o<a;++o)e[i++]=r[o];return i}(this.flatCoordinates,0,e,this.stride),this.changed()},i}(oi),oJ=(q=function(e,i){return(q=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}q(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),oQ=function(e){function i(i){var r=e.call(this)||this;return r.geometries_=i||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return oJ(i,e),i.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(iz),this.changeEventsKeys_.length=0},i.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var e=0,i=this.geometries_.length;e<i;++e)this.changeEventsKeys_.push(iD(this.geometries_[e],iL.CHANGE,this.changed,this))},i.prototype.clone=function(){var e=new i(null);return e.setGeometries(this.geometries_),e},i.prototype.closestPointXY=function(e,i,r,n){if(n<tL(this.getExtent(),e,i))return n;for(var o=this.geometries_,a=0,s=o.length;a<s;++a)n=o[a].closestPointXY(e,i,r,n);return n},i.prototype.containsXY=function(e,i){for(var r=this.geometries_,n=0,o=r.length;n<o;++n)if(r[n].containsXY(e,i))return!0;return!1},i.prototype.computeExtent=function(e){tV(e);for(var i=this.geometries_,r=0,n=i.length;r<n;++r)tq(e,i[r].getExtent());return e},i.prototype.getGeometries=function(){return o0(this.geometries_)},i.prototype.getGeometriesArray=function(){return this.geometries_},i.prototype.getGeometriesArrayRecursive=function(){for(var e=[],i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].getType()===this.getType()?e=e.concat(i[r].getGeometriesArrayRecursive()):e.push(i[r]);return e},i.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],n=this.geometries_,o=!1,a=0,s=n.length;a<s;++a){var l=n[a],h=l.getSimplifiedGeometry(e);r.push(h),h!==l&&(o=!0)}if(!o)return this.simplifiedGeometryMaxMinSquaredTolerance=e,this;var u=new i(null);return u.setGeometriesArray(r),u},i.prototype.getType=function(){return t8.GEOMETRY_COLLECTION},i.prototype.intersectsExtent=function(e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)if(i[r].intersectsExtent(e))return!0;return!1},i.prototype.isEmpty=function(){return 0===this.geometries_.length},i.prototype.rotate=function(e,i){for(var r=this.geometries_,n=0,o=r.length;n<o;++n)r[n].rotate(e,i);this.changed()},i.prototype.scale=function(e,i,r){var n=r;n||(n=tK(this.getExtent()));for(var o=this.geometries_,a=0,s=o.length;a<s;++a)o[a].scale(e,i,n);this.changed()},i.prototype.setGeometries=function(e){this.setGeometriesArray(o0(e))},i.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},i.prototype.applyTransform=function(e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].applyTransform(e);this.changed()},i.prototype.translate=function(e,i){for(var r=this.geometries_,n=0,o=r.length;n<o;++n)r[n].translate(e,i);this.changed()},i.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),e.prototype.disposeInternal.call(this)},i}(n7);function o0(e){for(var i=[],r=0,n=e.length;r<n;++r)i.push(e[r].clone());return i}var o1=function(){function e(){this.dataProjection=null,this.defaultFeatureProjection=null}return e.prototype.getReadOptions=function(e,i){var r;if(i){var n=i.dataProjection?ia(i.dataProjection):this.readProjection(e);i.extent&&n&&n.getUnits()===e6.TILE_PIXELS&&(n=ia(n)).setWorldExtent(i.extent),r={dataProjection:n,featureProjection:i.featureProjection}}return this.adaptOptions(r)},e.prototype.adaptOptions=function(e){return t_({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)},e.prototype.getType=function(){return tE()},e.prototype.readFeature=function(e,i){return tE()},e.prototype.readFeatures=function(e,i){return tE()},e.prototype.readGeometry=function(e,i){return tE()},e.prototype.readProjection=function(e){return tE()},e.prototype.writeFeature=function(e,i){return tE()},e.prototype.writeFeatures=function(e,i){return tE()},e.prototype.writeGeometry=function(e,i){return tE()},e}();function o2(e,i,r){var n,o=r?ia(r.featureProjection):null,a=r?ia(r.dataProjection):null;if(n=o&&a&&!ic(o,a)?(i?e.clone():e).transform(i?o:a,i?a:o):e,i&&r&&void 0!==r.decimals){var s=Math.pow(10,r.decimals);n===e&&(n=e.clone()),n.applyTransform(function(e){for(var i=0,r=e.length;i<r;++i)e[i]=Math.round(e[i]*s)/s;return e})}return n}var o3=($=function(e,i){return($=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}$(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),o5=function(e){function i(){return e.call(this)||this}return o3(i,e),i.prototype.getType=function(){return oj.JSON},i.prototype.readFeature=function(e,i){return this.readFeatureFromObject(o4(e),this.getReadOptions(e,i))},i.prototype.readFeatures=function(e,i){return this.readFeaturesFromObject(o4(e),this.getReadOptions(e,i))},i.prototype.readFeatureFromObject=function(e,i){return tE()},i.prototype.readFeaturesFromObject=function(e,i){return tE()},i.prototype.readGeometry=function(e,i){return this.readGeometryFromObject(o4(e),this.getReadOptions(e,i))},i.prototype.readGeometryFromObject=function(e,i){return tE()},i.prototype.readProjection=function(e){return this.readProjectionFromObject(o4(e))},i.prototype.readProjectionFromObject=function(e){return tE()},i.prototype.writeFeature=function(e,i){return JSON.stringify(this.writeFeatureObject(e,i))},i.prototype.writeFeatureObject=function(e,i){return tE()},i.prototype.writeFeatures=function(e,i){return JSON.stringify(this.writeFeaturesObject(e,i))},i.prototype.writeFeaturesObject=function(e,i){return tE()},i.prototype.writeGeometry=function(e,i){return JSON.stringify(this.writeGeometryObject(e,i))},i.prototype.writeGeometryObject=function(e,i){return tE()},i}(o1);function o4(e){return"string"==typeof e?JSON.parse(e)||null:null!==e?e:null}function o6(e,i,r,n,o,a,s){var l,h=e[i],u=e[i+1],c=e[r]-h,d=e[r+1]-u;if(0===c&&0===d)l=i;else{var p=((o-h)*c+(a-u)*d)/(c*c+d*d);if(p>1)l=r;else if(p>0){for(var f,m=0;m<n;++m)s[m]=(f=e[i+m],f+p*(e[r+m]-f));s.length=n;return}else l=i}for(var m=0;m<n;++m)s[m]=e[l+m];s.length=n}function o8(e,i,r,n,o){var a=e[i],s=e[i+1];for(i+=n;i<r;i+=n){var l=e[i],h=e[i+1],u=ti(a,s,l,h);u>o&&(o=u),a=l,s=h}return o}function o9(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){var l=r[a];o=o8(e,i,l,n,o),i=l}return o}function o7(e,i,r,n,o,a,s,l,h,u,c){if(i==r)return u;if(0===o){if(!((p=ti(s,l,e[i],e[i+1]))<u))return u;for(d=0;d<n;++d)h[d]=e[i+d];return h.length=n,p}for(var d,p,f=c||[NaN,NaN],m=i+n;m<r;)if(o6(e,m-n,m,n,s,l,f),(p=ti(s,l,f[0],f[1]))<u){for(d=0,u=p;d<n;++d)h[d]=f[d];h.length=n,m+=n}else m+=n*Math.max((Math.sqrt(p)-Math.sqrt(u))/o|0,1);if(a&&(o6(e,r-n,i,n,s,l,f),(p=ti(s,l,f[0],f[1]))<u)){for(d=0,u=p;d<n;++d)h[d]=f[d];h.length=n}return u}function ae(e,i,r,n,o,a,s,l,h,u,c){for(var d=c||[NaN,NaN],p=0,f=r.length;p<f;++p){var m=r[p];u=o7(e,i,m,n,o,a,s,l,h,u,d),i=m}return u}function at(e,i,r,n,o){for(var a,s=[e[i],e[i+1]],l=[];i+n<r;i+=n){if(l[0]=e[i+n],l[1]=e[i+n+1],a=o(s,l))return a;s[0]=l[0],s[1]=l[1]}return!1}function ai(e,i,r,n,o,a,s){var l,h,u,c=(r-i)/n;if(1===c)h=i;else if(2===c)h=i,u=o;else if(0!==c){for(var d=e[i],p=e[i+1],f=0,m=[0],g=i+n;g<r;g+=n){var _=e[g],y=e[g+1];f+=Math.sqrt((_-d)*(_-d)+(y-p)*(y-p)),m.push(f),d=_,p=y}var v=o*f,x=function(e,i,r){for(var n,o,a=0,s=e.length,l=!1;a<s;)(o=+iE(e[n=a+(s-a>>1)],i))<0?a=n+1:(s=n,l=!o);return l?a:~a}(m,v);x<0?(u=(v-m[-x-2])/(m[-x-1]-m[-x-2]),h=i+(-x-2)*n):h=i+x*n}for(var b=s>1?s:2,w=a||Array(b),g=0;g<b;++g)w[g]=void 0===h?NaN:void 0===u?e[h+g]:(l=e[h+g],l+u*(e[h+n+g]-l));return w}function ar(e,i,r,n,o,a){if(r==i)return null;if(o<e[i+n-1])if(a)return(l=e.slice(i,i+n))[n-1]=o,l;else return null;if(e[r-1]<o)if(a)return(l=e.slice(r-n,r))[n-1]=o,l;else return null;if(o==e[i+n-1])return e.slice(i,i+n);for(var s,l,h=i/n,u=r/n;h<u;){var c=h+u>>1;o<e[(c+1)*n-1]?u=c:h=c+1}var d=e[h*n-1];if(o==d)return e.slice((h-1)*n,(h-1)*n+n);var p=(o-d)/(e[(h+1)*n-1]-d);l=[];for(var f=0;f<n-1;++f)l.push((s=e[(h-1)*n+f],s+p*(e[h*n+f]-s)));return l.push(o),l}function an(e,i,r,n,o,a){for(var s=0,l=e[r-n],h=e[r-n+1];i<r;i+=n){var u=e[i],c=e[i+1];h<=a?c>a&&(u-l)*(a-h)-(o-l)*(c-h)>0&&s++:c<=a&&(u-l)*(a-h)-(o-l)*(c-h)<0&&s--,l=u,h=c}return 0!==s}function ao(e,i,r,n,o,a){if(0===r.length||!an(e,i,r[0],n,o,a))return!1;for(var s=1,l=r.length;s<l;++s)if(an(e,r[s-1],r[s],n,o,a))return!1;return!0}function aa(e,i,r,n,o){var a=tH(tN(),e,i,r,n);return!!t5(o,a)&&(!!tz(o,a)||a[0]>=o[0]&&a[2]<=o[2]||a[1]>=o[1]&&a[3]<=o[3]||at(e,i,r,n,function(e,i){return function(e,i,r){var n=!1,o=tB(e,i),a=tB(e,r);if(o===tS.INTERSECTING||a===tS.INTERSECTING)n=!0;else{var s=e[0],l=e[1],h=e[2],u=e[3],c=i[0],d=i[1],p=r[0],f=r[1],m=(f-d)/(p-c),g=void 0,_=void 0;a&tS.ABOVE&&!(o&tS.ABOVE)&&(n=(g=p-(f-u)/m)>=s&&g<=h),n||!(a&tS.RIGHT)||o&tS.RIGHT||(n=(_=f-(p-h)*m)>=l&&_<=u),n||!(a&tS.BELOW)||o&tS.BELOW||(n=(g=p-(f-l)/m)>=s&&g<=h),n||!(a&tS.LEFT)||o&tS.LEFT||(n=(_=f-(p-s)*m)>=l&&_<=u)}return n}(o,e,i)}))}function as(e,i,r,n,o){var a;if(!(aa(e,i,a=r[0],n,o)||an(e,i,a,n,o[0],o[1])||an(e,i,a,n,o[0],o[3])||an(e,i,a,n,o[2],o[1])||an(e,i,a,n,o[2],o[3]))&&1)return!1;if(1===r.length)return!0;for(var s=1,l=r.length;s<l;++s)if(function(e,i,r,n,o){return!tZ(o,function(o){return!an(e,i,r,n,o[0],o[1])})}(e,r[s-1],r[s],n,o)&&!aa(e,r[s-1],r[s],n,o))return!1;return!0}var al=(H=function(e,i){return(H=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}H(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ah=function(e){function i(i,r){var n=e.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(i[0])?n.setCoordinates(i,r):n.setFlatCoordinates(r,i),n}return al(i,e),i.prototype.appendCoordinate=function(e){this.flatCoordinates?iC(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()},i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(e,i,r,n){return n<tL(this.getExtent(),e,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(o8(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),o7(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,i,r,n))},i.prototype.forEachSegment=function(e){return at(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},i.prototype.getCoordinateAtM=function(e,i){return this.layout!=oe.XYM&&this.layout!=oe.XYZM?null:ar(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,void 0!==i&&i)},i.prototype.getCoordinates=function(){return n_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getCoordinateAt=function(e,i){return ai(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,i,this.stride)},i.prototype.getLength=function(){return nZ(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},i.prototype.getSimplifiedGeometryInternal=function(e){var r=[];return r.length=nI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,r,0),new i(r,oe.XY)},i.prototype.getType=function(){return t8.LINE_STRING},i.prototype.intersectsExtent=function(e){return aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oW(this.flatCoordinates,0,e,this.stride),this.changed()},i}(oi),au=(Z=function(e,i){return(Z=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}Z(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ac=function(e){function i(i,r,n){var o=e.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(i[0]))o.setCoordinates(i,r);else if(void 0!==r&&n)o.setFlatCoordinates(r,i),o.ends_=n;else{for(var a=o.getLayout(),s=[],l=[],h=0,u=i.length;h<u;++h){var c=i[h];0===h&&(a=c.getLayout()),iC(s,c.getFlatCoordinates()),l.push(s.length)}o.setFlatCoordinates(a,s),o.ends_=l}return o}return au(i,e),i.prototype.appendLineString=function(e){this.flatCoordinates?iC(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},i.prototype.closestPointXY=function(e,i,r,n){return n<tL(this.getExtent(),e,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(o9(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ae(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,i,r,n))},i.prototype.getCoordinateAtM=function(e,i,r){return this.layout!=oe.XYM&&this.layout!=oe.XYZM||0===this.flatCoordinates.length?null:function(e,i,r,n,o,a,s){if(s)return ar(e,i,r[r.length-1],n,o,a);if(o<e[n-1])if(a)return(l=e.slice(0,n))[n-1]=o,l;else return null;if(e[e.length-1]<o)if(a)return(l=e.slice(e.length-n))[n-1]=o,l;else return null;for(var l,h=0,u=r.length;h<u;++h){var c=r[h];if(i!=c){if(o<e[i+n-1])return null;if(o<=e[c-1])return ar(e,i,c,n,o,!1);i=c}}return null}(this.flatCoordinates,0,this.ends_,this.stride,e,void 0!==i&&i,void 0!==r&&r)},i.prototype.getCoordinates=function(){return ny(this.flatCoordinates,0,this.ends_,this.stride)},i.prototype.getEnds=function(){return this.ends_},i.prototype.getLineString=function(e){return e<0||this.ends_.length<=e?null:new ah(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},i.prototype.getLineStrings=function(){for(var e=this.flatCoordinates,i=this.ends_,r=this.layout,n=[],o=0,a=0,s=i.length;a<s;++a){var l=i[a],h=new ah(e.slice(o,l),r);n.push(h),o=l}return n},i.prototype.getFlatMidpoints=function(){for(var e=[],i=this.flatCoordinates,r=0,n=this.ends_,o=this.stride,a=0,s=n.length;a<s;++a){var l=n[a];iC(e,ai(i,r,l,o,.5)),r=l}return e},i.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=function(e,i,r,n,o,a,s,l){for(var h=0,u=r.length;h<u;++h){var c=r[h];s=nI(e,i,c,n,o,a,s),l.push(s),i=c}return s}(this.flatCoordinates,0,this.ends_,this.stride,e,r,0,n),new i(r,oe.XY,n)},i.prototype.getType=function(){return t8.MULTI_LINE_STRING},i.prototype.intersectsExtent=function(e){return function(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){if(aa(e,i,r[a],n,o))return!0;i=r[a]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,e)},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=oX(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},i}(oi),ad=(W=function(e,i){return(W=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}W(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ap=function(e){function i(i,r){var n=e.call(this)||this;return r&&!Array.isArray(i[0])?n.setFlatCoordinates(r,i):n.setCoordinates(i,r),n}return ad(i,e),i.prototype.appendPoint=function(e){this.flatCoordinates?iC(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()},i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(e,i,r,n){if(n<tL(this.getExtent(),e,i))return n;for(var o=this.flatCoordinates,a=this.stride,s=0,l=o.length;s<l;s+=a){var h=ti(e,i,o[s],o[s+1]);if(h<n){n=h;for(var u=0;u<a;++u)r[u]=o[s+u];r.length=a}}return n},i.prototype.getCoordinates=function(){return n_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getPoint=function(e){var i=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||i<=e?null:new oK(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)},i.prototype.getPoints=function(){for(var e=this.flatCoordinates,i=this.layout,r=this.stride,n=[],o=0,a=e.length;o<a;o+=r){var s=new oK(e.slice(o,o+r),i);n.push(s)}return n},i.prototype.getType=function(){return t8.MULTI_POINT},i.prototype.intersectsExtent=function(e){for(var i=this.flatCoordinates,r=this.stride,n=0,o=i.length;n<o;n+=r)if(tF(e,i[n],i[n+1]))return!0;return!1},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oW(this.flatCoordinates,0,e,this.stride),this.changed()},i}(oi);function af(e,i,r,n){for(var o=0,a=e[r-n],s=e[r-n+1];i<r;i+=n){var l=e[i],h=e[i+1];o+=s*l-a*h,a=l,s=h}return o/2}function am(e,i,r,n){for(var o=0,a=0,s=r.length;a<s;++a){var l=r[a];o+=af(e,i,l,n),i=l}return o}var ag=(X=function(e,i){return(X=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}X(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),a_=function(e){function i(i,r){var n=e.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(i[0])?n.setCoordinates(i,r):n.setFlatCoordinates(r,i),n}return ag(i,e),i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout)},i.prototype.closestPointXY=function(e,i,r,n){return n<tL(this.getExtent(),e,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(o8(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),o7(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,i,r,n))},i.prototype.getArea=function(){return af(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getCoordinates=function(){return n_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},i.prototype.getSimplifiedGeometryInternal=function(e){var r=[];return r.length=nI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,r,0),new i(r,oe.XY)},i.prototype.getType=function(){return t8.LINEAR_RING},i.prototype.intersectsExtent=function(e){return!1},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=oW(this.flatCoordinates,0,e,this.stride),this.changed()},i}(oi);function ay(e,i,r,n,o,a,s){for(var l,h,u,c,d,p,f,m=o[a+1],g=[],_=0,y=r.length;_<y;++_){var v=r[_];for(c=e[v-n],p=e[v-n+1],l=i;l<v;l+=n)d=e[l],f=e[l+1],(m<=p&&f<=m||p<=m&&m<=f)&&(u=(m-p)/(f-p)*(d-c)+c,g.push(u)),c=d,p=f}var x=NaN,b=-1/0;for(g.sort(iE),c=g[0],l=1,h=g.length;l<h;++l){var w=Math.abs((d=g[l])-c);w>b&&ao(e,i,r,n,u=(c+d)/2,m)&&(x=u,b=w),c=d}return(isNaN(x)&&(x=o[a]),s)?(s.push(x,m,b),s):[x,m,b]}function av(e,i,r,n,o){for(var a=[],s=0,l=r.length;s<l;++s){var h=r[s];a=ay(e,i,h,n,o,2*s,a),i=h[h.length-1]}return a}function ax(e,i,r,n){for(var o=!0,a=0;a<n;++a)if(e[i+a]!==e[r-n+a]){o=!1;break}o&&(r-=n);var s=function(e,i,r,n){for(var o=-1,a=1/0,s=1/0,l=i;l<r;l+=n){var h=e[l],u=e[l+1];!(u>a)&&(u==a&&h>=s||(o=l,a=u,s=h))}return o}(e,i,r,n),l=s-n;l<i&&(l=r-n);var h=s+n;h>=r&&(h=i);var u=e[l],c=e[l+1],d=e[s],p=e[s+1],f=e[h],m=e[h+1];return d*m+u*p+c*f-(c*d+p*f+u*m)<0}function ab(e,i,r,n,o){for(var a=void 0!==o&&o,s=0,l=r.length;s<l;++s){var h=r[s],u=ax(e,i,h,n);if(0===s){if(a&&u||!a&&!u)return!1}else if(a&&!u||!a&&u)return!1;i=h}return!0}function aw(e,i,r,n,o){for(var a=void 0!==o&&o,s=0,l=r.length;s<l;++s){var h=r[s],u=ax(e,i,h,n);(0===s?a&&u||!a&&!u:a&&!u||!a&&u)&&function(e,i,r,n){for(;i<r-n;){for(var o=0;o<n;++o){var a=e[i+o];e[i+o]=e[r-n+o],e[r-n+o]=a}i+=n,r-=n}}(e,i,h,n),i=h}return i}function aT(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a)i=aw(e,i,r[a],n,o);return i}var aS=(Y=function(e,i){return(Y=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}Y(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),aE=function(e){function i(i,r,n){var o=e.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,void 0!==r&&n?(o.setFlatCoordinates(r,i),o.ends_=n):o.setCoordinates(i,r),o}return aS(i,e),i.prototype.appendLinearRing=function(e){this.flatCoordinates?iC(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},i.prototype.clone=function(){return new i(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},i.prototype.closestPointXY=function(e,i,r,n){return n<tL(this.getExtent(),e,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(o9(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ae(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,i,r,n))},i.prototype.containsXY=function(e,i){return ao(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,i)},i.prototype.getArea=function(){return am(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},i.prototype.getCoordinates=function(e){var i;return void 0!==e?aw(i=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,e):i=this.flatCoordinates,ny(i,0,this.ends_,this.stride)},i.prototype.getEnds=function(){return this.ends_},i.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=tK(this.getExtent());this.flatInteriorPoint_=ay(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},i.prototype.getInteriorPoint=function(){return new oK(this.getFlatInteriorPoint(),oe.XYM)},i.prototype.getLinearRingCount=function(){return this.ends_.length},i.prototype.getLinearRing=function(e){return e<0||this.ends_.length<=e?null:new a_(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},i.prototype.getLinearRings=function(){for(var e=this.layout,i=this.flatCoordinates,r=this.ends_,n=[],o=0,a=0,s=r.length;a<s;++a){var l=r[a],h=new a_(i.slice(o,l),e);n.push(h),o=l}return n},i.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;ab(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=aw(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},i.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=nA(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),r,0,n),new i(r,oe.XY,n)},i.prototype.getType=function(){return t8.POLYGON},i.prototype.intersectsExtent=function(e){return as(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=oX(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},i}(oi);function aI(e){var i=e[0],r=e[1],n=e[2],o=e[3],a=[i,r,i,o,n,o,n,r,i,r];return new aE(a,oe.XY,[a.length])}function aC(e,i,r,n){for(var o=[],a=tN(),s=0,l=r.length;s<l;++s){var h,u,c=r[s];h=i,u=c[0],a=tH(tV(void 0),e,h,u,n),o.push((a[0]+a[2])/2,(a[1]+a[3])/2),i=c[c.length-1]}return o}var aA=(K=function(e,i){return(K=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}K(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),aR=function(e){function i(i,r,n){var o=e.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!n&&!Array.isArray(i[0])){for(var a=o.getLayout(),s=i,l=[],h=[],u=0,c=s.length;u<c;++u){var d=s[u];0===u&&(a=d.getLayout());for(var p=l.length,f=d.getEnds(),m=0,g=f.length;m<g;++m)f[m]+=p;iC(l,d.getFlatCoordinates()),h.push(f)}r=a,i=l,n=h}return void 0!==r&&n?(o.setFlatCoordinates(r,i),o.endss_=n):o.setCoordinates(i,r),o}return aA(i,e),i.prototype.appendPolygon=function(e){var i;if(this.flatCoordinates){var r=this.flatCoordinates.length;iC(this.flatCoordinates,e.getFlatCoordinates()),i=e.getEnds().slice();for(var n=0,o=i.length;n<o;++n)i[n]+=r}else this.flatCoordinates=e.getFlatCoordinates().slice(),i=e.getEnds().slice(),this.endss_.push();this.endss_.push(i),this.changed()},i.prototype.clone=function(){for(var e=this.endss_.length,r=Array(e),n=0;n<e;++n)r[n]=this.endss_[n].slice();return new i(this.flatCoordinates.slice(),this.layout,r)},i.prototype.closestPointXY=function(e,i,r,n){return n<tL(this.getExtent(),e,i)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){var l=r[a];o=o9(e,i,l,n,o),i=l[l.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(e,i,r,n,o,a,s,l,h,u,c){for(var d=[NaN,NaN],p=0,f=r.length;p<f;++p){var m=r[p];u=ae(e,i,m,n,o,a,s,l,h,u,d),i=m[m.length-1]}return u}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,i,r,n))},i.prototype.containsXY=function(e,i){return function(e,i,r,n,o,a){if(0===r.length)return!1;for(var s=0,l=r.length;s<l;++s){var h=r[s];if(ao(e,i,h,n,o,a))return!0;i=h[h.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,i)},i.prototype.getArea=function(){return function(e,i,r,n){for(var o=0,a=0,s=r.length;a<s;++a){var l=r[a];o+=am(e,i,l,n),i=l[l.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},i.prototype.getCoordinates=function(e){var i;return void 0!==e?aT(i=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,e):i=this.flatCoordinates,nv(i,0,this.endss_,this.stride)},i.prototype.getEndss=function(){return this.endss_},i.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var e=aC(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=av(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},i.prototype.getInteriorPoints=function(){return new ap(this.getFlatInteriorPoints().slice(),oe.XYM)},i.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;!function(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){var l=r[a];if(!ab(e,i,l,n,void 0))return!1;l.length&&(i=l[l.length-1])}return!0}(e,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=aT(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=e,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},i.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=function(e,i,r,n,o,a,s,l){for(var h=0,u=r.length;h<u;++h){var c=r[h],d=[];s=nA(e,i,c,n,o,a,s,d),l.push(d),i=c[c.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),r,0,n),new i(r,oe.XY,n)},i.prototype.getPolygon=function(e){if(e<0||this.endss_.length<=e)return null;if(0===e)i=0;else{var i,r=this.endss_[e-1];i=r[r.length-1]}var n=this.endss_[e].slice(),o=n[n.length-1];if(0!==i)for(var a=0,s=n.length;a<s;++a)n[a]-=i;return new aE(this.flatCoordinates.slice(i,o),this.layout,n)},i.prototype.getPolygons=function(){for(var e=this.layout,i=this.flatCoordinates,r=this.endss_,n=[],o=0,a=0,s=r.length;a<s;++a){var l=r[a].slice(),h=l[l.length-1];if(0!==o)for(var u=0,c=l.length;u<c;++u)l[u]-=o;var d=new aE(i.slice(o,h),e,l);n.push(d),o=h}return n},i.prototype.getType=function(){return t8.MULTI_POLYGON},i.prototype.intersectsExtent=function(e){return function(e,i,r,n,o){for(var a=0,s=r.length;a<s;++a){var l=r[a];if(as(e,i,l,n,o))return!0;i=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)},i.prototype.setCoordinates=function(e,i){this.setLayout(i,e,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(e,i,r,n,o){for(var a=o||[],s=0,l=0,h=r.length;l<h;++l){var u=oX(e,i,r[l],n,a[s]);a[s++]=u,i=u[u.length-1]}return a.length=s,a}(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},i}(oi),aM=(J=function(e,i){return(J=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}J(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),aP=function(e){function i(i){var r=this,n=i||{};return(r=e.call(this)||this).dataProjection=ia(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(r.defaultFeatureProjection=ia(n.featureProjection)),r.geometryName_=n.geometryName,r.extractGeometryName_=n.extractGeometryName,r}return aM(i,e),i.prototype.readFeatureFromObject=function(e,i){var r=null,n=aO((r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry,i),o=new oZ;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&o.setGeometryName(r.geometry_name),o.setGeometry(n),"id"in r&&o.setId(r.id),r.properties&&o.setProperties(r.properties,!0),o},i.prototype.readFeaturesFromObject=function(e,i){var r=null;if("FeatureCollection"===e.type){r=[];for(var n=e.features,o=0,a=n.length;o<a;++o)r.push(this.readFeatureFromObject(n[o],i))}else r=[this.readFeatureFromObject(e,i)];return r},i.prototype.readGeometryFromObject=function(e,i){return aO(e,i)},i.prototype.readProjectionFromObject=function(e){var i,r=e.crs;return r?"name"==r.type?i=ia(r.properties.name):"EPSG"===r.type?i=ia("EPSG:"+r.properties.code):tM(!1,36):i=this.dataProjection,i},i.prototype.writeFeatureObject=function(e,i){i=this.adaptOptions(i);var r={type:"Feature",geometry:null,properties:null},n=e.getId();if(void 0!==n&&(r.id=n),!e.hasProperties())return r;var o=e.getProperties(),a=e.getGeometry();return a&&(r.geometry=ak(a,i),delete o[e.getGeometryName()]),tx(o)||(r.properties=o),r},i.prototype.writeFeaturesObject=function(e,i){i=this.adaptOptions(i);for(var r=[],n=0,o=e.length;n<o;++n)r.push(this.writeFeatureObject(e[n],i));return{type:"FeatureCollection",features:r}},i.prototype.writeGeometryObject=function(e,i){return ak(e,this.adaptOptions(i))},i}(o5);function aO(e,i){var r,n;if(!e)return null;switch(e.type){case t8.POINT:r=new oK(e.coordinates);break;case t8.LINE_STRING:r=new ah(e.coordinates);break;case t8.POLYGON:r=new aE(e.coordinates);break;case t8.MULTI_POINT:r=new ap(e.coordinates);break;case t8.MULTI_LINE_STRING:r=new ac(e.coordinates);break;case t8.MULTI_POLYGON:r=new aR(e.coordinates);break;case t8.GEOMETRY_COLLECTION:r=new oQ(e.geometries.map(function(e){return aO(e,void 0)}));break;default:throw Error("Unsupported GeoJSON type: "+e.type)}return o2(r,!1,i)}function ak(e,i){var r,n,o,a,s,l,h,u,c,d,p,f,m,g=(e=o2(e,!0,i)).getType();switch(g){case t8.POINT:r=0,m={type:"Point",coordinates:e.getCoordinates()};break;case t8.LINE_STRING:n=0,m={type:"LineString",coordinates:e.getCoordinates()};break;case t8.POLYGON:o=e,(a=i)&&(s=a.rightHanded),m={type:"Polygon",coordinates:o.getCoordinates(s)};break;case t8.MULTI_POINT:l=0,m={type:"MultiPoint",coordinates:e.getCoordinates()};break;case t8.MULTI_LINE_STRING:h=0,m={type:"MultiLineString",coordinates:e.getCoordinates()};break;case t8.MULTI_POLYGON:u=e,(c=i)&&(d=c.rightHanded),m={type:"MultiPolygon",coordinates:u.getCoordinates(d)};break;case t8.GEOMETRY_COLLECTION:p=e,f=i,m={type:"GeometryCollection",geometries:p.getGeometriesArray().map(function(e){var i=t_({},f);return delete i.featureProjection,ak(e,i)})};break;case t8.CIRCLE:m={type:"GeometryCollection",geometries:[]};break;default:throw Error("Unsupported geometry type: "+g)}return m}var aL={};aL=az;var aD=e5("7y6mg");function az(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}az.Varint=0,az.Fixed64=1,az.Bytes=2,az.Fixed32=5;var aF="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function aB(e){return e.type===az.Bytes?e.readVarint()+e.pos:e.pos+1}function aN(e,i,r){return r?0x100000000*i+(e>>>0):(i>>>0)*0x100000000+(e>>>0)}function aj(e,i,r){var n=i<=16383?1:i<=2097151?2:i<=0xfffffff?3:Math.floor(Math.log(i)/(7*Math.LN2));r.realloc(n);for(var o=r.pos-1;o>=e;o--)r.buf[o+n]=r.buf[o]}function aV(e,i){for(var r=0;r<e.length;r++)i.writeVarint(e[r])}function aU(e,i){for(var r=0;r<e.length;r++)i.writeSVarint(e[r])}function aG(e,i){for(var r=0;r<e.length;r++)i.writeFloat(e[r])}function aq(e,i){for(var r=0;r<e.length;r++)i.writeDouble(e[r])}function a$(e,i){for(var r=0;r<e.length;r++)i.writeBoolean(e[r])}function aH(e,i){for(var r=0;r<e.length;r++)i.writeFixed32(e[r])}function aZ(e,i){for(var r=0;r<e.length;r++)i.writeSFixed32(e[r])}function aW(e,i){for(var r=0;r<e.length;r++)i.writeFixed64(e[r])}function aX(e,i){for(var r=0;r<e.length;r++)i.writeSFixed64(e[r])}function aY(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+0x1000000*e[i+3]}function aK(e,i,r){e[r]=i,e[r+1]=i>>>8,e[r+2]=i>>>16,e[r+3]=i>>>24}function aJ(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+(e[i+3]<<24)}az.prototype={destroy:function(){this.buf=null},readFields:function(e,i,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),o=n>>3,a=this.pos;this.type=7&n,e(o,i,this),this.pos===a&&this.skip(n)}return i},readMessage:function(e,i){return this.readFields(e,i,this.readVarint()+this.pos)},readFixed32:function(){var e=aY(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=aJ(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=aY(this.buf,this.pos)+0x100000000*aY(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=aY(this.buf,this.pos)+0x100000000*aJ(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=aD.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=aD.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var i,r,n=this.buf;return(i=127&(r=n[this.pos++]),r<128||(i|=(127&(r=n[this.pos++]))<<7,r<128||(i|=(127&(r=n[this.pos++]))<<14,r<128||(i|=(127&(r=n[this.pos++]))<<21,r<128))))?i:function(e,i,r){var n,o,a=r.buf;if(n=(112&(o=a[r.pos++]))>>4,o<128||(n|=(127&(o=a[r.pos++]))<<3,o<128)||(n|=(127&(o=a[r.pos++]))<<10,o<128)||(n|=(127&(o=a[r.pos++]))<<17,o<128)||(n|=(127&(o=a[r.pos++]))<<24,o<128)||(n|=(1&(o=a[r.pos++]))<<31,o<128))return aN(e,n,i);throw Error("Expected varint not more than 10 bytes")}(i|=(15&(r=n[this.pos]))<<28,e,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?-((e+1)/2):e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e,i,r,n=this.readVarint()+this.pos,o=this.pos;return(this.pos=n,n-o>=12&&aF)?(e=this.buf,i=o,r=n,aF.decode(e.subarray(i,r))):function(e,i,r){for(var n="",o=i;o<r;){var a,s,l,h=e[o],u=null,c=h>239?4:h>223?3:h>191?2:1;if(o+c>r)break;1===c?h<128&&(u=h):2===c?(192&(a=e[o+1]))==128&&(u=(31&h)<<6|63&a)<=127&&(u=null):3===c?(a=e[o+1],s=e[o+2],(192&a)==128&&(192&s)==128&&((u=(15&h)<<12|(63&a)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=e[o+1],s=e[o+2],l=e[o+3],(192&a)==128&&(192&s)==128&&(192&l)==128&&((u=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&l)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),o+=c}return n}(this.buf,o,n)},readBytes:function(){var e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i},readPackedVarint:function(e,i){if(this.type!==az.Bytes)return e.push(this.readVarint(i));var r=aB(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(i));return e},readPackedSVarint:function(e){if(this.type!==az.Bytes)return e.push(this.readSVarint());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==az.Bytes)return e.push(this.readBoolean());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==az.Bytes)return e.push(this.readFloat());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==az.Bytes)return e.push(this.readDouble());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==az.Bytes)return e.push(this.readFixed32());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==az.Bytes)return e.push(this.readSFixed32());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==az.Bytes)return e.push(this.readFixed64());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==az.Bytes)return e.push(this.readSFixed64());var i=aB(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed64());return e},skip:function(e){var i=7&e;if(i===az.Varint)for(;this.buf[this.pos++]>127;);else if(i===az.Bytes)this.pos=this.readVarint()+this.pos;else if(i===az.Fixed32)this.pos+=4;else if(i===az.Fixed64)this.pos+=8;else throw Error("Unimplemented type: "+i)},writeTag:function(e,i){this.writeVarint(e<<3|i)},realloc:function(e){for(var i=this.length||16;i<this.pos+e;)i*=2;if(i!==this.length){var r=new Uint8Array(i);r.set(this.buf),this.buf=r,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),aK(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),aK(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),aK(this.buf,-1&e,this.pos),aK(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),aK(this.buf,-1&e,this.pos),aK(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeVarint:function(e){if((e=+e||0)>0xfffffff||e<0)return void function(e,i){var r,n,o,a,s;if(e>=0?(r=e%0x100000000|0,n=e/0x100000000|0):(r=~(-e%0x100000000),n=~(-e/0x100000000),0xffffffff^r?r=r+1|0:(r=0,n=n+1|0)),e>=0xffffffffffffffff||e<-0xffffffffffffffff)throw Error("Given varint doesn't fit into 10 bytes");i.realloc(10),o=r,a=0,(s=i).buf[s.pos++]=127&o|128,o>>>=7,s.buf[s.pos++]=127&o|128,o>>>=7,s.buf[s.pos++]=127&o|128,o>>>=7,s.buf[s.pos++]=127&o|128,o>>>=7,s.buf[s.pos]=127&o,function(e,i){var r=(7&e)<<4;if(i.buf[i.pos++]|=r|128*!!(e>>>=3),e&&(i.buf[i.pos++]=127&e|128*!!(e>>>=7),e)&&(i.buf[i.pos++]=127&e|128*!!(e>>>=7),e))i.buf[i.pos++]=127&e|128*!!(e>>>=7),e&&(i.buf[i.pos++]=127&e|128*!!(e>>>=7),e&&(i.buf[i.pos++]=127&e))}(n,i)}(e,this);if(this.realloc(4),this.buf[this.pos++]=127&e|128*(e>127),!(e<=127))this.buf[this.pos++]=127&(e>>>=7)|128*(e>127),!(e<=127)&&(this.buf[this.pos++]=127&(e>>>=7)|128*(e>127),e<=127||(this.buf[this.pos++]=e>>>7&127))},writeSVarint:function(e){this.writeVarint(e<0?-(2*e)-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var i=this.pos;this.pos=function(e,i,r){for(var n,o,a=0;a<i.length;a++){if((n=i.charCodeAt(a))>55295&&n<57344)if(o)if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=n;continue}else n=o-55296<<10|n-56320|65536,o=null;else{n>56319||a+1===i.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=n;continue}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-i;r>=128&&aj(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),aD.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),aD.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var i=e.length;this.writeVarint(i),this.realloc(i);for(var r=0;r<i;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,i){this.pos++;var r=this.pos;e(i,this);var n=this.pos-r;n>=128&&aj(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,i,r){this.writeTag(e,az.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(e,i){i.length&&this.writeMessage(e,aV,i)},writePackedSVarint:function(e,i){i.length&&this.writeMessage(e,aU,i)},writePackedBoolean:function(e,i){i.length&&this.writeMessage(e,a$,i)},writePackedFloat:function(e,i){i.length&&this.writeMessage(e,aG,i)},writePackedDouble:function(e,i){i.length&&this.writeMessage(e,aq,i)},writePackedFixed32:function(e,i){i.length&&this.writeMessage(e,aH,i)},writePackedSFixed32:function(e,i){i.length&&this.writeMessage(e,aZ,i)},writePackedFixed64:function(e,i){i.length&&this.writeMessage(e,aW,i)},writePackedSFixed64:function(e,i){i.length&&this.writeMessage(e,aX,i)},writeBytesField:function(e,i){this.writeTag(e,az.Bytes),this.writeBytes(i)},writeFixed32Field:function(e,i){this.writeTag(e,az.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(e,i){this.writeTag(e,az.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(e,i){this.writeTag(e,az.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(e,i){this.writeTag(e,az.Fixed64),this.writeSFixed64(i)},writeVarintField:function(e,i){this.writeTag(e,az.Varint),this.writeVarint(i)},writeSVarintField:function(e,i){this.writeTag(e,az.Varint),this.writeSVarint(i)},writeStringField:function(e,i){this.writeTag(e,az.Bytes),this.writeString(i)},writeFloatField:function(e,i){this.writeTag(e,az.Fixed32),this.writeFloat(i)},writeDoubleField:function(e,i){this.writeTag(e,az.Fixed64),this.writeDouble(i)},writeBooleanField:function(e,i){this.writeVarintField(e,!!i)}};var aQ=rO(),a0=function(){function e(e,i,r,n,o){this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=i,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=n}return e.prototype.get=function(e){return this.properties_[e]},e.prototype.getExtent=function(){var e,i;return this.extent_||(this.extent_=this.type_===t8.POINT?tU(this.flatCoordinates_):(e=this.flatCoordinates_,i=this.flatCoordinates_.length,tH(tV(void 0),e,0,i,2))),this.extent_},e.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var e=tK(this.getExtent());this.flatInteriorPoints_=ay(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_},e.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var e=aC(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=av(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_},e.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=ai(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},e.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var e=this.flatCoordinates_,i=0,r=this.ends_,n=0,o=r.length;n<o;++n){var a=r[n],s=ai(e,i,a,2,.5);iC(this.flatMidpoints_,s),i=a}}return this.flatMidpoints_},e.prototype.getId=function(){return this.id_},e.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},e.prototype.getGeometry=function(){return this},e.prototype.getSimplifiedGeometry=function(e){return this},e.prototype.simplifyTransformed=function(e,i){return this},e.prototype.getProperties=function(){return this.properties_},e.prototype.getStride=function(){return 2},e.prototype.getStyleFunction=function(){},e.prototype.getType=function(){return this.type_},e.prototype.transform=function(e,i){var r=(e=ia(e)).getExtent(),n=e.getWorldExtent(),o=tQ(n)/tQ(r);rB(aQ,n[0],n[3],o,-o,0,0,0),n$(this.flatCoordinates_,0,this.flatCoordinates_.length,2,aQ,this.flatCoordinates_)},e.prototype.getEnds=function(){return this.ends_},e}();a0.prototype.getEndss=a0.prototype.getEnds,a0.prototype.getFlatCoordinates=a0.prototype.getOrientedFlatCoordinates;var a1=(Q=function(e,i){return(Q=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}Q(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),a2=function(e){function i(i){var r=e.call(this)||this,n=i||{};return r.dataProjection=new e9({code:"",units:e6.TILE_PIXELS}),r.featureClass_=n.featureClass?n.featureClass:a0,r.geometryName_=n.geometryName,r.layerName_=n.layerName?n.layerName:"layer",r.layers_=n.layers?n.layers:null,r.idProperty_=n.idProperty,r}return a1(i,e),i.prototype.readRawGeometry_=function(e,i,r,n){e.pos=i.geometry;for(var o=e.readVarint()+e.pos,a=1,s=0,l=0,h=0,u=0,c=0;e.pos<o;){if(!s){var d=e.readVarint();a=7&d,s=d>>3}s--,1===a||2===a?(l+=e.readSVarint(),h+=e.readSVarint(),1===a&&u>c&&(n.push(u),c=u),r.push(l,h),u+=2):7===a?u>c&&(r.push(r[c],r[c+1]),u+=2):tM(!1,59)}u>c&&(n.push(u),c=u)},i.prototype.createFeature_=function(e,i,r){var n,o,a,s,l,h=i.type;if(0===h)return null;var u=i.properties;this.idProperty_?(l=u[this.idProperty_],delete u[this.idProperty_]):l=i.id,u[this.layerName_]=i.layer.name;var c=[],d=[];this.readRawGeometry_(e,i,c,d);var p=(n=h,o=d.length,1===n?a=1===o?t8.POINT:t8.MULTI_POINT:2===n?a=1===o?t8.LINE_STRING:t8.MULTI_LINE_STRING:3===n&&(a=t8.POLYGON),a);if(this.featureClass_===a0)(s=new this.featureClass_(p,c,d,u,l)).transform(r.dataProjection,r.featureProjection);else{var f=void 0;if(p==t8.POLYGON){for(var m=[],g=0,_=0,y=0,v=d.length;y<v;++y){var x=d[y];if(ax(c,g,x,2)){if(0===m.length)continue;m[m.length-1].push(d[_])}else m.push(d.slice(_,y+1));_=y+1,g=x}f=m.length>1?new aR(c,oe.XY,m):new aE(c,oe.XY,d)}else f=p===t8.POINT?new oK(c,oe.XY):p===t8.LINE_STRING?new ah(c,oe.XY):p===t8.POLYGON?new aE(c,oe.XY,d):p===t8.MULTI_POINT?new ap(c,oe.XY):p===t8.MULTI_LINE_STRING?new ac(c,oe.XY,d):null;s=new this.featureClass_,this.geometryName_&&s.setGeometryName(this.geometryName_);var b=o2(f,!1,r);s.setGeometry(b),s.setId(l),s.setProperties(u,!0)}return s},i.prototype.getType=function(){return oj.ARRAY_BUFFER},i.prototype.readFeatures=function(e,i){var r=this.layers_,n=this.adaptOptions(i),o=ia(n.dataProjection);o.setWorldExtent(n.extent),n.dataProjection=o;var a=new(e1(aL))(e),s=a.readFields(a3,{}),l=[];for(var h in s)if(!r||-1!=r.indexOf(h)){var u=s[h],c=u?[0,0,u.extent,u.extent]:null;o.setExtent(c);for(var d=0,p=u.length;d<p;++d){var f=function(e,i,r){e.pos=i.features[r];var n=e.readVarint()+e.pos,o={layer:i,type:0,properties:{}};return e.readFields(a4,o,n),o}(a,u,d);l.push(this.createFeature_(a,f,n))}}return l},i.prototype.readProjection=function(e){return this.dataProjection},i.prototype.setLayers=function(e){this.layers_=e},i}(o1);function a3(e,i,r){if(3===e){var n={keys:[],values:[],features:[]},o=r.readVarint()+r.pos;r.readFields(a5,n,o),n.length=n.features.length,n.length&&(i[n.name]=n)}}function a5(e,i,r){if(15===e)i.version=r.readVarint();else if(1===e)i.name=r.readString();else if(5===e)i.extent=r.readVarint();else if(2===e)i.features.push(r.pos);else if(3===e)i.keys.push(r.readString());else if(4===e){for(var n=null,o=r.readVarint()+r.pos;r.pos<o;)n=1==(e=r.readVarint()>>3)?r.readString():2===e?r.readFloat():3===e?r.readDouble():4===e?r.readVarint64():5===e?r.readVarint():6===e?r.readSVarint():7===e?r.readBoolean():null;i.values.push(n)}}function a4(e,i,r){if(1==e)i.id=r.readVarint();else if(2==e)for(var n=r.readVarint()+r.pos;r.pos<n;){var o=i.layer.keys[r.readVarint()],a=i.layer.values[r.readVarint()];i.properties[o]=a}else 3==e?i.type=r.readVarint():4==e&&(i.geometry=r.pos)}var a6=(ee=function(e,i){return(ee=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ee(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),a8=function(e){function i(i){var r=e.call(this)||this;return r.map_=i,r.declutterTree_=null,r}return a6(i,e),i.prototype.dispatchRenderEvent=function(e,i){tE()},i.prototype.calculateMatrices2D=function(e){var i=e.viewState,r=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;rB(r,e.size[0]/2,e.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),rN(n,r)},i.prototype.forEachFeatureAtCoordinate=function(e,i,r,n,o,a,s,l){var h,u,c=i.viewState;function d(e,i,r){return o.call(a,i,e?r:null)}var p=c.projection,f=it(e.slice(),p),m=[[0,0]];if(p.canWrapX()&&n){var g=t3(p.getExtent());m.push([-g,0],[g,0])}var _=i.layerStatesArray,y=_.length;this.declutterTree_&&(u=this.declutterTree_.all().map(function(e){return e.value}));for(var v=[],x=0;x<m.length;x++)for(var b=y-1;b>=0;--b){var w=_[b],T=w.layer;if(T.hasRenderer()&&rx(w,c)&&s.call(l,T)){var S=T.getRenderer(),E=T.getSource();if(S&&E){var I=E.getWrapX()?f:e,C=d.bind(null,w.managed);v[0]=I[0]+m[x][0],v[1]=I[1]+m[x][1],h=S.forEachFeatureAtCoordinate(v,i,r,C,u)}if(h)return h}}},i.prototype.forEachLayerAtPixel=function(e,i,r,n,o){return tE()},i.prototype.hasFeatureAtCoordinate=function(e,i,r,n,o,a){return void 0!==this.forEachFeatureAtCoordinate(e,i,r,n,iR,this,o,a)},i.prototype.getMap=function(){return this.map_},i.prototype.renderFrame=function(e){this.declutterTree_=function(e,i){i&&i.clear();for(var r=e.declutterItems,n=r.length-1;n>=0;--n)for(var o=r[n],a=o.items,s=0,l=a.length;s<l;s+=3)i=a[s].renderDeclutter(a[s+1],a[s+2],o.opacity,i);return r.length=0,i}(e,this.declutterTree_)},i.prototype.scheduleExpireIconCache=function(e){oh.canExpireCache()&&e.postRenderFunctions.push(a9)},i}(iS);function a9(e,i){oh.expire()}var a7=(et=function(e,i){return(et=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}et(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),se=function(e){function i(i){var r=e.call(this,i)||this;r.fontChangeListenerKey_=iD(rY,iT.PROPERTYCHANGE,i.redrawText.bind(i)),r.element_=document.createElement("div");var n=r.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",r.element_.className=iW+" ol-layers";var o=i.getViewport();return o.insertBefore(r.element_,o.firstChild||null),r.children_=[],r.renderedVisible_=!0,r}return a7(i,e),i.prototype.dispatchRenderEvent=function(e,i){var r=this.getMap();if(r.hasListener(e)){var n=new nj(e,void 0,i);r.dispatchEvent(n)}},i.prototype.disposeInternal=function(){iz(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),e.prototype.disposeInternal.call(this)},i.prototype.renderFrame=function(i){if(!i){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(i),this.dispatchRenderEvent(rg.PRECOMPOSE,i);var r=i.layerStatesArray.sort(function(e,i){return e.zIndex-i.zIndex}),n=i.viewState;this.children_.length=0;for(var o=null,a=0,s=r.length;a<s;++a){var l=r[a];if(i.layerIndex=a,rx(l,n)&&(l.sourceState==r_.READY||l.sourceState==r_.UNDEFINED)){var h=l.layer.render(i,o);h&&h!==o&&(this.children_.push(h),o=h)}}e.prototype.renderFrame.call(this,i),function(e,i){for(var r=e.childNodes,n=0;;++n){var o=r[n],a=i[n];if(!o&&!a)break;if(o!==a){if(!o){e.appendChild(a);continue}if(!a){e.removeChild(o),--n;continue}e.insertBefore(a,o)}}}(this.element_,this.children_),this.dispatchRenderEvent(rg.POSTCOMPOSE,i),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(i)},i.prototype.forEachLayerAtPixel=function(e,i,r,n,o){for(var a=i.viewState,s=i.layerStatesArray,l=s.length,h=l-1;h>=0;--h){var u=s[h],c=u.layer;if(c.hasRenderer()&&rx(u,a)&&o(c)){var d=c.getRenderer().getDataAtPixel(e,i,r);if(d){var p=n(c,d);if(p)return p}}}},i}(a8),st=(ei=function(e,i){return(ei=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ei(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),si="layers",sr=function(e){function i(i){var r=this,n=i||{},o=t_({},n);delete o.layers;var a=n.layers;return(r=e.call(this,o)||this).layersListenerKeys_=[],r.listenerKeys_={},r.addEventListener(iq(si),r.handleLayersChanged_),a?Array.isArray(a)?a=new ok(a.slice(),{unique:!0}):tM("function"==typeof a.getArray,43):a=new ok(void 0,{unique:!0}),r.setLayers(a),r}return st(i,e),i.prototype.handleLayerChange_=function(){this.changed()},i.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(iz),this.layersListenerKeys_.length=0;var e=this.getLayers();for(var i in this.layersListenerKeys_.push(iD(e,oR.ADD,this.handleLayersAdd_,this),iD(e,oR.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[i].forEach(iz);ty(this.listenerKeys_);for(var r=e.getArray(),n=0,o=r.length;n<o;n++){var a=r[n];this.listenerKeys_[tC(a)]=[iD(a,iT.PROPERTYCHANGE,this.handleLayerChange_,this),iD(a,iL.CHANGE,this.handleLayerChange_,this)]}this.changed()},i.prototype.handleLayersAdd_=function(e){var i=e.element;this.listenerKeys_[tC(i)]=[iD(i,iT.PROPERTYCHANGE,this.handleLayerChange_,this),iD(i,iL.CHANGE,this.handleLayerChange_,this)],this.changed()},i.prototype.handleLayersRemove_=function(e){var i=tC(e.element);this.listenerKeys_[i].forEach(iz),delete this.listenerKeys_[i],this.changed()},i.prototype.getLayers=function(){return this.get(si)},i.prototype.setLayers=function(e){this.set(si,e)},i.prototype.getLayersArray=function(e){var i=void 0!==e?e:[];return this.getLayers().forEach(function(e){e.getLayersArray(i)}),i},i.prototype.getLayerStatesArray=function(e){var i=void 0!==e?e:[],r=i.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(i)});for(var n=this.getLayerState(),o=r,a=i.length;o<a;o++){var s=i[o];s.opacity*=n.opacity,s.visible=s.visible&&n.visible,s.maxResolution=Math.min(s.maxResolution,n.maxResolution),s.minResolution=Math.max(s.minResolution,n.minResolution),s.minZoom=Math.max(s.minZoom,n.minZoom),s.maxZoom=Math.min(s.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==s.extent?s.extent=t0(s.extent,n.extent):s.extent=n.extent)}return i},i.prototype.getSourceState=function(){return r_.READY},i}(rm),sn=(er=function(e,i){return(er=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}er(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),so=function(e){function i(i,r,n){var o=e.call(this,i)||this;return o.map=r,o.frameState=void 0!==n?n:null,o}return sn(i,e),i}(iw),sa=(en=function(e,i){return(en=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}en(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ss=function(e){function i(i,r,n,o,a){var s=e.call(this,i,r,a)||this;return s.originalEvent=n,s.pixel_=null,s.coordinate_=null,s.dragging=void 0!==o&&o,s}return sa(i,e),Object.defineProperty(i.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(e){this.pixel_=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(e){this.coordinate_=e},enumerable:!1,configurable:!0}),i.prototype.preventDefault=function(){e.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},i.prototype.stopPropagation=function(){e.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},i}(so),sl={SINGLECLICK:"singleclick",CLICK:iL.CLICK,DBLCLICK:iL.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},sh={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"},su=(eo=function(e,i){return(eo=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eo(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sc=function(e){function i(i,r){var n=e.call(this,i)||this;n.map_=i,n.clickTimeoutId_,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=r?r*i5:i5,n.down_=null;var o=n.map_.getViewport();return n.activePointers_=0,n.trackedTouches_={},n.element_=o,n.pointerdownListenerKey_=iD(o,sh.POINTERDOWN,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=iD(o,sh.POINTERMOVE,n.relayEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(iL.TOUCHMOVE,n.boundHandleTouchMove_,!!i8&&{passive:!1}),n}return su(i,e),i.prototype.emulateClick_=function(e){var i=new ss(sl.CLICK,this.map_,e);this.dispatchEvent(i),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,i=new ss(sl.DBLCLICK,this.map_,e),this.dispatchEvent(i)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;var i=new ss(sl.SINGLECLICK,this.map_,e);this.dispatchEvent(i)}).bind(this),250)},i.prototype.updateActivePointers_=function(e){e.type==sl.POINTERUP||e.type==sl.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==sl.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},i.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var i=new ss(sl.POINTERUP,this.map_,e);this.dispatchEvent(i),!i.propagationStopped&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(iz),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},i.prototype.isMouseActionButton_=function(e){return 0===e.button},i.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);var i=new ss(sl.POINTERDOWN,this.map_,e);this.dispatchEvent(i),this.down_=e,0===this.dragListenerKeys_.length&&(this.dragListenerKeys_.push(iD(document,sl.POINTERMOVE,this.handlePointerMove_,this),iD(document,sl.POINTERUP,this.handlePointerUp_,this),iD(this.element_,sl.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==document&&this.dragListenerKeys_.push(iD(this.element_.getRootNode(),sl.POINTERUP,this.handlePointerUp_,this)))},i.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var i=new ss(sl.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(i)}},i.prototype.relayEvent_=function(e){this.originalPointerMoveEvent_=e;var i=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new ss(e.type,this.map_,e,i))},i.prototype.handleTouchMove_=function(e){(!this.originalPointerMoveEvent_||this.originalPointerMoveEvent_.defaultPrevented)&&e.preventDefault()},i.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},i.prototype.disposeInternal=function(){this.relayedListenerKey_&&(iz(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(iL.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(iz(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(iz),this.dragListenerKeys_.length=0,this.element_=null,e.prototype.disposeInternal.call(this)},i}(ik),sd="layergroup",sp="size",sf="target",sm="view",sg=1/0,s_=function(){function e(e,i){this.priorityFunction_=e,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return e.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,ty(this.queuedElements_)},e.prototype.dequeue=function(){var e=this.elements_,i=this.priorities_,r=e[0];1==e.length?(e.length=0,i.length=0):(e[0]=e.pop(),i[0]=i.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},e.prototype.enqueue=function(e){tM(!(this.keyFunction_(e)in this.queuedElements_),31);var i=this.priorityFunction_(e);return i!=sg&&(this.elements_.push(e),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},e.prototype.getCount=function(){return this.elements_.length},e.prototype.getLeftChildIndex_=function(e){return 2*e+1},e.prototype.getRightChildIndex_=function(e){return 2*e+2},e.prototype.getParentIndex_=function(e){return e-1>>1},e.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)},e.prototype.isEmpty=function(){return 0===this.elements_.length},e.prototype.isKeyQueued=function(e){return e in this.queuedElements_},e.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))},e.prototype.siftUp_=function(e){for(var i=this.elements_,r=this.priorities_,n=i.length,o=i[e],a=r[e],s=e;e<n>>1;){var l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),u=h<n&&r[h]<r[l]?h:l;i[e]=i[u],r[e]=r[u],e=u}i[e]=o,r[e]=a,this.siftDown_(s,e)},e.prototype.siftDown_=function(e,i){for(var r=this.elements_,n=this.priorities_,o=r[i],a=n[i];i>e;){var s=this.getParentIndex_(i);if(n[s]>a)r[i]=r[s],n[i]=n[s],i=s;else break}r[i]=o,n[i]=a},e.prototype.reprioritize=function(){var e,i,r,n=this.priorityFunction_,o=this.elements_,a=this.priorities_,s=0,l=o.length;for(i=0;i<l;++i)(r=n(e=o[i]))==sg?delete this.queuedElements_[this.keyFunction_(e)]:(a[s]=r,o[s++]=e);o.length=s,a.length=s,this.heapify_()},e}(),sy={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},sv=(ea=function(e,i){return(ea=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ea(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sx=function(e){function i(i,r){var n=e.call(this,function(e){return i.apply(null,e)},function(e){return e[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=r,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return sv(i,e),i.prototype.enqueue=function(i){var r=e.prototype.enqueue.call(this,i);return r&&i[0].addEventListener(iL.CHANGE,this.boundHandleTileChange_),r},i.prototype.getTilesLoading=function(){return this.tilesLoading_},i.prototype.handleTileChange=function(e){var i=e.target,r=i.getState();if(i.hifi&&r===sy.LOADED||r===sy.ERROR||r===sy.EMPTY){i.removeEventListener(iL.CHANGE,this.boundHandleTileChange_);var n=i.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},i.prototype.loadMoreTiles=function(e,i){for(var r,n,o=0;this.tilesLoading_<e&&o<i&&this.getCount()>0;)n=(r=this.dequeue()[0]).getKey(),r.getState()!==sy.IDLE||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++o,r.load())},i}(s_),sb={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function sw(e,i,r){return function(n,o,a,s){if(n){var l=i?0:a[0]*o,h=i?0:a[1]*o,u=e[0]+l/2,c=e[2]-l/2,d=e[1]+h/2,p=e[3]-h/2;u>c&&(c=u=(c+u)/2),d>p&&(p=d=(p+d)/2);var f=e7(n[0],u,c),m=e7(n[1],d,p),g=30*o;return s&&r&&(f+=-g*Math.log(1+Math.max(0,u-n[0])/g)+g*Math.log(1+Math.max(0,n[0]-c)/g),m+=-g*Math.log(1+Math.max(0,d-n[1])/g)+g*Math.log(1+Math.max(0,n[1]-p)/g)),[f,m]}}}function sT(e){return e}function sS(e,i,r,n){var o=t3(i)/r[0],a=tQ(i)/r[1];return n?Math.min(e,Math.max(o,a)):Math.min(e,Math.min(o,a))}function sE(e,i,r){var n=Math.min(e,i);return n*=Math.log(1+50*Math.max(0,e/i-1))/50+1,r&&(n=Math.max(n,r)/(Math.log(1+50*Math.max(0,r/e-1))/50+1)),e7(n,r/2,2*i)}function sI(e,i,r,n,o){return function(a,s,l,h){if(void 0!==a){var u=n?sS(e,n,l,o):e;return(void 0===r||r)&&h?sE(a,u,i):e7(a,i,u)}}}function sC(e){return void 0!==e?0:void 0}function sA(e){return void 0!==e?e:void 0}function sR(e){return Math.pow(e,3)}function sM(e){return 1-sR(1-e)}function sP(e){return 3*e*e-2*e*e*e}function sO(e){return e}var sk=(es=function(e,i){return(es=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}es(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sL=function(e){function i(i){var r=e.call(this)||this,n=t_({},i);return r.hints_=[0,0],r.animations_=[],r.updateAnimationKey_,r.projection_=ih(n.projection,"EPSG:3857"),r.viewportSize_=[100,100],r.targetCenter_=null,r.targetResolution_,r.targetRotation_,r.cancelAnchor_=void 0,n.center&&(n.center=iv(n.center,r.projection_)),n.extent&&(n.extent=ib(n.extent,r.projection_)),r.applyOptions_(n),r}return sk(i,e),i.prototype.applyOptions_=function(e){var i=function(e){var i=void 0!==e.minZoom?e.minZoom:0,r=void 0!==e.maxZoom?e.maxZoom:28,n=void 0!==e.zoomFactor?e.zoomFactor:2,o=void 0!==e.multiWorld&&e.multiWorld,a=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,s=void 0!==e.showFullExtent&&e.showFullExtent,l=ih(e.projection,"EPSG:3857"),h=l.getExtent(),u=e.constrainOnlyCenter,c=e.extent;if(!o&&!c&&l.isGlobal()&&(u=!1,c=h),void 0!==e.resolutions){var d,p,f,m,g=e.resolutions;(p=g[i],f=void 0!==g[r]?g[r]:g[g.length-1],e.constrainResolution)?(m=!u&&c,d=function(e,i,r,n){if(void 0!==e){var o=g[0],l=g[g.length-1],h=m?sS(o,m,r,s):o;if(n)return void 0===a||a?sE(e,h,l):e7(e,l,h);var u=Math.floor(iI(g,Math.min(h,e),i));return g[u]>h&&u<g.length-1?g[u+1]:g[u]}}):d=sI(p,f,a,!u&&c,s)}else{var _,y,v,x=(h?Math.max(t3(h),tQ(h)):360*e8[e6.DEGREES]/l.getMetersPerUnit())/256/1;(void 0!==(p=e.maxResolution)?i=0:p=x/Math.pow(n,i),void 0===(f=e.minResolution)&&(f=void 0!==e.maxZoom?void 0!==e.maxResolution?p/Math.pow(n,r):x/Math.pow(n,r):x/0x10000000),r=i+Math.floor(Math.log(p/f)/Math.log(n)),f=p/Math.pow(n,r-i),e.constrainResolution)?(_=p,y=f,v=!u&&c,d=function(e,i,r,o){if(void 0!==e){var l=v?sS(_,v,r,s):_,h=void 0!==y?y:0;if(o)return void 0===a||a?sE(e,l,h):e7(e,h,l);var u=Math.max(Math.ceil(Math.log(_/l)/Math.log(n)-1e-9),Math.floor(Math.log(_/Math.min(l,e))/Math.log(n)+(-(.499999999*i)+.5)));return e7(_/Math.pow(n,u),h,l)}}):d=sI(p,f,a,!u&&c,s)}return{constraint:d,maxResolution:p,minResolution:f,minZoom:i,zoomFactor:n}}(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.minZoom_=i.minZoom;var r=function(e){if(void 0!==e.extent){var i=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return sw(e.extent,e.constrainOnlyCenter,i)}var r=ih(e.projection,"EPSG:3857");if(!0!==e.multiWorld&&r.isGlobal()){var n=r.getExtent().slice();return n[0]=-1/0,n[2]=1/0,sw(n,!1,!1)}return sT}(e),n=i.constraint,o=function(e){if(!(void 0===e.enableRotation||e.enableRotation))return sC;var i,r,n=e.constrainRotation;return void 0===n||!0===n?(i=tr(5),function(e,r){return r?e:void 0===e?void 0:Math.abs(e)<=i?0:e}):!1===n?sA:"number"!=typeof n?sA:(r=2*Math.PI/n,function(e,i){return i?e:void 0!==e?e=Math.floor(e/r+.5)*r:void 0})}(e);this.constraints_={center:r,resolution:n,rotation:o},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom),this.setProperties({}),this.options_=e},i.prototype.getUpdatedOptions_=function(e){var i=t_({},this.options_);return void 0!==i.resolution?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),t_({},i,e)},i.prototype.animate=function(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var i=Array(arguments.length),r=0;r<i.length;++r){var n=arguments[r];n.center&&((n=t_({},n)).center=iv(n.center,this.getProjection())),n.anchor&&((n=t_({},n)).anchor=iv(n.anchor,this.getProjection())),i[r]=n}this.animateInternal.apply(this,i)},i.prototype.animateInternal=function(e){var i,r=arguments.length;if(r>1&&"function"==typeof arguments[r-1]&&(i=arguments[r-1],--r),!this.isDef()){var n=arguments[r-1];n.center&&this.setCenterInternal(n.center),void 0!==n.zoom&&this.setZoom(n.zoom),void 0!==n.rotation&&this.setRotation(n.rotation),i&&sD(i,!0);return}for(var o=Date.now(),a=this.targetCenter_.slice(),s=this.targetResolution_,l=this.targetRotation_,h=[],u=0;u<r;++u){var c,d=arguments[u],p={start:o,complete:!1,anchor:d.anchor,duration:void 0!==d.duration?d.duration:1e3,easing:d.easing||sP,callback:i};if(d.center&&(p.sourceCenter=a,p.targetCenter=d.center.slice(),a=p.targetCenter),void 0!==d.zoom?(p.sourceResolution=s,p.targetResolution=this.getResolutionForZoom(d.zoom),s=p.targetResolution):d.resolution&&(p.sourceResolution=s,p.targetResolution=d.resolution,s=p.targetResolution),void 0!==d.rotation){p.sourceRotation=l;var f=tn(d.rotation-l+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=l+f,l=p.targetRotation}(!(c=p).sourceCenter||!c.targetCenter||t7(c.sourceCenter,c.targetCenter))&&c.sourceResolution===c.targetResolution&&c.sourceRotation===c.targetRotation?p.complete=!0:o+=p.duration,h.push(p)}this.animations_.push(h),this.setHint(n6.ANIMATING,1),this.updateAnimations_()},i.prototype.getAnimating=function(){return this.hints_[n6.ANIMATING]>0},i.prototype.getInteracting=function(){return this.hints_[n6.INTERACTING]>0},i.prototype.cancelAnimations=function(){this.setHint(n6.ANIMATING,-this.hints_[n6.ANIMATING]);for(var e,i=0,r=this.animations_.length;i<r;++i){var n=this.animations_[i];if(n[0].callback&&sD(n[0].callback,!1),!e)for(var o=0,a=n.length;o<a;++o){var s=n[o];if(!s.complete){e=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e},i.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var e=Date.now(),i=!1,r=this.animations_.length-1;r>=0;--r){for(var n=this.animations_[r],o=!0,a=0,s=n.length;a<s;++a){var l=n[a];if(!l.complete){var h=e-l.start,u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):o=!1;var c=l.easing(u);if(l.sourceCenter){var d=l.sourceCenter[0],p=l.sourceCenter[1],f=l.targetCenter[0],m=l.targetCenter[1],g=d+c*(f-d),_=p+c*(m-p);this.targetCenter_=[g,_]}if(l.sourceResolution&&l.targetResolution){var y=1===c?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);if(l.anchor){var v=this.getViewportSize_(this.getRotation()),x=this.constraints_.resolution(y,0,v,!0);this.targetCenter_=this.calculateCenterZoom(x,l.anchor)}this.targetResolution_=y,this.applyTargetState_(!0)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){var b=1===c?tn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);if(l.anchor){var w=this.constraints_.rotation(b,!0);this.targetCenter_=this.calculateCenterRotate(w,l.anchor)}this.targetRotation_=b}if(this.applyTargetState_(!0),i=!0,!l.complete)break}}if(o){this.animations_[r]=null,this.setHint(n6.ANIMATING,-1);var T=n[0].callback;T&&sD(T,!0)}}this.animations_=this.animations_.filter(Boolean),i&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},i.prototype.calculateCenterRotate=function(e,i){var r,n,o=this.getCenterInternal();return void 0!==o&&(ie(n=[o[0]-i[0],o[1]-i[1]],e-this.getRotation()),r=n,r[0]+=+i[0],r[1]+=+i[1]),n},i.prototype.calculateCenterZoom=function(e,i){var r,n=this.getCenterInternal(),o=this.getResolution();return void 0!==n&&void 0!==o&&(r=[i[0]-e*(i[0]-n[0])/o,i[1]-e*(i[1]-n[1])/o]),r},i.prototype.getViewportSize_=function(e){var i=this.viewportSize_;if(!e)return i;var r=i[0],n=i[1];return[Math.abs(r*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(r*Math.sin(e))+Math.abs(n*Math.cos(e))]},i.prototype.setViewportSize=function(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},i.prototype.getCenter=function(){var e=this.getCenterInternal();return e?iy(e,this.getProjection()):e},i.prototype.getCenterInternal=function(){return this.get(sb.CENTER)},i.prototype.getConstraints=function(){return this.constraints_},i.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},i.prototype.getHints=function(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()},i.prototype.calculateExtent=function(e){return ix(this.calculateExtentInternal(e),this.getProjection())},i.prototype.calculateExtentInternal=function(e){var i=e||this.getViewportSize_(),r=this.getCenterInternal();tM(r,1);var n=this.getResolution();tM(void 0!==n,2);var o=this.getRotation();return tM(void 0!==o,3),tJ(r,n,o,i)},i.prototype.getMaxResolution=function(){return this.maxResolution_},i.prototype.getMinResolution=function(){return this.minResolution_},i.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},i.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},i.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},i.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},i.prototype.setConstrainResolution=function(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))},i.prototype.getProjection=function(){return this.projection_},i.prototype.getResolution=function(){return this.get(sb.RESOLUTION)},i.prototype.getResolutions=function(){return this.resolutions_},i.prototype.getResolutionForExtent=function(e,i){return this.getResolutionForExtentInternal(ib(e,this.getProjection()),i)},i.prototype.getResolutionForExtentInternal=function(e,i){var r=i||this.getViewportSize_();return Math.max(t3(e)/r[0],tQ(e)/r[1])},i.prototype.getResolutionForValueFunction=function(e){var i=e||2,r=this.getConstrainedResolution(this.maxResolution_),n=Math.log(r/this.minResolution_)/Math.log(i);return function(e){return r/Math.pow(i,e*n)}},i.prototype.getRotation=function(){return this.get(sb.ROTATION)},i.prototype.getValueForResolutionFunction=function(e){var i=Math.log(e||2),r=this.getConstrainedResolution(this.maxResolution_),n=Math.log(r/this.minResolution_)/i;return function(e){return Math.log(r/e)/i/n}},i.prototype.getState=function(){var e=this.getCenterInternal(),i=this.getProjection(),r=this.getResolution(),n=this.getRotation();return{center:e.slice(0),projection:void 0!==i?i:null,resolution:r,rotation:n,zoom:this.getZoom()}},i.prototype.getZoom=function(){var e,i=this.getResolution();return void 0!==i&&(e=this.getZoomForResolution(i)),e},i.prototype.getZoomForResolution=function(e){var i,r,n=this.minZoom_||0;if(this.resolutions_){var o=iI(this.resolutions_,e,1);n=o,i=this.resolutions_[o],r=o==this.resolutions_.length-1?2:i/this.resolutions_[o+1]}else i=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(i/e)/Math.log(r)},i.prototype.getResolutionForZoom=function(e){if(!this.resolutions_)return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_);if(this.resolutions_.length<=1)return 0;var i=e7(Math.floor(e),0,this.resolutions_.length-2),r=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(r,e7(e-i,0,1))},i.prototype.fit=function(e,i){var r,n=t_({size:this.getViewportSize_()},i||{});if(tM(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,24),Array.isArray(e)){tM(!t4(e),25);var o=ib(e,this.getProjection());r=aI(o)}else if(e.getType()===t8.CIRCLE){var o=ib(e.getExtent(),this.getProjection());(r=aI(o)).rotate(this.getRotation(),tK(o))}else{var a=i_;r=a?e.clone().transform(a,this.getProjection()):e}this.fitInternal(r,n)},i.prototype.fitInternal=function(e,i){var r,n=i||{},o=n.size;o||(o=this.getViewportSize_());var a=void 0!==n.padding?n.padding:[0,0,0,0],s=void 0!==n.nearest&&n.nearest;r=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.getResolutionForZoom(n.maxZoom):0;for(var l=e.getFlatCoordinates(),h=this.getRotation(),u=Math.cos(-h),c=Math.sin(-h),d=1/0,p=1/0,f=-1/0,m=-1/0,g=e.getStride(),_=0,y=l.length;_<y;_+=g){var v=l[_]*u-l[_+1]*c,x=l[_]*c+l[_+1]*u;d=Math.min(d,v),p=Math.min(p,x),f=Math.max(f,v),m=Math.max(m,x)}var b=this.getResolutionForExtentInternal([d,p,f,m],[o[0]-a[1]-a[3],o[1]-a[0]-a[2]]);b=isNaN(b)?r:Math.max(b,r),b=this.getConstrainedResolution(b,+!s),c=-c;var w=(d+f)/2,T=(p+m)/2,S=[(w+=(a[1]-a[3])/2*b)*u-(T+=(a[0]-a[2])/2*b)*c,T*u+w*c],E=n.callback?n.callback:iP;void 0!==n.duration?this.animateInternal({resolution:b,center:this.getConstrainedCenter(S,b),duration:n.duration,easing:n.easing},E):(this.targetResolution_=b,this.targetCenter_=S,this.applyTargetState_(!1,!0),sD(E,!0))},i.prototype.centerOn=function(e,i,r){this.centerOnInternal(iv(e,this.getProjection()),i,r)},i.prototype.centerOnInternal=function(e,i,r){var n=this.getRotation(),o=Math.cos(-n),a=Math.sin(-n),s=e[0]*o-e[1]*a,l=e[1]*o+e[0]*a,h=this.getResolution();s+=(i[0]/2-r[0])*h;var u=s*o-(l+=(r[1]-i[1]/2)*h)*(a=-a),c=l*o+s*a;this.setCenterInternal([u,c])},i.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},i.prototype.adjustCenter=function(e){var i=iy(this.targetCenter_,this.getProjection());this.setCenter([i[0]+e[0],i[1]+e[1]])},i.prototype.adjustCenterInternal=function(e){var i=this.targetCenter_;this.setCenterInternal([i[0]+e[0],i[1]+e[1]])},i.prototype.adjustResolution=function(e,i){var r=i&&iv(i,this.getProjection());this.adjustResolutionInternal(e,r)},i.prototype.adjustResolutionInternal=function(e,i){var r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*e,0,n,r);i&&(this.targetCenter_=this.calculateCenterZoom(o,i)),this.targetResolution_*=e,this.applyTargetState_()},i.prototype.adjustZoom=function(e,i){this.adjustResolution(Math.pow(this.zoomFactor_,-e),i)},i.prototype.adjustRotation=function(e,i){i&&(i=iv(i,this.getProjection())),this.adjustRotationInternal(e,i)},i.prototype.adjustRotationInternal=function(e,i){var r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,r);i&&(this.targetCenter_=this.calculateCenterRotate(n,i)),this.targetRotation_+=e,this.applyTargetState_()},i.prototype.setCenter=function(e){this.setCenterInternal(iv(e,this.getProjection()))},i.prototype.setCenterInternal=function(e){this.targetCenter_=e,this.applyTargetState_()},i.prototype.setHint=function(e,i){return this.hints_[e]+=i,this.changed(),this.hints_[e]},i.prototype.setResolution=function(e){this.targetResolution_=e,this.applyTargetState_()},i.prototype.setRotation=function(e){this.targetRotation_=e,this.applyTargetState_()},i.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))},i.prototype.applyTargetState_=function(e,i){var r=this.getAnimating()||this.getInteracting()||i,n=this.constraints_.rotation(this.targetRotation_,r),o=this.getViewportSize_(n),a=this.constraints_.resolution(this.targetResolution_,0,o,r),s=this.constraints_.center(this.targetCenter_,a,o,r);this.get(sb.ROTATION)!==n&&this.set(sb.ROTATION,n),this.get(sb.RESOLUTION)!==a&&this.set(sb.RESOLUTION,a),this.get(sb.CENTER)&&t7(this.get(sb.CENTER),s)||this.set(sb.CENTER,s),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0},i.prototype.resolveConstraints=function(e,i,r){var n=void 0!==e?e:200,o=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(o),s=this.constraints_.resolution(this.targetResolution_,i||0,a),l=this.constraints_.center(this.targetCenter_,s,a);if(0===n&&!this.cancelAnchor_){this.targetResolution_=s,this.targetRotation_=o,this.targetCenter_=l,this.applyTargetState_();return}var h=r||(0===n?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===o&&this.getCenterInternal()&&t7(this.getCenterInternal(),l)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:s,duration:n,easing:sM,anchor:h}))},i.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(n6.INTERACTING,1)},i.prototype.endInteraction=function(e,i,r){var n=r&&iv(r,this.getProjection());this.endInteractionInternal(e,i,n)},i.prototype.endInteractionInternal=function(e,i,r){this.setHint(n6.INTERACTING,-1),this.resolveConstraints(e,i,r)},i.prototype.getConstrainedCenter=function(e,i){var r=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,i||this.getResolution(),r)},i.prototype.getConstrainedZoom=function(e,i){var r=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(r,i))},i.prototype.getConstrainedResolution=function(e,i){var r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,i||0,r)},i}(iU);function sD(e,i){setTimeout(function(){e(i)},0)}var sz=(el=function(e,i){return(el=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}el(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sF=function(e){function i(i){var r,n,o,a,s,l,h,u=e.call(this)||this,c=(s=null,void 0!==(r=i).keyboardEventTarget&&(s="string"==typeof r.keyboardEventTarget?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget),l={},h=r.layers&&"function"==typeof r.layers.getLayers?r.layers:new sr({layers:r.layers}),l[sd]=h,l[sf]=r.target,l[sm]=void 0!==r.view?r.view:new sL,void 0!==r.controls&&(Array.isArray(r.controls)?n=new ok(r.controls.slice()):(tM("function"==typeof r.controls.getArray,47),n=r.controls)),void 0!==r.interactions&&(Array.isArray(r.interactions)?o=new ok(r.interactions.slice()):(tM("function"==typeof r.interactions.getArray,48),o=r.interactions)),void 0!==r.overlays?Array.isArray(r.overlays)?a=new ok(r.overlays.slice()):(tM("function"==typeof r.overlays.getArray,49),a=r.overlays):a=new ok,{controls:n,interactions:o,keyboardEventTarget:s,overlays:a,values:l});return u.boundHandleBrowserEvent_=u.handleBrowserEvent.bind(u),u.maxTilesLoading_=void 0!==i.maxTilesLoading?i.maxTilesLoading:16,u.pixelRatio_=void 0!==i.pixelRatio?i.pixelRatio:i5,u.postRenderTimeoutHandle_,u.animationDelayKey_,u.animationDelay_=(function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}).bind(u),u.coordinateToPixelTransform_=rO(),u.pixelToCoordinateTransform_=rO(),u.frameIndex_=0,u.frameState_=null,u.previousExtent_=null,u.viewPropertyListenerKey_=null,u.viewChangeListenerKey_=null,u.layerGroupPropertyListenerKeys_=null,u.viewport_=document.createElement("div"),u.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),u.viewport_.style.position="relative",u.viewport_.style.overflow="hidden",u.viewport_.style.width="100%",u.viewport_.style.height="100%",u.overlayContainer_=document.createElement("div"),u.overlayContainer_.style.position="absolute",u.overlayContainer_.style.zIndex="0",u.overlayContainer_.style.width="100%",u.overlayContainer_.style.height="100%",u.overlayContainer_.style.pointerEvents="none",u.overlayContainer_.className="ol-overlaycontainer",u.viewport_.appendChild(u.overlayContainer_),u.overlayContainerStopEvent_=document.createElement("div"),u.overlayContainerStopEvent_.style.position="absolute",u.overlayContainerStopEvent_.style.zIndex="0",u.overlayContainerStopEvent_.style.width="100%",u.overlayContainerStopEvent_.style.height="100%",u.overlayContainerStopEvent_.style.pointerEvents="none",u.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",u.viewport_.appendChild(u.overlayContainerStopEvent_),u.mapBrowserEventHandler_=null,u.moveTolerance_=i.moveTolerance,u.keyboardEventTarget_=c.keyboardEventTarget,u.keyHandlerKeys_=null,u.controls=c.controls||new ok,u.interactions=c.interactions||new ok,u.overlays_=c.overlays,u.overlayIdIndex_={},u.renderer_=null,u.handleResize_,u.postRenderFunctions_=[],u.tileQueue_=new sx(u.getTilePriority.bind(u),u.handleTileChange_.bind(u)),u.addEventListener(iq(sd),u.handleLayerGroupChanged_),u.addEventListener(iq(sm),u.handleViewChanged_),u.addEventListener(iq(sp),u.handleSizeChanged_),u.addEventListener(iq(sf),u.handleTargetChanged_),u.setProperties(c.values),u.controls.forEach((function(e){e.setMap(this)}).bind(u)),u.controls.addEventListener(oR.ADD,(function(e){e.element.setMap(this)}).bind(u)),u.controls.addEventListener(oR.REMOVE,(function(e){e.element.setMap(null)}).bind(u)),u.interactions.forEach((function(e){e.setMap(this)}).bind(u)),u.interactions.addEventListener(oR.ADD,(function(e){e.element.setMap(this)}).bind(u)),u.interactions.addEventListener(oR.REMOVE,(function(e){e.element.setMap(null)}).bind(u)),u.overlays_.forEach(u.addOverlayInternal_.bind(u)),u.overlays_.addEventListener(oR.ADD,(function(e){this.addOverlayInternal_(e.element)}).bind(u)),u.overlays_.addEventListener(oR.REMOVE,(function(e){var i=e.element.getId();void 0!==i&&delete this.overlayIdIndex_[i.toString()],e.element.setMap(null)}).bind(u)),u}return sz(i,e),i.prototype.createRenderer=function(){throw Error("Use a map type that has a createRenderer method")},i.prototype.addControl=function(e){this.getControls().push(e)},i.prototype.addInteraction=function(e){this.getInteractions().push(e)},i.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)},i.prototype.addOverlay=function(e){this.getOverlays().push(e)},i.prototype.addOverlayInternal_=function(e){var i=e.getId();void 0!==i&&(this.overlayIdIndex_[i.toString()]=e),e.setMap(this)},i.prototype.disposeInternal=function(){this.setTarget(null),e.prototype.disposeInternal.call(this)},i.prototype.forEachFeatureAtPixel=function(e,i,r){if(this.frameState_){var n=this.getCoordinateFromPixelInternal(e),o=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,a=void 0!==r.layerFilter?r.layerFilter:iR,s=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,o,s,i,null,a,null)}},i.prototype.getFeaturesAtPixel=function(e,i){var r=[];return this.forEachFeatureAtPixel(e,function(e){r.push(e)},i),r},i.prototype.forEachLayerAtPixel=function(e,i,r){if(this.frameState_){var n=r||{},o=void 0!==n.hitTolerance?n.hitTolerance*this.frameState_.pixelRatio:0,a=n.layerFilter||iR;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,o,i,a)}},i.prototype.hasFeatureAtPixel=function(e,i){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixelInternal(e),n=void 0!==(i=void 0!==i?i:{}).layerFilter?i.layerFilter:iR,o=void 0!==i.hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,a=!1!==i.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,o,a,n,null)},i.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},i.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},i.prototype.getEventPixel=function(e){var i=this.viewport_.getBoundingClientRect(),r="changedTouches"in e?e.changedTouches[0]:e;return[r.clientX-i.left,r.clientY-i.top]},i.prototype.getTarget=function(){return this.get(sf)},i.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null},i.prototype.getCoordinateFromPixel=function(e){return iy(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},i.prototype.getCoordinateFromPixelInternal=function(e){var i=this.frameState_;return i?rz(i.pixelToCoordinateTransform,e.slice()):null},i.prototype.getControls=function(){return this.controls},i.prototype.getOverlays=function(){return this.overlays_},i.prototype.getOverlayById=function(e){var i=this.overlayIdIndex_[e.toString()];return void 0!==i?i:null},i.prototype.getInteractions=function(){return this.interactions},i.prototype.getLayerGroup=function(){return this.get(sd)},i.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},i.prototype.getLoading=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),i=0,r=e.length;i<r;++i){var n=e[i].layer.getSource();if(n&&n.loading)return!0}return!1},i.prototype.getPixelFromCoordinate=function(e){var i=iv(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(i)},i.prototype.getPixelFromCoordinateInternal=function(e){var i=this.frameState_;return i?rz(i.coordinateToPixelTransform,e.slice(0,2)):null},i.prototype.getRenderer=function(){return this.renderer_},i.prototype.getSize=function(){return this.get(sp)},i.prototype.getView=function(){return this.get(sm)},i.prototype.getViewport=function(){return this.viewport_},i.prototype.getOverlayContainer=function(){return this.overlayContainer_},i.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},i.prototype.getTilePriority=function(e,i,r,n){return function(e,i,r,n,o){if(!e||!(r in e.wantedTiles)||!e.wantedTiles[r][i.getKey()])return sg;var a=e.viewState.center,s=n[0]-a[0],l=n[1]-a[1];return 65536*Math.log(o)+Math.sqrt(s*s+l*l)/o}(this.frameState_,e,i,r,n)},i.prototype.handleBrowserEvent=function(e,i){var r=new ss(i||e.type,this,e);this.handleMapBrowserEvent(r)},i.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){var i=e.originalEvent,r=i.type;if(r===sh.POINTERDOWN||r===iL.WHEEL||r===iL.KEYDOWN){var n=this.viewport_.getRootNode?this.viewport_.getRootNode():document,o=n===document?i.target:n.elementFromPoint(i.clientX,i.clientY);if(this.overlayContainerStopEvent_.contains(o)||!(n===document?document.documentElement:n).contains(o))return}e.frameState=this.frameState_;var a=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(var s=a.length-1;s>=0;s--){var l=a[s];if(l.getActive()&&!l.handleEvent(e))break}}},i.prototype.handlePostRender=function(){var e=this.frameState_,i=this.tileQueue_;if(!i.isEmpty()){var r=this.maxTilesLoading_,n=r;if(e){var o=e.viewHints;if(o[n6.ANIMATING]||o[n6.INTERACTING]){var a=!i6&&Date.now()-e.time>8;r=8*!a,n=2*!a}}i.getTilesLoading()<r&&(i.reprioritize(),i.loadMoreTiles(r,n))}e&&this.hasListener(rg.RENDERCOMPLETE)&&!e.animate&&!this.tileQueue_.getTilesLoading()&&!this.getLoading()&&this.renderer_.dispatchRenderEvent(rg.RENDERCOMPLETE,e);for(var s=this.postRenderFunctions_,l=0,h=s.length;l<h;++l)s[l](this,e);s.length=0},i.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},i.prototype.handleTargetChanged_=function(){var e;if(this.getTarget()&&(e=this.getTargetElement()),this.mapBrowserEventHandler_){for(var i=0,r=this.keyHandlerKeys_.length;i<r;++i)iz(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener(iL.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(iL.WHEEL,this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener(iL.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,re(this.viewport_)}if(e){for(var n in e.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new sc(this,this.moveTolerance_),sl)this.mapBrowserEventHandler_.addEventListener(sl[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(iL.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(iL.WHEEL,this.boundHandleBrowserEvent_,!!i8&&{passive:!1});var o=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[iD(o,iL.KEYDOWN,this.handleBrowserEvent,this),iD(o,iL.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(iL.RESIZE,this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},i.prototype.handleTileChange_=function(){this.render()},i.prototype.handleViewPropertyChanged_=function(){this.render()},i.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(iz(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(iz(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=iD(e,iT.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=iD(e,iL.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},i.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(iz),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[iD(e,iT.PROPERTYCHANGE,this.render,this),iD(e,iL.CHANGE,this.render,this)]),this.render()},i.prototype.isRendered=function(){return!!this.frameState_},i.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},i.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),i=0,r=e.length;i<r;++i){var n=e[i].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}},i.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},i.prototype.removeControl=function(e){return this.getControls().remove(e)},i.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},i.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)},i.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},i.prototype.renderFrame_=function(e){var i,r=this.getSize(),n=this.getView(),o=this.frameState_,a=null;if(void 0!==r&&(i=r)[0]>0&&i[1]>0&&n&&n.isDef()){var s=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=n.getState();a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterItems:o?o.declutterItems:[],extent:tJ(l.center,l.resolution,l.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:l,viewHints:s,wantedTiles:{}}}this.frameState_=a,this.renderer_.renderFrame(a),a&&(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),o&&(this.previousExtent_&&(t4(this.previousExtent_)||tG(a.extent,this.previousExtent_))||(this.dispatchEvent(new so(i$.MOVESTART,this,o)),this.previousExtent_=tV(this.previousExtent_))),!this.previousExtent_||a.viewHints[n6.ANIMATING]||a.viewHints[n6.INTERACTING]||tG(a.extent,this.previousExtent_)||(this.dispatchEvent(new so(i$.MOVEEND,this,a)),tk(a.extent,this.previousExtent_))),this.dispatchEvent(new so(i$.POSTRENDER,this,a)),this.postRenderTimeoutHandle_=setTimeout(this.handlePostRender.bind(this),0)},i.prototype.setLayerGroup=function(e){this.set(sd,e)},i.prototype.setSize=function(e){this.set(sp,e)},i.prototype.setTarget=function(e){this.set(sf,e)},i.prototype.setView=function(e){this.set(sm,e)},i.prototype.updateSize=function(){var e=this.getTargetElement();if(e){var i=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),e.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth)])}else this.setSize(void 0);this.updateViewportSize_()},i.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var i=void 0,r=getComputedStyle(this.viewport_);r.width&&r.height&&(i=[parseInt(r.width,10),parseInt(r.height,10)]),e.setViewportSize(i)}},i}(iU),sB=(eh=function(e,i){return(eh=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eh(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sN=function(e){function i(i){var r=e.call(this)||this,n=i.element;return!n||i.target||n.style.pointerEvents||(n.style.pointerEvents="auto"),r.element=n||null,r.target_=null,r.map_=null,r.listenerKeys=[],i.render&&(r.render=i.render),i.target&&r.setTarget(i.target),r}return sB(i,e),i.prototype.disposeInternal=function(){re(this.element),e.prototype.disposeInternal.call(this)},i.prototype.getMap=function(){return this.map_},i.prototype.setMap=function(e){this.map_&&re(this.element);for(var i=0,r=this.listenerKeys.length;i<r;++i)iz(this.listenerKeys[i]);this.listenerKeys.length=0,this.map_=e,this.map_&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==iP&&this.listenerKeys.push(iD(e,i$.POSTRENDER,this.render,this)),e.render())},i.prototype.render=function(e){},i.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e},i}(iU),sj=(eu=function(e,i){return(eu=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eu(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sV=function(e){function i(i){var r=this,n=i||{};(r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this).ulElement_=document.createElement("ul"),r.collapsed_=void 0===n.collapsed||n.collapsed,r.overrideCollapsible_=void 0!==n.collapsible,r.collapsible_=void 0===n.collapsible||n.collapsible,r.collapsible_||(r.collapsed_=!1);var o=void 0!==n.className?n.className:"ol-attribution",a=void 0!==n.tipLabel?n.tipLabel:"Attributions",s=void 0!==n.collapseLabel?n.collapseLabel:"Â»";"string"==typeof s?(r.collapseLabel_=document.createElement("span"),r.collapseLabel_.textContent=s):r.collapseLabel_=s;var l=void 0!==n.label?n.label:"i";"string"==typeof l?(r.label_=document.createElement("span"),r.label_.textContent=l):r.label_=l;var h=r.collapsible_&&!r.collapsed_?r.collapseLabel_:r.label_,u=document.createElement("button");u.setAttribute("type","button"),u.title=a,u.appendChild(h),u.addEventListener(iL.CLICK,r.handleClick_.bind(r),!1);var c=o+" "+iW+" "+iX+(r.collapsed_&&r.collapsible_?" "+iY:"")+(r.collapsible_?"":" ol-uncollapsible"),d=r.element;return d.className=c,d.appendChild(r.ulElement_),d.appendChild(u),r.renderedAttributions_=[],r.renderedVisible_=!0,r}return sj(i,e),i.prototype.collectSourceAttributions_=function(e){for(var i={},r=[],n=e.layerStatesArray,o=0,a=n.length;o<a;++o){var s=n[o];if(!rx(s,e.viewState))continue;var l=s.layer.getSource();if(l){var h=l.getAttributions();if(h){var u=h(e);if(u)if(this.overrideCollapsible_||!1!==l.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(u))for(var c=0,d=u.length;c<d;++c)u[c]in i||(r.push(u[c]),i[u[c]]=!0);else u in i||(r.push(u),i[u]=!0)}}}return r},i.prototype.updateElement_=function(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var i=this.collectSourceAttributions_(e),r=i.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!iA(i,this.renderedAttributions_)){rt(this.ulElement_);for(var n=0,o=i.length;n<o;++n){var a=document.createElement("li");a.innerHTML=i[n],this.ulElement_.appendChild(a)}this.renderedAttributions_=i}},i.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},i.prototype.handleToggle_=function(){this.element.classList.toggle(iY),this.collapsed_?i7(this.collapseLabel_,this.label_):i7(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},i.prototype.getCollapsible=function(){return this.collapsible_},i.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},i.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},i.prototype.getCollapsed=function(){return this.collapsed_},i.prototype.render=function(e){this.updateElement_(e.frameState)},i}(sN),sU=(ec=function(e,i){return(ec=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ec(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sG=function(e){function i(i){var r=this,n=i||{};r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var o=void 0!==n.className?n.className:"ol-rotate",a=void 0!==n.label?n.label:"â§";r.label_=null,"string"==typeof a?(r.label_=document.createElement("span"),r.label_.className="ol-compass",r.label_.textContent=a):(r.label_=a,r.label_.classList.add("ol-compass"));var s=n.tipLabel?n.tipLabel:"Reset rotation",l=document.createElement("button");l.className=o+"-reset",l.setAttribute("type","button"),l.title=s,l.appendChild(r.label_),l.addEventListener(iL.CLICK,r.handleClick_.bind(r),!1);var h=r.element;return h.className=o+" "+iW+" "+iX,h.appendChild(l),r.callResetNorth_=n.resetNorth?n.resetNorth:void 0,r.duration_=void 0!==n.duration?n.duration:250,r.autoHide_=void 0===n.autoHide||n.autoHide,r.rotation_=void 0,r.autoHide_&&r.element.classList.add(iZ),r}return sU(i,e),i.prototype.handleClick_=function(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},i.prototype.resetNorth_=function(){var e=this.getMap().getView();if(e){var i=e.getRotation();void 0!==i&&(this.duration_>0&&i%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:sM}):e.setRotation(0))}},i.prototype.render=function(e){var i=e.frameState;if(i){var r=i.viewState.rotation;if(r!=this.rotation_){if(this.autoHide_){var n=this.element.classList.contains(iZ);n||0!==r?n&&0!==r&&this.element.classList.remove(iZ):this.element.classList.add(iZ)}this.label_.style.transform="rotate("+r+"rad)"}this.rotation_=r}},i}(sN),sq=(ed=function(e,i){return(ed=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ed(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),s$=function(e){function i(i){var r=this,n=i||{};r=e.call(this,{element:document.createElement("div"),target:n.target})||this;var o=void 0!==n.className?n.className:"ol-zoom",a=void 0!==n.delta?n.delta:1,s=void 0!==n.zoomInLabel?n.zoomInLabel:"+",l=void 0!==n.zoomOutLabel?n.zoomOutLabel:"â",h=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:"Zoom in",u=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=o+"-in",c.setAttribute("type","button"),c.title=h,c.appendChild("string"==typeof s?document.createTextNode(s):s),c.addEventListener(iL.CLICK,r.handleClick_.bind(r,a),!1);var d=document.createElement("button");d.className=o+"-out",d.setAttribute("type","button"),d.title=u,d.appendChild("string"==typeof l?document.createTextNode(l):l),d.addEventListener(iL.CLICK,r.handleClick_.bind(r,-a),!1);var p=r.element;return p.className=o+" "+iW+" "+iX,p.appendChild(c),p.appendChild(d),r.duration_=void 0!==n.duration?n.duration:250,r}return sq(i,e),i.prototype.handleClick_=function(e,i){i.preventDefault(),this.zoomByDelta_(e)},i.prototype.zoomByDelta_=function(e){var i=this.getMap().getView();if(i){var r=i.getZoom();if(void 0!==r){var n=i.getConstrainedZoom(r+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:n,duration:this.duration_,easing:sM})):i.setZoom(n)}}},i}(sN),sH="active",sZ=(ep=function(e,i){return(ep=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ep(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sW=function(e){function i(i){var r=e.call(this)||this;return i&&i.handleEvent&&(r.handleEvent=i.handleEvent),r.map_=null,r.setActive(!0),r}return sZ(i,e),i.prototype.getActive=function(){return this.get(sH)},i.prototype.getMap=function(){return this.map_},i.prototype.handleEvent=function(e){return!0},i.prototype.setActive=function(e){this.set(sH,e)},i.prototype.setMap=function(e){this.map_=e},i}(iU);function sX(e,i,r,n){var o=e.getZoom();if(void 0!==o){var a=e.getConstrainedZoom(o+i),s=e.getResolutionForZoom(a);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:s,anchor:r,duration:void 0!==n?n:250,easing:sM})}}var sY=(ef=function(e,i){return(ef=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ef(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sK=function(e){function i(i){var r=e.call(this)||this,n=i||{};return r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:250,r}return sY(i,e),i.prototype.handleEvent=function(e){var i=!1;if(e.type==sl.DBLCLICK){var r=e.originalEvent,n=e.map,o=e.coordinate,a=r.shiftKey?-this.delta_:this.delta_;sX(n.getView(),a,o,this.duration_),e.preventDefault(),i=!0}return!i},i}(sW),sJ=(em=function(e,i){return(em=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}em(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),sQ=function(e){function i(i){var r=this,n=i||{};return r=e.call(this,n)||this,n.handleDownEvent&&(r.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(r.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(r.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(r.handleUpEvent=n.handleUpEvent),n.stopDown&&(r.stopDown=n.stopDown),r.handlingDownUpSequence=!1,r.trackedPointers_={},r.targetPointers=[],r}return sJ(i,e),i.prototype.getPointerCount=function(){return this.targetPointers.length},i.prototype.handleDownEvent=function(e){return!1},i.prototype.handleDragEvent=function(e){},i.prototype.handleEvent=function(e){if(!e.originalEvent)return!0;var i=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==sl.POINTERDRAG)this.handleDragEvent(e),e.preventDefault();else if(e.type==sl.POINTERUP){var r=this.handleUpEvent(e);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(e.type==sl.POINTERDOWN){var n=this.handleDownEvent(e);this.handlingDownUpSequence=n,i=this.stopDown(n)}else e.type==sl.POINTERMOVE&&this.handleMoveEvent(e);return!i},i.prototype.handleMoveEvent=function(e){},i.prototype.handleUpEvent=function(e){return!1},i.prototype.stopDown=function(e){return e},i.prototype.updateTrackedPointers_=function(e){if((i=e.type)===sl.POINTERDOWN||i===sl.POINTERDRAG||i===sl.POINTERUP){var i,r=e.originalEvent,n=r.pointerId.toString();e.type==sl.POINTERUP?delete this.trackedPointers_[n]:e.type==sl.POINTERDOWN?this.trackedPointers_[n]=r:n in this.trackedPointers_&&(this.trackedPointers_[n]=r),this.targetPointers=tv(this.trackedPointers_)}},i}(sW);function s0(e){for(var i=e.length,r=0,n=0,o=0;o<i;o++)r+=e[o].clientX,n+=e[o].clientY;return[r/i,n/i]}function s1(e){var i=arguments;return function(e){for(var r=!0,n=0,o=i.length;n<o&&(r=r&&i[n](e));++n);return r}}var s2=function(e){var i=e.originalEvent;return i.altKey&&!(i.metaKey||i.ctrlKey)&&i.shiftKey},s3=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||e.target.getTargetElement().contains(document.activeElement)},s5=function(e){var i=e.originalEvent;return 0==i.button&&!(i2&&i3&&i.ctrlKey)},s4=function(e){var i=e.originalEvent;return!i.altKey&&!(i.metaKey||i.ctrlKey)&&!i.shiftKey},s6=function(e){var i=e.originalEvent;return!i.altKey&&!(i.metaKey||i.ctrlKey)&&i.shiftKey},s8=function(e){var i=e.originalEvent.target.tagName;return"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i},s9=function(e){var i=e.originalEvent;return tM(void 0!==i,56),"mouse"==i.pointerType},s7=function(e){var i=e.originalEvent;return tM(void 0!==i,56),i.isPrimary&&0===i.button},le=(eg=function(e,i){return(eg=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eg(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lt=function(e){function i(i){var r=e.call(this,{stopDown:iM})||this,n=i||{};r.kinetic_=n.kinetic,r.lastCentroid=null,r.lastPointersCount_,r.panning_=!1;var o=n.condition?n.condition:s1(s4,s7);return r.condition_=n.onFocusOnly?s1(s3,o):o,r.noKinetic_=!1,r}return le(i,e),i.prototype.handleDragEvent=function(e){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var i=this.targetPointers,r=s0(i);if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var n,o=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=e.map.getView();n=a.getResolution(),o[0]*=n,o[1]*=n,ie(o,a.getRotation()),a.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()},i.prototype.handleUpEvent=function(e){var i=e.map,r=i.getView();if(0!==this.targetPointers.length)return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0;if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),a=r.getCenterInternal(),s=i.getPixelFromCoordinateInternal(a),l=i.getCoordinateFromPixelInternal([s[0]-n*Math.cos(o),s[1]-n*Math.sin(o)]);r.animateInternal({center:r.getConstrainedCenter(l),duration:500,easing:sM})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1},i.prototype.handleDownEvent=function(e){if(!(this.targetPointers.length>0&&this.condition_(e)))return!1;var i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0},i}(sQ),li=(e_=function(e,i){return(e_=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}e_(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lr=function(e){function i(i){var r=this,n=i||{};return(r=e.call(this,{stopDown:iM})||this).condition_=n.condition?n.condition:s2,r.lastAngle_=void 0,r.duration_=void 0!==n.duration?n.duration:250,r}return li(i,e),i.prototype.handleDragEvent=function(e){if(s9(e)){var i=e.map,r=i.getView();if(r.getConstraints().rotation!==sC){var n=i.getSize(),o=e.pixel,a=Math.atan2(n[1]/2-o[1],o[0]-n[0]/2);if(void 0!==this.lastAngle_){var s=a-this.lastAngle_;r.adjustRotationInternal(-s)}this.lastAngle_=a}}},i.prototype.handleUpEvent=function(e){return!s9(e)||(e.map.getView().endInteraction(this.duration_),!1)},i.prototype.handleDownEvent=function(e){return!!s9(e)&&!!(s5(e)&&this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)},i}(sQ),ln=(ey=function(e,i){return(ey=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ey(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lo=function(e){function i(i){var r=e.call(this)||this;return r.geometry_=null,r.element_=document.createElement("div"),r.element_.style.position="absolute",r.element_.style.pointerEvents="auto",r.element_.className="ol-box "+i,r.map_=null,r.startPixel_=null,r.endPixel_=null,r}return ln(i,e),i.prototype.disposeInternal=function(){this.setMap(null)},i.prototype.render_=function(){var e=this.startPixel_,i=this.endPixel_,r=this.element_.style;r.left=Math.min(e[0],i[0])+"px",r.top=Math.min(e[1],i[1])+"px",r.width=Math.abs(i[0]-e[0])+"px",r.height=Math.abs(i[1]-e[1])+"px"},i.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var i=this.element_.style;i.left="inherit",i.top="inherit",i.width="inherit",i.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},i.prototype.setPixels=function(e,i){this.startPixel_=e,this.endPixel_=i,this.createOrUpdateGeometry(),this.render_()},i.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,i=this.endPixel_,r=[e,[e[0],i[1]],i,[i[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new aE([r])},i.prototype.getGeometry=function(){return this.geometry_},i}(iS),la=(ev=function(e,i){return(ev=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ev(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ls={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},ll=function(e){function i(i,r,n){var o=e.call(this,i)||this;return o.coordinate=r,o.mapBrowserEvent=n,o}return la(i,e),i}(iw),lh=function(e){function i(i){var r=e.call(this)||this,n=i||{};return r.box_=new lo(n.className||"ol-dragbox"),r.minArea_=void 0!==n.minArea?n.minArea:64,n.onBoxEnd&&(r.onBoxEnd=n.onBoxEnd),r.startPixel_=null,r.condition_=n.condition?n.condition:s5,r.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:r.defaultBoxEndCondition,r}return la(i,e),i.prototype.defaultBoxEndCondition=function(e,i,r){var n=r[0]-i[0],o=r[1]-i[1];return n*n+o*o>=this.minArea_},i.prototype.getGeometry=function(){return this.box_.getGeometry()},i.prototype.handleDragEvent=function(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ll(ls.BOXDRAG,e.coordinate,e))},i.prototype.handleUpEvent=function(e){return this.box_.setMap(null),this.boxEndCondition_(e,this.startPixel_,e.pixel)&&(this.onBoxEnd(e),this.dispatchEvent(new ll(ls.BOXEND,e.coordinate,e))),!1},i.prototype.handleDownEvent=function(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ll(ls.BOXSTART,e.coordinate,e)),!0)},i.prototype.onBoxEnd=function(e){},i}(sQ),lu=(ex=function(e,i){return(ex=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ex(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lc=function(e){function i(i){var r=this,n=i||{},o=n.condition?n.condition:s6;return(r=e.call(this,{condition:o,className:n.className||"ol-dragzoom",minArea:n.minArea})||this).duration_=void 0!==n.duration?n.duration:200,r.out_=void 0!==n.out&&n.out,r}return lu(i,e),i.prototype.onBoxEnd=function(e){var i=this.getMap(),r=i.getView(),n=i.getSize(),o=this.getGeometry().getExtent();if(this.out_){var a,s,l,h,u=r.calculateExtentInternal(n),c=(a=[i.getPixelFromCoordinateInternal(tX(o)),i.getPixelFromCoordinateInternal(t2(o))],function(e,i){for(var r=0,n=i.length;r<n;++r)t$(e,i[r]);return e}(tV(void 0),a));s=1/r.getResolutionForExtentInternal(c,n),l=(u[2]-u[0])/2*(s-1),h=(u[3]-u[1])/2*(s-1),u[0]-=l,u[2]+=l,u[1]-=h,u[3]+=h,o=u}var d=r.getConstrainedResolution(r.getResolutionForExtentInternal(o,n)),p=r.getConstrainedCenter(tK(o),d);r.animateInternal({resolution:d,center:p,duration:this.duration_,easing:sM})},i}(lh),ld={LEFT:37,UP:38,RIGHT:39,DOWN:40},lp=(eb=function(e,i){return(eb=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eb(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lf=function(e){function i(i){var r=e.call(this)||this,n=i||{};return r.defaultCondition_=function(e){return s4(e)&&s8(e)},r.condition_=void 0!==n.condition?n.condition:r.defaultCondition_,r.duration_=void 0!==n.duration?n.duration:100,r.pixelDelta_=void 0!==n.pixelDelta?n.pixelDelta:128,r}return lp(i,e),i.prototype.handleEvent=function(e){var i=!1;if(e.type==iL.KEYDOWN){var r=e.originalEvent.keyCode;if(this.condition_(e)&&(r==ld.DOWN||r==ld.LEFT||r==ld.RIGHT||r==ld.UP)){var n=e.map.getView(),o=n.getResolution()*this.pixelDelta_,a=0,s=0;r==ld.DOWN?s=-o:r==ld.LEFT?a=-o:r==ld.RIGHT?a=o:s=o;var l=[a,s];ie(l,n.getRotation());var h=this.duration_,u=n.getCenterInternal();if(u){var c=[u[0]+l[0],u[1]+l[1]];n.animateInternal({duration:void 0!==h?h:250,easing:sO,center:n.getConstrainedCenter(c)})}e.preventDefault(),i=!0}}return!i},i}(sW),lm=(ew=function(e,i){return(ew=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ew(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lg=function(e){function i(i){var r=e.call(this)||this,n=i||{};return r.condition_=n.condition?n.condition:s8,r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:100,r}return lm(i,e),i.prototype.handleEvent=function(e){var i=!1;if(e.type==iL.KEYDOWN||e.type==iL.KEYPRESS){var r=e.originalEvent.charCode;if(this.condition_(e)&&(43==r||45==r)){var n=e.map,o=43==r?this.delta_:-this.delta_;sX(n.getView(),o,void 0,this.duration_),e.preventDefault(),i=!0}}return!i},i}(sW),l_=function(){function e(e,i,r){this.decay_=e,this.minVelocity_=i,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}return e.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},e.prototype.update=function(e,i){this.points_.push(e,i,Date.now())},e.prototype.end=function(){if(this.points_.length<6)return!1;var e=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<e)return!1;for(var r=i-3;r>0&&this.points_[r+2]>e;)r-=3;var n=this.points_[i+2]-this.points_[r+2];if(n<1e3/60)return!1;var o=this.points_[i]-this.points_[r],a=this.points_[i+1]-this.points_[r+1];return this.angle_=Math.atan2(a,o),this.initialVelocity_=Math.sqrt(o*o+a*a)/n,this.initialVelocity_>this.minVelocity_},e.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},e.prototype.getAngle=function(){return this.angle_},e}(),ly=(eT=function(e,i){return(eT=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eT(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lv={TRACKPAD:"trackpad",WHEEL:"wheel"},lx=function(e){function i(i){var r=this,n=i||{};(r=e.call(this,n)||this).totalDelta_=0,r.lastDelta_=0,r.maxDelta_=void 0!==n.maxDelta?n.maxDelta:1,r.duration_=void 0!==n.duration?n.duration:250,r.timeout_=void 0!==n.timeout?n.timeout:80,r.useAnchor_=void 0===n.useAnchor||n.useAnchor,r.constrainResolution_=void 0!==n.constrainResolution&&n.constrainResolution;var o=n.condition?n.condition:iR;return r.condition_=n.onFocusOnly?s1(s3,o):o,r.lastAnchor_=null,r.startTime_=void 0,r.timeoutId_,r.mode_=void 0,r.trackpadEventGap_=400,r.trackpadTimeoutId_,r.deltaPerZoom_=300,r}return ly(i,e),i.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},i.prototype.handleEvent=function(e){if(!this.condition_(e)||e.type!==iL.WHEEL)return!0;e.preventDefault();var i,r=e.map,n=e.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==iL.WHEEL&&(i=n.deltaY,i1&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=i5),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)),0===i)return!1;this.lastDelta_=i;var o=Date.now();void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=4>Math.abs(i)?lv.TRACKPAD:lv.WHEEL);var a=r.getView();if(this.mode_===lv.TRACKPAD&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-i/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=i;var s=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),s),!1},i.prototype.handleWheelZoom_=function(e){var i=e.getView();i.getAnimating()&&i.cancelAnimations();var r=-e7(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(i.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),sX(i,r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},i.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)},i}(sW),lb=(eS=function(e,i){return(eS=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eS(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lw=function(e){function i(i){var r=this,n=i||{};return n.stopDown||(n.stopDown=iM),(r=e.call(this,n)||this).anchor_=null,r.lastAngle_=void 0,r.rotating_=!1,r.rotationDelta_=0,r.threshold_=void 0!==n.threshold?n.threshold:.3,r.duration_=void 0!==n.duration?n.duration:250,r}return lb(i,e),i.prototype.handleDragEvent=function(e){var i=0,r=this.targetPointers[0],n=this.targetPointers[1],o=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){var a=o-this.lastAngle_;this.rotationDelta_+=a,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),i=a}this.lastAngle_=o;var s=e.map,l=s.getView();if(l.getConstraints().rotation!==sC){var h=s.getViewport().getBoundingClientRect(),u=s0(this.targetPointers);u[0]-=h.left,u[1]-=h.top,this.anchor_=s.getCoordinateFromPixelInternal(u),this.rotating_&&(s.render(),l.adjustRotationInternal(i,this.anchor_))}},i.prototype.handleUpEvent=function(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)},i.prototype.handleDownEvent=function(e){if(!(this.targetPointers.length>=2))return!1;var i=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||i.getView().beginInteraction(),!0},i}(sQ),lT=(eE=function(e,i){return(eE=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eE(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lS=function(e){function i(i){var r=this,n=i||{};return n.stopDown||(n.stopDown=iM),(r=e.call(this,n)||this).anchor_=null,r.duration_=void 0!==n.duration?n.duration:400,r.lastDistance_=void 0,r.lastScaleDelta_=1,r}return lT(i,e),i.prototype.handleDragEvent=function(e){var i=1,r=this.targetPointers[0],n=this.targetPointers[1],o=r.clientX-n.clientX,a=r.clientY-n.clientY,s=Math.sqrt(o*o+a*a);void 0!==this.lastDistance_&&(i=this.lastDistance_/s),this.lastDistance_=s;var l=e.map,h=l.getView();1!=i&&(this.lastScaleDelta_=i);var u=l.getViewport().getBoundingClientRect(),c=s0(this.targetPointers);c[0]-=u.left,c[1]-=u.top,this.anchor_=l.getCoordinateFromPixelInternal(c),l.render(),h.adjustResolutionInternal(i,this.anchor_)},i.prototype.handleUpEvent=function(e){if(!(this.targetPointers.length<2))return!0;var i=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1},i.prototype.handleDownEvent=function(e){if(!(this.targetPointers.length>=2))return!1;var i=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||i.getView().beginInteraction(),!0},i}(sQ),lE=(eI=function(e,i){return(eI=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eI(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lI=function(e){function i(i){var r,n,o,a,s,l=this;return(i=t_({},i)).controls||(i.controls=(r={},n=new ok,(void 0===r.zoom||r.zoom)&&n.push(new s$(r.zoomOptions)),(void 0===r.rotate||r.rotate)&&n.push(new sG(r.rotateOptions)),(void 0===r.attribution||r.attribution)&&n.push(new sV(r.attributionOptions)),n)),i.interactions||(i.interactions=(o={onFocusOnly:!0},a=new ok,s=new l_(-.005,.05,100),(void 0===o.altShiftDragRotate||o.altShiftDragRotate)&&a.push(new lr),(void 0===o.doubleClickZoom||o.doubleClickZoom)&&a.push(new sK({delta:o.zoomDelta,duration:o.zoomDuration})),(void 0===o.dragPan||o.dragPan)&&a.push(new lt({onFocusOnly:o.onFocusOnly,kinetic:s})),(void 0===o.pinchRotate||o.pinchRotate)&&a.push(new lw),(void 0===o.pinchZoom||o.pinchZoom)&&a.push(new lS({duration:o.zoomDuration})),(void 0===o.keyboard||o.keyboard)&&(a.push(new lf),a.push(new lg({delta:o.zoomDelta,duration:o.zoomDuration}))),(void 0===o.mouseWheelZoom||o.mouseWheelZoom)&&a.push(new lx({onFocusOnly:o.onFocusOnly,duration:o.zoomDuration})),(void 0===o.shiftDragZoom||o.shiftDragZoom)&&a.push(new lc({duration:o.zoomDuration})),a)),e.call(this,i)||this}return lE(i,e),i.prototype.createRenderer=function(){return new se(this)},i}(sF),lC=function(){function e(e,i,r,n){this.minX=e,this.maxX=i,this.minY=r,this.maxY=n}return e.prototype.contains=function(e){return this.containsXY(e[1],e[2])},e.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},e.prototype.containsXY=function(e,i){return this.minX<=e&&e<=this.maxX&&this.minY<=i&&i<=this.maxY},e.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},e.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},e.prototype.getHeight=function(){return this.maxY-this.minY+1},e.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},e.prototype.getWidth=function(){return this.maxX-this.minX+1},e.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY},e}();function lA(e,i,r,n,o){return void 0!==o?(o.minX=e,o.maxX=i,o.minY=r,o.maxY=n,o):new lC(e,i,r,n)}function lR(e,i,r,n){return void 0!==n?(n[0]=e,n[1]=i,n[2]=r,n):[e,i,r]}function lM(e,i,r){return e+"/"+i+"/"+r}function lP(e){return lM(e[0],e[1],e[2])}function lO(e){return e.split("/").map(Number)}var lk=[0,0,0],lL=function(){function e(e){if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,tM((i=this.resolutions_,r=function(e,i){return i-e},i.every(function(e,n){if(0===n)return!0;var o=r(i[n-1],e);return!(o>0||0===o)})),17),!e.origins)for(var i,r,n,o=0,a=this.resolutions_.length-1;o<a;++o)if(n){if(this.resolutions_[o]/this.resolutions_[o+1]!==n){n=void 0;break}}else n=this.resolutions_[o]/this.resolutions_[o+1];this.zoomFactor_=n,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,tM(this.origins_.length==this.resolutions_.length,20));var s=e.extent;void 0===s||this.origin_||this.origins_||(this.origin_=t1(s)),tM(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,tM(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:256,tM(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==s?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map(function(e,i){return new lC(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1))},this):s&&this.calculateTileRanges_(s)}return e.prototype.forEachTileCoord=function(e,i,r){for(var n=this.getTileRangeForExtentAndZ(e,i),o=n.minX,a=n.maxX;o<=a;++o)for(var s=n.minY,l=n.maxY;s<=l;++s)r([i,o,s])},e.prototype.forEachTileCoordParentTileRange=function(e,i,r,n){var o,a,s,l=null,h=e[0]-1;for(2===this.zoomFactor_?(a=e[1],s=e[2]):l=this.getTileCoordExtent(e,n);h>=this.minZoom;){if(o=2===this.zoomFactor_?lA(a=Math.floor(a/2),a,s=Math.floor(s/2),s,r):this.getTileRangeForExtentAndZ(l,h,r),i(h,o))return!0;--h}return!1},e.prototype.getExtent=function(){return this.extent_},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.getMinZoom=function(){return this.minZoom},e.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},e.prototype.getResolution=function(e){return this.resolutions_[e]},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getTileCoordChildTileRange=function(e,i,r){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*e[1],o=2*e[2];return lA(n,n+1,o,o+1,i)}var a=this.getTileCoordExtent(e,r);return this.getTileRangeForExtentAndZ(a,e[0]+1,i)}return null},e.prototype.getTileRangeExtent=function(e,i,r){var n=this.getOrigin(e),o=this.getResolution(e),a=rw(this.getTileSize(e),this.tmpSize_),s=n[0]+i.minX*a[0]*o,l=n[0]+(i.maxX+1)*a[0]*o;return tj(s,n[1]+i.minY*a[1]*o,l,n[1]+(i.maxY+1)*a[1]*o,r)},e.prototype.getTileRangeForExtentAndZ=function(e,i,r){this.getTileCoordForXYAndZ_(e[0],e[3],i,!1,lk);var n=lk[1],o=lk[2];return this.getTileCoordForXYAndZ_(e[2],e[1],i,!0,lk),lA(n,lk[1],o,lk[2],r)},e.prototype.getTileCoordCenter=function(e){var i=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=rw(this.getTileSize(e[0]),this.tmpSize_);return[i[0]+(e[1]+.5)*n[0]*r,i[1]-(e[2]+.5)*n[1]*r]},e.prototype.getTileCoordExtent=function(e,i){var r=this.getOrigin(e[0]),n=this.getResolution(e[0]),o=rw(this.getTileSize(e[0]),this.tmpSize_),a=r[0]+e[1]*o[0]*n,s=r[1]-(e[2]+1)*o[1]*n,l=a+o[0]*n,h=s+o[1]*n;return tj(a,s,l,h,i)},e.prototype.getTileCoordForCoordAndResolution=function(e,i,r){return this.getTileCoordForXYAndResolution_(e[0],e[1],i,!1,r)},e.prototype.getTileCoordForXYAndResolution_=function(e,i,r,n,o){var a=this.getZForResolution(r),s=r/this.getResolution(a),l=this.getOrigin(a),h=rw(this.getTileSize(a),this.tmpSize_),u=Math.floor((e-l[0])/r+.5*!!n),c=Math.floor((l[1]-i)/r+.5*!!n),d=s*u/h[0],p=s*c/h[1];return n?(d=Math.ceil(d)-1,p=Math.ceil(p)-1):(d=Math.floor(d),p=Math.floor(p)),lR(a,d,p,o)},e.prototype.getTileCoordForXYAndZ_=function(e,i,r,n,o){var a=this.getOrigin(r),s=this.getResolution(r),l=rw(this.getTileSize(r),this.tmpSize_),h=Math.floor((e-a[0])/s+.5*!!n),u=Math.floor((a[1]-i)/s+.5*!!n),c=h/l[0],d=u/l[1];return n?(c=Math.ceil(c)-1,d=Math.ceil(d)-1):(c=Math.floor(c),d=Math.floor(d)),lR(r,c,d,o)},e.prototype.getTileCoordForCoordAndZ=function(e,i,r){return this.getTileCoordForXYAndZ_(e[0],e[1],i,!1,r)},e.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},e.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},e.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:null},e.prototype.getZForResolution=function(e,i){return e7(iI(this.resolutions_,e,i||0),this.minZoom,this.maxZoom)},e.prototype.calculateTileRanges_=function(e){for(var i=this.resolutions_.length,r=Array(i),n=this.minZoom;n<i;++n)r[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=r},e}(),lD=(eC=function(e,i){return(eC=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eC(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lz=function(e){function i(i,r,n){var o=e.call(this)||this,a=n||{};return o.tileCoord=i,o.state=r,o.interimTile=null,o.hifi=!0,o.key="",o.transition_=void 0===a.transition?250:a.transition,o.transitionStarts_={},o}return lD(i,e),i.prototype.changed=function(){this.dispatchEvent(iL.CHANGE)},i.prototype.release=function(){},i.prototype.getKey=function(){return this.key+"/"+this.tileCoord},i.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(e.getState()==sy.LOADED)return this.transition_=0,e;e=e.interimTile}while(e)return this},i.prototype.refreshInterimChain=function(){if(this.interimTile){var e=this.interimTile,i=this;do{if(e.getState()==sy.LOADED){e.interimTile=null;break}e.getState()==sy.LOADING?i=e:e.getState()==sy.IDLE?i.interimTile=e.interimTile:i=e,e=i.interimTile}while(e)}},i.prototype.getTileCoord=function(){return this.tileCoord},i.prototype.getState=function(){return this.state},i.prototype.setState=function(e){if(this.state!==sy.ERROR&&this.state>e)throw Error("Tile load sequence violation");this.state=e,this.changed()},i.prototype.load=function(){tE()},i.prototype.getAlpha=function(e,i){if(!this.transition_)return 1;var r=this.transitionStarts_[e];if(r){if(-1===r)return 1}else r=i,this.transitionStarts_[e]=r;var n=i-r+1e3/60;return n>=this.transition_?1:sR(n/this.transition_)},i.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]},i.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)},i}(ik),lF=(eA=function(e,i){return(eA=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eA(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lB=function(e){function i(i,r,n,o,a,s){var l=e.call(this,i,r,s)||this;return l.crossOrigin_=o,l.src_=n,l.image_=new Image,null!==o&&(l.image_.crossOrigin=o),l.unlisten_=null,l.tileLoadFunction_=a,l}return lF(i,e),i.prototype.getImage=function(){return this.image_},i.prototype.getKey=function(){return this.src_},i.prototype.handleImageError_=function(){var e;this.state=sy.ERROR,this.unlistenImage_(),this.image_=((e=i9(1,1)).fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas),this.changed()},i.prototype.handleImageLoad_=function(){var e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=sy.LOADED:this.state=sy.EMPTY,this.unlistenImage_(),this.changed()},i.prototype.load=function(){this.state==sy.ERROR&&(this.state=sy.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==sy.IDLE&&(this.state=sy.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=op(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},i.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},i}(lz),lN=function(){function e(e,i,r,n,o,a){this.sourceProj_=e,this.targetProj_=i;var s={},l=ip(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){var i=e[0]+"/"+e[1];return s[i]||(s[i]=l(e)),s[i]},this.maxSourceExtent_=n,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&t3(n)==t3(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?t3(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?t3(this.targetProj_.getExtent()):null;var h=t1(r),u=t2(r),c=tY(r),d=tX(r),p=this.transformInv_(h),f=this.transformInv_(u),m=this.transformInv_(c),g=this.transformInv_(d),_=10+(a?Math.max(0,Math.ceil(tt(tW(r)/(a*a*65536)))):0);if(this.addQuad_(h,u,c,d,p,f,m,g,_),this.wrapsXInSource_){var y=1/0;this.triangles_.forEach(function(e,i,r){y=Math.min(y,e.source[0][0],e.source[1][0],e.source[2][0])}),this.triangles_.forEach((function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-y>this.sourceWorldWidth_/2){var i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-y>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-y>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-y>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);var r=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-r<this.sourceWorldWidth_/2&&(e.source=i)}}).bind(this))}s={}}return e.prototype.addTriangle_=function(e,i,r,n,o,a){this.triangles_.push({source:[n,o,a],target:[e,i,r]})},e.prototype.addQuad_=function(e,i,r,n,o,a,s,l,h){var u=tP([o,a,s,l]),c=this.sourceWorldWidth_?t3(u)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&c>.5&&c<1,f=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(f=t3(tP([e,i,r,n]))/this.targetWorldWidth_>.25||f),!p&&this.sourceProj_.isGlobal()&&c&&(f=c>.25||f)),!(!f&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!t5(u,this.maxSourceExtent_))){var m=0;if(!f&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)f=!0;else if(1!=(m=8*!(isFinite(o[0])&&isFinite(o[1]))+4*!(isFinite(a[0])&&isFinite(a[1]))+2*!(isFinite(s[0])&&isFinite(s[1]))+ +!(isFinite(l[0])&&isFinite(l[1])))&&2!=m&&4!=m&&8!=m)return}if(h>0){if(!f){var g=[(e[0]+r[0])/2,(e[1]+r[1])/2],_=this.transformInv_(g),y=void 0;y=p?(tn(o[0],d)+tn(s[0],d))/2-tn(_[0],d):(o[0]+s[0])/2-_[0];var v=(o[1]+s[1])/2-_[1];f=y*y+v*v>this.errorThresholdSquared_}if(f){if(Math.abs(e[0]-r[0])<=Math.abs(e[1]-r[1])){var x=[(i[0]+r[0])/2,(i[1]+r[1])/2],b=this.transformInv_(x),w=[(n[0]+e[0])/2,(n[1]+e[1])/2],T=this.transformInv_(w);this.addQuad_(e,i,x,w,o,a,b,T,h-1),this.addQuad_(w,x,r,n,T,b,s,l,h-1)}else{var S=[(e[0]+i[0])/2,(e[1]+i[1])/2],E=this.transformInv_(S),I=[(r[0]+n[0])/2,(r[1]+n[1])/2],C=this.transformInv_(I);this.addQuad_(e,S,I,n,o,E,C,l,h-1),this.addQuad_(S,i,r,I,E,a,s,C,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(11&m)==0&&this.addTriangle_(e,r,n,o,s,l),(14&m)==0&&this.addTriangle_(e,r,i,o,s,a),m&&((13&m)==0&&this.addTriangle_(i,n,e,a,l,o),(7&m)==0&&this.addTriangle_(i,n,r,a,l,s))}},e.prototype.calculateSourceExtent=function(){var e=tN();return this.triangles_.forEach(function(i,r,n){var o=i.source;t$(e,o[0]),t$(e,o[1]),t$(e,o[2])}),e},e.prototype.getTriangles=function(){return this.triangles_},e}(),lj={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1};function lV(e,i,r,n,o){e.beginPath(),e.moveTo(0,0),e.lineTo(i,r),e.lineTo(n,o),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(i,n)+1,Math.max(r,o)),e.restore()}function lU(e,i){return Math.abs(e[4*i]-210)>2||Math.abs(e[4*i+3]-191.25)>2}function lG(e,i,r,n){var o=im(r,i,e),a=is(i,n,r),s=i.getMetersPerUnit();void 0!==s&&(a*=s);var l=e.getMetersPerUnit();void 0!==l&&(a/=l);var h=e.getExtent();if(!h||tD(h,o)){var u=is(e,a,o)/a;isFinite(u)&&u>0&&(a/=u)}return a}var lq=(eR=function(e,i){return(eR=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eR(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),l$=function(e){function i(i,r,n,o,a,s,l,h,u,c,d,p){var f,m=e.call(this,a,sy.IDLE)||this;m.renderEdges_=void 0!==d&&d,m.contextOptions_=p,m.pixelRatio_=l,m.gutter_=h,m.canvas_=null,m.sourceTileGrid_=r,m.targetTileGrid_=o,m.wrappedTileCoord_=s||a,m.sourceTiles_=[],m.sourcesListenerKeys_=null,m.sourceZ_=0;var g=o.getTileCoordExtent(m.wrappedTileCoord_),_=m.targetTileGrid_.getExtent(),y=m.sourceTileGrid_.getExtent(),v=_?t0(g,_):g;if(0===tW(v))return m.state=sy.EMPTY,m;var x=i.getExtent();x&&(y=y?t0(y,x):x);var b=o.getResolution(m.wrappedTileCoord_[0]),w=((!isFinite(f=lG(i,n,tK(v),b))||f<=0)&&tZ(v,function(e){return isFinite(f=lG(i,n,e,b))&&f>0}),f);if(!isFinite(w)||w<=0||(m.triangulation_=new lN(i,n,v,y,w*(void 0!==c?c:.5),b),0===m.triangulation_.getTriangles().length))return m.state=sy.EMPTY,m;m.sourceZ_=r.getZForResolution(w);var T=m.triangulation_.calculateSourceExtent();if(y&&(i.canWrapX()?(T[1]=e7(T[1],y[1],y[3]),T[3]=e7(T[3],y[1],y[3])):T=t0(T,y)),tW(T)){for(var S=r.getTileRangeForExtentAndZ(T,m.sourceZ_),E=S.minX;E<=S.maxX;E++)for(var I=S.minY;I<=S.maxY;I++){var C=u(m.sourceZ_,E,I,l);C&&m.sourceTiles_.push(C)}0===m.sourceTiles_.length&&(m.state=sy.EMPTY)}else m.state=sy.EMPTY;return m}return lq(i,e),i.prototype.getImage=function(){return this.canvas_},i.prototype.reproject_=function(){var e=[];if(this.sourceTiles_.forEach((function(i,r,n){i&&i.getState()==sy.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(i.tileCoord),image:i.getImage()})}).bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=sy.ERROR;else{var i=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(i),n="number"==typeof r?r:r[0],o="number"==typeof r?r:r[1],a=this.targetTileGrid_.getResolution(i),s=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=function(e,i,r,n,o,a,s,l,h,u,c,d){var p=i9(Math.round(r*e),Math.round(r*i));if(t_(p,d),0===h.length)return p.canvas;function f(e){return Math.round(e*r)/r}p.scale(r,r),p.globalCompositeOperation="lighter";var m=tN();h.forEach(function(e,i,r){tq(m,e.extent)});var g=i9(Math.round(r*t3(m)/n),Math.round(r*tQ(m)/n));t_(g,d);var _=r/n;h.forEach(function(e,i,r){var n=e.extent[0]-m[0],o=-(e.extent[3]-m[3]),a=t3(e.extent),s=tQ(e.extent);e.image.width>0&&e.image.height>0&&g.drawImage(e.image,u,u,e.image.width-2*u,e.image.height-2*u,n*_,o*_,a*_,s*_)});var y=t1(s);return l.getTriangles().forEach(function(e,i,o){var s=e.source,l=e.target,h=s[0][0],u=s[0][1],c=s[1][0],_=s[1][1],v=s[2][0],x=s[2][1],b=f((l[0][0]-y[0])/a),w=f(-(l[0][1]-y[1])/a),T=f((l[1][0]-y[0])/a),S=f(-(l[1][1]-y[1])/a),E=f((l[2][0]-y[0])/a),I=f(-(l[2][1]-y[1])/a),C=h,A=u;h=0,u=0;var R=function(e){for(var i=e.length,r=0;r<i;r++){for(var n=r,o=Math.abs(e[r][r]),a=r+1;a<i;a++){var s=Math.abs(e[a][r]);s>o&&(o=s,n=a)}if(0===o)return null;var l=e[n];e[n]=e[r],e[r]=l;for(var h=r+1;h<i;h++)for(var u=-e[h][r]/e[r][r],c=r;c<i+1;c++)r==c?e[h][c]=0:e[h][c]+=u*e[r][c]}for(var d=Array(i),p=i-1;p>=0;p--){d[p]=e[p][i]/e[p][p];for(var f=p-1;f>=0;f--)e[f][i]-=e[f][p]*d[p]}return d}([[c-=C,_-=A,0,0,T-b],[v-=C,x-=A,0,0,E-b],[0,0,c,_,S-w],[0,0,v,x,I-w]]);if(R){if(p.save(),p.beginPath(),function(){if(void 0===eZ){var e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",lV(e,4,5,4,0),lV(e,4,5,0,5);var i=e.getImageData(0,0,3,3).data;eZ=lU(i,0)||lU(i,4)||lU(i,8)}return eZ}()||d===lj){p.moveTo(T,S);for(var M=b-T,P=w-S,O=0;O<4;O++)p.lineTo(T+f((O+1)*M/4),S+f(O*P/3)),3!=O&&p.lineTo(T+f((O+1)*M/4),S+f((O+1)*P/3));p.lineTo(E,I)}else p.moveTo(T,S),p.lineTo(b,w),p.lineTo(E,I);p.clip(),p.transform(R[0],R[2],R[1],R[3],b,w),p.translate(m[0]-C,m[3]-A),p.scale(n/r,-n/r),p.drawImage(g.canvas,0,0),p.restore()}}),c&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,l.getTriangles().forEach(function(e,i,r){var n=e.target,o=(n[0][0]-y[0])/a,s=-(n[0][1]-y[1])/a,l=(n[1][0]-y[0])/a,h=-(n[1][1]-y[1])/a,u=(n[2][0]-y[0])/a,c=-(n[2][1]-y[1])/a;p.beginPath(),p.moveTo(l,h),p.lineTo(o,s),p.lineTo(u,c),p.closePath(),p.stroke()}),p.restore()),p.canvas}(n,o,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=sy.LOADED}this.changed()},i.prototype.load=function(){if(this.state==sy.IDLE){this.state=sy.LOADING,this.changed();var e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(i,r,n){var o=i.getState();if(o==sy.IDLE||o==sy.LOADING){e++;var a=iD(i,iL.CHANGE,function(r){var n=i.getState();(n==sy.LOADED||n==sy.ERROR||n==sy.EMPTY)&&(iz(a),0==--e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(a)}}).bind(this)),this.sourceTiles_.forEach(function(e,i,r){e.getState()==sy.IDLE&&e.load()}),0===e&&setTimeout(this.reproject_.bind(this),0)}},i.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(iz),this.sourcesListenerKeys_=null},i}(lz),lH=function(){function e(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return e.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},e.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},e.prototype.forEach=function(e){for(var i=this.oldest_;i;)e(i.value_,i.key_,this),i=i.newer},e.prototype.get=function(e,i){var r=this.entries_[e];return tM(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},e.prototype.remove=function(e){var i=this.entries_[e];return tM(void 0!==i,15),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[e],--this.count_,i.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var e,i=Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)i[r++]=e.key_;return i},e.prototype.getValues=function(){var e,i=Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)i[r++]=e.value_;return i},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},e.prototype.replace=function(e,i){this.get(e),this.entries_[e].value_=i},e.prototype.set=function(e,i){tM(!(e in this.entries_),16);var r={key_:e,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_},e.prototype.setSize=function(e){this.highWaterMark=e},e}(),lZ=(eM=function(e,i){return(eM=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eM(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),lW=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return lZ(i,e),i.prototype.expireCache=function(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()},i.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=lO(this.peekFirstKey())[0];this.forEach((function(i){i.tileCoord[0]!==e&&(this.remove(lP(i.tileCoord)),i.release())}).bind(this))}},i}(lH),lX={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function lY(e){var i=e.getDefaultTileGrid();return i||(i=lQ(e),e.setDefaultTileGrid(i)),i}function lK(e){var i=e||{},r=i.extent||ia("EPSG:3857").getExtent();return new lL({extent:r,minZoom:i.minZoom,tileSize:i.tileSize,resolutions:lJ(r,i.maxZoom,i.tileSize,i.maxResolution)})}function lJ(e,i,r,n){for(var o=tQ(e),a=t3(e),s=rw(void 0!==r?r:256),l=n>0?n:Math.max(a/s[0],o/s[1]),h=(void 0!==i?i:42)+1,u=Array(h),c=0;c<h;++c)u[c]=l/Math.pow(2,c);return u}function lQ(e,i,r,n){var o,a,s,l;return o=l0(e),a=void 0!==n?n:tT.TOP_LEFT,s=lJ(o,i,r),new lL({extent:o,origin:(a===tT.BOTTOM_LEFT?l=tX(o):a===tT.BOTTOM_RIGHT?l=tY(o):a===tT.TOP_LEFT?l=t1(o):a===tT.TOP_RIGHT?l=t2(o):tM(!1,13),l),resolutions:s,tileSize:r})}function l0(e){var i=(e=ia(e)).getExtent();if(!i){var r=180*e8[e6.DEGREES]/e.getMetersPerUnit();i=tj(-r,-r,r,r)}return i}var l1=(eP=function(e,i){return(eP=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eP(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),l2=function(e){function i(i){var r=e.call(this,{attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,projection:i.projection,state:i.state,wrapX:i.wrapX})||this;r.opaque_=void 0!==i.opaque&&i.opaque,r.tilePixelRatio_=void 0!==i.tilePixelRatio?i.tilePixelRatio:1,r.tileGrid=void 0!==i.tileGrid?i.tileGrid:null;var n=i.tileGrid;return n&&rw(n.getTileSize(n.getMinZoom()),[256,256]),r.tileCache=new lW(i.cacheSize||0),r.tmpSize=[0,0],r.key_=i.key||"",r.tileOptions={transition:i.transition},r.zDirection=i.zDirection?i.zDirection:0,r}return l1(i,e),i.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},i.prototype.expireCache=function(e,i){var r=this.getTileCacheForProjection(e);r&&r.expireCache(i)},i.prototype.forEachLoadedTile=function(e,i,r,n){var o,a,s,l=this.getTileCacheForProjection(e);if(!l)return!1;for(var h=!0,u=r.minX;u<=r.maxX;++u)for(var c=r.minY;c<=r.maxY;++c)a=lM(i,u,c),s=!1,l.containsKey(a)&&(s=(o=l.get(a)).getState()===sy.LOADED)&&(s=!1!==n(o)),s||(h=!1);return h},i.prototype.getGutterForProjection=function(e){return 0},i.prototype.getKey=function(){return this.key_},i.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},i.prototype.getOpaque=function(e){return this.opaque_},i.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},i.prototype.getTile=function(e,i,r,n,o){return tE()},i.prototype.getTileGrid=function(){return this.tileGrid},i.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:lY(e)},i.prototype.getTileCacheForProjection=function(e){var i=this.getProjection();return i&&!ic(i,e)?null:this.tileCache},i.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},i.prototype.getTilePixelSize=function(e,i,r){var n,o=this.getTileGridForProjection(r),a=this.getTilePixelRatio(i),s=rw(o.getTileSize(e),this.tmpSize);return 1==a?s:(void 0===(n=this.tmpSize)&&(n=[0,0]),n[0]=s[0]*a+.5|0,n[1]=s[1]*a+.5|0,n)},i.prototype.getTileCoordForTileUrlFunction=function(e,i){var r=void 0!==i?i:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(e=function(e,i,r){var n=i[0],o=e.getTileCoordCenter(i),a=l0(r);if(tD(a,o))return i;var s=t3(a),l=Math.ceil((a[0]-o[0])/s);return o[0]+=s*l,e.getTileCoordForCoordAndZ(o,n)}(n,e,r)),!function(e,i){var r,n=e[0],o=e[1],a=e[2];if(i.getMinZoom()>n||n>i.getMaxZoom())return!1;var s=i.getExtent();return!(r=s?i.getTileRangeForExtentAndZ(s,n):i.getFullTileRange(n))||r.containsXY(o,a)}(e,n)?null:e},i.prototype.clear=function(){this.tileCache.clear()},i.prototype.refresh=function(){this.clear(),e.prototype.refresh.call(this)},i.prototype.updateCacheSize=function(e,i){var r=this.getTileCacheForProjection(i);e>r.highWaterMark&&(r.highWaterMark=e)},i.prototype.useTile=function(e,i,r,n){},i}(oz),l3=function(e){function i(i,r){var n=e.call(this,i)||this;return n.tile=r,n}return l1(i,e),i}(iw);function l5(e,i){for(var r,n=e.length,o=Array(n),a=0;a<n;++a)o[a]=function(e,i){var r=/\{z\}/g,n=/\{x\}/g,o=/\{y\}/g,a=/\{-y\}/g;return function(s,l,h){if(s)return e.replace(r,s[0].toString()).replace(n,s[1].toString()).replace(o,s[2].toString()).replace(a,function(){var e=s[0],r=i.getFullTileRange(e);return tM(r,55),(r.getHeight()-s[2]-1).toString()})}}(e[a],i);return 1===(r=o).length?r[0]:function(e,i,n){if(e){var o=tn((e[1]<<e[0])+e[2],r.length);return r[o](e,i,n)}}}var l4=(eO=function(e,i){return(eO=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eO(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),l6=function(e){function i(r){var n=e.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,opaque:r.opaque,projection:r.projection,state:r.state,tileGrid:r.tileGrid,tilePixelRatio:r.tilePixelRatio,wrapX:r.wrapX,transition:r.transition,key:r.key,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===i.prototype.tileUrlFunction,n.tileLoadFunction=r.tileLoadFunction,r.tileUrlFunction&&(n.tileUrlFunction=r.tileUrlFunction.bind(n)),n.urls=null,r.urls?n.setUrls(r.urls):r.url&&n.setUrl(r.url),n.tileLoadingKeys_={},n}return l4(i,e),i.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},i.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},i.prototype.getUrls=function(){return this.urls},i.prototype.handleTileChange=function(e){var i,r=e.target,n=tC(r),o=r.getState();o==sy.LOADING?(this.tileLoadingKeys_[n]=!0,i=lX.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],i=o==sy.ERROR?lX.TILELOADERROR:o==sy.LOADED?lX.TILELOADEND:void 0),void 0!=i&&this.dispatchEvent(new l3(i,r))},i.prototype.setTileLoadFunction=function(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()},i.prototype.setTileUrlFunction=function(e,i){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),void 0!==i?this.setKey(i):this.changed()},i.prototype.setUrl=function(e){var i=function(e){var i=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),o=r[2].charCodeAt(0),a=void 0;for(a=n;a<=o;++a)i.push(e.replace(r[0],String.fromCharCode(a)));return i}if(r=/\{(\d+)-(\d+)\}/.exec(e)){for(var s=parseInt(r[2],10),l=parseInt(r[1],10);l<=s;l++)i.push(e.replace(r[0],l.toString()));return i}return i.push(e),i}(e);this.urls=i,this.setUrls(i)},i.prototype.setUrls=function(e){this.urls=e;var i=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(l5(e,this.tileGrid),i):this.setKey(i)},i.prototype.tileUrlFunction=function(e,i,r){},i.prototype.useTile=function(e,i,r){var n=lM(e,i,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},i}(l2),l8=(ek=function(e,i){return(ek=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ek(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),l9=function(e){function i(i){var r=e.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,opaque:i.opaque,projection:i.projection,state:i.state,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction?i.tileLoadFunction:l7,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:i.wrapX,transition:i.transition,key:i.key,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})||this;return r.crossOrigin=void 0!==i.crossOrigin?i.crossOrigin:null,r.tileClass=void 0!==i.tileClass?i.tileClass:lB,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=i.reprojectionErrorThreshold,r.contextOptions_=!1===i.imageSmoothing?lj:void 0,r.renderReprojectionEdges_=!1,r}return l8(i,e),i.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1},i.prototype.expireCache=function(e,i){var r=this.getTileCacheForProjection(e);for(var n in this.tileCache.expireCache(this.tileCache==r?i:{}),this.tileCacheForProjection){var o=this.tileCacheForProjection[n];o.expireCache(o==r?i:{})}},i.prototype.getContextOptions=function(){return this.contextOptions_},i.prototype.getGutterForProjection=function(e){return this.getProjection()&&e&&!ic(this.getProjection(),e)?0:this.getGutter()},i.prototype.getGutter=function(){return 0},i.prototype.getKey=function(){return e.prototype.getKey.call(this)+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")},i.prototype.getOpaque=function(i){return(!this.getProjection()||!i||!!ic(this.getProjection(),i))&&e.prototype.getOpaque.call(this,i)},i.prototype.getTileGridForProjection=function(e){var i=this.getProjection();if(this.tileGrid&&(!i||ic(i,e)))return this.tileGrid;var r=tC(e);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=lY(e)),this.tileGridForProjection[r]},i.prototype.getTileCacheForProjection=function(e){var i=this.getProjection();if(!i||ic(i,e))return this.tileCache;var r=tC(e);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new lW(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},i.prototype.createTile_=function(e,i,r,n,o,a){var s=[e,i,r],l=this.getTileCoordForTileUrlFunction(s,o),h=l?this.tileUrlFunction(l,n,o):void 0,u=new this.tileClass(s,void 0!==h?sy.IDLE:sy.EMPTY,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=a,u.addEventListener(iL.CHANGE,this.handleTileChange.bind(this)),u},i.prototype.getTile=function(e,i,r,n,o){var a=this.getProjection();if(!a||!o||ic(a,o))return this.getTileInternal(e,i,r,n,a||o);var s=this.getTileCacheForProjection(o),l=[e,i,r],h=void 0,u=lP(l);s.containsKey(u)&&(h=s.get(u));var c=this.getKey();if(h&&h.key==c)return h;var d=this.getTileGridForProjection(a),p=this.getTileGridForProjection(o),f=this.getTileCoordForTileUrlFunction(l,o),m=new l$(a,d,o,p,l,f,this.getTilePixelRatio(n),this.getGutter(),(function(e,i,r,n){return this.getTileInternal(e,i,r,n,a)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return m.key=c,h?(m.interimTile=h,m.refreshInterimChain(),s.replace(u,m)):s.set(u,m),m},i.prototype.getTileInternal=function(e,i,r,n,o){var a=null,s=lM(e,i,r),l=this.getKey();if(this.tileCache.containsKey(s)){if((a=this.tileCache.get(s)).key!=l){var h=a;a=this.createTile_(e,i,r,n,o,l),h.getState()==sy.IDLE?a.interimTile=h.interimTile:a.interimTile=h,a.refreshInterimChain(),this.tileCache.replace(s,a)}}else a=this.createTile_(e,i,r,n,o,l),this.tileCache.set(s,a);return a},i.prototype.setRenderReprojectionEdges=function(e){if(this.renderReprojectionEdges_!=e){for(var i in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[i].clear();this.changed()}},i.prototype.setTileGridForProjection=function(e,i){var r=ia(e);if(r){var n=tC(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=i)}},i}(l6);function l7(e,i){e.getImage().src=i}var he=(eL=function(e,i){return(eL=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eL(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ht=function(e){function i(i){var r=e.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,projection:ia("EPSG:3857"),reprojectionErrorThreshold:i.reprojectionErrorThreshold,state:r_.LOADING,tileLoadFunction:i.tileLoadFunction,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition})||this;if(r.tileJSON_=null,r.tileSize_=i.tileSize,i.url)if(i.jsonp)!function(e,i,r,n){var o=document.createElement("script"),a="olc_"+tC(i);function s(){delete window[a],o.parentNode.removeChild(o)}o.async=!0,o.src=e+(-1==e.indexOf("?")?"?":"&")+"callback="+a;var l=setTimeout(function(){s(),r&&r()},1e4);window[a]=function(e){clearTimeout(l),s(),i(e)},document.getElementsByTagName("head")[0].appendChild(o)}(i.url,r.handleTileJSONResponse.bind(r),r.handleTileJSONError.bind(r));else{var n=new XMLHttpRequest;n.addEventListener("load",r.onXHRLoad_.bind(r)),n.addEventListener("error",r.onXHRError_.bind(r)),n.open("GET",i.url),n.send()}else i.tileJSON?r.handleTileJSONResponse(i.tileJSON):tM(!1,51);return r}return he(i,e),i.prototype.onXHRLoad_=function(e){var i=e.target;if(!i.status||i.status>=200&&i.status<300){var r=void 0;try{r=JSON.parse(i.responseText)}catch(e){this.handleTileJSONError();return}this.handleTileJSONResponse(r)}else this.handleTileJSONError()},i.prototype.onXHRError_=function(e){this.handleTileJSONError()},i.prototype.getTileJSON=function(){return this.tileJSON_},i.prototype.handleTileJSONResponse=function(e){var i,r=ia("EPSG:4326"),n=this.getProjection();if(void 0!==e.bounds){var o=id(r,n);i=t6(e.bounds,o)}var a=e.minzoom||0,s=e.maxzoom||22,l=lK({extent:l0(n),maxZoom:s,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=l5(e.tiles,l),void 0!==e.attribution&&!this.getAttributions()){var h=void 0!==i?i:r.getExtent();this.setAttributions(function(i){return t5(h,i.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState(r_.READY)},i.prototype.handleTileJSONError=function(){this.setState(r_.ERROR)},i}(l9),hi="preload",hr="useInterimTilesOnError",hn=(eD=function(e,i){return(eD=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eD(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),ho=function(e){function i(i){var r=this,n=i||{},o=t_({},n);return delete o.preload,delete o.useInterimTilesOnError,(r=e.call(this,o)||this).setPreload(void 0!==n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r}return hn(i,e),i.prototype.getPreload=function(){return this.get(hi)},i.prototype.setPreload=function(e){this.set(hi,e)},i.prototype.getUseInterimTilesOnError=function(){return this.get(hr)},i.prototype.setUseInterimTilesOnError=function(e){this.set(hr,e)},i}(rv),ha=(ez=function(e,i){return(ez=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ez(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hs=function(e){function i(i){var r=e.call(this,i)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=tN(),r.tmpTileRange_=new lC(0,0,0,0),r}return ha(i,e),i.prototype.isDrawableTile=function(e){var i=this.getLayer(),r=e.getState(),n=i.getUseInterimTilesOnError();return r==sy.LOADED||r==sy.EMPTY||r==sy.ERROR&&!n},i.prototype.getTile=function(e,i,r,n){var o=n.pixelRatio,a=n.viewState.projection,s=this.getLayer(),l=s.getSource().getTile(e,i,r,o,a);return l.getState()==sy.ERROR&&(s.getUseInterimTilesOnError()?s.getPreload()>0&&(this.newTiles_=!0):l.setState(sy.LOADED)),this.isDrawableTile(l)||(l=l.getInterimTile()),l},i.prototype.loadedTileCallback=function(i,r,n){return!!this.isDrawableTile(n)&&e.prototype.loadedTileCallback.call(this,i,r,n)},i.prototype.prepareFrame=function(e){return!!this.getLayer().getSource()},i.prototype.renderFrame=function(e,i){var r,n,o,a,s=e.layerStatesArray[e.layerIndex],l=e.viewState,h=l.projection,u=l.resolution,c=l.center,d=l.rotation,p=e.pixelRatio,f=this.getLayer(),m=f.getSource(),g=m.getRevision(),_=m.getTileGridForProjection(h),y=_.getZForResolution(u,m.zDirection),v=_.getResolution(y),x=e.extent,b=s.extent&&ib(s.extent,h);b&&(x=t0(x,ib(s.extent,h)));var w=m.getTilePixelRatio(p),T=Math.round(e.size[0]*w),S=Math.round(e.size[1]*w);if(d){var E=Math.round(Math.sqrt(T*T+S*S));T=E,S=E}var I=v*T/2/w,C=v*S/2/w,A=[c[0]-I,c[1]-C,c[0]+I,c[1]+C],R=_.getTileRangeForExtentAndZ(x,y),M={};M[y]={};var P=this.createLoadedTileFinder(m,h,M),O=this.tmpExtent,k=this.tmpTileRange_;this.newTiles_=!1;for(var L=R.minX;L<=R.maxX;++L)for(var D=R.minY;D<=R.maxY;++D){var z=this.getTile(y,L,D,e);if(this.isDrawableTile(z)){var F=tC(this);if(z.getState()==sy.LOADED){M[y][z.tileCoord.toString()]=z;var B=z.inTransition(F);!this.newTiles_&&(B||-1===this.renderedTiles.indexOf(z))&&(this.newTiles_=!0)}if(1===z.getAlpha(F,e.time))continue}var N=_.getTileCoordChildTileRange(z.tileCoord,k,O),j=!1;N&&(j=P(y+1,N)),j||_.forEachTileCoordParentTileRange(z.tileCoord,P,k,O)}var V=v/u;rB(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/w,1/w,d,-T/2,-S/2);var U=(r=this.pixelTransform,i4?rj(r):(r8||(r8=i9(1,1).canvas),r8.style.transform=rj(r),r8.style.transform));this.useContainer(i,U,s.opacity);var G=this.context,q=G.canvas;rN(this.inversePixelTransform,this.pixelTransform),rB(this.tempTransform,T/2,S/2,V,V,0,-T/2,-S/2),q.width!=T||q.height!=S?(q.width=T,q.height=S):this.containerReused||G.clearRect(0,0,T,S),b&&this.clipUnrotated(G,e,b),t_(G,m.getContextOptions()),this.preRender(G,e),this.renderedTiles.length=0;var $=Object.keys(M).map(Number);$.sort(iE),1===s.opacity&&(!this.containerReused||m.getOpaque(e.viewState.projection))?$=$.reverse():(n=[],o=[]);for(var H=$.length-1;H>=0;--H){var Z=$[H],W=m.getTilePixelSize(Z,p,h),X=_.getResolution(Z)/v,Y=W[0]*X*V,K=W[1]*X*V,J=_.getTileCoordForCoordAndZ(t1(A),Z),Q=_.getTileCoordExtent(J),ee=rz(this.tempTransform,[w*(Q[0]-A[0])/v,w*(A[3]-Q[3])/v]),et=w*m.getGutterForProjection(h),ei=M[Z];for(var er in ei){var z=ei[er],en=z.tileCoord,eo=ee[0]-(J[1]-en[1])*Y,ea=Math.round(eo+Y),es=ee[1]-(J[2]-en[2])*K,el=Math.round(es+K),L=Math.round(eo),D=Math.round(es),eh=ea-L,eu=el-D,ec=y===Z,B=ec&&1!==z.getAlpha(tC(this),e.time);if(!B)if(n){G.save(),a=[L,D,L+eh,D,L+eh,D+eu,L,D+eu];for(var ed=0,ep=n.length;ed<ep;++ed)if(y!==Z&&Z<o[ed]){var ef=n[ed];G.beginPath(),G.moveTo(a[0],a[1]),G.lineTo(a[2],a[3]),G.lineTo(a[4],a[5]),G.lineTo(a[6],a[7]),G.moveTo(ef[6],ef[7]),G.lineTo(ef[4],ef[5]),G.lineTo(ef[2],ef[3]),G.lineTo(ef[0],ef[1]),G.clip()}n.push(a),o.push(Z)}else G.clearRect(L,D,eh,eu);this.drawTileImage(z,e,L,D,eh,eu,et,ec,s.opacity),n&&!B&&G.restore(),this.renderedTiles.push(z),this.updateUsedTiles(e.usedTiles,m,z)}}return this.renderedRevision=g,this.renderedResolution=v,this.extentChanged=!this.renderedExtent_||!tG(this.renderedExtent_,A),this.renderedExtent_=A,this.renderedPixelRatio=p,this.renderedProjection=h,this.manageTilePyramid(e,m,_,p,h,x,y,f.getPreload()),this.scheduleExpireCache(e,m),this.postRender(G,e),s.extent&&G.restore(),U!==q.style.transform&&(q.style.transform=U),this.container},i.prototype.drawTileImage=function(e,i,r,n,o,a,s,l,h){var u=this.getTileImage(e);if(u){var c=tC(this),d=l?e.getAlpha(c,i.time):1,p=h*d,f=p!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(u,s,s,u.width-2*s,u.height-2*s,r,n,o,a),f&&this.context.restore(),1!==d?i.animate=!0:l&&e.endTransition(c)}},i.prototype.getImage=function(){var e=this.context;return e?e.canvas:null},i.prototype.getTileImage=function(e){return e.getImage()},i.prototype.scheduleExpireCache=function(e,i){if(i.canExpireCache()){var r=(function(e,i,r){var n=tC(e);n in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[n])}).bind(null,i);e.postRenderFunctions.push(r)}},i.prototype.updateUsedTiles=function(e,i,r){var n=tC(i);n in e||(e[n]={}),e[n][r.getKey()]=!0},i.prototype.manageTilePyramid=function(e,i,r,n,o,a,s,l,h){var u,c,d,p,f,m,g=tC(i);g in e.wantedTiles||(e.wantedTiles[g]={});var _=e.wantedTiles[g],y=e.tileQueue,v=r.getMinZoom(),x=0;for(m=v;m<=s;++m)for(c=r.getTileRangeForExtentAndZ(a,m,c),d=r.getResolution(m),p=c.minX;p<=c.maxX;++p)for(f=c.minY;f<=c.maxY;++f)s-m<=l?(++x,(u=i.getTile(m,p,f,n,o)).getState()==sy.IDLE&&(_[u.getKey()]=!0,y.isKeyQueued(u.getKey())||y.enqueue([u,g,r.getTileCoordCenter(u.tileCoord),d])),void 0!==h&&h(u)):i.useTile(m,p,f,o);i.updateCacheSize(x,o)},i}(nU);hs.prototype.getLayer;var hl=(eF=function(e,i){return(eF=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eF(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hh=function(e){function i(i){return e.call(this,i)||this}return hl(i,e),i.prototype.createRenderer=function(){return new hs(this)},i}(ho),hu={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},hc=(eB=function(e,i){return(eB=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eB(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hd={image:[nG.POLYGON,nG.CIRCLE,nG.LINE_STRING,nG.IMAGE,nG.TEXT],hybrid:[nG.POLYGON,nG.LINE_STRING],vector:[]},hp={image:[nG.DEFAULT],hybrid:[nG.IMAGE,nG.TEXT,nG.DEFAULT],vector:[nG.POLYGON,nG.CIRCLE,nG.LINE_STRING,nG.IMAGE,nG.TEXT,nG.DEFAULT]},hf=function(e){function i(i){var r=e.call(this,i)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.dirty_=!1,r.renderedLayerRevision_,r.renderedPixelToCoordinateTransform_=null,r.renderedRotation_,r.renderTileImageQueue_={},r.tileListenerKeys_={},r.tmpTransform_=rO(),r}return hc(i,e),i.prototype.prepareTile=function(e,i,r,n){var o,a=tC(e),s=e.getState();return(s===sy.LOADED&&e.hifi||s===sy.ERROR)&&a in this.tileListenerKeys_&&(iz(this.tileListenerKeys_[a]),delete this.tileListenerKeys_[a]),(s===sy.LOADED||s===sy.ERROR)&&(this.updateExecutorGroup_(e,i,r),this.tileImageNeedsRender_(e,i,r)&&(o=!0,n&&(this.renderTileImageQueue_[a]=e))),o},i.prototype.getTile=function(i,r,n,o){var a=o.pixelRatio,s=o.viewState,l=s.resolution,h=s.projection,u=this.getLayer(),c=u.getSource().getTile(i,r,n,a,h);if(c.getState()<sy.LOADED){c.wantedResolution=l;var d=tC(c);if(!(d in this.tileListenerKeys_)){var p=iD(c,iL.CHANGE,this.prepareTile.bind(this,c,a,h,!0));this.tileListenerKeys_[d]=p}}else{var f=o.viewHints;(f[n6.ANIMATING]||f[n6.INTERACTING])&&c.wantedResolution||(c.wantedResolution=l),this.prepareTile(c,a,h,!1)&&u.getRenderMode()!==hu.VECTOR&&this.renderTileImage_(c,o)}return e.prototype.getTile.call(this,i,r,n,o)},i.prototype.isDrawableTile=function(i){var r=this.getLayer();return e.prototype.isDrawableTile.call(this,i)&&(r.getRenderMode()===hu.VECTOR?tC(r)in i.executorGroups:i.hasContext(r))},i.prototype.getTileImage=function(e){return e.getImage(this.getLayer())},i.prototype.prepareFrame=function(i){var r=this.getLayer().getRevision();return this.renderedLayerRevision_!=r&&(this.renderedTiles.length=0),this.renderedLayerRevision_=r,e.prototype.prepareFrame.call(this,i)},i.prototype.updateExecutorGroup_=function(e,i,r){var n=this.getLayer(),o=n.getRevision(),a=n.getRenderOrder()||null,s=e.wantedResolution,l=e.getReplayState(n);if(l.dirty||l.renderedResolution!==s||l.renderedRevision!=o||l.renderedRenderOrder!=a||l.renderedZ!==e.sourceZ){var h=n.getSource(),u=h.getTileGrid(),c=h.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),d=h.getSourceTiles(i,r,e),p=tC(n);delete e.hitDetectionImageData[p],e.executorGroups[p]=[];for(var f=this,m=0,g=d.length;m<g;++m)!function(r,o){var m=d[r];if(m.getState()==sy.LOADED){var g=m.tileCoord,_=u.getTileCoordExtent(g),y=t0(c,_),v=tG(_,y)?null:tO(y,n.getRenderBuffer()*s,f.tmpExtent);l.dirty=!1;var x=new nz(0,y,s,i,n.getDeclutter()),b=oT(s,i),w=function(e){var i,r=e.getStyleFunction()||n.getStyleFunction();if(r&&(i=r(e,s)),i){var o=this.renderFeature(e,b,i,x);this.dirty_=this.dirty_||o,l.dirty=l.dirty||o}},T=m.getFeatures();a&&a!==l.renderedRenderOrder&&T.sort(a);for(var S=0,E=T.length;S<E;++S){var I=T[S];(!v||t5(v,I.getGeometry().getExtent()))&&w.call(f,I)}var C=x.finish(),A=new n2(n.getRenderMode()!==hu.VECTOR&&n.getDeclutter()&&1===d.length?null:y,s,i,h.getOverlaps(),C,n.getRenderBuffer());e.executorGroups[p].push(A)}}(m,0);l.renderedRevision=o,l.renderedZ=e.sourceZ,l.renderedRenderOrder=a,l.renderedResolution=s}},i.prototype.forEachFeatureAtCoordinate=function(e,i,r,n,o){var a,s,l,h=i.viewState.resolution,u=i.viewState.rotation;r=void 0==r?0:r;var c=this.getLayer(),d=c.getDeclutter(),p=c.getSource().getTileGridForProjection(i.viewState.projection),f={},m=this.renderedTiles;for(s=0,l=m.length;s<l;++s)!function(){var i=m[s],l=tD(p.getTileCoordExtent(i.wrappedTileCoord),e);if(d||l)for(var g=i.executorGroups[tC(c)],_=0,y=g.length;_<y;++_){var v=g[_];a=a||v.forEachFeatureAtCoordinate(e,h,u,r,function(e){if(l||o&&-1!==o.indexOf(e)){var i=e.getId();if(void 0===i&&(i=tC(e)),!(i in f))return f[i]=!0,n(e,c)}},c.getDeclutter()?o:null)}}();return a},i.prototype.getFeatures=function(e){return new Promise((function(i,r){for(var n,o=this.getLayer(),a=tC(o),s=o.getSource(),l=this.renderedProjection,h=l.getExtent(),u=this.renderedResolution,c=s.getTileGridForProjection(l),d=rz(this.renderedPixelToCoordinateTransform_,e.slice()),p=c.getTileCoordForCoordAndResolution(d,u),f=0,m=this.renderedTiles.length;f<m;++f)if(p.toString()===this.renderedTiles[f].tileCoord.toString()){if((n=this.renderedTiles[f]).getState()===sy.LOADED&&n.hifi){var g=c.getTileCoordExtent(n.tileCoord);s.getWrapX()&&l.canWrapX()&&!tz(h,g)&&it(d,l);break}n=void 0}if(!n||n.loadingSourceTiles>0)return void i([]);var _=t1(c.getTileCoordExtent(n.wrappedTileCoord)),y=[(d[0]-_[0])/u,(_[1]-d[1])/u],v=n.getSourceTiles().reduce(function(e,i){return e.concat(i.getFeatures())},[]),x=n.hitDetectionImageData[a];if(!x&&!this.animatingOrInteracting_){var b=rw(c.getTileSize(c.getZForResolution(u))),w=[b[0]/2,b[1]/2],T=this.renderedRotation_;x=ov(b,[this.getRenderTransform(c.getTileCoordCenter(n.wrappedTileCoord),u,0,.5,w[0],w[1],0)],v,o.getStyleFunction(),c.getTileCoordExtent(n.wrappedTileCoord),n.getReplayState(o).renderedResolution,T),n.hitDetectionImageData[a]=x}i(ox(y,v,x))}).bind(this))},i.prototype.handleFontsChanged=function(){ty(this.renderTileImageQueue_);var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},i.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},i.prototype.renderFrame=function(i,r){var n=i.viewHints,o=!(n[n6.ANIMATING]||n[n6.INTERACTING]);this.renderQueuedTileImages_(o,i),e.prototype.renderFrame.call(this,i,r),this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice(),this.renderedRotation_=i.viewState.rotation;var a=this.getLayer(),s=a.getRenderMode();if(s===hu.IMAGE)return this.container;var l=a.getSource(),h=i.usedTiles[tC(l)];for(var u in this.renderTileImageQueue_)h&&u in h||delete this.renderTileImageQueue_[u];for(var c=this.context,d=a.getDeclutter()?{}:null,p=hp[s],f=i.pixelRatio,m=i.viewState,g=m.center,_=m.resolution,y=m.rotation,v=i.size,x=Math.round(v[0]*f),b=Math.round(v[1]*f),w=this.renderedTiles,T=l.getTileGridForProjection(i.viewState.projection),S=[],E=[],I=w.length-1;I>=0;--I)for(var C=w[I],A=C.tileCoord,R=T.getTileCoordExtent(C.wrappedTileCoord),M=T.getTileCoordExtent(A,this.tmpExtent)[0]-R[0],P=rL(rF(this.inversePixelTransform.slice(),1/f,1/f),this.getRenderTransform(g,_,y,f,x,b,M)),O=C.executorGroups[tC(a)],k=!1,L=0,D=O.length;L<D;++L){var z=O[L];if(z.hasExecutors(p)){var F=C.tileCoord[0],B=void 0;if(!d&&!k){B=z.getClipCoords(P),c.save();for(var N=0,j=S.length;N<j;++N){var V=S[N];F<E[N]&&(c.beginPath(),c.moveTo(B[0],B[1]),c.lineTo(B[2],B[3]),c.lineTo(B[4],B[5]),c.lineTo(B[6],B[7]),c.moveTo(V[6],V[7]),c.lineTo(V[4],V[5]),c.lineTo(V[2],V[3]),c.lineTo(V[0],V[1]),c.clip())}}z.execute(c,1,P,y,o,p,d),d||k||(c.restore(),S.push(B),E.push(F),k=!0)}}return d&&n4(d,c,y,i.layerStatesArray[i.layerIndex].opacity,o,i.declutterItems),this.container},i.prototype.renderQueuedTileImages_=function(e,i){for(var r in this.renderTileImageQueue_){if(!e&&Date.now()-i.time>8){i.animate=!0;break}var n=this.renderTileImageQueue_[r];delete this.renderTileImageQueue_[r],this.renderTileImage_(n,i)}},i.prototype.renderFeature=function(e,i,r,n){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var a=0,s=r.length;a<s;++a)o=oS(n,e,r[a],i,this.boundHandleStyleImageChange_)||o;else o=oS(n,e,r,i,this.boundHandleStyleImageChange_);return o},i.prototype.tileImageNeedsRender_=function(e,i,r){var n=this.getLayer(),o=e.getReplayState(n),a=n.getRevision(),s=e.sourceZ,l=e.wantedResolution;return o.renderedTileResolution!==l||o.renderedTileRevision!==a||o.renderedTileZ!==s},i.prototype.renderTileImage_=function(e,i){var r=this.getLayer(),n=e.getReplayState(r),o=r.getRevision(),a=e.executorGroups[tC(r)];n.renderedTileRevision=o,n.renderedTileZ=e.sourceZ;var s=e.wrappedTileCoord,l=s[0],h=r.getSource(),u=i.pixelRatio,c=i.viewState.projection,d=h.getTileGridForProjection(c),p=d.getResolution(e.tileCoord[0]),f=i.pixelRatio/e.wantedResolution*p,m=d.getResolution(l),g=e.getContext(r);u=Math.max(u,f/u);var _=h.getTilePixelSize(l,u,c);g.canvas.width=_[0],g.canvas.height=_[1];var y=u/f;if(1!==y){var v=rk(this.tmpTransform_);rF(v,y,y),g.setTransform.apply(g,v)}var x=d.getTileCoordExtent(s,this.tmpExtent),b=f/m,w=rk(this.tmpTransform_);rF(w,b,-b),rL(w,rD(rP,1,0,0,1,-x[0],-x[3]));for(var T=0,S=a.length;T<S;++T)a[T].execute(g,y,w,0,!0,hd[r.getRenderMode()]);n.renderedTileResolution=e.wantedResolution},i}(hs),hm=(eN=function(e,i){return(eN=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eN(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hg=function(e){function i(i){var r=this,n=i||{},o=t_({},n);delete o.preload,delete o.useInterimTilesOnError,r=e.call(this,o)||this;var a=n.renderMode||hu.HYBRID;return tM(void 0==a||a==hu.IMAGE||a==hu.HYBRID||a==hu.VECTOR,28),r.renderMode_=a,r.setPreload(n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r}return hm(i,e),i.prototype.createRenderer=function(){return new hf(this)},i.prototype.getFeatures=function(i){return e.prototype.getFeatures.call(this,i)},i.prototype.getRenderMode=function(){return this.renderMode_},i.prototype.getPreload=function(){return this.get(hi)},i.prototype.getUseInterimTilesOnError=function(){return this.get(hr)},i.prototype.setPreload=function(e){this.set(hi,e)},i.prototype.setUseInterimTilesOnError=function(e){this.set(hr,e)},i}(nu),h_=(ej=function(e,i){return(ej=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}ej(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hy=function(e){function i(i,r,n,o,a,s){var l=e.call(this,i,r,s)||this;return l.extent=null,l.format_=o,l.features_=null,l.loader_,l.projection=null,l.resolution,l.tileLoadFunction_=a,l.url_=n,l}return h_(i,e),i.prototype.getFormat=function(){return this.format_},i.prototype.getFeatures=function(){return this.features_},i.prototype.getKey=function(){return this.url_},i.prototype.load=function(){this.state==sy.IDLE&&(this.setState(sy.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},i.prototype.onLoad=function(e,i){this.setFeatures(e)},i.prototype.onError=function(){this.setState(sy.ERROR)},i.prototype.setFeatures=function(e){this.features_=e,this.setState(sy.LOADED)},i.prototype.setLoader=function(e){this.loader_=e},i}(lz),hv=(eV=function(e,i){return(eV=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eV(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hx=[],hb=function(e){function i(i,r,n,o){var a=e.call(this,i,r,{transition:0})||this;return a.context_={},a.executorGroups={},a.loadingSourceTiles=0,a.errorSourceTileKeys={},a.hitDetectionImageData={},a.replayState_={},a.sourceTiles=null,a.wantedResolution,a.getSourceTiles=o.bind(void 0,a),a.sourceZ=-1,a.hifi=!1,a.wrappedTileCoord=n,a}return hv(i,e),i.prototype.getContext=function(e){var i=tC(e);return i in this.context_||(this.context_[i]=i9(1,1,hx)),this.context_[i]},i.prototype.hasContext=function(e){return tC(e)in this.context_},i.prototype.getImage=function(e){return this.hasContext(e)?this.getContext(e).canvas:null},i.prototype.getReplayState=function(e){var i=tC(e);return i in this.replayState_||(this.replayState_[i]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedZ:-1,renderedTileZ:-1}),this.replayState_[i]},i.prototype.load=function(){this.getSourceTiles()},i.prototype.release=function(){for(var i in this.context_)hx.push(this.context_[i].canvas);e.prototype.release.call(this)},i}(lz),hw=(eU=function(e,i){return(eU=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])})(e,i)},function(e,i){function r(){this.constructor=e}eU(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}),hT=function(e){function i(i){var r=this,n=i.projection||"EPSG:3857",o=i.extent||l0(n),a=i.tileGrid||lK({extent:o,maxResolution:i.maxResolution,maxZoom:void 0!==i.maxZoom?i.maxZoom:22,minZoom:i.minZoom,tileSize:i.tileSize||512});return(r=e.call(this,{attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,opaque:!1,projection:n,state:i.state,tileGrid:a,tileLoadFunction:i.tileLoadFunction?i.tileLoadFunction:hS,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,zDirection:void 0===i.zDirection?1:i.zDirection})||this).format_=i.format?i.format:null,r.loadingTiles_={},r.sourceTileCache=new lW(r.tileCache.highWaterMark),r.overlaps_=void 0==i.overlaps||i.overlaps,r.tileClass=i.tileClass?i.tileClass:hy,r.tileGrids_={},r}return hw(i,e),i.prototype.getFeaturesInExtent=function(e){var i=[],r=this.tileCache;if(0===r.getCount())return i;var n=lO(r.peekFirstKey())[0],o=this.tileGrid;return r.forEach(function(r){if(r.tileCoord[0]===n&&r.getState()===sy.LOADED)for(var a=r.getSourceTiles(),s=0,l=a.length;s<l;++s){var h=a[s],u=h.tileCoord;if(t5(e,o.getTileCoordExtent(u))){var c=h.getFeatures();if(c)for(var d=0,p=c.length;d<p;++d){var f=c[d];t5(e,f.getGeometry().getExtent())&&i.push(f)}}}}),i},i.prototype.getOverlaps=function(){return this.overlaps_},i.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},i.prototype.expireCache=function(i,r){e.prototype.expireCache.call(this,i,r),this.sourceTileCache.expireCache({})},i.prototype.getSourceTiles=function(e,i,r){var n,o,a,s=r.wrappedTileCoord,l=this.getTileGridForProjection(i),h=l.getTileCoordExtent(s),u=s[0],c=l.getResolution(u);tO(h,-c,h);var d=this.tileGrid,p=d.getExtent();p&&t0(h,p,h);var f=d.getZForResolution(c,1),m=d.getMinZoom(),g=r.sourceTiles;if(g&&g.length>0&&g[0].tileCoord[0]===f)n=g,o=!0,a=f;else{n=[],a=f+1;do--a,o=!0,d.forEachTileCoord(h,a,(function(s){var l,h=this.tileUrlFunction(s,e,i);if(void 0!==h)if(this.sourceTileCache.containsKey(h)){var u=(l=this.sourceTileCache.get(h)).getState();if(u===sy.LOADED||u===sy.ERROR||u===sy.EMPTY)return void n.push(l)}else a===f&&((l=new this.tileClass(s,sy.IDLE,h,this.format_,this.tileLoadFunction)).extent=d.getTileCoordExtent(s),l.projection=i,l.resolution=d.getResolution(s[0]),this.sourceTileCache.set(h,l),l.addEventListener(iL.CHANGE,this.handleTileChange.bind(this)),l.load());o=o&&l&&l.getState()===sy.LOADED,l&&l.getState()!==sy.EMPTY&&r.getState()===sy.IDLE&&(r.loadingSourceTiles++,l.addEventListener(iL.CHANGE,function e(){var i=l.getState(),n=l.getKey();if(i===sy.LOADED||i===sy.ERROR){i===sy.LOADED?(l.removeEventListener(iL.CHANGE,e),r.loadingSourceTiles--,delete r.errorSourceTileKeys[n]):i===sy.ERROR&&(r.errorSourceTileKeys[n]=!0);var o=Object.keys(r.errorSourceTileKeys).length;r.loadingSourceTiles-o==0&&(r.hifi=0===o,r.sourceZ=f,r.setState(sy.LOADED))}}))}).bind(this)),o||(n.length=0);while(!o&&a>m)}return r.getState()===sy.IDLE&&r.setState(sy.LOADING),o&&(r.hifi=f===a,r.sourceZ=a,r.getState()<sy.LOADED?r.setState(sy.LOADED):g&&iA(n,g)||(r.sourceTiles=n)),n},i.prototype.getTile=function(e,i,r,n,o){var a,s=lM(e,i,r),l=this.getKey();if(this.tileCache.containsKey(s)&&(a=this.tileCache.get(s)).key===l)return a;var h=[e,i,r],u=this.getTileCoordForTileUrlFunction(h,o),c=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(o);if(u&&c){var p=d.getTileCoordExtent(u);tO(p,-d.getResolution(e),p),t5(c,p)||(u=null)}var f=!0;if(null!==u){var m=this.tileGrid,g=d.getResolution(e),_=m.getZForResolution(g,1),y=d.getTileCoordExtent(u);tO(y,-g,y),m.forEachTileCoord(y,_,(function(e){f=f&&!this.tileUrlFunction(e,n,o)}).bind(this))}var v=new hb(h,f?sy.EMPTY:sy.IDLE,u,this.getSourceTiles.bind(this,n,o));return v.key=l,a?(v.interimTile=a,v.refreshInterimChain(),this.tileCache.replace(s,v)):this.tileCache.set(s,v),v},i.prototype.getTileGridForProjection=function(e){var i=e.getCode(),r=this.tileGrids_[i];if(!r){var n=this.tileGrid;r=lQ(e,void 0,n?n.getTileSize(n.getMinZoom()):void 0),this.tileGrids_[i]=r}return r},i.prototype.getTilePixelRatio=function(e){return e},i.prototype.getTilePixelSize=function(e,i,r){var n=rw(this.getTileGridForProjection(r).getTileSize(e),this.tmpSize);return[Math.round(n[0]*i),Math.round(n[1]*i)]},i.prototype.updateCacheSize=function(i,r){e.prototype.updateCacheSize.call(this,2*i,r)},i}(l6);function hS(e,i){var r=oV(i,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(r)}var hE=function(){function e(e){var i=e||{};this.font_=i.font,this.rotation_=i.rotation,this.rotateWithView_=i.rotateWithView,this.scale_=i.scale,this.scaleArray_=rw(void 0!==i.scale?i.scale:1),this.text_=i.text,this.textAlign_=i.textAlign,this.textBaseline_=i.textBaseline,this.fill_=void 0!==i.fill?i.fill:new ni({color:"#333"}),this.maxAngle_=void 0!==i.maxAngle?i.maxAngle:Math.PI/4,this.placement_=void 0!==i.placement?i.placement:nP.POINT,this.overflow_=!!i.overflow,this.stroke_=void 0!==i.stroke?i.stroke:null,this.offsetX_=void 0!==i.offsetX?i.offsetX:0,this.offsetY_=void 0!==i.offsetY?i.offsetY:0,this.backgroundFill_=i.backgroundFill?i.backgroundFill:null,this.backgroundStroke_=i.backgroundStroke?i.backgroundStroke:null,this.padding_=void 0===i.padding?null:i.padding}return e.prototype.clone=function(){var i=this.getScale();return new e({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(i)?i.slice():i,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()})},e.prototype.getOverflow=function(){return this.overflow_},e.prototype.getFont=function(){return this.font_},e.prototype.getMaxAngle=function(){return this.maxAngle_},e.prototype.getPlacement=function(){return this.placement_},e.prototype.getOffsetX=function(){return this.offsetX_},e.prototype.getOffsetY=function(){return this.offsetY_},e.prototype.getFill=function(){return this.fill_},e.prototype.getRotateWithView=function(){return this.rotateWithView_},e.prototype.getRotation=function(){return this.rotation_},e.prototype.getScale=function(){return this.scale_},e.prototype.getScaleArray=function(){return this.scaleArray_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.getText=function(){return this.text_},e.prototype.getTextAlign=function(){return this.textAlign_},e.prototype.getTextBaseline=function(){return this.textBaseline_},e.prototype.getBackgroundFill=function(){return this.backgroundFill_},e.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},e.prototype.getPadding=function(){return this.padding_},e.prototype.setOverflow=function(e){this.overflow_=e},e.prototype.setFont=function(e){this.font_=e},e.prototype.setMaxAngle=function(e){this.maxAngle_=e},e.prototype.setOffsetX=function(e){this.offsetX_=e},e.prototype.setOffsetY=function(e){this.offsetY_=e},e.prototype.setPlacement=function(e){this.placement_=e},e.prototype.setRotateWithView=function(e){this.rotateWithView_=e},e.prototype.setFill=function(e){this.fill_=e},e.prototype.setRotation=function(e){this.rotation_=e},e.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=rw(void 0!==e?e:1)},e.prototype.setStroke=function(e){this.stroke_=e},e.prototype.setText=function(e){this.text_=e},e.prototype.setTextAlign=function(e){this.textAlign_=e},e.prototype.setTextBaseline=function(e){this.textBaseline_=e},e.prototype.setBackgroundFill=function(e){this.backgroundFill_=e},e.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e},e.prototype.setPadding=function(e){this.padding_=e},e}(),hI={},hC={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},hA=/(italic|oblique)$/i,hR={};hI=function(e,i,r){var n=hR[e];if(!n){Array.isArray(e)||(e=[e]);for(var o,a,s=400,l="normal",h=[],u=0,c=e.length;u<c;++u){var d=e[u].split(" "),p=d[d.length-1].toLowerCase();for(var f in"normal"==p||"italic"==p||"oblique"==p?(l=a?l:p,a=!0,d.pop(),p=d[d.length-1].toLowerCase()):hA.test(p)&&(p=p.replace(hA,""),l=a?l:d[d.length-1].replace(p,""),a=!0),hC){var m=d.length>1?d[d.length-2].toLowerCase():"";if(p==f||p==f.replace("-","")||m+"-"+p==f){s=o?s:hC[f],d.pop(),m&&f.startsWith(m)&&d.pop();break}}o||"number"!=typeof p||(s=p,o=!0);var g=d.join(" ").replace("Klokantech Noto Sans","Noto Sans");-1!==g.indexOf(" ")&&(g='"'+g+'"'),h.push(g)}n=hR[e]=[l,s,h]}return n[0]+" "+n[1]+" "+i+"px"+(r?"/"+r:"")+" "+n[2]};var hM=e5("484LI"),hP="function"==typeof Object.assign?Object.assign:function(e,i){if(null==e)throw TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1,o=arguments.length;n<o;++n){var a=arguments[n];if(null!=a)for(var s in a)a.hasOwnProperty(s)&&(r[s]=a[s])}return r};function hO(e){return e*Math.PI/180}var hk=function(){for(var e=[],i=78271.51696402048;e.length<=24;i/=2)e.push(i);return e}();function hL(e,i){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(e,i);var r=document.createElement("canvas");return r.width=e,r.height=i,r}var hD=Array(256).join("â");function hz(e,i){if(i>=.05){for(var r="",n=e.split("\n"),o=hD.slice(0,Math.round(i/.1)),a=0,s=n.length;a<s;++a)a>0&&(r+="\n"),r+=n[a].split("").join(o);return r}return e}function hF(){return eW||(eW=hL(1,1).getContext("2d")),eW}function hB(e,i){return hF().measureText(e).width+(e.length-1)*i}var hN={};rK&&iD(rK,iL.CLEAR,function(){hN={}});var hj=hM.function.isFunction,hV=hM.function.convertFunction,hU=hM.expression.isExpression,hG=hM.expression.createPropertyExpression,hq={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},h$={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},hH=function(e,i){var r=hG(e,i);if("error"===r.result)throw Error(r.value.map(function(e){return"".concat(e.key,": ").concat(e.message)}).join(", "));return r.value},hZ={},hW={zoom:0};function hX(e,i,r,n,o,a){var s=e.id;a||(a={},console.warn("No functionCache provided to getValue()")),a[s]||(a[s]={});var l=a[s];if(!l[r]){var h=(e[i]||hZ)[r],u=hM.latest["".concat(i,"_").concat(e.type)][r];void 0===h&&(h=u.default);var c=hU(h);if(!c&&hj(h)&&(h=hV(h,u),c=!0),c){var d=hH(h,u);l[r]=d.evaluate.bind(d)}else"color"==u.type&&(h=hM.Color.parse(h)),l[r]=function(){return h}}return hW.zoom=n,l[r](hW,o)}function hY(e,i){if(e){if(0===e.a||0===i)return;var r=e.a;return i=void 0===i?1:i,0===r?"transparent":"rgba("+Math.round(255*e.r/r)+","+Math.round(255*e.g/r)+","+Math.round(255*e.b/r)+","+r*i+")"}return e}var hK=/^([^]*)\{(.*)\}([^]*)$/;function hJ(e,i){var r;do if(r=e.match(hK)){var n=i[r[2]]||"";e=r[1]+n+r[3]}while(r)return e}var hQ={};(function(){var e;hQ={icon:"icons/google.svg",name:"google",title:"Google Fonts",link:"google.com/fonts",getNames:function(){return e},getLink:function(e){return"https://fonts.google.com/specimen/"+e.replace(/( )/g,"+")},normalizeName:function(e){return e}},e=["ABeeZee","Abel","Abril Fatface","Aclonica","Acme","Actor","Adamina","Advent Pro","Aguafina Script","Akronim","Aladin","Aldrich","Alef","Alegreya","Alegreya SC","Alegreya Sans","Alegreya Sans SC","Alex Brush","Alfa Slab One","Alice","Alike","Alike Angular","Allan","Allerta","Allerta Stencil","Allura","Almendra","Almendra Display","Almendra SC","Amarante","Amaranth","Amatic SC","Amethysta","Amiri","Amita","Anaheim","Andada","Andika","Angkor","Annie Use Your Telescope","Anonymous Pro","Antic","Antic Didone","Antic Slab","Anton","Arapey","Arbutus","Arbutus Slab","Architects Daughter","Archivo Black","Archivo Narrow","Arimo","Arizonia","Armata","Artifika","Arvo","Arya","Asap","Asar","Asset","Astloch","Asul","Atomic Age","Aubrey","Audiowide","Autour One","Average","Average Sans","Averia Gruesa Libre","Averia Libre","Averia Sans Libre","Averia Serif Libre","Bad Script","Balthazar","Bangers","Basic","Battambang","Baumans","Bayon","Belgrano","Belleza","BenchNine","Bentham","Berkshire Swash","Bevan","Bigelow Rules","Bigshot One","Bilbo","Bilbo Swash Caps","Biryani","Bitter","Black Ops One","Bokor","Bonbon","Boogaloo","Bowlby One","Bowlby One SC","Brawler","Bree Serif","Bubblegum Sans","Bubbler One","Buda","Buenard","Butcherman","Butterfly Kids","Cabin","Cabin Condensed","Cabin Sketch","Caesar Dressing","Cagliostro","Calligraffitti","Cambay","Cambo","Candal","Cantarell","Cantata One","Cantora One","Capriola","Cardo","Carme","Carrois Gothic","Carrois Gothic SC","Carter One","Catamaran","Caudex","Caveat","Caveat Brush","Cedarville Cursive","Ceviche One","Changa One","Chango","Chau Philomene One","Chela One","Chelsea Market","Chenla","Cherry Cream Soda","Cherry Swash","Chewy","Chicle","Chivo","Chonburi","Cinzel","Cinzel Decorative","Clicker Script","Coda","Coda Caption","Codystar","Combo","Comfortaa","Coming Soon","Concert One","Condiment","Content","Contrail One","Convergence","Cookie","Copse","Corben","Courgette","Cousine","Coustard","Covered By Your Grace","Crafty Girls","Creepster","Crete Round","Crimson Text","Croissant One","Crushed","Cuprum","Cutive","Cutive Mono","Damion","Dancing Script","Dangrek","Dawning of a New Day","Days One","Dekko","Delius","Delius Swash Caps","Delius Unicase","Della Respira","Denk One","Devonshire","Dhurjati","Didact Gothic","Diplomata","Diplomata SC","Domine","Donegal One","Doppio One","Dorsa","Dosis","Dr Sugiyama","Droid Sans","Droid Sans Mono","Droid Serif","Duru Sans","Dynalight","EB Garamond","Eagle Lake","Eater","Economica","Eczar","Ek Mukta","Electrolize","Elsie","Elsie Swash Caps","Emblema One","Emilys Candy","Engagement","Englebert","Enriqueta","Erica One","Esteban","Euphoria Script","Ewert","Exo","Exo 2","Expletus Sans","Fanwood Text","Fascinate","Fascinate Inline","Faster One","Fasthand","Fauna One","Federant","Federo","Felipa","Fenix","Finger Paint","Fira Mono","Fira Sans","Fjalla One","Fjord One","Flamenco","Flavors","Fondamento","Fontdiner Swanky","Forum","Francois One","Freckle Face","Fredericka the Great","Fredoka One","Freehand","Fresca","Frijole","Fruktur","Fugaz One","GFS Didot","GFS Neohellenic","Gabriela","Gafata","Galdeano","Galindo","Gentium Basic","Gentium Book Basic","Geo","Geostar","Geostar Fill","Germania One","Gidugu","Gilda Display","Give You Glory","Glass Antiqua","Glegoo","Gloria Hallelujah","Goblin One","Gochi Hand","Gorditas","Goudy Bookletter 1911","Graduate","Grand Hotel","Gravitas One","Great Vibes","Griffy","Gruppo","Gudea","Gurajada","Habibi","Halant","Hammersmith One","Hanalei","Hanalei Fill","Handlee","Hanuman","Happy Monkey","Headland One","Henny Penny","Herr Von Muellerhoff","Hind","Hind Siliguri","Hind Vadodara","Holtwood One SC","Homemade Apple","Homenaje","IM Fell DW Pica","IM Fell DW Pica SC","IM Fell Double Pica","IM Fell Double Pica SC","IM Fell English","IM Fell English SC","IM Fell French Canon","IM Fell French Canon SC","IM Fell Great Primer","IM Fell Great Primer SC","Iceberg","Iceland","Imprima","Inconsolata","Inder","Indie Flower","Inika","Inknut Antiqua","Irish Grover","Istok Web","Italiana","Italianno","Itim","Jacques Francois","Jacques Francois Shadow","Jaldi","Jim Nightshade","Jockey One","Jolly Lodger","Josefin Sans","Josefin Slab","Joti One","Judson","Julee","Julius Sans One","Junge","Jura","Just Another Hand","Just Me Again Down Here","Kadwa","Kalam","Kameron","Kantumruy","Karla","Karma","Kaushan Script","Kavoon","Kdam Thmor","Keania One","Kelly Slab","Kenia","Khand","Khmer","Khula","Kite One","Knewave","Kotta One","Koulen","Kranky","Kreon","Kristi","Krona One","Kurale","La Belle Aurore","Laila","Lakki Reddy","Lancelot","Lateef","Lato","League Script","Leckerli One","Ledger","Lekton","Lemon","Libre Baskerville","Life Savers","Lilita One","Lily Script One","Limelight","Linden Hill","Lobster","Lobster Two","Londrina Outline","Londrina Shadow","Londrina Sketch","Londrina Solid","Lora","Love Ya Like A Sister","Loved by the King","Lovers Quarrel","Luckiest Guy","Lusitana","Lustria","Macondo","Macondo Swash Caps","Magra","Maiden Orange","Mako","Mallanna","Mandali","Marcellus","Marcellus SC","Marck Script","Margarine","Marko One","Marmelad","Martel","Martel Sans","Marvel","Mate","Mate SC","Maven Pro","McLaren","Meddon","MedievalSharp","Medula One","Megrim","Meie Script","Merienda","Merienda One","Merriweather","Merriweather Sans","Metal","Metal Mania","Metamorphous","Metrophobic","Michroma","Milonga","Miltonian","Miltonian Tattoo","Miniver","Miss Fajardose","Modak","Modern Antiqua","Molengo","Molle","Monda","Monofett","Monoton","Monsieur La Doulaise","Montaga","Montez","Montserrat","Montserrat Alternates","Montserrat Subrayada","Moul","Moulpali","Mountains of Christmas","Mouse Memoirs","Mr Bedfort","Mr Dafoe","Mr De Haviland","Mrs Saint Delafield","Mrs Sheppards","Muli","Mystery Quest","NTR","Neucha","Neuton","New Rocker","News Cycle","Niconne","Nixie One","Nobile","Nokora","Norican","Nosifer","Nothing You Could Do","Noticia Text","Noto Sans","Noto Serif","Nova Cut","Nova Flat","Nova Mono","Nova Oval","Nova Round","Nova Script","Nova Slim","Nova Square","Numans","Nunito","Odor Mean Chey","Offside","Old Standard TT","Oldenburg","Oleo Script","Oleo Script Swash Caps","Open Sans","Open Sans Condensed","Oranienbaum","Orbitron","Oregano","Orienta","Original Surfer","Oswald","Over the Rainbow","Overlock","Overlock SC","Ovo","Oxygen","Oxygen Mono","PT Mono","PT Sans","PT Sans Caption","PT Sans Narrow","PT Serif","PT Serif Caption","Pacifico","Palanquin","Palanquin Dark","Paprika","Parisienne","Passero One","Passion One","Pathway Gothic One","Patrick Hand","Patrick Hand SC","Patua One","Paytone One","Peddana","Peralta","Permanent Marker","Petit Formal Script","Petrona","Philosopher","Piedra","Pinyon Script","Pirata One","Plaster","Play","Playball","Playfair Display","Playfair Display SC","Podkova","Poiret One","Poller One","Poly","Pompiere","Pontano Sans","Poppins","Port Lligat Sans","Port Lligat Slab","Pragati Narrow","Prata","Preahvihear","Press Start 2P","Princess Sofia","Prociono","Prosto One","Puritan","Purple Purse","Quando","Quantico","Quattrocento","Quattrocento Sans","Questrial","Quicksand","Quintessential","Qwigley","Racing Sans One","Radley","Rajdhani","Raleway","Raleway Dots","Ramabhadra","Ramaraja","Rambla","Rammetto One","Ranchers","Rancho","Ranga","Rationale","Ravi Prakash","Redressed","Reenie Beanie","Revalia","Rhodium Libre","Ribeye","Ribeye Marrow","Righteous","Risque","Roboto","Roboto Condensed","Roboto Mono","Roboto Slab","Rochester","Rock Salt","Rokkitt","Romanesco","Ropa Sans","Rosario","Rosarivo","Rouge Script","Rozha One","Rubik","Rubik Mono One","Rubik One","Ruda","Rufina","Ruge Boogie","Ruluko","Rum Raisin","Ruslan Display","Russo One","Ruthie","Rye","Sacramento","Sahitya","Sail","Salsa","Sanchez","Sancreek","Sansita One","Sarala","Sarina","Sarpanch","Satisfy","Scada","Scheherazade","Schoolbell","Seaweed Script","Sevillana","Seymour One","Shadows Into Light","Shadows Into Light Two","Shanti","Share","Share Tech","Share Tech Mono","Shojumaru","Short Stack","Siemreap","Sigmar One","Signika","Signika Negative","Simonetta","Sintony","Sirin Stencil","Six Caps","Skranji","Slabo 13px","Slabo 27px","Slackey","Smokum","Smythe","Sniglet","Snippet","Snowburst One","Sofadi One","Sofia","Sonsie One","Sorts Mill Goudy","Source Code Pro","Source Sans Pro","Source Serif Pro","Special Elite","Spicy Rice","Spinnaker","Spirax","Squada One","Sree Krushnadevaraya","Stalemate","Stalinist One","Stardos Stencil","Stint Ultra Condensed","Stint Ultra Expanded","Stoke","Strait","Sue Ellen Francisco","Sumana","Sunshiney","Supermercado One","Sura","Suranna","Suravaram","Suwannaphum","Swanky and Moo Moo","Syncopate","Tangerine","Taprom","Tauri","Teko","Telex","Tenali Ramakrishna","Tenor Sans","Text Me One","The Girl Next Door","Tienne","Tillana","Timmana","Tinos","Titan One","Titillium Web","Trade Winds","Trocchi","Trochut","Trykker","Tulpen One","Ubuntu","Ubuntu Condensed","Ubuntu Mono","Ultra","Uncial Antiqua","Underdog","Unica One","UnifrakturCook","UnifrakturMaguntia","Unkempt","Unlock","Unna","VT323","Vampiro One","Varela","Varela Round","Vast Shadow","Vesper Libre","Vibur","Vidaloka","Viga","Voces","Volkhov","Vollkorn","Voltaire","Waiting for the Sunrise","Wallpoet","Walter Turncoat","Warnes","Wellfleet","Wendy One","Wire One","Work Sans","Yanone Kaffeesatz","Yantramanav","Yellowtail","Yeseva One","Yesteryear","Zeyada"]}).call(hQ);var hM=e5("484LI"),h0={},h1=/font-family: ?([^;]*);/,h2=/("|')/g,h3={},h5=e1(hQ).getNames();function h4(e){var i=e.toString();if(i in h3)return e;for(var r=e.map(function(e){var i=e1(hI)(e,1).split(" ");return[i.slice(3).join(" ").replace(/"/g,""),i[1]+i[0]]}),n=0,o=r.length;n<o;++n){var a=r[n],s=a[0];if(!function(e){if(!eK){eK={};for(var i=document.styleSheets,r=0,n=i.length;r<n;++r){var o=i[r];try{var a=o.rules||o.cssRules;if(a)for(var s=0,l=a.length;s<l;++s){var h=a[s];5==h.type&&(eK[h.cssText.match(h1)[1].replace(h2,"")]=!0)}}catch(e){}}}return e in eK}(s)&&-1!==h5.indexOf(s)){var l="https://fonts.googleapis.com/css?family="+s.replace(/ /g,"+")+":"+a[1];if(!document.querySelector('link[href="'+l+'"]')){var h=document.createElement("link");h.href=l,h.rel="stylesheet",document.head.appendChild(h)}}}return h3[i]=!0,e}var h6=/^(.*)(\?.*)$/;function h8(e,i){return i&&0===e.indexOf(".")&&(e=i+e),e}function h9(e,i,r){var n=(e=h8(e,i)).match(h6);return n?n[1]+r+(n.length>2?n[2]:""):e+r}var h7={};function ue(e){var i=e.bounds;if(i){var r=iu([i[0],i[1]]),n=iu([i[2],i[3]]);return[r[0],r[1],n[0],n[1]]}}var ut=new aP;function ui(e,i,r,n){var o=hX(e,"paint","raster-opacity",r.getZoom(),h7,n);i.setOpacity(o)}function ur(e,i,r,n,o,a){void 0===a&&(a="");var s,l,h,u,c,d,p=[],f=i.getView();("object"==typeof f.options_?!tx(f.options_):f.isDef()||f.getRotation()||f.getResolutions())||(f=new sL(hP(f.getProperties(),{maxResolution:hk[0]})),i.setView(f)),"center"in e&&!f.getCenter()&&f.setCenter(iu(e.center)),"zoom"in e&&void 0===f.getZoom()&&f.setResolution(hk[0]/Math.pow(2,e.zoom)),f.getCenter()&&void 0!==f.getZoom()||f.fit(f.getProjection().getExtent(),{nearest:!0,size:i.getSize()}),e.sprite&&(0==e.sprite.indexOf("mapbox://")?e.sprite=r+"/sprite"+a:0!=e.sprite.indexOf("http")&&(e.sprite=(n?n+o:"")+e.sprite+a));for(var m=e.layers,g=[],_=this,y=0,v=m.length;y<v;++y)!function(r,y){var v=(s=m[r]).type;if("heatmap"==v||"hillshade"==v);else if("background"==v){var x={id:s.id,type:s.type},b={};function w(e){var r,n,o=s.layout||{},a=s.paint||{};x.paint=a;var l="function"==typeof i.getSource?i.getSource().getTileGrid().getZForResolution(e):i.getView().getZoom(),h="function"==typeof i.getTargetElement?i.getTargetElement():void 0;if(void 0!==a["background-color"]&&(r=hX(x,"paint","background-color",l,h7,b),h&&(h.style.background=hM.Color.parse(r).toString())),void 0!==a["background-opacity"]&&(n=hX(x,"paint","background-opacity",l,h7,b),h&&(h.style.opacity=n)),"none"==o.visibility){h&&(h.style.backgroundColor="",h.style.opacity="");return}return hY(r,n)}if("function"==typeof i.getTargetElement)i.getTargetElement()&&w(),i.on(["change:resolution","change:target"],w);else if("function"==typeof i.setBackground)i.setBackground(w);else throw Error("Unable to apply background.")}else{if((u=s.source||(T=s.ref,m.some(function(e){if(e.id==T)return S=e.source,!0}),S))!=h){if(g.length&&(p.push(un(c,g,e,o,i)),g=[]),d=(l=e.sources[u]).url)if(0==(d=h8(d,o)).indexOf("mapbox://")){var T,S,E,I,C,A=d.replace("mapbox://","");l.tiles=["a","b","c","d"].map(function(e){return"https://"+e+".tiles.mapbox.com/v4/"+A+"/{z}/{x}/{y}."+("vector"==l.type?"vector.pbf":"png")+a})}else 0===d.indexOf("/")&&0===n.indexOf("http")&&(d=n+d);if(l.tiles&&(l.tiles=l.tiles.map(function(e){return h8(e,o)})),"vector"==l.type)R=d,M=new hg({declutter:!0,visible:!1}),(!(k=h0[O=[R,JSON.stringify(P=hP({},P=l))].toString()])&&(k=new ht({url:P.tiles?void 0:R,tileJSON:P.tiles?P:void 0}),h0[O]=k),new Promise(function(e){var i=k.on("change",function(){var r=k.getState();if("ready"===r){var n=k.getTileJSON(),o=Array.isArray(n.tiles)?n.tiles:[n.tiles];if(R)for(var a=0,s=o.length;a<s;++a)o[a]=decodeURI(new URL(o[a],R).href);var l=k.getTileGrid(),h=ue(n),u=n.minzoom||0,c=n.maxzoom||22,d=k.get("ol-source");void 0===d&&(d=new hT({attributions:k.getAttributions(),format:new a2,tileGrid:new lL({origin:l.getOrigin(0),extent:h||l.getExtent(),minZoom:u,resolutions:hk.slice(0,c+1),tileSize:512}),urls:o}),k.set("ol-source",d)),iN(i),e(d)}else"error"===r&&(k.set("ol-source",null),iN(i),e(void 0))});"ready"===k.getState()&&k.changed()})).then(function(e){M.setSource(e)}),c=M;else if("raster"==l.type){L=d,D=new hh,F=(z=new ht({transition:0,url:l.tiles?void 0:L,tileJSON:l.tiles?l:void 0,crossOrigin:"anonymous"})).on("change",function(){var e=z.getState();if("ready"===e){iN(F);var i=z.getTileJSON(),r=ue(i),n=z.getTileGrid(),o=l.tileSize||i.tileSize||512,a=i.minzoom||0,s=i.maxzoom||22;z.tileGrid=new lL({origin:n.getOrigin(0),extent:r||n.getExtent(),minZoom:a,resolutions:lK({maxZoom:s,tileSize:o}).getResolutions(),tileSize:o}),D.setSource(z)}else"error"===e&&(iN(F),D.setSource(void 0))}),z.setTileLoadFunction(function(e,i){if(-1!=i.indexOf("{bbox-epsg-3857}")){var r=z.getTileGrid().getTileCoordExtent(e.getTileCoord());i=i.replace("{bbox-epsg-3857}",r.toString())}e.getImage().src=i}),(c=D).setVisible(!s.layout||"none"!==s.layout.visibility);var R,M,P,O,k,L,D,z,F,B={};f.on("change:resolution",ui.bind(_,s,c,f,B)),ui(s,c,f,B)}else"geojson"==l.type&&("string"==typeof(C=l.data)?I=h8(C,o):E=ut.readFeatures(C,{featureProjection:"EPSG:3857"}),c=new oA({source:new o$({attributions:l.attribution,features:E,format:ut,url:I}),visible:!1}));h=u,c&&c.set("mapbox-source",h)}g.push(s.id)}}(y,0);return p.push(un(c,g,e,o,i)),i.set("mapbox-style",e),Promise.all(p)}function un(e,i,r,n,o){for(var a=24,s=0,l=r.layers,h=0,u=l.length;h<u;++h){var c=l[h];-1!==i.indexOf(c.id)&&(a=Math.min("minzoom"in c?c.minzoom:0,a),s=Math.max("maxzoom"in c?c.maxzoom:24,s))}return new Promise(function(l,h){var u=function(){var o,u=e.getSource();if(!u||"error"===u.getState())return void h(Error("Error accessing data for source "+e.get("mapbox-source")));if("function"==typeof u.getTileGrid){var c=u.getTileGrid();if(c){var d=c.getMinZoom();(a>0||d>0)&&e.setMaxResolution(Math.min(hk[a],c.getResolution(d))+1e-9),s<24&&e.setMinResolution(hk[s]+1e-9)}}u instanceof o$||u instanceof hT?(o=r,new Promise(function(r,a){if("object"!=typeof o&&(o=JSON.parse(o)),8!=o.version)return a(Error("glStyle version 8 required."));if(!(e instanceof oA||e instanceof hg))return a(Error("Can only apply to VectorLayer or VectorTileLayer"));function s(){u||o.sprite&&!l?u?(e.setStyle(u),r()):a(Error("Something went wrong trying to apply style.")):(u=function(e,i,r,n,o,a,s){if(void 0===n&&(n=hk),"string"==typeof i&&(i=JSON.parse(i)),8!=i.version)throw Error("glStyle version 8 required.");if(a){if("undefined"!=typeof Image){var l,h,u,c=new Image;c.crossOrigin="anonymous",c.onload=function(){l=c,h=[c.width,c.height],e.changed(),c.onload=null},c.src=a}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var d=self;d.postMessage({action:"loadImage",src:a}),d.addEventListener("message",function(e){"imageLoaded"===e.data.action&&e.data.src===a&&(h=[(l=e.data.image).width,l.height])})}}for(var p=(0,hM.derefLayers)(i.layers),f={},m=[],g={},_={},y={},v={},x=0,b=p.length;x<b;++x){var w=p[x],T=w.id;if("string"==typeof r&&w.source==r||-1!==r.indexOf(T)){var S=w["source-layer"];if(!u){u=w.source;var E=i.sources[u];if(!E)throw Error('Source "'.concat(u,'" is not defined'));var I=E.type;if("vector"!==I&&"geojson"!==I)throw Error('Source "'.concat(u,'" is not of type "vector" or "geojson", but "').concat(I,'"'))}var C=f[S];C||(C=[],f[S]=C),C.push({layer:w,index:x}),m.push(T)}}var A=new nr,R=new ni,M=[],P=function(e,i){var r=e.getProperties(),a=f[r.layer];if(a){var u=n.indexOf(i);-1==u&&(u=function(e,i){for(var r=0,n=i.length;r<n;++r)if(i[r]<e&&r+1<n){var o=i[r]/i[r+1];return r+Math.log(i[r]/e)/Math.log(o)}return n-1}(i,n));for(var c=hq[e.getGeometry().getType()],d={properties:r,type:c},p=-1,m=0,x=a.length;m<x;++m)!function(n,f){var m,x=a[n],b=x.layer,w=b.id,T=b.layout||hZ,S=b.paint||hZ;if("none"!==T.visibility&&(!("minzoom"in b)||!(u<b.minzoom))&&(!("maxzoom"in b)||!(u>=b.maxzoom))){var E=b.filter;if(!E||(m=u,v||console.warn("No filterCache provided to evaluateFilter()"),w in v||(v[w]=(0,hM.featureFilter)(E).filter),hW.zoom=m,v[w](hW,d))){var I=void 0,C=void 0,P=void 0,O=void 0,k=void 0,L=void 0,D=x.index;if(3==c&&("fill"==b.type||"fill-extrusion"==b.type))if(C=hX(b,"paint",b.type+"-opacity",u,d,y),b.type+"-pattern"in S){var z=hX(b,"paint",b.type+"-pattern",u,d,y);if(z){var F="string"==typeof z?hJ(z,r):z.toString();if(l&&o&&o[F]){(!(L=M[++p])||!L.getFill()||L.getStroke()||L.getText())&&(L=new nn({fill:new ni}),M[p]=L),P=L.getFill(),L.setZIndex(D);var B=F+"."+C,N=_[B];if(!N){var j=o[F],V=hL(j.width,j.height),U=V.getContext("2d");U.globalAlpha=C,U.drawImage(l,j.x,j.y,j.width,j.height,0,0,j.width,j.height),N=U.createPattern(V,"repeat"),_[B]=N}P.setColor(N)}}}else I=hY(hX(b,"paint",b.type+"-color",u,d,y),C),b.type+"-outline-color"in S&&(k=hY(hX(b,"paint",b.type+"-outline-color",u,d,y),C)),k||(k=I),(I||k)&&((!(L=M[++p])||I&&!L.getFill()||!I&&L.getFill()||k&&!L.getStroke()||!k&&L.getStroke()||L.getText())&&(L=new nn({fill:I?new ni:void 0,stroke:k?new nr:void 0}),M[p]=L),I&&(P=L.getFill()).setColor(I),k&&((O=L.getStroke()).setColor(k),O.setWidth(.5)),L.setZIndex(D));if(1!=c&&"line"==b.type){I=!("line-pattern"in S)&&"line-color"in S?hY(hX(b,"paint","line-color",u,d,y),hX(b,"paint","line-opacity",u,d,y)):void 0;var G=hX(b,"paint","line-width",u,d,y);I&&G>0&&((!(L=M[++p])||!L.getStroke()||L.getFill()||L.getText())&&(L=new nn({stroke:new nr}),M[p]=L),(O=L.getStroke()).setLineCap(hX(b,"layout","line-cap",u,d,y)),O.setLineJoin(hX(b,"layout","line-join",u,d,y)),O.setMiterLimit(hX(b,"layout","line-miter-limit",u,d,y)),O.setColor(I),O.setWidth(G),O.setLineDash(S["line-dasharray"]?hX(b,"paint","line-dasharray",u,d,y).map(function(e){return e*G}):null),L.setZIndex(D))}var q=!1,$=null,H=0,Z=void 0,W=void 0,X=void 0;if((1==c||2==c)&&"icon-image"in T){var Y=hX(b,"layout","icon-image",u,d,y);if(Y){Z="string"==typeof Y?hJ(Y,r):Y.toString();var K=void 0;if(l&&o&&o[Z]){var J=hX(b,"layout","icon-rotation-alignment",u,d,y);if(2==c){var Q=e.getGeometry();if(Q.getFlatMidpoint||Q.getFlatMidpoints){var ee=Q.getExtent();if(Math.sqrt(Math.max(Math.pow((ee[2]-ee[0])/i,2),Math.pow((ee[3]-ee[1])/i,2)))>150){var et="MultiLineString"===Q.getType()?Q.getFlatMidpoints():Q.getFlatMidpoint();eY||(eY=new a0("Point",eX=[NaN,NaN],[],{},null)),K=eY,eX[0]=et[0],eX[1]=et[1];var ei=hX(b,"layout","symbol-placement",u,d,y);if("line"===ei&&"map"===J)for(var er=Q.getStride(),en=Q.getFlatCoordinates(),eo=0,ea=en.length-er;eo<ea;eo+=er){var es=en[eo],el=en[eo+1],eh=en[eo+er],eu=en[eo+er+1],ec=Math.min(es,eh),ed=Math.min(el,eu),ep=Math.max(es,eh),ef=Math.max(el,eu);if(et[0]>=ec&&et[0]<=ep&&et[1]>=ed&&et[1]<=ef){H=Math.atan2(el-eu,eh-es);break}}}}}if(2!==c||K){var em=hX(b,"layout","icon-size",u,d,y),eg=void 0!==S["icon-color"]?hX(b,"paint","icon-color",u,d,y):null;if(!eg||0!==eg.a){var B=Z+"."+em;if(null!==eg&&(B+="."+eg),!(W=g[B])){var e_=o[Z];W=new oy({color:eg?[255*eg.r,255*eg.g,255*eg.b,eg.a]:void 0,img:l,imgSize:h,size:[e_.width,e_.height],offset:[e_.x,e_.y],rotateWithView:"map"===J,scale:em/e_.pixelRatio,displacement:"icon-offset"in T?hX(b,"layout","icon-offset",u,d,y).map(function(e){return-e*e_.pixelRatio}):void 0}),g[B]=W}}W&&((!(L=M[++p])||!L.getImage()||L.getFill()||L.getStroke())&&(L=new nn,M[p]=L),L.setGeometry(K),W.setRotation(H+hO(hX(b,"layout","icon-rotate",u,d,y))),W.setOpacity(hX(b,"paint","icon-opacity",u,d,y)),W.setAnchor(h$[hX(b,"layout","icon-anchor",u,d,y)]),L.setImage(W),$=L.getText(),L.setText(void 0),L.setZIndex(D),q=!0,X=!1)}else X=!0}}}if(1==c&&"circle"===b.type){(!(L=M[++p])||!L.getImage()||L.getFill()||L.getStroke())&&(L=new nn,M[p]=L);var ey="circle-radius"in S?hX(b,"paint","circle-radius",u,d,y):5,ev=hY(hX(b,"paint","circle-stroke-color",u,d,y),hX(b,"paint","circle-stroke-opacity",u,d,y)),ex=hY(hX(b,"paint","circle-color",u,d,y),hX(b,"paint","circle-opacity",u,d,y)),eb=hX(b,"paint","circle-stroke-width",u,d,y),ew=ey+"."+ev+"."+ex+"."+eb;(W=g[ew])||(W=new nt({radius:ey,stroke:ev&&eb>0?new nr({width:eb,color:ev}):void 0,fill:ex?new ni({color:ex}):void 0}),g[ew]=W),L.setImage(W),$=L.getText(),L.setText(void 0),L.setGeometry(void 0),L.setZIndex(D),q=!0}var eT=void 0;if("text-field"in T&&(eT=hJ(hX(b,"layout","text-field",u,d,y).toString(),r).trim(),C=hX(b,"paint","text-opacity",u,d,y)),eT&&C&&!X){q||((!(L=M[++p])||!L.getText()||L.getFill()||L.getStroke())&&(L=new nn,M[p]=L),L.setImage(void 0),L.setGeometry(void 0)),L.getText()||L.setText($||new hE({padding:[2,2,2,2]})),$=L.getText();var eS=Math.round(hX(b,"layout","text-size",u,d,y)),eE=hX(b,"layout","text-font",u,d,y),eI=hX(b,"layout","text-line-height",u,d,y),eC=e1(hI)(s?s(eE):eE,eS,eI),eA=T["text-transform"];"uppercase"==eA?eT=eT.toUpperCase():"lowercase"==eA&&(eT=eT.toLowerCase());var eR=hX(b,"layout","text-max-width",u,d,y),eM=hX(b,"layout","text-letter-spacing",u,d,y),eP=2==c?hz(eT,eM):function e(i,r,n,o){if(-1!==i.indexOf("\n")){for(var a=i.split("\n"),s=[],l=0,h=a.length;l<h;++l)s.push(e(a[l],r,n,o));return s.join("\n")}var u=n+","+r+","+i+","+o,c=hN[u];if(!c){var d=i.split(" ");if(d.length>1){var p=hF();p.font=r;for(var f=p.measureText("M").width*n,m="",s=[],l=0,h=d.length;l<h;++l){var g=d[l],_=m+(m?" ":"")+g;hB(_,o)<=f?m=_:(m&&s.push(m),m=g)}m&&s.push(m);for(var l=0,h=s.length;l<h&&h>1;++l){var y=s[l];if(hB(y,o)<.35*f){var v=l>0?hB(s[l-1],o):1/0,x=l<h-1?hB(s[l+1],o):1/0;s.splice(l,1),h-=1,v<x?(s[l-1]+=" "+y,l-=1):s[l]=y+" "+s[l]}}for(var l=0,h=s.length-1;l<h;++l){var b=s[l],w=s[l+1];if(hB(b,o)>.7*f&&hB(w,o)<.6*f){var T=b.split(" "),S=T.pop();hB(S,o)<.2*f&&(s[l]=T.join(" "),s[l+1]=S+" "+w),h-=1}}c=s.join("\n")}else c=i;c=hz(c,o),hN[u]=c}return c}(eT,eC,eR,eM);$.setText(eP),$.setFont(eC),$.setRotation(hO(hX(b,"layout","text-rotate",u,d,y)));var eO=hX(b,"layout","text-anchor",u,d,y),ei=q||1==c?"point":hX(b,"layout","symbol-placement",u,d,y);$.setPlacement(ei);var ek=hX(b,"paint","text-halo-width",u,d,y),eL=hX(b,"layout","text-offset",u,d,y),eD=hX(b,"paint","text-translate",u,d,y),ez=0,eF=0;if("point"==ei){var eB="center";-1!==eO.indexOf("left")?(eB="left",eF=ek):-1!==eO.indexOf("right")&&(eB="right",eF=-ek),$.setTextAlign(eB);var eN=hX(b,"layout","text-rotation-alignment",u,d,y);$.setRotateWithView("map"==eN)}else $.setMaxAngle(hO(hX(b,"layout","text-max-angle",u,d,y))*eT.length/eP.length),$.setTextAlign(),$.setRotateWithView(!1);var ej="middle";0==eO.indexOf("bottom")?(ej="bottom",ez=-ek-.5*(eI-1)*eS):0==eO.indexOf("top")&&(ej="top",ez=ek+.5*(eI-1)*eS),$.setTextBaseline(ej),$.setOffsetX(eL[0]*eS+eF+eD[0]),$.setOffsetY(eL[1]*eS+ez+eD[1]),R.setColor(hY(hX(b,"paint","text-color",u,d,y),C)),$.setFill(R);var eV=hY(hX(b,"paint","text-halo-color",u,d,y),C);if(eV){A.setColor(eV),ek*=2;var eU=.5*eS;A.setWidth(ek<=eU?ek:eU),$.setStroke(A)}else $.setStroke(void 0);var eG=hX(b,"layout","text-padding",u,d,y),eq=$.getPadding();eG!==eq[0]&&(eq[0]=eG,eq[1]=eG,eq[2]=eG,eq[3]=eG),L.setZIndex(D)}}}}(m,0);if(p>-1)return M.length=p+1,M}};return e.setStyle(P),e.set("mapbox-source",u),e.set("mapbox-layers",m),P}(e,o,i,void 0,l,h,h4),e.getStyle()?r():a(Error("Nothing to show for source [".concat(i,"]"))))}if(o.sprite){var l,h,u,c=.5==(window.devicePixelRatio>=1.5?.5:1)?"@2x":"",d=h9(o.sprite,n,c+".json");fetch(d,{credentials:"same-origin"}).then(function(e){return e.ok||""===c?e:fetch(d=h9(o.sprite,n,".json"),{credentials:"same-origin"})}).then(function(e){if(e.ok)return e.json();a(Error("Problem fetching sprite from ".concat(d,": ").concat(e.statusText)))}).then(function(e){if(void 0===e)return a(Error("No sprites found."));l=e,h=h9(o.sprite,n,c+".png"),s()}).catch(function(e){a(Error("Sprites cannot be loaded: ".concat(d,": ").concat(e.message)))})}else s()})).then(function(){e.setVisible(!0),l()},function(e){h(e)}):l()};e.set("mapbox-layers",i),-1===o.getLayers().getArray().indexOf(e)&&o.addLayer(e),e.getSource()?u():e.once("change:source",u)})}var uo={};uo=function(){var e,i,r;function n(n,o){if(e)if(i){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",s={};e(s),r=o(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else i=o;else e=o}return n(["exports"],function(e){let i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k,L,D,z,F,B,N,j,V,U,G,q;var $="undefined"!=typeof Float32Array?Float32Array:Array;function H(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=r*a-o*n;return s?(e[0]=a*(s=1/s),e[1]=-n*s,e[2]=-o*s,e[3]=r*s,e):null}function Z(){var e=new $(9);return $!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function W(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],u=i[7],c=i[8];return e[0]=s*c-l*u,e[1]=o*u-n*c,e[2]=n*l-o*s,e[3]=l*h-a*c,e[4]=r*c-o*h,e[5]=o*a-r*l,e[6]=a*u-s*h,e[7]=n*h-r*u,e[8]=r*s-n*a,e}function X(e,i,r){var n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=r[0],f=r[1],m=r[2],g=r[3],_=r[4],y=r[5],v=r[6],x=r[7],b=r[8];return e[0]=p*n+f*s+m*u,e[1]=p*o+f*l+m*c,e[2]=p*a+f*h+m*d,e[3]=g*n+_*s+y*u,e[4]=g*o+_*l+y*c,e[5]=g*a+_*h+y*d,e[6]=v*n+x*s+b*u,e[7]=v*o+x*l+b*c,e[8]=v*a+x*h+b*d,e}function Y(){var e=new $(16);return $!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function K(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function J(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],_=i[14],y=i[15],v=r*l-n*s,x=r*h-o*s,b=r*u-a*s,w=n*h-o*l,T=n*u-a*l,S=o*u-a*h,E=c*g-d*m,I=c*_-p*m,C=c*y-f*m,A=d*_-p*g,R=d*y-f*g,M=p*y-f*_,P=v*M-x*R+b*A+w*C-T*I+S*E;return P?(e[0]=(l*M-h*R+u*A)*(P=1/P),e[1]=(o*R-n*M-a*A)*P,e[2]=(g*S-_*T+y*w)*P,e[3]=(p*T-d*S-f*w)*P,e[4]=(h*C-s*M-u*I)*P,e[5]=(r*M-o*C+a*I)*P,e[6]=(_*b-m*S-y*x)*P,e[7]=(c*S-p*b+f*x)*P,e[8]=(s*R-l*C+u*E)*P,e[9]=(n*C-r*R-a*E)*P,e[10]=(m*T-g*b+y*v)*P,e[11]=(d*b-c*T-f*v)*P,e[12]=(l*I-s*A-h*E)*P,e[13]=(r*A-n*I+o*E)*P,e[14]=(g*x-m*w-_*v)*P,e[15]=(c*w-d*x+p*v)*P,e):null}function Q(e,i,r){var n=i[0],o=i[1],a=i[2],s=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],y=i[14],v=i[15],x=r[0],b=r[1],w=r[2],T=r[3];return e[0]=x*n+b*l+w*d+T*g,e[1]=x*o+b*h+w*p+T*_,e[2]=x*a+b*u+w*f+T*y,e[3]=x*s+b*c+w*m+T*v,e[4]=(x=r[4])*n+(b=r[5])*l+(w=r[6])*d+(T=r[7])*g,e[5]=x*o+b*h+w*p+T*_,e[6]=x*a+b*u+w*f+T*y,e[7]=x*s+b*c+w*m+T*v,e[8]=(x=r[8])*n+(b=r[9])*l+(w=r[10])*d+(T=r[11])*g,e[9]=x*o+b*h+w*p+T*_,e[10]=x*a+b*u+w*f+T*y,e[11]=x*s+b*c+w*m+T*v,e[12]=(x=r[12])*n+(b=r[13])*l+(w=r[14])*d+(T=r[15])*g,e[13]=x*o+b*h+w*p+T*_,e[14]=x*a+b*u+w*f+T*y,e[15]=x*s+b*c+w*m+T*v,e}function ee(e,i,r){var n,o,a,s,l,h,u,c,d,p,f,m,g=r[0],_=r[1],y=r[2];return i===e?(e[12]=i[0]*g+i[4]*_+i[8]*y+i[12],e[13]=i[1]*g+i[5]*_+i[9]*y+i[13],e[14]=i[2]*g+i[6]*_+i[10]*y+i[14],e[15]=i[3]*g+i[7]*_+i[11]*y+i[15]):(o=i[1],a=i[2],s=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=i[9],f=i[10],m=i[11],e[0]=n=i[0],e[1]=o,e[2]=a,e[3]=s,e[4]=l,e[5]=h,e[6]=u,e[7]=c,e[8]=d,e[9]=p,e[10]=f,e[11]=m,e[12]=n*g+l*_+d*y+i[12],e[13]=o*g+h*_+p*y+i[13],e[14]=a*g+u*_+f*y+i[14],e[15]=s*g+c*_+m*y+i[15]),e}function et(e,i,r){var n=r[0],o=r[1],a=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=i[7]*o,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=i[11]*a,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ei(e,i,r){var n=Math.sin(r),o=Math.cos(r),a=i[4],s=i[5],l=i[6],h=i[7],u=i[8],c=i[9],d=i[10],p=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=a*o+u*n,e[5]=s*o+c*n,e[6]=l*o+d*n,e[7]=h*o+p*n,e[8]=u*o-a*n,e[9]=c*o-s*n,e[10]=d*o-l*n,e[11]=p*o-h*n,e}function er(e,i,r){var n=Math.sin(r),o=Math.cos(r),a=i[0],s=i[1],l=i[2],h=i[3],u=i[8],c=i[9],d=i[10],p=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=a*o-u*n,e[1]=s*o-c*n,e[2]=l*o-d*n,e[3]=h*o-p*n,e[8]=a*n+u*o,e[9]=s*n+c*o,e[10]=l*n+d*o,e[11]=h*n+p*o,e}function en(e,i,r){var n=Math.sin(r),o=Math.cos(r),a=i[0],s=i[1],l=i[2],h=i[3],u=i[4],c=i[5],d=i[6],p=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=a*o+u*n,e[1]=s*o+c*n,e[2]=l*o+d*n,e[3]=h*o+p*n,e[4]=u*o-a*n,e[5]=c*o-s*n,e[6]=d*o-l*n,e[7]=p*o-h*n,e}function eo(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ea(e,i,r){var n,o,a,s=r[0],l=r[1],h=r[2],u=Math.hypot(s,l,h);return u<1e-6?null:(s*=u=1/u,l*=u,h*=u,n=Math.sin(i),o=Math.cos(i),e[0]=s*s*(a=1-o)+o,e[1]=l*s*a+h*n,e[2]=h*s*a-l*n,e[3]=0,e[4]=s*l*a-h*n,e[5]=l*l*a+o,e[6]=h*l*a+s*n,e[7]=0,e[8]=s*h*a+l*n,e[9]=l*h*a-s*n,e[10]=h*h*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function es(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=r+r,l=n+n,h=o+o,u=r*s,c=n*s,d=n*l,p=o*s,f=o*l,m=o*h,g=a*s,_=a*l,y=a*h;return e[0]=1-d-m,e[1]=c+y,e[2]=p-_,e[3]=0,e[4]=c-y,e[5]=1-u-m,e[6]=f+g,e[7]=0,e[8]=p+_,e[9]=f-g,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function el(){var e=new $(3);return $!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function eh(e){var i=new $(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}function eu(e){return Math.hypot(e[0],e[1],e[2])}function ec(e,i,r){var n=new $(3);return n[0]=e,n[1]=i,n[2]=r,n}function ed(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function ep(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e}function ef(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e}function em(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e}function eg(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e}function e_(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e}function ey(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e}function ev(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2];return r*r+n*n+o*o}function ex(e){var i=e[0],r=e[1],n=e[2];return i*i+r*r+n*n}function eb(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e}function ew(e,i){var r=i[0],n=i[1],o=i[2],a=r*r+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=i[0]*a,e[1]=i[1]*a,e[2]=i[2]*a,e}function eT(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]}function eS(e,i,r){var n=i[0],o=i[1],a=i[2],s=r[0],l=r[1],h=r[2];return e[0]=o*h-a*l,e[1]=a*s-n*h,e[2]=n*l-o*s,e}function eE(e,i,r,n){var o=i[0],a=i[1],s=i[2];return e[0]=o+n*(r[0]-o),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e}function eI(e,i,r){var n=i[0],o=i[1],a=i[2],s=r[3]*n+r[7]*o+r[11]*a+r[15];return e[0]=(r[0]*n+r[4]*o+r[8]*a+r[12])/(s=s||1),e[1]=(r[1]*n+r[5]*o+r[9]*a+r[13])/s,e[2]=(r[2]*n+r[6]*o+r[10]*a+r[14])/s,e}function eC(e,i,r){var n=i[0],o=i[1],a=i[2];return e[0]=n*r[0]+o*r[3]+a*r[6],e[1]=n*r[1]+o*r[4]+a*r[7],e[2]=n*r[2]+o*r[5]+a*r[8],e}function eA(e,i,r){var n=r[0],o=r[1],a=r[2],s=i[0],l=i[1],h=i[2],u=o*h-a*l,c=a*s-n*h,d=n*l-o*s,p=o*d-a*c,f=a*u-n*d,m=n*c-o*u,g=2*r[3];return c*=g,d*=g,f*=2,m*=2,e[0]=s+(u*=g)+(p*=2),e[1]=l+c+f,e[2]=h+d+m,e}function eR(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function eM(){var e=new $(4);return $!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function eP(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function eO(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=r*r+n*n+o*o+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=o*s,e[3]=a*s,e}function ek(e,i,r){var n=i[0],o=i[1],a=i[2],s=i[3];return e[0]=r[0]*n+r[4]*o+r[8]*a+r[12]*s,e[1]=r[1]*n+r[5]*o+r[9]*a+r[13]*s,e[2]=r[2]*n+r[6]*o+r[10]*a+r[14]*s,e[3]=r[3]*n+r[7]*o+r[11]*a+r[15]*s,e}function eL(){var e=new $(4);return $!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function eD(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ez(e,i,r){r*=.5;var n=i[0],o=i[1],a=i[2],s=i[3],l=Math.sin(r),h=Math.cos(r);return e[0]=n*h+s*l,e[1]=o*h+a*l,e[2]=a*h-o*l,e[3]=s*h-n*l,e}function eF(e,i,r){r*=.5;var n=i[0],o=i[1],a=i[2],s=i[3],l=Math.sin(r),h=Math.cos(r);return e[0]=n*h-a*l,e[1]=o*h+s*l,e[2]=a*h+n*l,e[3]=s*h-o*l,e}Math.hypot||(Math.hypot=function(){for(var e=0,i=arguments.length;i--;)e+=arguments[i]*arguments[i];return Math.sqrt(e)}),el(),eM();var eB,eN,ej,eV,eU,eG=(eB=el(),eN=ec(1,0,0),ej=ec(0,1,0),function(e,i,r){var n,o,a=eT(i,r);return a<-.999999?(eS(eB,eN,i),1e-6>eu(eB)&&eS(eB,ej,i),ew(eB,eB),o=Math.sin(n=.5*Math.PI),e[0]=o*eB[0],e[1]=o*eB[1],e[2]=o*eB[2],e[3]=Math.cos(n),e):a>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(eS(eB,i,r),e[0]=eB[0],e[1]=eB[1],e[2]=eB[2],e[3]=1+a,eO(e,e))});function eq(){var e=new $(2);return $!=Float32Array&&(e[0]=0,e[1]=0),e}function e$(e,i){var r=new $(2);return r[0]=e,r[1]=i,r}function eH(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e}function eZ(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e}function eW(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e}function eX(e){return Math.hypot(e[0],e[1])}function eY(e,i){var r=i[0],n=i[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=i[0]*o,e[1]=i[1]*o,e}function eK(e,i){return e[0]*i[0]+e[1]*i[1]}function eJ(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}eL(),eL(),Z(),eq();var eQ,e0,e1=eJ(function(){if(eU)return eV;function e(e,i,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(n-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=r,this.p2y=n}return eU=1,eV=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(void 0===i&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var o=this.sampleCurveX(r)-e;if(Math.abs(o)<i)return r;var a=this.sampleCurveDerivativeX(r);if(1e-6>Math.abs(a))break;r-=o/a}var s=0,l=1;for(r=e,n=0;n<20&&!(Math.abs((o=this.sampleCurveX(r))-e)<i);n++)e>o?s=r:l=r,r=.5*(l-s)+s;return r},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},eV}());function e2(){if(e0)return eQ;function e(e,i){this.x=e,this.y=i}return e0=1,eQ=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,r=e.y-this.y;return i*i+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),r=Math.sin(e),n=r*this.x+i*this.y;return this.x=i*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,i){var r=Math.cos(e),n=Math.sin(e),o=i.y+n*(this.x-i.x)+r*(this.y-i.y);return this.x=i.x+r*(this.x-i.x)-n*(this.y-i.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(i){return i instanceof e?i:Array.isArray(i)?new e(i[0],i[1]):i},eQ}var e3=eJ(e2());function e5(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!e5(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i||Object.keys(e).length!==Object.keys(i).length)return!1;for(let r in e)if(!e5(e[r],i[r]))return!1;return!0}return e===i}let e4=Math.PI/180,e6=180/Math.PI,e8=[[0,0],[1,0],[1,1],[0,1]];function e9(e){if(e<=0)return 0;if(e>=1)return 1;let i=e*e,r=i*e;return 4*(e<.5?r:3*(e-i)+r-.75)}function e7(e,i,r,n){let o=new e1(e,i,r,n);return function(e){return o.solve(e)}}let te=e7(.25,.1,.25,1);function tt(e,i,r){return Math.min(r,Math.max(i,e))}function ti(e,i,r){return(r=tt((r-e)/(i-e),0,1))*r*(3-2*r)}function tr(e,i,r){let n=r-i,o=((e-i)%n+n)%n+i;return o===i?r:o}function tn(e,i,r){if(!e.length)return r(null,[]);let n=e.length,o=Array(e.length),a=null;e.forEach((e,s)=>{i(e,(e,i)=>{e&&(a=e),o[s]=i,0==--n&&r(a,o)})})}function to(e,...i){for(let r of i)for(let i in r)e[i]=r[i];return e}let ta=1;function ts(){return ta++}function tl(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function th(e,i){e.forEach(e=>{i[e]&&(i[e]=i[e].bind(i))})}function tu(e,i,r){let n={};for(let r in e)n[r]=i.call(this,e[r],r,e);return n}function tc(e,i,r){let n={};for(let r in e)i.call(this,e[r],r,e)&&(n[r]=e[r]);return n}function td(e){return Array.isArray(e)?e.map(td):"object"==typeof e&&e?tu(e,td):e}let tp={};function tf(e){tp[e]||("undefined"!=typeof console&&console.warn(e),tp[e]=!0)}function tm(e,i,r){return(r.y-e.y)*(i.x-e.x)>(i.y-e.y)*(r.x-e.x)}function tg([e,i,r]){let n=(i+90)*e4,o=r*e4;return{x:e*Math.cos(n)*Math.sin(o),y:e*Math.sin(n)*Math.sin(o),z:e*Math.cos(o),azimuthal:i,polar:r}}function t_(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function ty(e){let i={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,r,n,o)=>{let a=n||o;return i[r]=!a||a.toLowerCase(),""}),i["max-age"]){let e=parseInt(i["max-age"],10);isNaN(e)?delete i["max-age"]:i["max-age"]=e}return i}let tv=null;function tx(e,i){return[e[4*i],e[4*i+1],e[4*i+2],e[4*i+3]]}function tb(e,i,r,n){for(;i<r;){let o=i+r>>1;e[o]<n?i=o+1:r=o}return i}function tw(e,i,r,n){for(;i<r;){let o=i+r>>1;e[o]<=n?i=o+1:r=o}return i}function tT(e){return e>0?1/(1.001-e):1+e}function tS(e){return e>0?1-1/(1.001-e):-e}function tE(e,i,r){return(e-i.min)*(r.max-r.min)/(i.max-i.min)+r.min}let tI={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!tI.API_URL)return null;try{let e=new URL(tI.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function tC(e){return tI.API_URL_REGEX.test(e)}function tA(e){return tI.API_SPRITE_REGEX.test(e)}function tR(){return null==i&&(i=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),i}let tM={now:()=>void 0!==o?o:performance.now(),setNow(e){o=e},restoreNow(){o=void 0},frame(e){let i=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(e,i=0){let{width:r,height:n}=e;a||(a=document.createElement("canvas"));let o=a.getContext("2d",{willReadFrequently:!0});if(!o)throw Error("failed to create canvas 2d context");return(r>a.width||n>a.height)&&(a.width=r,a.height=n),o.clearRect(-i,-i,r+2*i,n+2*i),o.drawImage(e,0,0,r,n),o.getImageData(-i,-i,r+2*i,n+2*i)},resolveURL:e=>(r||(r=document.createElement("a")),r.href=e,r.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==n&&(n=window.matchMedia("(prefers-reduced-motion: reduce)")),n.matches)},hasCanvasFingerprintNoise(){if(void 0!==s)return s;if(!tR())return s=!1,!1;let e=new OffscreenCanvas(85,1),i=e.getContext("2d",{willReadFrequently:!0}),r=0;for(let n=0;n<e.width;++n)i.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,i.fillRect(n,0,1,1);let n=i.getImageData(0,0,e.width,e.height);r=0;for(let e=0;e<n.data.length;++e)if(e%4!=3&&r++!==n.data[e])return s=!0,!0;return s=!1,!1}};function tP(e,i){let r=e.indexOf("?");if(r<0)return`${e}?${new URLSearchParams(i).toString()}`;let n=new URLSearchParams(e.slice(r));for(let e in i)n.set(e,i[e]);return`${e.slice(0,r)}?${n.toString()}`}function tO(e,i={persistentParams:[]}){let r=e.indexOf("?");if(r<0)return e;let n=new URLSearchParams,o=new URLSearchParams(e.slice(r));for(let e of i.persistentParams){let i=o.get(e);i&&n.set(e,i)}let a=n.toString();return`${e.slice(0,r)}${a.length>0?`?${a}`:""}`}let tk="mapbox-tiles",tL=500,tD=50,tz=["language","worldview","jobid"];function tF(){try{return caches}catch(e){}}function tB(){let e=tF();e&&null==l&&(l=e.open(tk))}let tN=1/0,tj={supported:!1,testSupport:function(e){!tG&&tU&&(tq?tH(e):tV=e)}},tV,tU,tG=!1,tq=!1,t$="undefined"!=typeof self?self:{};function tH(e){let i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,tU),e.isContextLost())return;tj.supported=!0}catch(e){}e.deleteTexture(i),tG=!0}t$.document&&((tU=t$.document.createElement("img")).onload=function(){tV&&tH(tV),tV=null,tq=!0},tU.onerror=function(){tG=!0,tV=null},tU.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let tZ={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(tZ);class tW extends Error{constructor(e,i,r){401===i&&tC(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let tX=t_()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,tY=function(e,i){var r;if(!(/^file:/.test(r=e.url)||/^file:/.test(tX())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,i){var r;let n=new AbortController,o=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:tX(),referrerPolicy:e.referrerPolicy,signal:n.signal}),a=!1,s=!1,u=(r=o.url).indexOf("sku=")>0&&tC(r);"json"===e.type&&o.headers.set("Accept","application/json");let c=(r,n,a)=>{if(s)return;if(r&&"SecurityError"!==r.message&&tf(r.toString()),n&&a)return d(n);let l=Date.now();fetch(o).then(r=>{if(r.ok){let e=u?r.clone():null;return d(r,e,l)}return i(new tW(r.statusText,r.status,e.url))}).catch(r=>{"AbortError"!==r.name&&i(Error(`${r.message} ${e.url}`))})},d=(r,n,u)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then(e=>{s||(n&&u&&function(e,i,r){if(tB(),null==l)return;let n=ty(i.headers.get("Cache-Control")||"");if(n["no-store"])return;let o={status:i.status,statusText:i.statusText,headers:new Headers};i.headers.forEach((e,i)=>o.headers.set(i,e)),n["max-age"]&&o.headers.set("Expires",new Date(r+1e3*n["max-age"]).toUTCString());let a=o.headers.get("Expires");if(!a||new Date(a).getTime()-r<42e4)return;let s=tO(e.url,{persistentParams:tz});if(206===i.status){let i=e.headers.get("Range");if(!i)return;o.status=200,s=tP(s,{range:i})}var u=e=>{var r;let n=new Response(200!==(r=i.status)&&404!==r&&[101,103,204,205,304].includes(r)?null:e,o);tB(),null!=l&&l.then(e=>e.put(s,n)).catch(e=>tf(e.message))};if(void 0===h)try{new Response(new ReadableStream),h=!0}catch(e){h=!1}h?u(i.body):i.blob().then(u).catch(e=>tf(e.message))}(o,n,u),a=!0,i(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))}).catch(e=>{s||i(Error(e.message))})};return u?function(e,i){if(tB(),null==l)return i(null);l.then(r=>{let n=tO(e.url,{persistentParams:tz}),o=e.headers.get("Range");o&&(n=tP(n,{range:o})),r.match(n).then(e=>{let o=function(e){if(!e)return!1;let i=new Date(e.headers.get("Expires")||0),r=ty(e.headers.get("Cache-Control")||"");return Number(i)>Date.now()&&!r["no-cache"]}(e);r.delete(n).catch(i),o&&r.put(n,e.clone()).catch(i),i(null,e,o)}).catch(i)}).catch(i)}(o,c):c(null,null),{cancel:()=>{s=!0,a||n.abort()}}}(e,i);if(t_(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,i,void 0,!0)}let n=new XMLHttpRequest;for(let i in n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{i(Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return i(e)}i(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else i(new tW(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}},tK=function(e,i){return tY(to(e,{type:"arrayBuffer"}),i)},tJ="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";u=[],c=0;let tQ=function(e,i){if(tj.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),c>=tI.MAX_PARALLEL_IMAGE_REQUESTS){let r={requestParameters:e,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return u.push(r),r}c++;let r=!1,n=()=>{if(!r)for(r=!0,c--;u.length&&c<tI.MAX_PARALLEL_IMAGE_REQUESTS;){let e=u.shift(),{requestParameters:i,callback:r,cancelled:n}=e;n||(e.cancel=tQ(i,r).cancel)}},o=tK(e,(e,r,o,a)=>{var s;n(),e?i(e):r&&(self.createImageBitmap?(s=(e,r)=>i(e,r,o,a),createImageBitmap(new Blob([new Uint8Array(r)],{type:"image/png"})).then(e=>{s(null,e)}).catch(e=>{s(Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})):function(e,i){let r=new Image;r.onload=()=>{i(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame(()=>{r.src=tJ})},r.onerror=()=>i(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let n=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(n):tJ}(r,(e,r)=>i(e,r,o,a)))});return{cancel:()=>{o.cancel(),n()}}};var t0,t1,t2,t3={exports:{}},t5={exports:{}},t4={exports:{}},t6=eJ(function(){if(t2)return t3.exports;t2=1;var e=(t0||(t0=1,t5.exports=function(e,i){var r,n,o,a,s,l;for(n=e.length-(r=3&e.length),o=i,l=0;l<n;)s=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,o=27492+(65535&(a=5*(65535&(o=(o^=s=(65535&(s=(s=(65535&s)*0xcc9e2d51+(((s>>>16)*0xcc9e2d51&65535)<<16)|0)<<15|s>>>17))*0x1b873593+(((s>>>16)*0x1b873593&65535)<<16)|0)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)|0))+((58964+(a>>>16)&65535)<<16);switch(s=0,r){case 3:s^=(255&e.charCodeAt(l+2))<<16;case 2:s^=(255&e.charCodeAt(l+1))<<8;case 1:o^=s=(65535&(s=(s=(65535&(s^=255&e.charCodeAt(l)))*0xcc9e2d51+(((s>>>16)*0xcc9e2d51&65535)<<16)|0)<<15|s>>>17))*0x1b873593+(((s>>>16)*0x1b873593&65535)<<16)|0}return o^=e.length,o=0x85ebca6b*(65535&(o^=o>>>16))+((0x85ebca6b*(o>>>16)&65535)<<16)|0,o=0xc2b2ae35*(65535&(o^=o>>>13))+((0xc2b2ae35*(o>>>16)&65535)<<16)|0,(o^=o>>>16)>>>0}),t5.exports),i=(t1||(t1=1,t4.exports=function(e,i){for(var r,n=e.length,o=i^n,a=0;n>=4;)r=0x5bd1e995*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((0x5bd1e995*(r>>>16)&65535)<<16),o=0x5bd1e995*(65535&o)+((0x5bd1e995*(o>>>16)&65535)<<16)^(r=0x5bd1e995*(65535&(r^=r>>>24))+((0x5bd1e995*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:o^=(255&e.charCodeAt(a+2))<<16;case 2:o^=(255&e.charCodeAt(a+1))<<8;case 1:o=0x5bd1e995*(65535&(o^=255&e.charCodeAt(a)))+((0x5bd1e995*(o>>>16)&65535)<<16)}return o=0x5bd1e995*(65535&(o^=o>>>13))+((0x5bd1e995*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0}),t4.exports);return t3.exports=e,t3.exports.murmur3=e,t3.exports.murmur2=i,t3.exports}());class t8{constructor(e,...i){to(this,i[0]||{}),this.type=e}}class t9 extends t8{constructor(e,i={}){super("error",to({error:e},i))}}function t7(e,i,r){r[e]&&-1!==r[e].indexOf(i)||(r[e]=r[e]||[],r[e].push(i))}function ie(e,i,r){if(r&&r[e]){let n=r[e].indexOf(i);-1!==n&&r[e].splice(n,1)}}class it{on(e,i){return this._listeners=this._listeners||{},t7(e,i,this._listeners),this}off(e,i){return ie(e,i,this._listeners),ie(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},t7(e,i,this._oneTimeListeners),this):new Promise(i=>{this.once(e,i)})}fire(e,i){let r="string"==typeof e?new t8(e,i):e,n=r.type;if(this.listens(n)){for(let e of(r.target=this,this._listeners&&this._listeners[n]?this._listeners[n].slice():[]))e.call(this,r);for(let e of this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[])ie(n,e,this._oneTimeListeners),e.call(this,r);let e=this._eventedParent;e&&(to(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),e.fire(r))}else r instanceof t9&&console.error(r.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ii{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ii(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){let[i,r]=e.split("\x1f");return new ii({name:i,iconsetId:r})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ii.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var ir,io={},ia=function(){if(ir)return io;ir=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return i("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function n(e){var i;return(i="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:i>1?1:i}function o(e,i,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(i-e)*r*6:2*r<1?i:3*r<2?e+(i-e)*(2/3-r)*6:e}try{io.parseCSSColor=function(a){var s,l=a.replace(/ /g,"").toLowerCase();if(l in e)return e[l].slice();if("#"===l[0])return 4===l.length?(s=parseInt(l.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:7===l.length&&(s=parseInt(l.substr(1),16))>=0&&s<=0xffffff?[(0xff0000&s)>>16,(65280&s)>>8,255&s,1]:null;var h=l.indexOf("("),u=l.indexOf(")");if(-1!==h&&u+1===l.length){var c=l.substr(0,h),d=l.substr(h+1,u-(h+1)).split(","),p=1;switch(c){case"rgba":if(4!==d.length)break;p=n(d.pop());case"rgb":return 3!==d.length?null:[r(d[0]),r(d[1]),r(d[2]),p];case"hsla":if(4!==d.length)break;p=n(d.pop());case"hsl":if(3!==d.length)break;var f=(parseFloat(d[0])%360+360)%360/360,m=n(d[1]),g=n(d[2]),_=g<=.5?g*(m+1):g+m-g*m,y=2*g-_;return[i(255*o(y,_,f+1/3)),i(255*o(y,_,f)),i(255*o(y,_,f-1/3)),p]}}return null}}catch(e){}return io}();class is{constructor(e,i,r,n=1){this.r=e,this.g=i,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof is)return e;if("string"!=typeof e)return;let i=ia.parseCSSColor(e);return i?new is(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){let[e,i,r,n]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${n})`}toString(){let[e,i,r,n]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*r)},${n})`}toRenderColor(e){let{r:i,g:r,b:n,a:o}=this;return new il(e,i,r,n,o)}clone(){return new is(this.r,this.g,this.b,this.a)}}class il{constructor(e,i,r,n,o){if(e){let a=e.image.height,s=a*a;i=0===o?0:i/o*(a-1),r=0===o?0:r/o*(a-1),n=0===o?0:n/o*(a-1);let l=Math.floor(i),h=Math.floor(r),u=Math.floor(n),c=Math.ceil(i),d=Math.ceil(r),p=Math.ceil(n),f=i-l,m=r-h,g=n-u,_=e.image.data,y=4*(l+h*s+u*a),v=4*(l+h*s+p*a),x=4*(l+d*s+u*a),b=4*(l+d*s+p*a),w=4*(c+h*s+u*a),T=4*(c+h*s+p*a),S=4*(c+d*s+u*a),E=4*(c+d*s+p*a);if(y<0||E>=_.length)throw Error("out of range");this.r=ih(ih(ih(_[y],_[v],g),ih(_[x],_[b],g),m),ih(ih(_[w],_[T],g),ih(_[S],_[E],g),m),f)/255*o,this.g=ih(ih(ih(_[y+1],_[v+1],g),ih(_[x+1],_[b+1],g),m),ih(ih(_[w+1],_[T+1],g),ih(_[S+1],_[E+1],g),m),f)/255*o,this.b=ih(ih(ih(_[y+2],_[v+2],g),ih(_[x+2],_[b+2],g),m),ih(ih(_[w+2],_[T+2],g),ih(_[S+2],_[E+2],g),m),f)/255*o,this.a=o}else this.r=i,this.g=r,this.b=n,this.a=o}toArray(){let{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*i/n,255*r/n,n]}toHslaArray(){if(0===this.a)return[0,0,0,0];let{r:e,g:i,b:r,a:n}=this,o=Math.min(Math.max(e/n,0),1),a=Math.min(Math.max(i/n,0),1),s=Math.min(Math.max(r/n,0),1),l=Math.min(o,a,s),h=Math.max(o,a,s),u=(l+h)/2;if(l===h)return[0,0,100*u,n];let c=h-l,d=0;return h===o?d=(a-s)/c+6*(a<s):h===a?d=(s-o)/c+2:h===s&&(d=(o-a)/c+4),[Math.min(Math.max(d*=60,0),360),Math.min(Math.max(100*(u>.5?c/(2-h-l):c/(h+l)),0),100),Math.min(Math.max(100*u,0),100),n]}toArray01(){let{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,i/n,r/n,n]}toArray01Scaled(e){let{r:i,g:r,b:n,a:o}=this;return 0===o?[0,0,0]:[i/o*e,r/o*e,n/o*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:r,a:n}=this;return[e,i,r,n]}toArray01Linear(){let{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(e/n,2.2),Math.pow(i/n,2.2),Math.pow(r/n,2.2),n]}}function ih(e,i,r){return e*(1-r)+i*r}function iu(e,i,r){return e.map((e,n)=>ih(e,i[n],r))}function ic(e){return e*e*e*e*e}is.black=new is(0,0,0,1),is.white=new is(1,1,1,1),is.transparent=new is(0,0,0,0),is.red=new is(1,0,0,1),is.blue=new is(0,0,1,1);var id=Object.freeze({__proto__:null,array:iu,color:function(e,i,r){return new is(ih(e.r,i.r,r),ih(e.g,i.g,r),ih(e.b,i.b,r),ih(e.a,i.a,r))},easeIn:ic,number:ih});function ip(e,...i){for(let r of i)for(let i in r)e[i]=r[i];return e}class im extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ig{constructor(e,i=[]){for(let[r,n]of(this.parent=e,this.bindings={},i))this.bindings[r]=n}concat(e){return new ig(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let i_={kind:"null"},iy={kind:"number"},iv={kind:"string"},ix={kind:"boolean"},ib={kind:"color"},iw={kind:"object"},iT={kind:"value"},iS={kind:"collator"},iE={kind:"formatted"},iI={kind:"resolvedImage"};function iC(e,i){return{kind:"array",itemType:e,N:i}}function iA(e){if("array"===e.kind){let i=iA(e.itemType);return"number"==typeof e.N?`array<${i}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${i}>`}return e.kind}let iR=[i_,iy,iv,ix,ib,iE,iw,iC(iT),iI];function iM(e,i){if("error"===i.kind)return null;if("array"===e.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!iM(e.itemType,i.itemType))&&("number"!=typeof e.N||e.N===i.N))return null}else{if(e.kind===i.kind)return null;if("value"===e.kind){for(let e of iR)if(!iM(e,i))return null}}return`Expected ${iA(e)} but found ${iA(i)} instead.`}function iP(e,i){return i.some(i=>i.kind===e.kind)}function iO(e,i){return i.some(i=>"null"===i?null===e:"array"===i?Array.isArray(e):"object"===i?e&&!Array.isArray(e)&&"object"==typeof e:i===typeof e)}class ik{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class iL{constructor(e,i,r,n,o){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=n,this.textColor=o}}class iD{constructor(e){this.sections=e}static fromString(e){return new iD([new iL(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof iD?e:iD.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){let r=i.image.getPrimary().id.toString();e.push(["image",r]);continue}e.push(i.text);let r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(r)}return e}}class iz{constructor(e,i={}){if(this.id=ii.from(e),this.options=Object.assign({},i),i.transform){let{a:e,b:r,c:n,d:o,e:a,f:s}=i.transform;this.options.transform=new DOMMatrix([e,r,n,o,a,s])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){let{a:e,b:i,c:r,d:n,e:o,f:a}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:r,d:n,e:o,f:a}})}static parse(e){let i,r,n,o;try{({name:i,iconsetId:r,params:n,transform:o}=JSON.parse(e)||{})}catch(e){return null}if(!i)return null;let{a:a,b:s,c:l,d:h,e:u,f:c}=o||{};return new iz({name:i,iconsetId:r},{params:n,transform:new DOMMatrix([a,s,l,h,u,c])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class iF{constructor(e,i,r,n,o=!1){this.primaryId=ii.from(e),this.primaryOptions=i,r&&(this.secondaryId=ii.from(r)),this.secondaryOptions=n,this.available=o}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new iz(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new iz(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?iF.build({name:e}):e}static build(e,i,r,n){return e&&("object"!=typeof e||"name"in e)?new iF(e,r,i,n):null}}function iB(e,i,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,i,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,i,r,n]:[e,i,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function iN(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof is||e instanceof ik||e instanceof iD||e instanceof iF)return!0;if(Array.isArray(e)){for(let i of e)if(!iN(i))return!1;return!0}if("object"==typeof e){for(let i in e)if(!iN(e[i]))return!1;return!0}return!1}function ij(e){if(null===e)return i_;if("string"==typeof e)return iv;if("boolean"==typeof e)return ix;if("number"==typeof e)return iy;if(e instanceof is)return ib;if(e instanceof ik)return iS;if(e instanceof iD)return iE;if(e instanceof iF)return iI;if(Array.isArray(e)){let i,r=e.length;for(let r of e){let e=ij(r);if(i){if(i===e)continue;i=iT;break}i=e}return iC(i||iT,r)}return iw}function iV(e){let i=typeof e;return null===e?"":"string"===i||"number"===i||"boolean"===i?String(e):e instanceof is?e.toStringPremultipliedAlpha():e instanceof iD||e instanceof iF?e.toString():JSON.stringify(e)}class iU{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!iN(e[1]))return i.error("invalid value");let r=e[1],n=ij(r),o=i.expectedType;return"array"===n.kind&&0===n.N&&o&&"array"===o.kind&&("number"!=typeof o.N||0===o.N)&&(n=o),new iU(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof is?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof iD?this.value.serialize():this.value}}class iG{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let iq={string:iv,number:iy,boolean:ix,object:iw};class i${constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,n=1,o=e[0];if("array"===o){let o,a;if(e.length>2){let r=e[1];if("string"!=typeof r||!(r in iq)||"object"===r)return i.error('The item type argument of "array" must be one of string, number, boolean',1);o=iq[r],n++}else o=iT;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);a=e[2],n++}r=iC(o,a)}else r=iq[o];let a=[];for(;n<e.length;n++){let r=i.parse(e[n],n,iT);if(!r)return null;a.push(r)}return new i$(r,a)}evaluate(e){for(let i=0;i<this.args.length;i++){let r=this.args[i].evaluate(e);if(!iM(this.type,ij(r)))return r;if(i===this.args.length-1)throw new iG(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${iA(ij(r))} but was expected to be of type ${iA(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if("array"===e.kind){let r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);let n=e.N;("number"==typeof n||this.args.length>1)&&i.push(n)}}return i.concat(this.args.map(e=>e.serialize()))}}class iH{constructor(e){this.type=iE,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");let n=[],o=!1;for(let r=1;r<=e.length-1;++r){let a=e[r];if(o&&"object"==typeof a&&!Array.isArray(a)){o=!1;let e=null;if(a["font-scale"]&&!(e=i.parseObjectValue(a["font-scale"],r,"font-scale",iy)))return null;let s=null;if(a["text-font"]&&!(s=i.parseObjectValue(a["text-font"],r,"text-font",iC(iv))))return null;let l=null;if(a["text-color"]&&!(l=i.parseObjectValue(a["text-color"],r,"text-color",ib)))return null;let h=n[n.length-1];h.scale=e,h.font=s,h.textColor=l}else{let a=i.parse(e[r],r,iT);if(!a)return null;let s=a.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,n.push({content:a,scale:null,font:null,textColor:null})}}return new iH(n)}evaluate(e){return new iD(this.sections.map(i=>{let r=i.content.evaluate(e);return ij(r)===iI?new iL("",r,null,null,null):new iL(iV(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class iZ{constructor(e,i,r,n){this._imageWarnHistory={},this.type=iI,this.namePrimary=e,this.nameSecondary=i,r&&(this.paramsPrimary=r.params,this.iconsetIdPrimary=r.iconset?r.iconset.id:void 0),n&&(this.paramsSecondary=n.params,this.iconsetIdSecondary=n.iconset?n.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let r=1,n=[];for(let o=0;o<2;o++)if(!function(){if(r<e.length){let o=i.parse(e[r],r++,iv);return o?(n.push({image:o,options:{}}),!0):(i.error(n.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}()||!function(){if(r<e.length){let o=e[r];if(null===o||"object"!=typeof o||Array.isArray(o))return!0;let a=o.params,s=o.iconset,l=i.concat(r);if(!a&&!s)return r++,!0;if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "params" should be an object'),!1;let e={},i=l.concat(void 0,"params");for(let r in a){if(!r)return i.error("Image parameter name should be non-empty"),!1;let n=i.concat(void 0,r).parse(a[r],void 0,ib,void 0,{typeAnnotation:"coerce"});if(!n)return!1;e[r]=n}n[n.length-1].options.params=e}if(s){if("object"!=typeof s||s.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!s.id)return l.error('Image options "iconset" should have an "id" property'),!1;n[n.length-1].options.iconset=s}return r++,!0}return!0}())return;return new iZ(n[0].image,n[1]?n[1].image:void 0,n[0].options,n[1]?n[1].options:void 0)}evaluateParams(e,i){let r={};if(i){for(let n in i)if(i[n])try{r[n]=i[n].evaluate(e)}catch(e){continue}if(0!==Object.keys(r).length)return{params:r}}}evaluate(e){let i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},r=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,n=iF.build(i,r,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(n&&e.availableImages){let i=n.getPrimary().id;if(n.available=e.availableImages.some(e=>ii.isEqual(e,i)),n.available){let i=n.getSecondary()?n.getSecondary().id:null;i&&(n.available=e.availableImages.some(e=>ii.isEqual(e,i)))}}return n}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(let i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(let i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){let r={};if(i&&(r.iconset={id:i}),e)for(let i in r.params={},e)e[i]&&(r.params[i]=e[i].serialize());return Object.keys(r).length>0?r:void 0}serialize(){let e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){let i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){let i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function iW(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}let iX={"to-boolean":ix,"to-color":ib,"to-number":iy,"to-string":iv};class iY{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r=e[0],n=[],o=i_;if("to-array"===r){if(!Array.isArray(e[1]))return null;let r=e[1].length;if(i.expectedType){if("array"!==i.expectedType.kind)return i.error(`Expected ${i.expectedType.kind} but found array.`);o=iC(i.expectedType.itemType,r)}else{if(!(r>0&&iN(e[1][0])))return null;o=iC(ij(e[1][0]),r)}for(let a=0;a<r;a++){let r,s=e[1][a];if("array"===iW(s))r=i.parse(s,void 0,o.itemType);else{let e=iW(s);if(e!==o.itemType.kind)return i.error(`Expected ${o.itemType.kind} but found ${e}.`);r=i.registry.literal.parse(["literal",void 0===s?null:s],i)}if(!r)return null;n.push(r)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");o=iX[r];for(let r=1;r<e.length;r++){let o=i.parse(e[r],r,iT);if(!o)return null;n.push(o)}}return new iY(o,n)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,r;for(let n of this.args){if(i=n.evaluate(e),r=null,i instanceof is)return i;if("string"==typeof i){let r=e.parseColor(i);if(r)return r}else if(Array.isArray(i)&&!(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:iB(i[0],i[1],i[2],i[3])))return new is(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new iG(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(let r of this.args){if(null===(i=r.evaluate(e)))return 0;let n=Number(i);if(!isNaN(n))return n}throw new iG(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?iD.fromString(iV(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?iF.build(iV(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(i=>i.evaluate(e)):iV(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new iH([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new iZ(this.args[0]).serialize();let e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}let iK=["Unknown","Point","LineString","Polygon"];class iJ{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?iK[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*i-e[0])+this.featureDistanceData.bearing[1]*(n*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=is.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class iQ{constructor(e,i,r,n,o){this.name=e,this.type=i,this._evaluate=r,this.args=n,this._overloadIndex=o}evaluate(e){if(!this._evaluate){let e=iQ.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let r=e[0],n=iQ.definitions[r];if(!n)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);let o=Array.isArray(n)?n[0]:n.type,a=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=[],l=null,h=-1;for(let[n,u]of a){if(Array.isArray(n)&&n.length!==e.length-1)continue;s.push(n),h++,l=new rU(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let a=[],c=!1;for(let i=1;i<e.length;i++){let r=e[i],o=Array.isArray(n)?n[i-1]:n.type,s=l.parse(r,1+a.length,o);if(!s){c=!0;break}a.push(s)}if(!c)if(Array.isArray(n)&&n.length!==a.length)l.error(`Expected ${n.length} arguments, but found ${a.length} instead.`);else{for(let e=0;e<a.length;e++){let i=Array.isArray(n)?n[e]:n.type,r=a[e];l.concat(e+1).checkSubtype(i,r.type)}if(0===l.errors.length)return new iQ(r,o,u,a,h)}}if(1===s.length)i.errors.push(...l.errors);else{let r=(s.length?s:a.map(([e])=>e)).map(i0).join(" | "),n=[];for(let r=1;r<e.length;r++){let o=i.parse(e[r],1+n.length);if(!o)return null;n.push(iA(o.type))}i.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,i){for(let r in iQ.definitions=i,i)e[r]=iQ}}function i0(e){return Array.isArray(e)?`(${e.map(iA).join(", ")})`:`(${iA(e.type)}...)`}class i1{constructor(e,i,r){this.type=iS,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");let r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");let n=void 0===r["case-sensitive"]?i.parse(!1,1,ix):i.parseObjectValue(r["case-sensitive"],1,"case-sensitive",ix);if(!n)return null;let o=void 0===r["diacritic-sensitive"]?i.parse(!1,1,ix):i.parseObjectValue(r["diacritic-sensitive"],1,"diacritic-sensitive",ix);if(!o)return null;let a=null;return!r.locale||(a=i.parseObjectValue(r.locale,1,"locale",iv))?new i1(n,o,a):null}evaluate(e){return new ik(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function i2(e,i,r){let n=e[i];e[i]=e[r],e[r]=n}function i3(e,i){e[0]=Math.min(e[0],i[0]),e[1]=Math.min(e[1],i[1]),e[2]=Math.max(e[2],i[0]),e[3]=Math.max(e[3],i[1])}function i5(e,i){return!(e[0]<=i[0]||e[2]>=i[2]||e[1]<=i[1]||e[3]>=i[3])}function i4(e,i,r=!1){let n=!1;for(let o=0,a=i.length;o<a;o++){let a=i[o];for(let i=0,o=a.length,s=o-1;i<o;s=i++){let o=a[s],l=a[i];if(function(e,i,r){let n=e[0]-i[0],o=e[1]-i[1],a=e[0]-r[0],s=e[1]-r[1];return n*s-a*o==0&&n*a<=0&&o*s<=0}(e,o,l))return r;o[1]>e[1]!=l[1]>e[1]&&e[0]<(l[0]-o[0])*(e[1]-o[1])/(l[1]-o[1])+o[0]&&(n=!n)}}return n}function i6(e,i,r,n){let o=n[0]-r[0],a=n[1]-r[1],s=(e[0]-r[0])*a-o*(e[1]-r[1]),l=(i[0]-r[0])*a-o*(i[1]-r[1]);return s>0&&l<0||s<0&&l>0}function i8(e,i,r,n){var o,a;return 0!=(o=[n[0]-r[0],n[1]-r[1]])[0]*(a=[i[0]-e[0],i[1]-e[1]])[1]-o[1]*a[0]&&!(!i6(e,i,r,n)||!i6(r,n,e,i))}function i9(e){let i=new e3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new e3(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n of e[0])i.x>n.x&&(i.x=n.x),i.y>n.y&&(i.y=n.y),r.x<n.x&&(r.x=n.x),r.y<n.y&&(r.y=n.y);return{min:i,max:r}}function i7(e,i){for(let r=0;r<e.length;++r)if(!i4(e[r],i))return!1;for(let r=0;r<e.length-1;++r)if(function(e,i,r){for(let n of r)for(let r=0,o=n.length,a=o-1;r<o;a=r++)if(i8(e,i,n[a],n[r]))return!0;return!1}(e[r],e[r+1],i))return!1;return!0}function re(e,i,r){let n=[];for(let o=0;o<e.length;o++){let a=[];for(let n=0;n<e[o].length;n++){let s=function(e,i){let r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,o=Math.pow(2,i.z);return[Math.round(r*o*8192),Math.round(n*o*8192)]}(e[o][n],r);i3(i,s),a.push(s)}n.push(a)}return n}function rt(e,i,r){let n=[];for(let o=0;o<e.length;o++){let a=re(e[o],i,r);n.push(a)}return n}function ri(e,i,r,n){if(e[0]<r[0]||e[0]>r[2]){let i=.5*n,o=e[0]-r[0]>i?-n:r[0]-e[0]>i?n:0;0===o&&(o=e[0]-r[2]>i?-n:r[2]-e[0]>i?n:0),e[0]+=o}i3(i,e)}function rr(e,i,r,n){let o=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(let n of e)for(let e of n){let n=[e.x+a[0],e.y+a[1]];ri(n,i,r,o),s.push(n)}return s}function rn(e,i,r,n){let o=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(let r of e){let e=[];for(let n of r){let r=[n.x+a[0],n.y+a[1]];i3(i,r),e.push(r)}s.push(e)}if(i[2]-i[0]<=o/2)for(let e of(i[0]=i[1]=1/0,i[2]=i[3]=-1/0,s))for(let n of e)ri(n,i,r,o);return s}class ro{constructor(e,i){this.type=ix,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(iN(e[1])){let i=e[1];if("FeatureCollection"===i.type)for(let e=0;e<i.features.length;++e){let r=i.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new ro(i,i.features[e].geometry)}else if("Feature"===i.type){let e=i.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ro(i,i.geometry)}else if("Polygon"===i.type||"MultiPolygon"===i.type)return new ro(i,i)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,i){let r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=e.canonicalID();if(!o)return!1;if("Polygon"===i.type){let a=re(i.coordinates,n,o),s=rr(e.geometry(),r,n,o);if(!i5(r,n))return!1;for(let e of s)if(!i4(e,a))return!1}if("MultiPolygon"===i.type){let a=rt(i.coordinates,n,o),s=rr(e.geometry(),r,n,o);if(!i5(r,n))return!1;for(let e of s)if(!function(e,i){for(let r=0;r<i.length;r++)if(i4(e,i[r]))return!0;return!1}(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,i){let r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=e.canonicalID();if(!o)return!1;if("Polygon"===i.type){let a=re(i.coordinates,n,o),s=rn(e.geometry(),r,n,o);if(!i5(r,n))return!1;for(let e of s)if(!i7(e,a))return!1}if("MultiPolygon"===i.type){let a=rt(i.coordinates,n,o),s=rn(e.geometry(),r,n,o);if(!i5(r,n))return!1;for(let e of s)if(!function(e,i){for(let r=0;r<i.length;r++)if(i7(e,i[r]))return!0;return!1}(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let ra={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},rs=1/298.257223563*(2-1/298.257223563),rl=Math.PI/180;class rh{static fromTile(e,i,r){let n=Math.PI*(1-2*(e+.5)/Math.pow(2,i));return new rh(Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/rl,r)}static get units(){return ra}constructor(e,i){if(void 0===e)throw Error("No latitude given.");if(i&&!ra[i])throw Error(`Unknown unit ${i}. Use one of: ${Object.keys(ra).join(", ")}`);let r=6378.137*rl*(i?ra[i]:1),n=Math.cos(e*rl),o=1/(1-rs*(1-n*n)),a=Math.sqrt(o);this.kx=r*a*n,this.ky=r*a*o*(1-rs)}distance(e,i){let r=rd(e[0]-i[0])*this.kx,n=(e[1]-i[1])*this.ky;return Math.sqrt(r*r+n*n)}bearing(e,i){return Math.atan2(rd(i[0]-e[0])*this.kx,(i[1]-e[1])*this.ky)/rl}destination(e,i,r){let n=r*rl;return this.offset(e,Math.sin(n)*i,Math.cos(n)*i)}offset(e,i,r){return[e[0]+i/this.kx,e[1]+r/this.ky]}lineDistance(e){let i=0;for(let r=0;r<e.length-1;r++)i+=this.distance(e[r],e[r+1]);return i}area(e){let i=0;for(let r=0;r<e.length;r++){let n=e[r];for(let e=0,o=n.length,a=o-1;e<o;a=e++)i+=rd(n[e][0]-n[a][0])*(n[e][1]+n[a][1])*(r?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let r=0;if(i<=0)return e[0];for(let n=0;n<e.length-1;n++){let o=e[n],a=e[n+1],s=this.distance(o,a);if((r+=s)>i)return rc(o,a,(i-(r-s))/s)}return e[e.length-1]}pointToSegmentDistance(e,i,r){let[n,o]=i,a=rd(r[0]-n)*this.kx,s=(r[1]-o)*this.ky;if(0!==a||0!==s){let i=(rd(e[0]-n)*this.kx*a+(e[1]-o)*this.ky*s)/(a*a+s*s);i>1?(n=r[0],o=r[1]):i>0&&(n+=a/this.kx*i,o+=s/this.ky*i)}return Math.sqrt((a=rd(e[0]-n)*this.kx)*a+(s=(e[1]-o)*this.ky)*s)}pointOnLine(e,i){let r=1/0,n=e[0][0],o=e[0][1],a=0,s=0;for(let l=0;l<e.length-1;l++){let h=e[l][0],u=e[l][1],c=rd(e[l+1][0]-h)*this.kx,d=(e[l+1][1]-u)*this.ky,p=0;0===c&&0===d||((p=(rd(i[0]-h)*this.kx*c+(i[1]-u)*this.ky*d)/(c*c+d*d))>1?(h=e[l+1][0],u=e[l+1][1]):p>0&&(h+=c/this.kx*p,u+=d/this.ky*p));let f=(c=rd(i[0]-h)*this.kx)*c+(d=(i[1]-u)*this.ky)*d;f<r&&(r=f,n=h,o=u,a=l,s=p)}return{point:[n,o],index:a,t:Math.max(0,Math.min(1,s))}}lineSlice(e,i,r){let n=this.pointOnLine(r,e),o=this.pointOnLine(r,i);if(n.index>o.index||n.index===o.index&&n.t>o.t){let e=n;n=o,o=e}let a=[n.point],s=n.index+1,l=o.index;!ru(r[s],a[0])&&s<=l&&a.push(r[s]);for(let e=s+1;e<=l;e++)a.push(r[e]);return ru(r[l],o.point)||a.push(o.point),a}lineSliceAlong(e,i,r){let n=0,o=[];for(let a=0;a<r.length-1;a++){let s=r[a],l=r[a+1],h=this.distance(s,l);if((n+=h)>e&&0===o.length&&o.push(rc(s,l,(e-(n-h))/h)),n>=i)return o.push(rc(s,l,(i-(n-h))/h)),o;n>e&&o.push(l)}return o}bufferPoint(e,i){let r=i/this.ky,n=i/this.kx;return[e[0]-n,e[1]-r,e[0]+n,e[1]+r]}bufferBBox(e,i){let r=i/this.ky,n=i/this.kx;return[e[0]-n,e[1]-r,e[2]+n,e[3]+r]}insideBBox(e,i){return rd(e[0]-i[0])>=0&&0>=rd(e[0]-i[2])&&e[1]>=i[1]&&e[1]<=i[3]}}function ru(e,i){return e[0]===i[0]&&e[1]===i[1]}function rc(e,i,r){let n=rd(i[0]-e[0]);return[e[0]+n*r,e[1]+(i[1]-e[1])*r]}function rd(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class rp{constructor(e=[],i=(e,i)=>e<i?-1:+(e>i)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;let e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:i,compare:r}=this,n=i[e];for(;e>0;){let o=e-1>>1,a=i[o];if(r(n,a)>=0)break;i[e]=a,e=o}i[e]=n}_down(e){let{data:i,compare:r}=this,n=this.length>>1,o=i[e];for(;e<n;){let n=1+(e<<1),a=n+1;if(a<this.length&&0>r(i[a],i[n])&&(n=a),r(i[n],o)>=0)break;i[e]=i[n],e=n}i[e]=o}}function rf(e,i){return i.dist-e.dist}function rm(e){let i=[1/0,1/0,-1/0,-1/0];if(i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(i[r]!==e[r])return!1;return!0}function rg(e){return e[1]-e[0]+1}function r_(e,i){let r=e[1]>=e[0]&&e[1]<i;return r||console.warn("Distance Expression: Index is out of range"),r}function ry(e,i){if(e[0]>e[1])return[null,null];let r=rg(e);if(i){if(2===r)return[e,null];let i=Math.floor(r/2);return[[e[0],e[0]+i],[e[0]+i,e[1]]]}{if(1===r)return[e,null];let i=Math.floor(r/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}}function rv(e,i){let r=[1/0,1/0,-1/0,-1/0];if(!r_(i,e.length))return r;for(let n=i[0];n<=i[1];++n)i3(r,e[n]);return r}function rx(e){let i=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let n=0;n<e[r].length;++n)i3(i,e[r][n]);return i}function rb(e,i,r){if(rm(e)||rm(i))return NaN;let n=0,o=0;return e[2]<i[0]&&(n=i[0]-e[2]),e[0]>i[2]&&(n=e[0]-i[2]),e[1]>i[3]&&(o=e[1]-i[3]),e[3]<i[1]&&(o=i[1]-e[3]),r.distance([0,0],[n,o])}function rw(e,i){let r=Math.pow(2,i.z),n=(e.y/8192+i.y)/r;return[360*((e.x/8192+i.x)/r)-180,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90]}function rT(e,i,r){let n=r.pointOnLine(i,e).point;return r.distance(e,n)}function rS(e,i,r,n,o){let a=r.slice(n[0],n[1]+1),s=1/0;for(let r=i[0];r<=i[1];++r)if(0===(s=Math.min(s,rT(e[r],a,o))))return 0;return s}function rE(e,i,r,n,o){return Math.min(Math.min(o.pointToSegmentDistance(e,r,n),o.pointToSegmentDistance(i,r,n)),Math.min(o.pointToSegmentDistance(r,e,i),o.pointToSegmentDistance(n,e,i)))}function rI(e,i){for(let r of e)for(let e=0;e<=r.length-1;++e)if(i4(r[e],i,!0))return!0;return!1}function rC(e,i,r,n,o,a,s){if(null===a||null===s)return;let l=rb(rv(n,a),rv(o,s),r);l<i&&e.push({dist:l,range1:a,range2:s})}function rA(e,i,r,n,o,a=1/0){let s=Math.min(a,o.distance(e[0],r[0]));if(0===s)return s;let l=new rp([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],rf),h=i?50:100,u=n?50:100;for(;l.length;){let a=l.pop();if(a.dist>=s)continue;let c=a.range1,d=a.range2;if(rg(c)<=h&&rg(d)<=u){if(!r_(c,e.length)||!r_(d,r.length))return NaN;if(i&&n?s=Math.min(s,function(e,i,r,n,o){if(!r_(i,e.length)||!r_(n,r.length))return NaN;let a=1/0;for(let s=i[0];s<i[1];++s)for(let i=n[0];i<n[1];++i){if(i8(e[s],e[s+1],r[i],r[i+1]))return 0;a=Math.min(a,rE(e[s],e[s+1],r[i],r[i+1],o))}return a}(e,c,r,d,o)):i||n?i&&!n?s=Math.min(s,rS(r,d,e,c,o)):!i&&n&&(s=Math.min(s,rS(e,c,r,d,o))):s=Math.min(s,function(e,i,r,n,o){if(!r_(i,e.length)||!r_(n,r.length))return NaN;let a=1/0;for(let s=i[0];s<=i[1];++s)for(let i=n[0];i<=n[1];++i)if(0===(a=Math.min(a,o.distance(e[s],r[i]))))return a;return a}(e,c,r,d,o)),0===s)break}else{let a=ry(c,i),h=ry(d,n);rC(l,s,o,e,r,a[0],h[0]),rC(l,s,o,e,r,a[0],h[1]),rC(l,s,o,e,r,a[1],h[0]),rC(l,s,o,e,r,a[1],h[1])}}return s}function rR(e,i,r,n,o=1/0){let a=o,s=rv(e,[0,e.length-1]);for(let o of r)if(!(a!==1/0&&rb(s,rv(o,[0,o.length-1]),n)>=a)&&0===(a=Math.min(a,rA(e,i,o,!0,n,a))))break;return a}function rM(e,i,r,n,o=1/0){let a=o,s=rv(e,[0,e.length-1]);for(let o of r){if(a!==1/0&&rb(s,rx(o),n)>=a)continue;let r=function(e,i,r,n,o=1/0){let a=Math.min(n.distance(e[0],r[0][0]),o);if(0===a)return a;let s=new rp([{dist:0,range1:[0,e.length-1],range2:[0,0]}],rf),l=i?50:100,h=rx(r);for(;s.length;){let o=s.pop();if(o.dist>=a)continue;let u=o.range1;if(rg(u)<=l){if(!r_(u,e.length))return NaN;if(i){if(0===(a=Math.min(a,function(e,i,r,n){if(!r_(i,e.length))return NaN;for(let n=i[0];n<=i[1];++n)if(i4(e[n],r,!0))return 0;let o=1/0;for(let a=i[0];a<i[1];++a)for(let i of r)for(let r=0,s=i.length,l=s-1;r<s;l=r++){if(i8(e[a],e[a+1],i[l],i[r]))return 0;o=Math.min(o,rE(e[a],e[a+1],i[l],i[r],n))}return o}(e,u,r,n))))break}else for(let i=u[0];i<=u[1];++i)if(0===(a=Math.min(a,function(e,i,r){if(i4(e,i,!0))return 0;let n=1/0;for(let o of i){let i=o.length;if(i<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(o[0]!==o[i-1]&&0===(n=Math.min(n,r.pointToSegmentDistance(e,o[i-1],o[0])))||0===(n=Math.min(n,rT(e,o,r))))break}return n}(e[i],r,n))))return a}else{let r=ry(u,i);if(null!==r[0]){let i=rb(rv(e,r[0]),h,n);i<a&&s.push({dist:i,range1:r[0],range2:[0,0]})}if(null!==r[1]){let i=rb(rv(e,r[1]),h,n);i<a&&s.push({dist:i,range1:r[1],range2:[0,0]})}}}return a}(e,i,o,n,a);if(isNaN(r))return r;if(0===(a=Math.min(a,r)))break}return a}function rP(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class rO{constructor(e,i){this.type=iy,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(iN(e[1])){let i=e[1];if("FeatureCollection"===i.type){for(let e=0;e<i.features.length;++e)if(rP(i.features[e].geometry.type))return new rO(i,i.features[e].geometry)}else if("Feature"===i.type){if(rP(i.geometry.type))return new rO(i,i.geometry)}else if(rP(i.type))return new rO(i,i)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),r=e.canonicalID();if(null!=i&&null!=r){if("Point"===e.geometryType()){var n=this.geometries;let e=[];for(let n of i)for(let i of n)e.push(rw(i,r));let o=new rh(e[0][1],"meters");return"Point"===n.type||"MultiPoint"===n.type||"LineString"===n.type?rA(e,!1,"Point"===n.type?[n.coordinates]:n.coordinates,"LineString"===n.type,o):"MultiLineString"===n.type?rR(e,!1,n.coordinates,o):"Polygon"===n.type||"MultiPolygon"===n.type?rM(e,!1,"Polygon"===n.type?[n.coordinates]:n.coordinates,o):null}if("LineString"===e.geometryType())return function(e,i,r){let n=[];for(let r of e){let e=[];for(let n of r)e.push(rw(n,i));n.push(e)}let o=new rh(n[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return rR("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,o);if("MultiLineString"===r.type){let e=1/0;for(let i=0;i<r.coordinates.length;i++){let a=rR(r.coordinates[i],!0,n,o,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))break}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let i=0;i<n.length;i++){let a=rM(n[i],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,o,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))break}return e}return null}(i,r,this.geometries);if("Polygon"===e.geometryType())return function(e,i,r){let n=[];for(let r of function(e,i){let r,n,o=e.length;if(o<=1)return[e];let a=[];for(let i=0;i<o;i++){let o=function(e){let i=0;for(let r,n,o=0,a=e.length,s=a-1;o<a;s=o++)r=e[o],i+=((n=e[s]).x-r.x)*(r.y+n.y);return i}(e[i]);0!==o&&(e[i].area=Math.abs(o),void 0===n&&(n=o<0),n===o<0?(r&&a.push(r),r=[e[i]]):r.push(e[i]))}return r&&a.push(r),a}(e)){let e=[];for(let n=0;n<r.length;++n)e.push(function(e,i){let r=[];for(let n=0;n<e.length;++n)r.push(rw(e[n],i));return r}(r[n],i));n.push(e)}let o=new rh(n[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return rM("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,o);if("MultiLineString"===r.type){let e=1/0;for(let i=0;i<r.coordinates.length;i++){let a=rM(r.coordinates[i],!0,n,o,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))break}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,i,r){let n=1/0;for(let o of e)for(let e of i){let i=function(e,i,r,n=1/0){let o=rx(e),a=rx(i);if(n!==1/0&&rb(o,a,r)>=n)return n;if(i5(o,a)){if(rI(e,i))return 0}else if(rI(i,e))return 0;let s=n;for(let n of e)for(let e=0,o=n.length,a=o-1;e<o;a=e++)for(let o of i)for(let i=0,l=o.length,h=l-1;i<l;h=i++){if(i8(n[a],n[e],o[h],o[i]))return 0;s=Math.min(s,rE(n[a],n[e],o[h],o[i],r))}return s}(o,e,r,n);if(isNaN(i))return i;if(0===(n=Math.min(n,i)))return n}return n}("Polygon"===r.type?[r.coordinates]:r.coordinates,n,o):null}(i,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function rk(e,i){switch(e){case"string":return iV(i);case"number":return+i;case"boolean":return!!i;case"color":return is.parse(i);case"formatted":return iD.fromString(iV(i));case"resolvedImage":return iF.build(iV(i))}return i}function rL(e,i,r,n){return void 0!==n&&(e=n*Math.round(e/n)),void 0!==i&&e<i&&(e=i),void 0!==r&&e>r&&(e=r),e}class rD{constructor(e,i,r){this.type=e,this.key=i,this.scope=r}static parse(e,i){let r=i.expectedType;if(null==r&&(r=iT),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let n=i.parse(e[1],1);if(!(n instanceof iU))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let o=i.parse(e[2],2);return o instanceof iU?new rD(r,iV(n.value),iV(o.value)):i.error("Scope of 'config' expression must be a string literal.")}return new rD(r,iV(n.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),r=e.getConfig(i);if(!r)return null;let{type:n,value:o,values:a,minValue:s,maxValue:l,stepValue:h}=r,u=r.default.evaluate(e),c=u;if(o){let i=e.scope;e.scope=(i||"").split("\x1f").slice(1).join("\x1f"),c=o.evaluate(e),e.scope=i}return n&&(c=rk(n,c)),void 0===c||void 0===s&&void 0===l&&void 0===h||("number"==typeof c?c=rL(c,s,l,h):Array.isArray(c)&&(c=c.map(e=>"number"==typeof e?rL(e,s,l,h):e))),void 0!==o&&void 0!==c&&a&&!a.includes(c)&&(c=u,n&&(c=rk(n,c))),(n&&n!==this.type||void 0!==c&&ij(c)!==this.type)&&(c=rk(this.type.kind,c)),c}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function rz(e){if(e instanceof iQ&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof ro||e instanceof rO)return!1;let i=!0;return e.eachChild(e=>{i&&!rz(e)&&(i=!1)}),i}function rF(e){if(e instanceof iQ&&"feature-state"===e.name)return!1;let i=!0;return e.eachChild(e=>{i&&!rF(e)&&(i=!1)}),i}function rB(e){if(e instanceof rD)return new Set([e.key]);let i=new Set;return e.eachChild(e=>{i=new Set([...i,...rB(e)])}),i}function rN(e,i){if(e instanceof iQ&&i.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(e=>{r&&!rN(e,i)&&(r=!1)}),r}class rj{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");let r=e[1];return i.scope.has(r)?new rj(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class rV{constructor(e,i=[],r,n=new ig,o=[],a,s){this.registry=e,this.path=i,this.key=i.map(e=>"string"==typeof e?`['${e}']`:`[${e}]`).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._scope=a,this.options=s}parse(e,i,r,n,o={}){return i||r?this.concat(i,null,r,n)._parse(e,o):this._parse(e,o)}parseObjectValue(e,i,r,n,o,a={}){return this.concat(i,r,n,o)._parse(e,a)}_parse(e,i){function r(e,i,r){return"assert"===r?new i$(i,[e]):"coerce"===r?new iY(i,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let o=n.parse(e,this);if(!o)return null;if(this.expectedType){let e=this.expectedType,n=o.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else o=r(o,e,i.typeAnnotation||"coerce");else o=r(o,e,i.typeAnnotation||"assert")}if(!(o instanceof iU)&&"resolvedImage"!==o.type.kind&&function e(i){if(i instanceof rj)return e(i.boundExpression);if(i instanceof iQ&&"error"===i.name||i instanceof i1||i instanceof ro||i instanceof rO||i instanceof rD)return!1;let r=i instanceof iY||i instanceof i$,n=!0;return i.eachChild(i=>{n=r?n&&e(i):n&&i instanceof iU}),!!n&&rz(i)&&rN(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}(o)){let e=new iJ(this._scope,this.options);try{o=new iU(o.type,o.evaluate(e))}catch(e){return this.error(e.message),null}}return o}return iY.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r,n){let o="number"==typeof e?this.path.concat(e):this.path;o="string"==typeof i?o.concat(i):o;let a=n?this.scope.concat(n):this.scope;return new rV(this.registry,o,r||null,a,this.errors,this._scope,this.options)}error(e,...i){let r=`${this.key}${i.map(e=>`[${e}]`).join("")}`;this.errors.push(new im(r,e))}checkSubtype(e,i){let r=iM(e,i);return r&&this.error(r),r}}var rU=rV;function rG(e,i){let r=e.length-1,n,o,a=0,s=r,l=0;for(;a<=s;)if(n=e[l=Math.floor((a+s)/2)],o=e[l+1],n<=i){if(l===r||i<o)return l;a=l+1}else{if(!(n>i))throw new iG("Input is not a number.");s=l-1}return 0}class rq{constructor(e,i,r){for(let[n,o]of(this.type=e,this.input=i,this.labels=[],this.outputs=[],r))this.labels.push(n),this.outputs.push(o)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let r=i.parse(e[1],1,iy);if(!r)return null;let n=[],o=null;i.expectedType&&"value"!==i.expectedType.kind&&(o=i.expectedType);for(let r=1;r<e.length;r+=2){let a=1===r?-1/0:e[r],s=e[r+1],l=r,h=r+1;if("number"!=typeof a)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=a)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);let u=i.parse(s,h,o);if(!u)return null;o=o||u.type,n.push([a,u])}return new rq(o,r,n)}evaluate(e){let i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);let n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);let o=i.length;return n>=i[o-1]?r[o-1].evaluate(e):r[rG(i,n)].evaluate(e)}eachChild(e){for(let i of(e(this.input),this.outputs))e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}let r$=4/29,rH=6/29,rZ=6/29*3*(6/29),rW=6/29*(6/29)*(6/29),rX=Math.PI/180,rY=180/Math.PI;function rK(e){return e>rW?Math.pow(e,1/3):e/rZ+r$}function rJ(e){return e>rH?e*e*e:rZ*(e-r$)}function rQ(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function r0(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function r1(e){let i=r0(e.r),r=r0(e.g),n=r0(e.b),o=rK((.4124564*i+.3575761*r+.1804375*n)/.95047),a=rK((.2126729*i+.7151522*r+.072175*n)/1);return{l:116*a-16,a:500*(o-a),b:200*(a-rK((.0193339*i+.119192*r+.9503041*n)/1.08883)),alpha:e.a}}function r2(e){let i=(e.l+16)/116,r=isNaN(e.a)?i:i+e.a/500,n=isNaN(e.b)?i:i-e.b/200;return i=+rJ(i),new is(rQ(3.2404542*(r=.95047*rJ(r))-1.5371385*i-.4985314*(n=1.08883*rJ(n))),rQ(-.969266*r+1.8760108*i+.041556*n),rQ(.0556434*r-.2040259*i+1.0572252*n),e.alpha)}let r3={forward:r1,reverse:r2,interpolate:function(e,i,r){return{l:ih(e.l,i.l,r),a:ih(e.a,i.a,r),b:ih(e.b,i.b,r),alpha:ih(e.alpha,i.alpha,r)}}},r5={forward:function(e){let{l:i,a:r,b:n}=r1(e),o=Math.atan2(n,r)*rY;return{h:o<0?o+360:o,c:Math.sqrt(r*r+n*n),l:i,alpha:e.a}},reverse:function(e){let i=e.h*rX,r=e.c;return r2({l:e.l,a:Math.cos(i)*r,b:Math.sin(i)*r,alpha:e.alpha})},interpolate:function(e,i,r){return{h:function(e,i,r){let n=i-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}(e.h,i.h,r),c:ih(e.c,i.c,r),l:ih(e.l,i.l,r),alpha:ih(e.alpha,i.alpha,r)}}};var r4=Object.freeze({__proto__:null,hcl:r5,lab:r3});class r6{constructor(e,i,r,n,o){for(let[a,s]of(this.type=e,this.operator=i,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[],o))this.labels.push(a),this.outputs.push(s)}static interpolationFactor(e,i,r,n){let o=0;if("exponential"===e.name)o=r8(i,e.base,r,n);else if("linear"===e.name)o=r8(i,1,r,n);else if("cubic-bezier"===e.name){let a=e.controlPoints;o=new e1(a[0],a[1],a[2],a[3]).solve(r8(i,1,r,n))}return o}static parse(e,i){let[r,n,o,...a]=e;if(!Array.isArray(n)||0===n.length)return i.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){let e=n[1];if("number"!=typeof e)return i.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return i.error(`Unknown interpolation type ${String(n[0])}`,1,0);{let e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(!(o=i.parse(o,2,iy)))return null;let s=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=ib:i.expectedType&&"value"!==i.expectedType.kind&&(l=i.expectedType);for(let e=0;e<a.length;e+=2){let r=a[e],n=a[e+1],o=e+3,h=e+4;if("number"!=typeof r)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(s.length&&s[s.length-1][0]>=r)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',o);let u=i.parse(n,h,l);if(!u)return null;l=l||u.type,s.push([r,u])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new r6(l,r,n,o,s):i.error(`Type ${iA(l)} is not interpolatable.`)}evaluate(e){let i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);let n=this.input.evaluate(e);if(n<=i[0])return r[0].evaluate(e);let o=i.length;if(n>=i[o-1])return r[o-1].evaluate(e);let a=rG(i,n),s=r6.interpolationFactor(this.interpolation,n,i[a],i[a+1]),l=r[a].evaluate(e),h=r[a+1].evaluate(e);return"interpolate"===this.operator?id[this.type.kind.toLowerCase()](l,h,s):"interpolate-hcl"===this.operator?r5.reverse(r5.interpolate(r5.forward(l),r5.forward(h),s)):r3.reverse(r3.interpolate(r3.forward(l),r3.forward(h),s))}eachChild(e){for(let i of(e(this.input),this.outputs))e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];let i=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)i.push(this.labels[e],this.outputs[e].serialize());return i}}function r8(e,i,r,n){let o=n-r,a=e-r;return 0===o?0:1===i?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1)}class r9{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null,n=i.expectedType;n&&"value"!==n.kind&&(r=n);let o=[];for(let n of e.slice(1)){let e=i.parse(n,1+o.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,o.push(e)}return new r9(n&&o.some(e=>iM(n,e.type))?iT:r,o)}evaluate(e){let i,r=null,n=0;for(let o of this.args){if(n++,(r=o.evaluate(e))&&r instanceof iF&&!r.available&&(i||(i=r),r=null,n===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class r7{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let r=[];for(let n=1;n<e.length-1;n+=2){let o=e[n];if("string"!=typeof o)return i.error(`Expected string, but found ${typeof o} instead.`,n);if(/[^a-zA-Z0-9_]/.test(o))return i.error("Variable names must contain only alphanumeric characters or '_'.",n);let a=i.parse(e[n+1],n+1);if(!a)return null;r.push([o,a])}let n=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return n?new r7(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}class ne{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,iy),n=i.parse(e[2],2,iC(i.expectedType||iT));return r&&n?new ne(n.type.itemType,r,n):null}evaluate(e){let i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new iG(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new iG(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new iG(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class nt{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,iy),n=i.parse(e[2],2,iC(i.expectedType||iT));return r&&n?new nt(n.type.itemType,r,n):null}evaluate(e){let i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new iG(`Array index out of bounds: ${i} < 0.`);if(i>r.length-1)throw new iG(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i===Math.floor(i))return r[i];let n=Math.floor(i),o=Math.ceil(i),a=r[n],s=r[o];if("number"!=typeof a||"number"!=typeof s)throw new iG(`Cannot interpolate between non-number values at index ${i}.`);let l=i-n;return a*(1-l)+s*l}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ni{constructor(e,i){this.type=ix,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,iT),n=i.parse(e[2],2,iT);return r&&n?iP(r.type,[ix,iv,iy,i_,iT])?new ni(r,n):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${iA(r.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!iO(i,["boolean","string","number","null"]))throw new iG(`Expected first argument to be of type boolean, string, number or null, but found ${iA(ij(i))} instead.`);if(!iO(r,["string","array"]))throw new iG(`Expected second argument to be of type array or string, but found ${iA(ij(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class nr{constructor(e,i,r){this.type=iy,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,iT),n=i.parse(e[2],2,iT);if(!r||!n)return null;if(!iP(r.type,[ix,iv,iy,i_,iT]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${iA(r.type)} instead`);if(4===e.length){let o=i.parse(e[3],3,iy);return o?new nr(r,n,o):null}return new nr(r,n)}evaluate(e){let i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!iO(i,["boolean","string","number","null"]))throw new iG(`Expected first argument to be of type boolean, string, number or null, but found ${iA(ij(i))} instead.`);if(!iO(r,["string","array"]))throw new iG(`Expected second argument to be of type array or string, but found ${iA(ij(r))} instead.`);if(this.fromIndex){let n=this.fromIndex.evaluate(e);return r.indexOf(i,n)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class nn{constructor(e,i,r,n,o,a){this.inputType=e,this.type=i,this.input=r,this.cases=n,this.outputs=o,this.otherwise=a}static parse(e,i){let r,n;if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");i.expectedType&&"value"!==i.expectedType.kind&&(n=i.expectedType);let o={},a=[];for(let s=2;s<e.length-1;s+=2){let l=e[s],h=e[s+1];Array.isArray(l)||(l=[l]);let u=i.concat(s);if(0===l.length)return u.error("Expected at least one branch label.");for(let e of l){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,ij(e)))return null}else r=ij(e);if(void 0!==o[String(e)])return u.error("Branch labels must be unique.");o[String(e)]=a.length}let c=i.parse(h,s,n);if(!c)return null;n=n||c.type,a.push(c)}let s=i.parse(e[1],1,iT);if(!s)return null;let l=i.parse(e[e.length-1],e.length-1,n);return l?"value"!==s.type.kind&&i.concat(1).checkSubtype(r,s.type)?null:new nn(r,n,s,o,a,l):null}evaluate(e){let i=this.input.evaluate(e);return(ij(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],n={};for(let e of i){let i=n[this.cases[e]];void 0===i?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[i][1].push(e)}let o=e=>"number"===this.inputType.kind?Number(e):e;for(let[i,n]of r)e.push(1===n.length?o(n[0]):n.map(o)),e.push(this.outputs[i].serialize());return e.push(this.otherwise.serialize()),e}}class no{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){let r;if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);let n=[];for(let o=1;o<e.length-1;o+=2){let a=i.parse(e[o],o,ix);if(!a)return null;let s=i.parse(e[o+1],o+1,r);if(!s)return null;n.push([a,s]),r=r||s.type}let o=i.parse(e[e.length-1],e.length-1,r);return o?new no(r,n,o):null}evaluate(e){for(let[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class na{constructor(e,i,r,n){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let r=i.parse(e[1],1,iT),n=i.parse(e[2],2,iy);if(!r||!n)return null;if(!iP(r.type,[iC(iT),iv,iT]))return i.error(`Expected first argument to be of type array or string, but found ${iA(r.type)} instead`);if(4===e.length){let o=i.parse(e[3],3,iy);return o?new na(r.type,r,n,o):null}return new na(r.type,r,n)}evaluate(e){let i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!iO(i,["string","array"]))throw new iG(`Expected first argument to be of type array or string, but found ${iA(ij(i))} instead.`);if(this.endIndex){let n=this.endIndex.evaluate(e);return i.slice(r,n)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ns(e,i){return"=="===e||"!="===e?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function nl(e,i,r,n){return 0===n.compare(i,r)}function nh(e,i,r){let n="=="!==e&&"!="!==e;return class o{constructor(e,i,r){this.type=ix,this.lhs=e,this.rhs=i,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===i.type.kind}static parse(e,i){if(3!==e.length&&4!==e.length)return i.error("Expected two or three arguments.");let r=e[0],a=i.parse(e[1],1,iT);if(!a)return null;if(!ns(r,a.type))return i.concat(1).error(`"${r}" comparisons are not supported for type '${iA(a.type)}'.`);let s=i.parse(e[2],2,iT);if(!s)return null;if(!ns(r,s.type))return i.concat(2).error(`"${r}" comparisons are not supported for type '${iA(s.type)}'.`);if(a.type.kind!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return i.error(`Cannot compare types '${iA(a.type)}' and '${iA(s.type)}'.`);n&&("value"===a.type.kind&&"value"!==s.type.kind?a=new i$(s.type,[a]):"value"!==a.type.kind&&"value"===s.type.kind&&(s=new i$(a.type,[s])));let l=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==s.type.kind&&"value"!==a.type.kind&&"value"!==s.type.kind)return i.error("Cannot use collator to compare non-string types.");if(!(l=i.parse(e[3],3,iS)))return null}return new o(a,s,l)}evaluate(o){let a=this.lhs.evaluate(o),s=this.rhs.evaluate(o);if(n&&this.hasUntypedArgument){let i=ij(a),r=ij(s);if(i.kind!==r.kind||"string"!==i.kind&&"number"!==i.kind)throw new iG(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${i.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let e=ij(a),r=ij(s);if("string"!==e.kind||"string"!==r.kind)return i(o,a,s)}return this.collator?r(o,a,s,this.collator.evaluate(o)):i(o,a,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){let i=[e];return this.eachChild(e=>{i.push(e.serialize())}),i}}}let nu=nh("==",function(e,i,r){return i===r},nl),nc=nh("!=",function(e,i,r){return i!==r},function(e,i,r,n){return!nl(0,i,r,n)}),nd=nh("<",function(e,i,r){return i<r},function(e,i,r,n){return 0>n.compare(i,r)}),np=nh(">",function(e,i,r){return i>r},function(e,i,r,n){return n.compare(i,r)>0}),nf=nh("<=",function(e,i,r){return i<=r},function(e,i,r,n){return 0>=n.compare(i,r)}),nm=nh(">=",function(e,i,r){return i>=r},function(e,i,r,n){return n.compare(i,r)>=0});class ng{constructor(e,i,r,n,o,a){this.type=iv,this.number=e,this.locale=i,this.currency=r,this.unit=n,this.minFractionDigits=o,this.maxFractionDigits=a}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");let r=i.parse(e[1],1,iy);if(!r)return null;let n=e[2];if("object"!=typeof n||Array.isArray(n))return i.error("NumberFormat options argument must be an object.");let o=null;if(n.locale&&!(o=i.parseObjectValue(n.locale,2,"locale",iv)))return null;let a=null;if(n.currency&&!(a=i.parseObjectValue(n.currency,2,"currency",iv)))return null;let s=null;if(n.unit&&!(s=i.parseObjectValue(n.unit,2,"unit",iv)))return null;let l=null;if(n["min-fraction-digits"]&&!(l=i.parseObjectValue(n["min-fraction-digits"],2,"min-fraction-digits",iy)))return null;let h=null;return!n["max-fraction-digits"]||(h=i.parseObjectValue(n["max-fraction-digits"],2,"max-fraction-digits",iy))?new ng(r,o,a,s,l,h):null}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class n_{constructor(e){this.type=iy,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${iA(r.type)} instead.`):new n_(r):null}evaluate(e){let i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new iG(`Expected value to be of type string or array, but found ${iA(ij(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ny(e){return function(){let i=Math.imul((e=0x6d2b79f5+(e|=0)|0)^e>>>15,1|e);return(((i=i+Math.imul(i^i>>>7,61|i)^i)^i>>>14)>>>0)/0x100000000}}let nv={"==":nu,"!=":nc,">":np,"<":nd,">=":nm,"<=":nf,array:i$,at:ne,"at-interpolated":nt,boolean:i$,case:no,coalesce:r9,collator:i1,format:iH,image:iZ,in:ni,"index-of":nr,interpolate:r6,"interpolate-hcl":r6,"interpolate-lab":r6,length:n_,let:r7,literal:iU,match:nn,number:i$,"number-format":ng,object:i$,slice:na,step:rq,string:i$,"to-boolean":iY,"to-color":iY,"to-number":iY,"to-string":iY,var:rj,within:ro,distance:rO,config:rD};function nx(e,[i,r,n,o]){i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);let a=o?o.evaluate(e):1,s=iB(i,r,n,a);if(s)throw new iG(s);return new is(i/255*a,r/255*a,n/255*a,a)}function nb(e,[i,r,n,o]){var a,s,l;i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);let h=o?o.evaluate(e):1,u=(a=i,s=r,l=n,"number"==typeof a&&a>=0&&a<=360?"number"==typeof s&&s>=0&&s<=100&&"number"==typeof l&&l>=0&&l<=100?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid hsla value [${[a,s,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof h?[a,s,l,h]:[a,s,l]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof h?[a,s,l,h]:[a,s,l]).join(", ")}]: 'h' must be between 0 and 360.`);if(u)throw new iG(u);let c=`hsla(${i}, ${r}%, ${n}%, ${h})`,d=is.parse(c);if(!d)throw new iG(`Failed to parse HSLA color: ${c}`);return d}function nw(e,i){let r=i[e];return void 0===r?null:r}function nT(e){return{type:e}}function nS(e){return{result:"success",value:e}}function nE(e){return{result:"error",value:e}}function nI(e,i){return!!e&&!!e.parameters&&e.parameters.indexOf(i)>-1}function nC(e){return"data-driven"===e["property-type"]}function nA(e){return nI(e.expression,"measure-light")}function nR(e){return nI(e.expression,"zoom")}function nM(e){return!!e.expression&&e.expression.interpolated}function nP(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function nO(e){return e}function nk(e,i,r){return void 0!==e?e:void 0!==i?i:void 0!==r?r:void 0}function nL(e,i,r,n,o){return nk(typeof r===o?n[r]:void 0,e.default,i.default)}function nD(e,i,r){if("number"!==iW(r))return nk(e.default,i.default);let n=e.stops.length;if(1===n||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];let o=rG(e.stops.map(e=>e[0]),r);return e.stops[o][1]}function nz(e,i,r){let n=void 0!==e.base?e.base:1;if("number"!==iW(r))return nk(e.default,i.default);let o=e.stops.length;if(1===o||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[o-1][0])return e.stops[o-1][1];let a=rG(e.stops.map(e=>e[0]),r),s=function(e,i,r,n){let o=n-r,a=e-r;return 0===o?0:1===i?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1)}(r,n,e.stops[a][0],e.stops[a+1][0]),l=e.stops[a][1],h=e.stops[a+1][1],u=id[i.type]||nO;if(e.colorSpace&&"rgb"!==e.colorSpace){let i=r4[e.colorSpace];u=(e,r)=>i.reverse(i.interpolate(i.forward(e),i.forward(r),s))}return"function"==typeof l.evaluate?{evaluate(...e){let i=l.evaluate.apply(void 0,e),r=h.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return u(i,r,s)}}:u(l,h,s)}function nF(e,i,r){return"color"===i.type?r=is.parse(r):"formatted"===i.type?r=iD.fromString(r.toString()):"resolvedImage"===i.type?r=iF.build(r.toString()):iW(r)===i.type||"enum"===i.type&&i.values[r]||(r=void 0),nk(r,e.default,i.default)}iQ.register(nv,{error:[{kind:"error"},[iv],(e,[i])=>{throw new iG(i.evaluate(e))}],typeof:[iv,[iT],(e,[i])=>iA(ij(i.evaluate(e)))],"to-rgba":[iC(iy,4),[ib],(e,[i])=>i.evaluate(e).toRenderColor(null).toArray()],"to-hsla":[iC(iy,4),[ib],(e,[i])=>i.evaluate(e).toRenderColor(null).toHslaArray()],rgb:[ib,[iy,iy,iy],nx],rgba:[ib,[iy,iy,iy,iy],nx],hsl:[ib,[iy,iy,iy],nb],hsla:[ib,[iy,iy,iy,iy],nb],has:{type:ix,overloads:[[[iv],(e,[i])=>i.evaluate(e)in e.properties()],[[iv,iw],(e,[i,r])=>i.evaluate(e)in r.evaluate(e)]]},get:{type:iT,overloads:[[[iv],(e,[i])=>nw(i.evaluate(e),e.properties())],[[iv,iw],(e,[i,r])=>nw(i.evaluate(e),r.evaluate(e))]]},"feature-state":[iT,[iv],(e,[i])=>nw(i.evaluate(e),e.featureState||{})],properties:[iw,[],e=>e.properties()],"geometry-type":[iv,[],e=>e.geometryType()],id:[iT,[],e=>e.id()],zoom:[iy,[],e=>e.globals.zoom],pitch:[iy,[],e=>e.globals.pitch||0],"distance-from-center":[iy,[],e=>e.distanceFromCenter()],"measure-light":[iy,[iv],(e,[i])=>e.measureLight(i.evaluate(e))],"heatmap-density":[iy,[],e=>e.globals.heatmapDensity||0],"line-progress":[iy,[],e=>e.globals.lineProgress||0],"raster-value":[iy,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[iy,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[iy,[],e=>e.globals.skyRadialProgress||0],accumulated:[iT,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[iy,nT(iy),(e,i)=>{let r=0;for(let n of i)r+=n.evaluate(e);return r}],"*":[iy,nT(iy),(e,i)=>{let r=1;for(let n of i)r*=n.evaluate(e);return r}],"-":{type:iy,overloads:[[[iy,iy],(e,[i,r])=>i.evaluate(e)-r.evaluate(e)],[[iy],(e,[i])=>-i.evaluate(e)]]},"/":[iy,[iy,iy],(e,[i,r])=>i.evaluate(e)/r.evaluate(e)],"%":[iy,[iy,iy],(e,[i,r])=>i.evaluate(e)%r.evaluate(e)],ln2:[iy,[],()=>Math.LN2],pi:[iy,[],()=>Math.PI],e:[iy,[],()=>Math.E],"^":[iy,[iy,iy],(e,[i,r])=>Math.pow(i.evaluate(e),r.evaluate(e))],sqrt:[iy,[iy],(e,[i])=>Math.sqrt(i.evaluate(e))],log10:[iy,[iy],(e,[i])=>Math.log(i.evaluate(e))/Math.LN10],ln:[iy,[iy],(e,[i])=>Math.log(i.evaluate(e))],log2:[iy,[iy],(e,[i])=>Math.log(i.evaluate(e))/Math.LN2],sin:[iy,[iy],(e,[i])=>Math.sin(i.evaluate(e))],cos:[iy,[iy],(e,[i])=>Math.cos(i.evaluate(e))],tan:[iy,[iy],(e,[i])=>Math.tan(i.evaluate(e))],asin:[iy,[iy],(e,[i])=>Math.asin(i.evaluate(e))],acos:[iy,[iy],(e,[i])=>Math.acos(i.evaluate(e))],atan:[iy,[iy],(e,[i])=>Math.atan(i.evaluate(e))],min:[iy,nT(iy),(e,i)=>Math.min(...i.map(i=>i.evaluate(e)))],max:[iy,nT(iy),(e,i)=>Math.max(...i.map(i=>i.evaluate(e)))],abs:[iy,[iy],(e,[i])=>Math.abs(i.evaluate(e))],round:[iy,[iy],(e,[i])=>{let r=i.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[iy,[iy],(e,[i])=>Math.floor(i.evaluate(e))],ceil:[iy,[iy],(e,[i])=>Math.ceil(i.evaluate(e))],"filter-==":[ix,[iv,iT],(e,[i,r])=>e.properties()[i.value]===r.value],"filter-id-==":[ix,[iT],(e,[i])=>e.id()===i.value],"filter-type-==":[ix,[iv],(e,[i])=>e.geometryType()===i.value],"filter-<":[ix,[iv,iT],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n<o}],"filter-id-<":[ix,[iT],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[ix,[iv,iT],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n>o}],"filter-id->":[ix,[iT],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[ix,[iv,iT],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[ix,[iT],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[ix,[iv,iT],(e,[i,r])=>{let n=e.properties()[i.value],o=r.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[ix,[iT],(e,[i])=>{let r=e.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[ix,[iT],(e,[i])=>i.value in e.properties()],"filter-has-id":[ix,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[ix,[iC(iv)],(e,[i])=>i.value.indexOf(e.geometryType())>=0],"filter-id-in":[ix,[iC(iT)],(e,[i])=>i.value.indexOf(e.id())>=0],"filter-in-small":[ix,[iv,iC(iT)],(e,[i,r])=>r.value.indexOf(e.properties()[i.value])>=0],"filter-in-large":[ix,[iv,iC(iT)],(e,[i,r])=>(function(e,i,r,n){for(;r<=n;){let o=r+n>>1;if(i[o]===e)return!0;i[o]>e?n=o-1:r=o+1}return!1})(e.properties()[i.value],r.value,0,r.value.length-1)],all:{type:ix,overloads:[[[ix,ix],(e,[i,r])=>i.evaluate(e)&&r.evaluate(e)],[nT(ix),(e,i)=>{for(let r of i)if(!r.evaluate(e))return!1;return!0}]]},any:{type:ix,overloads:[[[ix,ix],(e,[i,r])=>i.evaluate(e)||r.evaluate(e)],[nT(ix),(e,i)=>{for(let r of i)if(r.evaluate(e))return!0;return!1}]]},"!":[ix,[ix],(e,[i])=>!i.evaluate(e)],"is-supported-script":[ix,[iv],(e,[i])=>{let r=e.globals&&e.globals.isSupportedScript;return!r||r(i.evaluate(e))}],upcase:[iv,[iv],(e,[i])=>i.evaluate(e).toUpperCase()],downcase:[iv,[iv],(e,[i])=>i.evaluate(e).toLowerCase()],concat:[iv,nT(iT),(e,i)=>i.map(i=>iV(i.evaluate(e))).join("")],"resolved-locale":[iv,[iS],(e,[i])=>i.evaluate(e).resolvedLocale()],random:[iy,[iy,iy,iT],(e,i)=>{let r,[n,o,a]=i.map(i=>i.evaluate(e));if(n>o||n===o)return n;if("string"==typeof a)r=function(e){let i=0;if(0===e.length)return i;for(let r=0;r<e.length;r++)i=(i<<5)-i+e.charCodeAt(r)|0;return i}(a);else{if("number"!=typeof a)throw new iG(`Invalid seed input: ${a}`);r=a}return n+ny(r)()*(o-n)}]});class nB{constructor(e,i,r,n){this.expression=e,this._warningHistory={},this._evaluator=new iJ(r,n),this._defaultValue=i?"color"===i.type&&(nP(i.default)||Array.isArray(i.default))?new is(0,0,0,0):"color"===i.type?is.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=i&&"enum"===i.type?i.values:null,this.configDependencies=rB(e)}evaluateWithoutErrorHandling(e,i,r,n,o,a,s,l){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,n,o,a,s,l){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=l||null;try{let e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new iG(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${e.message}`)),this._defaultValue}}}function nN(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in nv}function nj(e,i,r,n){let o=new rU(nv,[],i?function(e){let i={color:ib,string:iv,number:iy,enum:iv,boolean:ix,formatted:iE,resolvedImage:iI};return"array"===e.type?iC(i[e.value]||iT,e.length):i[e.type]}(i):void 0,void 0,void 0,r,n),a=o.parse(e,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return a?nS(new nB(a,i,r,n)):nE(o.errors)}class nV{constructor(e,i,r,n){this.kind=e,this._styleExpression=i,this.isLightConstant=r,this.isLineProgressConstant=n,this.isStateDependent="constant"!==e&&!rF(i.expression),this.configDependencies=rB(i.expression)}evaluateWithoutErrorHandling(e,i,r,n,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,o,a)}evaluate(e,i,r,n,o,a){return this._styleExpression.evaluate(e,i,r,n,o,a)}}class nU{constructor(e,i,r,n,o,a){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!rF(i.expression),this.isLightConstant=o,this.isLineProgressConstant=a,this.configDependencies=rB(i.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,i,r,n,o,a){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,n,o,a)}evaluate(e,i,r,n,o,a){return this._styleExpression.evaluate(e,i,r,n,o,a)}interpolationFactor(e,i,r){return this.interpolationType?r6.interpolationFactor(this.interpolationType,e,i,r):0}}function nG(e,i,r,n){if("error"===(e=nj(e,i,r,n)).result)return e;let o=e.value.expression,a=rz(o);if(!a&&!nC(i))return nE([new im("","data expressions not supported")]);let s=rN(o,["zoom","pitch","distance-from-center"]);if(!s&&!nR(i))return nE([new im("","zoom expressions not supported")]);let l=rN(o,["measure-light"]);if(!l&&!nA(i))return nE([new im("","measure-light expression not supported")]);let h=rN(o,["line-progress"]);if(!h&&!nI(i.expression,"line-progress"))return nE([new im("","line-progress expression not supported")]);let u=i.expression&&i.expression.relaxZoomRestriction,c=function e(i){let r=null;if(i instanceof r7)r=e(i.result);else if(i instanceof r9){for(let n of i.args)if(r=e(n))break}else(i instanceof rq||i instanceof r6)&&i.input instanceof iQ&&"zoom"===i.input.name&&(r=i);return r instanceof im||i.eachChild(i=>{let n=e(i);n instanceof im?r=n:r&&n&&r!==n&&(r=new im("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}(o);return c||s||u?c instanceof im?nE([c]):c instanceof r6&&!nM(i)?nE([new im("",'"interpolate" expressions cannot be used with this property')]):nS(c?new nU(a&&h?"camera":"composite",e.value,c.labels,c instanceof r6?c.interpolation:void 0,l,h):new nV(a&&h?"constant":"source",e.value,l,h)):nE([new im("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class nq{constructor(e,i){this._parameters=e,this._specification=i,ip(this,function e(i,r){let n,o,a,s="color"===r.type,l=i.stops&&"object"==typeof i.stops[0][0],h=l||!(l||void 0!==i.property),u=i.type||(nM(r)?"exponential":"interval");if(s&&((i=ip({},i)).stops&&(i.stops=i.stops.map(e=>[e[0],is.parse(e[1])])),i.default=is.parse(i.default?i.default:r.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!r4[i.colorSpace])throw Error(`Unknown color space: ${i.colorSpace}`);if("exponential"===u)n=nz;else if("interval"===u)n=nD;else if("categorical"===u){for(let e of(n=nL,o=Object.create(null),i.stops))o[e[0]]=e[1];a=typeof i.stops[0][0]}else{if("identity"!==u)throw Error(`Unknown function type "${u}"`);n=nF}if(l){let n={},o=[];for(let e=0;e<i.stops.length;e++){let r=i.stops[e],a=r[0].zoom;void 0===n[a]&&(n[a]={zoom:a,type:i.type,property:i.property,default:i.default,stops:[]},o.push(a)),n[a].stops.push([r[0].value,r[1]])}let a=[];for(let i of o)a.push([n[i].zoom,e(n[i],r)]);let s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:r6.interpolationFactor.bind(void 0,s),zoomStops:a.map(e=>e[0]),evaluate:({zoom:e},n)=>nz({stops:a,base:i.base},r,e).evaluate(e,n)}}if(h){let e="exponential"===u?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:r6.interpolationFactor.bind(void 0,e),zoomStops:i.stops.map(e=>e[0]),evaluate:({zoom:e})=>n(i,r,e,o,a)}}return{kind:"source",evaluate(e,s){let l=s&&s.properties?s.properties[i.property]:void 0;return void 0===l?nk(i.default,r.default):n(i,r,l,o,a)}}}(this._parameters,this._specification))}static deserialize(e){return new nq(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}var n$,nH,nZ=eJ(function(){if(nH)return n$;function e(e,i,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var o=new Int32Array(this.arrayBuffer);e=o[0],this.d=(i=o[1])+2*(r=o[2]);for(var a=0;a<this.d*this.d;a++){var s=o[3+a],l=o[3+a+1];n.push(s===l?null:o.subarray(s,l))}var h=o[3+n.length+1];this.keys=o.subarray(o[3+n.length],h),this.bboxes=o.subarray(h),this.insert=this._insertReadonly}else{this.d=i+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=r,this.scale=i/e,this.uid=0;var c=r/i*e;this.min=-c,this.max=e+c}return nH=1,n$=e,e.prototype.insert=function(e,i,r,n,o){this._forEachCell(i,r,n,o,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(o)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(e,i,r,n,o,a){this.cells[o].push(a)},e.prototype.query=function(e,i,r,n,o){var a=this.min,s=this.max;if(e<=a&&i<=a&&s<=r&&s<=n&&!o)return Array.prototype.slice.call(this.keys);var l=[];return this._forEachCell(e,i,r,n,this._queryCell,l,{},o),l},e.prototype._queryCell=function(e,i,r,n,o,a,s,l){var h=this.cells[o];if(null!==h)for(var u=this.keys,c=this.bboxes,d=0;d<h.length;d++){var p=h[d];if(void 0===s[p]){var f=4*p;(l?l(c[f+0],c[f+1],c[f+2],c[f+3]):e<=c[f+2]&&i<=c[f+3]&&r>=c[f+0]&&n>=c[f+1])?(s[p]=!0,a.push(u[p])):s[p]=!1}}},e.prototype._forEachCell=function(e,i,r,n,o,a,s,l){for(var h=this._convertToCellCoord(e),u=this._convertToCellCoord(i),c=this._convertToCellCoord(r),d=this._convertToCellCoord(n),p=h;p<=c;p++)for(var f=u;f<=d;f++){var m=this.d*f+p;if((!l||l(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&o.call(this,e,i,r,n,m,a,s,l))return}},e.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},e.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,i=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var o=new Int32Array(i+r+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var a=i,s=0;s<e.length;s++){var l=e[s];o[3+s]=a,o.set(l,a),a+=l.length}return o[3+e.length]=a,o.set(this.keys,a),o[3+e.length+1]=a+=this.keys.length,o.set(this.bboxes,a),a+=this.bboxes.length,o.buffer},n$}());let nW={};function nX(e,i,r={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writable:!1}),nW[i]={klass:e,omit:r.omit||[]}}for(let e in nX(Object,"Object"),nZ.serialize=function(e,i){let r=e.toArrayBuffer();return i&&i.add(r),{buffer:r}},nZ.deserialize=function(e){return new nZ(e.buffer)},Object.defineProperty(nZ,"name",{value:"Grid"}),nX(nZ,"Grid"),"undefined"!=typeof DOMMatrix&&nX(DOMMatrix,"DOMMatrix"),nX(is,"Color"),nX(Error,"Error"),nX(iD,"Formatted"),nX(iL,"FormattedSection"),nX(tW,"AJAXError"),nX(iF,"ResolvedImage"),nX(nq,"StylePropertyFunction"),nX(nB,"StyleExpression",{omit:["_evaluator"]}),nX(ii,"ImageId"),nX(iz,"ImageVariant"),nX(nU,"ZoomDependentExpression"),nX(nV,"ZoomConstantExpression"),nX(iQ,"CompoundExpression",{omit:["_evaluate"]}),nv)nW[nv[e]._classRegistryKey]||nX(nv[e],`Expression${e}`);function nY(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function nK(e){return self.ImageBitmap&&e instanceof ImageBitmap}function nJ(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(nY(e)||nK(e))return i&&i.add(e),e;if(ArrayBuffer.isView(e))return i&&i.add(e.buffer),e;if(e instanceof ImageData)return i&&i.add(e.data.buffer),e;if(Array.isArray(e)){let r=[];for(let n of e)r.push(nJ(n,i));return r}if(e instanceof Map){let r={$name:"Map",entries:[]};for(let[n,o]of e.entries())r.entries.push(nJ(n),nJ(o,i));return r}if(e instanceof Set){let i={$name:"Set"},r=0;for(let n of e.values())i[++r]=nJ(n);return i}if(e instanceof DOMMatrix){let i={$name:"DOMMatrix"};for(let r of["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"])i[r]=e[r];return i}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){let r=e.constructor,n=r._classRegistryKey;if(!n)throw Error(`Can't serialize object of unregistered class "${r.name}".`);let o=r.serialize?r.serialize(e,i):{};if(!r.serialize){for(let r in e)e.hasOwnProperty(r)&&(nW[n].omit.indexOf(r)>=0||(o[r]=nJ(e[r],i)));e instanceof Error&&(o.message=e.message)}if(o.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(o.$name=n),o}throw Error("can't serialize object of type "+typeof e)}function nQ(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||nY(e)||nK(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(nQ);if("object"==typeof e){let i=e.$name||"Object";if("Map"===i){let i=e.entries||[],r=new Map;for(let e=0;e<i.length;e+=2)r.set(nQ(i[e]),nQ(i[e+1]));return r}if("Set"===i){let i=new Set;for(let r of Object.keys(e))"$name"!==r&&i.add(nQ(e[r]));return i}if("DOMMatrix"===i)return new DOMMatrix(e.is2D?[e.a,e.b,e.c,e.d,e.e,e.f]:[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44]);if("BigInt"===i)return BigInt(e.value);let{klass:r}=nW[i];if(!r)throw Error(`Can't deserialize unregistered class "${i}".`);if(r.deserialize)return r.deserialize(e);let n=Object.create(r.prototype);for(let i of Object.keys(e))"$name"!==i&&(n[i]=nQ(e[i]));return n}throw Error("can't deserialize object of type "+typeof e)}let n0={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function n1(e){for(let i of e)if(n2(i.charCodeAt(0)))return!0;return!1}function n2(e){return!(746!==e&&747!==e&&(e<4352||!(n0["Bopomofo Extended"](e)||n0.Bopomofo(e)||n0["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||n0["CJK Compatibility Ideographs"](e)||n0["CJK Compatibility"](e)||n0["CJK Radicals Supplement"](e)||n0["CJK Strokes"](e)||!(!n0["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||n0["CJK Unified Ideographs Extension A"](e)||n0["CJK Unified Ideographs"](e)||n0["Enclosed CJK Letters and Months"](e)||n0["Hangul Compatibility Jamo"](e)||n0["Hangul Jamo Extended-A"](e)||n0["Hangul Jamo Extended-B"](e)||n0["Hangul Jamo"](e)||n0["Hangul Syllables"](e)||n0.Hiragana(e)||n0["Ideographic Description Characters"](e)||n0.Kanbun(e)||n0["Kangxi Radicals"](e)||n0["Katakana Phonetic Extensions"](e)||n0.Katakana(e)&&12540!==e||!(!n0["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!n0["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||n0["Unified Canadian Aboriginal Syllabics"](e)||n0["Unified Canadian Aboriginal Syllabics Extended"](e)||n0["Vertical Forms"](e)||n0["Yijing Hexagram Symbols"](e)||n0["Yi Syllables"](e)||n0["Yi Radicals"](e))))}function n3(e){return!(n2(e)||n0["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||n0["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||n0["Letterlike Symbols"](e)||n0["Number Forms"](e)||n0["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||n0["Control Pictures"](e)&&9251!==e||n0["Optical Character Recognition"](e)||n0["Enclosed Alphanumerics"](e)||n0["Geometric Shapes"](e)||n0["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||n0["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||n0["CJK Symbols and Punctuation"](e)||n0.Katakana(e)||n0["Private Use Area"](e)||n0["CJK Compatibility Forms"](e)||n0["Small Form Variants"](e)||n0["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}function n5(e){return e>=1424&&e<=2303||n0["Arabic Presentation Forms-A"](e)||n0["Arabic Presentation Forms-B"](e)}let n4="deferred",n6="loading",n8="loaded",n9=null,n7="unavailable",oe=null,ot=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(n7="error"),n9&&n9(e)};function oi(){or.fire(new t8("pluginStateChange",{pluginStatus:n7,pluginURL:oe}))}let or=new it,on=function(){return n7},oo=function(){if(n7!==n4||!oe)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");n7=n6,oi(),oe&&tK({url:oe},e=>{e?ot(e):(n7=n8,oi())})},oa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>n7===n8||null!=oa.applyArabicShaping,isLoading:()=>n7===n6,setState(e){n7=e.pluginStatus,oe=e.pluginURL},isParsed:()=>null!=oa.applyArabicShaping&&null!=oa.processBidirectionalText&&null!=oa.processStyledBidirectionalText,getPluginURL:()=>oe};class os{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){var i,r=oa.isLoaded();for(let n of e)if(i=n.charCodeAt(0),!r&&n5(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||n0.Khmer(i))return!1;return!0}}class ol{constructor(e,i,r,n){this.property=e,this.value=i,this.expression=function(e,i,r,n){if(nP(e))return new nq(e,i);if(nN(e)||Array.isArray(e)&&e.length>0){let o=nG(e,i,r,n);if("error"===o.result)throw Error(o.value.map(e=>`${e.key}: ${e.message}`).join(", "));return o.value}{let r=e;return"string"==typeof e&&"color"===i.type&&(r=is.parse(e)),{kind:"constant",configDependencies:new Set,evaluate:()=>r}}}(void 0===i?e.specification.default:i,e.specification,r,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class oh{constructor(e,i,r){this.property=e,this.value=new ol(e,void 0,i,r)}transitioned(e,i){return new oc(this.property,this.value,i,to({},e.transition,this.transition),e.now)}untransitioned(){return new oc(this.property,this.value,null,{},0)}}class ou{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=r,this.configDependencies=new Set}getValue(e){return td(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oh(this._values[e].property,this._scope,this._options)),this._values[e].value=new ol(this._values[e].property,null===i?void 0:td(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);let r=this._properties.properties;if(e)for(let i in e){let n=e[i];if(i.endsWith("-transition")){let e=i.slice(0,-11);r[e]&&this.setTransition(e,n)}else r.hasOwnProperty(i)&&this.setValue(i,n)}}getTransition(e){return td(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new oh(this._values[e].property)),this._values[e].transition=td(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let r=this.getValue(i);void 0!==r&&(e[i]=r);let n=this.getTransition(i);void 0!==n&&(e[`${i}-transition`]=n)}return e}transitioned(e,i){let r=new od(this._properties);for(let n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,i._values[n]);return r}untransitioned(){let e=new od(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class oc{constructor(e,i,r,n,o){let a=n.delay||0,s=n.duration||0;o=o||0,this.property=e,this.value=i,this.begin=o+a,this.end=this.begin+s,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){let n=e.now||0,o=this.value.possiblyEvaluate(e,i,r),a=this.prior;if(a){if(n>this.end||this.value.isDataDriven())return this.prior=null,o;if(n<this.begin)return a.possiblyEvaluate(e,i,r);{let s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,i,r),o,e9(s))}}return o}}class od{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){let n=new om(this._properties);for(let o of Object.keys(this._values))n._values[o]=this._values[o].possiblyEvaluate(e,i,r);return n}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class op{constructor(e,i,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=r,this.configDependencies=new Set}getValue(e){return td(this._values[e].value)}setValue(e,i){this._values[e]=new ol(this._values[e].property,null===i?void 0:td(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let i of Object.keys(this._values)){let r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){let n=new om(this._properties);for(let o of Object.keys(this._values))n._values[o]=this._values[o].possiblyEvaluate(e,i,r);return n}}class of{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,r,n){return this.property.evaluate(this.value,this.parameters,e,i,r,n)}}class om{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class og{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){let n=id[this.specification.type];return n?n(e,i,r):e}}class o_{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,n){return new of(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},r,n)}:e.expression,i)}interpolate(e,i,r){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new of(this,{kind:"constant",value:void 0},e.parameters);let n=id[this.specification.type];return n?new of(this,{kind:"constant",value:n(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,n,o,a){return"constant"===e.kind?e.value:e.evaluate(i,r,n,o,a)}}class oy{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,n){return!!e.expression.evaluate(i,null,{},r,n)}interpolate(){return!1}}class ov{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new os(0,{});for(let r in e){let n=e[r];n.specification.overridable&&this.overridableProperties.push(r);let o=this.defaultPropertyValues[r]=new ol(n,void 0),a=this.defaultTransitionablePropertyValues[r]=new oh(n);this.defaultTransitioningPropertyValues[r]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate(i)}}}nX(o_,"DataDrivenProperty"),nX(og,"DataConstantProperty"),nX(oy,"ColorRampProperty");var ox=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ob(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ow(e){if(Array.isArray(e))return e.map(ow);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let i={};for(let r in e)i[r]=ow(e[r]);return i}return ob(e)}function oT(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let i of e.slice(1))if(!oT(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function oS(e,i="",r=null,n="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};oT(e)||(e=function e(i){if(!i)return!0;let r=i[0];return i.length<=1?"any"!==r:"=="===r?oA(i[1],i[2],"=="):"!="===r?oP(oA(i[1],i[2],"==")):"<"===r||">"===r||"<="===r||">="===r?oA(i[1],i[2],r):"any"===r?["any"].concat(i.slice(1).map(e)):"all"===r?["all"].concat(i.slice(1).map(e)):"none"===r?["all"].concat(i.slice(1).map(e).map(oP)):"in"===r?oR(i[1],i.slice(2)):"!in"===r?oP(oR(i[1],i.slice(2))):"has"===r?oM(i[1]):"!has"!==r||oP(oM(i[1]))}(e));let o=e,a=!0;try{a=function(e){if(!oE(e))return e;let i=ow(e);return function e(i){let r=!1,n=[];if("case"===i[0]){for(let e=1;e<i.length-1;e+=2)r=r||oE(i[e]),n.push(i[e+1]);n.push(i[i.length-1])}else if("match"===i[0]){r=r||oE(i[1]);for(let e=2;e<i.length-1;e+=2)n.push(i[e+1]);n.push(i[i.length-1])}else if("step"===i[0]){r=r||oE(i[1]);for(let e=1;e<i.length-1;e+=2)n.push(i[e+1])}r&&(i.length=0,i.push("any",...n));for(let r=1;r<i.length;r++)e(i[r])}(i),i=function e(i){if(!Array.isArray(i))return i;let r=function(e){if(oI.has(e[0])){for(let i=1;i<e.length;i++)if(oE(e[i]))return!0}return e}(i);return!0===r?r:r.map(i=>e(i))}(i)}(o)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}let s=null,l=null;if("background"!==n&&"sky"!==n&&"slot"!==n){let e=nj(a,l=ox[`filter_${n}`],i,r);if("error"===e.result)throw Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));s=(i,r,n)=>e.value.evaluate(i,r,{},n)}let h=null,u=null;if(a!==o){let e=nj(o,l,i,r);if("error"===e.result)throw Error(e.value.map(e=>`${e.key}: ${e.message}`).join(", "));h=(i,r,n,o,a)=>e.value.evaluate(i,r,{},n,void 0,void 0,o,a),u=!rz(e.value.expression)}return{filter:s,dynamicFilter:h||void 0,needGeometry:function e(i){if(!Array.isArray(i))return!1;if("within"===i[0]||"distance"===i[0])return!0;for(let r=1;r<i.length;r++)if(e(i[r]))return!0;return!1}(a),needFeature:!!u}}function oE(e){var i;if(!Array.isArray(e))return!1;if("pitch"===(i=e[0])||"distance-from-center"===i)return!0;for(let i=1;i<e.length;i++)if(oE(e[i]))return!0;return!1}let oI=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function oC(e,i){return e<i?-1:+(e>i)}function oA(e,i,r){switch(e){case"$type":return[`filter-type-${r}`,i];case"$id":return[`filter-id-${r}`,i];default:return[`filter-${r}`,e,i]}}function oR(e,i){if(0===i.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(e=>typeof e!=typeof i[0])?["filter-in-large",e,["literal",i.sort(oC)]]:["filter-in-small",e,["literal",i]]}}function oM(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function oP(e){return["!",e]}function oO(e,i){return i?`${e}${i}`:e}let ok="-transition",oL=new Set(["fill","line","background","hillshade","raster"]);class oD extends it{constructor(e,i,r,n,o){if(super(),this.id=e.id,this.fqid=oO(this.id,r),this.type=e.type,this.scope=r,this.lut=n,this.options=o,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let i=nj(this.filter,ox[`filter_${e.type}`]);"error"!==i.result&&(this.configDependencies=new Set([...this.configDependencies,...i.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new op(i.layout,this.scope,o),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){for(let r in this._transitionablePaint=new ou(i.paint,this.scope,o),e.paint)this.setPaintProperty(r,e.paint[r]);for(let i in e.layout)this.setLayoutProperty(i,e.layout[i]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new om(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&oL.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if("custom"===this.type&&"visibility"===e)return void(this.visibility=i);let r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ok)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let r=this._transitionablePaint,n=r._properties.properties;if(e.endsWith(ok)){let o=e.slice(0,-11);return n[o]&&r.setTransition(o,i||void 0),!1}if(!n[e])return!1;let o=r._values[e],a=o.value.isDataDriven(),s=o.value;r.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let l=r._values[e].value,h=l.isDataDriven(),u=e.endsWith("pattern")||"line-dasharray"===e;return h||a||u||this._handleOverridablePaintPropertyUpdate(e,s,l)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,r){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return tc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(void 0===e||"layout"===i&&!Object.keys(e).length||"paint"===i&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof of&&nC(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=oS(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,r,n,o,a,s,l,h){}}let oz={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class oF{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class oB{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function oN(e,i=1){let r=0,n=0;return{members:e.map(e=>{let o=oz[e.type].BYTES_PER_ELEMENT,a=r=oj(r,Math.max(i,o)),s=e.components||1;return n=Math.max(n,o),r+=o*s,{name:e.name,type:e.type,components:s,offset:a}}),size:oj(r,Math.max(n,i)),alignment:i}}function oj(e,i){return Math.ceil(e/i)*i}class oV extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){let n=2*e;return this.int16[n+0]=i,this.int16[n+1]=r,e}}oV.prototype.bytesPerElement=4,nX(oV,"StructArrayLayout2i4");class oU extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){let o=3*e;return this.int16[o+0]=i,this.int16[o+1]=r,this.int16[o+2]=n,e}}oU.prototype.bytesPerElement=6,nX(oU,"StructArrayLayout3i6");class oG extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,i,r,n)}emplace(e,i,r,n,o){let a=4*e;return this.int16[a+0]=i,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=o,e}}oG.prototype.bytesPerElement=8,nX(oG,"StructArrayLayout4i8");class oq extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[+e+0]=i,e}}oq.prototype.bytesPerElement=4,nX(oq,"StructArrayLayout1f4");class o$ extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){let o=4*e;return this.int16[o+0]=i,this.int16[o+1]=r,this.float32[2*e+1]=n,e}}o$.prototype.bytesPerElement=8,nX(o$,"StructArrayLayout2i1f8");class oH extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){let o=4*e;return this.int16[o+0]=i,this.int16[o+1]=r,this.int16[o+2]=n,e}}oH.prototype.bytesPerElement=8,nX(oH,"StructArrayLayout3i8");class oZ extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,o)}emplace(e,i,r,n,o,a){let s=5*e;return this.int16[s+0]=i,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=o,this.int16[s+4]=a,e}}oZ.prototype.bytesPerElement=10,nX(oZ,"StructArrayLayout5i10");class oW extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,r,n,o,a,s)}emplace(e,i,r,n,o,a,s,l){let h=6*e,u=12*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=o,this.uint8[u+6]=a,this.uint8[u+7]=s,this.float32[3*e+2]=l,e}}oW.prototype.bytesPerElement=12,nX(oW,"StructArrayLayout2i4ub1f12");class oX extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){let o=3*e;return this.float32[o+0]=i,this.float32[o+1]=r,this.float32[o+2]=n,e}}oX.prototype.bytesPerElement=12,nX(oX,"StructArrayLayout3f12");class oY extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,o)}emplace(e,i,r,n,o,a){let s=6*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,this.uint16[s+2]=n,this.uint16[s+3]=o,this.float32[3*e+2]=a,e}}oY.prototype.bytesPerElement=12,nX(oY,"StructArrayLayout4ui1f12");class oK extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,i,r,n)}emplace(e,i,r,n,o){let a=4*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=o,e}}oK.prototype.bytesPerElement=8,nX(oK,"StructArrayLayout4ui8");class oJ extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n,o,a)}emplace(e,i,r,n,o,a,s){let l=6*e;return this.int16[l+0]=i,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+3]=o,this.int16[l+4]=a,this.int16[l+5]=s,e}}oJ.prototype.bytesPerElement=12,nX(oJ,"StructArrayLayout6i12");class oQ extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,n,o,a,s,l,h,u,c,d)}emplace(e,i,r,n,o,a,s,l,h,u,c,d,p){let f=12*e;return this.int16[f+0]=i,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=o,this.uint16[f+4]=a,this.uint16[f+5]=s,this.uint16[f+6]=l,this.uint16[f+7]=h,this.int16[f+8]=u,this.int16[f+9]=c,this.int16[f+10]=d,this.int16[f+11]=p,e}}oQ.prototype.bytesPerElement=24,nX(oQ,"StructArrayLayout4i4ui4i24");class o0 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n,o,a)}emplace(e,i,r,n,o,a,s){let l=10*e,h=5*e;return this.int16[l+0]=i,this.int16[l+1]=r,this.int16[l+2]=n,this.float32[h+2]=o,this.float32[h+3]=a,this.float32[h+4]=s,e}}o0.prototype.bytesPerElement=20,nX(o0,"StructArrayLayout3i3f20");class o1 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,i,r,n)}emplace(e,i,r,n,o){let a=4*e;return this.float32[a+0]=i,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=o,e}}o1.prototype.bytesPerElement=16,nX(o1,"StructArrayLayout4f16");class o2 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[+e+0]=i,e}}o2.prototype.bytesPerElement=4,nX(o2,"StructArrayLayout1ul4");class o3 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){let n=2*e;return this.uint16[n+0]=i,this.uint16[n+1]=r,e}}o3.prototype.bytesPerElement=4,nX(o3,"StructArrayLayout2ui4");class o5 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c,d,p){let f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,n,o,a,s,l,h,u,c,d,p)}emplace(e,i,r,n,o,a,s,l,h,u,c,d,p,f){let m=20*e,g=10*e;return this.int16[m+0]=i,this.int16[m+1]=r,this.int16[m+2]=n,this.int16[m+3]=o,this.int16[m+4]=a,this.float32[g+3]=s,this.float32[g+4]=l,this.float32[g+5]=h,this.float32[g+6]=u,this.int16[m+14]=c,this.uint32[g+8]=d,this.uint16[m+18]=p,this.uint16[m+19]=f,e}}o5.prototype.bytesPerElement=40,nX(o5,"StructArrayLayout5i4f1i1ul2ui40");class o4 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,r,n,o,a,s)}emplace(e,i,r,n,o,a,s,l){let h=8*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.int16[h+2]=n,this.int16[h+4]=o,this.int16[h+5]=a,this.int16[h+6]=s,this.int16[h+7]=l,e}}o4.prototype.bytesPerElement=16,nX(o4,"StructArrayLayout3i2i2i16");class o6 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,o)}emplace(e,i,r,n,o,a){let s=4*e,l=8*e;return this.float32[s+0]=i,this.float32[s+1]=r,this.float32[s+2]=n,this.int16[l+6]=o,this.int16[l+7]=a,e}}o6.prototype.bytesPerElement=16,nX(o6,"StructArrayLayout2f1f2i16");class o8 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,r,n,o,a)}emplace(e,i,r,n,o,a,s){let l=20*e,h=5*e;return this.uint8[l+0]=i,this.uint8[l+1]=r,this.float32[h+1]=n,this.float32[h+2]=o,this.float32[h+3]=a,this.float32[h+4]=s,e}}o8.prototype.bytesPerElement=20,nX(o8,"StructArrayLayout2ub4f20");class o9 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,i,r)}emplace(e,i,r,n){let o=3*e;return this.uint16[o+0]=i,this.uint16[o+1]=r,this.uint16[o+2]=n,e}}o9.prototype.bytesPerElement=6,nX(o9,"StructArrayLayout3ui6");class o7 extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b){let w=this.length;return this.resize(w+1),this.emplace(w,e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b)}emplace(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w){let T=30*e,S=15*e,E=60*e;return this.int16[T+0]=i,this.int16[T+1]=r,this.int16[T+2]=n,this.float32[S+2]=o,this.float32[S+3]=a,this.uint16[T+8]=s,this.uint16[T+9]=l,this.uint32[S+5]=h,this.uint32[S+6]=u,this.uint32[S+7]=c,this.uint16[T+16]=d,this.uint16[T+17]=p,this.uint16[T+18]=f,this.float32[S+10]=m,this.float32[S+11]=g,this.uint8[E+48]=_,this.uint8[E+49]=y,this.uint8[E+50]=v,this.uint32[S+13]=x,this.int16[T+28]=b,this.uint8[E+58]=w,e}}o7.prototype.bytesPerElement=60,nX(o7,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ae extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k){let L=this.length;return this.resize(L+1),this.emplace(L,e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k)}emplace(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k,L){let D=20*e,z=40*e;return this.float32[D+0]=i,this.float32[D+1]=r,this.int16[z+4]=n,this.int16[z+5]=o,this.int16[z+6]=a,this.int16[z+7]=s,this.int16[z+8]=l,this.int16[z+9]=h,this.int16[z+10]=u,this.int16[z+11]=c,this.int16[z+12]=d,this.uint16[z+13]=p,this.uint16[z+14]=f,this.uint16[z+15]=m,this.uint16[z+16]=g,this.uint16[z+17]=_,this.uint16[z+18]=y,this.uint16[z+19]=v,this.uint16[z+20]=x,this.uint16[z+21]=b,this.uint16[z+22]=w,this.uint16[z+23]=T,this.uint16[z+24]=S,this.uint16[z+25]=E,this.uint16[z+26]=I,this.uint16[z+27]=C,this.uint32[D+14]=A,this.float32[D+15]=R,this.float32[D+16]=M,this.float32[D+17]=P,this.float32[D+18]=O,this.uint8[80*e+76]=k,this.uint16[z+39]=L,e}}ae.prototype.bytesPerElement=80,nX(ae,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class at extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o){let a=this.length;return this.resize(a+1),this.emplace(a,e,i,r,n,o)}emplace(e,i,r,n,o,a){let s=5*e;return this.float32[s+0]=i,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=o,this.float32[s+4]=a,e}}at.prototype.bytesPerElement=20,nX(at,"StructArrayLayout5f20");class ai extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,r,n,o,a,s)}emplace(e,i,r,n,o,a,s,l){let h=7*e;return this.float32[h+0]=i,this.float32[h+1]=r,this.float32[h+2]=n,this.float32[h+3]=o,this.float32[h+4]=a,this.float32[h+5]=s,this.float32[h+6]=l,e}}ai.prototype.bytesPerElement=28,nX(ai,"StructArrayLayout7f28");class ar extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,n,o,a,s,l,h,u,c)}emplace(e,i,r,n,o,a,s,l,h,u,c,d){let p=11*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=n,this.float32[p+3]=o,this.float32[p+4]=a,this.float32[p+5]=s,this.float32[p+6]=l,this.float32[p+7]=h,this.float32[p+8]=u,this.float32[p+9]=c,this.float32[p+10]=d,e}}ar.prototype.bytesPerElement=44,nX(ar,"StructArrayLayout11f44");class an extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,n,o,a,s,l,h)}emplace(e,i,r,n,o,a,s,l,h,u){let c=9*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=n,this.float32[c+3]=o,this.float32[c+4]=a,this.float32[c+5]=s,this.float32[c+6]=l,this.float32[c+7]=h,this.float32[c+8]=u,e}}an.prototype.bytesPerElement=36,nX(an,"StructArrayLayout9f36");class ao extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){let n=2*e;return this.float32[n+0]=i,this.float32[n+1]=r,e}}ao.prototype.bytesPerElement=8,nX(ao,"StructArrayLayout2f8");class aa extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,n){let o=this.length;return this.resize(o+1),this.emplace(o,e,i,r,n)}emplace(e,i,r,n,o){let a=6*e;return this.uint32[3*e+0]=i,this.uint16[a+2]=r,this.uint16[a+3]=n,this.uint16[a+4]=o,e}}aa.prototype.bytesPerElement=12,nX(aa,"StructArrayLayout1ul3ui12");class as extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[+e+0]=i,e}}as.prototype.bytesPerElement=2,nX(as,"StructArrayLayout1ui2");class al extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g)}emplace(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_){let y=16*e;return this.float32[y+0]=i,this.float32[y+1]=r,this.float32[y+2]=n,this.float32[y+3]=o,this.float32[y+4]=a,this.float32[y+5]=s,this.float32[y+6]=l,this.float32[y+7]=h,this.float32[y+8]=u,this.float32[y+9]=c,this.float32[y+10]=d,this.float32[y+11]=p,this.float32[y+12]=f,this.float32[y+13]=m,this.float32[y+14]=g,this.float32[y+15]=_,e}}al.prototype.bytesPerElement=64,nX(al,"StructArrayLayout16f64");class ah extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,n,o,a,s){let l=this.length;return this.resize(l+1),this.emplace(l,e,i,r,n,o,a,s)}emplace(e,i,r,n,o,a,s,l){let h=10*e,u=5*e;return this.uint16[h+0]=i,this.uint16[h+1]=r,this.uint16[h+2]=n,this.uint16[h+3]=o,this.float32[u+2]=a,this.float32[u+3]=s,this.float32[u+4]=l,e}}ah.prototype.bytesPerElement=20,nX(ah,"StructArrayLayout4ui3f20");class au extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[+e+0]=i,e}}au.prototype.bytesPerElement=2,nX(au,"StructArrayLayout1i2");class ac extends oB{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[+e+0]=i,e}}ac.prototype.bytesPerElement=1,nX(ac,"StructArrayLayout1ub1");class ad extends oF{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ad.prototype.size=40;class ap extends o5{get(e){return new ad(this,e)}}nX(ap,"CollisionBoxArray");class af extends oF{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}af.prototype.size=60;class am extends o7{get(e){return new af(this,e)}}nX(am,"PlacedSymbolArray");class ag extends oF{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ag.prototype.size=80;class a_ extends ae{get(e){return new ag(this,e)}}nX(a_,"SymbolInstanceArray");class ay extends oq{getoffsetX(e){return this.float32[+e+0]}}nX(ay,"GlyphOffsetArray");class av extends oV{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}nX(av,"SymbolLineVertexArray");class ax extends oF{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ax.prototype.size=12;class ab extends aa{get(e){return new ax(this,e)}}nX(ab,"FeatureIndexArray");class aw extends o3{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}nX(aw,"FillExtrusionCentroidArray");class aT extends oF{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}aT.prototype.size=6;class aS extends oU{get(e){return new aT(this,e)}}nX(aS,"FillExtrusionWallArray");let aE=oN([{name:"a_pos",components:2,type:"Int16"}],4),aI=oN([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class aC{constructor(e=[]){this.segments=e}_prepareSegment(e,i,r,n){let o=this.segments[this.segments.length-1];return e>aC.MAX_VERTEX_ARRAY_LENGTH&&tf(`Max vertices per segment is ${aC.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!o||o.vertexLength+e>aC.MAX_VERTEX_ARRAY_LENGTH||o.sortKey!==n)&&(o={vertexOffset:i,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==n&&(o.sortKey=n),this.segments.push(o)),o}prepareSegment(e,i,r,n){return this._prepareSegment(e,i.length,r.length,n)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,n){return new aC([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function aA(e,i){return 256*(e=tt(Math.floor(e),0,255))+tt(Math.floor(i),0,255)}aC.MAX_VERTEX_ARRAY_LENGTH=65535,nX(aC,"SegmentVector");let aR=oN([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),aM=oN([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),aP=oN([{name:"a_dash",components:4,type:"Uint16"}]);class aO{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,r,n){this.ids.push(ak(e)),this.positions.push(i,r,n)}eachPosition(e,i){let r=ak(e),n=0,o=this.ids.length-1;for(;n<o;){let e=n+o>>1;this.ids[e]>=r?o=e:n=e+1}for(;this.ids[n]===r;)i(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,i){let r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return function e(i,r,n,o){for(;n<o;){let a=i[n+o>>1],s=n-1,l=o+1;for(;;){do s++;while(i[s]<a)do l--;while(i[l]>a)if(s>=l)break;aL(i,s,l),aL(r,3*s,3*l),aL(r,3*s+1,3*l+1),aL(r,3*s+2,3*l+2)}l-n<o-l?(e(i,r,n,l),n=l+1):(e(i,r,l+1,o),o=l)}}(r,n,0,r.length-1),i&&(i.add(r.buffer),i.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){let i,r=new aO;for(let n of(r.ids=e.ids,r.positions=e.positions,r.ids))n!==i&&r.uniqueIds.push(n),i=n;return r.indexed=!0,r}}function ak(e){let i=+e;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:t6(String(e))}function aL(e,i,r){let n=e[i];e[i]=e[r],e[r]=n}nX(aO,"FeaturePositionMap");class aD{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,r){throw Error("Uniform#set() must be implemented by each concrete Uniform")}}class az extends aD{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class aF extends aD{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class aB extends aD{constructor(e){super(e),this.current=[0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class aN extends aD{constructor(e){super(e),this.current=[0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class aj extends aD{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class aV extends aD{constructor(e){super(e),this.current=is.transparent.toRenderColor(null)}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}let aU=new Float32Array(16);class aG extends aD{constructor(e){super(e),this.current=aU}set(e,i,r){if(this.fetchUniformLocation(e,i)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}let aq=new Float32Array(9),a$=new Float32Array(4);class aH extends aD{constructor(e){super(e),this.current=a$}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function aZ(e){return[aA(255*e.r,255*e.g),aA(255*e.b,255*e.a)]}class aW{constructor(e,i,r,n){this.value=e,this.uniformNames=i.map(e=>`u_${e}`),this.type=r,this.context=n}setUniform(e,i,r,n,o){let a=n.constantOr(this.value);i.set(e,o,a instanceof is?a.toRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):a)}getBinding(e,i){return"color"===this.type?new aV(e):new aF(e)}}class aX{constructor(e,i){this.uniformNames=i.map(e=>`u_${e}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,r,n,o){let a=null;"u_pattern"!==o&&"u_dash"!==o||(a=this.pattern),"u_pattern_b"===o&&(a=this.patternTransition),"u_pixel_ratio"===o&&(a=this.pixelRatio),a&&i.set(e,o,a)}getBinding(e,i){return"u_pattern"===i||"u_pattern_b"===i||"u_dash"===i?new aj(e):new aF(e)}}class aY{constructor(e,i,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,i,r,n,o,a,s){let l=this.paintVertexArray.length,h="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new os(0,{brightness:a}),i,{},o,n,s):"constant"===this.expression.kind&&this.expression.value,u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new os(0,{brightness:a}),i,{},o,n,s):this.lutExpression.value);this.paintVertexArray.resize(e),this._setPaintValue(l,e,h,u?null:this.context.lut)}updatePaintArray(e,i,r,n,o,a,s){let l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:s},r,n,void 0,o):"constant"===this.expression.kind&&this.expression.value,h=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new os(0,{brightness:s}),r,n,void 0,o):this.lutExpression.value);this._setPaintValue(e,i,l,h?null:this.context.lut)}_setPaintValue(e,i,r,n){if("color"===this.type){let o=aZ(r.toRenderColor(n));for(let r=e;r<i;r++)this.paintVertexArray.emplace(r,o[0],o[1])}else{for(let n=e;n<i;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aK{constructor(e,i,r,n,o,a){this.expression=e,this.uniformNames=i.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=n,this.context=o,this.maxValue=0,this.paintVertexAttributes=i.map(e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,n,o,a,s){let l=this.expression.evaluate(new os(this.context.zoom,{brightness:a}),i,{},o,n,s),h=this.expression.evaluate(new os(this.context.zoom+1,{brightness:a}),i,{},o,n,s),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new os(0,{brightness:a}),i,{},o,n,s):this.lutExpression.value),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,l,h,u?null:this.context.lut)}updatePaintArray(e,i,r,n,o,a,s){let l=this.expression.evaluate({zoom:this.context.zoom,brightness:s},r,n,void 0,o),h=this.expression.evaluate({zoom:this.context.zoom+1,brightness:s},r,n,void 0,o),u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new os(0,{brightness:s}),r,n,void 0,o):this.lutExpression.value);this._setPaintValue(e,i,l,h,u?null:this.context.lut)}_setPaintValue(e,i,r,n,o){if("color"===this.type){let n=aZ(r.toRenderColor(o)),a=aZ(r.toRenderColor(o));for(let r=e;r<i;r++)this.paintVertexArray.emplace(r,n[0],n[1],a[0],a[1])}else{for(let o=e;o<i;o++)this.paintVertexArray.emplace(o,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,n,o){let a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,s=tt(this.expression.interpolationFactor(a,this.context.zoom,this.context.zoom+1),0,1);i.set(e,o,s)}getBinding(e,i){return new aF(e)}}class aJ{constructor(e,i,r,n,o){this.expression=e,this.layerId=o,this.paintVertexAttributes=("array"===r?aP:aR).members;for(let e=0;e<i.length;++e);this.paintVertexArray=new n,this.paintTransitionVertexArray=new oY}populatePaintArray(e,i,r,n){let o=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(o,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,n,o,a,s){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],a)}_setPaintValues(e,i,r,n){if(!n||!r)return;let o=n[r[0]],a=n[r[1]];if(o){if(o){let{tl:r,br:n,pixelRatio:a}=o;for(let o=e;o<i;o++)this.paintVertexArray.emplace(o,r[0],r[1],n[0],n[1],a)}if(a){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);let{tl:r,br:n,pixelRatio:o}=a;for(let a=e;a<i;a++)this.paintTransitionVertexArray.emplace(a,r[0],r[1],n[0],n[1],o)}}}upload(e){let i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,aM.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class aQ{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[],this.context=i;let n=[];for(let s in e.paint._values){var o,a;let l=e.paint.get(s);if(s.endsWith("-use-theme")||!r(s)||!(l instanceof of&&nC(l.property.specification)))continue;let h=(o=s,a=e.type,a1[o]||[o.replace(`${a}-`,"").replace(/-/g,"_")]),u=l.value,c=l.property.specification.type,d=!!l.property.useIntegerZoom,p="line-dasharray"===s||s.endsWith("pattern"),f=e.paint.get(`${s}-use-theme`),m="line-dasharray"===s&&"constant"!==e.layout.get("line-cap").value.kind||f&&"constant"!==f.value.kind;if("constant"!==u.kind||m)if("source"===u.kind||m||p){let i=a5(s,c,"source");this.binders[s]=p?new aJ(u,h,c,i,e.id):new aY(u,h,c,i),n.push(`/a_${s}`)}else{let e=a5(s,c,"composite");this.binders[s]=new aK(u,h,c,d,i,e),n.push(`/z_${s}`)}else this.binders[s]=p?new aX(u.value,h):new aW(u.value,h,c,i),n.push(`/u_${s}`);f&&(this.binders[s].lutExpression=f.value)}this.cacheKey=n.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof aY||i instanceof aK?i.maxValue:0}populatePaintArrays(e,i,r,n,o,a,s){for(let l in this.binders){let h=this.binders[l];h.context=this.context,(h instanceof aY||h instanceof aK||h instanceof aJ)&&h.populatePaintArray(e,i,r,n,o,a,s)}}setConstantPatternPositions(e,i){for(let r in this.binders){let n=this.binders[r];n instanceof aX&&n.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){let i=this.binders[e];return i instanceof aJ?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,r,n,o,a,s,l,h){let u=!1,c=Object.keys(e),d=0!==c.length&&!l,p=d?c:i.uniqueIds;for(let l in this.context.lut=o.lut,this.binders){let c=this.binders[l];if(c.context=this.context,(c instanceof aY||c instanceof aK||c instanceof aJ)&&c.expression&&c.expression.kind&&"constant"!==c.expression.kind&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){for(let r of(c.expression=o.paint.get(l).value,p)){let o=e[r.toString()];i.eachPosition(r,(e,i,r)=>{let l=n.feature(e);c.updatePaintArray(i,r,l,o,a,s,h)})}if(!d)for(let i of r.uniqueIds){let o=e[i.toString()];r.eachPosition(i,(e,i,r)=>{let l=n.feature(e);c.updatePaintArray(i,r,l,o,a,s,h)})}u=!0}}return u}defines(){let e=[];for(let i in this.binders){let r=this.binders[i];(r instanceof aW||r instanceof aX)&&e.push(...r.uniformNames.map(e=>`#define HAS_UNIFORM_${e}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let r=this.binders[i];if(r instanceof aY||r instanceof aK||r instanceof aJ)for(let i=0;i<r.paintVertexAttributes.length;i++)e.push(r.paintVertexAttributes[i].name);if(r instanceof aJ)for(let i=0;i<aM.members.length;i++)e.push(aM.members[i].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let r=this.binders[i];if(r instanceof aW||r instanceof aX||r instanceof aK)for(let i of r.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof aW||n instanceof aX||n instanceof aK)for(let o of n.uniformNames)i.push({name:o,property:r,binding:n.getBinding(e,o)})}return i}setUniforms(e,i,r,n,o){for(let{name:i,property:a,binding:s}of r)this.binders[a].setUniform(e,s,o,n.get(a),i)}updatePaintBuffers(){for(let e in this._buffers=[],this.binders){let i=this.binders[e];(i instanceof aY||i instanceof aK||i instanceof aJ)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof aJ&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(let i in this.binders){let r=this.binders[i];(r instanceof aY||r instanceof aK||r instanceof aJ)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof aY||i instanceof aK||i instanceof aJ)&&i.destroy()}}}class a0{constructor(e,i,r=()=>!0){for(let n of(this.programConfigurations={},e))this.programConfigurations[n.id]=new aQ(n,i,r);this.needsUpload=!1,this._featureMap=new aO,this._featureMapWithoutIds=new aO,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,r,n,o,a,s,l){for(let r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,i,n,o,a,s,l);void 0!==i.id?this._featureMap.add(i.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,n,o,a,s){for(let l of r)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,l,n,o,a,s||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let a1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]},a2={"line-pattern":{source:oY,composite:oY},"fill-pattern":{source:oY,composite:oY},"fill-extrusion-pattern":{source:oY,composite:oY},"line-dasharray":{source:oK,composite:oK}},a3={color:{source:ao,composite:o1},number:{source:oq,composite:ao}};function a5(e,i,r){let n=a2[e];return n&&n[r]||a3[i][r]}nX(aW,"ConstantBinder"),nX(aX,"PatternConstantBinder"),nX(aY,"SourceExpressionBinder"),nX(aJ,"PatternCompositeBinder"),nX(aK,"CompositeExpressionBinder"),nX(aQ,"ProgramConfiguration",{omit:["_buffers"]}),nX(a0,"ProgramConfigurationSet");let a4=8192/Math.PI/2,a6=[64,32,16],a8=-a4;function a9(e,i,r,n=a4){return[e*Math.sin(r*=e4)*n,-i*n,e*Math.cos(r)*n]}function a7(e,i,r){return a9(Math.cos(e*e4),Math.sin(e*e4),i,r)}let se=2*Math.PI*6371008.8;class st{constructor(e,i){if(isNaN(e)||isNaN(i))throw Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new st(tr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,r=this.lat*i,n=e.lat*i;return 6371008.8*Math.acos(Math.min(Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*i),1))}toBounds(e=0){let i=360*e/0x2637f09,r=i/Math.cos(Math.PI/180*this.lat);return new si({lng:this.lng-r,lat:this.lat-i},{lng:this.lng+r,lat:this.lat+i})}toEcef(e){return a7(this.lat,this.lng,a4+e*a4/6371008.8)}static convert(e){if(e instanceof st)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new st(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new st(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class si{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof st?new st(e.lng,e.lat):st.convert(e),this}setSouthWest(e){return this._sw=e instanceof st?new st(e.lng,e.lat):st.convert(e),this}extend(e){let i,r,n=this._sw,o=this._ne;if(e instanceof st)i=e,r=e;else{if(!(e instanceof si))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(si.convert(e)):this.extend(st.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(st.convert(e)):this;if(i=e._sw,r=e._ne,!i||!r)return this}return n||o?(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this._sw=new st(i.lng,i.lat),this._ne=new st(r.lng,r.lat)),this}getCenter(){return new st((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new st(this.getWest(),this.getNorth())}getSouthEast(){return new st(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:r}=st.convert(e),n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){if(e)return e instanceof si?e:new si(e)}}function sr(e){return se*Math.cos(e*Math.PI/180)}function sn(e){return(180+e)/360}function so(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function sa(e){return 360*e-180}function ss(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function sl(e,i){return e*sr(ss(i))}function sh(e){return Math.cos(tt(e,-85.051129,85.051129)*e4)}function su(e,i){let r=Math.pow(2,tt(i,0,25.5));return sh(e)*se/(512*r)}function sc(e){return 1/Math.cos(e*Math.PI/180)}function sd(e,i=0){let r=Math.exp(Math.PI*(1-(e.y+i/8192)/(1<<e.z)*2));return 0x4c6fe12*r/(r*r+1)/8192/(1<<e.z)}class sp{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){let r=st.convert(e);return new sp(sn(r.lng),so(r.lat),i/sr(r.lat))}toLngLat(){return new st(sa(this.x),ss(this.y))}toAltitude(){return sl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/se*sc(ss(this.y))}}function sf(e,i,r){let n=e[0],o=n.x,a=n.y;i(n);let s=[n];for(let l=1;l<e.length;l++){let h=e[l],{x:u,y:c}=h;i(h),function e(i,r,n,o,a,s,l,h,u){let c=(r+o)/2,d=(n+a)/2,p=new e3(c,d);h(p),function(e,i,r,n,o,a){let s=r-o,l=n-a;return Math.abs((n-i)*s-(r-e)*l)/Math.hypot(s,l)}(p.x,p.y,s.x,s.y,l.x,l.y)>=u?(e(i,r,n,c,d,s,p,h,u),e(i,c,d,o,a,p,l,h,u)):i.push(l)}(s,o,a,u,c,n,h,i,r),o=u,a=c,n=h}return s}let sm=-16383-1;function sg(e,i,r){let n=e.loadGeometry(),o=e.extent,a=8192/o;if(i&&r&&r.projection.isReprojectedInTileSpace){let a=1<<i.z,{scale:s,x:l,y:h,projection:u}=r,c=e=>{let r=sa((i.x+e.x/o)/a),n=ss((i.y+e.y/o)/a),c=u.project(r,n);e.x=(c.x*s-l)*o,e.y=(c.y*s-h)*o};for(let i=0;i<n.length;i++)if(1!==e.type)n[i]=sf(n[i],c,1);else{let e=[];for(let r of n[i])r.x<0||r.x>=o||r.y<0||r.y>=o||(c(r),e.push(r));n[i]=e}}for(let e of n)for(let i of e){var s=i,l=a;let e=Math.round(s.x*l),r=Math.round(s.y*l);s.x=tt(e,sm,16383),s.y=tt(r,sm,16383),(e<s.x||e>s.x+1||r<s.y||r>s.y+1)&&tf("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function s_(e,i){return{type:e.type,id:e.id,properties:e.properties,geometry:i?sg(e):[]}}function sy(e,i,r,n,o){e.emplaceBack(2*i+(n+1)/2,2*r+(o+1)/2)}function sv(e,i,r){e.emplaceBack(i.x,i.y,i.z,16384*r[0],16384*r[1],16384*r[2])}class sx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new oV,this.indexArray=new o9,this.segments=new aC,this.programConfigurations=new a0(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}updateFootprints(e,i){}populate(e,i,r,n){let o=this.layers[0],a=[],s=null;for(let{feature:i,id:l,index:h,sourceLayerIndex:u}of("circle"===o.type&&(s=o.layout.get("circle-sort-key")),e)){let e=this.layers[0]._featureFilter.needGeometry,o=s_(i,e);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),o,r))continue;let c=s?s.evaluate(o,{},r):void 0,d={id:l,properties:i.properties,type:i.type,sourceLayerIndex:u,index:h,geometry:e?o.geometry:sg(i,r,n),patterns:{},sortKey:c};a.push(d)}s&&a.sort((e,i)=>e.sortKey-i.sortKey);let l=null;for(let o of("globe"===n.projection.name&&(this.globeExtVertexArray=new oJ,l=n.projection),a)){let{geometry:n,index:a,sourceLayerIndex:s}=o,h=e[a].feature;this.addFeature(o,n,a,i.availableImages,r,l,i.brightness),i.featureIndex.insert(h,n,a,s,this.index)}}update(e,i,r,n,o,a,s){this.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,aI.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,n,o,a,s){for(let r of i)for(let i of r){let r=i.x,n=i.y;if(r<0||r>=8192||n<0||n>=8192)continue;if(a){let e=a.projectTilePoint(r,n,o),i=a.upVector(o,r,n),s=this.globeExtVertexArray;sv(s,e,i),sv(s,e,i),sv(s,e,i),sv(s,e,i)}let s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),l=s.vertexLength;sy(this.layoutVertexArray,r,n,-1,-1),sy(this.layoutVertexArray,r,n,1,-1),sy(this.layoutVertexArray,r,n,1,1),sy(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(l,l+1,l+2),this.indexArray.emplaceBack(l,l+2,l+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,o,s)}}function sb(e,i){for(let r=0;r<e.length;r++)if(sA(i,e[r]))return!0;for(let r=0;r<i.length;r++)if(sA(e,i[r]))return!0;return!!sT(e,i)}function sw(e,i){if(1===e.length)return sC(i,e[0]);for(let r=0;r<i.length;r++){let n=i[r];for(let i=0;i<n.length;i++)if(sA(e,n[i]))return!0}for(let r=0;r<e.length;r++)if(sC(i,e[r]))return!0;for(let r=0;r<i.length;r++)if(sT(e,i[r]))return!0;return!1}function sT(e,i){if(0===e.length||0===i.length)return!1;for(let s=0;s<e.length-1;s++){let l=e[s],h=e[s+1];for(let e=0;e<i.length-1;e++){var r,n,o,a;if(r=l,n=h,o=i[e],tm(r,o,a=i[e+1])!==tm(n,o,a)&&tm(r,n,o)!==tm(r,n,a))return!0}}return!1}function sS(e,i,r){return(e.x-r.x)*(i.y-r.y)-(e.y-r.y)*(i.x-r.x)}function sE(e,i,r){let n=r*r;if(1===i.length)return e.distSqr(i[0])<n;for(let r=1;r<i.length;r++)if(sI(e,i[r-1],i[r])<n)return!0;return!1}function sI(e,i,r){let n=i.distSqr(r);if(0===n)return e.distSqr(i);let o=((e.x-i.x)*(r.x-i.x)+(e.y-i.y)*(r.y-i.y))/n;return e.distSqr(o<0?i:o>1?r:r.sub(i)._mult(o)._add(i))}function sC(e,i){let r,n,o,a=!1;for(let s=0;s<e.length;s++){r=e[s];for(let e=0,s=r.length-1;e<r.length;s=e++)n=r[e],o=r[s],n.y>i.y!=o.y>i.y&&i.x<(o.x-n.x)*(i.y-n.y)/(o.y-n.y)+n.x&&(a=!a)}return a}function sA(e,i){let r=!1;for(let n=0,o=e.length-1;n<e.length;o=n++){let a=e[n],s=e[o];a.y>i.y!=s.y>i.y&&i.x<(s.x-a.x)*(i.y-a.y)/(s.y-a.y)+a.x&&(r=!r)}return r}function sR(e,i,r,n,o){for(let a of e)if(i<=a.x&&r<=a.y&&n>=a.x&&o>=a.y)return!0;let a=[new e3(i,r),new e3(i,o),new e3(n,o),new e3(n,r)];if(e.length>2){for(let i of a)if(sA(e,i))return!0}for(let i=0;i<e.length-1;i++)if(sM(e[i],e[i+1],a))return!0;return!1}function sM(e,i,r){let n=r[0],o=r[2];if(e.x<n.x&&i.x<n.x||e.x>o.x&&i.x>o.x||e.y<n.y&&i.y<n.y||e.y>o.y&&i.y>o.y)return!1;let a=tm(e,i,r[0]);return a!==tm(e,i,r[1])||a!==tm(e,i,r[2])||a!==tm(e,i,r[3])}function sP(e,i,r,n,o,a){let s=i.y-e.y,l=e.x-i.x;if(a=a||0){let e=s*s+l*l;if(0===e)return!0;let i=Math.sqrt(e);s/=i,l/=i}return!((r.x-e.x)*s+(r.y-e.y)*l-a<0||(n.x-e.x)*s+(n.y-e.y)*l-a<0||(o.x-e.x)*s+(o.y-e.y)*l-a<0)}function sO(e,i,r,n,o,a,s){return!(sP(e,i,n,o,a,s)||sP(i,r,n,o,a,s)||sP(r,e,n,o,a,s)||sP(n,o,e,i,r,s)||sP(o,a,e,i,r,s)||sP(a,n,e,i,r,s))}function sk(e,i,r){let n=i.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(i.id).getMaxValue(e)}function sL(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function sD(e,i,r,n,o){if(!i[0]&&!i[1])return e;let a=e3.convert(i)._mult(o);"viewport"===r&&a._rotate(-n);let s=[];for(let i=0;i<e.length;i++)s.push(e[i].sub(a));return s}function sz(e,i,r,n){let o=e3.convert(e)._mult(n);return"viewport"===i&&o._rotate(-r),o}function sF(e,i,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,i*n-2*Math.PI*6378137/2]}nX(sx,"CircleBucket",{omit:["layers"]});class sB{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=sV(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){var r,n,o,a,s;let l=(r=this.x,n=this.y,a=sF(256*r,256*(n=Math.pow(2,o=this.z)-n-1),o),s=sF(256*(r+1),256*(n+1),o),a[0]+","+a[1]+","+s[0]+","+s[1]),h=function(e,i,r){let n,o="";for(let a=e;a>0;a--)o+=(i&(n=1<<a-1)?1:0)+(r&n?2:0);return o}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sN{constructor(e,i){this.wrap=e,this.canonical=i,this.key=sV(e,i.z,i.z,i.x,i.y)}}class sj{constructor(e,i,r,n,o){this.overscaledZ=e,this.wrap=i,this.canonical=new sB(r,+n,+o),this.key=0===i&&e===r?this.canonical.key:sV(i,e,r,n,o)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new sj(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sj(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return sV(this.wrap*i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let r=this.canonical.z-e;return sV(this.wrap*i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new sj(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new sj(i,this.wrap,i,r,n),new sj(i,this.wrap,i,r+1,n),new sj(i,this.wrap,i,r,n+1),new sj(i,this.wrap,i,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new sj(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new sj(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sN(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sV(e,i,r,n,o){let a=1<<Math.min(r,22),s=o%a*a+n%a;return e&&r<22&&(s+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*s+r)+(i-r)}let sU=[e=>{let i=e.canonical.x-1,r=e.wrap;return i<0&&(i=(1<<e.canonical.z)-1,r--),new sj(e.overscaledZ,r,e.canonical.z,i,e.canonical.y)},e=>{let i=e.canonical.x+1,r=e.wrap;return i===1<<e.canonical.z&&(i=0,r++),new sj(e.overscaledZ,r,e.canonical.z,i,e.canonical.y)},e=>new sj(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new sj(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];nX(sB,"CanonicalTileID"),nX(sj,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let{members:sG}=oN([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),sq=oN([{name:"a_pos_3",components:3,type:"Int16"}]);var s$=oN([{name:"a_pos",type:"Int16",components:2}]);class sH{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){let n=eK(i,this.dir);if(1e-6>Math.abs(n))return!1;let o=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/n;return r[0]=this.pos[0]+this.dir[0]*o,r[1]=this.pos[1]+this.dir[1]*o,!0}}class sZ{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){let n=eT(i,this.dir);if(1e-6>Math.abs(n))return!1;let o=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*o,r[1]=this.pos[1]+this.dir[1]*o,r[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(e,i,r){var n,o,a,s,l,h,u;if(n=this.pos,o=n[0],a=n[1],s=n[2],l=e[0],h=e[1],u=e[2],Math.abs(o-l)<=1e-6*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=1e-6*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-u)<=1e-6*Math.max(1,Math.abs(s),Math.abs(u))||0===i)return r[0]=r[1]=r[2]=0,!1;let[c,d,p]=this.dir,f=this.pos[0]-e[0],m=this.pos[1]-e[1],g=this.pos[2]-e[2],_=c*c+d*d+p*p,y=2*(f*c+m*d+g*p),v=y*y-4*_*(f*f+m*m+g*g-i*i);if(v<0){let e=Math.max(-y/2,0),n=f+c*e,o=m+d*e,a=g+p*e,s=Math.hypot(n,o,a);return r[0]=n*i/s,r[1]=o*i/s,r[2]=a*i/s,!1}{let e=(-y-Math.sqrt(v))/(2*_);if(e<0){let e=Math.hypot(f,m,g);return r[0]=f*i/e,r[1]=m*i/e,r[2]=g*i/e,!1}return r[0]=f+c*e,r[1]=m+d*e,r[2]=g+p*e,!0}}}class sW{constructor(e,i,r,n,o){this.TL=e,this.TR=i,this.BR=r,this.BL=n,this.horizon=o}static fromInvProjectionMatrix(e,i,r){let n=[-1,1,1],o=[1,1,1],a=[1,-1,1],s=[-1,-1,1],l=eI(n,n,e),h=eI(o,o,e);return new sW(l,h,eI(a,a,e),eI(s,s,e),i/r)}}function sX(e,i,r){let n=1/0,o=-1/0,a=[];for(let s of e){ep(a,s,i);let e=eT(a,r);n=Math.min(n,e),o=Math.max(o,e)}return[n,o]}function sY(e,i){let r=!0;for(let n=0;n<e.planes.length;n++){let o=e.planes[n],a=0;for(let e=0;e<i.length;e++)a+=eT(o,i[e])+o[3]>=0;if(0===a)return 0;a!==i.length&&(r=!1)}return r?2:1}function sK(e,i){for(let r of e.projections){let n=sX(i,e.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function sJ(e,i){let r=0,n=[0,0,0,0];for(let o=0;o<e.length;o++)n[0]=e[o][0],n[1]=e[o][1],n[2]=e[o][2],n[3]=1,n[0]*i[0]+n[1]*i[1]+n[2]*i[2]+n[3]*i[3]>=0&&r++;return r}class sQ{constructor(e,i){for(let r of(this.points=e||Array(8).fill([0,0,0]),this.planes=i||Array(6).fill([0,0,0,0]),this.bounds=s0.fromPoints(this.points),this.projections=[],this.frustumEdges=[ep([],this.points[2],this.points[3]),ep([],this.points[0],this.points[3]),ep([],this.points[4],this.points[0]),ep([],this.points[5],this.points[1]),ep([],this.points[6],this.points[2]),ep([],this.points[7],this.points[3])],this.frustumEdges)){let e=[0,-r[2],r[1]],i=[r[2],0,-r[0]];this.projections.push({axis:e,projection:sX(this.points,this.points[0],e)}),this.projections.push({axis:i,projection:sX(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(e,i,r,n){let o=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>{var a;let s=ek([],r,e),l=1/s[3]/i*o;return s[0]=s[0]*(a=[l,l,n?1/s[3]:l,l])[0],s[1]=s[1]*a[1],s[2]=s[2]*a[2],s[3]=s[3]*a[3],s}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{let i=ew([],eS([],ep([],a[e[0]],a[e[1]]),ep([],a[e[2]],a[e[1]]))),r=-eT(i,a[e[1]]);return i.concat(r)}),l=[];for(let e=0;e<a.length;e++)l.push([a[e][0],a[e][1],a[e][2]]);return new sQ(l,s)}intersectsPrecise(e,i,r){for(let r=0;r<i.length;r++)if(!sJ(e,i[r]))return 0;for(let i=0;i<this.planes.length;i++)if(!sJ(e,this.planes[i]))return 0;for(let i of r)for(let r of this.frustumEdges){let n=eS([],i,r),o=eu(n);if(0===o)continue;e_(n,n,1/o);let a=sX(this.points,this.points[0],n),s=sX(e,this.points[0],n);if(a[0]>s[1]||s[0]>a[1])return 0}return 1}containsPoint(e){for(let i of this.planes){let r=i[3];if(eT([i[0],i[1],i[2]],e)+r<0)return!1}return!0}}class s0{static fromPoints(e){let i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(let n of e)em(i,i,n),eg(r,r,n);return new s0(i,r)}static fromTileIdAndHeight(e,i,r){let n=1<<e.canonical.z,o=e.canonical.x,a=e.canonical.y;return new s0([o/n,a/n,i],[(o+1)/n,(a+1)/n,r])}static applyTransform(e,i){let r=e.getCorners();for(let e=0;e<r.length;++e)eI(r[e],r[e],i);return s0.fromPoints(r)}static applyTransformFast(e,i){let r=[i[12],i[13],i[14]],n=[...r];for(let o=0;o<3;o++)for(let a=0;a<3;a++){let s=i[4*a+o],l=s*e.min[a],h=s*e.max[a];r[o]+=Math.min(l,h),n[o]+=Math.max(l,h)}return new s0(r,n)}static projectAabbCorners(e,i){let r=e.getCorners();for(let e=0;e<r.length;++e)eI(r[e],r[e],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=e_([],ed([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],r=eh(this.min),n=eh(this.max);for(let e=0;e<i.length;e++)r[e]=i[e]?this.min[e]:this.center[e],n[e]=i[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new s0(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?sY(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?sY(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?sK(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?sK(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function s1(e){return e*a4/6371008.8}nX(s0,"Aabb");let s2=[new s0([a8,a8,a8],[a4,a4,a4]),new s0([a8,a8,a8],[0,0,a4]),new s0([0,a8,a8],[a4,0,a4]),new s0([a8,0,a8],[0,a4,a4]),new s0([0,0,a8],[a4,a4,a4])];function s3(e,i,r,n=!0){let o=e_([],e._camera.position,e.worldSize),a=[i,r,1,1];ek(a,a,e.pixelMatrixInverse),eP(a,a,1/a[3]);let s=ew([],ep([],a,o)),l=e.globeMatrix,h=[l[12],l[13],l[14]],u=ep([],h,o),c=eu(u),d=ew([],u),p=e.worldSize/(2*Math.PI),f=eT(d,s),m=Math.asin(p/c);if(m<Math.acos(f)){if(!n)return null;let e=[],i=[];e_(e,s,c/f),ew(i,ep(i,e,u)),ew(s,ed(s,u,e_(s,i,Math.tan(m)*c)))}let g=[];new sZ(o,s).closestPointOnSphere(h,p,g);let _=ew([],tx(l,0)),y=ew([],tx(l,1)),v=ew([],tx(l,2)),x=eT(_,g),b=eT(y,g),w=eT(v,g),T=Math.asin(-b/p)*e6,S=Math.atan2(x,w)*e6;return new sp(sn(S=e.center.lng+function(e,i){let r=(i-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,S)),tt(so(T),0,1))}class s5{constructor(e,i,r){this.a=ep([],e,r),this.b=ep([],i,r),this.center=r;let n=ew([],this.a),o=ew([],this.b);this.angle=Math.acos(eT(n,o))}}function s4(e,i){let r;return 0===e.angle||(r=0===e.a[i]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[i]/e.a[i]/Math.sin(e.angle)-1/Math.tan(e.angle)))<0||r>1?null:function(e,i,r,n){let o=Math.sin(r);return Math.sin((1-n)*r)/o*e+Math.sin(n*r)/o*i}(e.a[i],e.b[i],e.angle,tt(r,0,1))+e.center[i]}function s6(e){if(e.z<=1)return s2[e.z+2*e.y+e.x];let i=lt(le(e));return s0.fromPoints(i)}function s8(e,i,r){return e_(e,e,1-r),ey(e,e,i,r)}function s9(e,i,r){for(let n of e)eI(n,n,i),e_(n,n,r)}function s7(e,i,r,n){let o=i/e.worldSize,a=e.globeMatrix;if(r.z<=1){let e=s6(r).getCorners();return s9(e,a,o),s0.fromPoints(e)}let s=le(r,n),l=lt(s,a4+s1(e._tileCoverLift));s9(l,a,o);let h=Number.MAX_VALUE,u=[-h,-h,-h],c=[h,h,h];if(s.contains(e.center)){for(let e of l)em(c,c,e),eg(u,u,e);u[2]=0;let i=e.point,r=[i.x*o,i.y*o,0];return em(c,c,r),eg(u,u,r),new s0(c,u)}if(e._tileCoverLift>0){for(let e of l)em(c,c,e),eg(u,u,e);return new s0(c,u)}let d=[a[12]*o,a[13]*o,a[14]*o],p=s.getCenter(),f=tt(e.center.lat,-85.051129,85.051129),m=tt(p.lat,-85.051129,85.051129),g=sn(e.center.lng),_=so(f),y=g-sn(p.lng),v=_-so(m);y>.5?y-=1:y<-.5&&(y+=1);let x=0;Math.abs(y)>Math.abs(v)?x=y>=0?1:3:(x=v>=0?0:2,ey(d,d,[a[4]*o,a[5]*o,a[6]*o],-Math.sin((v>=0?s.getSouth():s.getNorth())*e4)*a4));let b=l[x],w=l[(x+1)%4],T=new s5(b,w,d),S=[s4(T,0)||b[0],s4(T,1)||b[1],s4(T,2)||b[2]],E=lu(e.zoom);if(E>0){let n=function({x:e,y:i,z:r},n,o,a,s){let l=1/(1<<r),h=e*l,u=h+l,c=i*l,d=c+l,p=0,f=(h+u)/2-a;return f>.5?p=-1:f<-.5&&(p=1),h=((h+p)*n-(a*=n))*o+a,u=((u+p)*n-a)*o+a,c=(c*n-(s*=n))*o+s,[[h,d=(d*n-s)*o+s,0],[u,d,0],[u,c,0],[h,c,0]]}(r,i,e._pixelsPerMercatorPixel,g,_);for(let e=0;e<l.length;e++)s8(l[e],n[e],E);let o=ed([],n[x],n[(x+1)%4]);e_(o,o,.5),s8(S,o,E)}for(let e of l)em(c,c,e),eg(u,u,e);return c[2]=Math.min(b[2],w[2]),em(c,c,S),eg(u,u,S),new s0(c,u)}function le({x:e,y:i,z:r},n=!1){let o=1/(1<<r);return new si(new st(sa(e*o),i===(1<<r)-1&&n?-90:ss((i+1)*o)),new st(sa((e+1)*o),0===i&&n?90:ss(i*o)))}function lt(e,i=a4){let r=e.getNorth()*e4,n=e.getSouth()*e4,o=Math.cos(r),a=Math.cos(n),s=Math.sin(r),l=Math.sin(n),h=e.getWest(),u=e.getEast();return[a9(a,l,h,i),a9(a,l,u,i),a9(o,s,u,i),a9(o,s,h,i)]}function li(e,i,r,n){let o=1<<r.z,a=(e/8192+r.x)/o;return a7(ss((i/8192+r.y)/o),sa(a),n)}function lr({min:e,max:i}){return 16383/Math.max(i[0]-e[0],i[1]-e[1],i[2]-e[2])}let ln=new Float64Array(16);function lo(e){let i=lr(e),r=eo(ln,[i,i,i]);return ee(r,r,eb([],e.min))}function la(e){var i;let r=(i=e.min,ln[0]=1,ln[1]=0,ln[2]=0,ln[3]=0,ln[4]=0,ln[5]=1,ln[6]=0,ln[7]=0,ln[8]=0,ln[9]=0,ln[10]=1,ln[11]=0,ln[12]=i[0],ln[13]=i[1],ln[14]=i[2],ln[15]=1,ln),n=1/lr(e);return et(r,r,[n,n,n])}function ls(e){return e/(2*Math.PI)/(8192/(2*Math.PI))}function ll(e,i){return 8192/(512*Math.pow(2,e))*lr(s6(i))}function lh(e,i,r,n,o){let a=ls(r),s=[e,i,-r/(2*Math.PI)],l=K(new Float64Array(16));return ee(l,l,s),et(l,l,[a,a,a]),ei(l,l,-o*e4),er(l,l,-n*e4),l}function lu(e){return ti(5,6,e)}function lc(e,i){var r,n,o,a,s,l,h,u;let c=a7(i.lat,i.lng);return n=(r=ep([],function(e){let i=a7(e._center.lat,e._center.lng),r=eS([],ec(0,1,0),i),n=ea([],-e.angle,i);r=eI(r,r,n),ea(n,-e._pitch,r);let o=ew([],i);return e_(o,o,s1(e.cameraToCenterDistance/e.pixelsPerMeter)),eI(o,o,n),ed([],i,o)}(e),c))[0],o=r[1],a=r[2],s=c[0],Math.acos(Math.min(Math.max((u=Math.sqrt(n*n+o*o+a*a)*Math.sqrt(s*s+(l=c[1])*l+(h=c[2])*h))&&eT(r,c)/u,-1),1))}function ld(e,i){return lc(e,i)>Math.PI/2*1.01}let lp=85*e4,lf=Math.cos(lp),lm=Math.sin(lp),lg=Y(),l_=e=>{let i=[];return"map"===e.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i};function ly(e,i,r,n,o,a,s,l,h){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(h*=e.pixelToTileUnitsFactor);let u=e.tileID.canonical,c=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(let p of i)for(let i of p){var d;let p=i.add(l),f=o&&r.elevation?r.elevation.exaggeration()*o.getElevationAt(p.x,p.y,!0):0,m=r.projection.projectTilePoint(p.x,p.y,u);if(f>0){let e=r.projection.upVector(u,p.x,p.y);m.x+=e[0]*c*f,m.y+=e[1]*c*f,m.z+=e[2]*c*f}let g=a?p:function(e,i,r,n){let o=ek([],[e,i,r,1],n);return new e3(o[0]/o[3],o[1]/o[3])}(m.x,m.y,m.z,n),_=a?e.tilespaceRays.map(e=>(function(e,i){let r=el();return lv[2]=i,e.intersectsPlane(lv,lx,r),new e3(r[0],r[1])})(e,f)):e.queryGeometry.screenGeometry,y=ek([],[m.x,m.y,m.z,1],n);if(!s&&a?h*=y[3]/r.cameraToCenterDistance:s&&!a&&(h*=r.cameraToCenterDistance/y[3]),a){let e=ss((i.y/8192+u.y)/(1<<u.z));h/=r.projection.pixelsPerMeter(e,1)/(1/sr(e))}if(d=h,sA(_,g)||sE(g,_,d))return!0}return!1}let lv=ec(0,0,0),lx=ec(0,0,1);class lb extends sx{}function lw(e,{width:i,height:r},n,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==i*r*n)throw RangeError("mismatched image size")}else o=new Uint8Array(i*r*n);return e.width=i,e.height=r,e.data=o,e}function lT(e,i,r){let{width:n,height:o}=i;n===e.width&&o===e.height||(lS(e,i,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,o)},r,null),e.width=n,e.height=o,e.data=i.data)}function lS(e,i,r,n,o,a,s,l){if(0===o.width||0===o.height)return i;if(o.width>e.width||o.height>e.height||r.x>e.width-o.width||r.y>e.height-o.height)throw RangeError("out of range source coordinates for image copy");if(o.width>i.width||o.height>i.height||n.x>i.width-o.width||n.y>i.height-o.height)throw RangeError("out of range destination coordinates for image copy");let h=e.data,u=i.data,c=4===a&&l;for(let l=0;l<o.height;l++){let d=((r.y+l)*e.width+r.x)*a,p=((n.y+l)*i.width+n.x)*a;if(c)for(let e=0;e<o.width;e++){let i=d+e*a+3,r=p+e*a;u[r+0]=255,u[r+1]=255,u[r+2]=255,u[r+3]=h[i]}else if(s)for(let e=0;e<o.width;e++){let i=d+e*a,r=p+e*a,n=h[i+3],o=new is(h[i+0]/255*n,h[i+1]/255*n,h[i+2]/255*n,n).toRenderColor(s).toArray();u[r+0]=o[0],u[r+1]=o[1],u[r+2]=o[2],u[r+3]=o[3]}else for(let e=0;e<o.width*a;e++)u[p+e]=h[d+e]}return i}nX(lb,"HeatmapBucket",{omit:["layers"]});class lE{constructor(e,i){lw(this,e,1,i)}resize(e){lT(this,new lE(e),1)}clone(){return new lE({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,o){lS(e,i,r,n,o,1,null)}}class lI{constructor(e,i){lw(this,e,4,i)}resize(e){lT(this,new lI(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new lI({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,n,o,a,s){lS(e,i,r,n,o,4,a,s)}}class lC{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function lA(e){let i={},r=e.resolution||256,n=e.clips?e.clips.length:1,o=e.image||new lI({width:r,height:n}),a=(r,n,a)=>{i[e.evaluationKey]=a;let s=e.expression.evaluate(i);s&&(o.data[r+n+0]=Math.floor(255*s.r/s.a),o.data[r+n+1]=Math.floor(255*s.g/s.a),o.data[r+n+2]=Math.floor(255*s.b/s.a),o.data[r+n+3]=Math.floor(255*s.a))};if(e.clips)for(let i=0,o=0;i<n;++i,o+=4*r)for(let n=0,s=0;n<r;n++,s+=4){let l=n/(r-1),{start:h,end:u}=e.clips[i];a(o,s,h*(1-l)+u*l)}else for(let e=0,i=0;e<r;e++,i+=4)a(0,i,e/(r-1));return o}nX(lE,"AlphaImage"),nX(lI,"RGBAImage");let lR=oN([{name:"a_pos",components:2,type:"Int16"}],4),lM=oN([{name:"a_road_z_offset",components:1,type:"Float32"}],4),lP=oN([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),lO=oN([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function lk(e,i,r=2){let n,o,a,s=i&&i.length,l=s?i[0]*r:e.length,h=lL(e,0,l,r,!0),u=[];if(!h||h.next===h.prev)return u;if(s&&(h=function(e,i,r,n){let o=[];for(let r=0,a=i.length;r<a;r++){let s=lL(e,i[r]*n,r<a-1?i[r+1]*n:e.length,n,!1);s===s.next&&(s.steiner=!0),o.push(function(e){let i=e,r=e;do(i.x<r.x||i.x===r.x&&i.y<r.y)&&(r=i),i=i.next;while(i!==e)return r}(s))}o.sort(lz);for(let e=0;e<o.length;e++)r=function(e,i){let r=function(e,i){let r=i,n=e.x,o=e.y,a,s=-1/0;if(lV(e,r))return r;do{if(lV(e,r.next))return r.next;if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){let e=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>s&&(s=e,a=r.x<r.next.x?r:r.next,e===n))return a}r=r.next}while(r!==i)if(!a)return null;let l=a,h=a.x,u=a.y,c=1/0;r=a;do{if(n>=r.x&&r.x>=h&&n!==r.x&&lB(o<u?n:s,o,h,u,o<u?s:n,o,r.x,r.y)){var d,p;let i=Math.abs(o-r.y)/(n-r.x);l$(r,e)&&(i<c||i===c&&(r.x>a.x||r.x===a.x&&(d=a,p=r,0>lj(d.prev,d,p.prev)&&0>lj(p.next,d,d.next))))&&(a=r,c=i)}r=r.next}while(r!==l)return a}(e,i);if(!r)return i;let n=lH(r,e);return lD(n,n.next),lD(r,r.next)}(o[e],r);return r}(e,i,h,r)),e.length>80*r){n=1/0,o=1/0;let i=-1/0,s=-1/0;for(let a=r;a<l;a+=r){let r=e[a],l=e[a+1];r<n&&(n=r),l<o&&(o=l),r>i&&(i=r),l>s&&(s=l)}a=0!==(a=Math.max(i-n,s-o))?32767/a:0}return function e(i,r,n,o,a,s,l){if(!i)return;!l&&s&&function(e,i,r,n){let o=e;do 0===o.z&&(o.z=lF(o.x,o.y,i,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e)o.prevZ.nextZ=null,o.prevZ=null,function(e){let i,r=1;do{let n,o=e;e=null;let a=null;for(i=0;o;){i++;let s=o,l=0;for(let e=0;e<r&&(l++,s=s.nextZ);e++);let h=r;for(;l>0||h>0&&s;)0!==l&&(0===h||!s||o.z<=s.z)?(n=o,o=o.nextZ,l--):(n=s,s=s.nextZ,h--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;o=s}a.nextZ=null,r*=2}while(i>1)}(o)}(i,o,a,s);let h=i;for(;i.prev!==i.next;){let u=i.prev,c=i.next;if(s?function(e,i,r,n){let o=e.prev,a=e.next;if(lj(o,e,a)>=0)return!1;let s=o.x,l=e.x,h=a.x,u=o.y,c=e.y,d=a.y,p=Math.min(s,l,h),f=Math.min(u,c,d),m=Math.max(s,l,h),g=Math.max(u,c,d),_=lF(p,f,i,r,n),y=lF(m,g,i,r,n),v=e.prevZ,x=e.nextZ;for(;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==o&&v!==a&&lN(s,u,l,c,h,d,v.x,v.y)&&lj(v.prev,v,v.next)>=0||(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==o&&x!==a&&lN(s,u,l,c,h,d,x.x,x.y)&&lj(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==o&&v!==a&&lN(s,u,l,c,h,d,v.x,v.y)&&lj(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==o&&x!==a&&lN(s,u,l,c,h,d,x.x,x.y)&&lj(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(i,o,a,s):function(e){let i=e.prev,r=e.next;if(lj(i,e,r)>=0)return!1;let n=i.x,o=e.x,a=r.x,s=i.y,l=e.y,h=r.y,u=Math.min(n,o,a),c=Math.min(s,l,h),d=Math.max(n,o,a),p=Math.max(s,l,h),f=r.next;for(;f!==i;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&lN(n,s,o,l,a,h,f.x,f.y)&&lj(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}(i))r.push(u.i,i.i,c.i),lW(i),i=c.next,h=c.next;else if((i=c)===h){l?1===l?e(i=function(e,i){let r=e;do{let n=r.prev,o=r.next.next;!lV(n,o)&&lU(n,r,r.next,o)&&l$(n,o)&&l$(o,n)&&(i.push(n.i,r.i,o.i),lW(r),lW(r.next),r=e=o),r=r.next}while(r!==e)return lD(r)}(lD(i),r),r,n,o,a,s,2):2===l&&function(i,r,n,o,a,s){let l=i;do{let i=l.next.next;for(;i!==l.prev;){var h,u;if(l.i!==i.i&&(h=l,u=i,h.next.i!==u.i&&h.prev.i!==u.i&&!function(e,i){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==i.i&&r.next.i!==i.i&&lU(r,r.next,e,i))return!0;r=r.next}while(r!==e)return!1}(h,u)&&(l$(h,u)&&l$(u,h)&&function(e,i){let r=e,n=!1,o=(e.x+i.x)/2,a=(e.y+i.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&o<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e)return n}(h,u)&&(lj(h.prev,h,u.prev)||lj(h,u.prev,u))||lV(h,u)&&lj(h.prev,h,h.next)>0&&lj(u.prev,u,u.next)>0))){let h=lH(l,i);return l=lD(l,l.next),h=lD(h,h.next),e(l,r,n,o,a,s,0),void e(h,r,n,o,a,s,0)}i=i.next}l=l.next}while(l!==i)}(i,r,n,o,a,s):e(lD(i),r,n,o,a,s,1);break}}}(h,u,r,n,o,a,0),u}function lL(e,i,r,n,o){let a;if(o===function(e,i,r,n){let o=0;for(let a=i,s=r-n;a<r;a+=n)o+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return o}(e,i,r,n)>0)for(let o=i;o<r;o+=n)a=lZ(o/n|0,e[o],e[o+1],a);else for(let o=r-n;o>=i;o-=n)a=lZ(o/n|0,e[o],e[o+1],a);return a&&lV(a,a.next)&&(lW(a),a=a.next),a}function lD(e,i){if(!e)return e;i||(i=e);let r,n=e;do if(r=!1,n.steiner||!lV(n,n.next)&&0!==lj(n.prev,n,n.next))n=n.next;else{if(lW(n),(n=i=n.prev)===n.next)break;r=!0}while(r||n!==i)return i}function lz(e,i){let r=e.x-i.x;return 0===r&&0==(r=e.y-i.y)&&(r=(e.next.y-e.y)/(e.next.x-e.x)-(i.next.y-i.y)/(i.next.x-i.x)),r}function lF(e,i,r,n,o){return(e=0x55555555&((e=0x33333333&((e=0xf0f0f0f&((e=0xff00ff&((e=(e-r)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(i=0x55555555&((i=0x33333333&((i=0xf0f0f0f&((i=0xff00ff&((i=(i-n)*o|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function lB(e,i,r,n,o,a,s,l){return(o-s)*(i-l)>=(e-s)*(a-l)&&(e-s)*(n-l)>=(r-s)*(i-l)&&(r-s)*(a-l)>=(o-s)*(n-l)}function lN(e,i,r,n,o,a,s,l){return(e!==s||i!==l)&&lB(e,i,r,n,o,a,s,l)}function lj(e,i,r){return(i.y-e.y)*(r.x-i.x)-(i.x-e.x)*(r.y-i.y)}function lV(e,i){return e.x===i.x&&e.y===i.y}function lU(e,i,r,n){let o=lq(lj(e,i,r)),a=lq(lj(e,i,n)),s=lq(lj(r,n,e)),l=lq(lj(r,n,i));return o!==a&&s!==l||!(0!==o||!lG(e,r,i))||!(0!==a||!lG(e,n,i))||!(0!==s||!lG(r,e,n))||!(0!==l||!lG(r,i,n))}function lG(e,i,r){return i.x<=Math.max(e.x,r.x)&&i.x>=Math.min(e.x,r.x)&&i.y<=Math.max(e.y,r.y)&&i.y>=Math.min(e.y,r.y)}function lq(e){return e>0?1:e<0?-1:0}function l$(e,i){return 0>lj(e.prev,e,e.next)?lj(e,i,e.next)>=0&&lj(e,e.prev,i)>=0:0>lj(e,i,e.prev)||0>lj(e,e.next,i)}function lH(e,i){let r=lX(e.i,e.x,e.y),n=lX(i.i,i.x,i.y),o=e.next,a=i.prev;return e.next=i,i.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function lZ(e,i,r,n){let o=lX(e,i,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function lW(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function lX(e,i,r){return{i:e,x:i,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function lY(e,i){let r,n,o=e.length;if(o<=1)return[e];let a=[];for(let i=0;i<o;i++){let o=function(e){let i=0;for(let r,n,o=0,a=e.length,s=a-1;o<a;s=o++)r=e[o],i+=((n=e[s]).x-r.x)*(r.y+n.y);return i}(e[i]);0!==o&&(e[i].area=Math.abs(o),void 0===n&&(n=o<0),n===o<0?(r&&a.push(r),r=[e[i]]):r.push(e[i]))}if(r&&a.push(r),i>1)for(let e=0;e<a.length;e++)a[e].length<=i||(function e(i,r,n=0,o=i.length-1,a=function(e,i){return e<i?-1:+(e>i)}){for(;o>n;){if(o-n>600){let s=o-n+1,l=r-n+1,h=Math.log(s),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(s-u)/s)*(l-s/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*u/s+c)),Math.min(o,Math.floor(r+(s-l)*u/s+c)),a)}let s=i[r],l=n,h=o;for(i2(i,n,r),a(i[o],s)>0&&i2(i,n,o);l<h;){for(i2(i,l,h),l++,h--;0>a(i[l],s);)l++;for(;a(i[h],s)>0;)h--}0===a(i[n],s)?i2(i,n,h):i2(i,++h,o),h<=r&&(n=h+1),r<=h&&(o=h-1)}}(a[e],i,1,a[e].length-1,lK),a[e]=a[e].slice(0,i));return a}function lK(e,i){return i.area-e.area}function lJ(e,i,r=1){if(!e)return null;let n="string"==typeof e?iF.from(e).getPrimary():e.getPrimary(),o="string"==typeof e?null:e.getSecondary();for(let e of[n,o]){if(!e)continue;let n=e.id.toString();i.has(n)||i.set(n,[]),e.scaleSelf(r),i.get(n).push(e)}return{primary:n.toString(),secondary:o?o.toString():null}}function lQ(e,i,r,n){let o=n.patternDependencies,a=!1;for(let n of i){let i=n.paint.get(`${e}-pattern`);i.isConstant()||(a=!0),lJ(i.constantOr(null),o,r)&&(a=!0)}return a}function l0(e,i,r,n,o,a){let s=a.patternDependencies;for(let l of i){let i=l.paint.get(`${e}-pattern`).value;if("constant"!==i.kind){let e=i.evaluate({zoom:n},r,{},a.availableImages),h=lJ(e=e&&e.name?e.name:e,s,o);if(!h)continue;let{primary:u,secondary:c}=h;u&&(r.patterns[l.id]=[u,c].filter(Boolean))}}return r}var l1,l2,l3,l5,l4,l6,l8,l9={};function l7(){if(l2)return l1;l2=1;var e=e2();function i(e,i,n,o,a){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=a,e.readFields(r,this,i)}function r(e,i,r){1==e?i.id=r.readVarint():2==e?function(e,i){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=i._keys[e.readVarint()],o=i._values[e.readVarint()];i.properties[n]=o}}(r,i):3==e?i.type=r.readVarint():4==e&&(i._geometry=r.pos)}return l1=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,n=i.readVarint()+i.pos,o=1,a=0,s=0,l=0,h=[];i.pos<n;){if(a<=0){var u=i.readVarint();o=7&u,a=u>>3}if(a--,1===o||2===o)s+=i.readSVarint(),l+=i.readSVarint(),1===o&&(r&&h.push(r),r=[]),r.push(new e(s,l));else{if(7!==o)throw Error("unknown command "+o);r&&r.push(r[0].clone())}}return r&&h.push(r),h},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var i=e.readVarint()+e.pos,r=1,n=0,o=0,a=0,s=1/0,l=-1/0,h=1/0,u=-1/0;e.pos<i;){if(n<=0){var c=e.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(o+=e.readSVarint())<s&&(s=o),o>l&&(l=o),(a+=e.readSVarint())<h&&(h=a),a>u&&(u=a);else if(7!==r)throw Error("unknown command "+r)}return[s,h,l,u]},i.prototype.toGeoJSON=function(e,r,n){var o,a,s=this.extent*Math.pow(2,n),l=this.extent*e,h=this.extent*r,u=this.loadGeometry(),c=i.types[this.type];function d(e){for(var i=0;i<e.length;i++){var r=e[i];e[i]=[360*(r.x+l)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+h)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(o=0;o<u.length;o++)p[o]=u[o][0];d(u=p);break;case 2:for(o=0;o<u.length;o++)d(u[o]);break;case 3:for(u=function(e){var i=e.length;if(i<=1)return[e];for(var r,n,o=[],a=0;a<i;a++){var s=function(e){for(var i,r,n=0,o=0,a=e.length,s=a-1;o<a;s=o++)n+=((r=e[s]).x-(i=e[o]).x)*(i.y+r.y);return n}(e[a]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(r&&o.push(r),r=[e[a]]):r.push(e[a]))}return r&&o.push(r),o}(u),o=0;o<u.length;o++)for(a=0;a<u[o].length;a++)d(u[o][a])}1===u.length?u=u[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f},l1}function he(){if(l5)return l3;l5=1;var e=l7();function i(e,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(r,this,i),this.length=this._features.length}function r(e,i,r){15===e?i.version=r.readVarint():1===e?i.name=r.readString():5===e?i.extent=r.readVarint():2===e?i._features.push(r.pos):3===e?i._keys.push(r.readString()):4===e&&i._values.push(function(e){for(var i=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;i=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return i}(r))}return l3=i,i.prototype.feature=function(i){if(i<0||i>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new e(this._pbf,r,this.extent,this._keys,this._values)},l3}function ht(){return l8||(l8=1,l9.VectorTile=function(){if(l6)return l4;l6=1;var e=he();function i(i,r,n){if(3===i){var o=new e(n,n.readVarint()+n.pos);o.length&&(r[o.name]=o)}}return l4=function(e,r){this.layers=e.readFields(i,{},r)}}(),l9.VectorTileFeature=l7(),l9.VectorTileLayer=he()),l9}var hi=ht();let hr="3d_elevation_id",hn="level";class ho{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,r){return this.get(e,!0,i,r)}optional(e,i,r){return this.get(e,!1,i,r)}success(){return this._valid}get(e,i,r,n){let o=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==o&&!Number.isNaN(o)?r(n?n(o):o):i&&(this._valid=!1),this}}class ha{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,r){return this.featureFunc(e,i,r)}parseVertex(e,i,r){return this.vertexFunc(e,i,r)}}let hs=new ha((e,i,r)=>e.reset(i).require(hr,e=>{r.id=e}).optional("fixed_height_relative",e=>{r.constantHeight=e},hh.decodeRelativeHeight).geometry(e=>{r.bounds=e},i9).success(),(e,i,r)=>e.reset(i).require(hr,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height_relative",e=>{r.height=e},hh.decodeRelativeHeight).geometry(e=>{r.position=e},hh.getPoint).success()),hl=new ha((e,i,r)=>e.reset(i).require(hr,e=>{r.id=e}).optional("fixed_height",e=>{r.constantHeight=e},hh.decodeMetricHeight).geometry(e=>{r.bounds=e},i9).success(),(e,i,r)=>e.reset(i).require(hr,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height",e=>{r.height=e},hh.decodeMetricHeight).geometry(e=>{r.position=e},hh.getPoint).success());class hh{static getPoint(e){return e$(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){let i=[],r=[],n=e.length,o=new ho;for(let a=0;a<n;a++){let n=e.feature(a),s=n.properties.hasOwnProperty("version")?String(n.properties.version):void 0,l=s?"1.0.1"===s?hl:void 0:hs;if(void 0===l){tf(`Unknown elevation feature version number ${s||"(unknown)"}`);continue}let h=n.properties.hasOwnProperty("type")?n.properties.type:void 0;if(h){if("Point"===hi.VectorTileFeature.types[n.type]&&"curve_point"===h){let e={};l.parseVertex(o,n,e)&&i.push(e)}else if("Polygon"===hi.VectorTileFeature.types[n.type]&&"curve_meta"===h){let e={};l.parseFeature(o,n,e)&&r.push(e)}}}return{vertices:i,features:r}}}class hu{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){let e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,r=i[1],n=-i[0],o=(e.extent+1)*this.metersToTile;return[new e3(Math.trunc(e.position[0]+r*o),Math.trunc(e.position[1]+n*o)),new e3(Math.trunc(e.position[0]-r*o),Math.trunc(e.position[1]-n*o))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class hc{constructor(e,i,r,n,o,a){if(this.vertices=[],this.vertexProps=[],this.edges=[],this.edgeProps=[],this.id=e,this.heightRange={min:r,max:r},this.safeArea=i,this.constantHeight=r,null==this.constantHeight&&(null!=this.constantHeight||0!==n.length)){for(let e of(this.vertices=n,this.edges=o,this.edges=this.edges.filter(e=>{var i,r;return e.a<this.vertices.length&&e.b<this.vertices.length&&((i=this.vertices[e.a].position)[0]!==(r=this.vertices[e.b].position)[0]||i[1]!==r[1])}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},this.vertices))this.vertexProps.push({dir:e$(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(let e of this.edges){let i=this.vertices[e.a].position,r=this.vertices[e.b].position,n=eZ(eq(),r,i),o=eX(n),a=eW(eq(),n,1/o);this.edgeProps.push({vec:n,dir:a,len:o});let s=this.vertexProps[e.a].dir,l=this.vertexProps[e.b].dir;eH(s,s,a),eH(l,l,a)}for(let e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||eY(e.dir,e.dir);this.tessellate(a)}}pointElevation(e){let i;if(null!=this.constantHeight)return this.constantHeight;let r=this.getClosestEdge(e);if(null==r)return 0;let[n,o]=r;return i=this.vertices[this.edges[n].a].height,(1-o)*i+o*this.vertices[this.edges[n].b].height}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let i=0,r=Number.POSITIVE_INFINITY,n=0,o=e$(e.x,e.y);for(let e=0;e<this.edges.length;e++){let a=this.edges[e],s=this.edgeProps[e].dir,l=new sH(o,this.edgeProps[e].dir),h=this.vertices[a.a].position,u=this.vertices[a.b].position,c=eq(),d=eq(),p=l.intersectsPlane(h,this.vertexProps[a.a].dir,c),f=l.intersectsPlane(u,this.vertexProps[a.b].dir,d);if(!p||!f)continue;let m=eZ(eq(),d,c),g=eZ(eq(),o,c),_=eK(m,m),y=_>0?eK(g,m)/_:0,v=tt(y,0,1),x=Math.abs((y-v)*this.edgeProps[e].len)+Math.abs(eK(eZ(eq(),o,h),e$(s[1],-s[0])));x<r&&(i=e,r=x,n=v)}return[i,n]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){let r=this.edges[i].a,n=this.edges[i].b,{position:o,height:a,extent:s}=this.vertices[r],{position:l,height:h,extent:u}=this.vertices[n],c=this.vertexProps[r].dir,d=this.vertexProps[n].dir,p=ec(o[0]/e,o[1]/e,a),f=ec(l[0]/e,l[1]/e,h),m=ec(c[1],-c[0],0);e_(m,m,s);let g=ec(d[1],-d[0],0);if(e_(g,g,u),.0025000000000000005>=this.distSqLines(ec(p[0]+.5*m[0],p[1]+.5*m[1],p[2]+.5*m[2]),ec(f[0]-.5*g[0],f[1]-.5*g[1],f[2]-.5*g[2]),ec(p[0]-.5*m[0],p[1]-.5*m[1],p[2]-.5*m[2]),ec(f[0]+.5*g[0],f[1]+.5*g[1],f[2]+.5*g[2])))continue;let _=this.vertices.length,y=eH(eq(),o,l);this.vertices.push({position:eW(y,y,.5),height:.5*(a+h),extent:.5*(s+u)});let v=eH(eq(),c,d);this.vertexProps.push({dir:eY(v,v)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:r,b:_}),this.edges.push({a:_,b:n});let x=eZ(eq(),this.vertices[_].position,o),b=eX(x),w={vec:x,dir:eW(eq(),x,1/b),len:b};this.edgeProps.push(w),this.edgeProps.push(w)}}distSqLines(e,i,r,n){let o=ep(el(),i,e),a=ep(el(),n,r),s=ep(el(),e,r),l=eT(o,o),h=eT(o,a),u=eT(o,s),c=eT(a,a),d=eT(a,s),p=l*c-h*h;if(0===p){let i=eT(s,a)/eT(a,a);return ev(eE(el(),r,n,i),e)}return ev(eE(el(),e,i,(h*d-u*c)/p),eE(el(),r,n,(l*d-h*u)/p))}}class hd{static parseFrom(e,i){let r=hh.parse(e);if(!r)return[];let{vertices:n,features:o}=r,a=1/sd(i);o.sort((e,i)=>e.id-i.id),n.sort((e,i)=>e.id-i.id||e.idx-i.idx);let s=[],l=0,h=(n=n.filter((e,i,r)=>i===r.findIndex(i=>i.id===e.id&&i.idx===e.idx))).length;for(let e of o){if(e.constantHeight){s.push(new hc(e.id,e.bounds,e.constantHeight));continue}for(;l!==h&&n[l].id<e.id;)l++;if(l===h||n[l].id!==e.id)continue;let i=[],r=[],o=l;for(;l!==h&&n[l].id===e.id;){let e=n[l];if(i.push({position:e.position,height:e.height,extent:e.extent}),l!==o&&n[l-1].idx===e.idx-1){let e=l-o;r.push({a:e-1,b:e})}l++}s.push(new hc(e.id,e.bounds,void 0,i,r,a))}return s}static getElevationFeature(e,i){if(!i)return;let r=+e.properties[hr];return Number.isNaN(r)?void 0:i.find(e=>e.id===r)}}class hp{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*8192,this.yOffset=(e.y*this.zScale-i.y)*8192)}constantElevation(e,i){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,r){let n=this.constantElevation(i,r);return null!=n?n:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),r))}computeBiasedHeight(e,i){return i<=0?e:e+i*ti(0,i,e>=0?e:Math.abs(.5*e))}}nX(hc,"ElevationFeature");class hf{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(let[i,r]of e.polygons)this.add(i,...r)}}class hm{constructor(){this.portals=[]}static evaluate(e){if(0===e.length)return new hm;let i=[];for(let r of e)i.push(...r.portals);if(0===i.length)return new hm;let r=(e,i)=>e<=0&&i<=0||e>=8192&&i>=8192;for(let e of i){let i=e.va,n=e.vb;(r(i.x,n.x)||r(i.y,n.y))&&(e.type="border")}let n=i.filter(e=>"unevaluated"!==e.type),o=i.filter(e=>"unevaluated"===e.type);if(0===o.length)return new hm;o.sort((e,i)=>e.hash===i.hash?e.isTunnel===i.isTunnel?0:e.isTunnel?-1:1:e.hash<i.hash?1:-1),i=n.concat(o);let a=n.length,s=a,l=a;do if(++s===i.length||i[a].hash!==i[s].hash){if(s-a==2){l<a&&(i[l]=i[a],i[a]=null);let e=i[l],r=i[s-1];e.type=e.isTunnel!==r.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:r.connection.a},l++}a=s}while(a!==i.length)return i.splice(l),i.sort((e,i)=>e.hash<i.hash?1:-1),{portals:i}}}nX(hm,"ElevationPortalGraph"),nX(hf,"ElevationPolygons");class hg{constructor(e,i,r){this.outPositions=e,this.outNormals=i,this.outIndices=r,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,r){let n=e[2];null!=r&&(n*=r);let o=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),a=this.vertexLookup.get(o);if(null!=a)return a;let s=this.outPositions.length;this.vertexLookup.set(o,s);let l=Math.trunc(16384*i[0]),h=Math.trunc(16384*i[1]),u=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],n),this.outNormals.emplaceBack(l,h,u),s}addVertices(e,i,...r){let n=[];for(let o of r){let r=this.addVertex(o,e,i);n.push(r)}return n}addTriangles(e,i,r){if(i&&r){let n=1===r.length,o=ec(0,0,0);for(let a=0;a<e.length;a+=3){let s=i[e[a+0]],l=i[e[a+1]],h=i[e[a+2]],u=n?r[0]:r[e[a+1]],c=n?r[0]:r[e[a+2]],d=this.addVertex(ec(s.x,s.y,n?r[0]:r[e[a+0]]),o),p=this.addVertex(ec(l.x,l.y,u),o),f=this.addVertex(ec(h.x,h.y,c),o);this.outIndices.emplaceBack(d,p,f)}}else for(let i=0;i<e.length;i+=3)this.outIndices.emplaceBack(e[i+0],e[i+1],e[i+2])}addQuad(e,i){let[r,n,o,a]=this.addVertices(i,void 0,...e.map(e=>ec(e.coord.x,e.coord.y,e.height)));this.addTriangles([r,n,o,o,a,r])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class h_{constructor(e){this.unevaluatedPortals=new hm,this.portalPolygons=new hf,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new o$,this.vertexNormals=new oH,this.indexArray=new o9,this.tileToMeters=sd(e)}addVertices(e,i){let r=this.unevalVertices.length;for(let r=0;r<e.length;r++)this.unevalVertices.push(e[r]),this.unevalHeights.push(i[r]);return r}addTriangles(e,i,r){let n=r?this.unevalTunnelTriangles:this.unevalTriangles;for(let r of e)n.push(r+i)}addRenderableRing(e,i,r,n,o){let a=[new e3(o.min.x,o.min.y),new e3(o.max.x,o.min.y),new e3(o.max.x,o.max.y),new e3(o.min.x,o.max.y)];for(let s=0;s<r-1;s++){let r=i+s,l=r+1,h=this.unevalVertices[r],u=this.unevalVertices[l];if(!(h.x>=o.min.x&&h.x<=o.max.x&&h.y>=o.min.y&&h.y<=o.max.y||u.x>=o.min.x&&u.x<=o.max.x&&u.y>=o.min.y&&u.y<=o.max.y||sM(h,u,a))||this.isOnBorder(h.x,u.x)||this.isOnBorder(h.y,u.y))continue;let c=h_.computeEdgeHash(this.unevalVertices[r],this.unevalVertices[l]),d,p=this.vertexHashLookup.get(h_.computePosHash(h));d=null!=p?p.next:null!=(p=this.vertexHashLookup.get(h_.computePosHash(u)))?p.prev:c,this.unevalEdges.push({polygonIdx:e,a:r,b:l,hash:c,portalHash:d,isTunnel:n,type:"unevaluated"})}}addPortalCandidates(e,i,r,n,o){if(0===i.length)return;this.portalPolygons.add(e,{geometry:i,zLevel:o});let a=i[0];this.vertexHashLookup.clear();let s=h_.computeEdgeHash(a[a.length-2],a[a.length-1]);for(let i=0;i<a.length-1;i++){let o=a[i+0],l=a[i+1],h=e$(l.x-o.x,l.y-o.y),u=eX(h);if(0===u)continue;let c="unevaluated",d=n.pointElevation(o),p=n.pointElevation(l);.01>Math.abs(d)&&.01>Math.abs(p)?c="entrance":(this.isOnBorder(o.x,l.x)||this.isOnBorder(o.y,l.y))&&(c="border");let f=h_.computeEdgeHash(o,l);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:o,vb:l,vab:h,length:u,hash:f,isTunnel:r,type:c});let m=h_.computePosHash(o);this.vertexHashLookup.set(m,{prev:s,next:f}),s=f}}construct(e){if(0===this.unevalVertices.length)return;let i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),r=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},n=new hg(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);let o=i(),a=i(),s=i(),l=(e,i)=>{e.sort((e,r)=>e.type===i&&r.type!==i?-1:+(e.type!==i&&r.type===i));let r=e.findIndex(e=>e.type!==i);return r>=0?r:e.length},h=0;this.unevalEdges.length>0&&(h=l(this.unevalEdges,"none"),this.constructBridgeStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:h},this.tileToMeters));let u=i();if(this.unevalEdges.length>0){let e=this.unevalEdges.splice(h),i=l(e,"tunnel")+h;this.unevalEdges.push(...e),this.constructTunnelStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:h},{min:h,max:i})}r(s),n.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),r(u),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),r(a),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),r(o),this.maskSegments=aC.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.depthSegments=aC.simpleSegment(0,a.primitiveOffset,0,a.primitiveLength),this.renderableSegments=aC.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.shadowCasterSegments=aC.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,lP.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,lO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,r,n,o){let a=new Map;for(let s=n;s<o;s++){let n=r[s],o=n.a,l=n.b,h=h_.computePosHash(e[o]),u=h_.computePosHash(e[l]);a.has(h)||a.set(h,{}),a.has(u)||a.set(u,{});let c=a.get(h),d=a.get(u);i[o]<=0&&i[l]<=0||(c.to=l,d.from=o)}return a}constructBridgeStructures(e,i,r,n,o,a){let s=this.computeVertexConnections(i,r,n,o.min,o.max),l=1/a,h=.5*l,u=e=>ec(i[e].x,i[e].y,r[e]*l),c=e=>{let r=s.get(h_.computePosHash(i[e])),n=r.from,o=r.to;if(!n||!o)return;let a=u(n),l=u(e),h=u(o),c=ec(0,0,0);if(!eR(a,l)){let e=ep(el(),l,a);ed(c,c,ew(e,e))}if(!eR(h,l)){let e=ep(el(),h,l);ed(c,c,ew(e,e))}let d=eu(c);return d>0?e_(c,c,1/d):void 0};for(let s=o.min;s<o.max;s++){let o=n[s],u=this.prepareEdgePoints(i,r,o,(e,i)=>e>i);if(null==u)continue;let d=u[0],p=u[1],f=ec(d.coord.x,d.coord.y,l*d.height),m=ec(p.coord.x,p.coord.y,l*p.height);if(eR(f,m))continue;let g=ep(el(),m,f);ew(g,g);let _=e=>ew(e,e),y=c(o.a)||g,v=c(o.b)||g,x=_(ec(y[1],-y[0],0)),b=_(ec(v[1],-v[0],0)),w=_(eS(el(),x,y)),T=_(eS(el(),b,v)),S=el(),E=[ed(el(),f,e_(S,ep(S,x,w),h)),ed(el(),f,e_(S,ed(S,x,w),h)),ed(el(),f,e_(S,w,h)),f],I=[ed(el(),m,e_(S,ep(S,b,T),h)),ed(el(),m,e_(S,ed(S,b,T),h)),ed(el(),m,e_(S,T,h)),m],[C,A]=e.addVertices(x,a,E[0],E[1]),[R,M]=e.addVertices(b,a,I[0],I[1]);e.addTriangles([C,A,R,A,M,R]);let[P,O]=e.addVertices(w,a,E[1],E[2]),[k,L]=e.addVertices(T,a,I[1],I[2]);e.addTriangles([P,O,k,O,L,k]);let[D,z]=e.addVertices(eb(x,x),a,E[2],E[3]),[F,B]=e.addVertices(eb(b,b),a,I[2],I[3]);e.addTriangles([D,z,F,z,B,F])}}constructTunnelStructures(e,i,r,n,o,a){let s=e=>ew(e,e);for(let a=o.min;a<o.max;a++){let o=this.prepareEdgePoints(i,r,n[a],(e,i)=>e<i);if(null==o)continue;let[l,h]=o,u=s(ec(h.coord.y-l.coord.y,-(h.coord.x-l.coord.x),0));e.addQuad([l,h,{coord:h.coord,height:n[a].isTunnel?-.1:0},{coord:l.coord,height:n[a].isTunnel?-.1:0}],u)}for(let o=a.min;o<a.max;o++){let a=n[o],l=i[a.a],h=i[a.b],u=s(ec(h.y-l.y,-(h.x-l.x),0));e.addQuad([{coord:h,height:0},{coord:l,height:0},{coord:l,height:r[a.a]+4},{coord:h,height:r[a.b]+4}],u),e.addQuad([{coord:l,height:0},{coord:h,height:0},{coord:h,height:r[a.b]+4},{coord:l,height:r[a.a]+4}],u)}}prepareEdgePoints(e,i,r,n){let o=i[r.a],a=i[r.b],s=n(o,0),l=n(a,0);if(s&&l)return[{coord:e[r.a],height:o},{coord:e[r.b],height:a}];if(!s&&!l)return;let h=e[r.a].clone(),u=e[r.b].clone();if(s){if(!l){let e=a/(a-o);u.x=ih(u.x,h.x,e),u.y=ih(u.y,h.y,e),a=ih(a,o,e)}}else{let e=o/(o-a);h.x=ih(h.x,u.x,e),h.y=ih(h.y,u.y,e),o=ih(o,a,e)}return[{coord:h,height:o},{coord:u,height:a}]}prepareEdges(e,i){if(0===i.length)return;i.sort((e,i)=>e.hash===i.hash?i.polygonIdx-e.polygonIdx:i.hash>e.hash?1:-1);let r=0,n=0,o=0,a=i[0].polygonIdx;do(++n===i.length||i[r].hash!==i[n].hash)&&((1==n-r||i[n-1].polygonIdx!==a)&&(o<r&&(i[o]=i[r],i[r]=null),i[o].type="none",o++),(r=n)!==i.length&&(a=i[r].polygonIdx));while(r!==i.length)if(i.splice(o),0!==i.length&&0!==e.length){i.sort((e,i)=>e.portalHash<i.portalHash?1:-1);let r=0,n=0;for(;r!==i.length&&n!==e.length;){let o=i[r],a=e[n];o.portalHash>a.hash?r++:a.hash>o.portalHash?n++:(o.type=a.type,r++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=8192&&i>=8192}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(h_.computePosHash(e))<<32n|BigInt(h_.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var hy,hv={exports:{}},hx=(hy||(hy=1,!function(e){function i(e,i){return e>i?1:e<i?-1:0}var r=function(e,r){void 0===e&&(e=i),void 0===r&&(r=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!r},n={size:{configurable:!0}};function o(e,i,r){null===i?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===i.isSubject?(e.inOut=!i.inOut,e.otherInOut=i.otherInOut):(e.inOut=!i.otherInOut,e.otherInOut=i.isVertical()?!i.inOut:i.inOut),i&&(e.prevInResult=!a(i,r)||i.isVertical()?i.prevInResult:i));var n=a(e,r);e.resultTransition=n?function(e,i){var r,n=!e.inOut,o=!e.otherInOut;switch(i){case 0:r=n&&o;break;case 1:r=n||o;break;case 3:r=n^o;break;case 2:r=e.isSubject?n&&!o:o&&!n}return r?1:-1}(e,r):0}function a(e,i){switch(e.type){case 0:switch(i){case 0:return!e.otherInOut;case 1:return e.otherInOut;case 2:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case 3:return!0}break;case 2:return 0===i||1===i;case 3:return 2===i}return!1}r.prototype.rotateLeft=function(e){var i=e.right;i&&(e.right=i.left,i.left&&(i.left.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.left=e),e.parent=i},r.prototype.rotateRight=function(e){var i=e.left;i&&(e.left=i.right,i.right&&(i.right.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.right=e),e.parent=i},r.prototype._splay=function(e){for(;e.parent;){var i=e.parent;i.parent?i.left===e&&i.parent.left===i?(this.rotateRight(i.parent),this.rotateRight(i)):i.right===e&&i.parent.right===i?(this.rotateLeft(i.parent),this.rotateLeft(i)):i.left===e&&i.parent.right===i?(this.rotateRight(i),this.rotateLeft(i)):(this.rotateLeft(i),this.rotateRight(i)):i.left===e?this.rotateRight(i):this.rotateLeft(i)}},r.prototype.splay=function(e){for(var i,r,n,o,a;e.parent;)(r=(i=e.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=e:n.right=e,e.parent=n):(e.parent=null,this._root=e),o=e.left,a=e.right,e===i.left?(r&&(r.left===i?(i.right?(r.left=i.right,r.left.parent=r):r.left=null,i.right=r,r.parent=i):(o?(r.right=o,o.parent=r):r.right=null,e.left=r,r.parent=e)),a?(i.left=a,a.parent=i):i.left=null,e.right=i):(r&&(r.right===i?(i.left?(r.right=i.left,r.right.parent=r):r.right=null,i.left=r,r.parent=i):(a?(r.left=a,a.parent=r):r.left=null,e.right=r,r.parent=e)),o?(i.right=o,o.parent=i):i.right=null,e.left=i),i.parent=e},r.prototype.replace=function(e,i){e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.parent=e.parent)},r.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.insert=function(e,i){var r=this._root,n=null,o=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===o(r.key,e))return;r=0>o(r.key,e)?r.right:r.left}else for(;r;)n=r,r=0>o(r.key,e)?r.right:r.left;return r={key:e,data:i,left:null,right:null,parent:n},n?0>o(n.key,r.key)?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},r.prototype.find=function(e){for(var i=this._root,r=this._compare;i;){var n=r(i.key,e);if(n<0)i=i.right;else{if(!(n>0))return i;i=i.left}}return null},r.prototype.contains=function(e){for(var i=this._root,r=this._compare;i;){var n=r(e,i.key);if(0===n)return!0;i=n<0?i.left:i.right}return!1},r.prototype.remove=function(e){var i=this.find(e);if(!i)return!1;if(this.splay(i),i.left)if(i.right){var r=this.minNode(i.right);r.parent!==i&&(this.replace(r,r.right),r.right=i.right,r.right.parent=r),this.replace(i,r),r.left=i.left,r.left.parent=r}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0},r.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},r.prototype.erase=function(e){var i=this.find(e);if(i){this.splay(i);var r=i.left,n=i.right,o=null;r&&(r.parent=null,o=this.maxNode(r),this.splay(o),this._root=o),n&&(r?o.right=n:this._root=n,n.parent=o),this._size--}},r.prototype.pop=function(){var e=this._root,i=null;if(e){for(;e.left;)e=e.left;i={key:e.key,data:e.data},this.remove(e.key)}return i},r.prototype.next=function(e){var i=e;if(i)if(i.right)for(i=i.right;i&&i.left;)i=i.left;else for(i=e.parent;i&&i.right===e;)e=i,i=i.parent;return i},r.prototype.prev=function(e){var i=e;if(i)if(i.left)for(i=i.left;i&&i.right;)i=i.right;else for(i=e.parent;i&&i.left===e;)e=i,i=i.parent;return i},r.prototype.forEach=function(e){for(var i=this._root,r=[],n=!1,o=0;!n;)i?(r.push(i),i=i.left):r.length>0?(e(i=r.pop(),o++),i=i.right):n=!0;return this},r.prototype.range=function(e,i,r,n){for(var o=[],a=this._compare,s=this._root;0!==o.length||s;)if(s)o.push(s),s=s.left;else{if(a((s=o.pop()).key,i)>0)break;if(a(s.key,e)>=0&&r.call(n,s))return this;s=s.right}return this},r.prototype.keys=function(){for(var e=this._root,i=[],r=[],n=!1;!n;)e?(i.push(e),e=e.left):i.length>0?(r.push((e=i.pop()).key),e=e.right):n=!0;return r},r.prototype.values=function(){for(var e=this._root,i=[],r=[],n=!1;!n;)e?(i.push(e),e=e.left):i.length>0?(r.push((e=i.pop()).data),e=e.right):n=!0;return r},r.prototype.at=function(e){for(var i=this._root,r=[],n=!1,o=0;!n;)if(i)r.push(i),i=i.left;else if(r.length>0){if(i=r.pop(),o===e)return i;o++,i=i.right}else n=!0;return null},r.prototype.load=function(e,i,r){if(void 0===e&&(e=[]),void 0===i&&(i=[]),void 0===r&&(r=!1),0!==this._size)throw Error("bulk-load: tree is not empty");var n=e.length;return r&&function e(i,r,n,o,a){if(!(n>=o)){for(var s=i[n+o>>1],l=n-1,h=o+1;;){do l++;while(0>a(i[l],s))do h--;while(a(i[h],s)>0)if(l>=h)break;var u=i[l];i[l]=i[h],i[h]=u,u=r[l],r[l]=r[h],r[h]=u}e(i,r,n,h,a),e(i,r,h+1,o,a)}}(e,i,0,n-1,this._compare),this._root=function e(i,r,n,o,a){var s=a-o;if(s>0){var l=o+Math.floor(s/2),h={key:r[l],data:n[l],parent:i};return h.left=e(h,r,n,o,l),h.right=e(h,r,n,l+1,a),h}return null}(null,e,i,0,n),this._size=n,this},r.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},r.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},r.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},r.createTree=function(e,i,n,o,a){return new r(n,a).load(e,i,o)},Object.defineProperties(r.prototype,n);var s=function(e,i,r,n,o){this.left=i,this.point=e,this.otherEvent=r,this.isSubject=n,this.type=o||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},l={inResult:{configurable:!0}};function h(e,i){return e[0]===i[0]&&e[1]===i[1]}s.prototype.isBelow=function(e){var i=this.point,r=this.otherEvent.point;return this.left?(i[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(i[1]-e[1])>0:(r[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(r[1]-e[1])>0},s.prototype.isAbove=function(e){return!this.isBelow(e)},s.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},l.inResult.get=function(){return 0!==this.resultTransition},s.prototype.clone=function(){var e=new s(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(s.prototype,l);var u=(3+8881784197001252e-31)*11102230246251565e-32;function c(e,i,r,n,o){var a,s,l,h,u=i[0],c=n[0],d=0,p=0;c>u==c>-u?(a=u,u=i[++d]):(a=c,c=n[++p]);var f=0;if(d<e&&p<r)for(c>u==c>-u?(l=a-((s=u+a)-u),u=i[++d]):(l=a-((s=c+a)-c),c=n[++p]),a=s,0!==l&&(o[f++]=l);d<e&&p<r;)c>u==c>-u?(l=a-((s=a+u)-(h=s-a))+(u-h),u=i[++d]):(l=a-((s=a+c)-(h=s-a))+(c-h),c=n[++p]),a=s,0!==l&&(o[f++]=l);for(;d<e;)l=a-((s=a+u)-(h=s-a))+(u-h),u=i[++d],a=s,0!==l&&(o[f++]=l);for(;p<r;)l=a-((s=a+c)-(h=s-a))+(c-h),c=n[++p],a=s,0!==l&&(o[f++]=l);return 0===a&&0!==f||(o[f++]=a),f}function d(e){return new Float64Array(e)}var p=d(4),f=d(8),m=d(12),g=d(16),_=d(4);function y(e,i,r){var n=function(e,i,r,n,o,a){var s=(i-a)*(r-o),l=(e-o)*(n-a),h=s-l;if(0===s||0===l||s>0!=l>0)return h;var d=Math.abs(s+l);return Math.abs(h)>=33306690738754716e-32*d?h:-function(e,i,r,n,o,a,s){var l,h,d,y,v,x,b,w,T,S,E,I,C,A,R,M,P,O,k=e-o,L=r-o,D=i-a,z=n-a;p[0]=(R=(w=k-(b=(x=0x8000001*k)-(x-k)))*(S=z-(T=(x=0x8000001*z)-(x-z)))-((A=k*z)-b*T-w*T-b*S))-((E=R-(P=(w=D-(b=(x=0x8000001*D)-(x-D)))*(S=L-(T=(x=0x8000001*L)-(x-L)))-((M=D*L)-b*T-w*T-b*S)))+(v=R-E))+(v-P),p[1]=(C=A-((I=A+E)-(v=I-A))+(E-v))-((E=C-M)+(v=C-E))+(v-M),p[2]=I-((O=I+E)-(v=O-I))+(E-v),p[3]=O;var F=function(e,i){for(var r=i[0],n=1;n<4;n++)r+=i[n];return r}(0,p),B=22204460492503146e-32*s;if(F>=B||-F>=B||(l=e-(k+(v=e-k))+(v-o),d=r-(L+(v=r-L))+(v-o),h=i-(D+(v=i-D))+(v-a),y=n-(z+(v=n-z))+(v-a),0===l&&0===h&&0===d&&0===y)||(B=11093356479670487e-47*s+u*Math.abs(F),(F+=k*y+z*l-(D*d+L*h))>=B||-F>=B))return F;_[0]=(R=(w=l-(b=(x=0x8000001*l)-(x-l)))*(S=z-(T=(x=0x8000001*z)-(x-z)))-((A=l*z)-b*T-w*T-b*S))-((E=R-(P=(w=h-(b=(x=0x8000001*h)-(x-h)))*(S=L-(T=(x=0x8000001*L)-(x-L)))-((M=h*L)-b*T-w*T-b*S)))+(v=R-E))+(v-P),_[1]=(C=A-((I=A+E)-(v=I-A))+(E-v))-((E=C-M)+(v=C-E))+(v-M),_[2]=I-((O=I+E)-(v=O-I))+(E-v),_[3]=O;var N=c(4,p,4,_,f);_[0]=(R=(w=k-(b=(x=0x8000001*k)-(x-k)))*(S=y-(T=(x=0x8000001*y)-(x-y)))-((A=k*y)-b*T-w*T-b*S))-((E=R-(P=(w=D-(b=(x=0x8000001*D)-(x-D)))*(S=d-(T=(x=0x8000001*d)-(x-d)))-((M=D*d)-b*T-w*T-b*S)))+(v=R-E))+(v-P),_[1]=(C=A-((I=A+E)-(v=I-A))+(E-v))-((E=C-M)+(v=C-E))+(v-M),_[2]=I-((O=I+E)-(v=O-I))+(E-v),_[3]=O;var j=c(N,f,4,_,m);_[0]=(R=(w=l-(b=(x=0x8000001*l)-(x-l)))*(S=y-(T=(x=0x8000001*y)-(x-y)))-((A=l*y)-b*T-w*T-b*S))-((E=R-(P=(w=h-(b=(x=0x8000001*h)-(x-h)))*(S=d-(T=(x=0x8000001*d)-(x-d)))-((M=h*d)-b*T-w*T-b*S)))+(v=R-E))+(v-P),_[1]=(C=A-((I=A+E)-(v=I-A))+(E-v))-((E=C-M)+(v=C-E))+(v-M),_[2]=I-((O=I+E)-(v=O-I))+(E-v),_[3]=O;var V=c(j,m,4,_,g);return g[V-1]}(e,i,r,n,o,a,d)}(e[0],e[1],i[0],i[1],r[0],r[1]);return n>0?-1:+(n<0)}function v(e,i){var r=e.point,n=i.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:e.left!==i.left?e.left?1:-1:0!==y(r,e.otherEvent.point,i.otherEvent.point)?e.isBelow(i.otherEvent.point)?-1:1:!e.isSubject&&i.isSubject?1:-1}function x(e,i,r){var n=new s(i,!1,e,e.isSubject),o=new s(i,!0,e.otherEvent,e.isSubject);return h(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),n.contourId=o.contourId=e.contourId,v(o,e.otherEvent)>0&&(e.otherEvent.left=!0,o.left=!1),e.otherEvent.otherEvent=o,e.otherEvent=n,r.push(o),r.push(n),r}function b(e,i){return e[0]*i[1]-e[1]*i[0]}function w(e,i){return e[0]*i[0]+e[1]*i[1]}function T(e,i,r){var n=function(e,i,r,n,o){var a=[i[0]-e[0],i[1]-e[1]],s=[n[0]-r[0],n[1]-r[1]];function l(e,i,r){return[e[0]+i*r[0],e[1]+i*r[1]]}var h=[r[0]-e[0],r[1]-e[1]],u=b(a,s),c=u*u,d=w(a,a);if(c>0){var p=b(h,s)/u;if(p<0||p>1)return null;var f=b(h,a)/u;return f<0||f>1?null:0===p||1===p?[l(e,p,a)]:0===f||1===f?[l(r,f,s)]:[l(e,p,a)]}if((c=(u=b(h,a))*u)>0)return null;var m=w(a,h)/d,g=m+w(a,s)/d,_=Math.min(m,g),y=Math.max(m,g);return _<=1&&y>=0?1===_?[l(e,_>0?_:0,a)]:0===y?[l(e,y<1?y:1,a)]:[l(e,_>0?_:0,a),l(e,y<1?y:1,a)]:null}(e.point,e.otherEvent.point,i.point,i.otherEvent.point),o=n?n.length:0;if(0===o||1===o&&(h(e.point,i.point)||h(e.otherEvent.point,i.otherEvent.point))||2===o&&e.isSubject===i.isSubject)return 0;if(1===o)return h(e.point,n[0])||h(e.otherEvent.point,n[0])||x(e,n[0],r),h(i.point,n[0])||h(i.otherEvent.point,n[0])||x(i,n[0],r),1;var a=[],s=!1,l=!1;return h(e.point,i.point)?s=!0:1===v(e,i)?a.push(i,e):a.push(e,i),h(e.otherEvent.point,i.otherEvent.point)?l=!0:1===v(e.otherEvent,i.otherEvent)?a.push(i.otherEvent,e.otherEvent):a.push(e.otherEvent,i.otherEvent),s&&l||s?(i.type=1,e.type=i.inOut===e.inOut?2:3,s&&!l&&x(a[1].otherEvent,a[0].point,r),2):(l?x(a[0],a[1].point,r):a[0]!==a[3].otherEvent?(x(a[0],a[1].point,r),x(a[1],a[2].point,r)):(x(a[0],a[1].point,r),x(a[3].otherEvent,a[2].point,r)),3)}function S(e,i){if(e===i)return 0;if(0!==y(e.point,e.otherEvent.point,i.point)||0!==y(e.point,e.otherEvent.point,i.otherEvent.point))return h(e.point,i.point)?e.isBelow(i.otherEvent.point)?-1:1:e.point[0]===i.point[0]?e.point[1]<i.point[1]?-1:1:1===v(e,i)?i.isAbove(e.point)?-1:1:e.isBelow(i.point)?-1:1;if(e.isSubject!==i.isSubject)return e.isSubject?-1:1;var r=e.point,n=i.point;return r[0]===n[0]&&r[1]===n[1]?(r=e.otherEvent.point)[0]===(n=i.otherEvent.point)[0]&&r[1]===n[1]?0:e.contourId>i.contourId?1:-1:1===v(e,i)?1:-1}var E=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function I(e,i){if(!(this instanceof I))return new I(e,i);if(this.data=e||[],this.length=this.data.length,this.compare=i||C,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function C(e,i){return e<i?-1:+(e>i)}E.prototype.isExterior=function(){return null==this.holeOf},I.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var i=this.data,r=this.compare,n=i[e];e>0;){var o=e-1>>1,a=i[o];if(r(n,a)>=0)break;i[e]=a,e=o}i[e]=n},_down:function(e){for(var i=this.data,r=this.compare,n=this.length>>1,o=i[e];e<n;){var a=1+(e<<1),s=a+1,l=i[a];if(s<this.length&&0>r(i[s],l)&&(a=s,l=i[s]),r(l,o)>=0)break;i[e]=l,e=a}i[e]=o}},I.default=I;var A=Math.max,R=Math.min,M=0;function P(e,i,r,n,o,a){var l,h,u,c,d,p;for(l=0,h=e.length-1;l<h;l++)if(c=e[l+1],d=new s(u=e[l],!1,void 0,i),p=new s(c,!1,d,i),d.otherEvent=p,u[0]!==c[0]||u[1]!==c[1]){d.contourId=p.contourId=r,a||(d.isExteriorRing=!1,p.isExteriorRing=!1),v(d,p)>0?p.left=!0:d.left=!0;var f=u[0],m=u[1];o[0]=R(o[0],f),o[1]=R(o[1],m),o[2]=A(o[2],f),o[3]=A(o[3],m),n.push(d),n.push(p)}}var O=[];function k(e,i,n){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof i[0][0][0]&&(i=[i]);var a,s,l,h,u,c,d=(a=e,s=i,l=null,a.length*s.length==0&&(0===n?l=O:2===n?l=a:1!==n&&3!==n||(l=0===a.length?s:a)),l);if(d)return d===O?null:d;var p=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=function(e,i,r,n,o){var a,s,l,h,u,c,d=new I(null,v);for(l=0,h=e.length;l<h;l++)for(u=0,c=(a=e[l]).length;u<c;u++)(s=0===u)&&M++,P(a[u],!0,M,d,r,s);for(l=0,h=i.length;l<h;l++)for(u=0,c=(a=i[l]).length;u<c;u++)s=0===u,2===o&&(s=!1),s&&M++,P(a[u],!1,M,d,n,s);return d}(e,i,p,f,n);if(h=e,u=i,c=null,(p[0]>f[2]||f[0]>p[2]||p[1]>f[3]||f[1]>p[3])&&(0===n?c=O:2===n?c=h:1!==n&&3!==n||(c=h.concat(u))),d=c)return d===O?null:d;for(var g=function(e){var i,r,n=function(e){var i,r,n,o,a=[];for(r=0,n=e.length;r<n;r++)((i=e[r]).left&&i.inResult||!i.left&&i.otherEvent.inResult)&&a.push(i);for(var s=!1;!s;)for(s=!0,r=0,n=a.length;r<n;r++)r+1<n&&1===v(a[r],a[r+1])&&(o=a[r],a[r]=a[r+1],a[r+1]=o,s=!1);for(r=0,n=a.length;r<n;r++)(i=a[r]).otherPos=r;for(r=0,n=a.length;r<n;r++)(i=a[r]).left||(o=i.otherPos,i.otherPos=i.otherEvent.otherPos,i.otherEvent.otherPos=o);return a}(e),o={},a=[];for(i=0,r=n.length;i<r;i++)!function(){if(!o[i]){var e=a.length,r=function(e,i,r){var n=new E;if(null!=e.prevInResult){var o=e.prevInResult,a=o.outputContourId;if(o.resultTransition>0){var s=i[a];if(null!=s.holeOf){var l=s.holeOf;i[l].holeIds.push(r),n.holeOf=l,n.depth=i[a].depth}else i[a].holeIds.push(r),n.holeOf=a,n.depth=i[a].depth+1}else n.holeOf=null,n.depth=i[a].depth}else n.holeOf=null,n.depth=0;return n}(n[i],a,e),s=function(i){o[i]=!0,i<n.length&&n[i]&&(n[i].outputContourId=e)},l=i,h=i;for(r.points.push(n[i].point);s(l),s(l=n[l].otherPos),r.points.push(n[l].point),!((l=function(e,i,r,n){var o,a=e+1,s=i[e].point,l=i.length;for(a<l&&(o=i[a].point);a<l&&o[0]===s[0]&&o[1]===s[1];){if(!r[a])return a;++a<l&&(o=i[a].point)}for(a=e-1;r[a]&&a>n;)a--;return a}(l,n,o,h))==h||l>=n.length)&&n[l];);a.push(r)}}();return a}(function(e,i,n,a,s,l){for(var h,u,c,d=new r(S),p=[],f=Math.min(a[2],s[2]);0!==e.length;){var m=e.pop();if(p.push(m),0===l&&m.point[0]>f||2===l&&m.point[0]>a[2])break;if(m.left){u=h=d.insert(m),h=h!==(c=d.minNode())?d.prev(h):null,u=d.next(u);var g=h?h.key:null;if(o(m,g,l),u&&2===T(m,u.key,e)&&(o(m,g,l),o(u.key,m,l)),h&&2===T(h.key,m,e)){var _=h;o(g,(_=_!==c?d.prev(_):null)?_.key:null,l),o(m,g,l)}}else u=h=d.find(m=m.otherEvent),h&&u&&(h=h!==c?d.prev(h):null,u=d.next(u),d.remove(m),u&&h&&T(h.key,u.key,e))}return p}(m,0,0,p,f,n)),_=[],y=0;y<g.length;y++){var x=g[y];if(x.isExterior()){for(var b=[x.points],w=0;w<x.holeIds.length;w++)b.push(g[x.holeIds[w]].points);_.push(b)}}return _}e.diff=function(e,i){return k(e,i,2)},e.intersection=function(e,i){return k(e,i,0)},e.operations={UNION:1,DIFFERENCE:2,INTERSECTION:0,XOR:3},e.union=function(e,i){return k(e,i,1)},e.xor=function(e,i){return k(e,i,3)},Object.defineProperty(e,"__esModule",{value:!0})}(hv.exports)),hv.exports);function hb(e,i,r,n){let o=[],a=0===n?(e,i,r,n,o,a)=>{e.push(new e3(a,r+(a-i)/(n-i)*(o-r)))}:(e,i,r,n,o,a)=>{e.push(new e3(i+(a-r)/(o-r)*(n-i),a))};for(let s of e){let e=[];for(let o of s){if(o.length<=2)continue;let s=[];for(let e=0;e<o.length-1;e++){let l=o[e].x,h=o[e].y,u=o[e+1].x,c=o[e+1].y,d=0===n?l:h,p=0===n?u:c;d<i?p>i&&a(s,l,h,u,c,i):d>r?p<r&&a(s,l,h,u,c,r):s.push(o[e]),p<i&&d>=i&&a(s,l,h,u,c,i),p>r&&d<=r&&a(s,l,h,u,c,r)}let l=o[o.length-1],h=0===n?l.x:l.y;h>=i&&h<=r&&s.push(l),s.length&&(l=s[s.length-1],s[0].x===l.x&&s[0].y===l.y||s.push(s[0]),e.push(s))}e.length&&o.push(e)}return o}function hw(e,i=1){return[e.map(e=>e.map(e=>[e.x*i,e.y*i]))]}function hT(e,i=1){return e.map(e=>e.map((e,r)=>{let n=e.map(e=>new e3(e[0]*i,e[1]*i).round());return r>0&&n.reverse(),n}))}class hS{constructor(e,i){this.layoutVertexArray=new oV,this.indexArray=new o9,this.lineIndexArray=new o3,this.triangleSegments=new aC,this.lineSegments=new aC,this.programConfigurations=new a0(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new oq)}update(e,i,r,n,o,a,s){this.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,lM.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,r,n,o,a){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n,o,a)}}class hE{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new hS(e,!1),this.elevationBufferData=new hS(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,r,n){this.hasPattern=lQ("fill",this.layers,this.pixelRatio,i);let o=this.layers[0].layout.get("fill-sort-key"),a=[];for(let{feature:s,id:l,index:h,sourceLayerIndex:u}of e){let e=this.layers[0]._featureFilter.needGeometry,c=s_(s,e);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),c,r))continue;let d=o?o.evaluate(c,{},r,i.availableImages):void 0,p={id:l,properties:s.properties,type:s.type,sourceLayerIndex:u,index:h,geometry:e?c.geometry:sg(s,r,n),patterns:{},sortKey:d};a.push(p)}for(let n of(o&&a.sort((e,i)=>e.sortKey-i.sortKey),a)){let{geometry:o,index:a,sourceLayerIndex:s}=n;if(this.hasPattern){let e=l0("fill",this.layers,n,this.zoom,this.pixelRatio,i);this.patternFeatures.push(e)}else this.addFeature(n,o,a,r,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[a].feature,o,a,s,this.index)}}update(e,i,r,n,o,a,s){this.bufferData.update(e,i,r,n,o,a,s),this.elevationBufferData.update(e,i,r,n,o,a,s)}addFeatures(e,i,r,n,o,a){for(let o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,i,r,n,a,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,r,n,o,a=[],s,l){let h=lY(i,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,h,n,r,l):this.addGeometry(h,this.bufferData),this.bufferData.populatePaintArrays(e,r,o,a,n,s),this.elevationBufferData.populatePaintArrays(e,r,o,a,n,s)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,r,n,o){let a=[],s=hd.getElevationFeature(e,o);if(s){{let e=this.clipPolygonsToTile(i,1);e.length>0&&a.push({polygons:e,elevationFeature:s,elevationTileID:r})}for(let i of a)if(i.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new h_(i.elevationTileID));let r=i.elevationFeature.isTunnel(),n=0;for(let o of(e.properties.hasOwnProperty(hn)&&(n=+e.properties[hn]),i.polygons))this.elevatedStructures.addPortalCandidates(i.elevationFeature.id,o,r,i.elevationFeature,n)}null==i.elevationFeature.constantHeight&&(i.polygons=this.prepareElevatedPolygons(i.polygons,i.elevationFeature,i.elevationTileID));let o=new hp(r,i.elevationTileID);this.addElevatedGeometry(i.polygons,o,i.elevationFeature,.05*("hd-road-base"!==this.elevationMode),n)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,r,n,o){let[a,s]=this.addGeometry(e,this.elevationBufferData,{elevation:r,elevationSampler:i,bias:n,index:o});null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:a,max:s}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,a),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,s))}addGeometry(e,i,r){let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null;r&&null!=(a=r.elevationSampler.constantElevation(r.elevation,r.bias))&&(n=a,o=a);let s=(e,s,l)=>{if(null!=r)if(s.push(e),null!=a)i.elevatedLayoutVertexArray.emplaceBack(a),l.push(a);else{let a=r.elevationSampler.pointElevation(e,r.elevation,r.bias);i.elevatedLayoutVertexArray.emplaceBack(a),l.push(a),n=Math.min(n,a),o=Math.max(o,a)}};for(let n of e){let e=0;for(let i of n)e+=i.length;let o=i.triangleSegments.prepareSegment(e,i.layoutVertexArray,i.indexArray),a=o.vertexLength,l=[],h=[],u=[],c=[],d=[],p=i.layoutVertexArray.length;for(let e of n){if(0===e.length)continue;e!==n[0]&&h.push(l.length/2);let o=i.lineSegments.prepareSegment(e.length,i.layoutVertexArray,i.lineIndexArray),a=o.vertexLength;r&&d.push(i.layoutVertexArray.length-p),s(e[0],u,c),i.layoutVertexArray.emplaceBack(e[0].x,e[0].y),i.lineIndexArray.emplaceBack(a+e.length-1,a),l.push(e[0].x),l.push(e[0].y);for(let r=1;r<e.length;r++)s(e[r],u,c),i.layoutVertexArray.emplaceBack(e[r].x,e[r].y),i.lineIndexArray.emplaceBack(a+r-1,a+r),l.push(e[r].x),l.push(e[r].y);o.vertexLength+=e.length,o.primitiveLength+=e.length}let f=lk(l,h);for(let e=0;e<f.length;e+=3)i.indexArray.emplaceBack(a+f[e],a+f[e+1],a+f[e+2]);if(f.length>0&&r&&"hd-road-base"===this.elevationMode){let e=r.elevation.isTunnel(),i=r.elevation.safeArea,n=this.elevatedStructures.addVertices(u,c);this.elevatedStructures.addTriangles(f,n,e);let o=d.length;if(o>0){for(let a=0;a<o-1;a++)this.elevatedStructures.addRenderableRing(r.index,d[a]+n,d[a+1]-d[a],e,i);this.elevatedStructures.addRenderableRing(r.index,d[o-1]+n,u.length-d[o-1],e,i)}}o.vertexLength+=e,o.primitiveLength+=f.length/3}return[n,o]}prepareElevatedPolygons(e,i,r){let n=1/sd(r),o=[];for(let r of e){let e=function(e,i){let r=hw(e,65536);for(;i.valid();i.next()){let[e,n]=i.get(),o=65536*e.x,a=65536*e.y,s=65536*n.x,l=65536*n.y,h=s-o,u=l-a,c=Math.hypot(h,u),d=Math.trunc(u/c*3),p=-Math.trunc(h/c*3);r=hx.diff(r,[[[o,a],[s,l],[s+d,l+p],[o+d,a+p],[o,a]]])}return hT(r,152587890625e-16)}(r,new hu(i,n));o.push(...e)}return o}clipPolygonsToTile(e,i){let r=-i,n=-i,o=8192+i,a=8192+i,s=0,l=[],h=[];for(;s<e.length;s++){let i=e[s],u=i9(i);(u.min.x>=r&&u.max.x<=o&&u.min.y>=n&&u.max.y<=a?l:h).push(i)}if(l.length===e.length)return e;let u=[new e3(r,n),new e3(o,n),new e3(o,a),new e3(r,a),new e3(r,n)];for(let e of h)l.push(...function(e,i){let r=hw(e),n=hw([i]),o=hx.intersection(r,n);return null==o?[]:hT(o)}(e,u));return l}}nX(hE,"FillBucket",{omit:["layers","patternFeatures"]}),nX(hS,"FillBufferData"),nX(h_,"ElevatedStructures");class hI{constructor(e,i,r,n){if(this.triangleCount=i.length/3,this.min=new e3(0,0),this.max=new e3(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;let[o,a]=[e[0].clone(),e[0].clone()];for(let i=1;i<e.length;++i){let r=e[i];o.x=Math.min(o.x,r.x),o.y=Math.min(o.y,r.y),a.x=Math.max(a.x,r.x),a.y=Math.max(a.y,r.y)}if(n&&(r=Math.max(r,Math.ceil(Math.max(a.x-o.x,a.y-o.y)/n))),0===r)return;this.min=o,this.max=a;let s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);let l=Math.max(s.x,s.y)/r;this.cellsX=Math.max(1,Math.ceil(s.x/l)),this.cellsY=Math.max(1,Math.ceil(s.y/l)),this.xScale=1/l,this.yScale=1/l;let h=[];for(let r=0;r<this.triangleCount;r++){let n=e[i[3*r+0]].sub(this.min),o=e[i[3*r+1]].sub(this.min),a=e[i[3*r+2]].sub(this.min),s=hC(Math.floor(Math.min(n.x,o.x,a.x)),this.xScale,this.cellsX),u=hC(Math.floor(Math.max(n.x,o.x,a.x)),this.xScale,this.cellsX),c=hC(Math.floor(Math.min(n.y,o.y,a.y)),this.yScale,this.cellsY),d=hC(Math.floor(Math.max(n.y,o.y,a.y)),this.yScale,this.cellsY),p=new e3(0,0),f=new e3(0,0),m=new e3(0,0),g=new e3(0,0);for(let e=c;e<=d;++e){p.y=f.y=e*l,m.y=g.y=(e+1)*l;for(let i=s;i<=u;++i)p.x=m.x=i*l,f.x=g.x=(i+1)*l,(sO(n,o,a,p,f,g)||sO(n,o,a,p,g,m))&&h.push({cellIdx:e*this.cellsX+i,triIdx:r})}}if(0===h.length)return;h.sort((e,i)=>e.cellIdx-i.cellIdx||e.triIdx-i.triIdx);let u=0;for(;u<h.length;){let e=h[u].cellIdx,i={start:this.payload.length,len:0};for(;u<h.length&&h[u].cellIdx===e;)++i.len,this.payload.push(h[u++].triIdx);this.cells[e]=i}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let r=hC(e.x-this.min.x,this.xScale,this.cellsX),n=hC(e.y-this.min.y,this.yScale,this.cellsY),o=this.cells[n*this.cellsX+r];if(o){this._lazyInitLookup();for(let e=0;e<o.len;e++){let r=this.payload[o.start+e],n=Math.floor(r/8),a=1<<r%8;if(!(this.lookup[n]&a)&&(this.lookup[n]|=a,i.push(r),i.length===this.triangleCount))return}}}query(e,i,r){if(0===this.triangleCount||0===this.cells.length||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();let n=hC(e.x-this.min.x,this.xScale,this.cellsX),o=hC(i.x-this.min.x,this.xScale,this.cellsX),a=hC(e.y-this.min.y,this.yScale,this.cellsY),s=hC(i.y-this.min.y,this.yScale,this.cellsY);for(let e=a;e<=s;e++)for(let i=n;i<=o;i++){let n=this.cells[e*this.cellsX+i];if(n)for(let e=0;e<n.len;e++){let i=this.payload[n.start+e],o=Math.floor(i/8),a=1<<i%8;if(!(this.lookup[o]&a)&&(this.lookup[o]|=a,r.push(i),r.length===this.triangleCount))return}}}}function hC(e,i,r){return Math.max(0,Math.min(r-1,Math.floor(e*i)))}nX(hI,"TriangleGridIndex");class hA{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[]}updateFootprints(e,i){for(let r of this.footprints)i.push({footprint:r,id:e})}populate(e,i,r,n){let o=[];for(let{feature:i,id:a,index:s,sourceLayerIndex:l}of e){let e=this.layers[0]._featureFilter.needGeometry,h=s_(i,e);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),h,r))continue;let u={id:a,properties:i.properties,type:i.type,sourceLayerIndex:l,index:s,geometry:e?h.geometry:sg(i,r,n),patterns:{}};o.push(u)}for(let n of o){let{geometry:o,index:a,sourceLayerIndex:s}=n;this.addFeature(n,o,a,r,{},i.availableImages,i.brightness),i.featureIndex.insert(e[a].feature,o,a,s,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,i,r,n,o,a,s){}destroy(){}addFeature(e,i,r,n,o,a=[],s){for(let e of lY(i,2)){let i=[],r=[],n=[],o=new e3(1/0,1/0),a=new e3(-1/0,-1/0);for(let s of e)if(0!==s.length){s!==e[0]&&n.push(r.length/2);for(let e=0;e<s.length;e++)r.push(s[e].x),r.push(s[e].y),i.push(s[e]),o.x=Math.min(o.x,s[e].x),o.y=Math.min(o.y,s[e].y),a.x=Math.max(a.x,s[e].x),a.y=Math.max(a.y,s[e].y)}let s=lk(r,n),l=new hI(i,s,8,256);this.footprints.push({vertices:i,indices:s,grid:l,min:o,max:a})}}}nX(hA,"ClipBucket",{omit:["layers"]});let hR=oN([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hM=oN([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),hP=oN([{name:"a_centroid_pos",components:2,type:"Uint16"}]),hO=oN([{name:"a_join_normal_inside",components:3,type:"Int16"}]),hk=oN([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),hL=oN([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:hD}=hR,hz=Number.MAX_SAFE_INTEGER;function hF(e,i,r,n){var o;return e.order<i||e.order===hz||!(e.clipMask&r)||0!==(o=e.clipScope).length&&void 0===o.find(e=>e===n)}function hB(e,i){return e.x-i.x||e.y-i.y}function hN(e,i){return 0===hB(e.min,i.min)&&0===hB(e.max,i.max)}function hj(e,i){return!(e.min.x>i.max.x||e.max.x<i.min.x||e.min.y>i.max.y||e.max.y<i.min.y)}function hV(e,i){if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==i[r].sourceId||!hN(e[r],i[r])||e[r].order!==i[r].order||e[r].clipMask!==i[r].clipMask||!e5(e[r].clipScope,i[r].clipScope))return!1;return!0}function hU(e,i,r){let n=1/(1<<r.canonical.z),o=(1220703125e-13*i.x+r.canonical.x)*n+r.wrap,a=(1220703125e-13*i.y+r.canonical.y)*n;return{min:new e3((1220703125e-13*e.x+r.canonical.x)*n+r.wrap,(1220703125e-13*e.y+r.canonical.y)*n),max:new e3(o,a)}}function hG(e,i,r,n,o,a,s){let l=e.indices,h=e.vertices,u=[];for(let c=n;c<n+o;c+=3){let n=i[r[c+0]+a],o=i[r[c+1]+a],d=i[r[c+2]+a],p=Math.min(n.x,o.x,d.x),f=Math.max(n.x,o.x,d.x),m=Math.min(n.y,o.y,d.y),g=Math.max(n.y,o.y,d.y);u.length=0,e.grid.query(new e3(p,m),new e3(f,g),u);for(let e=0;e<u.length;e++){let i=u[e];if(sO(h[l[3*i+0]],h[l[3*i+1]],h[l[3*i+2]],n,o,d,s))return!0}}return!1}function hq(e,i,r,n){let o=Math.pow(2,n.z-r.z);return new e3((e+8192*r.x)*o-8192*n.x,(i+8192*r.y)*o-8192*n.y)}function h$(e,i){let r=[];i.grid.queryPoint(e,r);let n=i.indices,o=i.vertices;for(let i=0;i<r.length;i++){let a=r[i];if(sA([o[n[3*a+0]],o[n[3*a+1]],o[n[3*a+2]]],e))return!0}return!1}let hH=[new e3(0,0),new e3(8192,0),new e3(8192,8192),new e3(0,8192)];function hZ(e,i){let r=[],n=[];if(!i||e.length<2)return[e];if(2===e.length)return sM(e[0],e[1],hH)?[e]:[];for(let i=0;i<e.length+2;i++){let o=e[i%e.length],a=e[(i+1)%e.length],s=sM(0===i?e[e.length-1]:e[(i-1)%e.length],o,hH),l=sM(o,a,hH),h=s||l;h&&n.push(o),h&&l||n.length>0&&(n.length>1&&r.push(n),n=[])}return n.length>1&&r.push(n),r}let hW=hi.VectorTileFeature.types,hX=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],hY=["fill-extrusion-flood-light-ground-radius"],hK=new e3(0,1);function hJ(e,i,r,n,o,a,s,l){e.emplaceBack((i<<1)+s,(r<<1)+a,(Math.floor(8192*n)<<1)+o,Math.round(l))}function hQ(e,i,r){e.emplaceBack(8192*i.x,8192*i.y,+!!r)}function h0(e,i,r,n,o,a){e.emplaceBack(i.x,i.y,(r.x<<1)+n,(r.y<<1)+o,a)}function h1(e,i,r){e.emplaceBack(i.x,i.y,i.z,16384*r[0],16384*r[1],16384*r[2])}class h2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class h3{constructor(){this.centroidXY=new e3(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new e3(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new e3(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new e3(this.max.x-this.min.x,this.max.y-this.min.y)}}class h5{constructor(){this.acc=new e3(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,r){this.accCount++,this.acc._add(i);let n=!!this.borders;i.x<e.min.x?(e.min.x=i.x,n=!0):i.x>e.max.x&&(e.max.x=i.x,n=!0),i.y<e.min.y?(e.min.y=i.y,n=!0):i.y>e.max.y&&(e.max.y=i.y,n=!0),((0===i.x||8192===i.x)&&i.x===r.x)!=((0===i.y||8192===i.y)&&i.y===r.y)&&this.processBorderOverlap(i,r),n&&this.checkBorderIntersection(i,r)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ih(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>8192!=e.x>8192&&this.addBorderIntersection(1,ih(i.y,e.y,(8192-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ih(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>8192!=e.y>8192&&this.addBorderIntersection(3,ih(i.x,e.x,(8192-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let r=+(0!==e.x);this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{let r=0===e.y?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new e3(0,0):new e3(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function h4(e,i){let r=e.add(i)._unit();return Math.min(4,Math.max(-4,Math.tan(Math.acos(tt(e.x*r.x+e.y*r.y,-1,1)))))/4*32767*(e.x*i.y-e.y*i.x<0?-1:1)}let h6=[e=>e.x<0,e=>e.x>8192,e=>e.y<0,e=>e.y>8192];class h8{constructor(e){this.vertexArray=new oZ,this.indexArray=new o9,this.programConfigurations=new a0(e.layers,{zoom:e.zoom,lut:e.lut},e=>hY.includes(e)),this._segments=new aC,this.hiddenByLandmarkVertexArray=new ac,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new aC}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,i,r,n=!1){let o=e.length;if(o>2){let a,s=Math.max(0,this._segments.get().length-1),l=this._segments._prepareSegment(4*o,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{let i=e[0],r=e[1];a=h4(i.sub(e[o-1])._perp()._unit(),r.sub(i)._perp()._unit())}for(let h=0;h<o;h++){let u=h===o-1?0:h+1,c=e[h],d=e[u],p=e[u===o-1?0:u+1],f=d.sub(c)._perp()._unit(),m=h4(f,p.sub(d)._perp()._unit()),g=a;if(ut(c,d,i)||n&&ui(c,i)&&ui(d,i)){a=m;continue}let _=l.vertexLength;for(let e of(h0(this.vertexArray,c,d,1,1,g),h0(this.vertexArray,c,d,1,0,g),h0(this.vertexArray,c,d,0,1,m),h0(this.vertexArray,c,d,0,0,m),l.vertexLength+=4,function(e,i,r,n){let o=[4];if(0===n)return o;r._mult(n);let a=e.sub(r),s=i.sub(r),l=[e,i,a,s];for(let e=0;e<4;e++)for(let i of l)if(h6[e](i)){o.push(e);break}return o}(c,d,f,r)))this._segmentToGroundQuads[s].push({id:_,region:e}),this._segmentToRegionTriCounts[s][e]+=2,l.primitiveLength+=2;a=m}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let e=0;e<i;e++)this._segmentToGroundQuads[e].sort((e,i)=>e.region-i.region);for(let r=0;r<i;r++){let i=this._segmentToGroundQuads[r],n=e[r],o=this._segmentToRegionTriCounts[r];o.reduce((e,i)=>e+i,0);let a=0;for(let e=0;e<=4;e++){let i=o[e];if(0!==i){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new aC);let o={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+a,vertexLength:n.vertexLength,primitiveLength:i};r.get().push(o)}a+=i}for(let e=0;e<i.length;e++){let r=i[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,r,n,o,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,r,n,o,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,r,n,o,a,s){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,r,n,o,a,s)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;let r=0x80000000&e.flags?1:0;for(let n=e.groundVertexArrayOffset;n<i;++n)this.hiddenByLandmarkVertexArray.emplace(n,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,hk.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class h9{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new o9,this.footprintVertices=new oV,this.footprintSegments=[],this.layoutVertexArray=new oG,this.centroidVertexArray=new aw,this.wallVertexArray=new aS,this.indexArray=new o9,this.programConfigurations=new a0(e.layers,{zoom:e.zoom,lut:e.lut},e=>hX.includes(e)),this.segments=new aC,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new h8(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,r,n){for(let{feature:o,id:a,index:s,sourceLayerIndex:l}of(this.features=[],this.hasPattern=lQ("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=sd(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1),e)){let e=this.layers[0]._featureFilter.needGeometry,h=s_(o,e);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),h,r))continue;let u={id:a,sourceLayerIndex:l,index:s,geometry:e?h.geometry:sg(o,r,n),properties:o.properties,type:o.type,patterns:{}},c=this.layoutVertexArray.length,d="Polygon"===hW[u.type];if(this.hasPattern)this.features.push(l0("fill-extrusion",this.layers,u,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(let e of u.geometry)for(let o of hZ(e,d))this.addFeature(u,[o],s,r,{},i.availableImages,n,i.brightness);else this.addFeature(u,u.geometry,s,r,{},i.availableImages,n,i.brightness);i.featureIndex.insert(o,u.geometry,s,l,this.index,c)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,r,n,o,a){for(let e of this.features){let s="Polygon"===hW[e.type],{geometry:l}=e;if(this.wallMode)for(let h of l)for(let l of hZ(h,s))this.addFeature(e,[l],e.index,i,r,n,o,a);else this.addFeature(e,l,e.index,i,r,n,o,a)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,i,r,n,o,a,s){this.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s),this.groundEffect.update(e,i,o,r,n,a,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hD),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,hO.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,hL.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,hP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,n,o,a,s,l){var h;let u,c,d=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,p=[new e3(0,0),new e3(8192,8192)],f=s.projection,m="globe"===f.name,g=this.wallMode||"Polygon"===hW[e.type],_=new h5;_.centroidDataIndex=this.centroidData.length;let y=new h3,v=0>=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},n),x=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},n);if(y.height=x,y.vertexArrayOffset=this.layoutVertexArray.length,y.groundVertexArrayOffset=this.groundEffect.vertexArray.length,m&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new oJ),this.wallMode){if(m)return void tf("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==i.length)return;i=[(u=function(e){let i=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y;(function(e){let i=0,r=e.length;for(let n=0;n<r;n++)i+=(e[(n+1)%r].x-e[n].x)*(e[(n+1)%r].y+e[n].y);return i>=0})(e)||(e=e.reverse());let r={geometry:[],joinNormals:[],indices:[]},n=[],o=[],a=[],s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;if(s<(i?3:2))return r;let l,h,u,c,d,p=0;for(;p<s-1&&e[p].equals(e[p+1]);)p++;i&&(l=e[s-2],d=e[p].sub(l)._unit()._perp());for(let r=p;r<s;r++){if((u=r===s-1?i?e[p+1]:void 0:e[r+1])&&e[r].equals(u))continue;d&&(c=d),l&&(h=l),l=e[r],d=u?u.sub(l)._unit()._perp():c;let f=(c=c||d).add(d);0===f.x&&0===f.y||f._unit();let m=f.x*d.x+f.y*d.y,g=0!==m?1/m:1/0,_=c.x*d.y-c.y*d.x>0,y="miter";"miter"===y&&g>2&&(y="bevel"),"bevel"===y&&(g>100&&(y="flipbevel"),g<2&&(y="miter"));let v=(e,i,r,s)=>{let l=new e3(e.x,e.y),h=new e3(e.x,e.y);l.x+=i.x*s,l.y+=i.y*s,h.x-=i.x*Math.max(r,1),h.y-=i.y*Math.max(r,1),a.push(i),n.push(l),o.push(h)};if("miter"===y)f._mult(g),v(l,f,0,0);else if("flipbevel"===y)v(l,f=d.mult(-1),0,0),v(l,f.mult(-1),0,0);else{let e=-Math.sqrt(g*g-1),i=_?e:0,r=_?0:e;h&&v(l,c,i,r),u&&v(l,d,i,r)}}r.geometry=[...n,...o.reverse(),n[0]],r.joinNormals=[...a,...a.reverse(),a[a.length-1]];let f=r.geometry.length-1;for(let e=0;e<f/2;e++)if(e+1<f/2){let i=e,n=e+1,o=f-1-e,a=f-2-e;i=0===i?f-1:i-1,n=0===n?f-1:n-1,o=0===o?f-1:o-1,a=0===a?f-1:a-1,r.indices.push(o),r.indices.push(n),r.indices.push(i),r.indices.push(o),r.indices.push(a),r.indices.push(n)}return r}(i[0])).geometry]}let b=(e,i)=>e<(i.length-1)/2||e===i.length-1,w=this.wallMode?[i]:lY(i,500);for(let e=w.length-1;e>=0;e--){let i=w[e];(0===i.length||(h=i[0]).every(e=>e.x<=0)||h.every(e=>e.x>=8192)||h.every(e=>e.y<=0)||h.every(e=>e.y>=8192))&&w.splice(e,1)}if(m)c=ua(w,p,n);else for(let e of(c=[],w))c.push({polygon:e,bounds:p});let T=g?this.edgeRadius:0,S=T>0&&this.zoom<17,E=(e,i)=>{if(0===e.length)return!1;let r=e[e.length-1];return i.x===r.x&&i.y===r.y};for(let{polygon:e,bounds:i}of c){let r=0,o=0;for(let i of e)g&&!i[0].equals(i[i.length-1])&&i.push(i[0]),o+=g?i.length-1:i.length;let a=this.segments.prepareSegment((g?5:4)*o,this.layoutVertexArray,this.indexArray);y.footprintSegIdx<0&&(y.footprintSegIdx=this.footprintSegments.length),y.polygonSegIdx<0&&(y.polygonSegIdx=this.polygonSegments.length);let s={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},l=new h2;if(l.vertexOffset=this.footprintVertices.length,l.indexOffset=3*this.footprintIndices.length,l.ringIndices=[],g){let o=[],s=[];r=a.vertexLength;for(let r=0;r<e.length;r++){let h,c,p=e[r];p.length&&0!==r&&s.push(o.length/2);let g=[];h=p[1].sub(p[0])._perp()._unit(),l.ringIndices.push(p.length-1);for(let e=1;e<p.length;e++){let i=p[e],r=p[e===p.length-1?1:e+1],s=i.clone();if(T){c=r.sub(i)._perp()._unit();let e=h.add(c)._unit(),n=T*Math.min(4,1/(h.x*e.x+h.y*e.y));s.x+=n*e.x,s.y+=n*e.y,s.x=Math.round(s.x),s.y=Math.round(s.y),h=c}if(!v||0!==T&&!S||E(g,s)||g.push(s),hJ(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),this.wallMode){let i=b(e,p);hQ(this.wallVertexArray,u.joinNormals[e],!i)}a.vertexLength++,this.footprintVertices.emplaceBack(i.x,i.y),o.push(i.x,i.y),m&&h1(this.layoutVertexExtArray,f.projectTilePoint(s.x,s.y,n),f.upVector(n,s.x,s.y))}v&&(0===T||S)&&(0!==g.length&&E(g,g[0])&&g.pop(),this.groundEffect.addData(g,i,d))}let h=this.wallMode?u.indices:lk(o,s);for(let e=0;e<h.length;e+=3)this.footprintIndices.emplaceBack(l.vertexOffset+h[e+0],l.vertexOffset+h[e+1],l.vertexOffset+h[e+2]),this.indexArray.emplaceBack(r+h[e],r+h[e+2],r+h[e+1]),a.primitiveLength++;l.indexCount+=h.length,l.vertexCount+=this.footprintVertices.length-l.vertexOffset}for(let o=0;o<e.length;o++){let s,l,h,c=e[o];_.startRing(y,c[0]);let p=c.length>4&&ur(c[c.length-2],c[0],c[1]),x=T?function(e,i,r,n){let o=i.sub(e)._perp()._unit(),a=r.sub(i)._perp()._unit();return ue(e,i,r,h7(o,a),n)}(c[c.length-2],c[0],c[1],T):0,w=[];l=c[1].sub(c[0])._perp()._unit();let S=!0;for(let e=1,o=0;e<c.length;e++){let d=c[e-1],g=c[e],I=c[e===c.length-1?1:e+1];if(_.appendEdge(y,g,d),ut(g,d,i)){T&&(l=I.sub(g)._perp()._unit(),S=!S);continue}let C=g.sub(d)._perp(),A=C.x/(Math.abs(C.x)+Math.abs(C.y)),R=+(C.y>0),M=d.dist(g);if(o+M>32768&&(o=0),T){h=I.sub(g)._perp()._unit();let e=ue(d,g,I,h7(l,h),T);isNaN(e)&&(e=0);let i=g.sub(d)._unit();d=d.add(i.mult(x))._round(),g=g.add(i.mult(-e))._round(),x=e,l=h,v&&this.zoom>=17&&(E(w,d)||w.push(d),E(w,g)||w.push(g))}let P=a.vertexLength,O=c.length>4&&ur(d,g,I),k=un(o,p,S);if(hJ(this.layoutVertexArray,d.x,d.y,A,R,0,0,k),hJ(this.layoutVertexArray,d.x,d.y,A,R,0,1,k),this.wallMode){let i=b(e-1,c),r=u.joinNormals[e-1];hQ(this.wallVertexArray,r,i),hQ(this.wallVertexArray,r,i)}if(o+=M,k=un(o,O,!S),p=O,hJ(this.layoutVertexArray,g.x,g.y,A,R,0,0,k),hJ(this.layoutVertexArray,g.x,g.y,A,R,0,1,k),this.wallMode){let i=b(e,c),r=u.joinNormals[e];hQ(this.wallVertexArray,r,i),hQ(this.wallVertexArray,r,i)}if(a.vertexLength+=4,this.indexArray.emplaceBack(P+0,P+1,P+2),this.indexArray.emplaceBack(P+1,P+3,P+2),a.primitiveLength+=2,T){let n=r+(1===e?c.length-2:e-2),o=1===e?r:n+1;if(this.indexArray.emplaceBack(P+1,n,P+3),this.indexArray.emplaceBack(n,o,P+3),a.primitiveLength+=2,void 0===s&&(s=P),!ut(I,c[e],i)){let i=e===c.length-1?s:a.vertexLength;this.indexArray.emplaceBack(P+2,P+3,i),this.indexArray.emplaceBack(P+3,i+1,i),this.indexArray.emplaceBack(P+3,o,i+1),a.primitiveLength+=3}S=!S}if(m){let e=this.layoutVertexExtArray,i=f.projectTilePoint(d.x,d.y,n),r=f.projectTilePoint(g.x,g.y,n),o=f.upVector(n,d.x,d.y),a=f.upVector(n,g.x,g.y);h1(e,i,o),h1(e,i,o),h1(e,r,a),h1(e,r,a)}}g&&(r+=c.length-1),v&&T&&this.zoom>=17&&(0!==w.length&&E(w,w[0])&&w.pop(),this.groundEffect.addData(w,i,d,T>0))}this.footprintSegments.push(l),s.triangleCount=this.indexArray.length-s.triangleArrayOffset,this.polygonSegments.push(s),++y.footprintSegLen,++y.polygonSegLen}if(y.vertexCount=this.layoutVertexArray.length-y.vertexArrayOffset,y.groundVertexCount=this.groundEffect.vertexArray.length-y.groundVertexArrayOffset,0!==y.vertexCount){if(y.centroidXY=_.borders?hK:this.encodeCentroid(_,y),this.centroidData.push(y),_.borders){this.featuresOnBorder.push(_);let e=this.featuresOnBorder.length-1;for(let i=0;i<_.borders.length;i++)_.borders[i][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[i].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,o,a,n,l),this.groundEffect.addPaintPropertiesData(e,r,o,a,n,l),this.maxHeight=Math.max(this.maxHeight,x)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){let e=[];for(let i=0;i<this.centroidData.length;i++){let r=this.centroidData[i],n=+(r.min.y+r.max.y>8192),o=2*n+(r.min.x+r.max.x>8192^n);for(let n=0;n<r.polygonSegLen;n++){let a=r.polygonSegIdx+n;e.push({centroidIdx:i,subtile:o,polygonSegmentIdx:a,triangleSegmentIdx:this.polygonSegments[a].triangleSegIdx})}}let i=new o9;e.sort((e,i)=>e.triangleSegmentIdx===i.triangleSegmentIdx?e.subtile-i.subtile:e.triangleSegmentIdx-i.triangleSegmentIdx);let r=0,n=0,o=0;for(let i of e){if(i.triangleSegmentIdx!==r)break;o++}let a=e.length;for(;n!==e.length;){r=e[n].triangleSegmentIdx;let s=0,l=n,h=n;for(let i=l;i<o&&e[i].subtile===s;i++)h++;for(;l!==o;){let n=e[l];s=n.subtile;let a=this.centroidData[n.centroidIdx].min.clone(),u=this.centroidData[n.centroidIdx].max.clone(),c={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=l;r<h;r++){let n=e[r],o=this.polygonSegments[n.polygonSegmentIdx],s=this.centroidData[n.centroidIdx].min,l=this.centroidData[n.centroidIdx].max,h=this.indexArray.uint16;for(let e=o.triangleArrayOffset;e<o.triangleArrayOffset+o.triangleCount;e++)i.emplaceBack(h[3*e],h[3*e+1],h[3*e+2]);c.primitiveLength+=o.triangleCount,a.x=Math.min(a.x,s.x),a.y=Math.min(a.y,s.y),u.x=Math.max(u.x,l.x),u.y=Math.max(u.y,l.y)}c.primitiveLength>0&&this.triangleSubSegments.push({segment:c,min:a,max:u}),l=h;for(let i=l;i<o&&e[i].subtile===e[l].subtile;i++)h++}n=o;for(let i=n;i<a&&e[i].triangleSegmentIdx===e[n].triangleSegmentIdx;i++)o++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,r){let n,o=new aC;if(this.wallMode){for(let e of this.triangleSubSegments)o.segments.push(e.segment);return o}let a=0,s=0,l=1<<e.canonical.z;if(i){let r=i.getMinMaxForTile(e);r&&(a=r.min,s=r.max)}s+=this.maxHeight;let h=e.toUnwrapped(),u=[h.canonical.x/l+h.wrap,h.canonical.y/l],c=[(h.canonical.x+1)/l+h.wrap,(h.canonical.y+1)/l],d=(e,i,r)=>[e[0]*(1-r[0])+i[0]*r[0],e[1]*(1-r[1])+i[1]*r[1]],p=[],f=[];for(let e of this.triangleSubSegments){p[0]=e.min.x/8192,p[1]=e.min.y/8192,f[0]=e.max.x/8192,f[1]=e.max.y/8192;let i=d(u,c,p),l=d(u,c,f);if(0===new s0([i[0],i[1],a],[l[0],l[1],s]).intersectsPrecise(r)){n&&(o.segments.push(n),n=void 0);continue}let h=e.segment;n&&n.vertexOffset!==h.vertexOffset&&(o.segments.push(n),n=void 0),n?(n.vertexLength+=h.vertexLength,n.primitiveLength+=h.primitiveLength):n={vertexOffset:h.vertexOffset,primitiveLength:h.primitiveLength,vertexLength:h.vertexLength,primitiveOffset:h.primitiveOffset,sortKey:void 0,vaos:{}}}return n&&o.segments.push(n),o}encodeCentroid(e,i){let r=e.centroid(),n=i.span(),o=Math.min(7,Math.round(n.x*this.tileToMeter/10)),a=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new e3(tt(r.x,1,8191)<<3|o,tt(r.y,1,8191)<<3|a)}encodeBorderCentroid(e){if(!e.borders)return new e3(0,0);let i=e.borders,r=Number.MAX_VALUE;if(i[0][0]!==r||i[1][0]!==r){let e=+(i[0][0]===r);return new e3(6|65528*(i[0][0]===r),(i[e][0]+i[e][1])/2<<3|6)}{let e=i[2][0]!==r?2:3;return new e3((i[e][0]+i[e][1])/2<<3|6,6|65528*(i[2][0]===r))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=0x80000000,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=0x80000000&e.flags?hK:e.centroidXY,o=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==n.y||o!==n.x){for(let e=i;e<r;++e)this.centroidVertexArray.emplace(e,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){for(let e of(this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length),this.centroidData))this.writeCentroidToBuffer(e)}updateReplacement(e,i,r){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let n=i.getReplacementRegionsForTile(e.toUnwrapped());if(hV(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(let e of this.centroidData)e.flags&=0x7fffffff;let o=[];for(let i of this.activeReplacements){if(i.order<r)continue;let n=Math.max(1,Math.pow(2,i.footprintTileId.canonical.z-e.canonical.z));for(let r of this.centroidData)if(!(0x80000000&r.flags||i.min.x>r.max.x||r.min.x>i.max.x||i.min.y>r.max.y||r.min.y>i.max.y))for(let a=0;a<r.footprintSegLen;a++){let s=this.footprintSegments[r.footprintSegIdx+a];if(o.length=0,function(e,i,r,n,o,a){let s=Math.pow(2,n.z-o.z);for(let l=0;l<r;l++){let r=e.int16[2*(l+i)+0],h=e.int16[2*(l+i)+1];r=(r+8192*o.x)*s-8192*n.x,h=(h+8192*o.y)*s-8192*n.y,a.push(new e3(r,h))}}(this.footprintVertices,s.vertexOffset,s.vertexCount,i.footprintTileId.canonical,e.canonical,o),hG(i.footprint,o,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-n)){r.flags|=0x80000000;break}}}for(let e of this.centroidData)this.writeCentroidToBuffer(e);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,r){let n=!1;for(let o=0;o<r.footprintSegLen;o++){let a=this.footprintSegments[r.footprintSegIdx+o],s=0;for(let r of a.ringIndices){for(let o=s,l=r+s-1;o<r+s;l=o++){let r=this.footprintVertices.int16[2*(o+a.vertexOffset)+0],s=this.footprintVertices.int16[2*(o+a.vertexOffset)+1],h=this.footprintVertices.int16[2*(l+a.vertexOffset)+1];s>i!=h>i&&e<(this.footprintVertices.int16[2*(l+a.vertexOffset)+0]-r)*(i-s)/(h-s)+r&&(n=!n)}s=r}}return n}getHeightAtTileCoord(e,i){let r=Number.NEGATIVE_INFINITY,n=!0,o=4*(e+8192)*8192+(i+8192);if(this.partLookup.hasOwnProperty(o)){let e=this.partLookup[o];return e?{height:e.height,hidden:!!(0x80000000&e.flags)}:void 0}for(let a of this.centroidData)e>a.max.x||a.min.x>e||i>a.max.y||a.min.y>i||this.footprintContainsPoint(e,i,a)&&a&&a.height>r&&(r=a.height,this.partLookup[o]=a,n=!!(0x80000000&a.flags));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[o]=void 0}}function h7(e,i){let r=e.add(i)._unit();return e.x*r.x+e.y*r.y}function ue(e,i,r,n,o){let a=Math.sqrt(1-n*n);return Math.min(e.dist(i)/3,i.dist(r)/3,o*a/n)}function ut(e,i,r){return e.x<r[0].x&&i.x<r[0].x||e.x>r[1].x&&i.x>r[1].x||e.y<r[0].y&&i.y<r[0].y||e.y>r[1].y&&i.y>r[1].y}function ui(e,i){return e.x<i[0].x||e.x>i[1].x||e.y<i[0].y||e.y>i[1].y}function ur(e,i,r){if(e.x<0||e.x>=8192||i.x<0||i.x>=8192||r.x<0||r.x>=8192)return!1;let n=r.sub(i),o=n.perp(),a=e.sub(i);return(n.x*a.x+n.y*a.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(a.x*a.x+a.y*a.y))>-.866&&o.x*a.x+o.y*a.y<0}function un(e,i,r){let n=i?2|e:-3&e;return r?1|n:-2&n}function uo(){let e=Math.tan(Math.PI/32);return 6371008.8*Math.sqrt(1+2*e*e)-6371008.8}function ua(e,i,r){let n=1<<r.z,o=sa(r.x/n),a=sa((r.x+1)/n);return function(e,i,r,n,o=0,a){let s=[];if(!e.length||!r||!n)return s;let l=(e,i)=>{for(let r of e)s.push({polygon:r,bounds:i})},h=Math.ceil(Math.log2(r)),u=Math.ceil(Math.log2(n)),c=h-u,d=[];for(let e=0;e<Math.abs(c);e++)d.push(c>0?0:1);for(let e=0;e<Math.min(h,u);e++)d.push(0),d.push(1);let p=e;if(p=hb(p,i[0].y-o,i[1].y+o,1),!(p=hb(p,i[0].x-o,i[1].x+o,0)).length)return s;let f=[];for(d.length?f.push({polygons:p,bounds:i,depth:0}):l(p,i);f.length;){let e=f.pop(),i=e.depth,r=d[i],n=e.bounds[0],s=e.bounds[1],h=0===r?n.x:n.y,u=0===r?s.x:s.y,c=a?a(r,h,u):.5*(h+u),p=hb(e.polygons,h-o,c+o,r),m=hb(e.polygons,c-o,u+o,r);if(p.length){let e=[n,new e3(0===r?c:s.x,1===r?c:s.y)];d.length>i+1?f.push({polygons:p,bounds:e,depth:i+1}):l(p,e)}if(m.length){let e=[new e3(0===r?c:n.x,1===r?c:n.y),s];d.length>i+1?f.push({polygons:m,bounds:e,depth:i+1}):l(m,e)}}return s}(e,i,Math.ceil((a-o)/11.25),Math.ceil((ss(r.y/n)-ss((r.y+1)/n))/11.25),1,(e,i,o)=>{if(0===e)return .5*(i+o);{let e=ss((r.y+i/8192)/n);return(so(.5*(ss((r.y+o/8192)/n)+e))*n-r.y)*8192}})}nX(h9,"FillExtrusionBucket",{omit:["layers","features"]}),nX(h3,"PartData"),nX(h2,"FootprintSegment"),nX(h5,"BorderCentroidData"),nX(h8,"GroundEffect");class us extends e3{constructor(e,i,r){super(e,i),this.z=r}}class ul extends us{constructor(e,i,r,n){super(e,i,r),this.w=n}}function uh(e,i,r,n){let o="x"===r?"y":"x",a=(n-e[r])/(i[r]-e[r]);e[o]=Math.round(e[o]+(i[o]-e[o])*a),e[r]=n,e.hasOwnProperty("z")&&(e.z=ih(e.z,i.z,a)),e.hasOwnProperty("w")&&(e.w=ih(e.w,i.w,a))}function uu(e,i,r,n){for(let o of["x","y"]){let a=e,s=i;a[o]>=s[o]&&(a=i,s=e),a[o]<r&&s[o]>r&&uh(a,s,o,r),a[o]<n&&s[o]>n&&uh(s,a,o,n)}}function uc(e,i,r,n,o,a){let s=[];for(let l=0;l<e.length;l++){let h,u=e[l],c=s.length,d=0;for(let e=0;e<u.length-1;e++){let c,p,f=u[e],m=u[e+1],g=0,_=d;a&&(d+=g=Math.hypot(m.x-f.x,m.y-f.y),c=f,p=m),f.x<i&&m.x<i||(f.x<i?f=new e3(i,f.y+(i-f.x)/(m.x-f.x)*(m.y-f.y))._round():m.x<i&&(m=new e3(i,f.y+(i-f.x)/(m.x-f.x)*(m.y-f.y))._round()),f.y<r&&m.y<r||(f.y<r?f=new e3(f.x+(r-f.y)/(m.y-f.y)*(m.x-f.x),r)._round():m.y<r&&(m=new e3(f.x+(r-f.y)/(m.y-f.y)*(m.x-f.x),r)._round()),f.x>=n&&m.x>=n||(f.x>=n?f=new e3(n,f.y+(n-f.x)/(m.x-f.x)*(m.y-f.y))._round():m.x>=n&&(m=new e3(n,f.y+(n-f.x)/(m.x-f.x)*(m.y-f.y))._round()),f.y>=o&&m.y>=o||(f.y>=o?f=new e3(f.x+(o-f.y)/(m.y-f.y)*(m.x-f.x),o)._round():m.y>=o&&(m=new e3(f.x+(o-f.y)/(m.y-f.y)*(m.x-f.x),o)._round()),h&&f.equals(h[h.length-1])||(h=[f],s.push(h),a&&a.push({progress:{min:_+ud(c,p,f)*g,max:1},parentIndex:l,prevPoint:c,nextPoint:p})),h.push(m),a&&(a[a.length-1].progress.max=_+ud(c,p,m)*g,a[a.length-1].nextPoint=p)))))}if(a&&d>0)for(let e=c;e<s.length;e++)a[e].progress.min/=d,a[e].progress.max/=d}return s}function ud(e,i,r){return e.x!==i.x?(r.x-e.x)/(i.x-e.x):e.y!==i.y?(r.y-e.y)/(i.y-e.y):0}function up(e,i){return e.x*i.x+e.y*i.y}function uf(e,i){if(1===e.length){let r,n=0,o=i[n++];for(;!r||o.equals(r);)if(!(r=i[n++]))return 1/0;for(;n<i.length;n++){let a=i[n],s=e[0],l=r.sub(o),h=a.sub(o),u=s.sub(o),c=up(l,l),d=up(l,h),p=up(h,h),f=up(u,l),m=up(u,h),g=c*p-d*d,_=(p*f-d*m)/g,y=(c*m-d*f)/g,v=o.z*(1-_-y)+r.z*_+a.z*y;if(isFinite(v))return v}return 1/0}{let e=1/0;for(let r of i)e=Math.min(e,r.z);return e}}function um(e,i,r,n,o,a,s,l){let h=s*o.getElevationAt(e,i,!0,!0),u=0!==a[0],c=u?0===a[1]?s*(a[0]/7-450):s*function(e,i,r){var n,o;let a=Math.floor(i[0]/8),s=Math.floor(i[1]/8),l=10*(i[0]-8*a),h=10*(i[1]-8*s),u=e.getElevationAt(a,s,!0,!0),c=e.getMeterToDEM(r),d=Math.floor(.5*(l*c-1)),p=Math.floor(.5*(h*c-1)),f=e.tileCoordToPixel(a,s),m=2*d+1,g=2*p+1,_=(n=f.x-d,o=f.y-p,[e.getElevationAtPixel(n,o,!0),e.getElevationAtPixel(n+g,o,!0),e.getElevationAtPixel(n,o+g,!0),e.getElevationAtPixel(n+m,o+g,!0)]),y=Math.abs(_[0]-_[1]),v=Math.abs(_[2]-_[3]);return u+Math.max(Math.min(.25,.5*c*(y+v)/m)*l,Math.min(.25,.5*c*(Math.abs(_[0]-_[2])+Math.abs(_[1]-_[3]))/g)*h)}(o,a,l):h;return{base:h+(0===r?-1:r),top:u?Math.max(c+n,h+r+2):h+n}}let ug=oN([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),u_=oN([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:uy}=ug,{members:uv}=oN([{name:"a_packed",components:3,type:"Float32"}]),{members:ux}=oN([{name:"a_pattern_data",components:3,type:"Float32"}]);class ub{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new lE({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let r=this.getKey(e,i);return this.positions[r]}trim(){let e=this.width,i=this.height=tl(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){let n=[],o=e.length%2==1?-e[e.length-1]*r:0,a=e[0]*r,s=!0;n.push({left:o,right:a,isDash:s,zeroLength:0===e[0]});let l=e[0];for(let i=1;i<e.length;i++){s=!s;let h=e[i];o=l*r,l+=h,a=l*r,n.push({left:o,right:a,isDash:s,zeroLength:0===h})}return n}addRoundDash(e,i,r){let n=i/2;for(let i=-r;i<=r;i++){let o=this.width*(this.nextRow+r+i),a=0,s=e[0];for(let l=0;l<this.width;l++){let h;l/s.right>1&&(s=e[++a]);let u=Math.min(Math.abs(l-s.left),Math.abs(l-s.right)),c=i/r*(n+1);if(s.isDash){let e=n-Math.abs(c);h=Math.sqrt(u*u+e*e)}else h=n-Math.sqrt(u*u+c*c);this.image.data[o+l]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,i){for(let i=e.length-1;i>=0;--i){let r=e[i],n=e[i+1];r.zeroLength?e.splice(i,1):n&&n.isDash===r.isDash&&(n.left=r.left,e.splice(i,1))}let r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);let o=this.width*this.nextRow,a=0,s=e[0];for(let r=0;r<this.width;r++){r/s.right>1&&(s=e[++a]);let n=Math.min(Math.abs(r-s.left),Math.abs(r-s.right));this.image.data[o+r]=Math.max(0,Math.min(255,(s.isDash?n:-n)+i+128))}}addDash(e,i){let r=this.getKey(e,i);if(this.positions[r])return this.positions[r];let n="round"===i,o=7*!!n,a=2*o+1;if(this.nextRow+a>this.height)return tf("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let i=0;i<e.length;i++)e[i]<0&&(tf("Negative value is found in line dasharray, replacing values with 0"),e[i]=0),s+=e[i];if(0!==s){let r=this.width/s,a=this.getDashRanges(e,this.width,r);n?this.addRoundDash(a,r,o):this.addRegularDash(a,"square"===i?.5*r:0)}let l=this.nextRow+o;this.nextRow+=a;let h={tl:[l,o],br:[s,0]};return this.positions[r]=h,h}}nX(ub,"LineAtlas");let uw=hi.VectorTileFeature.types,uT=Math.cos(Math.PI/180*37.5),uS=Math.cos(Math.PI/180*5);class uE{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new oW,this.layoutVertexArray2=new oX,this.patternVertexArray=new oX,this.indexArray=new o9,this.programConfigurations=new a0(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new aC,this.maxLineLength=0,this.zOffsetVertexArray=new oX,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128}updateFootprints(e,i){}populate(e,i,r,n){this.hasPattern=lQ("line",this.layers,this.pixelRatio,i);let o=this.layers[0].layout.get("line-sort-key");this.tileToMeter=sd(r);let a=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===a)this.elevationType="road";else{let e=this.layers[0].layout.get("line-z-offset"),i=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==a&&"ground"!==a&&i?"none":"offset","offset"===this.elevationType&&"none"===a&&tf(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}let s=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==s;let l=[];for(let{feature:i,id:a,index:s,sourceLayerIndex:h}of e){let e=this.layers[0]._featureFilter.needGeometry,u=s_(i,e);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),u,r))continue;let c=o?o.evaluate(u,{},r):void 0,d={id:a,properties:i.properties,type:i.type,sourceLayerIndex:h,index:s,geometry:e?u.geometry:sg(i,r,n),patterns:{},sortKey:c};l.push(d)}o&&l.sort((e,i)=>e.sortKey-i.sortKey);let{lineAtlas:h,featureIndex:u}=i,c=this.addConstantDashes(h);for(let n of l){let{geometry:o,index:a,sourceLayerIndex:s}=n;if(c&&this.addFeatureDashes(n,h),this.hasPattern){let e=l0("line",this.layers,n,this.zoom,this.pixelRatio,i);this.patternFeatures.push(e)}else this.addFeature(n,o,a,r,h.positions,i.availableImages,i.brightness,i.elevationFeatures);u.insert(e[a].feature,o,a,s,this.index)}}addConstantDashes(e){let i=!1;for(let r of this.layers){let n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==o.kind)i=!0;else{let i=o.value,r=n.value;if(!r)continue;e.addDash(r,i)}}return i}addFeatureDashes(e,i){let r=this.zoom;for(let n of this.layers){let o,a,s=n.paint.get("line-dasharray").value,l=n.layout.get("line-cap").value;if("constant"!==s.kind||"constant"!==l.kind){if("constant"===s.kind){if(!(o=s.value))continue}else o=s.evaluate({zoom:r},e);a="constant"===l.kind?l.value:l.evaluate({zoom:r},e),i.addDash(o,a),e.patterns[n.id]=[i.getKey(o,a)]}}}update(e,i,r,n,o,a,s){this.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s)}addFeatures(e,i,r,n,o,a){for(let e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,i,r,n,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uv)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,ux)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,u_.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,n,o,a,s,l){let h=this.layers[0].layout,u=h.get("line-join").evaluate(e,{}),c=h.get("line-cap").evaluate(e,{}),d=h.get("line-miter-limit"),p=h.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=h.get("line-z-offset").value;let f=this.layers[0].paint.get("line-width").value;if("constant"!==f.kind&&!1===f.isLineProgressConstant&&(this.variableWidthValue=f),"road"===this.elevationType){let r=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,n,l,u,c,d,p)){let[o,a]=this.clipRuntimeLinesToTile(i,1);for(let i=0;i<o.length;i++){let r=o[i],s=a[i],l={progress:{min:s.progress.min,max:s.progress.max},nextDir:this.computeSegNextDir(s,r),prevDir:this.computeSegPrevDir(s,r)};this.addLine(r,e,n,u,c,d,p,l)}this.fillNonElevatedRoadSegment(r)}}else for(let r of i)this.addLine(r,e,n,u,c,d,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,o,a,n,s)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return uc(e,-i,-i,8192+i,8192+i)}clipRuntimeLinesToTile(e,i){let r=[];return[uc(e,-i,-i,8192+i,8192+i,r),r]}addElevatedRoadFeature(e,i,r,n,o,a,s,l){let h=[],u=hd.getElevationFeature(e,n);if(u){let e=this.clipLinesToTile(i,1);for(let i of this.prepareElevatedLines(e,u,r))h.push({geometry:i,elevation:u,elevationTileID:r,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===h.length)return!1;for(let i of h){let n=this.layoutVertexArray.length;this.addLine(i.geometry,e,r,o,a,s,l);let h=new hp(r,i.elevationTileID);if(i.elevation)for(let e=n;e<this.layoutVertexArray.length;e++){let r=new e3(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),n=h.pointElevation(r,i.elevation,.05);this.updateHeightRange(n),this.zOffsetVertexArray.emplaceBack(n,0,0)}else this.fillNonElevatedRoadSegment(n)}return!0}prepareElevatedLines(e,i,r){if(null!=i.constantHeight)return e;let n=[],o=1/sd(r);for(let r of e)!function(e,i,r,n,o){if(e.length<2)return n.push(e);let a=[];for(;i.valid();){let[r,n]=i.get();for(let i=0;i<e.length-1;i++){let o=e[i],s=e[i+1],l=function(e,i,r,n){let o=sS(e,i,n),a=sS(e,i,r);if(Math.sign(o)===Math.sign(a))return;let s=sS(r,n,e),l=s+a-o;return Math.sign(s)!==Math.sign(l)?[s/(s-l),a/(a-o)]:void 0}(o,s,r,n);if(l){let[e]=l,r=new e3(ih(o.x,s.x,e),ih(o.y,s.y,e));a.push({t:i+e,distance:0,point:r})}}i.next()}if(0===a.length)return n.push(e);a.sort((e,i)=>e.t-i.t);let s=0,l=0,h=[];for(n.push(h);s!==e.length;){if(l===a.length){for(;s!==e.length;)0!==h.length&&h[h.length-1].equals(e[s])||h.push(e[s]),s++;break}a[l].t<=s?(0!==h.length&&h[h.length-1].equals(a[l].point)||h.push(a[l].point),a[l].t,l++):(0!==h.length&&h[h.length-1].equals(e[s])||h.push(e[s]),s++)}}(r,new hu(i,o),0,n);return n}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,r,n,o,a,s,l){let h,u,c,d,p,f,m,g;this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let _="none"===n;this.patternJoinNone=this.hasPattern&&_,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];let y=l&&l.progress.min>0,v=l&&l.progress.max<1;if(this.lineClips){let r={min:this.lineClips.start,max:this.lineClips.end},n=1;if(l){var x,b,w;let e=this.lineClips.end-this.lineClips.start;x=l.progress,b={min:0,max:1},w=r,r={min:tE(x.min,b,w),max:tE(x.max,b,w)},e>0&&(n=(r.max-r.min)/e)}let o=+i.properties.mapbox_clip_feature_len,a=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(o)||Number.isNaN(a)){for(let i=0;i<e.length-1;i++)this.totalDistance+=e[i].dist(e[i+1]);let i=this.totalDistance/(r.max-r.min);this.totalFeatureLength=Number.isFinite(i)?i:0,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=o,this.distance=a*n,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}let T="Polygon"===uw[i.type],S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let E=0;for(;E<S-1&&e[E].equals(e[E+1]);)E++;if(S<(T?3:2))return;"bevel"===n&&(a=1.05);let I=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);l&&l.prevDir&&(f=l.prevDir.perp()),l&&l.nextDir&&(m=l.nextDir.perp()),this.e1=this.e2=-1,T&&(h=e[S-2],p=e[E].sub(h)._unit()._perp());for(let i=E;i<S;i++){if((c=i===S-1?T?e[E+1]:void 0:e[i+1])&&e[i].equals(c))continue;p&&(d=p),h&&(u=h),h=e[i],g=this.evaluateLineProgressFeatures(u?u.dist(h):0),p=c?c.sub(h)._unit()._perp():d,d=d||p;let r=u&&c,l=r?n:T||_?"butt":o,x=d.x*p.x+d.y*p.y;if(_){let e=function(e){if(e.patternJoinNone){let i=e.segmentPoints.length/2,r=e.lineSoFar-e.segmentStart;for(let n=0;n<i;++n){let i=e.segmentPoints[2*n+1],o=Math.round(e.segmentPoints[2*n])+.5+.25*i;e.patternVertexArray.emplaceBack(o,r,e.segmentStart),e.patternVertexArray.emplaceBack(o,r,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(r&&x<uS){this.updateDistance(u,h),this.addCurrentVertex(h,d,1,1,I,g),e(this),this.addCurrentVertex(h,p,-1,-1,I,g);continue}if(u){if(!c){this.updateDistance(u,h),this.addCurrentVertex(h,d,1,1,I,g),e(this);continue}l="miter"}}let b=d.add(p);0===b.x&&0===b.y||b._unit();let w=b.x*p.x+b.y*p.y,C=0!==w?1/w:1/0,A=2*Math.sqrt(2-2*w),R=w<uT&&u&&c,M=d.x*p.y-d.y*p.x>0,P=this.overscaling<=16?122880/(512*this.overscaling):0;if(r&&"round"===l){if(C<s)l="miter";else if(C<=2){let e=uI(h,-10,8202);l="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}}if("miter"===l&&C>a&&(l="bevel"),"bevel"===l&&(C>2&&(l="flipbevel"),C<a&&(l="miter")),u&&!("miter"===l&&R)&&this.updateDistance(u,h),"miter"===l)if(R){let e=h.dist(u);if(e>2*P){let i=h.sub(h.sub(u)._mult(P/e)._round());this.updateDistance(u,i),this.addCurrentVertex(i,d,0,0,I,g),u=i}this.updateDistance(u,h),b._mult(C),this.addCurrentVertex(h,b,0,0,I,g);let i=h.dist(c);if(i>2*P){let e=h.add(c.sub(h)._mult(P/i)._round());this.updateDistance(h,e),this.addCurrentVertex(e,p,0,0,I,g),h=e}}else b._mult(C),this.addCurrentVertex(h,b,0,0,I,g);else if("flipbevel"===l){if(C>100)b=p.mult(-1);else{let e=C*d.add(p).mag()/d.sub(p).mag();b._perp()._mult(e*(M?-1:1))}this.addCurrentVertex(h,b,0,0,I,g),this.addCurrentVertex(h,b.mult(-1),0,0,I,g)}else if("bevel"===l||"fakeround"===l){null!=g&&u&&this.addCurrentVertex(h,m||d,-1,-1,I,g);let e=h.dist(u)<=2*P&&"bevel"!==l,i=b.mult(M?1:-1);i._mult(C);let r=p.mult(M?-1:1),n=d.mult(M?-1:1),o=this.evaluateLineProgressFeatures(this.distance);if(null==g&&(this.addHalfVertex(h,i.x,i.y,!1,!M,0,I,o),e||this.addHalfVertex(h,i.x+2*n.x,i.y+2*n.y,!1,M,0,I,o)),"fakeround"===l){let e=Math.round(180*A/Math.PI/20);this.addHalfVertex(h,n.x,n.y,!1,M,0,I,o);for(let i=0;i<e;i++){let a=i/e;if(.5!==a){let e=a-.5;a+=a*e*(a-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*e*e+(.848013+x*(.215638*x-1.06021)))}let s=r.sub(n)._mult(a)._add(n)._unit();this.addHalfVertex(h,s.x,s.y,!1,M,0,I,o)}this.addHalfVertex(h,r.x,r.y,!1,M,0,I,o)}e||null!=g||this.addHalfVertex(h,i.x+2*r.x,i.y+2*r.y,!1,M,0,I,o),null!=g&&c&&this.addCurrentVertex(h,f||p,1,1,I,g)}else if("butt"===l)this.addCurrentVertex(h,b,0,0,I,g);else if("square"===l){if(!u){let e=y?0:-1;this.addCurrentVertex(h,b,e,e,I,g)}if(this.addCurrentVertex(h,b,0,0,I,g),u){let e=+!v;this.addCurrentVertex(h,b,e,e,I,g)}}else if("round"===l){if(u){let e=!r&&m?m:d;this.addCurrentVertex(h,e,0,0,I,g),!r&&v||this.addCurrentVertex(h,e,1,1,I,g,!0)}if(c){let e=!r&&f?f:p;!r&&y||this.addCurrentVertex(h,e,-1,-1,I,g,!0),this.addCurrentVertex(h,e,0,0,I,g)}}}}addVerticesTo(e,i,r,n,o,a,s,l,h,u){let c=(i.w-e.w)/this.tessellationStep|0,d=0,p=this.scaledDistance;if(c>1){this.lineSoFar=e.w;let p=(i.x-e.x)/c,f=(i.y-e.y)/c,m=(i.z-e.z)/c,g=(i.w-e.w)/c;for(let i=1;i<c;++i){e.x+=p,e.y+=f,e.z+=m,this.lineSoFar+=g,d+=g;let i=this.evaluateLineProgressFeatures(this.prevDistance+d);this.scaledDistance=(this.prevDistance+d)/this.totalDistance,this.addHalfVertex(e,r,n,u,!1,s,h,i),this.addHalfVertex(e,o,a,u,!0,-l,h,i)}}this.lineSoFar=i.w,this.scaledDistance=p;let f=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,r,n,u,!1,s,h,f),this.addHalfVertex(i,o,a,u,!0,-l,h,f)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):tf(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:i}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,r,n,o,a,s=!1){let l=i.x+i.y*r,h=i.y-i.x*r,u=i.y*n-i.x,c=-i.y-i.x*n;if(null!=a){let i="offset"===this.elevationType,d=a.zOffset,p=new ul(e.x,e.y,d,this.lineSoFar),f=!!i&&uI(e,-10,8202),m=this.lineSoFar,g=this.distance;if(this.currentVertex)if(f){let i=this.currentVertexIsOutside,a=this.currentVertex,f=new ul(e.x,e.y,d,this.lineSoFar);if(uu(a,f,-10,8202),!uI(f,-10,8202)){if(i){this.e1=this.e2=-1,this.distance-=a.dist(p),this.lineSoFar=a.w;let e=this.evaluateLineProgressFeatures(a.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(a,l,h,s,!1,r,o,e),this.addHalfVertex(a,u,c,s,!0,-n,o,e),this.prevDistance=this.distance}this.distance=this.prevDistance+a.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(a,f,l,h,u,c,r,n,o,s),this.distance=g,this.scaledDistance=this.distance/this.totalDistance}}else{let e=this.currentVertex;if(this.currentVertexIsOutside){uu(e,p,-10,8202),this.e1=this.e2=-1,this.distance-=e.dist(p),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;let i=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,l,h,s,!1,r,o,i),this.addHalfVertex(e,u,c,s,!0,-n,o,i),this.prevDistance=this.distance,this.distance=g,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,p,l,h,u,c,r,n,o,s)}else f||(this.addHalfVertex(e,l,h,s,!1,r,o,a),this.addHalfVertex(e,u,c,s,!0,-n,o,a));this.currentVertex=p,this.currentVertexIsOutside=f,this.lineSoFar=m}else this.addHalfVertex(e,l,h,s,!1,r,o,a),this.addHalfVertex(e,u,c,s,!0,-n,o,a)}addHalfVertex({x:e,y:i},r,n,o,a,s,l,h){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),a||this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)),this.layoutVertexArray.emplaceBack((e<<1)+ +!!o,(i<<1)+ +!!a,Math.round(63*r)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){let e=ih(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}let u=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),l.primitiveLength++),a?this.e2=u:this.e1=u,null!=h&&this.zOffsetVertexArray.emplaceBack(h.zOffset,h.variableWidth,h.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function uI(e,i,r){return e.x<i||e.x>r||e.y<i||e.y>r}function uC(e,i,r){return i*(8192/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}nX(uE,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let uA=(e,i,r)=>(1-r)*e+r*i;function uR(e,i){return 1/uC(e,1,i.tileZoom)}function uM(e,i,r,n){return e.translatePosMatrix(n||i.tileID.projMatrix,i,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let uP=e=>{let i=[];uO(e)&&i.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");let r=e.paint.get("line-trim-offset");0===r[0]&&0===r[1]||i.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&i.push("RENDER_LINE_BORDER");let n="none"===e.layout.get("line-join").constantOr("miter"),o=!!e.paint.get("line-pattern").constantOr(1);return n&&o&&i.push("LINE_JOIN_NONE"),i};function uO(e){let i=e.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}let uk=()=>I||(I={layout:S||(S=new ov({"line-cap":new o_(ox.layout_line["line-cap"]),"line-join":new o_(ox.layout_line["line-join"]),"line-miter-limit":new og(ox.layout_line["line-miter-limit"]),"line-round-limit":new og(ox.layout_line["line-round-limit"]),"line-sort-key":new o_(ox.layout_line["line-sort-key"]),"line-z-offset":new o_(ox.layout_line["line-z-offset"]),"line-elevation-reference":new og(ox.layout_line["line-elevation-reference"]),"line-cross-slope":new og(ox.layout_line["line-cross-slope"]),visibility:new og(ox.layout_line.visibility),"line-width-unit":new og(ox.layout_line["line-width-unit"])})),paint:E||(E=new ov({"line-opacity":new o_(ox.paint_line["line-opacity"]),"line-color":new o_(ox.paint_line["line-color"]),"line-translate":new og(ox.paint_line["line-translate"]),"line-translate-anchor":new og(ox.paint_line["line-translate-anchor"]),"line-width":new o_(ox.paint_line["line-width"]),"line-gap-width":new o_(ox.paint_line["line-gap-width"]),"line-offset":new o_(ox.paint_line["line-offset"]),"line-blur":new o_(ox.paint_line["line-blur"]),"line-dasharray":new o_(ox.paint_line["line-dasharray"]),"line-pattern":new o_(ox.paint_line["line-pattern"]),"line-pattern-cross-fade":new og(ox.paint_line["line-pattern-cross-fade"]),"line-gradient":new oy(ox.paint_line["line-gradient"]),"line-trim-offset":new og(ox.paint_line["line-trim-offset"]),"line-trim-fade-range":new og(ox.paint_line["line-trim-fade-range"]),"line-trim-color":new og(ox.paint_line["line-trim-color"]),"line-emissive-strength":new og(ox.paint_line["line-emissive-strength"]),"line-border-width":new o_(ox.paint_line["line-border-width"]),"line-border-color":new o_(ox.paint_line["line-border-color"]),"line-occlusion-opacity":new og(ox.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))});class uL extends o_{possiblyEvaluate(e,i){return i=new os(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,r,n){return i=to({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,r,n)}}let uD=oN([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uz=oN([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uF=oN([{name:"a_projected_pos",components:4,type:"Float32"}],4);oN([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let uB=oN([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),uN=oN([{name:"a_texb",components:2,type:"Uint16"}]),uj=oN([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),uV=oN([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);oN([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let uU=oN([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uG=oN([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);oN([{name:"triangle",components:3,type:"Uint16"}]),oN([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),oN([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),oN([{type:"Float32",name:"offsetX"}]),oN([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);let uq={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹","â":"â","â":"â"};var u$,uH,uZ,uW={};function uX(){if(uZ)return uH;uZ=1,uH=i;var e=(u$||(u$=1,uW.read=function(e,i,r,n,o){var a,s,l=8*o-n-1,h=(1<<l)-1,u=h>>1,c=-7,d=r?o-1:0,p=r?-1:1,f=e[i+d];for(d+=p,a=f&(1<<-c)-1,f>>=-c,c+=l;c>0;a=256*a+e[i+d],d+=p,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[i+d],d+=p,c-=8);if(0===a)a=1-u;else{if(a===h)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=u}return(f?-1:1)*s*Math.pow(2,a-n)},uW.write=function(e,i,r,n,o,a){var s,l,h,u=8*a-o-1,c=(1<<u)-1,d=c>>1,p=5960464477539062e-23*(23===o),f=n?0:a-1,m=n?1:-1,g=+(i<0||0===i&&1/i<0);for(isNaN(i=Math.abs(i))||i===1/0?(l=+!!isNaN(i),s=c):(s=Math.floor(Math.log(i)/Math.LN2),i*(h=Math.pow(2,-s))<1&&(s--,h*=2),(i+=s+d>=1?p/h:p*Math.pow(2,1-d))*h>=2&&(s++,h/=2),s+d>=c?(l=0,s=c):s+d>=1?(l=(i*h-1)*Math.pow(2,o),s+=d):(l=i*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[r+f]=255&l,f+=m,l/=256,o-=8);for(s=s<<o|l,u+=o;u>0;e[r+f]=255&s,f+=m,s/=256,u-=8);e[r+f-m]|=128*g}),uW);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var r="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function n(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function o(e,i,r){var n=i<=16383?1:i<=2097151?2:i<=0xfffffff?3:Math.floor(Math.log(i)/(7*Math.LN2));r.realloc(n);for(var o=r.pos-1;o>=e;o--)r.buf[o+n]=r.buf[o]}function a(e,i){for(var r=0;r<e.length;r++)i.writeVarint(e[r])}function s(e,i){for(var r=0;r<e.length;r++)i.writeSVarint(e[r])}function l(e,i){for(var r=0;r<e.length;r++)i.writeFloat(e[r])}function h(e,i){for(var r=0;r<e.length;r++)i.writeDouble(e[r])}function u(e,i){for(var r=0;r<e.length;r++)i.writeBoolean(e[r])}function c(e,i){for(var r=0;r<e.length;r++)i.writeFixed32(e[r])}function d(e,i){for(var r=0;r<e.length;r++)i.writeSFixed32(e[r])}function p(e,i){for(var r=0;r<e.length;r++)i.writeFixed64(e[r])}function f(e,i){for(var r=0;r<e.length;r++)i.writeSFixed64(e[r])}function m(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+0x1000000*e[i+3]}function g(e,i,r){e[r]=i,e[r+1]=i>>>8,e[r+2]=i>>>16,e[r+3]=i>>>24}function _(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16)+(e[i+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(e,i,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),o=n>>3,a=this.pos;this.type=7&n,e(o,i,this),this.pos===a&&this.skip(n)}return i},readMessage:function(e,i){return this.readFields(e,i,this.readVarint()+this.pos)},readFixed32:function(){var e=m(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=_(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=m(this.buf,this.pos)+0x100000000*m(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=m(this.buf,this.pos)+0x100000000*_(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var i=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(e){var i,r,n=this.buf;return i=127&(r=n[this.pos++]),r<128?i:(i|=(127&(r=n[this.pos++]))<<7,r<128?i:(i|=(127&(r=n[this.pos++]))<<14,r<128?i:(i|=(127&(r=n[this.pos++]))<<21,r<128?i:function(e,i,r){var n,o,a,s,l=r.buf;if(a=(112&(s=l[r.pos++]))>>4,s<128||(a|=(127&(s=l[r.pos++]))<<3,s<128)||(a|=(127&(s=l[r.pos++]))<<10,s<128)||(a|=(127&(s=l[r.pos++]))<<17,s<128)||(a|=(127&(s=l[r.pos++]))<<24,s<128)||(a|=(1&(s=l[r.pos++]))<<31,s<128)){return n=e,o=a,i?0x100000000*o+(n>>>0):0x100000000*(o>>>0)+(n>>>0)}throw Error("Expected varint not more than 10 bytes")}(i|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?-((e+1)/2):e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e,i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&r?(e=this.buf,r.decode(e.subarray(n,i))):function(e,i,r){for(var n="",o=i;o<r;){var a,s,l,h=e[o],u=null,c=h>239?4:h>223?3:h>191?2:1;if(o+c>r)break;1===c?h<128&&(u=h):2===c?128==(192&(a=e[o+1]))&&(u=(31&h)<<6|63&a)<=127&&(u=null):3===c?(s=e[o+2],128==(192&(a=e[o+1]))&&128==(192&s)&&((u=(15&h)<<12|(63&a)<<6|63&s)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(s=e[o+2],l=e[o+3],128==(192&(a=e[o+1]))&&128==(192&s)&&128==(192&l)&&((u=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&l)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),o+=c}return n}(this.buf,n,i)},readBytes:function(){var e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i},readPackedVarint:function(e,r){if(this.type!==i.Bytes)return e.push(this.readVarint(r));var o=n(this);for(e=e||[];this.pos<o;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var r=n(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=7&e;if(r===i.Varint)for(;this.buf[this.pos++]>127;);else if(r===i.Bytes)this.pos=this.readVarint()+this.pos;else if(r===i.Fixed32)this.pos+=4;else{if(r!==i.Fixed64)throw Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(e,i){this.writeVarint(e<<3|i)},realloc:function(e){for(var i=this.length||16;i<this.pos+e;)i*=2;if(i!==this.length){var r=new Uint8Array(i);r.set(this.buf),this.buf=r,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),g(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),g(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),g(this.buf,-1&e,this.pos),g(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),g(this.buf,-1&e,this.pos),g(this.buf,Math.floor(23283064365386963e-26*e),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>0xfffffff||e<0?function(e,i){var r,n,o,a,s;if(e>=0?(r=e%0x100000000|0,n=e/0x100000000|0):(n=~(-e/0x100000000),0xffffffff^(r=~(-e%0x100000000))?r=r+1|0:(r=0,n=n+1|0)),e>=0xffffffffffffffff||e<-0xffffffffffffffff)throw Error("Given varint doesn't fit into 10 bytes");i.realloc(10),o=r,i.buf[i.pos++]=127&o|128,o>>>=7,i.buf[i.pos++]=127&o|128,o>>>=7,i.buf[i.pos++]=127&o|128,o>>>=7,i.buf[i.pos++]=127&o|128,i.buf[i.pos]=127&(o>>>=7),s=(7&(a=n))<<4,i.buf[i.pos++]|=s|128*!!(a>>>=3),a&&(i.buf[i.pos++]=127&a|128*!!(a>>>=7),a&&(i.buf[i.pos++]=127&a|128*!!(a>>>=7),a&&(i.buf[i.pos++]=127&a|128*!!(a>>>=7),a&&(i.buf[i.pos++]=127&a|128*!!(a>>>=7),a&&(i.buf[i.pos++]=127&a)))))}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|128*(e>127),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|128*(e>127),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|128*(e>127),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?-(2*e)-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var i=this.pos;this.pos=function(e,i,r){for(var n,o,a=0;a<i.length;a++){if((n=i.charCodeAt(a))>55295&&n<57344){if(!o){n>56319||a+1===i.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=n;continue}n=o-55296<<10|n-56320|65536,o=null}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-i;r>=128&&o(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),e.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),e.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var i=e.length;this.writeVarint(i),this.realloc(i);for(var r=0;r<i;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,i){this.pos++;var r=this.pos;e(i,this);var n=this.pos-r;n>=128&&o(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,r,n){this.writeTag(e,i.Bytes),this.writeRawMessage(r,n)},writePackedVarint:function(e,i){i.length&&this.writeMessage(e,a,i)},writePackedSVarint:function(e,i){i.length&&this.writeMessage(e,s,i)},writePackedBoolean:function(e,i){i.length&&this.writeMessage(e,u,i)},writePackedFloat:function(e,i){i.length&&this.writeMessage(e,l,i)},writePackedDouble:function(e,i){i.length&&this.writeMessage(e,h,i)},writePackedFixed32:function(e,i){i.length&&this.writeMessage(e,c,i)},writePackedSFixed32:function(e,i){i.length&&this.writeMessage(e,d,i)},writePackedFixed64:function(e,i){i.length&&this.writeMessage(e,p,i)},writePackedSFixed64:function(e,i){i.length&&this.writeMessage(e,f,i)},writeBytesField:function(e,r){this.writeTag(e,i.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,i.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,i.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,i.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,i.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,i.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,i.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,i.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,i.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,i.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,i){this.writeVarintField(e,!!i)}},uH}var uY=eJ(uX());function uK(e,i,r){i.glyphs=[],1===e&&r.readMessage(uJ,i)}function uJ(e,i,r){if(3===e){let{id:e,bitmap:n,width:o,height:a,left:s,top:l,advance:h}=r.readMessage(uQ,{});i.glyphs.push({id:e,bitmap:new lE({width:o+6,height:a+6},n),metrics:{width:o,height:a,left:s,top:l,advance:h}})}else 4===e?i.ascender=r.readSVarint():5===e&&(i.descender=r.readSVarint())}function uQ(e,i,r){1===e?i.id=r.readVarint():2===e?i.bitmap=r.readBytes():3===e?i.width=r.readVarint():4===e?i.height=r.readVarint():5===e?i.left=r.readSVarint():6===e?i.top=r.readSVarint():7===e&&(i.advance=r.readVarint())}let u0={horizontal:1,vertical:2,horizontalOnly:3};class u1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){let r=new u1;return r.scale=e||1,r.fontStack=i,r}static forImage(e){let i=new u1;return i.image=e,i}}class u2{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,r){let n=new u2;for(let o=0;o<e.sections.length;o++){let a=e.sections[o];a.image?n.addImageSection(a,r):n.addTextSection(a,i)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,i){let r="";for(let n=0;n<e.length;n++){let o=e.charCodeAt(n+1)||null,a=e.charCodeAt(n-1)||null;r+=!i&&(o&&n3(o)&&!uq[e[n+1]]||a&&n3(a)&&!uq[e[n-1]])||!uq[e[n]]?e[n]:uq[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&u5[this.text.charCodeAt(i)];i++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&u5[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let r=new u2;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(u1.forText(e.scale,e.fontStack||i));let r=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(r)}addImageSection(e,i){let r=e.image?e.image.getPrimary():null;if(!r)return void tf("Can't add FormattedSection with an empty image.");r.scaleSelf(i);let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(u1.forImage(r)),this.sectionIndex.push(this.sections.length-1)):tf("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u3(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g=1){let _=u2.fromFeature(e,o,g);d===u0.vertical&&_.verticalizePunctuation(p);let y=[],v=function(e,i,r,n,o,a){if(!e)return[];let s=[],l=function(e,i,r,n,o,a){let s=0;for(let r=0;r<e.length();r++){let l=e.getSection(r);s+=u6(e.getCodePoint(r),l,n,o,i,a)}return s/Math.max(1,Math.ceil(s/r))}(e,i,r,n,o,a),h=e.text.indexOf("â")>=0,u=0;for(let r=0;r<e.length();r++){let c=e.getSection(r),d=e.getCodePoint(r);if(u5[d]||(u+=u6(d,c,n,o,i,a)),r<e.length()-1){let i=!(d<11904||!(n0["Bopomofo Extended"](d)||n0.Bopomofo(d)||n0["CJK Compatibility Forms"](d)||n0["CJK Compatibility Ideographs"](d)||n0["CJK Compatibility"](d)||n0["CJK Radicals Supplement"](d)||n0["CJK Strokes"](d)||n0["CJK Symbols and Punctuation"](d)||n0["CJK Unified Ideographs Extension A"](d)||n0["CJK Unified Ideographs"](d)||n0["Enclosed CJK Letters and Months"](d)||n0["Halfwidth and Fullwidth Forms"](d)||n0.Hiragana(d)||n0["Ideographic Description Characters"](d)||n0["Kangxi Radicals"](d)||n0["Katakana Phonetic Extensions"](d)||n0.Katakana(d)||n0["Vertical Forms"](d)||n0["Yi Radicals"](d)||n0["Yi Syllables"](d)));(u4[d]||i||c.image)&&s.push(u9(r+1,u,l,s,function(e,i,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==i&&65289!==i||(n+=50),n}(d,e.getCodePoint(r+1),i&&h),!1))}}return function e(i){return i?e(i.priorBreak).concat(i.index):[]}(u9(e.length(),u,l,s,0,!0))}(_,u,a,i,n,f),{processBidirectionalText:x,processStyledBidirectionalText:b}=oa;if(x&&1===_.sections.length)for(let e of x(_.toString(),v)){let i=new u2;i.text=e,i.sections=_.sections;for(let r=0;r<e.length;r++)i.sectionIndex.push(0);y.push(i)}else if(b)for(let e of b(_.text,_.sectionIndex,v)){let i=new u2;i.text=e[0],i.sectionIndex=e[1],i.sections=_.sections,y.push(i)}else y=function(e,i){let r=[],n=e.text,o=0;for(let n of i)r.push(e.substring(o,n)),o=n;return o<n.length&&r.push(e.substring(o,n.length)),r}(_,v);let w=[],T={positionedLines:w,text:_.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,i,r,n,o,a,s,l,h,u,c,d){let p=0,f=0,m=0,g="right"===l?1:.5*("left"!==l),_=!1;for(let e of o){for(let r of e.getSections()){if(r.image)continue;let e=i[r.fontStack];if(e&&!(_=void 0!==e.ascender&&void 0!==e.descender))break}if(!_)break}let y=0;for(let s of o){s.trim();let o=s.getMaxScale(),l=(o-1)*24,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=v;let x=v.positionedGlyphs,b=0;if(!s.length()){f+=a,++y;continue}let w=0,T=0;for(let a=0;a<s.length();a++){let l=s.getSection(a),m=s.getSectionIndex(a),g=s.getCodePoint(a),y=l.scale,v=null,S=null,E=null,I=24,C=0;h===u0.vertical&&(12312===g||12313===g||12316===g||12540===g||12448===g)&&(h=u0.horizontal);let A=!(h===u0.horizontal||!c&&!n2(g)||c&&(u5[g]||n0.Arabic(g)||n0["Arabic Supplement"](g)||n0["Arabic Extended-A"](g)||n0["Arabic Presentation Forms-A"](g)||n0["Arabic Presentation Forms-B"](g)));if(l.image){let i=n.get(l.image.toString());if(!i)continue;E=l.image,e.iconsInText=e.iconsInText||!0,S=i.paddedRect;let r=i.displaySize;y=24*y/d,v={width:r[0],height:r[1],left:0,top:-3,advance:A?r[1]:r[0],localGlyph:!1},C=_?-v.height*y:24*o-17-r[1]*y,I=v.advance;let a=(A?r[0]:r[1])*y-24*o;a>0&&a>b&&(b=a)}else{let e=r[l.fontStack];if(!e)continue;e[g]&&(S=e[g]);let n=i[l.fontStack];if(!n)continue;let a=n.glyphs[g];if(!a)continue;if(v=a.metrics,I=24*(8203!==g),_){let e=void 0!==n.ascender?Math.abs(n.ascender):0,i=void 0!==n.descender?Math.abs(n.descender):0,r=(e+i)*y;w<r&&(w=r,T=(e-i)/2*y),C=-e*y}else C=(o-y)*24-17}A?(e.verticalizable=!0,x.push({glyph:g,image:E,x:p,y:f+C,vertical:A,scale:y,localGlyph:v.localGlyph,fontStack:l.fontStack,sectionIndex:m,metrics:v,rect:S}),p+=I*y+u):(x.push({glyph:g,image:E,x:p,y:f+C,vertical:A,scale:y,localGlyph:v.localGlyph,fontStack:l.fontStack,sectionIndex:m,metrics:v,rect:S}),p+=v.advance*y+u)}0!==x.length&&(m=Math.max(p-u,m),_?ce(x,g,b,T,a*o/2):ce(x,g,b,0,a/2)),p=0;let S=a*o+b;v.lineOffset=Math.max(b,l),f+=S,++y}let v=f,{horizontalAlign:x,verticalAlign:b}=u7(s);(function(e,i,r,n,o,a){let s=(i-r)*o,l=-a*n;for(let i of e)for(let e of i.positionedGlyphs)e.x+=s,e.y+=l})(e.positionedLines,g,x,b,m,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*m,e.right=e.left+m,e.hasBaseline=_}(T,i,r,n,y,s,l,h,d,u,p,m),!function(e){for(let i of e)if(0!==i.positionedGlyphs.length)return!1;return!0}(w))return T}let u5={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},u4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function u6(e,i,r,n,o,a){if(i.image){let e=n.get(i.image.toString());return e?e.displaySize[0]*i.scale*24/a+o:0}{let n=r[i.fontStack],a=n&&n.glyphs[e];return a?a.metrics.advance*i.scale+o:0}}function u8(e,i,r,n){let o=Math.pow(e-i,2);return n?e<i?o/2:2*o:o+Math.abs(r)*r}function u9(e,i,r,n,o,a){let s=null,l=u8(i,r,o,a);for(let e of n){let n=u8(i-e.x,r,o,a)+e.badness;n<=l&&(s=e,l=n)}return{index:e,x:i,priorBreak:s,badness:l}}function u7(e){let i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:i,verticalAlign:r}}function ce(e,i,r,n,o){if(!(i||r||n||o))return;let a=e.length-1,s=e[a],l=(s.x+s.metrics.advance*s.scale)*i;for(let i=0;i<=a;i++)e[i].x-=l,e[i].y+=r+n+o}function ct(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function ci(e,i,r,n,o,a){let s,l,h,u,c,d=e.imagePrimary;if(d.content){let e=d.content,i=d.pixelRatio||1;s=[e[0]/i,e[1]/i,d.displaySize[0]-e[2]/i,d.displaySize[1]-e[3]/i]}let p=i.left*a,f=i.right*a;"width"===r||"both"===r?(c=o[0]+p-n[3],h=o[0]+f+n[1]):h=(c=o[0]+(p+f-d.displaySize[0])/2)+d.displaySize[0];let m=i.top*a,g=i.bottom*a;return"height"===r||"both"===r?(l=o[1]+m-n[0],u=o[1]+g+n[2]):u=(l=o[1]+(m+g-d.displaySize[1])/2)+d.displaySize[1],{imagePrimary:d,imageSecondary:void 0,top:l,right:h,bottom:u,left:c,collisionPadding:s}}function cr(e){return!e.imagePrimary.stretchX}function cn(e){return!e.imagePrimary.stretchY}function co(e){return{width:e.right-e.left,height:e.bottom-e.top}}function ca(e,i){let{expression:r}=i;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new os(e+1))};if("source"===r.kind)return{kind:"source"};{let{zoomStops:i,interpolationType:n}=r,o=0;for(;o<i.length&&i[o]<=e;)o++;let a=o=Math.max(0,o-1);for(;a<i.length&&i[a]<e+1;)a++;a=Math.min(i.length-1,a);let s=i[o],l=i[a];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:l,minSize:r.evaluate(new os(s)),maxSize:r.evaluate(new os(l)),interpolationType:n}}}function cs(e,{uSize:i,uSizeT:r},{lowerSize:n,upperSize:o}){return"source"===e.kind?n/128:"composite"===e.kind?ih(n/128,o/128,r):i}function cl(e,i,r=1){let n=0,o=0;if("constant"===e.kind)o=e.layoutSize*r;else if("source"!==e.kind){let{interpolationType:a,minZoom:s,maxZoom:l}=e,h=a?tt(r6.interpolationFactor(a,i,s,l),0,1):0;"camera"===e.kind?o=ih(e.minSize,e.maxSize,h)*r:n=h*r}return{uSizeT:n,uSize:o}}class ch extends e3{constructor(e,i,r,n,o){super(e,i),this.angle=n,this.z=r,void 0!==o&&(this.segment=o)}clone(){return new ch(this.x,this.y,this.z,this.angle,this.segment)}}function cu(e,i,r,n,o){if(void 0===i.segment)return!0;let a=i,s=i.segment+1,l=0;for(;l>-r/2;){if(--s<0)return!1;l-=e[s].dist(a),a=e[s]}l+=e[s].dist(e[s+1]),s++;let h=[],u=0;for(;l<r/2;){let i=e[s],r=e[s+1];if(!r)return!1;let a=e[s-1].angleTo(i)-i.angleTo(r);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),h.push({distance:l,angleDelta:a}),u+=a;l-h[0].distance>n;)u-=h.shift().angleDelta;if(u>o)return!1;s++,l+=i.dist(r)}return!0}function cc(e){let i=0;for(let r=0;r<e.length-1;r++)i+=e[r].dist(e[r+1]);return i}function cd(e,i){return Math.max(e?e.right-e.left:0,i?i.right-i.left:0)}function cp(e){let i=0,r=0;for(let n of e)i+=n.w*n.h,r=Math.max(r,n.w);e.sort((e,i)=>i.h-e.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),r),h:1/0}],o=0,a=0;for(let i of e)for(let e=n.length-1;e>=0;e--){let r=n[e];if(!(i.w>r.w||i.h>r.h)){if(i.x=r.x,i.y=r.y,a=Math.max(a,i.y+i.h),o=Math.max(o,i.x+i.w),i.w===r.w&&i.h===r.h){let i=n.pop();e<n.length&&(n[e]=i)}else i.h===r.h?(r.x+=i.w,r.w-=i.w):(i.w===r.w||n.push({x:r.x+i.w,y:r.y,w:r.w-i.w,h:i.h}),r.y+=i.h,r.h-=i.h);break}}return{w:o,h:a,fill:i/(o*a)||0}}nX(ch,"Anchor");class cf{static getImagePositionScale(e,i,r){if(i&&e&&e.options&&e.options.transform){let i=e.options.transform;return{x:i.a,y:i.d}}return{x:r,y:r}}constructor(e,i,r,n){this.paddedRect=e;let{pixelRatio:o,version:a,stretchX:s,stretchY:l,content:h,sdf:u,usvg:c}=i;this.pixelRatio=o,this.stretchX=s,this.stretchY=l,this.content=h,this.version=a,this.padding=r,this.sdf=u,this.scale=cf.getImagePositionScale(n,c,o)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function cm(e,i,r){let n=iz.parse(e),o=function(e,i,r=[1,1]){return{x:0,y:0,w:(e.data?e.data.width:e.width*r[0])+2*i,h:(e.data?e.data.height:e.height*r[1])+2*i}}(i,r,[n.options.transform.a,n.options.transform.d]);return{bin:o,imagePosition:new cf(o,i,r,n),imageVariant:n}}class cg{constructor(e,i,r){let n=new Map,o=new Map;this.haveRenderCallbacks=[];let a=[];this.addImages(e,n,1,a),this.addImages(i,o,2,a);let{w:s,h:l}=cp(a),h=new lI({width:s||1,height:l||1});for(let[i,o]of e.entries()){let e=n.get(i).paddedRect;lI.copy(o.data,h,{x:0,y:0},{x:e.x+1,y:e.y+1},o.data,r,o.sdf)}for(let[e,n]of i.entries()){let i=o.get(e),a=i.paddedRect,s=i.padding,l=a.x+s,u=a.y+s,c=n.data.width,d=n.data.height;s=s>1?s-1:s,lI.copy(n.data,h,{x:0,y:0},{x:l,y:u},n.data,r),lI.copy(n.data,h,{x:0,y:d-s},{x:l,y:u-s},{width:c,height:s},r),lI.copy(n.data,h,{x:0,y:0},{x:l,y:u+d},{width:c,height:s},r),lI.copy(n.data,h,{x:c-s,y:0},{x:l-s,y:u},{width:s,height:d},r),lI.copy(n.data,h,{x:0,y:0},{x:l+c,y:u},{width:s,height:d},r),lI.copy(n.data,h,{x:c-s,y:d-s},{x:l-s,y:u-s},{width:s,height:s},r),lI.copy(n.data,h,{x:0,y:d-s},{x:l+c,y:u-s},{width:s,height:s},r),lI.copy(n.data,h,{x:0,y:0},{x:l+c,y:u+d},{width:s,height:s},r),lI.copy(n.data,h,{x:c-s,y:0},{x:l-s,y:u+d},{width:s,height:s},r)}this.lut=r,this.image=h,this.iconPositions=n,this.patternPositions=o}addImages(e,i,r,n){for(let[o,a]of e.entries()){let{bin:e,imagePosition:s,imageVariant:l}=cm(o,a,r);i.set(o,s),n.push(e),a.hasRenderCallback&&this.haveRenderCallbacks.push(l.id)}}patchUpdatedImages(e,i,r){for(let n of(this.haveRenderCallbacks=this.haveRenderCallbacks.filter(i=>e.hasImage(i,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r),e.getUpdatedImages(r))){for(let o of this.iconPositions.keys()){let a=iz.parse(o);if(ii.isEqual(a.id,n)){let a=e.getImage(n,r);this.patchUpdatedImage(this.iconPositions.get(o),a,i)}}for(let o of this.patternPositions.keys()){let a=iz.parse(o);if(ii.isEqual(a.id,n)){let a=e.getImage(n,r);this.patchUpdatedImage(this.patternPositions.get(o),a,i)}}}}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;let[n,o]=e.tl,a=e.sdf;if(this.lut||a){let e={width:i.data.width,height:i.data.height},s=new lI(e);lI.copy(i.data,s,{x:0,y:0},{x:0,y:0},e,this.lut,a),r.update(s,{position:{x:n,y:o}})}else r.update(i.data,{position:{x:n,y:o}})}}function c_(e,i,r,n,o,a,s,l,h){for(let u=i;u<i+n;u++)cy(e,r*a+u,a,o,s,l,h);for(let u=r;u<r+o;u++)cy(e,u*a+i,1,n,s,l,h)}function cy(e,i,r,n,o,a,s){a[0]=0,s[0]=-1e20,s[1]=1e20,o[0]=e[i];for(let l=1,h=0,u=0;l<n;l++){o[l]=e[i+l*r];let n=l*l;do{let e=a[h];u=(o[l]-o[e]+n-e*e)/(l-e)/2}while(u<=s[h]&&--h>-1)a[++h]=l,s[h]=u,s[h+1]=1e20}for(let l=0,h=0;l<n;l++){for(;s[h+1]<l;)h++;let n=a[h],u=l-n;e[i+l*r]=o[n]+u*u}}nX(cf,"ImagePosition"),nX(cg,"ImageAtlas");let cv={none:0,ideographs:1,all:2};class cx{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,r){let n=[],o=this.urls[i]||tI.GLYPHS_URL;for(let i in e)for(let r of e[i])n.push({stack:i,id:r});tn(n,({stack:e,id:i},r)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let a=n.glyphs[i];if(void 0!==a)return void r(null,{stack:e,id:i,glyph:a});if(a=this._tinySDF(n,e,i))return n.glyphs[i]=a,void r(null,{stack:e,id:i,glyph:a});let s=Math.floor(i/256);if(256*s>65535)return tf("glyphs > 65535 not supported"),void r(null,{stack:e,id:i,glyph:a});if(n.ranges[s])return void r(null,{stack:e,id:i,glyph:a});let l=n.requests[s];l||(l=n.requests[s]=[],cx.loadGlyphRange(e,s,o,this.requestManager,(e,i)=>{if(i){for(let e in n.ascender=i.ascender,n.descender=i.descender,i.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=i.glyphs[+e]);n.ranges[s]=!0}for(let r of l)r(e,i);delete n.requests[s]})),l.push((n,o)=>{n?r(n):o&&r(null,{stack:e,id:i,glyph:o.glyphs[i]||null})})},(e,i)=>{if(e)r(e);else if(i){let e={};for(let{stack:r,id:n,glyph:o}of i)void 0===e[r]&&(e[r]={}),void 0===e[r].glyphs&&(e[r].glyphs={}),e[r].glyphs[n]=o&&{id:o.id,bitmap:o.bitmap.clone(),metrics:o.metrics},e[r].ascender=this.entries[r].ascender,e[r].descender=this.entries[r].descender;r(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==cv.none&&(this.localGlyphMode===cv.all?!!this.localFontFamily:!!this.localFontFamily&&(n0["CJK Unified Ideographs"](e)||n0["Hangul Syllables"](e)||n0.Hiragana(e)||n0.Katakana(e)||n0["CJK Symbols and Punctuation"](e)||n0["CJK Unified Ideographs Extension A"](e)||n0["CJK Unified Ideographs Extension B"](e)||n0.Osage(e)))}_tinySDF(e,i,r){let n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let r="400";/bold/i.test(i)?r="900":/medium/i.test(i)?r="500":/light/i.test(i)&&(r="200"),(o=e.tinySDF=new cx.TinySDF({fontFamily:n,fontWeight:r,fontSize:48,buffer:6,radius:16})).fontWeight=r}if(this.localGlyphs[o.fontWeight][r])return this.localGlyphs[o.fontWeight][r];let a=String.fromCodePoint(r),{data:s,width:l,height:h,glyphWidth:u,glyphHeight:c,glyphLeft:d,glyphTop:p,glyphAdvance:f}=o.draw(a);return this.localGlyphs[o.fontWeight][r]={id:r,bitmap:new lE({width:l,height:h},s),metrics:{width:u/2,height:c/2,left:d/2,top:p/2-27,advance:f/2,localGlyph:!0}}}}function cb(e,i){return e+i[1]-i[0]}function cw(e,i,r,n,o=1){let a=[],s=e.imagePrimary,l=s.pixelRatio,h=s.paddedRect.w-2,u=s.paddedRect.h-2,c=(e.right-e.left)*o,d=(e.bottom-e.top)*o,p=s.stretchX||[[0,h]],f=s.stretchY||[[0,u]],m=p.reduce(cb,0),g=f.reduce(cb,0),_=h-m,y=u-g,v=0,x=m,b=0,w=g,T=0,S=_,E=0,I=y;if(s.content&&n){let e=s.content;v=cT(p,0,e[0]),b=cT(f,0,e[1]),x=cT(p,e[0],e[2]),w=cT(f,e[1],e[3]),T=e[0]-v,E=e[1]-b,S=e[2]-e[0]-x,I=e[3]-e[1]-w}let C=(n,a,h,u)=>{var p,f,_,y,C,A,R,M,P,O,k,L,D,z,F,B;let N=(p=n.stretch-v,p/x*c+e.left*o),j=(f=n.fixed-T,_=S,y=n.stretch,f-_*y/m),V=(C=a.stretch-b,C/w*d+e.top*o),U=(A=a.fixed-E,R=I,M=a.stretch,A-R*M/g),G=(P=h.stretch-v,P/x*c+e.left*o),q=(O=h.fixed-T,k=S,L=h.stretch,O-k*L/m),$=(D=u.stretch-b,D/w*d+e.top*o),H=(z=u.fixed-E,F=I,B=u.stretch,z-F*B/g),Z=new e3(N,V),W=new e3(G,V),X=new e3(G,$),Y=new e3(N,$),K=new e3(j/l,U/l),J=new e3(q/l,H/l),Q=i*Math.PI/180;if(Q){let e=Math.sin(Q),i=Math.cos(Q),r=[i,-e,e,i];Z._matMult(r),W._matMult(r),Y._matMult(r),X._matMult(r)}let ee=n.stretch+n.fixed,et=h.stretch+h.fixed,ei=a.stretch+a.fixed,er=u.stretch+u.fixed,en=e.imageSecondary;return{tl:Z,tr:W,bl:Y,br:X,texPrimary:{x:s.paddedRect.x+1+ee,y:s.paddedRect.y+1+ei,w:et-ee,h:er-ei},texSecondary:en?{x:en.paddedRect.x+1+ee,y:en.paddedRect.y+1+ei,w:et-ee,h:er-ei}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:K,pixelOffsetBR:J,minFontScaleX:S/l/c,minFontScaleY:I/l/d,isSDF:r}};if(n&&(s.stretchX||s.stretchY)){let e=cS(p,_,m),i=cS(f,y,g);for(let r=0;r<e.length-1;r++){let n=e[r],o=e[r+1];for(let e=0;e<i.length-1;e++)a.push(C(n,i[e],o,i[e+1]))}}else a.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:u+1}));return a}function cT(e,i,r){let n=0;for(let o of e)n+=Math.max(i,Math.min(r,o[1]))-Math.max(i,Math.min(r,o[0]));return n}function cS(e,i,r){let n=[{fixed:-1,stretch:0}];for(let[i,r]of e){let e=n[n.length-1];n.push({fixed:i-e.stretch,stretch:e.stretch}),n.push({fixed:i-e.stretch,stretch:e.stretch+(r-i)})}return n.push({fixed:i+1,stretch:r}),n}cx.loadGlyphRange=function(e,i,r,n,o){let a=256*i;tK(n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${a}-${a+255}`),tZ.Glyphs),(e,i)=>{if(e)o(e);else if(i){let e={},r=new uY(i).readFields(uK,{});for(let i of r.glyphs)e[i.id]=i;o(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}})},cx.TinySDF=class{constructor({fontSize:e=24,buffer:i=3,radius:r=8,cutoff:n=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}={}){this.buffer=i,this.cutoff=n,this.radius=r;let l=this.size=e+4*i,h=this._createCanvas(l),u=this.ctx=h.getContext("2d",{willReadFrequently:!0});u.font=`${s} ${a} ${e}px ${o}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){let i=document.createElement("canvas");return i.width=i.height=e,i}draw(e){let{width:i,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(e),s=Math.ceil(r),l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),h=Math.min(this.size-this.buffer,s+Math.ceil(n)),u=l+2*this.buffer,c=h+2*this.buffer,d=Math.max(u*c,0),p=new Uint8ClampedArray(d),f={data:p,width:u,height:c,glyphWidth:l,glyphHeight:h,glyphTop:s,glyphLeft:0,glyphAdvance:i};if(0===l||0===h)return f;let{ctx:m,buffer:g,gridInner:_,gridOuter:y}=this;m.clearRect(g,g,l,h),m.fillText(e,g,g+s);let v=m.getImageData(g,g,l,h);y.fill(1e20,0,d),_.fill(0,0,d);for(let e=0;e<h;e++)for(let i=0;i<l;i++){let r=v.data[4*(e*l+i)+3]/255;if(0===r)continue;let n=(e+g)*u+i+g;if(1===r)y[n]=0,_[n]=1e20;else{let e=.5-r;y[n]=e>0?e*e:0,_[n]=e<0?e*e:0}}c_(y,0,0,u,c,u,this.f,this.v,this.z),c_(_,g,g,l,h,u,this.f,this.v,this.z);for(let e=0;e<d;e++){let i=Math.sqrt(y[e])-Math.sqrt(_[e]);p[e]=Math.round(255-255*(i/this.radius+this.cutoff))}return f}};function cE(e,i){return i.max-e.max}class cI{constructor(e,i,r,n){this.p=new e3(e,i),this.h=r,this.d=function(e,i){let r=!1,n=1/0;for(let o=0;o<i.length;o++){let a=i[o];for(let i=0,o=a.length,s=o-1;i<o;s=i++){let o=a[i],l=a[s];o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(r=!r),n=Math.min(n,sI(e,o,l))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}let cC=Object.keys,cA=Number.POSITIVE_INFINITY,cR=Math.sqrt(2);function cM(e,[i,r]){let n=0,o=0;if(r===cA){i<0&&(i=0);let r=i/cR;switch(e){case"top-right":case"top-left":o=r-7;break;case"bottom-right":case"bottom-left":o=7-r;break;case"bottom":o=7-i;break;case"top":o=i-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=i;break;case"right":n=-i}}else{switch(i=Math.abs(i),r=Math.abs(r),e){case"top-right":case"top-left":case"top":o=r-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-i;break;case"top-left":case"bottom-left":case"left":n=i}}return[n,o]}function cP(e,i,r,n,o,a,s,l,h){if(!i||!i.usvg)return;let u=co(n),c=co(o),d=("both"===a||"width"===a)&&cr(n)?Math.max(1,c.width/u.width):1,p=("both"===a||"height"===a)&&cn(n)?Math.max(1,c.height/u.height):1;r.scaleSelf(d,p);let f=r.toString();s.set(f,r),l.set(f,i);let{imagePosition:m}=cm(f,i,1);h.set(f,m)}function cO(e,i,r,n,o,a,s,l){var h,u,c,d,p;if(!e)return;let f=(h=i,u=r,c=n,d=o,p=a,"camera"===h.kind?h.maxSize:"composite"===h.kind?Math.max(u.possiblyEvaluate(new os(h.maxZoom),c).evaluate(p,{},c),u.possiblyEvaluate(new os(h.minZoom),c).evaluate(p,{},c)):u.possiblyEvaluate(new os(d)).evaluate(p,{},c));return e.scaleSelf(f*l*s)}function ck(e,i,r,n,o,a,s,l){return{iconPrimary:cO(e.getPrimary(),i,r,n,o,a,s,l),iconSecondary:cO(e.getSecondary(),i,r,n,o,a,s,l)}}function cL(e,i,r,n){e&&(e.imagePrimary=i.get(r.toString()),n&&(e.imageSecondary=i.get(n.toString())))}function cD(e,i){if(e){for(let r of e.positionedLines)for(let e of r.positionedGlyphs)if(null!==e.image){let r=e.image.toString();e.rect=i.get(r).paddedRect}}}function cz(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cF(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y){let v=function(e,i,r,n,o,a,s,l){let h=[];if(0===i.positionedLines.length)return h;let u=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=function(e){let i=e[0],r=e[1],n=i*r;return n>0?[i,-r]:n<0?[-i,r]:0===i?[r,i]:[r,-i]}(r),d=Math.abs(i.top-i.bottom);for(let e of i.positionedLines)d-=e.lineOffset;let p=i.positionedLines.length,f=d/p,m=i.top-r[1];for(let e=0;e<p;++e){let n=i.positionedLines[e];for(let a of(m=function(e,i,r,n){let o=i+e.positionedLines[n].lineOffset;return 0===n?r+o/2:r+(o+(i+e.positionedLines[n-1].lineOffset))/2}(i,f,m,e),n.positionedGlyphs)){let e,n,d,p;if(!a.rect)continue;let f=a.rect||{},g=4,_=!0,y=1,v=0;if(a.image){let e=s.get(a.image.toString());if(!e)continue;if(e.sdf){tf("SDF images are not supported in formatted text and will be ignored.");continue}_=!1,g=1/(y=e.pixelRatio)}let x=(o||l)&&a.vertical,b=a.metrics.advance*a.scale/2,w=a.metrics,T=a.rect;if(null===T)continue;l&&i.verticalizable&&(v=a.image?b-a.metrics.width*a.scale/2:0);let S=o?[a.x+b,a.y]:[0,0],E=[0,0],I=[0,0],C=!1;o||(x?(I=[a.x+b+c[0],a.y+c[1]-v],C=!0):E=[a.x+b+r[0],a.y+r[1]-v]);let A=T.w*a.scale/(y*(a.localGlyph?2:1)),R=T.h*a.scale/(y*(a.localGlyph?2:1));if(x){let i=a.y-m,r=new e3(-b,b-i),o=-Math.PI/2,s=new e3(...I);(e=new e3(-b+E[0],E[1]))._rotateAround(o,r)._add(s),e.x+=-i+b,e.y-=(w.left-g)*a.scale;let l=a.image?w.advance*a.scale:24*a.scale,h=String.fromCodePoint(a.glyph);"ï¸¶"===h||"ï¹"===h||"ï¸¸"===h||"ï¹"===h||"ï¹"===h||"ï¸¾"===h||"ï¸¼"===h||"ï¸º"===h||"ï¸"===h||"ï¹"===h||"ï¸"===h||"ï¸"===h||"ï¸"===h||"ï½"===h||"ï¿£"===h||"ï¸"===h||"ï¸"===h?e.x+=(1-g)*a.scale:"ï¸µ"===h||"ï¹"===h||"ï¸·"===h||"ï¹"===h||"ï¹"===h||"ï¸½"===h||"ï¸»"===h||"ï¸¹"===h||"ï¸"===h||"ï¸¿"===h?e.x+=l-w.height*a.scale+(-g-1)*a.scale:e.x+=a.image||w.width+2*g===T.w&&w.height+2*g===T.h?(l-R)/2:(l-(w.height+2*g)*a.scale)/2,n=new e3(e.x,e.y-A),d=new e3(e.x+R,e.y),p=new e3(e.x+R,e.y-A)}else{let i=(w.left-g)*a.scale-b+E[0],r=(-w.top-g)*a.scale+E[1],o=i+A,s=r+R;e=new e3(i,r),n=new e3(o,r),d=new e3(i,s),p=new e3(o,s)}if(u){let i;i=o?new e3(0,0):C?new e3(c[0],c[1]):new e3(r[0],r[1]),e._rotateAround(u,i),n._rotateAround(u,i),d._rotateAround(u,i),p._rotateAround(u,i)}let M=new e3(0,0),P=new e3(0,0);h.push({tl:e,tr:n,bl:d,br:p,texPrimary:f,texSecondary:void 0,writingMode:i.writingMode,glyphOffset:S,sectionIndex:a.sectionIndex,isSDF:_,pixelOffsetTL:M,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return h}(0,n,h,a,s,l,o,e.allowVerticalPlacement),x=e.textSizeData,b=null;for(let n of("source"===x.kind?(b=[128*a.layout.get("text-size").evaluate(l,{},_)*m.textScaleFactor])[0]>32640&&tf(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===x.kind&&((b=[128*m.compositeTextSizes[0].evaluate(l,{},_)*m.textScaleFactor,128*m.compositeTextSizes[1].evaluate(l,{},_)*m.textScaleFactor])[0]>32640||b[1]>32640)&&tf(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),e.addSymbols(e.text,v,b,h,s,l,c,i,r,u.lineStartIndex,u.lineLength,f,g,_,y,!1),d))p[n]=e.text.placedSymbolArray.length-1;return 4*v.length}function cB(e){for(let i in e)return e[i];return null}function cN(e,i,r,n,o,a,s,l,h,u){let c=s.top,d=s.bottom,p=s.left,f=s.right;if(ct(s)&&s.collisionPadding){let e=s.collisionPadding;p-=e[0],c-=e[1],f+=e[2],d+=e[3]}if(h){let e=new e3(p,c),i=new e3(f,c),r=new e3(p,d),n=new e3(f,d),o=h*e4,a=new e3(0,0);u&&(a=new e3(u[0],u[1])),e._rotateAround(o,a),i._rotateAround(o,a),r._rotateAround(o,a),n._rotateAround(o,a),p=Math.min(e.x,i.x,r.x,n.x),f=Math.max(e.x,i.x,r.x,n.x),c=Math.min(e.y,i.y,r.y,n.y),d=Math.max(e.y,i.y,r.y,n.y)}return e.emplaceBack(i.x,i.y,i.z,r.x,r.y,p,c,f,d,l,n,o,a),e.length-1}function cj(e){ct(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);let i=e.bottom-e.top;return i>0?Math.max(10,i):null}function cV(e,i){let r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*i:0,o=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),a=Math.sin(r)*o/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),s=Math.sin(e._pitch)*a+o,l=o*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let i=Math.max(e.zoom-17,0);e.isOrthographic&&(i/=10),s*=1+i}return Math.min(1.01*s,l)}function cU(e,i){if(!i.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:i};let r=Math.pow(2,-e.z),n=e.x*r,o=(e.x+1)*r,a=e.y*r,s=(e.y+1)*r,l=sa(n),h=sa(o),u=ss(a),c=ss(s),d=i.project(l,u),p=i.project(h,u),f=i.project(h,c),m=i.project(l,c),g=Math.min(d.x,p.x,f.x,m.x),_=Math.min(d.y,p.y,f.y,m.y),y=Math.max(d.x,p.x,f.x,m.x),v=Math.max(d.y,p.y,f.y,m.y),x=r/16;function b(e,r,n,o,a,s){let l=(n+a)/2,h=(o+s)/2,u=i.project(sa(l),ss(h)),c=Math.max(0,g-u.x,_-u.y,u.x-y,u.y-v);g=Math.min(g,u.x),y=Math.max(y,u.x),_=Math.min(_,u.y),v=Math.max(v,u.y),c>x&&(b(e,u,n,o,l,h),b(u,r,l,h,a,s))}b(d,p,n,a,o,a),b(p,f,o,a,o,s),b(f,m,o,s,n,s),b(m,d,n,s,n,a),g-=x,_-=x,y+=x,v+=x;let w=1/Math.max(y-g,v-_);return{scale:w,x:g*w,y:_*w,x2:y*w,y2:v*w,projection:i}}function cG(e,{x:i,y:r},n=0){return new e3(((i-n)*e.scale-e.x)*8192,(r*e.scale-e.y)*8192)}let cq=K(new Float32Array(16));class c${constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new st(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r,n=!0){return e._coordinatePoint(e.locationCoordinate(i,r),n)}pixelsPerMeter(e,i){return 1/sr(e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return cV(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,n){let o=new e3(i,Math.max(e.horizonLineFromTop(!1),r));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,n))}pointCoordinate3D(e,i,r){let n=new e3(i,r);if(e.elevation)return e.elevation.pointCoordinate(n);{let i=this.pointCoordinate(e,n.x,n.y,0);return[i.x,i.y,i.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);let r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return cq}createTileMatrix(e,i,r){let n,o,a,s=r.canonical,l=K(new Float64Array(16));if(this.isReprojectedInTileSpace){let h=cU(s,this);n=1,o=h.x+r.wrap*h.scale,a=h.y,et(l,l,[n/h.scale,n/h.scale,e.pixelsPerMeter/i])}else n=i/e.zoomScale(s.z),o=(s.x+Math.pow(2,s.z)*r.wrap)*n,a=s.y*n;return ee(l,l,[o,a,0]),et(l,l,[n/8192,n/8192,1]),l}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class cH extends c${constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(i*e4);this.n=(n+Math.sin(r*e4))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:r,c:n,r0:o}=this,a=(e-this.center[0])*e4,s=Math.sqrt(n-2*r*Math.sin(i*e4))/r;return{x:s*Math.sin(a*r),y:s*Math.cos(a*r)-o,z:0}}unproject(e,i){let{n:r,c:n,r0:o}=this,a=o+i,s=Math.atan2(e,Math.abs(a))*Math.sign(a);a*r<0&&(s-=Math.PI*Math.sign(e)*Math.sign(a));let l=this.center[0]*e4*r,h=tt((s=tr(s,-Math.PI-l,Math.PI-l))/r*e6+this.center[0],-180,180),u=Math.asin(tt((n-(e*e+a*a)*r*r)/(2*r),-1,1));return new st(h,tt(u*e6,-85.051129,85.051129))}}let cZ=Math.sqrt(3)/2;class cW extends c${project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let r=Math.asin(cZ*Math.sin(i)),n=r*r,o=n*n*n;return{x:.5*(e*Math.cos(r)/(cZ*(1.340264+-.24331799999999998*n+o*(.0062510000000000005+.034164*n)))/Math.PI+.5),y:1-.5*(r*(1.340264+-.081106*n+o*(893e-6+.003796*n))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=r*r,o=n*n*n;for(let e,a,s=0;s<12&&(a=r*(1.340264+-.081106*n+o*(893e-6+.003796*n))-i,o=(n=(r=tt(r-(e=a/(1.340264+-.24331799999999998*n+o*(.0062510000000000005+.034164*n))),-Math.PI/3,Math.PI/3))*r)*n*n,!(1e-12>Math.abs(e)));++s);let a=cZ*e*(1.340264+-.24331799999999998*n+o*(.0062510000000000005+.034164*n))/Math.cos(r),s=Math.asin(Math.sin(r)/cZ);return new st(tt(180*a/Math.PI,-180,180),tt(180*s/Math.PI,-85.051129,85.051129))}}class cX extends c${constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){return new st(360*(e-.5),tt(360*(.5-i),-85.051129,85.051129))}}let cY=Math.PI/2;function cK(e){return Math.tan((cY+e)/2)}class cJ extends c${constructor(e){super(e),this.center=e.center||[0,30];let[i,r]=this.parallels=e.parallels||[30,30],n=i*e4,o=r*e4;this.southernCenter=n+o<0,this.southernCenter&&(n=-n,o=-o);let a=Math.cos(n),s=cK(n);this.n=n===o?Math.sin(n):Math.log(a/Math.cos(o))/Math.log(cK(o)/s),this.f=a*Math.pow(cK(n),this.n)/this.n}project(e,i){i*=e4,this.southernCenter&&(i=-i),e=(e-this.center[0])*e4;let{n:r,f:n}=this;n>0?i<-cY+1e-6&&(i=-cY+1e-6):i>cY-1e-6&&(i=cY-1e-6);let o=n/Math.pow(cK(i),r),a=o*Math.sin(r*e),s=n-o*Math.cos(r*e);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i);let{n:r,f:n}=this,o=n-(i=(2*(1-i)-.5)*Math.PI),a=Math.sign(o),s=Math.sign(r)*Math.sqrt(e*e+o*o),l=Math.atan2(e,Math.abs(o))*a;o*r<0&&(l-=Math.PI*Math.sign(e)*a);let h=tt(l/r*e6+this.center[0],-180,180),u=tt((2*Math.atan(Math.pow(n/s,1/r))-cY)*e6,-85.051129,85.051129);return new st(h,this.southernCenter?-u:u)}}class cQ extends c${constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:sn(e),y:so(i),z:0}}unproject(e,i){return new st(sa(e),ss(i))}}let c0=85.051129*e4;class c1 extends c${project(e,i){let r=(i*=e4)*i,n=r*r;return{x:.5*((e*=e4)*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,n=25,o=0,a=r*r;do{let e=(a=r*r)*a;o=(r*(1.007226+a*(.015085+e*(.028874*a-.044475-.005916*e)))-i)/(1.007226+a*(.045255+e*(.259866*a-.311325-.005916*11*e))),r=tt(r-o,-c0,c0)}while(Math.abs(o)>1e-6&&--n>0)return new st(tt(e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))*e6,-180,180),r*e6)}}let c2=85.051129*e4;class c3 extends c${project(e,i){i*=e4,e*=e4;let r=Math.cos(i),n=Math.acos(r*Math.cos(e/2)),o=Math.sin(n)/n;return{x:.5*((.5*(2/Math.PI*e+2*r*Math.sin(e/2)/o)||0)/Math.PI+.5),y:1-.5*((.5*(i+Math.sin(i)/o)||0)/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,n=i=(2*(1-i)-1)*Math.PI,o=25,a=0,s=0;do{let o=Math.cos(n),l=Math.sin(n),h=2*l*o,u=l*l,c=o*o,d=Math.cos(r/2),p=Math.sin(r/2),f=2*d*p,m=p*p,g=1-c*d*d,_=g?1/g:0,y=g?Math.acos(o*d)*Math.sqrt(1/g):0,v=.5*(2*y*o*p+2*r/Math.PI)-e,x=.5*(y*l+n)-i,b=.5*_*(c*m+y*o*d*u)+1/Math.PI,w=_*(f*h/4-y*l*p),T=.125*_*(h*p-y*l*c*f),S=.5*_*(u*d+y*m*o)+.5,E=w*T-S*b;a=(x*w-v*S)/E,s=(v*T-x*b)/E,r=tt(r-a,-Math.PI,Math.PI),n=tt(n-s,-c2,c2)}while((Math.abs(a)>1e-6||Math.abs(s)>1e-6)&&--o>0)return new st(r*e6,n*e6)}}class c5 extends c${constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(this.parallels[0]*e4)),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:r,cosPhi:n}=this;return{x:e*e4*n*r+.5,y:-Math.sin(i*e4)/n*r+.5,z:0}}unproject(e,i){let{scale:r,cosPhi:n}=this,o=tt((e-.5)/r*e6/n,-180,180),a=Math.asin(tt(-(i-.5)/r*n,-1,1));return new st(o,tt(a*e6,-85.051129,85.051129))}}class c4 extends cQ{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){let n=li(e,i,r);return eI(n,n,lo(s6(r))),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,i,r){let n=a7(i.lat,i.lng),o=ew([],n),a=r?e._centerAltitude+r:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ey(n,n,o,1/sr(0)*8192*a);let s=K(new Float64Array(16));return Q(s,e.pixelMatrix,e.globeMatrix),eI(n,n,s),new e3(n[0],n[1])}pixelsPerMeter(e,i){return 1/sr(0)*i}pixelSpaceConversion(e,i,r){let n=1/sr(e)*i,o=ih(1/sr(45)*i,n,r);return this.pixelsPerMeter(e,i)/o}createTileMatrix(e,i,r){let n=la(s6(r.canonical));return Q(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,i){let{center:r}=e,n=lo(s6(i));return er(n,n,r.lng*e4),ei(n,n,r.lat*e4),et(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,i,r,n){return s3(e,i,r,!0)||new sp(0,0)}pointCoordinate3D(e,i,r){let n=this.pointCoordinate(e,i,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,i){return!s3(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(e,i){let r,n=e.cameraToCenterDistance,o=e._centerAltitude*i,a=e._camera,s=e._camera.forward(),l=ed([],e_([],s,-n),[0,0,o]),h=e.worldSize/(2*Math.PI),u=[0,0,-h],c=e.width/e.height,d=Math.tan(e.fovAboveCenter),p=e_([],a.up(),d),f=e_([],a.right(),d*c),m=ew([],ed([],ed([],s,p),f)),g=[];if(new sZ(l,m).closestPointOnSphere(u,h,g)){let i=ep([],ed([],g,u),l);r=Math.cos(e.fovAboveCenter)*eu(i)}else{let e=ep([],l,u),i=ep([],u,l);ew(i,i);let n=eu(e)-h,o=Math.acos((r=Math.sqrt(n*(n+2*h)))/(h+n))-Math.acos(eT(s,i));r*=Math.cos(o)}return 1.01*r}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=lu(e.zoom);if(r>0){let n=cV(e,1/sr(e.center.lat)*e.worldSize);return ih(i,n+e.worldSize/(2*Math.PI)*(1-Math.cos(Math.max(e.width,e.height)/e.worldSize*Math.PI)),Math.pow(r,10))}return i}upVector(e,i,r){return li(i,r,e,1)}upVectorScale(e){return{metersToTile:s1(lr(s6(e)))}}}function c6(e){let i=e.parallels,r=!!i&&.01>Math.abs(i[0]+i[1]);switch(e.name){case"mercator":return new cQ(e);case"equirectangular":return new cX(e);case"naturalEarth":return new c1(e);case"equalEarth":return new cW(e);case"winkelTripel":return new c3(e);case"albers":return r?new c5(e):new cH(e);case"lambertConformalConic":return r?new c5(e):new cJ(e);case"globe":return new c4(e)}throw Error(`Invalid projection name: ${e.name}`)}let c8=hi.VectorTileFeature.types,c9=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function c7(e,i,r,n,o,a,s,l,h,u,c,d,p){let f=l?Math.min(32640,Math.round(l[0])):0,m=l?Math.min(32640,Math.round(l[1])):0;e.emplaceBack(i,r,Math.round(32*n),Math.round(32*o),a,s,(f<<1)+ +!!h,m,16*u,16*c,256*d,256*p)}function de(e,i,r){e.emplaceBack(i,r)}function dt(e,i,r,n,o,a,s){e.emplaceBack(i,r,n,o,a,s)}function di(e,i,r,n,o){e.emplaceBack(i,r,n,o),e.emplaceBack(i,r,n,o),e.emplaceBack(i,r,n,o),e.emplaceBack(i,r,n,o)}class dr{constructor(e){this.layoutVertexArray=new oQ,this.indexArray=new o9,this.programConfigurations=e,this.segments=new aC,this.dynamicLayoutVertexArray=new o1,this.opacityVertexArray=new o2,this.placedSymbolArray=new am,this.iconTransitioningVertexArray=new o3,this.globeExtVertexArray=new o0,this.zOffsetVertexArray=new oq}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,i,r,n,o){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uF.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,c9,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,uN.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||o)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uB.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}nX(dr,"SymbolBuffers");class dn{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new aC,this.collisionVertexArray=new o8,this.collisionVertexArrayExt=new o1}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,uj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,uV.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}nX(dn,"CollisionBuffers");class da{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=K([]),this.placementViewportMatrix=K([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ca(this.zoom,i["text-size"]),this.iconSizeData=ca(this.zoom,i["icon-size"]);let r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(e=>u0[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new dr(new a0(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new dr(new a0(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new ay,this.lineVertexArray=new av,this.symbolInstances=new a_}calculateGlyphDependencies(e,i,r,n,o){for(let r of e){let e=r.codePointAt(0);if(void 0===e)break;if(i[e]=!0,n&&o&&e<=65535){let e=uq[r];e&&(i[e.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let r=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!hV(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}populate(e,i,r,n){let o=this.layers[0],a=o.layout,s="globe"===this.projection.name,l=a.get("text-font"),h=a.get("text-field"),u=a.get("icon-image"),[c,d]=a.get("icon-size-scale-range"),p=tt(i.scaleFactor||1,c,d),f=("constant"!==h.value.kind||h.value.value instanceof iD&&!h.value.value.isEmpty()||h.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),m="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,g=a.get("symbol-sort-key");if(this.features=[],!f&&!m)return;let _=i.iconDependencies,y=i.glyphDependencies,v=i.availableImages,x=new os(this.zoom);for(let{feature:i,id:h,index:u,sourceLayerIndex:c}of e){let e,d,b=o._featureFilter.needGeometry,w=s_(i,b);if(!o._featureFilter.filter(x,w,r))continue;if(b||(w.geometry=sg(i,r,n)),s&&1!==i.type&&r.z<=5){let e=w.geometry,i=(e,i)=>.98078528056>eT(li(e.x,e.y,r,1),li(i.x,i.y,r,1));for(let r=0;r<e.length;r++)e[r]=function(e,i){let r=e[0],n=[r];for(let o=1;o<e.length;o++){let a=e[o];(function e(i,r,n,o){if(o(r,n)){let a=r.add(n)._mult(.5);e(i,r,a,o),e(i,a,n,o)}else i.push(n)})(n,r,a,i),r=a}return n}(e[r],i)}if(f){let i=o.getValueAndResolveTokens("text-field",w,r,v),n=iD.factory(i);(function(e){for(let i of e.sections)if(function(e){for(let i of e)if(n5(i.charCodeAt(0)))return!0;return!1}(i.text))return!0;return!1})(n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===on()||this.hasRTLText&&oa.isParsed())&&(e=function(e,i,r){return e.sections.forEach(e=>{e.text=function(e,i,r){let n=i.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),oa.applyArabicShaping&&(e=oa.applyArabicShaping(e)),e}(e.text,i,r)}),e}(n,o,w))}if(m){let e=o.getValueAndResolveTokens("icon-image",w,r,v);d="string"==typeof e?iF.build(e):e}if(!e&&!d)continue;let T=this.sortFeaturesByKey?g.evaluate(w,{},r):void 0,S={id:h,text:e,icon:d,index:u,sourceLayerIndex:c,geometry:w.geometry,properties:i.properties,type:c8[i.type],sortKey:T};if(this.features.push(S),d){let e=this.layers[0]._unevaluatedLayout._values,{iconPrimary:i,iconSecondary:n}=ck(d,this.iconSizeData,e["icon-size"],r,this.zoom,S,this.pixelRatio,p),o=i.id.toString();if(_.has(o)?_.get(o).push(i):_.set(o,[i]),n){let e=n.id.toString();_.has(e)?_.get(e).push(n):_.set(e,[n])}}if(e){let i=l.evaluate(w,{},r).join(","),n="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");for(let r of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u0.vertical)>=0,e.sections))if(r.image){let e=r.image.getPrimary().scaleSelf(this.pixelRatio),i=e.id.toString(),n=_.get(i)||[];n.push(e),_.set(i,n)}else{let o=n1(e.toString()),a=r.fontStack||i,s=y[a]=y[a]||{};this.calculateGlyphDependencies(r.text,s,n,this.allowVerticalPlacement,o)}}}if("line"===a.get("symbol-placement")&&(this.features=function(e){let i={},r={},n=[],o=0;function a(i){n.push(e[i]),o++}function s(e,i,o){let a=r[e];return delete r[e],r[i]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(o[0]),a}function l(e,r,o){let a=i[r];return delete i[r],i[e]=a,n[a].geometry[0].shift(),n[a].geometry[0]=o[0].concat(n[a].geometry[0]),a}function h(e,i,r){let n=r?i[0][i[0].length-1]:i[0][0];return`${e}:${n.x}:${n.y}`}for(let u=0;u<e.length;u++){let c=e[u],d=c.geometry,p=c.text?c.text.toString():null;if(!p){a(u);continue}let f=h(p,d),m=h(p,d,!0);if(f in r&&m in i&&r[f]!==i[m]){let e=l(f,m,d),o=s(f,m,n[e].geometry);delete i[f],delete r[m],r[h(p,n[o].geometry,!0)]=o,n[e].geometry=null}else f in r?s(f,m,d):m in i?l(f,m,d):(a(u),i[f]=o-1,r[m]=o-1)}return n.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===a.get("symbol-elevation-reference")){if(this.elevationType="road",i.elevationFeatures)for(let e of(!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map),i.elevationFeatures))this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}else a.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,i)=>e.sortKey-i.sortKey)}update(e,i,r,n,o,a,s){this.text.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s),this.icon.programConfigurations.updatePaintArrays(e,i,o,r,n,a,s)}updateRoadElevation(){if("road"!==this.elevationType||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){let r=this.symbolInstances.get(i);if(65535===r.elevationFeatureIndex)continue;let n=this.elevationFeatures[r.elevationFeatureIndex];if(n){let i=.05+n.pointElevation(new e3(r.tileAnchorX,r.tileAnchorY));r.zOffset!==i&&(e=!0,r.zOffset=i)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){let e=(e,i,n)=>{(r+=i)>e.length&&e.resize(r);for(let o=-i;o<0;o++)e.emplace(o+r,n)},i=(e,i,r)=>{(n+=i)>e.length&&e.resize(n);for(let o=-i;o<0;o++)e.emplace(o+n,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let r=0;r<this.symbolInstances.length;r++){let n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:a,numIconVertices:s}=n,l=n.zOffset,h=s>0;if((o>0||a>0)&&(e(this.text.zOffsetVertexArray,o,l),e(this.text.zOffsetVertexArray,a,l)),h){let{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:r}=n;e>=0&&i(this.icon.zOffsetVertexArray,s,l),r>=0&&i(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,l)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=c6(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let r=this.lineVertexArray.length;if(void 0!==e.segment)for(let{x:e,y:r}of i)this.lineVertexArray.emplaceBack(e,r);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g){let _=e.indexArray,y=e.layoutVertexArray,v=e.globeExtVertexArray,x=e.segments.prepareSegment(4*i.length,y,_,this.canOverlap?a.sortKey:void 0),b=this.glyphOffsetArray.length,w=x.vertexLength,T=this.allowVerticalPlacement&&s===u0.vertical?Math.PI/2:0,S=a.text&&a.text.sections;for(let n=0;n<i.length;n++){let{tl:o,tr:s,bl:u,br:c,texPrimary:d,texSecondary:b,pixelOffsetTL:w,pixelOffsetBR:E,minFontScaleX:I,minFontScaleY:C,glyphOffset:A,isSDF:R,sectionIndex:M}=i[n],P=x.vertexLength,O=A[1];if(c7(y,h.x,h.y,o.x,O+o.y,d.x,d.y,r,R,w.x,w.y,I,C),c7(y,h.x,h.y,s.x,O+s.y,d.x+d.w,d.y,r,R,E.x,w.y,I,C),c7(y,h.x,h.y,u.x,O+u.y,d.x,d.y+d.h,r,R,w.x,E.y,I,C),c7(y,h.x,h.y,c.x,O+c.y,d.x+d.w,d.y+d.h,r,R,E.x,E.y,I,C),l){let{x:i,y:r,z:n}=l.anchor,[o,a,s]=l.up;dt(v,i,r,n,o,a,s),dt(v,i,r,n,o,a,s),dt(v,i,r,n,o,a,s),dt(v,i,r,n,o,a,s),di(e.dynamicLayoutVertexArray,i,r,n,T)}else di(e.dynamicLayoutVertexArray,h.x,h.y,h.z,T);if(g){let i=b||d;de(e.iconTransitioningVertexArray,i.x,i.y),de(e.iconTransitioningVertexArray,i.x+i.w,i.y),de(e.iconTransitioningVertexArray,i.x,i.y+i.h),de(e.iconTransitioningVertexArray,i.x+i.w,i.y+i.h)}_.emplaceBack(P,P+1,P+2),_.emplaceBack(P+1,P+2,P+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),n!==i.length-1&&M===i[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(y.length,a,a.index,{},p,f,m,S&&S[M])}let E=l?l.anchor:h;e.placedSymbolArray.emplaceBack(E.x,E.y,E.z,h.x,h.y,b,this.glyphOffsetArray.length-b,w,u,c,h.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],s,0,0,0,d,0)}_commitLayoutVertex(e,i,r,n,o,a,s){e.emplaceBack(i,r,n,o,a,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,i,r,n,o,a,s){let l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),h=l.vertexLength,u=s.tileAnchorX,c=s.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,i,e.padding,s.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,o,a,u,c,new e3(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,o,a,u,c,new e3(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,o,a,u,c,new e3(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,o,a,u,c,new e3(e.x1,e.y2)),l.vertexLength+=4;let d=r.indexArray;d.emplaceBack(h,h+1),d.emplaceBack(h+1,h+2),d.emplaceBack(h+2,h+3),d.emplaceBack(h+3,h),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,n,o,a){for(let s=n;s<o;s++){let n=r.get(s),o=this.getSymbolInstanceTextSize(e,a,i,s);this._addCollisionDebugVertices(n,o,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,i,r,n,o,a){for(let s=n;s<o;s++){let n=r.get(s),o=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._addCollisionDebugVertices(n,o,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,i,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dn(o4,uU.members,o3),this.iconCollisionBox=new dn(o4,uU.members,o3);let n=cl(this.iconSizeData,e),o=cl(this.textSizeData,e,r);for(let r=0;r<this.symbolInstances.length;r++){let a=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(o,e,i,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(o,e,i,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,i,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,i,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,i,r,n){let o=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:n),a=cs(this.textSizeData,e,o)/24;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,i,r){let n=this.icon.placedSymbolArray.get(r),o=cs(this.iconSizeData,e,n);return this.tilePixelRatio*o}_commitDebugCollisionVertexUpdate(e,i,r,n){e.emplaceBack(i,-r,-r,n),e.emplaceBack(i,r,-r,n),e.emplaceBack(i,r,r,n),e.emplaceBack(i,-r,r,n)}_updateTextDebugCollisionBoxes(e,i,r,n,o,a,s){for(let s=n;s<o;s++){let n=r.get(s),o=this.getSymbolInstanceTextSize(e,a,i,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,o,n.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(e,i,r,n,o,a,s){for(let s=n;s<o;s++){let n=r.get(s),o=this.getSymbolInstanceIconSize(e,i,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,o,n.padding,a.zOffset)}}updateCollisionDebugBuffers(e,i,r,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=cl(this.iconSizeData,e,n),a=cl(this.textSizeData,e,r);for(let s=0;s<this.symbolInstances.length;s++){let l=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(a,e,i,l.textBoxStartIndex,l.textBoxEndIndex,l,r),this._updateTextDebugCollisionBoxes(a,e,i,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,r),this._updateIconDebugCollisionBoxes(o,e,i,l.iconBoxStartIndex,l.iconBoxEndIndex,l,n),this._updateIconDebugCollisionBoxes(o,e,i,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,n)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,n,o,a,s,l,h){let u={};if(i<r){let{x1:r,y1:n,x2:o,y2:a,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p,featureIndex:f}=e.get(i);u.textBox={x1:r,y1:n,x2:o,y2:a,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p},u.textFeatureIndex=f}if(n<o){let{x1:i,y1:r,x2:o,y2:a,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p,featureIndex:f}=e.get(n);u.verticalTextBox={x1:i,y1:r,x2:o,y2:a,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p},u.verticalTextFeatureIndex=f}if(a<s){let{x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p,featureIndex:f}=e.get(a);u.iconBox={x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:l,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p},u.iconFeatureIndex=f}if(l<h){let{x1:i,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p,featureIndex:f}=e.get(l);u.verticalIconBox={x1:i,y1:r,x2:n,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:h,projectedAnchorZ:c,tileAnchorX:d,tileAnchorY:p},u.verticalIconFeatureIndex=f}return u}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let r=e.placedSymbolArray.get(i),n=r.vertexStartIndex+4*r.numGlyphs;for(let i=r.vertexStartIndex;i<n;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let i=Math.sin(e),r=Math.cos(e),n=[],o=[],a=[];for(let e=0;e<this.symbolInstances.length;++e){a.push(e);let s=this.symbolInstances.get(e);n.push(0|Math.round(i*s.tileAnchorX+r*s.tileAnchorY)),o.push(s.featureIndex)}return a.sort((e,i)=>n[e]-n[i]||o[i]-o[e]),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let i of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let e=this.symbolInstances.get(i);this.featureSortOrder.push(e.featureIndex);let{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:l}=e;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&o!==n&&o!==r&&this.addIndicesForPlacedSymbol(this.text,o),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),l>=0&&this.addIndicesForPlacedSymbol(this.icon,l)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}nX(da,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),da.addDynamicAttributes=di;class ds{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:i_,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nX(ds,"FormatSectionOverride",{omit:["defaultValue"]});let dl=()=>M||(M={layout:A||(A=new ov({"symbol-placement":new og(ox.layout_symbol["symbol-placement"]),"symbol-spacing":new og(ox.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new og(ox.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new o_(ox.layout_symbol["symbol-sort-key"]),"symbol-z-order":new og(ox.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new og(ox.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new og(ox.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new og(ox.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new og(ox.layout_symbol["icon-ignore-placement"]),"icon-optional":new og(ox.layout_symbol["icon-optional"]),"icon-rotation-alignment":new og(ox.layout_symbol["icon-rotation-alignment"]),"icon-size":new o_(ox.layout_symbol["icon-size"]),"icon-size-scale-range":new og(ox.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new o_(ox.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new o_(ox.layout_symbol["icon-text-fit-padding"]),"icon-image":new o_(ox.layout_symbol["icon-image"]),"icon-rotate":new o_(ox.layout_symbol["icon-rotate"]),"icon-padding":new og(ox.layout_symbol["icon-padding"]),"icon-keep-upright":new og(ox.layout_symbol["icon-keep-upright"]),"icon-offset":new o_(ox.layout_symbol["icon-offset"]),"icon-anchor":new o_(ox.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new og(ox.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new og(ox.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new og(ox.layout_symbol["text-rotation-alignment"]),"text-field":new o_(ox.layout_symbol["text-field"]),"text-font":new o_(ox.layout_symbol["text-font"]),"text-size":new o_(ox.layout_symbol["text-size"]),"text-size-scale-range":new og(ox.layout_symbol["text-size-scale-range"]),"text-max-width":new o_(ox.layout_symbol["text-max-width"]),"text-line-height":new o_(ox.layout_symbol["text-line-height"]),"text-letter-spacing":new o_(ox.layout_symbol["text-letter-spacing"]),"text-justify":new o_(ox.layout_symbol["text-justify"]),"text-radial-offset":new o_(ox.layout_symbol["text-radial-offset"]),"text-variable-anchor":new og(ox.layout_symbol["text-variable-anchor"]),"text-anchor":new o_(ox.layout_symbol["text-anchor"]),"text-max-angle":new og(ox.layout_symbol["text-max-angle"]),"text-writing-mode":new og(ox.layout_symbol["text-writing-mode"]),"text-rotate":new o_(ox.layout_symbol["text-rotate"]),"text-padding":new og(ox.layout_symbol["text-padding"]),"text-keep-upright":new og(ox.layout_symbol["text-keep-upright"]),"text-transform":new o_(ox.layout_symbol["text-transform"]),"text-offset":new o_(ox.layout_symbol["text-offset"]),"text-allow-overlap":new og(ox.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new og(ox.layout_symbol["text-ignore-placement"]),"text-optional":new og(ox.layout_symbol["text-optional"]),visibility:new og(ox.layout_symbol.visibility)})),paint:R||(R=new ov({"icon-opacity":new o_(ox.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new o_(ox.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new o_(ox.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new o_(ox.paint_symbol["text-emissive-strength"]),"icon-color":new o_(ox.paint_symbol["icon-color"]),"icon-halo-color":new o_(ox.paint_symbol["icon-halo-color"]),"icon-halo-width":new o_(ox.paint_symbol["icon-halo-width"]),"icon-halo-blur":new o_(ox.paint_symbol["icon-halo-blur"]),"icon-translate":new og(ox.paint_symbol["icon-translate"]),"icon-translate-anchor":new og(ox.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new og(ox.paint_symbol["icon-image-cross-fade"]),"text-opacity":new o_(ox.paint_symbol["text-opacity"]),"text-occlusion-opacity":new o_(ox.paint_symbol["text-occlusion-opacity"]),"text-color":new o_(ox.paint_symbol["text-color"],{runtimeType:ib,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new o_(ox.paint_symbol["text-halo-color"]),"text-halo-width":new o_(ox.paint_symbol["text-halo-width"]),"text-halo-blur":new o_(ox.paint_symbol["text-halo-blur"]),"text-translate":new og(ox.paint_symbol["text-translate"]),"text-translate-anchor":new og(ox.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new og(ox.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new og(ox.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new og(ox.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new og(ox.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new o_(ox.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))});class dh extends oD{constructor(e,i,r,n){super(e,dl(),i,r,n),this._colorAdjustmentMatrix=K([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let r=this.layout.get("text-writing-mode");if(r){let e=[];for(let i of r)0>e.indexOf(i)&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,r,n){return this._saturation===e&&this._contrast===i&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(e,i,r,n){e=tS(e),i=tT(i);let o=Y(),a=e/3,s=1-2*a,l=.5-.5*i,h=n-r;return Q(o,[h,0,0,0,0,h,0,0,0,0,h,0,r,r,r,1],[i,0,0,0,0,i,0,0,0,0,i,0,l,l,l,1]),Q(o,o,[s,a,a,0,a,s,a,0,a,a,s,0,0,0,0,1]),o}(e,i,r,n),this._saturation=e,this._contrast=i,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,r,n){var o;let a=this.layout.get(e).evaluate(i,{},r,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||nN(s.value)||!a?a:(o=i.properties,a.replace(/{([^{}]+)}/g,(e,i)=>i in o?String(o[i]):""))}createBucket(e){return new da(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of dl().paint.overridableProperties){if(!dh.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),r=new nB(new ds(i),i.property.specification,this.scope,this.options),n=null;n="constant"===i.value.kind||"source"===i.value.kind?new nV("source",r):new nU("composite",r,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new of(i.property,n,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&dh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let r=e.get("text-field"),n=dl().paint.properties[i],o=!1,a=e=>{for(let i of e)if(n.overrides&&n.overrides.hasOverride(i))return void(o=!0)};if("constant"===r.value.kind&&r.value.value instanceof iD)a(r.value.value.sections);else if("source"===r.value.kind){let e=i=>{o||(i instanceof iU&&ij(i.value)===iE?a(i.value.sections):i instanceof iH?a(i.sections):i.eachChild(e))},i=r.value;i._styleExpression&&e(i._styleExpression.expression)}return o}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,r){return{config:new aQ(this,{zoom:i,lut:r}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}var du=oN([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function dc(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function dd(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class dp{constructor(e,i,r,n){this.context=e,this.format=r,this.useMipmap=n&&n.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:n&&n.premultiply})}update(e,i){let r=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,n=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:o}=this,{gl:a}=o,{x:s,y:l}=i&&i.position?i.position:{x:0,y:0},h=s+r,u=l+n;this.size&&(this.size[0]!==h||this.size[1]!==u)&&(a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(this.texture),this.texture=a.createTexture(),this.size=null),a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA8&&(!i||!1!==i.premultiply));let c=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&h>0&&u>0){let e=this.useMipmap?Math.floor(Math.log2(Math.max(h,u)))+1:1;a.texStorage2D(a.TEXTURE_2D,e,this.format,h,u),this.size=[h,u]}if(this.size)if(c)a.texSubImage2D(a.TEXTURE_2D,0,s,l,dc(this.format),dd(this.format),e);else{let i=e.data;i&&a.texSubImage2D(a.TEXTURE_2D,0,s,l,r,n,dc(this.format),dd(this.format),i)}this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,i,r=!1){let{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,r,n){let{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),i!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class df{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}}function dm(e,i,r,n,o,a,s,l){let h=[e,i,1,r,n,1,o,a,1],u=[s,l,1],[c,d,p]=eC(u,u,W([],h));return X(h,h,[c,0,0,0,d,0,0,0,p])}function dg(e,i,r,n,o,a,s,l){let h=function(e,i,r,n,o,a,s,l){let h=dm(0,0,1,0,1,1,0,1),u=dm(e,i,r,n,o,a,s,l);return X(u,u,W([],h))}(e,i,r,n,o,a,s,l);return[h[2]/h[8]/8192,h[5]/h[8]/8192]}function d_(e){return[e[0],Math.min(Math.max(e[1],-85.051129),85.051129)]}class dy extends it{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new t8("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=tQ(this.map._requestManager.transformRequest(this.url,tZ.Image),(i,r)=>{this._imageRequest=null,this._loaded=!0,i?this.fire(new t9(i)):r&&(this.image=r instanceof HTMLImageElement?tM.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url&&(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded)),this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw Error("The provided handle is not a WebGLTexture instance");return this.texture=new df(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t8("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof df||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],r=e[0][1];for(let n of e)n[1]>r&&(r=n[1]),n[1]<i&&(i=n[1]);let n=(r+i)/2;if(n>85.051129?this.onNorthPole=!0:n<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let i=e.map(sp.fromLngLat);this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(let a of e)i=Math.min(i,a.x),r=Math.min(r,a.y),n=Math.max(n,a.x),o=Math.max(o,a.y);let a=Math.max(0,Math.floor(-Math.log(Math.max(n-i,o-r))/Math.LN2)),s=Math.pow(2,a),l=Math.floor((i+n)/2*s);return l>1&&(l-=1),new sB(a,l,Math.floor((r+o)/2*s))}(i),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new t8("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){var i;for(let e in this.tiles){let i=this.tiles[e];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let r=cU(new sB(0,0,0),this.map.transform.projection),n=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){let i=e[1].x-e[0].x,r=e[1].y-e[0].y,n=e[2].x-e[1].x,o=e[2].y-e[1].y,a=e[3].x-e[2].x,s=e[3].y-e[2].y,l=e[0].x-e[3].x,h=e[0].y-e[3].y,u=i*o-n*r,c=n*s-a*o,d=a*h-l*s,p=l*r-i*h;return u>0&&c>0&&d>0&&p>0||u<0&&c<0&&d<0&&p<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let o=cU(this.tileID,this.map.transform.projection),[a,s,l,h]=this.coordinates.map(e=>{let i=o.projection.project(e[0],e[1]);return cG(o,i)._round()});this.perspectiveTransform=dg(a.x,a.y,s.x,s.y,l.x,l.y,h.x,h.y);let u=this._boundsArray=new oG;u.emplaceBack(a.x,a.y,0,0),u.emplaceBack(s.x,s.y,8192,0),u.emplaceBack(h.x,h.y,0,8192),u.emplaceBack(l.x,l.y,8192,8192),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(u,du.members),this.boundsSegments=aC.simpleSegment(0,0,4,2);let c=[],[d,p,f,m]=function(e){let i=e[0][0],r=i,n=e[0][1],o=n;for(let a=1;a<e.length;a++)e[a][0]<i?i=e[a][0]:e[a][0]>r&&(r=e[a][0]),e[a][1]<n?n=e[a][1]:e[a][1]>o&&(o=e[a][1]);return[i,n,r-i,o-n]}([d_((i=this.coordinates)[0]),d_(i[1]),d_(i[2]),d_(i[3])]);{let i=new oG,[o,a,s,l]=function(e){let i=e[0].x,r=i,n=e[0].y,o=n;for(let a=1;a<e.length;a++)e[a].x<i?i=e[a].x:e[a].x>r&&(r=e[a].x),e[a].y<n?n=e[a].y:e[a].y>o&&(o=e[a].y);return[i,n,r-i,o-n]}(n),h=e=>[(e.x-o)/s,(e.y-a)/l],[u,g,_,y]=n.map(h),v=function(e,i,r,n,o,a,s,l){let h=dm(0,0,1,0,1,1,0,1);return X(h,h,W([],dm(e,i,r,n,o,a,s,l)))}(u[0],u[1],g[0],g[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=dg(u[0],u[1],g[0],g[1],_[0],_[1],y[0],y[1]);let x=(e,r)=>{c.push(e.lng);let n=Math.round((e.lng-d)/f*8192),o=Math.round((e.lat-p)/m*8192),a=h(r),s=eC([],[a[0],a[1],1],v),l=Math.round(s[0]/s[2]*8192),u=Math.round(s[1]/s[2]*8192);i.emplaceBack(n,o,l,u)},b=n[3].x-n[0].x,w=n[3].y-n[0].y,T=n[2].x-n[1].x,S=n[2].y-n[1].y;for(let e=0;e<65;e++){let i=e/64,o=[n[0].x+i*b,n[0].y+i*w],a=[n[1].x+i*T,n[1].y+i*S],s=a[0]-o[0],l=a[1]-o[1];for(let e=0;e<65;e++){let i=e/64,n={x:o[0]+s*i,y:o[1]+l*i,z:0};x(r.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(i,du.members)}{this.maxLongitudeTriangleSize=0;let i=[],r=new o9,n=(e,n,o)=>{r.emplaceBack(e,n,o);let a=c[e],s=c[n],l=c[o],h=Math.min(Math.min(a,s),l),u=Math.max(Math.max(a,s),l)-h;u>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=u),i.push(h+u/2)};for(let e=0;e<64;e++)for(let i=0;i<64;i++){let r=65*e+i,o=r+1,a=r+65,s=a+1;n(r,a,o),n(o,a,s)}[i,r]=function(e,i){let r=Array.from({length:e.length},(e,i)=>i);r.sort((i,r)=>e[i]-e[r]);let n=[],o=new o9;for(let a=0;a<r.length;a++){let s=r[a];n.push(e[s]);let l=3*s,h=l+1;o.emplaceBack(i.uint16[l],i.uint16[h],i.uint16[h+1])}return[n,o]}(i,r),this.elevatedGlobeTrianglesCenterLongitudes=i,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(r)}this.elevatedGlobeSegments=aC.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,f/8192,0,m/8192,0,0,p,d,0])}prepare(){let e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;let i=this.map.painter.context,r=i.gl;!this._dirty||this.texture instanceof df||(this.texture?this.texture.update(this.image):(this.texture=new dp(i,this.image,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored",i(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){var i;let r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;let n=this.elevatedGlobeTrianglesCenterLongitudes,o=(i=e+180)+360*Math.round((n[0]-i)/360),a=new aC,s=(e,i)=>{a.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:r.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},l=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-o)<=l){let e=tw(n,0,n.length,o+l);return e===n.length||s(e,tb(n,e+1,n.length,o+360-l)-e),a}o<n[0]&&(o+=360);let h=tb(n,0,n.length,o-l);if(h===n.length)return s(0,n.length),a;s(0,h-0);let u=tw(n,h+1,n.length,o+l);return u!==n.length&&s(u,n.length-u),a}}class dv extends oD{constructor(e,i,r,n){super(e,{layout:k||(k=new ov({visibility:new og(ox.layout_raster.visibility)})),paint:L||(L=new ov({"raster-opacity":new og(ox.paint_raster["raster-opacity"]),"raster-color":new oy(ox.paint_raster["raster-color"]),"raster-color-mix":new og(ox.paint_raster["raster-color-mix"]),"raster-color-range":new og(ox.paint_raster["raster-color-range"]),"raster-hue-rotate":new og(ox.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new og(ox.paint_raster["raster-brightness-min"]),"raster-brightness-max":new og(ox.paint_raster["raster-brightness-max"]),"raster-saturation":new og(ox.paint_raster["raster-saturation"]),"raster-contrast":new og(ox.paint_raster["raster-contrast"]),"raster-resampling":new og(ox.paint_raster["raster-resampling"]),"raster-fade-duration":new og(ox.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new og(ox.paint_raster["raster-emissive-strength"]),"raster-array-band":new og(ox.paint_raster["raster-array-band"]),"raster-elevation":new og(ox.paint_raster["raster-elevation"]),"raster-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof dy&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[r,n]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(n)||r===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=lA({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,n])}}class dx extends oD{constructor(e,i,r,n){super(e,{layout:D||(D=new ov({visibility:new og(ox["layout_raster-particle"].visibility)})),paint:z||(z=new ov({"raster-particle-array-band":new og(ox["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new og(ox["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new oy(ox["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new og(ox["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new og(ox["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new og(ox["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new og(ox["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new og(ox["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this._updateColorRamp(),this.lastInvalidatedAt=tM.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=lA({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=tM.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class db extends oD{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function dw(e,i,r){let n=[0,0,1],o=eD([]);return eF(o,o,r?-(e*e4)+Math.PI:e*e4),ez(o,o,-(i*e4)),eA(n,n,o),ew(n,n)}function dT(e,i){let r=dE(e.projection,e.zoom,e.width,e.height),n=function(e,i,r,n,o){let a=new st(r.lng-180*dI,r.lat),s=new st(r.lng+180*dI,r.lat),l=e.project(a.lng,a.lat),h=e.project(s.lng,s.lat),u=-Math.atan2(h.y-l.y,h.x-l.x),c=sp.fromLngLat(r);c.y=tt(c.y,-1+dI,1-dI);let d=c.toLngLat(),p=e.project(d.lng,d.lat),f=sp.fromLngLat(d);f.x+=dI;let m=f.toLngLat(),g=e.project(m.lng,m.lat),_=dA(g.x-p.x,g.y-p.y,u),y=sp.fromLngLat(d);y.y+=dI;let v=y.toLngLat(),x=e.project(v.lng,v.lat),b=dA(x.x-p.x,x.y-p.y,u),w=Math.abs(_.x)/Math.abs(b.y),T=K([]);en(T,T,-u*(1-(o?0:n)));let S=K([]);return et(S,S,[1,1-(1-w)*n,1]),S[4]=-b.x/b.y*n,en(S,S,u),Q(S,T,S),S}(e.projection,0,e.center,r,i),o=dS(e);return et(n,n,[o,o,1]),n}function dS(e){let i=e.projection,r=dE(e.projection,e.zoom,e.width,e.height);return Math.pow(2,dC(i,e.center)*r+(1-r)*dC(i,st.convert(i.center)))}function dE(e,i,r,n,o=1/0){let a=e.range;if(!a)return 0;let s=Math.log(Math.min(o,Math.max(r,n))/1024)/Math.LN2;return ti(a[0]+s,a[1]+s,i)}let dI=1/4e4;function dC(e,i){let r=tt(i.lat,-85.051129,85.051129),n=new st(i.lng-180*dI,r),o=new st(i.lng+180*dI,r),a=e.project(n.lng,r),s=e.project(o.lng,r),l=sp.fromLngLat(n),h=sp.fromLngLat(o),u=s.x-a.x,c=s.y-a.y,d=h.x-l.x,p=h.y-l.y;return Math.log(Math.sqrt((d*d+p*p)/(u*u+c*c)))/Math.LN2}function dA(e,i,r){let n=Math.cos(r),o=Math.sin(r);return{x:e*n-i*o,y:e*o+i*n}}function dR(e,i,r){K(e),en(e,e,i[2]*e4),ei(e,e,i[0]*e4),er(e,e,i[1]*e4),et(e,e,r),Q(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function dM(e,i,r,n,o,a,s,l){let h=[r[0]-i[0],r[1]-i[1],0],u=[n[0]-i[0],n[1]-i[1],0];if(1e-12>eu(h)||1e-12>eu(u))return eD(e);let c=eS([],h,u);return ew(c,c),ep(u,n,i),h[2]=(a-o)*l,u[2]=(s-o)*l,eS(h,h,u),ew(h,h),eG(e,c,h)}function dP(e,i,r=!1){let n=lu(i.zoom),o=function(e,i,r){let n=i.worldSize,o=[e[12],e[13],e[14]],a=ss(o[1]/n),s=sa(o[0]/n),l=K([]),h=1/sr(a)*n,u=1/sr(0)*n*su(a,i.zoom),c=1/ls(n),d=u*c;if(r){let e=dE(i.projection,i.zoom,i.width,i.height,1024);d=c*i.projection.pixelSpaceConversion(i.center.lat,n,e)}let p=a7(a,s);ed(p,p,e_([],ew([],p),h*d*o[2]));let f=function(e){let i=[e[0],e[1],e[2]],r=[0,1,0],n=eS([],r,i);return eS(r,i,n),0===ex(r)&&eS(n,i,r=[0,1,0]),ew(n,n),ew(r,r),ew(i,i),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],1]}(p);et(l,l,[d,d,d*h]),ee(l,l,[-o[0],-o[1],-o[2]]);let m=Q([],i.globeMatrix,f);return Q(m,m,l),Q(m,m,e),m}(e,i,r);return n>0?function(e,i,r){let n=(e,i,r)=>{let n=eu(e),o=eu(i),a=s8(e,i,r);return e_(a,a,1/eu(a)*ih(n,o,r))},o=n([e[0],e[1],e[2]],[i[0],i[1],i[2]],r),a=n([e[4],e[5],e[6]],[i[4],i[5],i[6]],r),s=n([e[8],e[9],e[10]],[i[8],i[9],i[10]],r),l=s8([e[12],e[13],e[14]],[i[12],i[13],i[14]],r);return[o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(o,function(e,i){let r=i.worldSize,n=1/sr(0)*r*su(i.center.lat,i.zoom)/ls(r),o=1/sr(i.center.lat)*r,a=K([]);return er(a,a,i.center.lng*e4),ei(a,a,i.center.lat*e4),ee(a,a,[0,0,a4]),et(a,a,[n,n,n*o]),ee(a,a,[i.point.x-.5*r,i.point.y-.5*r,0]),Q(a,a,e),Q(a,i.globeMatrix,a)}(e,i),n):o}function dO(e,i,r,n){let o,a=s0.projectAabbCorners(n,r),s=Number.MAX_VALUE,l=-1;for(let e=0;e<a.length;++e){let r=a[e];r[0]=(.5*r[0]+.5)*i.width,r[1]=(.5-.5*r[1])*i.height,r[2]<s&&(l=e,s=r[2])}let h=e=>new e3(a[e][0],a[e][1]);switch(l){case 0:case 6:o=[h(1),h(5),h(4),h(7),h(3),h(2),h(1)];break;case 1:case 7:o=[h(0),h(4),h(5),h(6),h(2),h(3),h(0)];break;case 3:case 5:o=[h(1),h(0),h(4),h(7),h(6),h(2),h(1)];break;default:o=[h(1),h(5),h(6),h(7),h(3),h(0),h(1)]}if(sb(e,o))return s}let dk=oN([{name:"a_pos_3f",components:3,type:"Float32"}]),dL=oN([{name:"a_color_3f",components:3,type:"Float32"}]),dD=oN([{name:"a_color_4f",components:4,type:"Float32"}]),dz=oN([{name:"a_uv_2f",components:2,type:"Float32"}]),dF=oN([{name:"a_normal_3f",components:3,type:"Float32"}]),dB=oN([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dN=oN([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),dj={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class dV{constructor(e,i,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=i&&i.__line__&&(this.line=i.__line__)}}function dU(e,i){let r=-1===e.indexOf("://");try{return new URL(e,r&&i?"http://example.com":void 0),!0}catch(e){return!1}}class dG{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class dq{constructor(){this.instancedDataArray=new al,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class d${constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,r,n){this.tileToMeter=sd(r);let o=this.layers[0]._featureFilter.needGeometry;for(let{feature:a,id:s,index:l,sourceLayerIndex:h}of(this.lookup=new Uint8Array(this.lookupDim*this.lookupDim),e)){let e=null!=s?s:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0,u=s_(a,o);if(!this.layers[0]._featureFilter.filter(new os(this.zoom),u,r))continue;let c={id:e,sourceLayerIndex:h,index:l,geometry:o?u.geometry:sg(a,r,n),properties:a.properties,type:a.type,patterns:{}},d=this.addFeature(c,c.geometry,u);d&&i.featureIndex.insert(a,c.geometry,l,h,this.index,this.instancesPerModel[d].instancedDataArray.length,256)}this.lookup=null}update(e,i,r,n){for(let i in this.instancesPerModel){let r=this.instancesPerModel[i];for(let i in e)r.idToFeaturesIndex.hasOwnProperty(i)&&(this.evaluate(r.features[r.idToFeaturesIndex[i]],e[i],r,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let r=this.instancesPerModel[i];for(let i of r.features){let n=this.layers[0],o=i.feature,a=this.canonical,s=n.paint.get("model-rotation").evaluate(o,{},a),l=n.paint.get("model-scale").evaluate(o,{},a),h=n.paint.get("model-translation").evaluate(o,{},a);eR(i.rotation,s)&&eR(i.scale,l)&&eR(i.translation,h)||(this.evaluate(i,i.featureStates,r,!0),e=!0)}}return e}updateReplacement(e,i,r,n){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(hV(this.activeReplacements,o))return!1;this.activeReplacements=o;let a=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i],s=o.instancedDataArray;for(let i of o.features){let o=i.instancedDataOffset,l=i.instancedDataCount;for(let i=0;i<l;i++){let l=16*(i+o),h=s.float32[l+0],u=h>8192,c=Math.floor(h=u?h-8192:h),d=s.float32[l+1],p=!1;for(let i of this.activeReplacements)if(!hF(i,r,dj.Model,n)&&!(i.min.x>c||c>i.max.x||i.min.y>d||d>i.max.y)&&(p=h$(hq(c,d,e.canonical,i.footprintTileId.canonical),i.footprint)))break;s.float32[l]=p?h+8192:h,a=a||p!==u}}}return a}isEmpty(){for(let e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let r=this.instancesPerModel[i];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,dB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let i=this.instancesPerModel[e];0!==i.instancedDataArray.length&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(let i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,r){let n=this.layers[0],o=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!o)return tf(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),o;(dU(o,!1)||void 0!==this.styleDefinedModelURLs[o])&&(this.modelUris.includes(o)||this.modelUris.push(o)),this.instancesPerModel[o]||(this.instancesPerModel[o]=new dq);let a=this.instancesPerModel[o],s=a.instancedDataArray,l=new dG(r,s.length);for(let e of i)for(let i of e){if(i.x<0||i.x>=8192||i.y<0||i.y>=8192)continue;let e=(this.lookupDim-1)/8192,r=this.lookupDim*(i.y*e|0)+i.x*e|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}this.instanceCount++;let n=s.length;s.resize(n+1),a.instancesEvaluatedElevation.push(0),s.float32[16*n]=i.x,s.float32[16*n+1]=i.y}return l.instancedDataCount=a.instancedDataArray.length-l.instancedDataOffset,l.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(l),this.evaluate(l,{},a,!1)),o}getModelUris(){return this.modelUris}evaluate(e,i,r,n){let o=this.layers[0],a=e.feature,s=this.canonical,l=e.rotation=o.paint.get("model-rotation").evaluate(a,i,s),h=e.scale=o.paint.get("model-scale").evaluate(a,i,s),u=e.translation=o.paint.get("model-translation").evaluate(a,i,s),c=o.paint.get("model-color").evaluate(a,i,s);c.a=o.paint.get("model-color-mix-intensity").evaluate(a,i,s);let d=[];this.maxVerticalOffset<u[2]&&(this.maxVerticalOffset=u[2]),this.maxScale=Math.max(Math.max(this.maxScale,h[0]),Math.max(h[1],h[2])),dR(d,l,h);let p=Math.round(100*c.a)+c.b/1.05;for(let i=0;i<e.instancedDataCount;++i){let o=e.instancedDataOffset+i,a=16*o,l=r.instancedDataArray.float32,h=0;n&&(h=l[a+6]-r.instancesEvaluatedElevation[o]);let f=0|l[a+1];l[a]=(0|l[a])+c.r/1.05,l[a+1]=f+c.g/1.05,l[a+2]=p,l[a+3]=1/(s.z>10?this.tileToMeter:sd(s,f)),l[a+4]=u[0],l[a+5]=u[1],l[a+6]=u[2]+h,l[a+7]=d[0],l[a+8]=d[1],l[a+9]=d[2],l[a+10]=d[4],l[a+11]=d[5],l[a+12]=d[6],l[a+13]=d[8],l[a+14]=d[9],l[a+15]=d[10],r.instancesEvaluatedElevation[o]=u[2]}}}nX(d$,"ModelBucket",{omit:["layers"]}),nX(dq,"PerModelAttributes"),nX(dG,"ModelFeature");let dH={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dZ(e,i,r,n,o,a,s,l,h,u=!1){let c=r.zoom,d=r.project(n),p=su(n.lat,c),f=1/p;K(e),ee(e,e,[d.x+s[0]*f,d.y+s[1]*f,s[2]]);let m=1,g=1,_=r.worldSize;if(u){if("mercator"===r.projection.name){let e=0;r.elevation&&(e=r.elevation.getAtPointOrZero(new sp(d.x/_,d.y/_),0));let i=ek([],[d.x,d.y,e,1],r.projMatrix)[3]/r.cameraToCenterDistance;m=i,g=i*su(r.center.lat,c)}else if("globe"===r.projection.name){let i=dP(e,r),o=[0,0,0,1];ek(o,o,Q([],r.projMatrix,i));let a=o[3]/r.cameraToCenterDistance,s=lu(c),l=r.projection.pixelsPerMeter(n.lat,_)*su(n.lat,c),h=r.projection.pixelsPerMeter(r.center.lat,_)*su(r.center.lat,c);m=a/ih(l,sh(r.center.lat),s),g=a*p/l,m*=h,g*=h}}else m=f;et(e,e,[m,m,g]);let y=[...e],v=i.orientation,x=[];if(dR(x,[v[0]+o[0],v[1]+o[1],v[2]+o[2]],a),Q(e,y,x),l&&r.elevation){let o=0,a=[];if(h&&r.elevation){o=function(e,i,r,n,o){let a=i.elevation;if(!a)return 0;let s=s0.projectAabbCorners(r,n),l=1/sr(o.lat)*i.worldSize,h=function(e,i){let r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let o of n){let n=e[o.corners[0]],a=e[o.corners[1]],s=e[o.corners[2]],l=[a[0]-n[0],a[1]-n[1],i*(a[2]-n[2])],h=eS(l,l,[s[0]-n[0],s[1]-n[1],i*(s[2]-n[2])]);ew(h,h),o.dotProductWithUp=eT(h,r)}return n.sort((e,i)=>e.dotProductWithUp-i.dotProductWithUp),n[0].corners}(s,l),u=s[h[0]],c=s[h[1]],d=s[h[2]],p=s[h[3]],f=a.getAtPointOrZero(new sp(u[0]/i.worldSize,u[1]/i.worldSize),0),m=a.getAtPointOrZero(new sp(c[0]/i.worldSize,c[1]/i.worldSize),0),g=a.getAtPointOrZero(new sp(d[0]/i.worldSize,d[1]/i.worldSize),0),_=a.getAtPointOrZero(new sp(p[0]/i.worldSize,p[1]/i.worldSize),0),y=(f+_)/2,v=(m+g)/2;return y>v?m<g?dM(e,c,p,u,m,_,f,l):dM(e,d,u,p,g,f,_,l):f<_?dM(e,u,c,d,f,m,g,l):dM(e,p,d,c,_,g,m,l),Math.max(y,v)}(a,r,i.aabb,e,n);let s=Q([],es([],a),x);Q(e,y,s)}else o=r.elevation.getAtPointOrZero(new sp(d.x/_,d.y/_),0);0!==o&&(e[14]+=o)}}function dW(e,i,r=!1){e.uploaded||(e.gfxTexture=new dp(i,e.image,r?i.gl.R8:i.gl.RGBA8,{useMipmap:e.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function dX(e,i,r){if(e.meshes)for(let n of e.meshes){n.indexBuffer=i.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=i.createVertexBuffer(n.vertexArray,dk.members,!1,!0),n.normalArray&&(n.normalBuffer=i.createVertexBuffer(n.normalArray,dF.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=i.createVertexBuffer(n.texcoordArray,dz.members,!1,!0)),n.colorArray&&(n.colorBuffer=i.createVertexBuffer(n.colorArray,(12===n.colorArray.bytesPerElement?dL:dD).members,!1,!0)),n.featureArray&&(n.pbrBuffer=i.createVertexBuffer(n.featureArray,dN.members,!0)),n.segments=aC.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);let e=n.material;e.pbrMetallicRoughness.baseColorTexture&&dW(e.pbrMetallicRoughness.baseColorTexture,i),e.pbrMetallicRoughness.metallicRoughnessTexture&&dW(e.pbrMetallicRoughness.metallicRoughnessTexture,i),e.normalTexture&&dW(e.normalTexture,i),e.occlusionTexture&&dW(e.occlusionTexture,i,r),e.emissionTexture&&dW(e.emissionTexture,i)}if(e.children)for(let n of e.children)dX(n,i,r)}function dY(e){if(e.meshes)for(let i of e.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(e.children)for(let i of e.children)dY(i)}function dK(e){var i;if(e.meshes)for(let r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((i=r.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));if(e.children)for(let i of e.children)dK(i)}class dJ{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){let n=r||e.findDEMTileFor(i);if(!n||!n.dem)return;let o=n.dem,a=n.tileID,s=1<<i.canonical.z-a.canonical.z;return new dJ(n,o.dim/8192/s,[(i.canonical.x/s-a.canonical.x)*o.dim,(i.canonical.y/s-a.canonical.y)*o.dim])}tileCoordToPixel(e,i){let r=i*this._scale+this._offset[1];return new e3(Math.floor(e*this._scale+this._offset[0]),Math.floor(r))}getElevationAt(e,i,r,n){let o=e*this._scale+this._offset[0],a=i*this._scale+this._offset[1],s=Math.floor(o),l=Math.floor(a),h=this._dem;return n=!!n,r?ih(ih(h.get(s,l,n),h.get(s,l+1,n),a-l),ih(h.get(s+1,l,n),h.get(s+1,l+1,n),a-l),o-s):h.get(s,l,n)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*(1/sr(e))*this._dem.stride}}let dQ=new Float32Array(262144),d0=new Uint8Array(262144),d1=["","wall","door","roof","window","lamp","logo"];class d2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:function e(i){let r=0;if(i.meshes)for(let e of i.meshes)r=Math.max(r,e.aabb.max[2]);if(i.children)for(let n of i.children)r=Math.max(r,e(n));return r}(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new s0([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new s0([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let r of this.node.meshes)this.node.lightMeshIndex!==e&&(r.transformedAabb=s0.applyTransformFast(r.aabb,this.node.matrix),i.encapsulate(r.transformedAabb)),e++;this.aabb=i}return this.aabb}}class d3{constructor(e,i,r,n,o,a,s){for(let l of(this.id=r,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=dH.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=dH.HasMapboxMeshFeatures),o&&(this.modelTraits|=dH.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[],i))this.nodesInfo.push(new d2(l)),function e(i,r,n){if(i.meshes)for(let e of i.meshes){if(e.aabb.min[0]===1/0)continue;let o=s0.applyTransform(e.aabb,i.matrix);n.insert(r,o.min[0],o.min[1],o.max[0],o.max[1])}if(i.children)for(let o of i.children)e(o,r,n)}(l,s.featureIndexArray.length,s.grid),s.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,s.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(let r of this.getNodesInfo()){let n=r.node;n.footprint&&i.push({footprint:n.footprint,id:e})}}update(e){let i=0!==Object.keys(e).length;if(i&&!this.stateDependentLayers.length)return;let r=i?this.stateDependentLayers:this.layers;if(!e5(e,this.states))for(let i of r)this.evaluate(i,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let r of i){let i=r.node;this.uploaded?this.updatePbrBuffer(i):dX(i,e,!0)}for(let e of i)dY(e.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),i=!0);return i}needsReEvaluation(e,i,r){let n=e.transform.projectionOptions,o=e.style.getBrightness(),a=this.brightness!==o;if(!this.uploaded||this.dirty||n.name!==this.projection.name||d5(r.paint.get("model-color").value,a)||d5(r.paint.get("model-color-mix-intensity").value,a)||d5(r.paint.get("model-roughness").value,a)||d5(r.paint.get("model-emissive-strength").value,a)||d5(r.paint.get("model-height-based-emissive-strength-multiplier").value,a)){for(let e of(this.projection=n,this.brightness=o,this.getNodesInfo()))e.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let r=this.getNodesInfo(),n=this.id.canonical;for(let e of r){let r=e.feature;e.evaluatedScale=i.paint.get("model-scale").evaluate(r,{},n)}}evaluate(e,i){for(let r of this.getNodesInfo()){if(!r.node.meshes)continue;let n=r.feature,o=i&&i[n.id];if(e5(o,r.state))continue;r.state=structuredClone(o);let a=r.node.meshes&&r.node.meshes[0].featureData,s=r.evaluatedColor[2],l=r.evaluatedRMEA[2],h=this.id.canonical;if(r.hasTranslucentParts=!1,a){for(let i=0;i<d1.length;i++){let a=d1[i];a.length&&(n.properties.part=a);let s=e.paint.get("model-color").evaluate(n,o,h).toRenderColor(null),l=e.paint.get("model-color-mix-intensity").evaluate(n,o,h);r.evaluatedColor[i]=[s.r,s.g,s.b,l],r.evaluatedRMEA[i][0]=e.paint.get("model-roughness").evaluate(n,o,h),r.evaluatedRMEA[i][2]=e.paint.get("model-emissive-strength").evaluate(n,o,h),r.evaluatedRMEA[i][3]=s.a,r.emissionHeightBasedParams[i]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(n,o,h),!r.hasTranslucentParts&&s.a<1&&(r.hasTranslucentParts=!0)}delete n.properties.part,function(e,i,r){let n=e.node,o=0,a=r&dH.HasMeshoptCompression;for(let r of n.meshes){if(n.lights&&n.lightMeshIndex===o||!r.featureData)continue;r.featureArray=new ah,r.featureArray.reserve(r.featureData.length);let s=i;for(let i of r.featureData){let o,l=a?65535&i:i>>16&65535,h=a?i>>16&65535:65535&i,u=(15&h)<8?15&h:0,c=e.evaluatedRMEA[u],d=e.evaluatedColor[u],p=e.emissionHeightBasedParams[u];if(s&&2===u&&n.lights&&(o=new ah).resize(10*n.lights.length),function(e,i,r,n,o,a,s,l){let h,u,c,d,p=(61440&i|(61440&i)>>4)>>8,f=(3840&i|(3840&i)>>4)>>4,m=240&i|(240&i)>>4;r[3]>0&&(p=ih(p,255*r[0],r[3]),f=ih(f,255*r[1],r[3]),m=ih(m,255*r[2],r[3]));let g=p<<8|f,_=m<<8|Math.floor(255*n[3]),y=Math.min(Math.round(.5*tt(n[2],0,2)*255),255)<<8|15*n[0]<<4|15*n[1],v=tt(o[0],0,1),x=tt(o[1],0,1),b=tt(o[2],0,1),w=tt(o[3],0,1);if(v!==x&&s!==a&&x!==v){let e=s-a;u=1/(e*(x-v)),c=-(a+e*v)/(e*(x-v)),d=Math.pow(10,tt(o[4],-1,1)),h=255*b<<8|255*w}else h=65535,u=0,c=1,d=1;if(e.emplaceBack(g,_,y,h,u,c,d),l){let e=l.length;l.clear();for(let i=0;i<e;i++)l.emplaceBack(g,_,y,h,u,c,d)}}(r.featureArray,l,d,c,p,r.aabb.min[2],r.aabb.max[2],o),o&&s){s=!1;let e=n.meshes[n.lightMeshIndex];e.featureArray=o,e.featureArray._trim()}}r.featureArray._trim(),o++}}(r,s!==r.evaluatedColor[2]||l!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(n,o,h);r.evaluatedScale=e.paint.get("model-scale").evaluate(n,o,h),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,r,n){let o=e.findDEMTileFor(r);if(o&&(o.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(o.dem&&o.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=o.tileID.overscaledZ;let i=dJ.create(e,r,o);if(!i)return;for(let o of(this.modelTraits&dH.HasMapboxMeshFeatures&&this.updateDEM(e,i,r,n),this.getNodesInfo())){let e=o.node;if(!e.footprint||!e.footprint.vertices||!e.footprint.vertices.length)continue;let r=e.footprint.vertices,n=i.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)n=Math.min(n,i.getElevationAt(r[e].x,r[e].y,!0,!0));e.elevation=n}}this.terrainTile=o.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,r,n){let o=i._dem._modifiedForSources[n];if(void 0===o&&(i._dem._modifiedForSources[n]=[],o=i._dem._modifiedForSources[n]),o.includes(r.canonical))return;let a=i._dem.dim;o.push(r.canonical);let s=!1;for(let e of this.getNodesInfo()){let r=e.node;if(!r.footprint||!r.footprint.grid)continue;let n=r.footprint.grid,o=i.tileCoordToPixel(n.min.x,n.min.y),l=i.tileCoordToPixel(n.max.x,n.max.y),h=Math.min(Math.min(a-l.y,o.x),Math.min(o.y,a-l.x));if(h<0)continue;let u=tt(h,2,5),c=Math.max(0,o.x-u),d=Math.max(0,o.y-u),p=Math.min(l.x+u,a-1),f=Math.min(l.y+u,a-1);for(let e=d;e<=f;++e)for(let i=c;i<=p;++i)d0[e*a+i]=255;let m=0,g=0;for(let e=0;e<n.cellsY;++e)for(let r=0;r<n.cellsX;++r){if(!n.cells[e*n.cellsX+r])continue;let o=i.tileCoordToPixel(n.min.x+r/n.xScale,n.min.y+e/n.yScale),s=i.tileCoordToPixel(n.min.x+(r+1)/n.xScale,n.min.y+(e+1)/n.yScale);for(let e=o.y;e<=Math.min(s.y+1,a-1);++e)for(let r=o.x;r<=Math.min(s.x+1,a-1);++r)255===d0[e*a+r]&&(d0[e*a+r]=0,m+=i.getElevationAtPixel(r,e),g++)}let _=m/g;c=Math.max(1,o.x-u),d=Math.max(1,o.y-u),p=Math.min(l.x+u,a-2),f=Math.min(l.y+u,a-2),s=!0;for(let e=d;e<=f;++e)for(let r=c;r<=p;++r)0===d0[e*a+r]&&(dQ[e*a+r]=i._dem.set(r,e,_));for(let e=1;e<u;++e){c=Math.max(1,o.x-e),d=Math.max(1,o.y-e),p=Math.min(l.x+e,a-2),f=Math.min(l.y+e,a-2);for(let r=d;r<=f;++r)for(let n=c;n<=p;++n){let o=r*a+n;if(255===d0[o]){let s=0,l=0,h=-1,c=-1;for(let i=-1;i<=1;++i)for(let o=-1;o<=1;++o){let u=(r+i)*a+n+o;if(d0[u]>=e)continue;let d=dQ[u],p=Math.abs(d);p>l&&(s=d,l=p,h=o,c=i)}if(l>.1){let a=1-(e+.5*Math.abs(h*c))/u,l=i._dem.get(n,r)+s*a,d=i._dem.get(n+h,r+c),p=i._dem.get(n-h,r-c,!0);(l-d)*(l-p)>0&&(l=(d+p)/2),dQ[o]=i._dem.set(n,r,l),d0[o]=e}}}}}s&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=tM.now())}setFilter(e){this.filter=e?oS(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new os(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){for(let e of this.getNodesInfo())dY(e.node),dK(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let r=i.getReplacementRegionsForTile(e.toUnwrapped()),n=this.getNodesInfo();for(let e=0;e<this.nodesInfo.length;e++){let i=n[e].node;n[e].hiddenByReplacement=!!i.footprint&&!r.find(e=>e.footprint===i.footprint)}}getHeightAtTileCoord(e,i){let r=this.getNodesInfo(),n=[],o=[0,0,0],a=K([]);for(let s=0;s<this.nodesInfo.length;s++){let l=r[s],h=l.node.meshes[0],u=h.transformedAabb;if(e<u.min[0]||i<u.min[1]||e>u.max[0]||i>u.max[1])continue;if(!0===l.node.hidden)return{height:1/0,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]};J(a,l.node.matrix),o[0]=e,o[1]=i,eI(o,o,a);let c=(o[0]-h.aabb.min[0])/(h.aabb.max[0]-h.aabb.min[0])*64|0,d=64*Math.min(63,(o[1]-h.aabb.min[1])/(h.aabb.max[1]-h.aabb.min[1])*64|0)+Math.min(63,c),p=h.heightmap[d];if(!(p<0&&l.node.footprint)){if(l.hiddenByReplacement)return;return{height:p,maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]}}if(l.node.footprint.grid.query(new e3(e,i),new e3(e,i),n),n.length>0)return{height:void 0,maxHeight:l.feature.properties.height,hidden:l.hiddenByReplacement,verticalScale:l.evaluatedScale[2]}}}}function d5(e,i){return e instanceof nV&&!e.isLightConstant&&i}function d4(e,i,r,n){let o=1<<e.z;i.lat=ss((n/8192+e.y)/o),i.lng=sa((r/8192+e.x)/o)}nX(d3,"Tiled3dModelBucket",{omit:["layers"]}),nX(d2,"Tiled3dModelFeature");let d6={circle:class extends oD{constructor(e,i,r,n){super(e,{layout:d||(d=new ov({"circle-sort-key":new o_(ox.layout_circle["circle-sort-key"]),"circle-elevation-reference":new og(ox.layout_circle["circle-elevation-reference"]),visibility:new og(ox.layout_circle.visibility)})),paint:p||(p=new ov({"circle-radius":new o_(ox.paint_circle["circle-radius"]),"circle-color":new o_(ox.paint_circle["circle-color"]),"circle-blur":new o_(ox.paint_circle["circle-blur"]),"circle-opacity":new o_(ox.paint_circle["circle-opacity"]),"circle-translate":new og(ox.paint_circle["circle-translate"]),"circle-translate-anchor":new og(ox.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new og(ox.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new og(ox.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new o_(ox.paint_circle["circle-stroke-width"]),"circle-stroke-color":new o_(ox.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new o_(ox.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new og(ox.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n)}createBucket(e){return new sx(e)}queryRadius(e){return sk("circle-radius",this,e)+sk("circle-stroke-width",this,e)+sL(this.paint.get("circle-translate"))}queryIntersectsFeature(e,i,r,n,o,a,s,l){let h=sz(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(i,r)+this.paint.get("circle-stroke-width").evaluate(i,r);return ly(e,n,a,s,l,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),h,u)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,i,r){let n=l_(this);return{config:new aQ(this,{zoom:i,lut:r}),defines:n,overrideFog:!1}}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends oD{createBucket(e){return new lb(e)}constructor(e,i,r,n){super(e,{layout:f||(f=new ov({visibility:new og(ox.layout_heatmap.visibility)})),paint:m||(m=new ov({"heatmap-radius":new o_(ox.paint_heatmap["heatmap-radius"]),"heatmap-weight":new o_(ox.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new og(ox.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oy(ox.paint_heatmap["heatmap-color"]),"heatmap-opacity":new og(ox.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return sk("heatmap-radius",this,e)}queryIntersectsFeature(e,i,r,n,o,a,s,l){let h=this.paint.get("heatmap-radius").evaluate(i,r);return ly(e,n,a,s,l,!0,!0,new e3(0,0),h)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,i,r){return"heatmap"===e?{config:new aQ(this,{zoom:i,lut:r}),overrideFog:!1}:{}}},hillshade:class extends oD{constructor(e,i,r,n){super(e,{layout:g||(g=new ov({visibility:new og(ox.layout_hillshade.visibility)})),paint:_||(_=new ov({"hillshade-illumination-direction":new og(ox.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new og(ox.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new og(ox.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new og(ox.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new og(ox.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new og(ox.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new og(ox.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,i,r){return{overrideFog:!1}}},fill:class extends oD{constructor(e,i,r,n){super(e,{layout:y||(y=new ov({"fill-sort-key":new o_(ox.layout_fill["fill-sort-key"]),visibility:new og(ox.layout_fill.visibility),"fill-elevation-reference":new og(ox.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new o_(ox.layout_fill["fill-construct-bridge-guard-rail"])})),paint:v||(v=new ov({"fill-antialias":new og(ox.paint_fill["fill-antialias"]),"fill-opacity":new o_(ox.paint_fill["fill-opacity"]),"fill-color":new o_(ox.paint_fill["fill-color"]),"fill-outline-color":new o_(ox.paint_fill["fill-outline-color"]),"fill-translate":new og(ox.paint_fill["fill-translate"]),"fill-translate-anchor":new og(ox.paint_fill["fill-translate-anchor"]),"fill-pattern":new o_(ox.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new og(ox.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new og(ox.paint_fill["fill-emissive-strength"]),"fill-z-offset":new o_(ox.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new o_(ox.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new o_(ox.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n)}getProgramIds(){let e=this.paint.get("fill-pattern"),i=e&&e.constantOr(1),r=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,i,r){return{config:new aQ(this,{zoom:i,lut:r}),overrideFog:!1}}recalculate(e,i){super.recalculate(e,i);let r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new hE(e)}queryRadius(){return sL(this.paint.get("fill-translate"))}queryIntersectsFeature(e,i,r,n,o,a){return!e.queryGeometry.isAboveHorizon&&sw(sD(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;let i=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?i&&!e:i}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends oD{constructor(e,i,r,n){super(e,{layout:w||(w=new ov({visibility:new og(ox["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new og(ox["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:T||(T=new ov({"fill-extrusion-opacity":new og(ox["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new o_(ox["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new og(ox["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new og(ox["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new o_(ox["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new og(ox["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new o_(ox["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new o_(ox["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new og(ox["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new og(ox["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new og(ox["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new og(ox["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new og(ox["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new og(ox["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new og(ox["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new og(ox["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new og(ox["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new og(ox["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new o_(ox["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new o_(ox["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new og(ox["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new og(ox["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new og(ox["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new og(ox["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new o_(ox["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new o_(ox["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new og(ox["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new h9(e)}queryRadius(){return sL(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,i,r,n,o,a,s,l,h){var u,c,d,p;let f=sz(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(i,r),g=this.paint.get("fill-extrusion-base").evaluate(i,r),_=[0,0],y=l&&a.elevation,v=a.elevation?a.elevation.exaggeration():1,x=e.tile.getBucket(this);if(y&&x instanceof h9){let e=x.centroidVertexArray,i=h+1;i<e.length&&(_[0]=e.geta_centroid_pos0(i),_[1]=e.geta_centroid_pos1(i))}if(0===_[0]&&1===_[1])return!1;"globe"===a.projection.name&&(n=ua([n],[new e3(0,0),new e3(8192,8192)],e.tileID.canonical).map(e=>e.polygon).flat());let[b,w]=(u=n,c=y?l:null,d=a.center.lat,p=e.tileID.canonical,"globe"===a.projection.name?function(e,i,r,n,o,a,s,l,h,u,c){let d=[],p=[],f=e.projection.upVectorScale(c,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(e,i,r,n)=>{e[0]=i,e[1]=r,e[2]=n,e[3]=1},y=uo();for(let v of(r>0&&(r+=y),n+=y,i)){let i=[],y=[];for(let d of v){let p=d.x+o.x,v=d.y+o.y,x=e.projection.projectTilePoint(p,v,c),b=e.projection.upVector(c,d.x,d.y),w=r,T=n;if(s){let e=um(p,v,r,n,s,l,h,u);w+=e.base,T+=e.top}0!==r?_(m,x.x+b[0]*f*w,x.y+b[1]*f*w,x.z+b[2]*f*w):_(m,x.x,x.y,x.z),_(g,x.x+b[0]*f*T,x.y+b[1]*f*T,x.z+b[2]*f*T),eI(m,m,a),eI(g,g,a),i.push(new us(m[0],m[1],m[2])),y.push(new us(g[0],g[1],g[2]))}d.push(i),p.push(y)}return[d,p]}(a,u,g,m,f,s,c,_,v,d,p):c?function(e,i,r,n,o,a,s,l,h){let u=[],c=[],d=[0,0,0,1];for(let p of e){let e=[],f=[];for(let u of p){let c=u.x+n.x,p=u.y+n.y,m=um(c,p,i,r,a,s,l,h);d[0]=c,d[1]=p,d[2]=m.base,d[3]=1,ek(d,d,o),d[3]=Math.max(d[3],1e-5);let g=new us(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=c,d[1]=p,d[2]=m.top,d[3]=1,ek(d,d,o),d[3]=Math.max(d[3],1e-5);let _=new us(d[0]/d[3],d[1]/d[3],d[2]/d[3]);e.push(g),f.push(_)}u.push(e),c.push(f)}return[u,c]}(u,g,m,f,s,c,_,v,d):function(e,i,r,n,o){let a=[],s=[],l=o[8]*i,h=o[9]*i,u=o[10]*i,c=o[11]*i,d=o[8]*r,p=o[9]*r,f=o[10]*r,m=o[11]*r;for(let i of e){let e=[],r=[];for(let a of i){let i=a.x+n.x,s=a.y+n.y,g=o[0]*i+o[4]*s+o[12],_=o[1]*i+o[5]*s+o[13],y=o[2]*i+o[6]*s+o[14],v=o[3]*i+o[7]*s+o[15],x=g+l,b=_+h,w=y+u,T=Math.max(v+c,1e-5),S=g+d,E=_+p,I=y+f,C=Math.max(v+m,1e-5);e.push(new us(x/T,b/T,w/T)),r.push(new us(S/C,E/C,I/C))}a.push(e),s.push(r)}return[a,s]}(u,g,m,f,s)),T=e.queryGeometry;return function(e,i,r){let n=1/0;sw(r,i)&&(n=uf(r,i[0]));for(let o=0;o<i.length;o++){let a=i[o],s=e[o];for(let e=0;e<a.length-1;e++){let i=a[e],o=[i,a[e+1],s[e+1],s[e],i];sb(r,o)&&(n=Math.min(n,uf(r,o)))}}return n!==1/0&&n}(b,w,T.isPointQuery()?T.screenBounds:T.screenGeometry)}},line:class extends oD{constructor(e,i,r,n){let o=uk();super(e,o,i,r,n),o.layout&&(this.layout=new om(o.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof rq,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=(C||((C=new uL(uk().paint.properties["line-width"].specification)).useIntegerZoom=!0),C).possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new uE(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,i,r){let n=uP(this);return{config:new aQ(this,{zoom:i,lut:r}),defines:n,overrideFog:!1}}queryRadius(e){var i,r;return i=sk("line-width",this,e),((r=sk("line-gap-width",this,e))>0?r+2*i:i)/2+Math.abs(sk("line-offset",this,e))+sL(this.paint.get("line-translate"))}queryIntersectsFeature(e,i,r,n,o,a){var s,l;if(e.queryGeometry.isAboveHorizon)return!1;let h=sD(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),u=e.pixelToTileUnitsFactor/2*(s=this.paint.get("line-width").evaluate(i,r),(l=this.paint.get("line-gap-width").evaluate(i,r))>0?l+2*s:s),c=this.paint.get("line-offset").evaluate(i,r);return c&&(n=function(e,i){let r=[],n=new e3(0,0);for(let o=0;o<e.length;o++){let a=e[o],s=[];for(let e=0;e<a.length;e++){let r=a[e],o=a[e+1],l=0===e?n:r.sub(a[e-1])._unit()._perp(),h=e===a.length-1?n:o.sub(r)._unit()._perp(),u=l._add(h)._unit();u._mult(1/(u.x*h.x+u.y*h.y)),s.push(u._mult(i)._add(r))}r.push(s)}return r}(n,c*e.pixelToTileUnitsFactor)),function(e,i,r){for(let n=0;n<i.length;n++){let o=i[n];if(e.length>=3){for(let i=0;i<o.length;i++)if(sA(e,o[i]))return!0}if(function(e,i,r){if(e.length>1){if(sT(e,i))return!0;for(let n=0;n<i.length;n++)if(sE(i[n],e,r))return!0}for(let n=0;n<e.length;n++)if(sE(e[n],i,r))return!0;return!1}(e,o,r))return!0}return!1}(h,n,u)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:dh,background:class extends oD{constructor(e,i,r,n){super(e,{layout:P||(P=new ov({visibility:new og(ox.layout_background.visibility)})),paint:O||(O=new ov({"background-pitch-alignment":new og(ox.paint_background["background-pitch-alignment"]),"background-color":new og(ox.paint_background["background-color"]),"background-pattern":new og(ox.paint_background["background-pattern"]),"background-opacity":new og(ox.paint_background["background-opacity"]),"background-emissive-strength":new og(ox.paint_background["background-emissive-strength"]),"background-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,i,r){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:dv,"raster-particle":dx,sky:class extends oD{constructor(e,i,r,n){super(e,{layout:F||(F=new ov({visibility:new og(ox.layout_sky.visibility)})),paint:B||(B=new ov({"sky-type":new og(ox.paint_sky["sky-type"]),"sky-atmosphere-sun":new og(ox.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new og(ox.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new og(ox.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new og(ox.paint_sky["sky-gradient-radius"]),"sky-gradient":new oy(ox.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new og(ox.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new og(ox.paint_sky["sky-atmosphere-color"]),"sky-opacity":new og(ox.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lA({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let i=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(e,i){if("atmosphere"===this.paint.get("sky-type")){let r=this.paint.get("sky-atmosphere-sun"),n=!r,o=e.style.light,a=o.properties.get("position");return n&&"viewport"===o.properties.get("anchor")&&tf("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?dw(a.azimuthal,90-a.polar,i):dw(r[0],90-r[1],i)}let r=this.paint.get("sky-gradient-center");return dw(r[0],90-r[1],i)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends oD{constructor(e,i,r,n){super(e,{paint:N||(N=new ov({}))},i,null)}},model:class extends oD{constructor(e,i,r,n){super(e,{layout:j||(j=new ov({visibility:new og(ox.layout_model.visibility),"model-id":new o_(ox.layout_model["model-id"])})),paint:V||(V=new ov({"model-opacity":new o_(ox.paint_model["model-opacity"]),"model-rotation":new o_(ox.paint_model["model-rotation"]),"model-scale":new o_(ox.paint_model["model-scale"]),"model-translation":new o_(ox.paint_model["model-translation"]),"model-color":new o_(ox.paint_model["model-color"]),"model-color-mix-intensity":new o_(ox.paint_model["model-color-mix-intensity"]),"model-type":new og(ox.paint_model["model-type"]),"model-cast-shadows":new og(ox.paint_model["model-cast-shadows"]),"model-receive-shadows":new og(ox.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new og(ox.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new o_(ox.paint_model["model-emissive-strength"]),"model-roughness":new o_(ox.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new o_(ox.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new og(ox.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new og(ox.paint_model["model-front-cutoff"]),"model-color-use-theme":new o_({type:"string",default:"default","property-type":"data-driven"})}))},i,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new d$(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return 8191*(e instanceof d3)}queryIntersectsFeature(e,i,r,n,o,a){if(!this.modelManager)return!1;let s=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof d$))return!1;for(let r in l.instancesPerModel){let n=l.instancesPerModel[r],o=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(o)){let i=n.features[n.idToFeaturesIndex[o]],h=s.getModel(r,this.scope);if(!h)return!1;let u=Y(),c=new st(0,0),d=l.canonical,p=Number.MAX_VALUE;for(let r=0;r<i.instancedDataCount;++r){let o=16*(i.instancedDataOffset+r),s=n.instancedDataArray.float32,l=[s[o+4],s[o+5],s[o+6]];d4(d,c,s[o],0|s[o+1]),dZ(u,h,a,c,i.rotation,i.scale,l,!1,!1,!1),"globe"===a.projection.name&&(u=dP(u,a));let f=Q([],a.projMatrix,u),m=e.queryGeometry,g=dO(m.isPointQuery()?m.screenBounds:m.screenGeometry,a,f,h.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){let i=this._transitionablePaint._values[e];return null!=i&&null!=i.value&&null!=i.value.expression&&i.value.expression instanceof nU}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends oD{constructor(e,i,r,n){super(e,{layout:x||(x=new ov({"clip-layer-types":new og(ox.layout_clip["clip-layer-types"]),"clip-layer-scope":new og(ox.layout_clip["clip-layer-scope"])})),paint:b||(b=new ov({}))},i,r,n)}recalculate(e,i){super.recalculate(e,i)}createBucket(e){return new hA(e)}is3D(e){return!0}}};class d8{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class d9{constructor(){this.tasks={},this.taskQueue=[],th(["process"],this),this.invoker=new d8(this.process),this.nextId=0}add(e,i){let r=this.nextId++,n=function({type:e,isSymbolTile:i,zoom:r}){return r=r||0,"message"===e?0:"maybePrepare"!==e||i?"parseTile"!==e||i?"parseTile"===e&&i?300-r:"maybePrepare"===e&&i?400-r:500:200-r:100-r}(i);return 0===n?(e(),null):(this.tasks[r]={fn:e,metadata:i,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}})}process(){{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;let e=this.pick();if(null===e)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}}pick(){let e=null,i=1/0;for(let r=0;r<this.taskQueue.length;r++){let n=this.tasks[this.taskQueue[r]];n.priority<i&&(i=n.priority,e=r)}if(null===e)return null;let r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class d7{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},th(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new d9}send(e,i,r,n,o=!1,a){let s=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=a,this.callbacks[s]=r);let l=new Set;return this.target.postMessage({id:s,type:e,hasCallback:!!r,targetMapId:n,mustQueue:o,sourceMapId:this.mapId,data:nJ(i,l)},l),{cancel:()=>{r&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){let i=e.data;if(!i)return;let r=i.id;if(r&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){let e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(i.mustQueue||t_(self)){let e=this.callbacks[r],n=this.scheduler.add(()=>this.processTask(r,i),e&&e.metadata||{type:"message"});n&&(this.cancelCallbacks[r]=n)}else this.processTask(r,i)}processTask(e,i){if(delete this.cancelCallbacks[e],"<response>"===i.type){let r=this.callbacks[e];delete this.callbacks[e],r&&(i.error?r(nQ(i.error)):r(null,nQ(i.data)))}else{let r=new Set,n=i.hasCallback?(i,n)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:i?nJ(i):null,data:nJ(n,r)},r)}:()=>{},o=nQ(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,o,n);else if(this.parent.getWorkerSource){let e=i.type.split("."),{source:r,scope:a}=o;this.parent.getWorkerSource(i.sourceMapId,e[0],r,a)[e[1]](o,n)}else n(Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var pe={workerUrl:"",workerClass:null,workerParams:void 0};let pt="mapboxgl_preloaded_worker_pool";class pi{constructor(){this.active={}}acquire(e,i=pi.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(null!=pe.workerClass?new pe.workerClass:new self.Worker(pe.workerUrl,pe.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}pi.workerCount=2;class pr{constructor(e,i,r="Worker",n=pi.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ts();let o=this.workerPool.acquire(this.id,n);for(let e=0;e<o.length;e++){let n=new pr.Actor(o[e],i,this.id);n.name=`${r} ${e}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,r){tn(this.actors,(r,n)=>{r.send(e,i,n)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pn(){return U||(U=new pi),U}pr.Actor=d7;let po=new is(0,0,0),pa={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},ps={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},pl={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},ph={PAINT_ORDER_FILL_AND_STROKE:1},pu={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},pc={MASK_TYPE_LUMINANCE:1};function pd(e,i,r){1===e&&i.icons.push(function(e,i){var r=e.readFields(pf,{name:void 0},i);if(r.usvg_tree.height||(r.usvg_tree.height=r.usvg_tree.width),!r.metadata)return r;let{metadata:n}=r;if(n.content_area){let{content_area:e}=n;null==e.top&&(e.top=e.left),null==e.width&&(e.width=r.usvg_tree.width),null==e.height&&(e.height=e.width)}return n.stretch_x&&n.stretch_x.length&&pp(n,"x"),n.stretch_y&&n.stretch_y.length&&pp(n,"y"),r}(r,r.readVarint()+r.pos))}function pp(e,i){let r=[],n=e[`stretch_${i}`],o=null;for(let e=0;e<n.length;e++)null===o?o=0===r.length?n[0]:r[r.length-1][1]+n[e]:(r.push([o,o+n[e]]),o=null);e[`stretch_${i}_areas`]=r}function pf(e,i,r){var n,o;1===e?i.name=r.readString():2===e?(n=r.readVarint()+r.pos,i.metadata=r.readFields(pm,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},n)):3===e&&(o=r.readVarint()+r.pos,i.usvg_tree=r.readFields(py,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},o),i.data="usvg_tree")}function pm(e,i,r){var n,o;1===e?i.stretch_x=r.readPackedVarint():2===e?i.stretch_y=r.readPackedVarint():3===e?(n=r.readVarint()+r.pos,i.content_area=r.readFields(pg,{left:0},n)):4===e&&i.variables.push((o=r.readVarint()+r.pos,r.readFields(p_,{name:void 0},o)))}function pg(e,i,r){1===e?i.left=r.readVarint():2===e?i.width=r.readVarint():3===e?i.top=r.readVarint():4===e&&(i.height=r.readVarint())}function p_(e,i,r){1===e?i.name=r.readString():2===e&&(i.rgb_color=pI(r.readVarint()),i.value="rgb_color")}function py(e,i,r){var n,o,a;1===e?i.width=i.height=r.readVarint():2===e?i.height=r.readVarint():3===e?i.children.push(pv(r,r.readVarint()+r.pos)):4===e?i.linear_gradients.push((n=r.readVarint()+r.pos,r.readFields(pA,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},n))):5===e?i.radial_gradients.push((o=r.readVarint()+r.pos,r.readFields(pP,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},o))):7===e?i.clip_paths.push((a=r.readVarint()+r.pos,r.readFields(pO,{children:[]},a))):8===e&&i.masks.push(function(e,i){let r=e.readFields(pk,{left:0,width:20,mask_type:pc.MASK_TYPE_LUMINANCE,children:[]},i);return null==r.height&&(r.height=r.width),null==r.top&&(r.top=r.left),r}(r,r.readVarint()+r.pos))}function pv(e,i){return e.readFields(px,{},i)}function px(e,i,r){var n,o;1===e?(n=r.readVarint()+r.pos,i.group=r.readFields(pb,{opacity:255,children:[]},n),i.node="group"):2===e&&(o=r.readVarint()+r.pos,i.path=r.readFields(pS,{paint_order:1,commands:[],step:1,diffs:[],rule:pa.PATH_RULE_NON_ZERO},o),i.node="path")}function pb(e,i,r){1===e?i.transform=pw(r,r.readVarint()+r.pos):2===e?i.opacity=r.readVarint():5===e?i.clip_path_idx=r.readVarint():6===e?i.mask_idx=r.readVarint():7===e&&i.children.push(pv(r,r.readVarint()+r.pos))}function pw(e,i){return e.readFields(pT,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function pT(e,i,r){1===e?i.sx=r.readFloat():2===e?i.ky=r.readFloat():3===e?i.kx=r.readFloat():4===e?i.sy=r.readFloat():5===e?i.tx=r.readFloat():6===e&&(i.ty=r.readFloat())}function pS(e,i,r){var n,o;1===e?(n=r.readVarint()+r.pos,i.fill=r.readFields(pE,{rgb_color:po,paint:"rgb_color",opacity:255},n)):2===e?(o=r.readVarint()+r.pos,i.stroke=r.readFields(pC,{rgb_color:po,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},o)):3===e?i.paint_order=r.readVarint():5===e?r.readPackedVarint(i.commands):6===e?i.step=r.readFloat():7===e?r.readPackedSVarint(i.diffs):8===e&&(i.rule=r.readVarint())}function pE(e,i,r){1===e?(i.rgb_color=pI(r.readVarint()),i.paint="rgb_color"):2===e?(i.linear_gradient_idx=r.readVarint(),i.paint="linear_gradient_idx"):3===e?(i.radial_gradient_idx=r.readVarint(),i.paint="radial_gradient_idx"):5===e&&(i.opacity=r.readVarint())}function pI(e){return new is((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function pC(e,i,r){1===e?(i.rgb_color=pI(r.readVarint()),i.paint="rgb_color"):2===e?(i.linear_gradient_idx=r.readVarint(),i.paint="linear_gradient_idx"):3===e?(i.radial_gradient_idx=r.readVarint(),i.paint="radial_gradient_idx"):5===e?r.readPackedFloat(i.dasharray):6===e?i.dashoffset=r.readFloat():7===e?i.miterlimit=r.readFloat():8===e?i.opacity=r.readVarint():9===e?i.width=r.readFloat():10===e?i.linecap=r.readVarint():11===e&&(i.linejoin=r.readVarint())}function pA(e,i,r){1===e?i.transform=pw(r,r.readVarint()+r.pos):2===e?i.spread_method=r.readVarint():3===e?i.stops.push(pR(r,r.readVarint()+r.pos)):4===e?i.x1=r.readFloat():5===e?i.y1=r.readFloat():6===e?i.x2=r.readFloat():7===e&&(i.y2=r.readFloat())}function pR(e,i){return e.readFields(pM,{offset:0,opacity:255,rgb_color:po},i)}function pM(e,i,r){1===e?i.offset=r.readFloat():2===e?i.opacity=r.readVarint():3===e&&(i.rgb_color=pI(r.readVarint()))}function pP(e,i,r){1===e?i.transform=pw(r,r.readVarint()+r.pos):2===e?i.spread_method=r.readVarint():3===e?i.stops.push(pR(r,r.readVarint()+r.pos)):4===e?i.cx=r.readFloat():5===e?i.cy=r.readFloat():6===e?i.r=r.readFloat():7===e?i.fx=r.readFloat():8===e?i.fy=r.readFloat():9===e&&(i.fr=r.readFloat())}function pO(e,i,r){1===e?i.transform=pw(r,r.readVarint()+r.pos):2===e?i.clip_path_idx=r.readVarint():3===e&&i.children.push(pv(r,r.readVarint()+r.pos))}function pk(e,i,r){1===e?i.left=i.top=r.readFloat():2===e?i.width=i.height=r.readFloat():3===e?i.top=r.readFloat():4===e?i.height=r.readFloat():5===e?i.mask_type=r.readVarint():6===e?i.mask_idx=r.readVarint():7===e&&i.children.push(pv(r,r.readVarint()+r.pos))}class pL{static calculate(e={},i=[]){let r=new Map,n=new Map;if(0===Object.keys(e).length)return r;for(let[o,a]of(i.forEach(e=>{n.set(e.name,e.rgb_color||new is(0,0,0))}),Object.entries(e)))n.has(o)?r.set(n.get(o).toStringPremultipliedAlpha(),a):console.warn(`Ignoring unknown image variable "${o}"`);return r}}function pD(e,i=255,r){let n=e.toStringPremultipliedAlpha(),o=r.has(n)?r.get(n).clone():e.clone();return o.a*=i/255,o.toString()}function pz(e,i){if(!tR()){let r=document.createElement("canvas");return r.width=e,r.height=i,r}return new OffscreenCanvas(e,i)}function pF(e,i){let r=pL.calculate(i.params,e.metadata?e.metadata.variables:[]),n=e.usvg_tree,o=n.width,a=n.height,s=i.transform?i.transform:new DOMMatrix,l=Math.max(1,Math.round(o*s.a)),h=Math.max(1,Math.round(a*s.d)),u=new DOMMatrix([l/o,0,0,h/a,0,0]),c=pz(l,h).getContext("2d");return pB(c,u,n,n,r),c.getImageData(0,0,l,h)}function pB(e,i,r,n,o){for(let a of n.children)(function e(i,r,n,o,a){o.group?(i.save(),function(i,r,n,o,a){var s,l;let h=null!=o.mask_idx?n.masks[o.mask_idx]:null,u=null!=o.clip_path_idx?n.clip_paths[o.clip_path_idx]:null;if(o.transform&&(r=pq(o.transform).preMultiplySelf(r)),s=null!=u,l=null!=h,255===o.opacity&&!s&&!l)return pB(i,r,n,o,a);let c=pz(i.canvas.width,i.canvas.height),d=c.getContext("2d");pB(d,r,n,o,a),u&&function e(i,r,n,o){let a=pz(i.canvas.width,i.canvas.height);(function i(r,n,o,a){let s=a.transform?pq(a.transform).preMultiplySelf(n):n,l=pz(r.canvas.width,r.canvas.height),h=l.getContext("2d");for(let e of a.children)if(e.group)i(h,s,o,e.group);else if(e.path){let i=e.path,r=new Path2D;r.addPath(p$(i),s),h.fill(r,pj(i))}let u=null!=a.clip_path_idx?o.clip_paths[a.clip_path_idx]:null;u&&e(h,s,o,u),r.globalCompositeOperation="source-over",r.drawImage(l,0,0)})(a.getContext("2d"),r,n,o),i.globalCompositeOperation="destination-in",i.drawImage(a,0,0)}(d,r,n,u),h&&function i(r,n,o,a,s){if(0===a.children.length)return;let l=null!=a.mask_idx?o.masks[a.mask_idx]:null;l&&i(r,n,o,l,s);let h=r.canvas.width,u=r.canvas.height,c=pz(h,u),d=c.getContext("2d"),p=a.width,f=a.height,m=a.left,g=a.top,_=new Path2D,y=new Path2D;for(let i of(y.rect(m,g,p,f),_.addPath(y,n),d.clip(_),a.children))e(d,n,o,i,s);let v=d.getImageData(0,0,h,u),x=v.data;if(a.mask_type===pc.MASK_TYPE_LUMINANCE)for(let e=0;e<x.length;e+=4)x[e+3]=x[e+3]/255*(.2126*x[e]+.7152*x[e+1]+.0722*x[e+2]);d.putImageData(v,0,0),r.globalCompositeOperation="destination-in",r.drawImage(c,0,0)}(d,r,n,h,a),i.globalAlpha=o.opacity/255,i.drawImage(c,0,0)}(i,r,n,o.group,a),i.restore()):o.path&&(i.save(),function(e,i,r,n,o){let a=p$(n);e.setTransform(i),n.paint_order===ph.PAINT_ORDER_FILL_AND_STROKE?(pN(e,r,n,a,o),pV(e,r,n,a,o)):(pV(e,r,n,a,o),pN(e,r,n,a,o))}(i,r,n,o.path,a),i.restore())})(e,i,r,a,o)}function pN(e,i,r,n,o){let a=r.fill;if(!a)return;let s=a.opacity/255;switch(a.paint){case"rgb_color":e.fillStyle=pD(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":e.fillStyle=pU(e,i.linear_gradients[a.linear_gradient_idx],s,o);break;case"radial_gradient_idx":e.fillStyle=pG(e,i.radial_gradients[a.radial_gradient_idx],s,o)}e.fill(n,pj(r))}function pj(e){return e.rule===pa.PATH_RULE_NON_ZERO?"nonzero":e.rule===pa.PATH_RULE_EVEN_ODD?"evenodd":void 0}function pV(e,i,r,n,o){let a=r.stroke;if(!a)return;e.lineWidth=a.width,e.miterLimit=a.miterlimit,e.setLineDash(a.dasharray),e.lineDashOffset=a.dashoffset;let s=a.opacity/255;switch(a.paint){case"rgb_color":e.strokeStyle=pD(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":e.strokeStyle=pU(e,i.linear_gradients[a.linear_gradient_idx],s,o);break;case"radial_gradient_idx":e.strokeStyle=pG(e,i.radial_gradients[a.radial_gradient_idx],s,o)}switch(a.linejoin){case pl.LINE_JOIN_MITER_CLIP:case pl.LINE_JOIN_MITER:e.lineJoin="miter";break;case pl.LINE_JOIN_ROUND:e.lineJoin="round";break;case pl.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(a.linecap){case ps.LINE_CAP_BUTT:e.lineCap="butt";break;case ps.LINE_CAP_ROUND:e.lineCap="round";break;case ps.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(n)}function pU(e,i,r,n){if(1===i.stops.length){let e=i.stops[0];return pD(e.rgb_color,e.opacity*r,n)}let o=pq(i.transform),{x1:a,y1:s,x2:l,y2:h}=i,u=o.transformPoint(new DOMPoint(a,s)),c=o.transformPoint(new DOMPoint(l,h)),d=e.createLinearGradient(u.x,u.y,c.x,c.y);for(let e of i.stops)d.addColorStop(e.offset,pD(e.rgb_color,e.opacity*r,n));return d}function pG(e,i,r,n){if(1===i.stops.length){let e=i.stops[0];return pD(e.rgb_color,e.opacity*r,n)}let o=pq(i.transform),{fx:a,fy:s,cx:l,cy:h}=i,u=o.transformPoint(new DOMPoint(a,s)),c=o.transformPoint(new DOMPoint(l,h)),d=e.createRadialGradient(u.x,u.y,0,c.x,c.y,i.r*((o.a+o.d)/2));for(let e of i.stops)d.addColorStop(e.offset,pD(e.rgb_color,e.opacity*r,n));return d}function pq(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function p$(e){let i=new Path2D,r=e.step,n=e.diffs[0]*r,o=e.diffs[1]*r;i.moveTo(n,o);for(let a=0,s=2;a<e.commands.length;a++)switch(e.commands[a]){case pu.PATH_COMMAND_MOVE:n+=e.diffs[s++]*r,o+=e.diffs[s++]*r,i.moveTo(n,o);break;case pu.PATH_COMMAND_LINE:n+=e.diffs[s++]*r,o+=e.diffs[s++]*r,i.lineTo(n,o);break;case pu.PATH_COMMAND_QUAD:{let a=n+e.diffs[s++]*r,l=o+e.diffs[s++]*r;n=a+e.diffs[s++]*r,o=l+e.diffs[s++]*r,i.quadraticCurveTo(a,l,n,o);break}case pu.PATH_COMMAND_CUBIC:{let a=n+e.diffs[s++]*r,l=o+e.diffs[s++]*r,h=a+e.diffs[s++]*r,u=l+e.diffs[s++]*r;n=h+e.diffs[s++]*r,o=u+e.diffs[s++]*r,i.bezierCurveTo(a,l,h,u,n,o);break}case pu.PATH_COMMAND_CLOSE:i.closePath()}return i}class pH{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}nX(pH,"LRUCache");class pZ{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new lI(e,e.data)}getFromCache(e,i,r){return this.cacheMap.has(r)||this.cacheMap.set(r,new pH(150)),this.cacheMap.get(r).get(oO(e.toString(),i))}setInCache(e,i,r,n){this.cacheDependenciesMap.has(n)||this.cacheDependenciesMap.set(n,new Map),this.cacheMap.has(n)||this.cacheMap.set(n,new pH(150));let o=this.cacheDependenciesMap.get(n),a=oO(e.id.toString(),r);o.get(a)||o.set(a,new Set);let s=this.cacheMap.get(n),l=e.toString();o.get(a).add(l),s.put(oO(e.toString(),r),i)}removeImagesFromCacheByIds(e,i,r=0){if(!this.cacheMap.has(r)||!this.cacheDependenciesMap.has(r))return;let n=this.cacheMap.get(r),o=this.cacheDependenciesMap.get(r);for(let r of e){let e=oO(r.toString(),i);if(o.has(e)){for(let i of o.get(e))n.delete(i);o.delete(e)}}}rasterize(e,i,r,n,o=pF){let a=this.getFromCache(e,r,n);if(a)return a.clone();let s=o(i.icon,e.options),l=pZ._getImage(s);return this.setInCache(e,l,r,n),l.clone()}}class pW{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function pX(e,i,r,n){let o=0,a=Number.MAX_VALUE;for(let s=0;s<3;s++)if(1e-15>Math.abs(n[s])){if(r[s]<e[s]||r[s]>i[s])return null}else{let l=1/n[s],h=(e[s]-r[s])*l,u=(i[s]-r[s])*l;if(h>u){let e=h;h=u,u=e}if(h>o&&(o=h),u<a&&(a=u),o>a)return null}return o}function pY(e,i,r,n,o,a,s,l,h,u,c){let d=n-e,p=o-i,f=a-r,m=s-e,g=l-i,_=h-r,y=c[1]*_-c[2]*g,v=c[2]*m-c[0]*_,x=c[0]*g-c[1]*m,b=d*y+p*v+f*x;if(1e-15>Math.abs(b))return null;let w=1/b,T=u[0]-e,S=u[1]-i,E=u[2]-r,I=(T*y+S*v+E*x)*w;if(I<0||I>1)return null;let C=S*f-E*p,A=E*d-T*f,R=T*p-S*d,M=(c[0]*C+c[1]*A+c[2]*R)*w;return M<0||I+M>1?null:(m*C+g*A+_*R)*w}function pK(e,i,r,n,o,a,s,l,h){let u=1<<r,c=a-n,d=s-o;l[0]=(e+0)/u*c+n,l[1]=(i+0)/u*d+o,h[0]=(e+1)/u*c+n,h[1]=(i+1)/u*d+o}class pJ{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(e){let i=Math.ceil(Math.log2(e.dim/8)),r=[],n=Math.ceil(Math.pow(2,i)),o=1/n,a=(e,i,r,n,o)=>{let a=+!!n;o[0]=e*r,o[1]=i*r,o[2]=(e+1)*r-a,o[3]=(i+1)*r-a},s=new pW(n),l=[];for(let i=0;i<n*n;i++){a(i%n,Math.floor(i/n),o,!1,l);let r=p0(l[0],l[1],e),h=p0(l[2],l[1],e),u=p0(l[2],l[3],e),c=p0(l[0],l[3],e);s.minimums.push(Math.min(r,h,u,c)),s.maximums.push(Math.max(r,h,u,c)),s.leaves.push(1)}for(r.push(s),n/=2;n>=1;n/=2){let e=r[r.length-1];s=new pW(n);for(let i=0;i<n*n;i++){a(i%n,Math.floor(i/n),2,!0,l);let r=e.getElevation(l[0],l[1]),o=e.getElevation(l[2],l[1]),h=e.getElevation(l[2],l[3]),u=e.getElevation(l[0],l[3]),c=e.isLeaf(l[0],l[1]),d=e.isLeaf(l[2],l[1]),p=e.isLeaf(l[2],l[3]),f=e.isLeaf(l[0],l[3]),m=Math.min(r.min,o.min,h.min,u.min),g=Math.max(r.max,o.max,h.max,u.max),_=c&&d&&p&&f;s.maximums.push(g),s.minimums.push(m),s.leaves.push(g-m<=5&&_?1:0)}r.push(s)}return r}(this.dem),r=i.length-1,n=i[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,n,o,a,s=1){return pX([e,i,-100],[r,n,this.maximums[0]*s],o,a)}raycast(e,i,r,n,o,a,s=1){if(!this.nodeCount)return null;let l=this.raycastRoot(e,i,r,n,o,a,s);if(null==l)return null;let h=[],u=[],c=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){let{idx:l,t:y,nodex:v,nodey:x,depth:b}=p.pop();if(this.leaves[l]){pK(v,x,b,e,i,r,n,c,d);let l=1<<b,h=(v+0)/l,u=(v+1)/l,p=(x+0)/l,w=(x+1)/l,T=p0(h,p,this.dem)*s,S=p0(u,p,this.dem)*s,E=p0(u,w,this.dem)*s,I=p0(h,w,this.dem)*s,C=pY(c[0],c[1],T,d[0],c[1],S,d[0],d[1],E,o,a),A=pY(d[0],d[1],E,c[0],d[1],I,c[0],c[1],T,o,a),R=Math.min(null!==C?C:Number.MAX_VALUE,null!==A?A:Number.MAX_VALUE);if(R!==Number.MAX_VALUE)return R;{var f,m,g,_;let e=ey([],o,a,y);if(pQ(T,S,I,E,(f=e[0],(f-(m=c[0]))/(d[0]-m)),(g=e[1],(g-(_=c[1]))/(d[1]-_)))>=e[2])return y}continue}let w=0;for(let p=0;p<this._siblingOffset.length;p++){pK((v<<1)+this._siblingOffset[p][0],(x<<1)+this._siblingOffset[p][1],b+1,e,i,r,n,c,d),c[2]=-100,d[2]=this.maximums[this.childOffsets[l]+p]*s;let f=pX(c,d,o,a);if(null!=f){h[p]=f;let e=!1;for(let i=0;i<w&&!e;i++)f>=h[u[i]]&&(u.splice(i,0,p),e=!0);e||(u[w]=p),w++}}for(let e=0;e<w;e++){let i=u[e];p.push({idx:this.childOffsets[l]+i,t:h[i],nodex:(v<<1)+this._siblingOffset[i][0],nodey:(x<<1)+this._siblingOffset[i][1],depth:b+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,n,o){if(1===e[n].isLeaf(i,r))return;this.childOffsets[o]||(this.childOffsets[o]=this.nodeCount);let a=n-1,s=e[a],l=0,h=0;for(let e=0;e<this._siblingOffset.length;e++){let n=2*i+this._siblingOffset[e][0],o=2*r+this._siblingOffset[e][1],a=s.getElevation(n,o),u=s.isLeaf(n,o),c=this._addNode(a.min,a.max,u);u&&(l|=1<<e),h||(h=c)}for(let n=0;n<this._siblingOffset.length;n++)l&1<<n||this._construct(e,2*i+this._siblingOffset[n][0],2*r+this._siblingOffset[n][1],a,h+n)}}function pQ(e,i,r,n,o,a){return ih(ih(e,r,a),ih(i,n,a),o)}function p0(e,i,r){let n=r.dim,o=tt(e*n-.5,0,n-1),a=tt(i*n-.5,0,n-1),s=Math.floor(o),l=Math.floor(a),h=Math.min(s+1,n-1),u=Math.min(l+1,n-1);return pQ(r.get(s,l),r.get(h,l),r.get(s,u),r.get(h,u),o-s,a-l)}let p1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function p2(e,i,r){return(256*e*256+256*i+r)/10-1e4}function p3(e,i,r){return 256*e+i+r/256-32768}class p5{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,n=!1){if(this.uid=e,i.height!==i.width)throw RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return void tf(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let o=this.dim=i.height-2,a=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let e=0;e<o;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(o,e)]=a[this._idx(o-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,o)]=a[this._idx(e,o-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(o,-1)]=a[this._idx(o-1,0)],a[this._idx(-1,o)]=a[this._idx(0,o-1)],a[this._idx(o,o)]=a[this._idx(o-1,o-1)]}let s="terrarium"===r?p3:p2;for(let e=0;e<a.length;++e){let i=4*e;this.floatView[e]=s(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}this._timestamp=tM.now()}_buildQuadTree(){this._tree=new pJ(this)}get(e,i,r=!1){r&&(e=tt(e,-1,this.dim),i=tt(i,-1,this.dim));let n=this._idx(e,i);return this.floatView[n]}set(e,i,r){let n=this._idx(e,i),o=this.floatView[n];return this.floatView[n]=r,r-o}static getUnpackVector(e){return p1[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let r=[0,0,0,0],n=p5.getUnpackVector(i),o=Math.floor((e+n[3])/n[2]);return r[2]=o%256,o=Math.floor(o/256),r[1]=o%256,o=Math.floor(o/256),r[0]=o,r}getPixels(){return new lC({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw Error("dem dimension mismatch");let n=i*this.dim,o=i*this.dim+this.dim,a=r*this.dim,s=r*this.dim+this.dim;switch(i){case -1:n=o-1;break;case 1:o=n+1}switch(r){case -1:a=s-1;break;case 1:s=a+1}let l=-i*this.dim,h=-r*this.dim;for(let i=a;i<s;i++)for(let r=n;r<o;r++){let n=4*this._idx(r,i),o=4*this._idx(r+l,i+h);this.pixels[n+0]=e.pixels[o+0],this.pixels[n+1]=e.pixels[o+1],this.pixels[n+2]=e.pixels[o+2],this.pixels[n+3]=e.pixels[o+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function p4(e,i,r){var n;1===e?i.headerLength=r.readFixed32():2===e?i.x=r.readVarint():3===e?i.y=r.readVarint():4===e?i.z=r.readVarint():5===e&&i.layers.push((n=r.readVarint()+r.pos,r.readFields(fe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},n)))}function p6(e,i,r){var n;1===e?(n=r.readVarint()+r.pos,i.delta_filter=r.readFields(p8,{blockSize:0},n),i.filter="delta_filter"):2===e?(r.readVarint(),i.filter="zigzag_filter"):3===e?(r.readVarint(),i.filter="bitshuffle_filter"):4===e&&(r.readVarint(),i.filter="byteshuffle_filter")}function p8(e,i,r){1===e&&(i.blockSize=r.readVarint())}function p9(e,i,r){1===e?(r.readVarint(),i.codec="gzip_data"):2===e?(r.readVarint(),i.codec="jpeg_image"):3===e?(r.readVarint(),i.codec="webp_image"):4===e&&(r.readVarint(),i.codec="png_image")}function p7(e,i,r){var n,o;let a=0,s=0;1===e?i.firstByte=r.readFixed64():2===e?i.lastByte=r.readFixed64():3===e?i.filters.push((n=r.readVarint()+r.pos,r.readFields(p6,{},n))):4===e?(o=r.readVarint()+r.pos,i.codec=r.readFields(p9,{},o)):5===e?s=r.readFloat():6===e?a=r.readFloat():7===e?i.bands.push(r.readString()):8===e?i.offset=r.readDouble():9===e&&(i.scale=r.readDouble()),0===i.offset&&(i.offset=s),0===i.scale&&(i.scale=a)}function fe(e,i,r){var n;1===e?i.version=r.readVarint():2===e?i.name=r.readString():3===e?i.units=r.readString():4===e?i.tileSize=r.readVarint():5===e?i.buffer=r.readVarint():6===e?i.pixelFormat=r.readVarint():7===e&&i.dataIndex.push((n=r.readVarint()+r.pos,r.readFields(p7,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},n)))}function ft(e,i,r){if(2===e){var n;n=r.readVarint()+r.pos,r.readFields(fi,i,n)}else if(3===e)throw Error("Not implemented")}function fi(e,i,r){if(1===e){let e=0,n=r.readVarint()+r.pos;for(;r.pos<n;)i[e++]=r.readVarint()}}nX(p5,"DEMData"),nX(pJ,"DemMinMaxQuadTree",{omit:["dem"]});var fr=Uint8Array,fn=Uint16Array,fo=Int32Array,fa=new fr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fs=new fr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fl=new fr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fh=function(e,i){for(var r=new fn(31),n=0;n<31;++n)r[n]=i+=1<<e[n-1];var o=new fo(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)o[a]=a-r[n]<<5|n;return{b:r,r:o}},fu=fh(fa,2),fc=fu.b,fd=fu.r;fc[28]=258,fd[258]=28;for(var fp=fh(fs,0).b,ff=new fn(32768),fm=0;fm<32768;++fm){var fg=(43690&fm)>>1|(21845&fm)<<1;ff[fm]=((65280&(fg=(61680&(fg=(52428&fg)>>2|(13107&fg)<<2))>>4|(3855&fg)<<4))>>8|(255&fg)<<8)>>1}var f_=function(e,i,r){for(var n=e.length,o=0,a=new fn(i);o<n;++o)e[o]&&++a[e[o]-1];var s,l=new fn(i);for(o=1;o<i;++o)l[o]=l[o-1]+a[o-1]<<1;s=new fn(1<<i);var h=15-i;for(o=0;o<n;++o)if(e[o])for(var u=o<<4|e[o],c=i-e[o],d=l[e[o]-1]++<<c,p=d|(1<<c)-1;d<=p;++d)s[ff[d]>>h]=u;return s},fy=new fr(288);for(fm=0;fm<144;++fm)fy[fm]=8;for(fm=144;fm<256;++fm)fy[fm]=9;for(fm=256;fm<280;++fm)fy[fm]=7;for(fm=280;fm<288;++fm)fy[fm]=8;var fv=new fr(32);for(fm=0;fm<32;++fm)fv[fm]=5;var fx=f_(fy,9),fb=f_(fv,5),fw=function(e){for(var i=e[0],r=1;r<e.length;++r)e[r]>i&&(i=e[r]);return i},fT=function(e,i,r){var n=i/8|0;return(e[n]|e[n+1]<<8)>>(7&i)&r},fS=function(e,i){var r=i/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&i)},fE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fI=function(e,i,r){var n=Error(i||fE[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,fI),!r)throw n;return n},fC=new fr(0),fA="undefined"!=typeof TextDecoder&&new TextDecoder;try{fA.decode(fC,{stream:!0})}catch(e){}let fR={gzip_data:"gzip"};class fM extends Error{constructor(e){super(e),this.name="MRTError"}}let fP={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},fO={uint32:1,uint16:2,uint8:4},fk={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class fL{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let i=this.layers[e];if(!i)throw new fM(`Layer '${e}' not found`);return i}getHeaderLength(e){let i=new Uint8Array(e),r=new DataView(e);if(13!==i[0])throw new fM("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),r=this.getHeaderLength(e);if(i.length<r)throw new fM(`Expected header with length >= ${r} but got buffer of length ${i.length}`);let n=new q(i.subarray(0,r)).readFields(p4,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new fM(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);for(let e of(this.x=n.x,this.y=n.y,this.z=n.z,n.layers))this.layers[e.name]=new fD(e,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],r=this.getLayer(e.layerName);for(let n of e.blockIndices){let o=r.dataIndex[n],a=o.firstByte-e.firstByte,s=o.lastByte-e.firstByte;if(r._blocksInProgress.has(n))continue;let l={layerName:r.name,firstByte:a,lastByte:s,pixelFormat:r.pixelFormat,blockIndex:n,blockShape:[o.bands.length].concat(r.bandShape),buffer:r.buffer,codec:o.codec.codec,filters:o.filters.map(e=>e.filter)};r._blocksInProgress.add(n),i.push(l)}return new fz(i,()=>{i.forEach(e=>r._blocksInProgress.delete(e.blockIndex))},(e,n)=>{if(i.forEach(e=>r._blocksInProgress.delete(e.blockIndex)),e)throw e;n.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class fD{constructor({version:e,name:i,units:r,tileSize:n,pixelFormat:o,buffer:a,dataIndex:s},l){if(this.version=e,1!==this.version)throw new fM(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=r,this.tileSize=n,this.buffer=a,this.pixelFormat=fP[o],this.dataIndex=s,this.bandShape=[n+2*a,n+2*a,fO[this.pixelFormat]],this._decodedBlocks=new pH(l?l.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return fO[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[r,n]of this.dataIndex.entries()){for(let[o,a]of n.bands.entries())if(a===e)return{bandIndex:i+o,blockIndex:r,blockBandIndex:o};i+=n.bands.length}break;case"number":for(let[r,n]of this.dataIndex.entries()){if(e>=i&&e<i+n.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-i};i+=n.bands.length}break;default:throw new fM(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,r=-1/0,n=[],o=new Set;for(let a of e){let{blockIndex:e}=this.getBlockForBand(a);if(e<0)throw new fM(`Invalid band: ${JSON.stringify(a)}`);let s=this.dataIndex[e];n.includes(e)||n.push(e),o.add(e),i=Math.min(i,s.firstByte),r=Math.max(r,s.lastByte)}if(o.size>this.cacheSize)throw new fM(`Number of blocks to decode (${o.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:r,blockIndices:n}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:r}=this.getBlockForBand(e);if(i<0)throw new fM(`Band not found: ${JSON.stringify(e)}`);let n=this._decodedBlocks.get(i.toString());if(!n)throw new fM(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let o=this.dataIndex[i],a=this.bandShape.reduce((e,i)=>e*i,1),s=r*a,l=n.subarray(s,s+a);return{data:l,bytes:new Uint8Array(l.buffer).subarray(l.byteOffset,l.byteOffset+l.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:o.offset,scale:o.scale}}}fL.setPbf=function(e){q=e};class fz{constructor(e,i,r){this.tasks=e,this._onCancel=i,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}fL.performDecoding=function(e,i){let r=new Uint8Array(e);return Promise.all(i.tasks.map(e=>{let{layerName:i,firstByte:n,lastByte:o,pixelFormat:a,blockShape:s,blockIndex:l,filters:h,codec:u}=e,c=r.subarray(n,o+1),d=new Uint32Array(s[0]*s[1]*s[2]);if("gzip_data"!==u)throw new fM(`Unhandled codec: ${u}`);return(function(e,i){var r,n;if(!globalThis.DecompressionStream&&"gzip_data"===i)return Promise.resolve(((n=function(e){31==e[0]&&139==e[1]&&8==e[2]||fI(6,"invalid gzip data");var i=e[3],r=10;4&i&&(r+=2+(e[10]|e[11]<<8));for(var n=(i>>3&1)+(i>>4&1);n>0;n-=!e[r++]);return r+(2&i)}(e))+8>e.length&&fI(6,"invalid gzip data"),function(e,i,r,n){var o=e.length;if(!o||i.f&&!i.l)return r||new fr(0);var a=!r,s=a||2!=i.i,l=i.i;a&&(r=new fr(3*o));var h,u,c=function(e){var i=r.length;if(e>i){var n=new fr(Math.max(2*i,e));n.set(r),r=n}},d=i.f||0,p=i.p||0,f=i.b||0,m=i.l,g=i.d,_=i.m,y=i.n,v=8*o;do{if(!m){d=fT(e,p,1);var x=fT(e,p+1,3);if(p+=3,!x){var b=e[(O=4+((p+7)/8|0))-4]|e[O-3]<<8,w=O+b;if(w>o){l&&fI(0);break}s&&c(f+b),r.set(e.subarray(O,w),f),i.b=f+=b,i.p=p=8*w,i.f=d;continue}if(1==x)m=fx,g=fb,_=9,y=5;else if(2==x){var T=fT(e,p,31)+257,S=fT(e,p+10,15)+4,E=T+fT(e,p+5,31)+1;p+=14;for(var I=new fr(E),C=new fr(19),A=0;A<S;++A)C[fl[A]]=fT(e,p+3*A,7);p+=3*S;var R=fw(C),M=(1<<R)-1,P=f_(C,R);for(A=0;A<E;){var O,k=P[fT(e,p,M)];if(p+=15&k,(O=k>>4)<16)I[A++]=O;else{var L=0,D=0;for(16==O?(D=3+fT(e,p,3),p+=2,L=I[A-1]):17==O?(D=3+fT(e,p,7),p+=3):18==O&&(D=11+fT(e,p,127),p+=7);D--;)I[A++]=L}}var z=I.subarray(0,T),F=I.subarray(T);_=fw(z),y=fw(F),m=f_(z,_),g=f_(F,y)}else fI(1);if(p>v){l&&fI(0);break}}s&&c(f+131072);for(var B=(1<<_)-1,N=(1<<y)-1,j=p;;j=p){var V=(L=m[fS(e,p)&B])>>4;if((p+=15&L)>v){l&&fI(0);break}if(L||fI(2),V<256)r[f++]=V;else{if(256==V){j=p,m=null;break}var U=V-254;V>264&&(U=fT(e,p,(1<<($=fa[A=V-257]))-1)+fc[A],p+=$);var G=g[fS(e,p)&N],q=G>>4;if(G||fI(3),p+=15&G,F=fp[q],q>3){var $=fs[q];F+=fS(e,p)&(1<<$)-1,p+=$}if(p>v){l&&fI(0);break}s&&c(f+131072);var H=f+U;if(f<F){var Z=0-F,W=Math.min(F,H);for(Z+f<0&&fI(3);f<W;++f)r[f]=(void 0)[Z+f]}for(;f<H;++f)r[f]=r[f-F]}}i.l=m,i.p=j,i.b=f,i.f=d,m&&(d=1,i.m=_,i.d=g,i.n=y)}while(!d)return f!=r.length&&a?(h=r,(null==(u=f)||u>h.length)&&(u=h.length),new fr(h.subarray(0,u))):r.subarray(0,f)}(e.subarray(n,-8),{i:2},new fr((e[(r=e.length)-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0))));let o=fR[i];if(!o)throw Error(`Unhandled codec: ${i}`);let a=new globalThis.DecompressionStream(o);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then(e=>new Uint8Array(e))})(c,u).then(e=>{var i;return i=new q(e),i.readFields(ft,d),new fk[a](d.buffer)}).then(e=>{for(let i=h.length-1;i>=0;i--)switch(h[i]){case"delta_filter":!function(e,i){if(4!==i.length)throw Error(`Expected data of dimension 4 but got ${i.length}.`);let r=i[3];for(let n=2;n>=1;n--){let o=+(1===n),a=+(2===n);for(let n=0;n<i[0];n++){let s=i[1]*n;for(let n=o;n<i[1];n++){let o=i[2]*(n+s);for(let n=a;n<i[2];n++){let a=i[3]*(n+o);for(let n=0;n<i[3];n++){let i=a+n;e[i]+=e[i-r]}}}}r*=i[n]}}(e,s);break;case"zigzag_filter":var r=e;for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);break;case"bitshuffle_filter":!function(e,i){switch(i){case"uint32":return;case"uint16":for(let i=0;i<e.length;i+=2){let r=e[i],n=e[i+1];e[i]=(240&r)>>4|(61440&r)>>8|(240&n)<<4|61440&n,e[i+1]=15&r|(3840&r)>>4|(15&n)<<8|(3840&n)<<4}return;case"uint8":for(let i=0;i<e.length;i+=4){let r=e[i],n=e[i+1],o=e[i+2],a=e[i+3];e[i+0]=(192&r)>>6|(192&n)>>4|(192&o)>>2|192&a,e[i+1]=(48&r)>>4|(48&n)>>2|48&o|(48&a)<<2,e[i+2]=(12&r)>>2|12&n|(12&o)<<2|(12&a)<<4,e[i+3]=3&r|(3&n)<<2|(3&o)<<4|(3&a)<<6}return;default:throw Error(`Invalid pixel format, "${i}"`)}}(e,a);break;default:throw new fM(`Unhandled filter "${h[i]}"`)}return{layerName:i,blockIndex:l,data:e}}).catch(e=>{throw e})}))},nX(fz,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),nX(fL,"MapboxRasterTile"),nX(fD,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let fF,fB,fN,fj,fV,fU=null;function fG(){return t_(self)&&self.worker.dracoUrl?self.worker.dracoUrl:fB||tI.DRACO_URL}function fq(){if(t_(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fj)return fj;let e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fj=WebAssembly.validate(e)?tI.MESHOPT_SIMD_URL:tI.MESHOPT_URL}let f$={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fH={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},fZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fW(e,i,r){let n=r.json.bufferViews.length,o=r.buffers.length;i.bufferView=n,r.json.bufferViews[n]={buffer:o,byteLength:e.byteLength},r.buffers[o]=e}let fX="KHR_draco_mesh_compression",fY="EXT_meshopt_compression",fK=new TextDecoder("utf8");function fJ(e,i){return new URL(e,i).href}function fQ(e,i){let r=e.json.bufferViews[i];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function f0(e,i=0,r){let n={json:null,images:[],buffers:[]};if(0x46546c67===new Uint32Array(e,i,1)[0]){let r=new Uint32Array(e,i),o=2,a=(r[o++]>>2)-3,s=r[o++]>>2;if(o++,n.json=JSON.parse(fK.decode(r.subarray(o,o+s))),(o+=s)<a){let a=r[o++],s=i+(++o<<2);n.buffers[0]=e.slice(s,s+a)}}else n.json=JSON.parse(fK.decode(new Uint8Array(e,i)));let{buffers:o,images:a,meshes:s,extensionsUsed:l,bufferViews:h}=n.json,u=Promise.resolve();if(o){let e=[];for(let i=0;i<o.length;i++){let a=o[i];a.uri?e.push(function(e,i,r,n){return fetch(fJ(e.uri,n)).then(e=>e.arrayBuffer()).then(e=>{i.buffers[r]=e})}(a,n,i,r)):n.buffers[i]||(n.buffers[i]=null)}u=Promise.all(e)}return u.then(()=>{let e=[],i=l&&l.includes(fX),o=l&&l.includes(fY);if(i&&e.push(function(){if(!fN)return null!=fF?fF:(fF=function(e){let i,r=null;function n(){i=new Uint8Array(r.buffer)}function o(){throw Error("Unexpected Draco error.")}let a={a:{a:o,d:function(e,r,n){return i.copyWithin(e,r,r+n)},c:function(e){let o=i.length,a=Math.ceil((Math.max(e>>>0,Math.ceil(1.2*o))-o)/65536);try{return r.grow(a),n(),!0}catch(e){return!1}},b:o}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,a):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,a))).then(e=>{let o,a,s,l,{Rb:h,Qb:u,P:c,T:d,X:p,Ja:f,La:m,Qa:g,Va:_,Wa:y,eb:v,jb:x,f:b,e:w,yb:T,zb:S,Ab:E,Bb:I,Db:C,Gb:A}=e.instance.exports;r=w;let R=(o=0,a=0,s=0,l=0,e=>{s&&(h(l),h(o),a+=s,s=o=0),o||(a+=128,o=u(a));let r=e.length+7&-8,n=o;r>=a&&(s=r,n=l=u(r));for(let r=0;r<e.length;r++)i[n+r]=e[r];return n});return n(),b(),{memory:w,_free:h,_malloc:u,Mesh:class{constructor(){this.ptr=c()}destroy(){d(this.ptr)}},Decoder:class{constructor(){this.ptr=f()}destroy(){x(this.ptr)}DecodeArrayToMesh(e,i,r){let n=R(e);return!!p(m(this.ptr,n,i,r.ptr))}GetAttributeByUniqueId(e,i){return{ptr:g(this.ptr,e.ptr,i)}}GetTrianglesUInt16Array(e,i,r){_(this.ptr,e.ptr,i,r)}GetTrianglesUInt32Array(e,i,r){y(this.ptr,e.ptr,i,r)}GetAttributeDataArrayForAllPoints(e,i,r,n,o){v(this.ptr,e.ptr,i.ptr,r,n,o)}},DT_INT8:T(),DT_UINT8:S(),DT_INT16:E(),DT_UINT16:I(),DT_UINT32:C(),DT_FLOAT32:A()}})}(fetch(fG()))).then(e=>{fN=e,fF=void 0})}()),o&&e.push(function(){if(fV)return;let e=function(e){let i,r=WebAssembly.instantiateStreaming(e,{}).then(e=>{(i=e.instance).exports.__wasm_call_ctors()}),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(e,r,a,s,l,h){!function(e,i,r,n,o,a,s){let l=e.exports.sbrk,h=n+3&-4,u=l(h*o),c=l(a.length),d=new Uint8Array(e.exports.memory.buffer);d.set(a,c);let p=i(u,n,o,c,a.length);if(0===p&&s&&s(u,h,o),r.set(d.subarray(u,u+n*o)),l(u-l(0)),0!==p)throw Error(`Malformed buffer data: ${p}`)}(i,i.exports[o[l]],e,r,a,s,i.exports[n[h]])}}}(fetch(fq()));return e.ready.then(()=>{fV=e})}()),a)for(let i=0;i<a.length;i++)e.push(function(e,i,r,n){return e.uri?fetch(fJ(e.uri,n)).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{i.images[r]=e}):void 0!==e.bufferView?createImageBitmap(new Blob([fQ(i,e.bufferView)],{type:e.mimeType})).then(e=>{i.images[r]=e}):void 0}(a[i],n,i,r));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(i&&s)for(let{primitives:e}of s)for(let i of e)!function(e,i){let r=e.extensions&&e.extensions[fX];if(!r)return;let n=new fN.Decoder,o=fQ(i,r.bufferView),a=new fN.Mesh;if(!n.DecodeArrayToMesh(o,o.byteLength,a))throw Error("Failed to decode Draco mesh");let s=i.json.accessors[e.indices],l=f$[s.componentType],h=s.count*l.BYTES_PER_ELEMENT,u=fN._malloc(h);for(let o of(l===Uint16Array?n.GetTrianglesUInt16Array(a,h,u):n.GetTrianglesUInt32Array(a,h,u),fW(fN.memory.buffer.slice(u,u+h),s,i),fN._free(u),Object.keys(r.attributes))){let s=n.GetAttributeByUniqueId(a,r.attributes[o]),l=i.json.accessors[e.attributes[o]],h=fH[l.componentType],u=l.count*fZ[l.type]*f$[l.componentType].BYTES_PER_ELEMENT,c=fN._malloc(u);n.GetAttributeDataArrayForAllPoints(a,s,fN[h],u,c),fW(fN.memory.buffer.slice(c,c+u),l,i),fN._free(c)}n.destroy(),a.destroy(),delete e.extensions[fX]}(i,n);if(o&&s&&h)for(let e of h)!function(e,i){if(!e.extensions||!e.extensions[fY])return;let r=e.extensions[fY],n=new Uint8Array(i.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),o=new Uint8Array(r.count*r.byteStride);fV.decodeGltfBuffer(o,r.count,r.byteStride,n,r.mode,r.filter),e.buffer=i.buffers.length,e.byteOffset=0,i.buffers[e.buffer]=o.buffer,delete e.extensions[fY]}(e,n);return n})})}function f1(e,i){let r=e.json.bufferViews[i.bufferView],n=f$[i.componentType];return new n(e.buffers[r.buffer],(i.byteOffset||0)+(r.byteOffset||0),i.count*(r.byteStride&&r.byteStride!==fZ[i.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:fZ[i.type]))}function f2(e,i,r,n){let o=f$[i.componentType],a=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(o),s=e.json.bufferViews[i.bufferView],l=s.byteStride?s.byteStride/o.BYTES_PER_ELEMENT:fZ[i.type],h=r.float32,u=h.length/r.capacity;for(let e=0,r=0;e<i.count*l;e+=l,r+=u)for(let i=0;i<u;i++)h[r+i]=n[e+i]*a;r._trim()}function f3(e){let i=function(e,i){let r=[],n=WebGL2RenderingContext;if(e.json.textures)for(let o of e.json.textures){let a={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==o.sampler&&Object.assign(a,e.json.samplers[o.sampler]),r.push({image:i[o.source],sampler:a,uploaded:!1})}return r}(e,e.images),r=function(e,i){let r=[];for(let n of e.json.meshes){let o=[];for(let r of n.primitives)o.push(function(e,i,r){let n=e.indices,o=e.attributes,a={};a.indexArray=new o9;let s=i.json.accessors[n],l=s.count/3;a.indexArray.reserve(l);let h=f1(i,s);for(let e=0;e<l;e++)a.indexArray.emplaceBack(h[3*e],h[3*e+1],h[3*e+2]);a.indexArray._trim(),a.vertexArray=new oX;let u=i.json.accessors[o.POSITION];a.vertexArray.reserve(u.count);let c=f1(i,u);for(let e=0;e<u.count;e++)a.vertexArray.emplaceBack(c[3*e],c[3*e+1],c[3*e+2]);if(a.vertexArray._trim(),a.aabb=new s0(u.min,u.max),a.centroid=function(e,i){let r=[0,0,0],n=e.length;if(n>0){for(let o=0;o<n;o++){let n=3*e[o];r[0]+=i[n],r[1]+=i[n+1],r[2]+=i[n+2]}r[0]/=n,r[1]/=n,r[2]/=n}return r}(h,c),void 0!==o.COLOR_0){let e=i.json.accessors[o.COLOR_0],r=fZ[e.type],n=f1(i,e);a.colorArray=3===r?new oX:new o1,a.colorArray.resize(e.count),f2(i,e,a.colorArray,n)}if(void 0!==o.NORMAL){a.normalArray=new oX;let e=i.json.accessors[o.NORMAL];a.normalArray.resize(e.count);let r=f1(i,e);f2(i,e,a.normalArray,r)}if(void 0!==o.TEXCOORD_0&&r.length>0){a.texcoordArray=new ao;let e=i.json.accessors[o.TEXCOORD_0];a.texcoordArray.resize(e.count);let r=f1(i,e);f2(i,e,a.texcoordArray,r)}if(void 0!==o._FEATURE_ID_RGBA4444){let e=i.json.accessors[o._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=f1(i,e))}void 0!==o._FEATURE_RGBA4444&&(a.featureData=new Uint32Array(f1(i,i.json.accessors[o._FEATURE_RGBA4444]).buffer));let d=e.material;return a.material=function(e,i){let{emissiveFactor:r=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:o=.5,normalTexture:a,occlusionTexture:s,emissiveTexture:l,doubleSided:h}=e,{baseColorFactor:u=[1,1,1,1],metallicFactor:c=1,roughnessFactor:d=1,baseColorTexture:p,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{},m=s?i[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&m){let e=s.extensions.KHR_texture_transform;m.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new is(...u),metallicFactor:c,roughnessFactor:d,baseColorTexture:p?i[p.index]:void 0,metallicRoughnessTexture:f?i[f.index]:void 0},doubleSided:h,emissiveFactor:r,alphaMode:n,alphaCutoff:o,normalTexture:a?i[a.index]:void 0,occlusionTexture:m,emissionTexture:l?i[l.index]:void 0,defined:void 0===e.defined}}(void 0!==d?i.json.materials[d]:{defined:!1},r),a}(r,e,i));r.push(o)}return r}(e,i),{scenes:n,scene:o,nodes:a}=e.json,s=n?n[o||0].nodes:a,l=[];for(let i of s)l.push(function e(i,r,n){var o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C;let{matrix:A,rotation:R,translation:M,scale:P,mesh:O,extras:k,children:L}=i,D={};if(D.matrix=A||(o=[],a=R||[0,0,0,1],s=M||[0,0,0],l=P||[1,1,1],h=a[0],u=a[1],c=a[2],d=a[3],p=h+h,f=u+u,m=c+c,g=h*p,_=h*f,y=h*m,v=u*f,x=u*m,b=c*m,w=d*p,T=d*f,S=d*m,E=l[0],I=l[1],C=l[2],o[0]=(1-(v+b))*E,o[1]=(_+S)*E,o[2]=(y-T)*E,o[3]=0,o[4]=(_-S)*I,o[5]=(1-(g+b))*I,o[6]=(x+w)*I,o[7]=0,o[8]=(y+T)*C,o[9]=(x-w)*C,o[10]=(1-(g+v))*C,o[11]=0,o[12]=s[0],o[13]=s[1],o[14]=s[2],o[15]=1,o),void 0!==O){D.meshes=n[O];let e=D.anchor=[0,0];for(let i of D.meshes){let{min:r,max:n}=i.aabb;e[0]+=r[0]+n[0],e[1]+=r[1]+n[1]}e[0]=Math.floor(e[0]/D.meshes.length/2),e[1]=Math.floor(e[1]/D.meshes.length/2)}if(k&&(k.id&&(D.id=k.id),k.lights&&(D.lights=function(e){if(!e.length)return[];let i=function(e){let i=atob(e),r=new Uint8Array(i.length);for(let e=0;e<i.length;e++)r[e]=i.codePointAt(e);return r}(e),r=[],n=i.length/24,o=new Uint16Array(i.buffer),a=new Float32Array(i.buffer);for(let e=0;e<n;e++){let i=o[2*e*6]/30,n=o[2*e*6+1]/30,s=o[2*e*6+10]/100,l=a[6*e+1],h=a[6*e+2],u=a[6*e+3],c=a[6*e+4],d=u-l,p=c-h,f=Math.hypot(d,p);r.push({pos:[l+.5*d,h+.5*p,n],normal:[p/f,-d/f,0],width:f,height:i,depth:s,points:[l,h,u,c]})}return r}(k.lights))),L){let i=[];for(let o of L)i.push(e(r.json.nodes[o],r,n));D.children=i}return D}(a[i],e,r));return function(e,i,r){let n={},o=new Set;for(let a=0;a<e.length;a++){let e=r[i[a]];if(!e.extras)continue;let s=e.extras["mapbox:footprint:version"],l=e.extras["mapbox:footprint:id"];(s||l)&&o.add(a),"1.0.0"===s&&l&&(n[l]=a)}for(let a=0;a<e.length;a++){if(o.has(a))continue;let s=e[a],l=r[i[a]];if(!l.extras)continue;let h=null;s.id in n&&(h=function(e,i){let r=[],n=[],o=0,a=[];for(let s of e){o=r.length;let e=s.vertexArray.float32,l=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)a[0]=e[3*n+0],a[1]=e[3*n+1],a[2]=e[3*n+2],eI(a,a,i),r.push(new e3(a[0],a[1]));for(let e=0;e<3*s.indexArray.length;e++)n.push(l[e]+o)}if(n.length%3!=0)return null;for(let e=0;e<n.length;e+=3){let i=r[n[e+0]],o=r[n[e+1]],a=r[n[e+2]];(i.x-o.x)*(a.y-o.y)-(a.x-o.x)*(i.y-o.y)>0&&([n[e+1],n[e+2]]=[n[e+2],n[e+1]])}return{vertices:r,indices:n}}(e[n[s.id]].meshes,s.matrix)),h||(h=function(e){if(!e.extras||!e.extras.ground)return null;let i=e.extras.ground;if(!i||!Array.isArray(i)||0===i.length)return null;let r=i[0];if(!r||!Array.isArray(r)||0===r.length)return null;let n=[];for(let e of r){if(!Array.isArray(e)||2!==e.length)continue;let i=e[0],r=e[1];"number"==typeof i&&"number"==typeof r&&n.push(new e3(i,r))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let o=0;for(let e=0;e<n.length;e++){let i=n[e],r=n[(e+1)%n.length],a=n[(e+2)%n.length];o+=(i.x-r.x)*(a.y-r.y)-(a.x-r.x)*(i.y-r.y)}o>0&&n.reverse();let a=lk(n.flatMap(e=>[e.x,e.y]),[]);return 0===a.length?null:{vertices:n,indices:a}}(l)),h&&(s.footprint=function(e){if(0===e.vertices.length||0===e.indices.length)return null;let i=new hI(e.vertices,e.indices,8,256),[r,n]=[i.min.clone(),i.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:i,min:r,max:n}}(h))}if(o.size>0){let i=Array.from(o.values()).sort((e,i)=>e-i);for(let r=i.length-1;r>=0;r--)e.splice(i[r],1)}}(l,s,e.json.nodes),l}class f5{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let f4=["id","tile","layer","source","sourceLayer","state"];class f6{constructor(e,i,r,n,o){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=n,this.properties=e.properties,this.id=o}clone(){let e=new f6(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let i of f4)void 0!==this[i]&&(e[i]=this[i]);return e}}class f8{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new nZ(8192,16,0),this.featureIndexArray=new ab,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,r,n,o,a=0,s=0){let l=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,o,a);let h=this.grid;for(let e=0;e<i.length;e++){let r=i[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){let i=r[e];n[0]=Math.min(n[0],i.x),n[1]=Math.min(n[1],i.y),n[2]=Math.max(n[2],i.x),n[3]=Math.max(n[3],i.y)}0!==s&&(n[0]-=s,n[1]-=s,n[2]+=s,n[3]+=s),n[0]<8192&&n[1]<8192&&n[2]>=0&&n[3]>=0&&h.insert(l,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers)for(let e in this.vtLayers=new hi.VectorTile(new uY(this.rawTileData)).layers,this.sourceLayerCoder=new f5(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={},this.vtLayers)this.vtFeatures[e]=[];return this.vtLayers}query(e,i){let r,{tilespaceGeometry:n,transform:o,tileTransform:a,pixelPosMatrix:s,availableImages:l}=i;this.loadVTLayers(),this.serializedLayersCache.clear();let h=n.bufferedTilespaceBounds,u=this.grid.query(h.min.x,h.min.y,h.max.x,h.max.y,(e,i,r,o)=>sR(n.bufferedTilespaceGeometry,e,i,r,o));u.sort(f7);let c=null;o.elevation&&u.length>0&&(c=dJ.create(o.elevation,this.tileID));let d={};for(let i=0;i<u.length;i++){let h=u[i];if(h===r)continue;r=h;let p=this.featureIndexArray.get(h),f=null;this.is3DTile?this.loadMatchingModelFeature(d,p,e,n,o):this.loadMatchingFeature(d,p,e,l,(e,i,r,l=0)=>(f||(f=sg(e,this.tileID.canonical,a)),i.queryIntersectsFeature(n,e,r,f,this.z,o,s,c,l)))}return d}loadMatchingFeature(e,i,r,n,o){let{featureIndex:a,bucketIndex:s,sourceLayerIndex:l,layoutVertexArrayOffset:h}=i,u=this.bucketLayerIDs[s],c=r.layers,d=Object.keys(c);if(d.length&&!function(e,i){for(let r=0;r<e.length;r++)if(i.indexOf(e[r])>=0)return!0;return!1}(d,u))return;let p=r.sourceCache,f=this.sourceLayerCoder.decode(l),m=this.vtLayers[f].feature(a),g=this.getId(m,f);for(let i=0;i<u.length;i++){let r=u[i];if(!c[r])continue;let{styleLayer:s,targets:l}=c[r],d={};void 0!==g&&(d=p.getFeatureState(s.sourceLayer,g));let f=!o||o(m,s,d,h);if(!f)continue;let _=new f6(m,this.z,this.x,this.y,g);_.tile=this.tileID.canonical,_.state=d;let y=this.serializedLayersCache.get(r);y||((y=s.serialize()).id=r,this.serializedLayersCache.set(r,y)),_.source=y.source,_.sourceLayer=y["source-layer"],_.layer=to({},y),_.layer.paint=f9(y.paint,s.paint,m,d,n),_.layer.layout=f9(y.layout,s.layout,m,d,n);let v=!1;for(let e of l){this.updateFeatureProperties(_,e);let{filter:i}=e;if(i){if(m.properties=_.properties,i.needGeometry){let e=s_(m,!0);if(!i.filter(new os(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!i.filter(new os(this.tileID.overscaledZ),m))continue}v=!0,e.targetId&&this.addFeatureVariant(_,e)}v&&this.appendToResult(e,r,a,_,f)}}loadMatchingModelFeature(e,i,r,n,o){let a=this.bucketLayerIDs[0][0],s=r.layers;if(!s[a])return;let{styleLayer:l,targets:h}=s[a];if("model"!==l.type)return;let u=n.tile,c=i.featureIndex,d=u.getBucket(l);if(!(d&&d instanceof d3))return;let p=function(e,i,r,n){let o=e.getNodesInfo()[i];if(o.hiddenByReplacement||!o.node.meshes)return;let a=Number.MAX_VALUE,s=o.node,l=r.tile,h=n.calculatePosMatrix(l.tileID.toUnwrapped(),n.worldSize),u=o.evaluatedScale,c=0;n.elevation&&s.elevation&&(c=s.elevation*n.elevation.exaggeration()),ee(h,h,[(s.anchor?s.anchor[0]:0)*(u[0]-1),(s.anchor?s.anchor[1]:0)*(u[1]-1),c]),et(h,h,u);let d=r.queryGeometry,p=d.isPointQuery()?d.screenBounds:d.screenGeometry,f=function(e){let i=Q([],h,e.matrix);Q(i,n.expandedFarZProjMatrix,i);for(let r=0;r<e.meshes.length;++r){let o=e.meshes[r];if(r===e.lightMeshIndex)continue;let s=dO(p,n,i,o.aabb);null!=s&&(a=Math.min(s,a))}if(e.children)for(let i of e.children)f(i)};if(f(s),a===Number.MAX_VALUE)return;let m=new st(0,0);return d4(l.tileID.canonical,m,o.node.anchor[0],o.node.anchor[1]),{intersectionZ:a,position:m,feature:o.feature}}(d,c,n,o);if(!p)return;let{z:f,x:m,y:g}=u.tileID.canonical,{feature:_,intersectionZ:y,position:v}=p,x={};void 0!==_.id&&(x=r.sourceCache.getFeatureState(l.sourceLayer,_.id));let b=new f6({},f,m,g,_.id);b.tile=this.tileID.canonical,b.state=x,b.properties=_.properties,b.geometry={type:"Point",coordinates:[v.lng,v.lat]};let w=this.serializedLayersCache.get(a);w||((w=l.serialize()).id=a,this.serializedLayersCache.set(a,w)),b.source=w.source,b.sourceLayer=w["source-layer"],b.layer=to({},w);let T=!1;for(let e of h){this.updateFeatureProperties(b,e);let{filter:i}=e;if(i){if(_.properties=b.properties,i.needGeometry){if(!i.filter(new os(this.tileID.overscaledZ),_,this.tileID.canonical))continue}else if(!i.filter(new os(this.tileID.overscaledZ),_))continue}T=!0,e.targetId&&this.addFeatureVariant(b,e)}T&&this.appendToResult(e,a,c,b,y)}updateFeatureProperties(e,i,r){if(i.properties){let n={};for(let o in i.properties){let a=i.properties[o].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,r);null!=a&&(n[o]=a)}e.properties=n}}addFeatureVariant(e,i,r){let n={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(n.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(n)}appendToResult(e,i,r,n,o){let a=e[i];void 0===a&&(a=e[i]=[]),a.push({featureIndex:r,feature:n,intersectionZ:o})}lookupSymbolFeatures(e,i,r,n,o){let a={};for(let s of(this.loadVTLayers(),e))this.loadMatchingFeature(a,{bucketIndex:i,sourceLayerIndex:r,featureIndex:s,layoutVertexArrayOffset:0},n,o);return a}loadFeature(e){let{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();let n=this.sourceLayerCoder.decode(r),o=this.vtFeatures[n];if(o[i])return o[i];let a=this.vtLayers[n].feature(i);return o[i]=a,a}hasLayer(e){for(let i of this.bucketLayerIDs)for(let r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){let n=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[i];if(null!=n)if(Array.isArray(n)){if(!this.promoteIdExpression){let e=nj(n);if("success"!==e.result){let i=e.value.map(e=>`${e.key}: ${e.message}`).join(", ");return void tf(`Failed to create expression for promoteId: ${i}`)}this.promoteIdExpression=e.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new iJ),r=this.promoteIdExpression.evaluate({zoom:0},e)}else r=e.properties[n];"boolean"==typeof r&&(r=Number(r))}return r}}function f9(e,i,r,n,o){return tu(e,(e,a)=>{let s=i instanceof om?i.get(a):null;return s&&s.evaluate?s.evaluate(r,n,void 0,o):s})}function f7(e,i){return i-e}nX(f8,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let me=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mt{static from(e){if(!(e instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[i,r]=new Uint8Array(e,0,2);if(219!==i)throw Error("Data does not appear to be in a KDBush format.");let n=r>>4;if(1!==n)throw Error(`Got v${n} data when expected v1.`);let o=me[15&r];if(!o)throw Error("Unrecognized array type.");let[a]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new mt(s,a,o,e)}constructor(e,i=64,r=Float64Array,n){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let o=me.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-s%8)%8;if(o<0)throw Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+s+l),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+o]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return function e(i,r,n,o,a,s){if(a-o<=n)return;let l=o+a>>1;(function e(i,r,n,o,a,s){for(;a>o;){if(a-o>600){let l=a-o+1,h=n-o+1,u=Math.log(l),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(l-c)/l)*(h-l/2<0?-1:1);e(i,r,n,Math.max(o,Math.floor(n-h*c/l+d)),Math.min(a,Math.floor(n+(l-h)*c/l+d)),s)}let l=r[2*n+s],h=o,u=a;for(mi(i,r,o,n),r[2*a+s]>l&&mi(i,r,o,a);h<u;){for(mi(i,r,h,u),h++,u--;r[2*h+s]<l;)h++;for(;r[2*u+s]>l;)u--}r[2*o+s]===l?mi(i,r,o,u):mi(i,r,++u,a),u<=n&&(o=u+1),n<=u&&(a=u-1)}})(i,r,l,o,a,s),e(i,r,n,o,l-1,1-s),e(i,r,n,l+1,a,1-s)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,n){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:o,coords:a,nodeSize:s}=this,l=[0,o.length-1,0],h=[];for(;l.length;){let u=l.pop()||0,c=l.pop()||0,d=l.pop()||0;if(c-d<=s){for(let s=d;s<=c;s++){let l=a[2*s],u=a[2*s+1];l>=e&&l<=r&&u>=i&&u<=n&&h.push(o[s])}continue}let p=d+c>>1,f=a[2*p],m=a[2*p+1];f>=e&&f<=r&&m>=i&&m<=n&&h.push(o[p]),(0===u?e<=f:i<=m)&&(l.push(d),l.push(p-1),l.push(1-u)),(0===u?r>=f:n>=m)&&(l.push(p+1),l.push(c),l.push(1-u))}return h}within(e,i,r){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:n,coords:o,nodeSize:a}=this,s=[0,n.length-1,0],l=[],h=r*r;for(;s.length;){let u=s.pop()||0,c=s.pop()||0,d=s.pop()||0;if(c-d<=a){for(let r=d;r<=c;r++)mn(o[2*r],o[2*r+1],e,i)<=h&&l.push(n[r]);continue}let p=d+c>>1,f=o[2*p],m=o[2*p+1];mn(f,m,e,i)<=h&&l.push(n[p]),(0===u?e-r<=f:i-r<=m)&&(s.push(d),s.push(p-1),s.push(1-u)),(0===u?e+r>=f:i+r>=m)&&(s.push(p+1),s.push(c),s.push(1-u))}return l}}function mi(e,i,r,n){mr(e,r,n),mr(i,2*r,2*n),mr(i,2*r+1,2*n+1)}function mr(e,i,r){let n=e[i];e[i]=e[r],e[r]=n}function mn(e,i,r,n){let o=e-r,a=i-n;return o*o+a*a}e.$=iQ,e.A=t8,e.B=iz,e.C=oO,e.D=pr,e.E=it,e.F=2,e.G=cf,e.H=cp,e.I=ii,e.J=class extends dV{},e.K=iW,e.L=ip,e.M=ob,e.N=nM,e.O=nC,e.P=e3,e.Q=nR,e.R=tZ,e.S=nN,e.T=dp,e.U=ow,e.V=dV,e.W=nG,e.X=nj,e.Y=rF,e.Z=rN,e._=rz,e.a=function(e){return tI.API_CDN_URL_REGEX.test(e)},e.a$=ts,e.a0=ia,e.a1=oT,e.a2=nP,e.a3=nA,e.a4=function(e){let i=e.value,r=[];if(!i)return r;let n=iW(i);return"string"!==n?r=r.concat([new dV(e.key,i,`string expected, "${n}" found`)]):(dU(i,!0)||(r=r.concat([new dV(e.key,i,`invalid url "${i}"`)])),r)},e.a5=ox,e.a6=ou,e.a7=ov,e.a8=og,e.a9=class{constructor(e){this.specification=e}possiblyEvaluate(e,i){return tg(e.expression.evaluate(i))}interpolate(e,i,r){return{x:ih(e.x,i.x,r),y:ih(e.y,i.y,r),z:ih(e.z,i.z,r),azimuthal:ih(e.azimuthal,i.azimuthal,r),polar:ih(e.polar,i.polar,r)}}},e.aA=ek,e.aB=sA,e.aC=sf,e.aD=tt,e.aE=a4,e.aF=function(e,i){let r={};for(let n=0;n<i.length;n++){let o=i[n];o in e&&(r[o]=e[o])}return r},e.aG=si,e.aH=so,e.aI=class{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,n){let o=this.entries[e]=this.entries[e]||{callbacks:[]};if(o.result){let[e,r]=o.result;return this.scheduler?this.scheduler.add(()=>{n(e,r)},i):n(e,r),()=>{}}return o.callbacks.push(n),o.cancel||(o.cancel=r((r,n)=>{for(let e of(o.result=[r,n],o.callbacks))this.scheduler?this.scheduler.add(()=>{e(r,n)},i):e(r,n);setTimeout(()=>delete this.entries[e],3e3)})),()=>{o.result||(o.callbacks=o.callbacks.filter(e=>e!==n),o.callbacks.length||(o.cancel(),delete this.entries[e]))}}},e.aJ=function(e,i,r){let n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},i=>{let n=tK(e.request,(e,n,o,a)=>{e?i(e):n&&i(null,{vectorTile:r?void 0:new hi.VectorTile(new uY(n)),rawData:n,cacheControl:o,expires:a})});return()=>{n.cancel(),i()}},i)},e.aK=function(e){++tN>tD&&(e.getActor().send("enforceCacheSizeLimit",tL),tN=0)},e.aL=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.aM=sj,e.aN=dv,e.aO=dx,e.aP=dy,e.aQ=function(e,i){let r=document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let i=0;i<e.length;i++){let n=document.createElement("source");(function(e){let i=document.createElement("a");return i.href=e,i.protocol===location.protocol&&i.host===location.host})(e[i])||(r.crossOrigin="Anonymous"),n.src=e[i],r.appendChild(n)}return{cancel:()=>{}}},e.aR=df,e.aS=function(e){return fetch(e).then(e=>e.arrayBuffer()).then(i=>f0(i,0,e))},e.aT=f3,e.aU=class{constructor(e,i,r,n){this.id=e,this.position=null!=i?new st(i[0],i[1]):new st(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new s0([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(Q(e.matrix,i,e.matrix),e.meshes)for(let i of e.meshes){let r=s0.applyTransformFast(i.aabb,e.matrix);this.aabb.encapsulate(r)}if(e.children)for(let i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){let e=K([]);for(let i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,r,n,o,a,s=!1){dZ(this.matrix,this,e.transform,this.position,i,r,n,o,a,s)}upload(e){if(!this.uploaded){for(let i of this.nodes)dX(i,e);for(let e of this.nodes)dY(e);this.uploaded=!0}}destroy(){for(let e of this.nodes)dK(e)}},e.aV=th,e.aW=cU,e.aX=sa,e.aY=ss,e.aZ=oG,e.a_=o9,e.aa=os,e.ab=nU,e.ac=sp,e.ad=eI,e.ae=eu,e.af=ti,e.ag=om,e.ah=lu,e.ai=ih,e.aj=8192,e.ak=iu,e.al=function(e){return e*e4},e.am=is,e.an=class{constructor(e){this.specification=e}possiblyEvaluate(e,i){return function([e,i]){let r=tg([1,e,i]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(i))}interpolate(e,i,r){return{x:ih(e.x,i.x,r),y:ih(e.y,i.y,r),z:ih(e.z,i.z,r)}}},e.ao=function(e,i,r=0,n=!0){let o=new e3(r,r),a=e.sub(o),s=i.add(o),l=[a,new e3(s.x,a.y),s,new e3(a.x,s.y)];return n&&l.push(a.clone()),l},e.ap=function(e,i){let r=[];for(let n=0;n<e.length;n++){let o=tr(n-1,-1,e.length-1),a=tr(n+1,-1,e.length-1),s=e[n],l=e[a],h=e[o].sub(s).unit(),u=l.sub(s).unit(),c=u.angleWithSep(h.x,h.y),d=h.add(u).unit().mult(-1*i/Math.sin(c/2));r.push(s.add(d))}return r},e.aq=cG,e.ar=sR,e.as=function(e,i,r=0){return ec(((i.x-r)*e.scale-e.x)*8192,(i.y*e.scale-e.y)*8192,sl(i.z,i.y))},e.at=ep,e.au=ew,e.av=sZ,e.aw=uC,e.ax=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(let a of e)i=Math.min(i,a.x),r=Math.min(r,a.y),n=Math.max(n,a.x),o=Math.max(o,a.y);return{min:new e3(i,r),max:new e3(n,o)}},e.ay=sn,e.az=Q,e.b=function(e){return tI.API_FONTS_REGEX.test(e)},e.b$=e_,e.b0=ap,e.b1=da,e.b2=function(){oa.isLoading()||oa.isLoaded()||"deferred"!==on()||oo()},e.b3=oS,e.b4=s_,e.b5=f6,e.b6=ty,e.b7=uE,e.b8=hE,e.b9=sg,e.bA=function(e,i){let{x:r,y:n}=e.point,o=lh(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Q(o,o,la(s6(i)))},e.bB=H,e.bC=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bD=function(e,i){return Math.hypot(i[0]-e[0],i[1]-e[1],i[2]-e[2])},e.bE=eT,e.bF=ey,e.bG=eS,e.bH=cl,e.bI=u0,e.bJ=cs,e.bK=function(e,i,r,n,o){let a=5*i+2;e.float32[a+0]=r,e.float32[a+1]=n,e.float32[a+2]=o},e.bL=di,e.bM=uc,e.bN=sb,e.bO=24,e.bP=hF,e.bQ=dj,e.bR=hq,e.bS=h$,e.bT=cz,e.bU=cM,e.bV=u7,e.bW=mt,e.bX=tr,e.bY=eD,e.bZ=function(e,i,r){r*=.5;var n=i[0],o=i[1],a=i[2],s=i[3],l=Math.sin(r),h=Math.cos(r);return e[0]=n*h+o*l,e[1]=o*h-n*l,e[2]=a*h+s*l,e[3]=s*h-a*l,e},e.b_=ez,e.ba=oV,e.bb=as,e.bc=s$,e.bd=aC,e.be=lk,e.bf=du,e.bg=function(e,i){let r=lu(i.zoom);if(0===r)return s6(e);let n=le(e),o=lt(n),a=sn(n.getWest())*i.worldSize,s=sn(n.getEast())*i.worldSize,l=so(n.getNorth())*i.worldSize,h=so(n.getSouth())*i.worldSize,u=[a,l,0],c=[s,l,0],d=[a,h,0],p=[s,h,0],f=J([],i.globeMatrix);return eI(u,u,f),eI(c,c,f),eI(d,d,f),eI(p,p,f),o[0]=s8(o[0],d,r),o[1]=s8(o[1],p,r),o[2]=s8(o[2],c,r),o[3]=s8(o[3],u,r),s0.fromPoints(o)},e.bh=lo,e.bi=J,e.bj=li,e.bk=s8,e.bl=oU,e.bm=sq,e.bn=eo,e.bo=ee,e.bp=fL,e.bq=uY,e.br=tK,e.bs=function(e,i){let r=[];for(let n in e)n in i||r.push(n);return r},e.bt=tn,e.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.bv=e5,e.bw=function(e){var i=new $(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},e.bx=K,e.by=en,e.bz=Y,e.c=tA,e.c$=function(e){return e({pluginStatus:n7,pluginURL:oe}),or.on("pluginStateChange",e),e},e.c0=eu,e.c1=tx,e.c2=function(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=i[3],e},e.c3=es,e.c4=function(e,i,r,n,o){var a,s=1/Math.tan(i/2);return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(e[10]=(o+n)*(a=1/(n-o)),e[14]=2*o*n*a):(e[10]=-1,e[14]=-2*n),e},e.c5=function(e,i,r,n,o,a,s){var l=1/(i-r),h=1/(n-o),u=1/(a-s);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(i+r)*l,e[13]=(o+n)*h,e[14]=(s+a)*u,e[15]=1,e},e.c6=function(e,i){return e/sr(i)},e.c7=function(e,i,r){e[4*i+0]=r[0],e[4*i+1]=r[1],e[4*i+2]=r[2],e[4*i+3]=r[3]},e.c8=aG,e.c9=aB,e.cA=dE,e.cB=Q,e.cC=dT,e.cD=function(e){let i=dT(e,!0);return H([],[i[0],i[1],i[4],i[5]])},e.cE=et,e.cF=sW,e.cG=ei,e.cH=function(e){let{x:i,y:r}=e.point,{lng:n,lat:o}=e._center;return lh(i,r,e.worldSize,n,o)},e.cI=ef,e.cJ=function(e){return e*e6},e.cK=sV,e.cL=5,e.cM=function(e,i,r){let n=0;for(let r=0;r<2;++r)e[r]>0&&(n+=(e[r]-0)*(e[r]-0)),i[r]<0&&(n+=(0-i[r])*(0-i[r]));return n},e.cN=45,e.cO=ic,e.cP=sr,e.cQ=aj,e.cR=function(e,i,r){let n=Math.sqrt(e*e+i*i+r*r),o=n>0?Math.acos(r/n)*e6:0,a=0!==e||0!==i?Math.atan2(-i,-e)*e6+90:0;return a<0&&(a+=360),[n,a,o]},e.cS=ec,e.cT=sd,e.cU=ed,e.cV=s0,e.cW=tg,e.cX=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.cY=ep,e.cZ=dU,e.c_=function(e,i){return e.readFields(pd,{icons:[]},i)},e.ca=aN,e.cb=aF,e.cc=az,e.cd=st,e.ce=c6,e.cf=function(){var e=new $(4);return $!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.cg=function(e,i,r){var n=i[0],o=i[1],a=i[2],s=i[3],l=Math.sin(r),h=Math.cos(r);return e[0]=n*h+a*l,e[1]=o*h+s*l,e[2]=-(n*l)+a*h,e[3]=-(o*l)+s*h,e},e.ch=function(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]},e.ci=eR,e.cj=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.ck=eO,e.cl=eA,e.cm=sN,e.cn=sQ,e.co=dS,e.cp=sB,e.cq=s7,e.cr=function(e,i,r,n,o,a,s,l,h){if("globe"===h.name)return s7(e,i,new sB(r,n,o),!1);let u=cU({z:r,x:n,y:o},h);return new s0([(a+u.x/u.scale)*i,i*(u.y/u.scale),s],[(a+u.x2/u.scale)*i,i*(u.y2/u.scale),l])},e.cs=function(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e},e.ct=function(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e},e.cu=function(e){return e8[Math.round((e+45+360)%360/90)%4]},e.cv=85.051129,e.cw=eP,e.cx=6,e.cy=function(e){let i=K(new Float64Array(16));Q(i,e.pixelMatrix,e.globeMatrix);let r=[0,a8,0],n=[0,a4,0];return eI(r,r,i),eI(n,n,i),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!ld(e,new st(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!ld(e,new st(e.center.lat,-90))]},e.cz=function(e,i){var r,n,o,a,s,l,h,u;let{scale:c}=e.tileTransform,d=8192*c/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return r=new Float32Array(4),n=i.inverseAdjustmentMatrix,o=[d,d],a=n[1],s=n[2],l=n[3],h=o[0],u=o[1],r[0]=n[0]*h,r[1]=a*h,r[2]=s*u,r[3]=l*u,r},e.d=function(e){return tI.API_TILEJSON_REGEX.test(e)},e.d$=au,e.d0=pn,e.d1=cx,e.d2=cv,e.d3=tX,e.d4=ot,e.d5=tO,e.d6=t6,e.d7=td,e.d8=function(e){let i=e.indexOf("\x1f");return i>=0?e.slice(0,i):e},e.d9=function(e){return e.indexOf("\x1f")>=0},e.dA=ll,e.dB=tS,e.dC=tT,e.dD=256,e.dE=function(e,i){let r=[0,0,0];return eI(r,r,lo(s6(i.canonical))),eI(r,r,e),r},e.dF=e=>({u_camera_to_center_distance:new aF(e),u_extrude_scale:new aH(e),u_device_pixel_ratio:new aF(e),u_matrix:new aG(e),u_inv_rot_matrix:new aG(e),u_merc_center:new aB(e),u_tile_id:new aN(e),u_zoom_transition:new aF(e),u_up_dir:new aN(e),u_emissive_strength:new aF(e)}),e.dG=e=>({u_matrix:new aG(e),u_pixels_to_tile_units:new aH(e),u_device_pixel_ratio:new aF(e),u_width_scale:new aF(e),u_floor_width_scale:new aF(e),u_units_to_pixels:new aB(e),u_dash_image:new az(e),u_gradient_image:new az(e),u_image_height:new aF(e),u_texsize:new aB(e),u_tile_units_to_pixels:new aF(e),u_alpha_discard_threshold:new aF(e),u_trim_offset:new aB(e),u_trim_fade_range:new aB(e),u_trim_color:new aj(e),u_emissive_strength:new aF(e),u_zbias_factor:new aF(e),u_tile_to_meter:new aF(e),u_ground_shadow_factor:new aN(e)}),e.dH=e=>({u_matrix:new aG(e),u_texsize:new aB(e),u_pixels_to_tile_units:new aH(e),u_device_pixel_ratio:new aF(e),u_width_scale:new aF(e),u_floor_width_scale:new aF(e),u_image:new az(e),u_units_to_pixels:new aB(e),u_tile_units_to_pixels:new aF(e),u_alpha_discard_threshold:new aF(e),u_trim_offset:new aB(e),u_trim_fade_range:new aB(e),u_trim_color:new aj(e),u_emissive_strength:new aF(e),u_zbias_factor:new aF(e),u_tile_to_meter:new aF(e),u_ground_shadow_factor:new aN(e),u_pattern_transition:new aF(e)}),e.dI=o6,e.dJ=uG,e.dK=l_,e.dL=(e,i,r,n,o,a)=>{let s,l=e.transform,h="globe"===l.projection.name;if("map"===a.paint.get("circle-pitch-alignment"))if(h){let e=ll(l.zoom,i.canonical)*l._pixelsPerMercatorPixel;s=Float32Array.from([e,0,0,e])}else s=l.calculatePixelsToTileUnitsMatrix(r);else s=new Float32Array([l.pixelsToGLUnits[0],0,0,l.pixelsToGLUnits[1]]);let u={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(l.projection),u_matrix:e.translatePosMatrix(i.projMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:tM.devicePixelRatio,u_extrude_scale:s,u_inv_rot_matrix:lg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(h){u.u_inv_rot_matrix=n,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=lu(l.zoom);let e=8192*o[0],r=8192*o[1];u.u_up_dir=l.projection.upVector(new sB(0,0,0),e,r)}return u},e.dM=uP,e.dN=iF,e.dO=(e,i,r,n,o,a,s,l,h,u)=>{let c=e.transform,d=c.pitch<15?uA(.07,.7,tt((14-c.zoom)/5,0,1)):.07,p="none"===r.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:uM(e,i,r,n),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:o,u_width_scale:a,u_floor_width_scale:s,u_image:0,u_tile_units_to_pixels:uR(i,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(p?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:d,u_tile_to_meter:sd(i.tileID.canonical,0),u_ground_shadow_factor:h,u_pattern_transition:u}},e.dP=(e,i,r,n,o,a,s,l,h,u)=>{let c=e.transform,d=c.calculatePixelsToTileUnitsMatrix(i),p="none"===r.paint.get("line-trim-color-use-theme").constantOr("default"),f=c.pitch<15?uA(.07,.7,tt((14-c.zoom)/5,0,1)):.07;return{u_matrix:uM(e,i,r,n),u_pixels_to_tile_units:d,u_device_pixel_ratio:a,u_width_scale:s,u_floor_width_scale:l,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:uO(r)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uR(i,e.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(p?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:f,u_tile_to_meter:sd(i.tileID.canonical,0),u_ground_shadow_factor:u}},e.dQ=tl,e.dR=lA,e.dS=sl,e.dT=uo,e.dU=sU,e.dV=h9,e.dW=0x80000000,e.dX=450,e.dY=7,e.dZ=.0038760859073359074,e.d_=oN,e.da=function(e){let i=e.lastIndexOf("\x1f");return i>=0?e.slice(i+1):""},e.db=function(e){let i=[],r=e.id;return void 0===r&&i.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&i.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&i.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),i},e.dc=function(e,i,r,n){return"custom"===e.type?new db(e,i):new d6[e.type](e,i,r,n)},e.dd=tc,e.de=function(e){let i=e.indexOf("\x1f");return i>=0?e.slice(i+1):""},e.df=class extends f6{constructor(e,i){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){let e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.dg=or,e.dh=tY,e.di=aV,e.dj=class extends aD{constructor(e){super(e),this.current=aq}set(e,i,r){if(this.fetchUniformLocation(e,i)){for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},e.dk=e9,e.dl=function(e,i,r){let n=lu(r.zoom),o=e.style.map._antialias,a=e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!o&&!a},e.dm=function(e){let i=e.pixelsPerMeter,r=i/(1/sr(e.center.lat)),n=K(new Float64Array(16));return ee(n,n,[e.point.x,e.point.y,0]),et(n,n,[r,r,i]),Float32Array.from(n)},e.dn=le,e.dp=function(e){return Math.round(Math.pow(Math.abs(Math.sin((e=tt(e,-80.051129,80.051129)/80.051129*90)*e4)),3)*(a6.length-1))},e.dq=function(e,i,r,n){let o=i.getNorth(),a=i.getSouth(),s=i.getWest(),l=i.getEast(),h=1<<e.z,u=l-s,c=o-a,d=u/64,p=-c/a6[r],f=[0,d,0,p,0,0,o,s,0];if(e.z>0){let e=180/n;X(f,f,[e/u+1,0,0,0,e/c+1,0,-.5*e/d,.5*e/p,1])}return f[2]=h,f[5]=e.x,f[8]=e.y,f},e.dr=s6,e.ds=function(e,i,r){let n=K(new Float64Array(16)),o=(i/(1<<e)-.5)*Math.PI*2;return er(n,r.globeMatrix,o),Float32Array.from(n)},e.dt=class{isDataAvailableAtPoint(e){let i=this._source();if(this.isUsingMockSource()||!i||e.y<0||e.y>1)return!1;let r=i.getSource().maxzoom,n=1<<r,o=Math.floor(e.x),a=Math.floor((e.x-o)*n),s=Math.floor(e.y*n),l=this.findDEMTileFor(new sj(r,o,r,a,s));return!(!l||!l.dem)}getAtPointOrZero(e,i=0){return this.getAtPoint(e,i)||0}getAtPoint(e,i,r=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);let n=this._source();if(!n||e.y<0||e.y>1)return i;let o=n.getSource().maxzoom,a=1<<o,s=Math.floor(e.x),l=e.x-s,h=new sj(o,s,o,Math.floor(l*a),Math.floor(e.y*a)),u=this.findDEMTileFor(h);if(!u||!u.dem)return i;let c=u.dem,d=1<<u.tileID.canonical.z,p=(l*d-u.tileID.canonical.x)*c.dim,f=(e.y*d-u.tileID.canonical.y)*c.dim,m=Math.floor(p),g=Math.floor(f);return(r?this.exaggeration():1)*ih(ih(c.get(m,g),c.get(m,g+1),f-g),ih(c.get(m+1,g),c.get(m+1,g+1),f-g),p-m)}getAtTileOffset(e,i,r){let n=1<<e.canonical.z;return this.getAtPointOrZero(new sp(e.wrap+(e.canonical.x+i/8192)/n,(e.canonical.y+r/8192)/n))}getAtTileOffsetFunc(e,i,r,n){return o=>{let a=this.getAtTileOffset(e,o.x,o.y),s=n.upVector(e.canonical,o.x,o.y);return e_(s,s,a*n.upVectorScale(e.canonical,i,r).metersToTile),s}}getForTilePoints(e,i,r,n){if(this.isUsingMockSource())return!1;let o=dJ.create(this,e,n);return!!o&&(i.forEach(e=>{e[2]=this.exaggeration()*o.getElevationAt(e[0],e[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;let i=this.findDEMTileFor(e);if(!i||!i.dem)return null;let r=i.dem.tree,n=i.tileID,o=1<<e.canonical.z-n.canonical.z,a=e.canonical.x/o-n.canonical.x,s=e.canonical.y/o-n.canonical.y,l=0;for(let i=0;i<e.canonical.z-n.canonical.z&&!r.leaves[l];i++){let e=2*Math.floor(s*=2)+Math.floor(a*=2);l=r.childOffsets[l]+e,a%=1,s%=1}return{min:this.exaggeration()*r.minimums[l],max:this.exaggeration()*r.maximums[l]}}getMinElevationBelowMSL(){throw Error("Pure virtual method called.")}raycast(e,i,r){throw Error("Pure virtual method called.")}pointCoordinate(e){throw Error("Pure virtual method called.")}_source(){throw Error("Pure virtual method called.")}isUsingMockSource(){throw Error("Pure virtual method called.")}exaggeration(){throw Error("Pure virtual method called.")}findDEMTileFor(e){throw Error("Pure virtual method called.")}get visibleDemTiles(){throw Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let e=this.visibleDemTiles;if(0===e.length)return null;let i=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(let o of e){let e=this.getMinMaxForTile(o.tileID);e&&(r=Math.min(r,e.min),n=Math.max(n,e.max),i=!0)}return i?{min:r,max:n}:null}},e.du=lC,e.dv=s1,e.dw=function(e,i){return[Math.pow(e[0],2.2)*i,Math.pow(e[1],2.2)*i,Math.pow(e[2],2.2)*i]},e.dx=Z,e.dy=function(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dz=eC,e.e=tI,e.e$=f5,e.e0=256,e.e1=la,e.e2=oX,e.e3=er,e.e4=function(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],e},e.e5=at,e.e6=ai,e.e7=function(e,i,r,n,o){return tt((e-i)/(r-i)*(o-n)+n,n,o)},e.e8=eF,e.e9=function(e,i){var r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],h=i[6],u=i[7],c=i[8],d=c*s-l*u,p=-c*a+l*h,f=u*a-s*h,m=r*d+n*p+o*f;return m?(e[0]=d*(m=1/m),e[1]=(-c*n+o*u)*m,e[2]=(l*n-o*s)*m,e[3]=p*m,e[4]=(c*r-o*h)*m,e[5]=(-l*r+o*a)*m,e[6]=f*m,e[7]=(-u*r+n*h)*m,e[8]=(s*r-n*a)*m,e):null},e.eA=function(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e},e.eB=ef,e.eC=a7,e.eD=ex,e.eE=function(e,i,r,n){return e[0]=i,e[1]=r,e[2]=n,e},e.eF=function([e,i,r]){let n=Math.hypot(e,i,r);return new st(Math.atan2(e,r)*e6,(.5*Math.PI-Math.acos(-i/n))*e6)},e.eG=eO,e.eH=dC,e.eI=function(e){let i=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==tv){let i=e.navigator?e.navigator.userAgent:null;tv=!!e.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return tv}(e)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.eJ=function(e,i){tL=e,tD=i},e.eK=ld,e.eL=lc,e.eM=function(e){let i=[0,0,0],r=K(new Float64Array(16));return Q(r,e.pixelMatrix,e.globeMatrix),eI(i,i,r),new e3(i[0],i[1])},e.eN=function(e,i,r=!1){if(n7===n4||n7===n6||n7===n8)throw Error("setRTLTextPlugin cannot be called multiple times.");oe=tM.resolveURL(e),n7=n4,n9=i,oi(),r||oo()},e.eO=on,e.eP=function(){pn().acquire(pt)},e.eQ=function(){let e=U;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(pt),U=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.eR=pi,e.eS=function(e){let i=tF();if(!i)return;let r=i.delete(tk);e&&r.then(()=>e()).catch(e)},e.eT=pe,e.eU=fG,e.eV=function(e){fB=tM.resolveURL(e),fU||(fU=new pr(pn(),new it)),fU.broadcast("setDracoUrl",fB)},e.eW=fq,e.eX=function(e){fj=tM.resolveURL(e),fU||(fU=new pr(pn(),new it)),fU.broadcast("setMeshoptUrl",fj)},e.eY=nX,e.eZ=lE,e.e_=2,e.ea=ny,e.eb=eb,e.ec=su,e.ed=class{constructor(e,i,r,n){this.context=e,this.format=n,this.size=r,this.texture=e.gl.createTexture();let[o,a,s]=this.size,{gl:l}=e;l.bindTexture(l.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),l.texImage3D(l.TEXTURE_3D,0,this.format,o,a,s,0,dc(this.format),dd(this.format),i.data)}bind(e,i){let{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_3D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,i),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.ee=function(e,i){if(e===i){var r=i[1],n=i[2],o=i[3],a=i[6],s=i[7],l=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=a,e[11]=i[14],e[12]=o,e[13]=s,e[14]=l}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e},e.ef=dP,e.eg=el,e.eh=[1,1,1],e.ei=function(e,i,r,n){var o=new $(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o},e.ej=eM,e.ek=function(e,i,r,n){var o=i[0],a=i[1],s=i[2],l=i[3];return e[0]=o+n*(r[0]-o),e[1]=a+n*(r[1]-a),e[2]=s+n*(r[2]-s),e[3]=l+n*(r[3]-l),e},e.el=dJ,e.em=dH,e.en=o3,e.eo=ao,e.ep=function(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g){var _=new $(16);return _[0]=e,_[1]=i,_[2]=r,_[3]=n,_[4]=o,_[5]=a,_[6]=s,_[7]=l,_[8]=h,_[9]=u,_[10]=c,_[11]=d,_[12]=p,_[13]=f,_[14]=m,_[15]=g,_},e.eq=6371008.8,e.er=an,e.es=ar,e.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new e3(1/0,1/0),max:new e3(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e,i=!1){let r=hU(new e3(0,0),new e3(8192,8192),e),n=[];if(i&&!hj(r,this._globalClipBounds))return n;for(let i of this._activeRegions){if(i.hiddenByOverlap||!hj(r,i))continue;let o=function(e,i,r){let n=1<<r.canonical.z,o=((i.x-r.wrap)*n-r.canonical.x)*8192,a=(i.y*n-r.canonical.y)*8192;return{min:new e3(((e.x-r.wrap)*n-r.canonical.x)*8192,(e.y*n-r.canonical.y)*8192),max:new e3(o,a)}}(i.min,i.max,e);n.push({min:o.min,max:o.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId,order:i.order,clipMask:i.clipMask,clipScope:i.clipScope})}return n}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let r of e.cache.getVisibleCoordinates()){let n=e.cache.getTile(r).buckets[e.layer];n&&n.updateFootprints(r.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){let i=e.getFootprints();if(0===i.length)return;let r=e.getOrder(),n=e.getClipMask(),o=e.getClipScope();for(let e of i){if(!e.footprint)continue;let i=hU(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:i.min,max:i.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint,order:r,clipMask:n,clipScope:o})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||hB(e.min,i.min)||hB(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(e,i){let r=(e,i)=>e+i;return e.length-i.length||e.reduce(r,"").localeCompare(i.reduce(r,""))}(e.clipScope,i.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let i=0;for(;!e&&i!==this._activeRegions.length;){let r=this._activeRegions[i],n=this._prevRegions[i];e=r.priority!==n.priority||!hN(r,n)||r.order!==n.order||r.clipMask!==n.clipMask||!e5(r.clipScope,n.clipScope),++i}}if(e){for(let e of(++this._updateTime,this._activeRegions))e.order!==hz&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,e.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,e.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,e.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,e.max.y));let e=e=>{let i=this._activeRegions;if(e>=i.length)return e;let r=i[e].priority;for(;e<i.length&&i[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let i=0,r=e(0);for(;i!==r;){let n=i,o=i;for(;n!==r;){let e=this._activeRegions[n];e.hiddenByOverlap=!1;for(let i=0;i<o;i++){let r=this._activeRegions[i];if(!r.hiddenByOverlap&&e.order===hz&&hj(e,r)&&(e.hiddenByOverlap=function e(i,r,n,o){if(!i||!n)return!1;let a=i.vertices;if(!r.canonical.equals(o.canonical)||r.wrap!==o.wrap){if(n.vertices.length<i.vertices.length)return e(n,o,i,r);let s=r.canonical,l=o.canonical,h=Math.pow(2,l.z-s.z);a=i.vertices.map(e=>new e3((e.x+8192*s.x)*h-8192*l.x,(e.y+8192*s.y)*h-8192*l.y))}return hG(n,a,i.indices,0,i.indices.length,0,0)}(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++n}r=e(i=r)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=e.length-1;i>=0;i--)this._addSource(e[i]);this._computeReplacement()}},e.eu=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){for(let e of(this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy(),this._poleSegments))e.destroy();for(let e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,i){let r=new oV,n=new o9,o=[],a=e+1+2,s=i[0]+1,l=i[0]+1+(1+i.length),h=(e,i,r)=>{let n=e===a-1?e-2:0===e?e:e-1;return[n+=24575*!!r,i]};for(let e=0;e<a;++e)r.emplaceBack(...h(e,0,!0));for(let e=0;e<s;++e)for(let i=0;i<a;++i)r.emplaceBack(...h(i,e,0===i||i===a-1));for(let e=0;e<i.length;++e){let n=i[e];for(let e=0;e<a;++e)r.emplaceBack(...h(e,n,!0))}for(let e=0;e<i.length;++e){let s=n.length,h=i[e]+1+2,u=new o9;for(let r=0;r<h-1;r++){let o=r===h-2,s=o?a*(l-i.length+e-r):a;for(let e=0;e<a-1;e++){let i=r*a+e;0===r||o||0===e||e===a-2?(u.emplaceBack(i+1,i,i+s),u.emplaceBack(i+s,i+s+1,i+1)):(n.emplaceBack(i+1,i,i+s),n.emplaceBack(i+s,i+s+1,i+1))}}let c=aC.simpleSegment(0,s,r.length,n.length-s);for(let e=0;e<u.uint16.length;e+=3)n.emplaceBack(u.uint16[e],u.uint16[e+1],u.uint16[e+2]);let d=aC.simpleSegment(0,s,r.length,n.length-s);o.push({withoutSkirts:c,withSkirts:d})}return{vertices:r,indices:n,segments:o}}_createGrid(e){let i=this._fillGridMeshWithLods(64,a6);this._gridSegments=i.segments,this._gridBuffer=e.createVertexBuffer(i.vertices,s$.members),this._gridIndexBuffer=e.createIndexBuffer(i.indices,!0)}_createPoles(e){let i=new o9;for(let e=0;e<=64;e++)i.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(i,!0);let r=new at,n=new at,o=new at,a=new at;this._poleSegments=[];for(let e=0,i=0;e<5;e++){let s=360/(1<<e);r.emplaceBack(0,-a4,0,.5,0),n.emplaceBack(0,-a4,0,.5,1),o.emplaceBack(0,-a4,0,.5,.5),a.emplaceBack(0,-a4,0,.5,.5);for(let e=0;e<=64;e++){let i=e/64,l=0,h=ih(0,s,i),[u,c,d]=a9(lf,lm,h,a4);r.emplaceBack(u,c,d,i,l),n.emplaceBack(u,c,d,i,1-l);let p=h*e4;i=.5+.5*Math.sin(p),l=.5+.5*Math.cos(p),o.emplaceBack(u,c,d,i,l),a.emplaceBack(u,c,d,i,1-l)}this._poleSegments.push(aC.simpleSegment(i,0,66,64)),i+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,sG,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,sG,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(o,sG,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,sG,!1)}getGridBuffers(e,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.ev=hz,e.ew=e7,e.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.ey=te,e.ez=sc,e.f=function(e){return 0===e.indexOf("mapbox:")},e.f0=f8,e.f1=ub,e.f2=hr,e.f3="hd_road_elevation",e.f4=hd,e.f5=tu,e.f6=hm,e.f7=cm,e.f8=1,e.f9=function(e,i,r,n,o,a,s,l=1,h,u){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;let c=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};p.scaleFactor=l,p.textSizeScaleRange=c.get("text-size-scale-range"),p.iconSizeScaleRange=c.get("icon-size-scale-range");let[f,m]=p.textSizeScaleRange,[g,_]=p.iconSizeScaleRange;p.textScaleFactor=tt(p.scaleFactor,f,m),p.iconScaleFactor=tt(p.scaleFactor,g,_);let y=d["text-size"],v=d["icon-size"];if("composite"===e.textSizeData.kind){let{minZoom:i,maxZoom:r}=e.textSizeData;p.compositeTextSizes=[y.possiblyEvaluate(new os(i),a),y.possiblyEvaluate(new os(r),a)]}if("composite"===e.iconSizeData.kind){let{minZoom:i,maxZoom:r}=e.iconSizeData;p.compositeIconSizes=[v.possiblyEvaluate(new os(i),a),v.possiblyEvaluate(new os(r),a)]}p.layoutTextSize=y.possiblyEvaluate(new os(s+1),a),p.layoutIconSize=v.possiblyEvaluate(new os(s+1),a),p.textMaxSize=y.possiblyEvaluate(new os(18),a);let x=c.get("symbol-placement"),b="map"===c.get("text-rotation-alignment")&&"point"!==x,w=c.get("text-size"),T=!1,S=[];for(let s of e.features){let l=c.get("text-font").evaluate(s,{},a).join(","),f=w.evaluate(s,{},a)*p.textScaleFactor,m=p.layoutTextSize.evaluate(s,{},a)*p.textScaleFactor,g=p.layoutIconSize.evaluate(s,{},a)*p.iconScaleFactor,_={horizontal:{},vertical:void 0},y=s.text,v,E=[0,0];if(y){let n=y.toString(),u=24*c.get("text-letter-spacing").evaluate(s,{},a),d=24*c.get("text-line-height").evaluate(s,{},a),p=!function(e){for(let r of e){var i;if(i=r.charCodeAt(0),n0.Arabic(i)||n0["Arabic Supplement"](i)||n0["Arabic Extended-A"](i)||n0["Arabic Presentation Forms-A"](i)||n0["Arabic Presentation Forms-B"](i))return!1}return!0}(n)?0:u,g=c.get("text-anchor").evaluate(s,{},a),v=c.get("text-variable-anchor");if(!v){let e=c.get("text-radial-offset").evaluate(s,{},a);if(e)E=cM(g,[24*e,cA]);else{let e=c.get("text-offset").evaluate(s,{},a);E=[24*e[0],24*e[1]]}}let w=b?"center":c.get("text-justify").evaluate(s,{},a),T="point"===x,S=T?24*c.get("text-max-width").evaluate(s,{},a):1/0,I=a=>{e.allowVerticalPlacement&&n1(n)&&(_.vertical=u3(y,i,r,o,l,S,d,g,a,p,E,u0.vertical,!0,m,f,h))};if(!b&&v){let e="auto"===w?v.map(e=>cz(e)):[w],n=!1;for(let a=0;a<e.length;a++){let s=e[a];if(!_.horizontal[s])if(n)_.horizontal[s]=_.horizontal[0];else{let e=u3(y,i,r,o,l,S,d,"center",s,p,E,u0.horizontal,!1,m,f,h);e&&(_.horizontal[s]=e,n=1===e.positionedLines.length)}}I("left")}else{if("auto"===w&&(w=cz(g)),T||c.get("text-writing-mode").indexOf("horizontal")>=0||!n1(n)){let e=u3(y,i,r,o,l,S,d,g,w,p,E,u0.horizontal,!1,m,f,h);e&&(_.horizontal[w]=e)}I(T?"left":w)}}let I,C,A,R,M,P,O,k=!1;if(s.icon&&s.icon.hasPrimary()){let i=ck(s.icon,e.iconSizeData,d["icon-size"],a,e.zoom,s,h,p.iconScaleFactor);I=i.iconPrimary,A=i.iconSecondary;let r=I.toString();if((C=n.get(r))&&(M=c.get("icon-offset").evaluate(s,{},a),P=c.get("icon-anchor").evaluate(s,{},a),O=c.get("icon-text-fit").evaluate(s,{},a),v=function(e,i,r,n){let{horizontalAlign:o,verticalAlign:a}=u7(n),s=r[0]-e.displaySize[0]*o,l=r[1]-e.displaySize[1]*a;return{imagePrimary:e,imageSecondary:i,top:l,bottom:l+e.displaySize[1],left:s,right:s+e.displaySize[0]}}(o.get(r),A?o.get(A.toString()):void 0,M,P),k=C.sdf,void 0===e.sdfIcons?e.sdfIcons=C.sdf:e.sdfIcons!==C.sdf&&tf("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(C.pixelRatio!==e.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),A){let e=A.toString();R=n.get(e)}}T=T||!(!s.icon||!s.icon.hasSecondary());let L=cB(_.horizontal)||_.vertical;e.iconsInText||(e.iconsInText=!!L&&L.iconsInText);let{defaultShapedIcon:D,verticallyShapedIcon:z}=function(e,i,r,n,o,a,s,l,h){let u=cB(a.horizontal)||a.vertical,c=r.get("icon-text-fit-padding").evaluate(n,{},o),d,p=i;return i&&"none"!==h&&(e.allowVerticalPlacement&&a.vertical&&(d=ci(i,a.vertical,h,c,l,s)),u&&(p=ci(i,u,h,c,l,s))),{defaultShapedIcon:p,verticallyShapedIcon:d}}(e,v,c,s,a,_,m*p.textScaleFactor/24,M,O);"none"!==O&&v&&(cr(v)||cn(v))&&(cP(0,C,I,v,D,O,u,n,o),cP(0,R,A,v,D,O,u,n,o),z&&(cP(0,C,I,v,z,O,u,n,o),cP(0,R,A,v,z,O,u,n,o))),v=D,S.push({feature:s,shapedTextOrientations:_,shapedText:L,shapedIcon:v,iconPrimary:I,iconSecondary:A,iconOffset:M,iconAnchor:P,verticallyShapedIcon:z,layoutTextSize:m,layoutIconSize:g,textOffset:E,isSDFIcon:k,iconTextFit:O})}return{featureData:S,sizes:p,hasAnySecondaryIcon:T,textAlongLine:b,symbolPlacement:x}},e.fa=cg,e.fb=function(e,i,r,n,o,a,s,l,h,u){let{featureData:c,hasAnySecondaryIcon:d,sizes:p,textAlongLine:f,symbolPlacement:m}=i;for(let i of c){let{shapedIcon:r,verticallyShapedIcon:a,feature:c,shapedTextOrientations:g,shapedText:_,layoutTextSize:y,textOffset:v,isSDFIcon:x,iconPrimary:b,iconSecondary:w,iconTextFit:T,iconOffset:S}=i;cL(r,u.iconPositions,b,w),cL(a,u.iconPositions,b,w),function(e,i){for(let r in e.horizontal)cD(e.horizontal[r],i);cD(e.vertical,i)}(g,u.iconPositions),(_||r)&&function(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x){var b;let w=s.textMaxSize.evaluate(i,{},p);void 0===w?w=l*s.textScaleFactor:w*=s.textScaleFactor;let T=e.layers[0].layout,S=cB(r.horizontal)||r.vertical,E="globe"===f.name,I=e.tilePixelRatio*w/24,C=(b=e.overscaling,e.zoom>18&&b>2&&(b>>=1),Math.max(8192/(512*b),1)*T.get("symbol-spacing")),A=T.get("text-padding")*e.tilePixelRatio,R=T.get("icon-padding")*e.tilePixelRatio,M=T.get("text-max-angle")*e4,P="map"===T.get("icon-rotation-alignment")&&"point"!==x,O=C/2;!1===e.hasAnyIconTextFit&&"none"!==_&&(e.hasAnyIconTextFit=!0);let k=i.properties?+i.properties[hr]:null,L=k&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(k):65535,D=(l,h,x)=>{if(h.x<0||h.x>=8192||h.y<0||h.y>=8192)return;let b=null;if(E){let{x:e,y:i,z:r}=f.projectTilePoint(h.x,h.y,x);b={anchor:new ch(e,i,r,0,void 0),up:f.upVector(x,h.x,h.y)}}!function(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S,E,I,C,A,R){let M=e.addToLineVertexArray(i,n),P,O,k,L,D,z,F,B=0,N=0,j=0,V=0,U=-1,G=-1,q={},$=t6(""),H=r?r.anchor:i,Z="none"!==A,W=0,X=0;if(void 0===h._unevaluatedLayout.getValue("text-radial-offset")){let e=h.layout.get("text-offset").evaluate(b,{},E);W=24*e[0],X=24*e[1]}else W=24*h.layout.get("text-radial-offset").evaluate(b,{},E),X=cA;if(e.allowVerticalPlacement&&o.vertical){let e=o.vertical;if(m)z=cj(e),l&&(F=cj(l));else{let r=h.layout.get("text-rotate").evaluate(b,{},E)+90;k=cN(u,H,i,c,d,p,e,f,r,g),l&&(L=cN(u,H,i,c,d,p,l,y,r))}}if(a){let n=e.iconSizeData,o=h.layout.get("icon-rotate").evaluate(b,{},E),s=cw(a,o,T,Z,w.iconScaleFactor),f=l?cw(l,o,T,Z,w.iconScaleFactor):void 0;O=cN(u,H,i,c,d,p,a,y,o,null),B=4*s.length;let m=null;"source"===n.kind?(m=[128*h.layout.get("icon-size").evaluate(b,{},E)*w.iconScaleFactor])[0]>32640&&tf(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===n.kind&&((m=[128*w.compositeIconSizes[0].evaluate(b,{},E)*w.iconScaleFactor,128*w.compositeIconSizes[1].evaluate(b,{},E)*w.iconScaleFactor])[0]>32640||m[1]>32640)&&tf(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),e.addSymbols(e.icon,s,m,x,v,b,void 0,r,i,M.lineStartIndex,M.lineLength,-1,S,E,I,C),U=e.icon.placedSymbolArray.length-1,f&&(N=4*f.length,e.addSymbols(e.icon,f,m,x,v,b,u0.vertical,r,i,M.lineStartIndex,M.lineLength,-1,S,E,I,C),G=e.icon.placedSymbolArray.length-1)}for(let n in o.horizontal){let a=o.horizontal[n];P||($=t6(a.text),m?D=cj(a):P=cN(u,H,i,c,d,p,a,f,h.layout.get("text-rotate").evaluate(b,{},E),g));let l=1===a.positionedLines.length;if(j+=cF(e,r,i,a,s,h,m,b,g,M,o.vertical?u0.horizontal:u0.horizontalOnly,l?cC(o.horizontal):[n],q,U,w,S,E,I),l)break}o.vertical&&(V+=cF(e,r,i,o.vertical,s,h,m,b,g,M,u0.vertical,["vertical"],q,G,w,S,E,I));let Y=-1,K=(e,i)=>e?Math.max(e,i):i;Y=K(D,-1),Y=K(z,Y);let J=+((Y=K(F,Y))>-1);e.glyphOffsetArray.length>=65535&&tf("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey),e.symbolInstances.emplaceBack(i.x,i.y,H.x,H.y,H.z,q.right>=0?q.right:-1,q.center>=0?q.center:-1,q.left>=0?q.left:-1,q.vertical>=0?q.vertical:-1,U,G,$,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,void 0!==O?O:e.collisionBoxArray.length,void 0!==O?O+1:e.collisionBoxArray.length,L||e.collisionBoxArray.length,L?L+1:e.collisionBoxArray.length,c,j,V,B,N,J,0,W,X,Y,0,+!!Z,R)}(e,h,b,l,r,n,a,o,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,A,v,u,0,R,P,y,i,s,c,d,p,m,g,_,L)};if("line"===x)for(let o of uc(i.geometry,0,0,8192,8192))for(let i of function(e,i,r,n,o,a,s,l,h){let u=n?14.399999999999999*s:0,c=cd(n,o),d=c*s,p=0===e[0].x||8192===e[0].x||0===e[0].y||8192===e[0].y;return i-d<i/4&&(i=d+i/4),function e(i,r,n,o,a,s,l,h,u){let c=s/2,d=cc(i),p=0,f=r-n,m=[];for(let e=0;e<i.length-1;e++){let r=i[e],l=i[e+1],h=r.dist(l),g=l.angleTo(r);for(;f+n<p+h;){let _=((f+=n)-p)/h,y=ih(r.x,l.x,_),v=ih(r.y,l.y,_);if(y>=0&&y<u&&v>=0&&v<u&&f-c>=0&&f+c<=d){let r=new ch(y,v,0,g,e);o&&!cu(i,r,s,o,a)||m.push(r)}}p+=h}return h||m.length||l||(m=e(i,p/2,n,o,a,s,l,!0,u)),m}(e,p?i/2*l%i:(c/2+48)*s*l%i,i,u,r,d,p,!1,h)}(o,C,M,r.vertical||S,n,24,I,e.overscaling,8192))S&&function(e,i,r,n){let o=e.compareText;if(i in o){let e=o[i];for(let i=e.length-1;i>=0;i--)if(n.dist(e[i])<r)return!0}else o[i]=[];return o[i].push(n),!1}(e,S.text,O,i)||D(o,i,p);else if("line-center"===x){for(let e of i.geometry)if(e.length>1){let i=function(e,i,r,n,o,a){let s=r?14.399999999999999*a:0,l=cd(r,n)*a,h=0,u=cc(e)/2;for(let r=0;r<e.length-1;r++){let n=e[r],o=e[r+1],a=n.dist(o);if(h+a>u){let c=(u-h)/a,d=new ch(ih(n.x,o.x,c),ih(n.y,o.y,c),0,o.angleTo(n),r);return!s||cu(e,d,l,s,i)?d:void 0}h+=a}}(e,M,r.vertical||S,n,0,I);i&&D(e,i,p)}}else if("Polygon"===i.type)for(let e of lY(i.geometry,0)){let i=function(e,i=1,r=!1){let n=1/0,o=1/0,a=-1/0,s=-1/0,l=e[0];for(let e=0;e<l.length;e++){let i=l[e];(!e||i.x<n)&&(n=i.x),(!e||i.y<o)&&(o=i.y),(!e||i.x>a)&&(a=i.x),(!e||i.y>s)&&(s=i.y)}let h=Math.min(a-n,s-o),u=h/2,c=new rp([],cE);if(0===h)return new e3(n,o);for(let i=n;i<a;i+=h)for(let r=o;r<s;r+=h)c.push(new cI(i+u,r+u,u,e));let d=function(e){let i=0,r=0,n=0,o=e[0];for(let e=0,a=o.length,s=a-1;e<a;s=e++){let a=o[e],l=o[s],h=a.x*l.y-l.x*a.y;r+=(a.x+l.x)*h,n+=(a.y+l.y)*h,i+=3*h}return new cI(r/i,n/i,0,e)}(e),p=c.length;for(;c.length;){let n=c.pop();(n.d>d.d||!d.d)&&(d=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=i||(u=n.h/2,c.push(new cI(n.p.x-u,n.p.y-u,u,e)),c.push(new cI(n.p.x+u,n.p.y-u,u,e)),c.push(new cI(n.p.x-u,n.p.y+u,u,e)),c.push(new cI(n.p.x+u,n.p.y+u,u,e)),p+=4)}return r&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}(e,16);D(e[0],new ch(i.x,i.y,0,0,void 0),p)}else if("LineString"===i.type)for(let e of i.geometry)D(e,new ch(e[0].x,e[0].y,0,0,void 0),p);else if("Point"===i.type)for(let e of i.geometry)for(let i of e)D([i],new ch(i.x,i.y,0,0,void 0),p)}(e,c,g,r,a,h,p,y,0,v,x,n,o,s,l,d,T,S,f,m)}r&&e.generateCollisionDebugBuffers(a,e.collisionBoxArray,p.textScaleFactor)},e.fc=hi,e.fd=p5,e.fe=e2,e.ff=ht,e.fg=uX,e.fh=eJ,e.fi=function(e){let i=0;if(0x46546c67!==new Uint32Array(e,0,1)[0]){let r=new Uint32Array(e,0,7),[,,n,o,a,s]=r;i=r.byteLength+o+a+s+a,(n!==e.byteLength||i>=e.byteLength)&&tf("Invalid b3dm header information.")}return f0(e,i)},e.fj=function(e,i){let r=f3(e);for(let e of r){for(let i of e.meshes)!function(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);let i=e.vertexArray.float32,r=e.aabb.min[0]-1,n=e.aabb.min[1]-1,o=64/(e.aabb.max[0]-r+2),a=64/(e.aabb.max[1]-n+2);for(let s=0;s<i.length;s+=3){let l=i[s+2],h=(i[s+0]-r)*o|0,u=(i[s+1]-n)*a|0;l>e.heightmap[64*u+h]&&(e.heightmap[64*u+h]=l)}}(i);e.lights&&(e.lightMeshIndex=e.meshes.length,e.meshes.push(function(e,i){let r={};r.indexArray=new o9,r.indexArray.reserve(4*e.length),r.vertexArray=new oX,r.vertexArray.reserve(10*e.length),r.colorArray=new o1,r.vertexArray.reserve(10*e.length);let n=0;for(let o of e){let e=Math.min(10,Math.max(4,1.3*o.height))*i,a=[-o.normal[1],o.normal[0],0],s=Math.min(.29,.1*o.width/o.depth),l=o.width-2*o.depth*i*(s+.01),h=ey([],o.pos,a,l/2),u=ey([],o.pos,a,-l/2),c=[h[0],h[1],h[2]+o.height],d=[u[0],u[1],u[2]+o.height],p=ey([],o.normal,a,s);e_(p,p,e);let f=ey([],o.normal,a,-s);e_(f,f,e),ed(p,h,p),ed(f,u,f),h[2]+=.1,u[2]+=.1,r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]);let m=l/e/2;r.colorArray.emplaceBack(-m-s,-1,m,.8),r.colorArray.emplaceBack(m+s,-1,m,.8),r.colorArray.emplaceBack(-m,0,m,1.3),r.colorArray.emplaceBack(m,0,m,1.3),r.colorArray.emplaceBack(m+s,-.8,m,.7),r.colorArray.emplaceBack(m+s,-.8,m,.7),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(m+s,-1.2,m,.8),r.colorArray.emplaceBack(m+s,-1.2,m,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}let o={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=is.white,o.pbrMetallicRoughness=a,r.material=o,r.aabb=new s0([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}(e.lights,i)))}return r},e.fk=d3,e.fl=t_,e.fm=d7,e.fn=oa,e.fo=function(e){tB(),null!=l&&l.then(i=>{i.keys().then(r=>{for(let n=0;n<r.length-e;n++)i.delete(r[n]).catch(e=>tf(e.message))}).catch(e=>tf(e.message))}).catch(e=>tf(e.message))},e.g=function(e,i){return tY(to(e,{method:"GET"}),i)},e.h=tC,e.i=function(e){return tI.API_STYLE_REGEX.test(e)&&!tA(e)},e.j=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.k=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(Number("0x"+i))))},e.l=to,e.m=tj,e.n=function(e,i){return tY(to(e,{type:"json"}),i)},e.o=tQ,e.p=function(e,i){return tY(to(e,{method:"POST"}),i)},e.q=tM,e.r=lI,e.s=function(e){try{let i=self[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=tR,e.u=function(){return function e(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=tf,e.x=function(){return G||(G=new pi),G},e.y=pZ,e.z=t9}),n(["./shared"],function(e){function i(e){let i=e?e.url.toString():void 0;return i?performance.getEntriesByName(i):[]}function r(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(let n of e)i+=`${r(n)},`;return`${i}]`}let i="{";for(let n of Object.keys(e).sort())i+=`${n}:${r(e[n])},`;return`${i}}`}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,i){this._layerConfigs={},this._layers={},this.update(e,[],i)}update(i,n,o){for(let r of(this._options=o,i))this._layerConfigs[r.id]=r,(this._layers[r.id]=e.dc(r,this.scope,null,this._options)).compileFilter(o),this.keyCache[r.id]&&delete this.keyCache[r.id];for(let e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];for(let i of(this.familiesBySource={},function(i,n){let o={};for(let a=0;a<i.length;a++){let s=i[a],l=n&&n[s.id];l||("symbol"===s.type?l=s.id:(l=function(i){let n="";for(let o of e.bu)("model"!==i.type||"minzoom"!==o&&"maxzoom"!==o)&&(n+=`/${r(i[o])}`);return n}(s),"line"===s.type&&s.paint&&function e(i){return"string"==typeof i&&"line-progress"===i||(Array.isArray(i)?i.some(e):!(!i||"object"!=typeof i)&&Object.values(i).some(e))}(s.paint["line-width"])&&(l+=`/${r(s.paint["line-width"])}`))),n&&(n[s.id]=l);let h=o[l];h||(h=o[l]=[]),h.push(s)}let a=[];for(let e in o)a.push(o[e]);return a}(Object.values(this._layerConfigs),this.keyCache))){let e=i.map(e=>this._layers[e.id]),r=e[0];if("none"===r.visibility)continue;let n=r.source||"",o=this.familiesBySource[n];o||(o=this.familiesBySource[n]={});let a=r.sourceLayer||"_geojsonTileLayer",s=o[a];s||(s=o[a]=[]),s.push(e)}}}let o=+e.e_;class a{constructor(i){let r={},n=[];for(let e in i){let a=i[e],s=r[e]={};for(let e in a.glyphs){let i=a.glyphs[+e];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;let r=i.metrics.localGlyph?o:1,l={x:0,y:0,w:i.bitmap.width+2*r,h:i.bitmap.height+2*r};n.push(l),s[e]=l}}let{w:a,h:s}=e.H(n),l=new e.eZ({width:a||1,height:s||1});for(let n in i){let a=i[n];for(let i in a.glyphs){let s=a.glyphs[+i];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;let h=r[n][i],u=s.metrics.localGlyph?o:1;e.eZ.copy(s.bitmap,l,{x:0,y:0},{x:h.x+u,y:h.y+u},s.bitmap)}}this.image=l,this.positions=r}}e.eY(a,"GlyphAtlas");class s{constructor(i){this.tileID=new e.aM(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.lut=i.lut,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.scope=i.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.request&&i.request.collectResourceTiming,this.promoteId=i.promoteId,this.isSymbolTile=i.isSymbolTile,this.tileTransform=e.aW(i.tileID.canonical,i.projection),this.projection=i.projection,this.worldview=i.worldview,this.localizableLayerIds=i.localizableLayerIds,this.brightness=i.brightness,this.extraShadowCaster=!!i.extraShadowCaster,this.tessellationStep=i.tessellationStep,this.scaleFactor=i.scaleFactor}parse(i,r,n,o,s,h){let u,c,d,p,f,m;this.status="parsing",this.data=i,this.collisionBoxArray=new e.b0;let g=new e.e$(Object.keys(i.layers).sort()),_=new e.f0(this.tileID,this.promoteId);_.bucketLayerIDs=[];let y={},v=new e.f1(256,256),x={featureIndex:_,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:v,availableImages:n,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},b=r.familiesBySource[this.source];for(let r in b){let a=i.layers[r];if(!a)continue;let s=!1,h=!1,u=!1;for(let e of b[r])"symbol"===e[0].type?s=!0:h=!0,e[0].is3D()&&"model"!==e[0].type&&(u=!0);if(this.extraShadowCaster&&!u||!0===this.isSymbolTile&&!s||!1===this.isSymbolTile&&!h)continue;1===a.version&&e.w(`Vector tile source "${this.source}" layer "${r}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let c=g.encode(r),d=[],p=!1;for(let i=0,n=0;i<a.length;i++){let o=a.feature(i),s=_.getId(o,r);if(this.localizableLayerIds&&this.localizableLayerIds.has(r)){let e=o.properties?o.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)o.properties.$localized=!0;else{if(!e.split(",").includes(this.worldview))continue;o.properties.$localized=!0,o.properties.worldview=this.worldview}}!p&&o.properties&&o.properties.hasOwnProperty(e.f2)&&(p=!0),d.push({feature:o,id:s,index:n,sourceLayerIndex:c}),n++}for(let a of(p&&!x.elevationFeatures&&i.layers.hasOwnProperty(e.f3)&&(x.elevationFeatures=e.f4.parseFrom(i.layers[e.f3],this.canonical)),b[r])){let i=a[0];(!this.extraShadowCaster||i.is3D()&&"model"!==i.type)&&(void 0!==this.isSymbolTile&&"symbol"===i.type!==this.isSymbolTile||i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(l(a,this.zoom,x.brightness,n),(y[i.id]=i.createBucket({index:_.bucketLayerIDs.length,layers:a,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:o})).populate(d,x,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(a.map(i=>e.C(i.id,i.scope)))))}}v.trim();let w={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},T=()=>{if(u)return this.status="done",h(u);if(this.extraShadowCaster)this.status="done",h(null,{buckets:Object.values(y).filter(e=>!e.isEmpty()),featureIndex:_,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:x.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(c&&d&&p){let i=new a(c),r=new Map;for(let[i,n]of d.entries()){let{imagePosition:o}=e.f7(i,n,e.f8);r.set(i,o)}let o={};for(let a in y){let s=y[a];s instanceof e.b1&&(l(s.layers,this.zoom,x.brightness,n),o[a]=e.f9(s,c,i.positions,d,r,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,f))}let h={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(s,d,f,()=>{h.iconsPending=!1,S(o,i,h)}),this.rasterizeIfNeeded(s,p,m,()=>{h.patternsPending=!1,S(o,i,h)})}},S=(i,r,o,a)=>{if(o.iconsPending||o.patternsPending)return;let s=new e.fa(d,p,this.lut);for(let r in y){let o=y[r];if(r in i)e.fb(o,i[r],this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,d,s);else if(o.hasPattern&&(o instanceof e.b7||o instanceof e.b8||o instanceof e.dV)){l(o.layers,this.zoom,x.brightness,n);let e=Object.fromEntries(s.patternPositions);o.addFeatures(x,this.tileID.canonical,e,n,this.tileTransform,this.brightness)}}this.status="done",h(null,{buckets:Object.values(y).filter(e=>!e.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:r.image,lineAtlas:v,imageAtlas:s,brightness:x.brightness})};if(!this.extraShadowCaster){let i=e.f5(x.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(i).length?s.send("getGlyphs",{uid:this.uid,stacks:i,scope:this.scope},(e,i)=>{u||(u=e,c=i,T())},void 0,!1,w):c={};let r=Array.from(x.iconDependencies.keys()).map(i=>e.I.parse(i));r.length?s.send("getImages",{images:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,i)=>{u||(u=e,d=new Map,f=this.updateImageMapAndGetImageTaskQueue(d,i,x.iconDependencies),T())},void 0,!1,w):(d=new Map,f=new Map);let n=Array.from(x.patternDependencies.keys()).map(i=>e.I.parse(i));n.length?s.send("getImages",{images:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,i)=>{u||(u=e,p=new Map,m=this.updateImageMapAndGetImageTaskQueue(p,i,x.patternDependencies),T())},void 0,!1,w):(p=new Map,m=new Map)}if(x.elevationFeatures&&x.elevationFeatures.length>0){let i=[];for(let r of Object.values(y))if(r instanceof e.b8){let e=r.getUnevaluatedPortalGraph();e&&i.push(e)}let r=e.f6.evaluate(i);for(let i of Object.values(y))i instanceof e.b8&&i.setEvaluatedPortalGraph(r)}T()}rasterizeIfNeeded(e,i,r,n){Array.from(i.values()).some(e=>e.usvg)?this.rasterize(e,i,r,n):n()}updateImageMapAndGetImageTaskQueue(e,i,r){let n=new Map;for(let o of i.keys())for(let a of r.get(o)||[]){let r=a.toString(),o=i.get(a.id.toString());o.usvg?n.has(r)||(n.set(r,a),e.set(r,Object.assign({},o))):e.set(r,o)}return n}rasterize(e,i,r,n){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:r},(e,r)=>{if(!e)for(let[e,n]of r.entries()){let r=Object.assign(i.get(e),{data:n});i.set(e,r)}n()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function l(i,r,n,o){let a=new e.aa(r,{brightness:n});for(let e of i)e.recalculate(a,o)}class h extends e.E{constructor(i,r,n,o,a,s,l){super(),this.actor=i,this.layerIndex=r,this.availableImages=n,this.availableModels=o,this.loadVectorData=s||e.aJ,this.loading={},this.loaded={},this.deduped=new e.aI(i.scheduler),this.isSpriteLoaded=a,this.scheduler=i.scheduler,this.brightness=l}loadTile(r,n){let o=r.uid,a=r&&r.request,l=a&&a.collectResourceTiming,h=this.loading[o]=new s(r);h.abort=this.loadVectorData(r,(s,u)=>{let c=!this.loading[o];if(delete this.loading[o],h.cancelRasterize(),c||s||!u)return h.status="done",c||(this.loaded[o]=h),n(s);let d=u.rawData,p={};u.expires&&(p.expires=u.expires),u.cacheControl&&(p.cacheControl=u.cacheControl),h.vectorTile=u.vectorTile||new e.fc.VectorTile(new e.bq(d));let f=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(r,o)=>{if(r||!o)return n(r);let s={};if(l){let e=i(a);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}n(null,e.l({rawTileData:d.slice(0)},o,p,s))})};this.isSpriteLoaded?f():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):f()}),this.loaded=this.loaded||{},this.loaded[o]=h})}reloadTile(i,r){let n=this.loaded,o=i.uid;if(n&&n[o]){let a=n[o];a.scaleFactor=i.scaleFactor,a.showCollisionBoxes=i.showCollisionBoxes,a.projection=i.projection,a.brightness=i.brightness,a.tileTransform=e.aW(i.tileID.canonical,i.projection),a.extraShadowCaster=i.extraShadowCaster,a.lut=i.lut;let s=(e,i)=>{let n=a.reloadCallback;n&&(delete a.reloadCallback,a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,n)),r(e,i)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,s):s())}else r(null,void 0)}abortTile(e,i){let r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),i()}removeTile(e,i){let r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],i()}}class u{loadTile(i,r){let{uid:n,encoding:o,rawImageData:a,padding:s}=i,l=ImageBitmap&&a instanceof ImageBitmap?this.getImageData(a,s):a;r(null,new e.fd(n,l,o,s<1))}reloadTile(e,i){i(null,null)}abortTile(e,i){i()}removeTile(e,i){i()}getImageData(e,i){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);let r=this.offscreenCanvasContext.getImageData(-i,-i,e.width+2*i,e.height+2*i);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}e.bp.setPbf(e.bq);class c{constructor(i){this._mrt=new e.bp(i.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=i.uid,this.tileID=i.tileID,this.source=i.source}parse(i,r){let n=this._mrt;this.status="parsing",this._entireBuffer=i;try{n.parseHeader(i),this._isHeaderLoaded=!0;let o=[];for(let r in n.layers){let a=n.getLayer(r),s=a.getDataRange(a.getBandList()),l=n.createDecodingTask(s),h=i.slice(s.firstByte,s.lastByte+1),u=e.bp.performDecoding(h,l).then(e=>l.complete(null,e)).catch(e=>l.complete(e,null));o.push(u)}Promise.allSettled(o).then(()=>r(null,n)).catch(e=>r(e))}catch(e){r(e)}}}class d{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(i,r){let n=i.uid,o=i.request,a=this.loading[n]=new c(i),{cancel:s}=e.br(o,(e,i,o,s)=>{let l=!this.loading[n];if(delete this.loading[n],l||e||!i)return a.status="done",l||(this.loaded[n]=a),r(e);a.parse(i,(e,i)=>{if(e||!i)return r(e);r(null,i,o,s)}),this.loaded[n]=a});a.abort=s}reloadTile(e,i){i(null,void 0)}abortTile(e,i){let r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),i()}removeTile(e,i){let r=e.uid;this.loaded[r]&&delete this.loaded[r],i()}decodeRasterArray(i,r){e.bp.performDecoding(i.buffer,i.task).then(e=>r(null,e)).catch(e=>r(e))}}let p=e.fc.VectorTileFeature.prototype.toGeoJSON;class f{constructor(i){this._feature=i,this.extent=e.aj,this.type=i.type,this.properties=i.tags,"id"in i&&!isNaN(i.id)&&(this.id=parseInt(i.id,10))}loadGeometry(){if(1===this._feature.type){let i=[];for(let r of this._feature.geometry)i.push([new e.P(r[0],r[1])]);return i}{let i=[];for(let r of this._feature.geometry){let n=[];for(let i of r)n.push(new e.P(i[0],i[1]));i.push(n)}return i}}toGeoJSON(e,i,r){return p.call(this,e,i,r)}}class m{constructor(i){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.aj,this.length=i.length,this._features=i}feature(e){return new f(this._features[e])}}let g=64/4096;class _{constructor(){this.features=new Map}clear(){this.features.clear()}load(e=[],i){for(let r of e){let e=r.id;if(null==e)continue;let n=this.features.get(e);n&&this.updateCache(n,i),r.geometry?(n=function(e){let{id:i,geometry:r,properties:n}=e;if(!r)return;if("GeometryCollection"===r.type)throw Error("GeometryCollection not supported in dynamic mode.");let{type:o,coordinates:a}=r,s={id:i,type:1,geometry:[],tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},l=s.geometry;if("Point"===o)v(a,l,s);else if("MultiPoint"===o)for(let e of a)v(e,l,s);else if("LineString"===o)s.type=2,x(a,l,s);else if("MultiLineString"===o)s.type=2,b(a,l,s);else if("Polygon"===o)s.type=3,b(a,l,s,!0);else{if("MultiPolygon"!==o)throw Error("Input data is not a valid GeoJSON object.");for(let e of(s.type=3,a))b(e,l,s,!0)}return s}(r),this.updateCache(n,i),this.features.set(e,n)):this.features.delete(e),this.updateCache(n,i)}}updateCache(e,i){for(let{canonical:r,uid:n}of Object.values(i)){let{z:o,x:a,y:s}=r;y(e,Math.pow(2,o),a,s)&&delete i[n]}}getTile(i,r,n){let o=Math.pow(2,i),a=[];for(let i of this.features.values())y(i,o,r,n)&&a.push(function(i,r,n,o){let{id:a,type:s,geometry:l,tags:h}=i,u=[];if(1===s)for(let i=0;i<l.length;i+=2){let a=Math.round(e.aj*(l[i+0]*r-n)),s=Math.round(e.aj*(l[i+1]*r-o));u.push([a,s])}else for(let i of l)!function(i,r,n,o,a){let s,l=e.aj+128;for(let h=0;h<i.length-2;h+=2){let u=Math.round(e.aj*(i[h+0]*r-n)),c=Math.round(e.aj*(i[h+1]*r-o)),d=Math.round(e.aj*(i[h+2]*r-n)),p=Math.round(e.aj*(i[h+3]*r-o)),f=d-u,m=p-c;u<-128&&d<-128||(u<-128?(c+=Math.round((-128-u)/f*m),u=-128):d<-128&&(p=c+Math.round((-128-u)/f*m),d=-128),c<-128&&p<-128||(c<-128?(u+=Math.round((-128-c)/m*f),c=-128):p<-128&&(d=u+Math.round((-128-c)/m*f),p=-128),u>=l&&d>=l||(u>=l?(c+=Math.round((l-u)/f*m),u=l):d>=l&&(p=c+Math.round((l-u)/f*m),d=l),c>=l&&p>=l||(c>=l?(u+=Math.round((l-c)/m*f),c=l):p>=l&&(d=u+Math.round((l-c)/m*f),p=l),s&&u===s[s.length-1][0]&&c===s[s.length-1][1]||(s=[[u,c]],a.push(s)),s.push([d,p])))))}}(i,r,n,o,u);return{id:a,type:s,geometry:u,tags:h}}(i,o,r,n));return{features:a}}getFeatures(){return[...this.features.values()]}}function y({minX:e,minY:i,maxX:r,maxY:n},o,a,s){return e<(a+1+g)/o&&i<(s+1+g)/o&&r>(a-g)/o&&n>(s-g)/o}function v([i,r],n,o){let a=e.ay(i),s=e.aH(r);s=s<0?0:s>1?1:s,n.push(a,s),o.minX=Math.min(o.minX,a),o.minY=Math.min(o.minY,s),o.maxX=Math.max(o.maxX,a),o.maxY=Math.max(o.maxY,s)}function x(e,i,r,n=!1,o=!1){let a=[];for(let i of e)v(i,a,r);i.push(a),n&&function(e,i){let r=0;for(let i=0,n=e.length,o=n-2;i<n;o=i,i+=2)r+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(r>0===i)for(let i=0,r=e.length;i<r/2;i+=2){let n=e[i],o=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=n,e[r-1-i]=o}}(a,o)}function b(e,i,r,n=!1){for(let o=0;o<e.length;o++)x(e[o],i,r,n,0===o)}var w,T,S,E,I={exports:{}},C=function(){if(E)return I.exports;E=1;var i=e.fg(),r=function(){if(S)return T;S=1;var i=e.fe(),r=e.ff().VectorTileFeature;function n(e,i){this.options=i||{},this.features=e,this.length=e.length}function o(e,i){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=i||4096}return T=n,n.prototype.feature=function(e){return new o(this.features[e],this.options.extent)},o.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],o=[],a=0;a<n.length;a++)o.push(new i(n[a][0],n[a][1]));this.geometry.push(o)}return this.geometry},o.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,i=1/0,r=-1/0,n=1/0,o=-1/0,a=0;a<e.length;a++)for(var s=e[a],l=0;l<s.length;l++){var h=s[l];i=Math.min(i,h.x),r=Math.max(r,h.x),n=Math.min(n,h.y),o=Math.max(o,h.y)}return[i,n,r,o]},o.prototype.toGeoJSON=r.prototype.toGeoJSON,T}();function n(e){var r=new i;return function(e,i){for(var r in e.layers)i.writeMessage(3,o,e.layers[r])}(e,r),r.finish()}function o(e,i){i.writeVarintField(15,e.version||1),i.writeStringField(1,e.name||""),i.writeVarintField(5,e.extent||4096);var r,n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),i.writeMessage(2,a,n);var o=n.keys;for(r=0;r<o.length;r++)i.writeStringField(3,o[r]);var s=n.values;for(r=0;r<s.length;r++)i.writeMessage(4,h,s[r])}function a(e,i){var r=e.feature;void 0!==r.id&&i.writeVarintField(1,r.id),i.writeMessage(2,s,e),i.writeVarintField(3,r.type),i.writeMessage(4,l,r)}function s(e,i){var r=e.feature,n=e.keys,o=e.values,a=e.keycache,s=e.valuecache;for(var l in r.properties){var h=r.properties[l],u=a[l];if(null!==h){void 0===u&&(n.push(l),a[l]=u=n.length-1),i.writeVarint(u);var c=typeof h;"string"!==c&&"boolean"!==c&&"number"!==c&&(h=JSON.stringify(h));var d=c+":"+h,p=s[d];void 0===p&&(o.push(h),s[d]=p=o.length-1),i.writeVarint(p)}}}function l(e,i){for(var r=e.loadGeometry(),n=e.type,o=0,a=0,s=r.length,l=0;l<s;l++){var h=r[l],u=1;1===n&&(u=h.length),i.writeVarint((u<<3)+1);for(var c=3===n?h.length-1:h.length,d=0;d<c;d++){1===d&&1!==n&&i.writeVarint((c-1<<3)+2);var p=h[d].x-o,f=h[d].y-a;i.writeVarint(p<<1^p>>31),i.writeVarint(f<<1^f>>31),o+=p,a+=f}3===n&&i.writeVarint(15)}}function h(e,i){var r=typeof e;"string"===r?i.writeStringField(1,e):"boolean"===r?i.writeBooleanField(7,e):"number"===r&&(e%1!=0?i.writeDoubleField(3,e):e<0?i.writeSVarintField(6,e):i.writeVarintField(5,e))}return I.exports=n,I.exports.fromVectorTileJs=n,I.exports.fromGeojsonVt=function(e,i){i=i||{};var o={};for(var a in e)o[a]=new r(e[a].features,i),o[a].name=a,o[a].version=i.version,o[a].extent=i.extent;return n({layers:o})},I.exports.GeoJSONWrapper=r,I.exports}(),A=e.fh(C);let R={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},M=Math.fround||(w=new Float32Array(1),e=>(w[0]=+e,w[0]));class P{constructor(e){this.options=Object.assign(Object.create(R),e),this.trees=Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){let{log:i,minZoom:r,maxZoom:n}=this.options;i&&console.time("total time");let o=`prepare ${e.length} points`;i&&console.time(o),this.points=e;let a=[];for(let i=0;i<e.length;i++){let r=e[i];if(!r.geometry)continue;let[n,o]=r.geometry.coordinates,s=M(L(n)),l=M(D(o));a.push(s,l,1/0,i,-1,1),this.options.reduce&&a.push(0)}let s=this.trees[n+1]=this._createTree(a);i&&console.timeEnd(o);for(let e=n;e>=r;e--){let r=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),i&&console.log("z%d: %d clusters in %dms",e,s.numItems,Date.now()-r)}return i&&console.timeEnd("total time"),this}getClusters(e,i){let r=((e[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,e[1])),o=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,o=180;else if(r>o){let e=this.getClusters([r,n,180,a],i),s=this.getClusters([-180,n,o,a],i);return e.concat(s)}let s=this.trees[this._limitZoom(i)],l=s.range(L(r),D(a),L(o),D(n)),h=s.data,u=[];for(let e of l){let i=this.stride*e;u.push(h[i+5]>1?O(h,i,this.clusterProps):this.points[h[i+3]])}return u}getChildren(e){let i=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",o=this.trees[r];if(!o)throw Error(n);let a=o.data;if(i*this.stride>=a.length)throw Error(n);let s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),l=o.within(a[i*this.stride],a[i*this.stride+1],s),h=[];for(let i of l){let r=i*this.stride;a[r+4]===e&&h.push(a[r+5]>1?O(a,r,this.clusterProps):this.points[a[r+3]])}if(0===h.length)throw Error(n);return h}getLeaves(e,i,r){let n=[];return this._appendLeaves(n,e,i=i||10,r=r||0,0),n}getTile(e,i,r){let n=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:a,radius:s}=this.options,l=s/a,h=(r-l)/o,u=(r+1+l)/o,c={features:[]};return this._addTileFeatures(n.range((i-l)/o,h,(i+1+l)/o,u),n.data,i,r,o,c),0===i&&this._addTileFeatures(n.range(1-l/o,h,1,u),n.data,o,r,o,c),i===o-1&&this._addTileFeatures(n.range(0,h,l/o,u),n.data,-1,r,o,c),c.features.length?c:null}getClusterExpansionZoom(e){let i=this._getOriginZoom(e)-1;for(;i<=this.options.maxZoom;){let r=this.getChildren(e);if(i++,1!==r.length)break;e=r[0].properties.cluster_id}return i}_appendLeaves(e,i,r,n,o){for(let a of this.getChildren(i)){let i=a.properties;if(i&&i.cluster?o+i.point_count<=n?o+=i.point_count:o=this._appendLeaves(e,i.cluster_id,r,n,o):o<n?o++:e.push(a),e.length===r)break}return o}_createTree(i){let r=new e.bW(i.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<i.length;e+=this.stride)r.add(i[e],i[e+1]);return r.finish(),r.data=i,r}_addTileFeatures(e,i,r,n,o,a){for(let s of e){let e,l,h,u,c=s*this.stride,d=i[c+5]>1;if(d)e=k(i,c,this.clusterProps),l=i[c],h=i[c+1];else{let r=this.points[i[c+3]];e=r.properties;let[n,o]=r.geometry.coordinates;l=L(n),h=D(o)}let p={type:1,geometry:[[Math.round(this.options.extent*(l*o-r)),Math.round(this.options.extent*(h*o-n))]],tags:e};void 0!==(u=d||this.options.generateId?i[c+3]:this.points[i[c+3]].id)&&(p.id=u),a.features.push(p)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,i){let{radius:r,extent:n,reduce:o,minPoints:a}=this.options,s=r/(n*Math.pow(2,i)),l=e.data,h=[],u=this.stride;for(let r=0;r<l.length;r+=u){if(l[r+2]<=i)continue;l[r+2]=i;let n=l[r],c=l[r+1],d=e.within(l[r],l[r+1],s),p=l[r+5],f=p;for(let e of d){let r=e*u;l[r+2]>i&&(f+=l[r+5])}if(f>p&&f>=a){let e,a=n*p,s=c*p,m=-1,g=(r/u<<5)+(i+1)+this.points.length;for(let n of d){let h=n*u;if(l[h+2]<=i)continue;l[h+2]=i;let c=l[h+5];a+=l[h]*c,s+=l[h+1]*c,l[h+4]=g,o&&(e||(e=this._map(l,r,!0),m=this.clusterProps.length,this.clusterProps.push(e)),o(e,this._map(l,h)))}l[r+4]=g,h.push(a/f,s/f,1/0,g,-1,f),o&&h.push(m)}else{for(let e=0;e<u;e++)h.push(l[r+e]);if(f>1)for(let e of d){let r=e*u;if(!(l[r+2]<=i)){l[r+2]=i;for(let e=0;e<u;e++)h.push(l[r+e])}}}}return h}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,i,r){if(e[i+5]>1){let n=this.clusterProps[e[i+6]];return r?Object.assign({},n):n}let n=this.points[e[i+3]].properties,o=this.options.map(n);return r&&o===n?Object.assign({},o):o}}function O(e,i,r){return{type:"Feature",id:e[i+3],properties:k(e,i,r),geometry:{type:"Point",coordinates:[360*(e[i]-.5),360*Math.atan(Math.exp((180-360*e[i+1])*Math.PI/180))/Math.PI-90]}}}function k(e,i,r){let n=e[i+5],o=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,a=e[i+6];return Object.assign(-1===a?{}:Object.assign({},r[a]),{cluster:!0,cluster_id:e[i+3],point_count:n,point_count_abbreviated:o})}function L(e){return e/360+.5}function D(e){let i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function z(e,i,r,n){let o={id:e??null,type:i,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===i||"MultiPoint"===i||"LineString"===i)F(o,r);else if("Polygon"===i)F(o,r[0]);else if("MultiLineString"===i)for(let e of r)F(o,e);else if("MultiPolygon"===i)for(let e of r)F(o,e[0]);return o}function F(e,i){for(let r=0;r<i.length;r+=3)e.minX=Math.min(e.minX,i[r]),e.minY=Math.min(e.minY,i[r+1]),e.maxX=Math.max(e.maxX,i[r]),e.maxY=Math.max(e.maxY,i[r+1])}function B(e,i,r,n){if(!i.geometry)return;let o=i.geometry.coordinates;if(o&&0===o.length)return;let a=i.geometry.type,s=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),l=[],h=i.id;if(r.promoteId?h=i.properties[r.promoteId]:r.generateId&&(h=n||0),"Point"===a)N(o,l);else if("MultiPoint"===a)for(let e of o)N(e,l);else if("LineString"===a)j(o,l,s,!1);else if("MultiLineString"===a){if(r.lineMetrics){for(let r of o)j(r,l=[],s,!1),e.push(z(h,"LineString",l,i.properties));return}V(o,l,s,!1)}else if("Polygon"===a)V(o,l,s,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(let o of i.geometry.geometries)B(e,{id:h,geometry:o,properties:i.properties},r,n);return}throw Error("Input data is not a valid GeoJSON object.")}for(let e of o){let i=[];V(e,i,s,!0),l.push(i)}}e.push(z(h,a,l,i.properties))}function N(e,i){i.push(e[0]/360+.5,U(e[1]),0)}function j(e,i,r,n){let o,a,s=0;for(let r=0;r<e.length;r++){let l=e[r][0]/360+.5,h=U(e[r][1]);i.push(l,h,0),r>0&&(s+=n?(o*h-l*a)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(h-a,2))),o=l,a=h}let l=i.length-3;i[2]=1,function e(i,r,n,o){let a=o,s=r+(n-r>>1),l,h=n-r,u=i[r],c=i[r+1],d=i[n],p=i[n+1];for(let e=r+3;e<n;e+=3){let r=function(e,i,r,n,o,a){let s=o-r,l=a-n;if(0!==s||0!==l){let h=((e-r)*s+(i-n)*l)/(s*s+l*l);h>1?(r=o,n=a):h>0&&(r+=s*h,n+=l*h)}return(s=e-r)*s+(l=i-n)*l}(i[e],i[e+1],u,c,d,p);if(r>a)l=e,a=r;else if(r===a){let i=Math.abs(e-s);i<h&&(l=e,h=i)}}a>o&&(l-r>3&&e(i,r,l,o),i[l+2]=a,n-l>3&&e(i,l,n,o))}(i,0,l,r),i[l+2]=1,i.size=Math.abs(s),i.start=0,i.end=i.size}function V(e,i,r,n){for(let o=0;o<e.length;o++){let a=[];j(e[o],a,r,n),i.push(a)}}function U(e){let i=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+i)/(1-i))/Math.PI;return r<0?0:r>1?1:r}function G(e,i,r,n,o,a,s,l){if(n/=i,a>=(r/=i)&&s<n)return e;if(s<r||a>=n)return null;let h=[];for(let i of e){let e=i.geometry,a=i.type,s=0===o?i.minX:i.minY,m=0===o?i.maxX:i.maxY;if(s>=r&&m<n){h.push(i);continue}if(m<r||s>=n)continue;let g=[];if("Point"===a||"MultiPoint"===a){var u=e,c=g,d=r,p=n,f=o;for(let e=0;e<u.length;e+=3){let i=u[e+f];i>=d&&i<=p&&Z(c,u[e],u[e+1],u[e+2])}}else if("LineString"===a)q(e,g,r,n,o,!1,l.lineMetrics);else if("MultiLineString"===a)H(e,g,r,n,o,!1);else if("Polygon"===a)H(e,g,r,n,o,!0);else if("MultiPolygon"===a)for(let i of e){let e=[];H(i,e,r,n,o,!0),e.length&&g.push(e)}if(g.length){if(l.lineMetrics&&"LineString"===a){for(let e of g)h.push(z(i.id,a,e,i.tags));continue}"LineString"!==a&&"MultiLineString"!==a||(1===g.length?(a="LineString",g=g[0]):a="MultiLineString"),"Point"!==a&&"MultiPoint"!==a||(a=3===g.length?"Point":"MultiPoint"),h.push(z(i.id,a,g,i.tags))}}return h.length?h:null}function q(e,i,r,n,o,a,s){let l=$(e),h=0===o?W:X,u,c,d=e.start;for(let p=0;p<e.length-3;p+=3){let f=e[p],m=e[p+1],g=e[p+2],_=e[p+3],y=e[p+4],v=0===o?f:m,x=0===o?_:y,b=!1;s&&(u=Math.sqrt(Math.pow(f-_,2)+Math.pow(m-y,2))),v<r?x>r&&(c=h(l,f,m,_,y,r),s&&(l.start=d+u*c)):v>n?x<n&&(c=h(l,f,m,_,y,n),s&&(l.start=d+u*c)):Z(l,f,m,g),x<r&&v>=r&&(c=h(l,f,m,_,y,r),b=!0),x>n&&v<=n&&(c=h(l,f,m,_,y,n),b=!0),!a&&b&&(s&&(l.end=d+u*c),i.push(l),l=$(e)),s&&(d+=u)}let p=e.length-3,f=e[p],m=e[p+1],g=0===o?f:m;g>=r&&g<=n&&Z(l,f,m,e[p+2]),p=l.length-3,a&&p>=3&&(l[p]!==l[0]||l[p+1]!==l[1])&&Z(l,l[0],l[1],l[2]),l.length&&i.push(l)}function $(e){let i=[];return i.size=e.size,i.start=e.start,i.end=e.end,i}function H(e,i,r,n,o,a){for(let s of e)q(s,i,r,n,o,a,!1)}function Z(e,i,r,n){e.push(i,r,n)}function W(e,i,r,n,o,a){let s=(a-i)/(n-i);return Z(e,a,r+(o-r)*s,1),s}function X(e,i,r,n,o,a){let s=(a-r)/(o-r);return Z(e,i+(n-i)*s,a,1),s}function Y(e,i){let r=[];for(let n=0;n<e.length;n++){let o,a=e[n],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=K(a.geometry,i);else if("MultiLineString"===s||"Polygon"===s)for(let e of(o=[],a.geometry))o.push(K(e,i));else if("MultiPolygon"===s)for(let e of(o=[],a.geometry)){let r=[];for(let n of e)r.push(K(n,i));o.push(r)}r.push(z(a.id,s,o,a.tags))}return r}function K(e,i){let r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(let n=0;n<e.length;n+=3)r.push(e[n]+i,e[n+1],e[n+2]);return r}function J(e,i){if(e.transformed)return e;let r=1<<e.z,n=e.x,o=e.y;for(let a of e.features){let e=a.geometry,s=a.type;if(a.geometry=[],1===s)for(let s=0;s<e.length;s+=2)a.geometry.push(Q(e[s],e[s+1],i,r,n,o));else for(let s=0;s<e.length;s++){let l=[];for(let a=0;a<e[s].length;a+=2)l.push(Q(e[s][a],e[s][a+1],i,r,n,o));a.geometry.push(l)}}return e.transformed=!0,e}function Q(e,i,r,n,o,a){return[Math.round(r*(e*n-o)),Math.round(r*(i*n-a))]}function ee(e,i,r,n,o,a){let s=n*n;if(n>0&&i.size<(o?s:n))return void(r.numPoints+=i.length/3);let l=[];for(let e=0;e<i.length;e+=3)(0===n||i[e+2]>s)&&(r.numSimplified++,l.push(i[e],i[e+1])),r.numPoints++;o&&function(e,i){let r=0;for(let i=0,n=e.length,o=n-2;i<n;o=i,i+=2)r+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(r>0===i)for(let i=0,r=e.length;i<r/2;i+=2){let n=e[i],o=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=n,e[r-1-i]=o}}(l,a),e.push(l)}let et={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ei{constructor(e,i){let r=(i=this.options=function(e,i){for(let r in i)e[r]=i[r];return e}(Object.create(et),i)).debug;if(r&&console.time("preprocess data"),i.maxZoom<0||i.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(i.promoteId&&i.generateId)throw Error("promoteId and generateId cannot be used together.");let n=function(e,i){let r=[];if("FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)B(r,e.features[n],i,n);else B(r,"Feature"===e.type?e:{geometry:e},i);return r}(e,i);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",i.indexMaxZoom,i.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,i){let r=i.buffer/i.extent,n=e,o=G(e,1,-1-r,r,0,-1,2,i),a=G(e,1,1-r,2+r,0,-1,2,i);return(o||a)&&(n=G(e,1,-r,1+r,0,-1,2,i)||[],o&&(n=Y(o,1).concat(n)),a&&(n=n.concat(Y(a,-1)))),n}(n,i)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,i,r,n,o,a,s){let l=[e,i,r,n],h=this.options,u=h.debug;for(;l.length;){n=l.pop(),r=l.pop(),i=l.pop(),e=l.pop();let c=1<<i,d=er(i,r,n),p=this.tiles[d];if(!p&&(u>1&&console.time("creation"),p=this.tiles[d]=function(e,i,r,n,o){let a=i===o.maxZoom?0:o.tolerance/((1<<i)*o.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:r,y:n,z:i,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let i of e)!function(e,i,r,n){let o=i.geometry,a=i.type,s=[];if(e.minX=Math.min(e.minX,i.minX),e.minY=Math.min(e.minY,i.minY),e.maxX=Math.max(e.maxX,i.maxX),e.maxY=Math.max(e.maxY,i.maxY),"Point"===a||"MultiPoint"===a)for(let i=0;i<o.length;i+=3)s.push(o[i],o[i+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)ee(s,o,e,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(let i=0;i<o.length;i++)ee(s,o[i],e,r,"Polygon"===a,0===i);else if("MultiPolygon"===a)for(let i=0;i<o.length;i++){let n=o[i];for(let i=0;i<n.length;i++)ee(s,n[i],e,r,!0,0===i)}if(s.length){let r=i.tags||null;if("LineString"===a&&n.lineMetrics){for(let e in r={},i.tags)r[e]=i.tags[e];r.mapbox_clip_start=o.start/o.size,r.mapbox_clip_end=o.end/o.size}let l={geometry:s,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:r};null!==i.id&&(l.id=i.id),e.features.push(l)}}(s,i,a,o);return s}(e,i,r,n,h),this.tileCoords.push({z:i,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",i,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));let e=`z${i}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(p.source=e,null==o){if(i===h.indexMaxZoom||p.numPoints<=h.indexMaxPoints)continue}else{if(i===h.maxZoom||i===o)continue;if(null!=o){let e=o-i;if(r!==a>>e||n!==s>>e)continue}}if(p.source=null,0===e.length)continue;u>1&&console.time("clipping");let f=.5*h.buffer/h.extent,m=.5-f,g=.5+f,_=1+f,y=null,v=null,x=null,b=null,w=G(e,c,r-f,r+g,0,p.minX,p.maxX,h),T=G(e,c,r+m,r+_,0,p.minX,p.maxX,h);e=null,w&&(y=G(w,c,n-f,n+g,1,p.minY,p.maxY,h),v=G(w,c,n+m,n+_,1,p.minY,p.maxY,h),w=null),T&&(x=G(T,c,n-f,n+g,1,p.minY,p.maxY,h),b=G(T,c,n+m,n+_,1,p.minY,p.maxY,h),T=null),u>1&&console.timeEnd("clipping"),l.push(y||[],i+1,2*r,2*n),l.push(v||[],i+1,2*r,2*n+1),l.push(x||[],i+1,2*r+1,2*n),l.push(b||[],i+1,2*r+1,2*n+1)}}getTile(e,i,r){e*=1,i*=1,r*=1;let{extent:n,debug:o}=this.options;if(e<0||e>24)return null;let a=1<<e,s=er(e,i=i+a&a-1,r);if(this.tiles[s])return J(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",e,i,r);let l,h=e,u=i,c=r;for(;!l&&h>0;)h--,u>>=1,c>>=1,l=this.tiles[er(h,u,c)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",h,u,c),console.time("drilling down")),this.splitTile(l.source,h,u,c,e,i,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?J(this.tiles[s],n):null):null}}function er(e,i,r){return 32*((1<<e)*r+i)+e}function en(e,i){let r=e.tileID.canonical;if(!this._geoJSONIndex)return void i(null,null);let n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return void i(null,null);let o=new m(n.features),a=A(o);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),i(null,{vectorTile:o,rawData:a.buffer})}class eo extends h{constructor(e,i,r,n,o,a,s){super(e,i,r,n,o,en,s),a&&(this.loadGeoJSON=a),this._dynamicIndex=new _}loadData(r,n){let o=r&&r.request,a=o&&o.collectResourceTiming;this.loadGeoJSON(r,(s,l)=>{if(s||!l)return n(s);if("object"!=typeof l)return n(Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));{try{var h,u;if(r.filter){let i=e.X(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw Error(i.value.map(e=>`${e.key}: ${e.message}`).join(", "));l.features=l.features.filter(e=>i.value.evaluate({zoom:0},e))}r.dynamic?("Feature"===l.type&&(l={type:"FeatureCollection",features:[l]}),r.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(l.features,this.loaded),r.cluster&&(l.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=r.cluster?new P(function({superclusterOptions:i,clusterProperties:r}){if(!r||!i)return i;let n={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r);for(let i of l){let[a,s]=r[i],l=e.X(s),h=e.X("string"==typeof a?[a,["accumulated"],["get",i]]:a);n[i]=l.value,o[i]=h.value}return i.map=e=>{s.properties=e;let i={};for(let e of l)i[e]=n[e].evaluate(a,s);return i},i.reduce=(e,i)=>{for(let r of(s.properties=i,l))a.accumulated=e[r],e[r]=o[r].evaluate(a,s)},i}(r)).load(l.features):r.dynamic?this._dynamicIndex:(h=l,u=r.geojsonVtOptions,new ei(h,u))}catch(e){return n(e)}let s={};if(a){let e=i(o);e&&(s.resourceTiming={},s.resourceTiming[r.source]=JSON.parse(JSON.stringify(e)))}n(null,s)}})}reloadTile(e,i){let r=this.loaded;return r&&r[e.uid]?e.partial?i(null,void 0):super.reloadTile(e,i):this.loadTile(e,i)}loadGeoJSON(i,r){if(i.request)e.n(i.request,r);else{if("string"!=typeof i.data)return r(Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(i.data))}catch(e){return r(Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,i){try{i(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){i(e)}}getClusterChildren(e,i){try{i(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){i(e)}}getClusterLeaves(e,i){try{i(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){i(e)}}}class ea{constructor(i,r){this.tileID=new e.aM(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=i.projection,this.brightness=r}parse(i,r,n,o){this.status="parsing";let a=new e.aM(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),s=[],l=r.familiesBySource[n.source],h=new e.f0(a,n.promoteId);h.bucketLayerIDs=[],h.is3DTile=!0,e.fi(i).then(i=>{if(!i)return o(Error("Could not parse tile"));let r=e.fj(i,1/e.cT(n.tileID.canonical)),u=i.json.extensionsUsed&&i.json.extensionsUsed.includes("MAPBOX_mesh_features")||i.json.asset.extras&&i.json.asset.extras.MAPBOX_mesh_features,c=i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression"),d=new e.aa(this.zoom,{brightness:this.brightness});for(let i in l)for(let n of l[i]){let i=n[0];h.bucketLayerIDs.push(n.map(i=>e.C(i.id,i.scope))),i.recalculate(d,[]);let o=new e.fk(n,r,a,u,c,this.brightness,h);u||(o.needsUpload=!0),s.push(o),o.evaluate(i)}this.status="done",o(null,{buckets:s,featureIndex:h,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>o(Error(e.message)))}}class es{constructor(e,i,r,n,o,a,s){this.actor=e,this.layerIndex=i,this.availableImages=r,this.availableModels=n,this.brightness=s,this.loading={},this.loaded={}}loadTile(i,r){let n=i.uid,o=this.loading[n]=new ea(i,this.brightness);e.br(i.request,(e,a)=>{let s=!this.loading[n];return delete this.loading[n],s||e?(o.status="done",s||(this.loaded[n]=o),r(e)):a&&0!==a.byteLength?void o.parse(a,this.layerIndex,i,(e,i)=>{o.status="done",this.loaded=this.loaded||{},this.loaded[n]=o,e||!i?r(e):r(null,i)}):(o.status="done",this.loaded[n]=o,r())})}reloadTile(e,i){let r=this.loaded,n=e.uid;if(r&&r[n]){let o=r[n];o.projection=e.projection,o.brightness=e.brightness,"parsing"===o.status?o.reloadCallback=(r,n)=>{o.reloadCallback&&(delete o.reloadCallback,this.loadTile(e,i)),i(r,n)}:"done"===o.status&&this.loadTile(e,i)}}abortTile(e,i){let r=e.uid;this.loading[r]&&delete this.loading[r],i()}removeTile(e,i){let r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],i()}}class el{constructor(i){this.self=i,this.actor=new e.fm(i,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.projections={},this.defaultProjection=e.ce({name:"mercator"}),this.workerSourceTypes={vector:h,geojson:eo,"raster-dem":u,"raster-array":d,"batched-model":es},this.workerSources={},this.self.registerWorkerSource=(e,i)=>{if(this.workerSourceTypes[e])throw Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=i},this.self.registerRTLTextPlugin=i=>{if(e.fn.isParsed())throw Error("RTL text plugin already registered.");e.fn.applyArabicShaping=i.applyArabicShaping,e.fn.processBidirectionalText=i.processBidirectionalText,e.fn.processStyledBidirectionalText=i.processStyledBidirectionalText}}clearCaches(e,i,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],r()}checkIfReady(e,i,r){r()}setReferrer(e,i){this.referrer=i}spriteLoaded(i,r){this.isSpriteLoaded[i]||(this.isSpriteLoaded[i]={});let{scope:n,isLoaded:o}=r;if(this.isSpriteLoaded[i][n]=o,this.workerSources[i]&&this.workerSources[i][n])for(let r in this.workerSources[i][n]){let a=this.workerSources[i][n][r];for(let i in a){let r=a[i];r instanceof h&&(r.isSpriteLoaded=o,r.fire(new e.A("isSpriteLoaded")))}}}setImages(e,i,r){this.availableImages[e]||(this.availableImages[e]={});let{scope:n,images:o}=i;if(this.availableImages[e][n]=o,this.workerSources[e]&&this.workerSources[e][n]){for(let i in this.workerSources[e][n]){let r=this.workerSources[e][n][i];for(let e in r)r[e].availableImages=o}r()}else r()}setModels(e,{scope:i,models:r},n){if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][i]=r,this.workerSources[e]&&this.workerSources[e][i]){for(let n in this.workerSources[e][i]){let o=this.workerSources[e][i][n];for(let e in o)o[e].availableModels=r}n()}else n()}setProjection(i,r){this.projections[i]=e.ce(r)}setBrightness(e,i,r){this.brightness=i,r()}setLayers(e,i,r){this.getLayerIndex(e,i.scope).replace(i.layers,i.options),r()}updateLayers(e,i,r){this.getLayerIndex(e,i.scope).update(i.layers,i.removedIds,i.options),r()}loadTile(e,i,r){i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source,i.scope).loadTile(i,r)}decodeRasterArray(e,i,r){this.getWorkerSource(e,i.type,i.source,i.scope).decodeRasterArray(i,r)}reloadTile(e,i,r){i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source,i.scope).reloadTile(i,r)}abortTile(e,i,r){this.getWorkerSource(e,i.type,i.source,i.scope).abortTile(i,r)}removeTile(e,i,r){this.getWorkerSource(e,i.type,i.source,i.scope).removeTile(i,r)}removeSource(e,i,r){if(!(this.workerSources[e]&&this.workerSources[e][i.scope]&&this.workerSources[e][i.scope][i.type]&&this.workerSources[e][i.scope][i.type][i.source]))return;let n=this.workerSources[e][i.scope][i.type][i.source];delete this.workerSources[e][i.scope][i.type][i.source],void 0!==n.removeSource?n.removeSource(i,r):r()}loadWorkerSource(e,i,r){try{this.self.importScripts(i.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(i,r,n){try{e.fn.setState(r);let i=e.fn.getPluginURL();if(e.fn.isLoaded()&&!e.fn.isParsed()&&null!=i){this.self.importScripts(i);let r=e.fn.isParsed();n(r?void 0:Error(`RTL Text Plugin failed to import scripts from ${i}`),r)}}catch(e){n(e.toString())}}setDracoUrl(e,i){this.dracoUrl=i}getAvailableImages(e,i){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][i];return r||(r=[]),r}getAvailableModels(e,i){this.availableModels[e]||(this.availableModels[e]={});let r=this.availableModels[e][i];return r||(r={}),r}getLayerIndex(e,i){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][i];return r||((r=this.layerIndexes[e][i]=new n).scope=i),r}getWorkerSource(e,i,r,n){let o=this.workerSources;return o[e]||(o[e]={}),o[e][n]||(o[e][n]={}),o[e][n][i]||(o[e][n][i]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),o[e][n][i][r]||(o[e][n][i][r]=new this.workerSourceTypes[i]({send:(i,r,n,o,a,s)=>this.actor.send(i,r,n,e,a,s),scheduler:this.actor.scheduler},this.getLayerIndex(e,n),this.getAvailableImages(e,n),this.getAvailableModels(e,n),this.isSpriteLoaded[e][n],void 0,this.brightness)),o[e][n][i][r]}rasterizeImagesWorker(e,i,r){let n=new Map;for(let[r,{image:o,imageVariant:a}]of i.tasks.entries()){let s=this.imageRasterizer.rasterize(a,o,i.scope,e);n.set(r,s)}r(void 0,n)}removeRasterizedImages(e,i,r){this.imageRasterizer.removeImagesFromCacheByIds(i.imageIds,i.scope,e),r()}enforceCacheSizeLimit(i,r){e.fo(r)}getWorkerPerformanceMetrics(e,i,r){r(void 0,void 0)}}return e.fl(self)&&(self.worker=new el(self)),el}),n(["./shared"],function(e){let i,r,n;var o="3.12.0";let a={create:"create",load:"load",fullLoad:"fullLoad"},s={mark(e){performance.mark(e)},measure(e,i,r){performance.measure(e,i,r)}};function l(i){let r=i.name.split("?")[0];return e.a(r)&&r.includes("mapbox-gl.js")?"javascript":e.a(r)&&r.includes("mapbox-gl.css")?"css":e.b(r)?"fontRange":e.c(r)?"sprite":e.i(r)?"style":e.d(r)?"tilejson":"other"}var h,u={},c=function(){if(h)return u;function e(e){return!i(e)}function i(i){var n;return"undefined"==typeof window||"undefined"==typeof document?"not a browser":!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,i,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{i=new Worker(n),e=!0}catch(i){e=!1}return i&&i.terminate(),URL.revokeObjectURL(n),e}()?"insufficient worker support":!function(){var e=document.createElement("canvas");e.width=e.height=1;var i=e.getContext("2d");if(!i)return!1;var r=i.getImageData(0,0,1,1);return r&&r.width===e.width}()?"insufficient Canvas/getImageData support":(void 0===r[n=i&&i.failIfMajorPerformanceCaveat]&&(r[n]=function(i){var r,n,o,a=(r=document.createElement("canvas"),(n=Object.create(e.webGLContextAttributes)).failIfMajorPerformanceCaveat=i,r.getContext("webgl2",n));if(!a)return!1;try{o=a.createShader(a.VERTEX_SHADER)}catch(e){return!1}return!(!o||a.isContextLost())&&(a.shaderSource(o,"void main() {}"),a.compileShader(o),!0===a.getShaderParameter(o,a.COMPILE_STATUS))}(n)),r[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support")}h=1,u.supported=e,u.notSupportedReason=i;var r={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},u}();function d(e,i,r){let n=document.createElement(e);return null!=i&&(n.className=i),r&&r.appendChild(n),n}function p(e,i,r){let n=document.createElementNS("http://www.w3.org/2000/svg",e);for(let e of Object.keys(i))n.setAttributeNS(null,e,String(i[e]));return r&&r.appendChild(n),n}let f="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,m=f&&void 0!==f.userSelect?"userSelect":"WebkitUserSelect";function g(){f&&m&&(i=f[m],f[m]="none")}function _(){f&&m&&(f[m]=i)}function y(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",y,!0)}function v(){window.addEventListener("click",y,!0),window.setTimeout(()=>{window.removeEventListener("click",y,!0)},0)}function x(e,i){let r=e.getBoundingClientRect();return T(e,r,i)}function b(e,i){let r=e.getBoundingClientRect(),n=[];for(let o=0;o<i.length;o++)n.push(T(e,r,i[o]));return n}function w(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function T(i,r,n){let o=i.offsetWidth===r.width?1:i.offsetWidth/r.width;return new e.P((n.clientX-r.left)*o,(n.clientY-r.top)*o)}let S="NO_ACCESS_TOKEN";class E{constructor(e,i,r){this._transformRequestFn=e,this._customAccessToken=i,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){let e=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}normalizeStyleURL(i,r){if(!e.f(i))return i;let n=C(i);return n.params.push(`sdk=js-${o}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!e.f(i))return i;let n=C(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeModelURL(i,r){if(!e.f(i))return i;let n=C(i);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||r)}normalizeSourceURL(i,r,n,o){if(!e.f(i))return i;let a=C(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),n&&a.params.push(`language=${n}`),o&&a.params.push(`worldview=${o}`),this._makeAPIURL(a,this._customAccessToken||r)}normalizeIconsetURL(i,r){let n=C(i);return e.f(i)?(n.path=`/styles/v1${n.path}/iconset.pbf`,this._makeAPIURL(n,this._customAccessToken||r)):A(n)}normalizeSpriteURL(i,r,n,o){let a=C(i);return e.f(i)?(a.path=`/styles/v1${a.path}/sprite${r}${n}`,this._makeAPIURL(a,this._customAccessToken||o)):(a.path+=`${r}${n}`,A(a))}normalizeTileURL(i,r,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!e.f(i))return i;let o=C(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||n&&"raster"!==o.authority&&512===n?"@2x":""}${e.m.supported?".webp":"$1"}`),"raster"===o.authority?o.path=`/${e.e.RASTER_URL_PREFIX}${o.path}`:"rasterarrays"===o.authority?o.path=`/${e.e.RASTERARRAYS_URL_PREFIX}${o.path}`:"3dtiles"===o.authority?o.path=`/${e.e.TILES3D_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${e.e.TILE_URL_VERSION}${o.path}`);let a=this._customAccessToken||function(e){for(let i of e){let e=i.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(o.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,a)}canonicalizeTileURL(i,r){let n=C(i);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${e.e.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${n.path.replace(`/${e.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${e.e.TILE_URL_VERSION}/`,"")}`;let a=n.params;return r&&(a=a.filter(e=>!e.match(/^access_token=/))),a.length&&(o+=`?${a.join("&")}`),o}canonicalizeTileset(i,r){let n=!!r&&e.f(r),o=[];for(let r of i.tiles||[])e.h(r)?o.push(this.canonicalizeTileURL(r,n)):o.push(r);return o}_makeAPIURL(i,r){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=C(e.e.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,"http"===i.protocol){let e=i.params.indexOf("secure");e>=0&&i.params.splice(e,1)}if("/"!==o.path&&(i.path=`${o.path}${i.path}`),!e.e.REQUIRE_ACCESS_TOKEN)return A(i);if(r=r||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===r[0])throw Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(e=>-1===e.indexOf("access_token")),i.params.push(`access_token=${r||""}`),A(i)}}let I=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){let i=e.match(I);if(!i)throw Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function A(e){let i=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${i}`}let R="mapbox.eventData";function M(i){if(!i)return null;let r=i.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(e.j(r[1]))}catch(e){return null}}class P{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){let r=M(e.e.ACCESS_TOKEN),n="";return n=r&&r.u?e.k(r.u):e.e.ACCESS_TOKEN||"",i?`${R}.${i}:${n}`:`${R}:${n}`}fetchEventData(){let i=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(i)try{let e=localStorage.getItem(r);e&&(this.eventData=JSON.parse(e));let i=localStorage.getItem(n);i&&(this.anonId=i)}catch(i){e.w("Unable to read from LocalStorage")}}saveEventData(){let i=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),o=this.anonId;if(i&&o)try{localStorage.setItem(n,o),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch(i){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(i,r,n,o){if(!e.e.EVENTS_URL)return;let a=C(e.e.EVENTS_URL);a.params.push(`access_token=${o||e.e.ACCESS_TOKEN||""}`);let s={event:this.type,created:new Date(i).toISOString()},l=r?e.l(s,r):s,h={url:A(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([l])};this.pendingRequest=e.p(h,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(o)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}let O=new class extends P{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(i,r){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(i)&&i.some(i=>e.f(i)||e.h(i))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let r=M(e.e.ACCESS_TOKEN),n=r?r.u:e.e.ACCESS_TOKEN,a=n!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),a=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let e=new Date(this.eventData.lastSuccess),i=new Date(s),r=(s-this.eventData.lastSuccess)/864e5;a=a||r>=1||r<-1||e.getDate()!==i.getDate()}else a=!0;a?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:o,skuId:"01","enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},i):this.processRequests()}},k=O.postTurnstileEvent.bind(O),L=new class extends P{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,n,o){this.skuToken=r,this.errorCb=o,e.e.EVENTS_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(Error(S)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;let{id:r,timestamp:n}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:o,skuId:"01",skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):r&&(this.success[r]=!0)},i))}remove(){this.errorCb=null}},D=L.postMapLoadEvent.bind(L),z=new class extends P{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let r=this.mapInstanceIdMap.get(i);return r||(r=e.u(),this.mapInstanceIdMap.set(i,r)),r}getEventId(e){let i=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,i+1),i}postStyleLoadEvent(i,r){let{map:n,style:o,importedStyles:a}=r;if(!e.e.EVENTS_URL||!i&&!e.e.ACCESS_TOKEN)return;let s=this.getMapInstanceId(n),l={mapInstanceId:s,eventId:this.getEventId(s),style:o};a.length&&(l.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:l},i)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;let{timestamp:i,payload:r}=this.queue.shift();this.postEvent(i,r,()=>{},e)}},F=z.postStyleLoadEvent.bind(z),B=new class extends P{constructor(){super("gljs.performance")}postPerformanceEvent(i,r){e.e.EVENTS_URL&&(i||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},i)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;let{timestamp:r,performanceData:n}=this.queue.shift(),s=function(i){let r=performance.getEntriesByType("resource"),n=performance.getEntriesByType("mark"),s=function(e){let i={};if(e){for(let r in e)if("other"!==r)for(let n of e[r]){let e=`${r}ResolveRangeMin`,o=`${r}ResolveRangeMax`,a=`${r}RequestCount`,s=`${r}RequestCachedCount`;i[e]=Math.min(i[e]||1/0,n.startTime),i[o]=Math.max(i[o]||-1/0,n.responseEnd);let l=e=>{void 0===i[e]&&(i[e]=0),++i[e]};void 0!==n.transferSize&&0===n.transferSize&&l(s),l(a)}}return i}(function(e,i){let r={};if(e)for(let n of e){let e=i(n);void 0===r[e]&&(r[e]=[]),r[e].push(n)}return r}(r,l)),h=window.devicePixelRatio,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection,c=u?u.effectiveType:void 0,d={counters:[],metadata:[],attributes:[]},p=(e,i,r)=>{null!=r&&e.push({name:i,value:r.toString()})};for(let e in s)p(d.counters,e,s[e]);if(i.interactionRange[0]!==1/0&&i.interactionRange[1]!==-1/0&&(p(d.counters,"interactionRangeMin",i.interactionRange[0]),p(d.counters,"interactionRangeMax",i.interactionRange[1])),n)for(let e of Object.keys(a)){let i=a[e],r=n.find(e=>e.name===i);r&&p(d.counters,i,r.startTime)}return p(d.counters,"visibilityHidden",i.visibilityHidden),p(d.attributes,"style",function(i){if(i)for(let r of i){let i=r.name.split("?")[0];if(e.i(i)){let e=i.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(r)),p(d.attributes,"terrainEnabled",i.terrainEnabled?"true":"false"),p(d.attributes,"fogEnabled",i.fogEnabled?"true":"false"),p(d.attributes,"projection",i.projection),p(d.attributes,"zoom",i.zoom),p(d.metadata,"devicePixelRatio",h),p(d.metadata,"connectionEffectiveType",c),p(d.metadata,"navigatorUserAgent",navigator.userAgent),p(d.metadata,"screenWidth",window.screen.width),p(d.metadata,"screenHeight",window.screen.height),p(d.metadata,"windowWidth",window.innerWidth),p(d.metadata,"windowHeight",window.innerHeight),p(d.metadata,"mapWidth",i.width/h),p(d.metadata,"mapHeight",i.height/h),p(d.metadata,"webglRenderer",i.renderer),p(d.metadata,"webglVendor",i.vendor),p(d.metadata,"sdkVersion",o),p(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(n);for(let e of s.metadata);for(let e of s.counters);for(let e of s.attributes);this.postEvent(r,s,()=>{},i)}},N=B.postPerformanceEvent.bind(B),j=new class extends P{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,n,o){if(!e.e.API_URL||!e.e.SESSION_PATH)return;let a=C(e.e.API_URL+e.e.SESSION_PATH);a.params.push(`sku=${r||""}`),a.params.push(`access_token=${o||e.e.ACCESS_TOKEN||""}`);let s={url:A(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(s,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,r,n,o){this.skuToken=r,this.errorCb=o,e.e.SESSION_PATH&&e.e.API_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(Error(S)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;let{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||this.getSession(r,this.skuToken,e=>{e?this.errorCb(e):i&&(this.success[i]=!0)},e)}remove(){this.errorCb=null}},V=j.getSessionAPI.bind(j),U=new Set;function G(e,i){i?U.add(e):U.delete(e)}class q{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,i){this._updatedSourceCaches[e]=i,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){let i=e.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(e.id),this.setDirty()}removeLayer(e){let i=e.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][e.id]=e,this._updatedLayers[i].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){let e={};for(let i in this._updatedLayers)e[i]=e[i]||{},e[i].updatedIds=Array.from(this._updatedLayers[i].values());for(let i in this._removedLayers)e[i]=e[i]||{},e[i].removedIds=Object.keys(this._removedLayers[i]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(i,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(e.I.toString(i)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}class $ extends e.E{constructor(i){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=i,"raster"!==i&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1))}addScope(i){this.loaded.set(i,!1),this.imageProviders.set(i,new Map),this.images.set(i,new Map),this.updatedImages.set(i,new Set),this.callbackDispatchedThisFrame.set(i,new Set),this.patterns.set(i,new Map),this.atlasImage.set(i,new e.r({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);let i=this.atlasTexture.get(e);i&&(i.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,i){this.imageProviders.has(i)||this.imageProviders.set(i,new Map),this.imageProviders.get(i).set(e.id,e)}removeImageProvider(e,i){this.imageProviders.has(i)&&this.imageProviders.get(i).delete(e)}getPendingImageProviders(){let e=[];for(let i of this.imageProviders.values())for(let r of i.values())r.hasPendingRequests()&&e.push(r);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(let e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,i){if(this.loaded.get(i)!==e&&(this.loaded.set(i,e),e)){for(let{ids:e,callback:r}of this.requestors)this._notify(e,i,r);this.requestors=[]}}hasImage(e,i){return!!this.getImage(e,i)}getImage(e,i){return this.images.get(i).get(e.toString())}addImage(e,i,r){this._validate(e,r)&&this.images.get(i).set(e.toString(),r)}_validate(i,r){let n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new e.z(Error(`Image "${i.name}" has invalid "stretchX" value`))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new e.z(Error(`Image "${i.name}" has invalid "stretchY" value`))),n=!1),this._validateContent(r.content,r)||(this.fire(new e.z(Error(`Image "${i.name}" has invalid "content" value`))),n=!1),n}_validateStretch(e,i){if(!e)return!0;let r=0;for(let n of e){if(n[0]<r||n[1]<n[0]||i<n[1])return!1;r=n[1]}return!0}_validateContent(e,i){return!e||4===e.length&&(!!i.usvg||!(e[0]<0)&&!(i.data.width<e[0])&&!(e[1]<0)&&!(i.data.height<e[1])&&!(e[2]<0)&&!(i.data.width<e[2])&&!(e[3]<0)&&!(i.data.height<e[3]))&&!(e[2]<e[0]||e[3]<e[1])}updateImage(e,i,r){r.version=this.images.get(i).get(e.toString()).version+1,this.images.get(i).set(e.toString(),r),this.updatedImages.get(i).add(e),this.removeFromImageRasterizerCache(e,i)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(i,r){"raster"!==this.spriteFormat&&(e.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([i],r))}removeImage(e,i){let r=this.images.get(i),n=r.get(e.toString());r.delete(e.toString()),this.patterns.get(i).delete(e.toString()),this.removeFromImageRasterizerCache(e,i),n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(i){return Array.from(this.images.get(i).keys()).map(i=>e.I.from(i))}getImages(e,i,r){let n=[],o=[],a=this.imageProviders.get(i);for(let r of e){if(!r.iconsetId){n.push(r);continue}let e=a.get(r.iconsetId);e&&(this.getImage(r,i)?o.push(r):e.addPendingRequest(r))}if(0===n.length)return void this._notify(o,i,r);let s=!0,l=!!this.loaded.get(i),h=this.images.get(i);if(!l)for(let e of n)h.has(e.toString())||(s=!1);l||s?this._notify(n,i,r):this.requestors.push({ids:n,scope:i,callback:r})}rasterizeImages(e,i){let r=new Map,{tasks:n,scope:o}=e;for(let[e,i]of n.entries()){let n=this.getImage(i.id,o);n&&r.set(e,{image:n,imageVariant:i})}this._rasterizeImages(o,r,i)}_rasterizeImages(i,r,n){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:i},n);else{let e=new Map;for(let[n,{image:o,imageVariant:a}]of r.entries())e.set(n,this.imageRasterizer.rasterize(a,o,i,0));n(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(i,r,n){let o=this.images.get(r),a=new Map;for(let r of i){if(!o.get(r.toString())){if(r.iconsetId)continue;this.fire(new e.A("styleimagemissing",{id:r.name}))}let i=o.get(r.toString());if(!i){e.w(`Image "${r.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}let n={data:i.usvg?null:i.data.clone(),pixelRatio:i.pixelRatio,sdf:i.sdf,usvg:i.usvg,version:i.version,stretchX:i.stretchX,stretchY:i.stretchY,content:i.content,hasRenderCallback:!!(i.userImage&&i.userImage.render)};i.usvg&&Object.assign(n,{width:i.icon.usvg_tree.width,height:i.icon.usvg_tree.height}),a.set(e.I.toString(r),n)}n(null,a)}getPixelSize(e){let{width:i,height:r}=this.atlasImage.get(e);return{width:i,height:r}}getPattern(i,r,n){let o=i.toString(),a=this.patterns.get(r),s=a.get(o),l=this.getImage(i,r);if(!l)return null;if(s){if(s.position.version===l.version)return s.position;s.position.version=l.version}else{if(l.usvg&&!l.data){let a=this.getPatternInFlightId(o,r);if(this.patternsInFlight.has(a))return null;this.patternsInFlight.add(a);let s=new e.B(i).scaleSelf(e.q.devicePixelRatio),h=new Map([[s.toString(),{image:l,imageVariant:s}]]);return this._rasterizeImages(r,h,(e,i)=>this.storePatternImage(s,r,l,n,i)),null}this.storePattern(i,r,l)}return this._updatePatternAtlas(r,n),a.get(o).position}getPatternInFlightId(i,r){return e.C(i,r)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,i,r,n,o){let a=e.toString(),s=o?o.get(a):void 0;s&&(r.data=s,this.storePattern(e.id,i,r),this._updatePatternAtlas(i,n),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),i)))}storePattern(i,r,n){let o={w:n.data.width+2*e.F,h:n.data.height+2*e.F,x:0,y:0},a=new e.G(o,n,e.F);this.patterns.get(r).set(i.toString(),{bin:o,position:a})}bind(i,r){let n=i.gl,o=this.atlasTexture.get(r);o?this.dirty&&(o.update(this.atlasImage.get(r)),this.dirty=!1):(o=new e.T(i,this.atlasImage.get(r),n.RGBA8),this.atlasTexture.set(r,o)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(i,r){let n=this.patterns.get(i),o=Array.from(n.values()).map(({bin:e})=>e),{w:a,h:s}=e.H(o),l=this.atlasImage.get(i);l.resize({width:a||1,height:s||1});let h=this.images.get(i);for(let[i,{bin:o,position:a}]of n.entries()){let n=a.padding,s=o.x+n,u=o.y+n,c=h.get(i).data,d=c.width,p=c.height;n=n>1?n-1:n,e.r.copy(c,l,{x:0,y:0},{x:s,y:u},{width:d,height:p},r),e.r.copy(c,l,{x:0,y:p-n},{x:s,y:u-n},{width:d,height:n},r),e.r.copy(c,l,{x:0,y:0},{x:s,y:u+p},{width:d,height:n},r),e.r.copy(c,l,{x:d-n,y:0},{x:s-n,y:u},{width:n,height:p},r),e.r.copy(c,l,{x:0,y:0},{x:s+d,y:u},{width:n,height:p},r),e.r.copy(c,l,{x:d-n,y:p-n},{x:s-n,y:u-n},{width:n,height:n},r),e.r.copy(c,l,{x:0,y:p-n},{x:s+d,y:u-n},{width:n,height:n},r),e.r.copy(c,l,{x:0,y:0},{x:s+d,y:u+p},{width:n,height:n},r),e.r.copy(c,l,{x:d-n,y:0},{x:s-n,y:u+p},{width:n,height:n},r)}this.dirty=!0}beginFrame(){for(let e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,i){let r=this.images.get(i);for(let n of e){if(this.callbackDispatchedThisFrame.get(i).has(n.toString()))continue;this.callbackDispatchedThisFrame.get(i).add(n.toString());let e=r.get(n.toString());(function(e){let{userImage:i}=e;return!!(i&&i.render&&i.render())&&(e.data.replace(new Uint8Array(i.data.buffer)),!0)})(e)&&this.updateImage(n,i,e)}}}function H(i){let r=i.key,n=i.value,o=i.valueSpec||{},a=i.objectElementValidators||{},s=i.style,l=i.styleSpec,h=[],u=e.K(n);if("object"!==u)return[new e.V(r,n,`object expected, ${u} found`)];for(let i in n){let u,c=i.split(".")[0];a[c]?u=a[c]:o[c]?u=ec:a["*"]?u=a["*"]:o["*"]&&(u=ec),u?h=h.concat(u({key:(r?`${r}.`:r)+i,value:n[i],valueSpec:o[c]||o["*"],style:s,styleSpec:l,object:n,objectKey:i},n)):h.push(new e.J(r,n[i],`unknown property "${i}"`))}for(let i in o)a[i]||o[i].required&&void 0===o[i].default&&void 0===n[i]&&h.push(new e.V(r,n,`missing required property "${i}"`));return h}function Z(i){let r=i.value,n=i.valueSpec,o=i.style,a=i.styleSpec,s=i.key,l=i.arrayElementValidator||ec;if("array"!==e.K(r))return[new e.V(s,r,`array expected, ${e.K(r)} found`)];if(n.length&&r.length!==n.length)return[new e.V(s,r,`array length ${n.length} expected, length ${r.length} found`)];if(n["min-length"]&&r.length<n["min-length"])return[new e.V(s,r,`array length at least ${n["min-length"]} expected, length ${r.length} found`)];let h={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};a.$version<7&&(h.function=n.function),"object"===e.K(n.value)&&(h=n.value);let u=[];for(let e=0;e<r.length;e++)u=u.concat(l({array:r,arrayIndex:e,value:r[e],valueSpec:h,style:o,styleSpec:a,key:`${s}[${e}]`},!0));return u}function W(i){let r=i.key,n=i.value,o=i.valueSpec,a=e.K(n);if("number"===a&&n!=n&&(a="NaN"),"number"!==a)return[new e.V(r,n,`number expected, ${a} found`)];if("minimum"in o){let a=o.minimum;if("array"===e.K(o.minimum)&&(a=o.minimum[i.arrayIndex]),n<a)return[new e.V(r,n,`${n} is less than the minimum value ${a}`)]}if("maximum"in o){let a=o.maximum;if("array"===e.K(o.maximum)&&(a=o.maximum[i.arrayIndex]),n>a)return[new e.V(r,n,`${n} is greater than the maximum value ${a}`)]}return[]}function X(i){let r=i.valueSpec,n=e.M(i.value.type),o,a,s,l={},h="categorical"!==n&&void 0===i.value.property,u="array"===e.K(i.value.stops)&&"array"===e.K(i.value.stops[0])&&"object"===e.K(i.value.stops[0][0]),c=H({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(i){if("identity"===n)return[new e.V(i.key,i.value,'identity function may not have a "stops" property')];let r=[],o=i.value;return r=r.concat(Z({key:i.key,value:o,valueSpec:i.valueSpec,style:i.style,styleSpec:i.styleSpec,arrayElementValidator:d})),"array"===e.K(o)&&0===o.length&&r.push(new e.V(i.key,o,"array must have at least one stop")),r},default:function(e){return ec({key:e.key,value:e.value,valueSpec:r,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&h&&c.push(new e.V(i.key,i.value,'missing required property "property"')),"identity"===n||i.value.stops||c.push(new e.V(i.key,i.value,'missing required property "stops"')),"exponential"===n&&i.valueSpec.expression&&!e.N(i.valueSpec)&&c.push(new e.V(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(h||e.O(i.valueSpec)?h&&!e.Q(i.valueSpec)&&c.push(new e.V(i.key,i.value,"zoom functions not supported")):c.push(new e.V(i.key,i.value,"property functions not supported"))),("categorical"===n||u)&&void 0===i.value.property&&c.push(new e.V(i.key,i.value,'"property" property is required')),c;function d(i){let n=[],o=i.value,h=i.key;if("array"!==e.K(o))return[new e.V(h,o,`array expected, ${e.K(o)} found`)];if(2!==o.length)return[new e.V(h,o,`array length 2 expected, length ${o.length} found`)];if(u){if("object"!==e.K(o[0]))return[new e.V(h,o,`object expected, ${e.K(o[0])} found`)];if(void 0===o[0].zoom)return[new e.V(h,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new e.V(h,o,"object stop key must have value")];let r=e.M(o[0].zoom);if("number"!=typeof r)return[new e.V(h,o[0].zoom,"stop zoom values must be numbers")];if(s&&s>r)return[new e.V(h,o[0].zoom,"stop zoom values must appear in ascending order")];r!==s&&(s=r,a=void 0,l={}),n=n.concat(H({key:`${h}[0]`,value:o[0],valueSpec:{zoom:{}},style:i.style,styleSpec:i.styleSpec,objectElementValidators:{zoom:W,value:p}}))}else n=n.concat(p({key:`${h}[0]`,value:o[0],valueSpec:{},style:i.style,styleSpec:i.styleSpec},o));return e.S(e.U(o[1]))?n.concat([new e.V(`${h}[1]`,o[1],"expressions are not allowed in function stops.")]):n.concat(ec({key:`${h}[1]`,value:o[1],valueSpec:r,style:i.style,styleSpec:i.styleSpec}))}function p(i,s){let h=e.K(i.value),u=e.M(i.value),c=null!==i.value?i.value:s;if(o){if(h!==o)return[new e.V(i.key,c,`${h} stop domain type must match previous stop domain type ${o}`)]}else o=h;if("number"!==h&&"string"!==h&&"boolean"!==h&&"number"!=typeof u&&"string"!=typeof u&&"boolean"!=typeof u)return[new e.V(i.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==h&&"categorical"!==n){let o=`number expected, ${h} found`;return e.O(r)&&void 0===n&&(o+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(i.key,c,o)]}return"categorical"!==n||"number"!==h||"number"==typeof u&&isFinite(u)&&Math.floor(u)===u?"categorical"!==n&&"number"===h&&"number"==typeof u&&"number"==typeof a&&void 0!==a&&u<a?[new e.V(i.key,c,"stop domain values must appear in ascending order")]:(a=u,"categorical"===n&&u in l?[new e.V(i.key,c,"stop domain values must be unique")]:(l[u]=!0,[])):[new e.V(i.key,c,`integer expected, found ${String(u)}`)]}}function Y(i){let r=("property"===i.expressionContext?e.W:e.X)(e.U(i.value),i.valueSpec);if("error"===r.result)return r.value.map(r=>new e.V(`${i.key}${r.key}`,i.value,r.message));let n=r.value.expression||r.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!n.outputDefined())return[new e.V(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!e.Y(n))return[new e.V(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return function i(r,n){let o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(let e of n.valueSpec.expression.parameters)o.delete(e);if(0===o.size)return[];let a=[];return r instanceof e.$&&o.has(r.name)?[new e.V(n.key,n.value,`["${r.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(r.eachChild(e=>{a.push(...i(e,n))}),a)}(n,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!e.Z(n,["zoom","feature-state"]))return[new e.V(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!e._(n))return[new e.V(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function K(i){let r=i.key,n=i.value,o=i.valueSpec,a=[];return Array.isArray(o.values)?-1===o.values.indexOf(e.M(n))&&a.push(new e.V(r,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(o.values).indexOf(e.M(n))&&a.push(new e.V(r,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),a}function J(i){return e.a1(e.U(i.value))?Y(e.L({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):function i(r){let n=r.value,o=r.key;if("array"!==e.K(n))return[new e.V(o,n,`array expected, ${e.K(n)} found`)];let a=r.styleSpec,s,l=[];if(n.length<1)return[new e.V(o,n,"filter array must have at least 1 element")];switch(l=l.concat(K({key:`${o}[0]`,value:n[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),e.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===e.M(n[1])&&l.push(new e.V(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&l.push(new e.V(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&"string"!==(s=e.K(n[1]))&&l.push(new e.V(`${o}[1]`,n[1],`string expected, ${s} found`));for(let i=2;i<n.length;i++)s=e.K(n[i]),"$type"===e.M(n[1])?l=l.concat(K({key:`${o}[${i}]`,value:n[i],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&l.push(new e.V(`${o}[${i}]`,n[i],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)l=l.concat(i({key:`${o}[${e}]`,value:n[e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":s=e.K(n[1]),2!==n.length?l.push(new e.V(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==s&&l.push(new e.V(`${o}[1]`,n[1],`string expected, ${s} found`))}return l}(i)}function Q(i,r){let n,o=i.key,a=i.style,s=i.layer,l=i.styleSpec,h=i.value,u=i.objectKey,c=l[`${r}_${i.layerType}`];if(!c)return[];let d=u.match(/^(.*)-use-theme$/);if("paint"===r&&d&&c[d[1]])return e.S(h)?[].concat(ec({key:i.key,value:h,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:a,styleSpec:l,expressionContext:"property",propertyType:r,propertyKey:u})):ec({key:o,value:h,valueSpec:{type:"string"},style:a,styleSpec:l});let p=u.match(/^(.*)-transition$/);if("paint"===r&&p&&c[p[1]]&&c[p[1]].transition)return ec({key:o,value:h,valueSpec:l.transition,style:a,styleSpec:l});let f=i.valueSpec||c[u];if(!f)return[new e.J(o,h,`unknown property "${u}"`)];if("string"===e.K(h)&&e.O(f)&&!f.tokens&&(n=/^{([^}]+)}$/.exec(h))){let i=`\`{ "type": "identity", "property": ${n?JSON.stringify(n[1]):'"_"'} }\``;return[new e.V(o,h,`"${u}" does not support interpolation syntax
Use an identity property function instead: ${i}.`)]}let m=[];if("symbol"===i.layerType)"text-field"!==u||!a||a.glyphs||a.imports||m.push(new e.V(o,h,'use of "text-field" requires a style "glyphs" property')),"text-font"===u&&e.a2(e.U(h))&&"identity"===e.M(h.type)&&m.push(new e.V(o,h,'"text-font" does not support identity functions'));else if("model"===i.layerType&&"paint"===r&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&e.O(f)&&(e.a3(f)||e.Q(f))){let i=e.W(e.U(h),f),r=i.value.expression||i.value._styleExpression.expression;r&&!e.Z(r,["measure-light"])&&("model-emissive-strength"===u&&e._(r)&&e.Y(r)||m.push(new e.V(o,h,`${u} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return m.concat(ec({key:i.key,value:h,valueSpec:f,style:a,styleSpec:l,expressionContext:"property",propertyType:r,propertyKey:u}))}function ee(e){return Q(e,"paint")}function et(e){return Q(e,"layout")}function ei(i){let r=[],n=i.value,o=i.key,a=i.style,s=i.styleSpec;n.type||n.ref||r.push(new e.V(o,n,'either "type" or "ref" is required'));let l=e.M(n.type),h=e.M(n.ref);if(n.id){let s=e.M(n.id);for(let l=0;l<i.arrayIndex;l++){let i=a.layers[l];e.M(i.id)===s&&r.push(new e.V(o,n.id,`duplicate layer id "${n.id}", previously used at line ${i.id.__line__}`))}}if("ref"in n){let i;["type","source","source-layer","filter","layout"].forEach(i=>{i in n&&r.push(new e.V(o,n[i],`"${i}" is prohibited for ref layers`))}),a.layers.forEach(r=>{e.M(r.id)===h&&(i=r)}),i?i.ref?r.push(new e.V(o,n.ref,"ref cannot reference another ref layer")):l=e.M(i.type):"string"==typeof h&&r.push(new e.V(o,n.ref,`ref layer "${h}" not found`))}else if("background"!==l&&"sky"!==l&&"slot"!==l)if(n.source){let i=a.sources&&a.sources[n.source],s=i&&e.M(i.type);i?"vector"===s&&"raster"===l?r.push(new e.V(o,n.source,`layer "${n.id}" requires a raster source`)):"raster"===s&&"raster"!==l?r.push(new e.V(o,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==s||n["source-layer"]?"raster-dem"===s&&"hillshade"!==l?r.push(new e.V(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(l)?"line"===l&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&"geojson"===s&&!i.lineMetrics?r.push(new e.V(o,n,`layer "${n.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):"raster-particle"===l&&"raster-array"!==s&&r.push(new e.V(o,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):r.push(new e.V(o,n.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new e.V(o,n,`layer "${n.id}" must specify a "source-layer"`)):r.push(new e.V(o,n.source,`source "${n.source}" not found`))}else r.push(new e.V(o,n,'missing required property "source"'));return r=r.concat(H({key:o,value:n,valueSpec:s.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ec({key:`${o}.type`,value:n.type,valueSpec:s.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:i=>J(e.L({layerType:l},i)),layout:i=>H({layer:n,key:i.key,value:i.value,valueSpec:{},style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":i=>et(e.L({layerType:l},i))}}),paint:i=>H({layer:n,key:i.key,value:i.value,valueSpec:{},style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":i=>ee(e.L({layerType:l,layer:n},i))}})}}))}function er(i){let r=i.value,n=i.key,o=e.K(r);return"string"!==o?[new e.V(n,r,`string expected, ${o} found`)]:[]}let en={promoteId:function i({key:r,value:n}){if("string"===e.K(n))return er({key:r,value:n});if(Array.isArray(n)){let i=[],o=e.U(n),a=e.X(o);return"error"===a.result&&a.value.forEach(n=>{i.push(new e.V(`${r}${n.key}`,null,`${n.message}`))}),e.Z(a.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||i.push(new e.V(`${r}`,null,"promoteId expression should be only feature dependent")),i}{let e=[];for(let o in n)e.push(...i({key:`${r}.${o}`,value:n[o]}));return e}}};function eo(i){let r=i.value,n=i.key,o=i.styleSpec,a=i.style;if(!r.type)return[new e.V(n,r,'"type" is required')];let s=e.M(r.type),l=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(r.url||r.tiles||l.push(new e.J(n,r,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return l.concat(H({key:n,value:r,valueSpec:o[`source_${s.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:en}));case"geojson":if(l=H({key:n,value:r,valueSpec:o.source_geojson,style:a,styleSpec:o,objectElementValidators:en}),r.cluster)for(let e in r.clusterProperties){let[i,o]=r.clusterProperties[e],a="string"==typeof i?[i,["accumulated"],["get",e]]:i;l.push(...Y({key:`${n}.${e}.map`,value:o,expressionContext:"cluster-map"})),l.push(...Y({key:`${n}.${e}.reduce`,value:a,expressionContext:"cluster-reduce"}))}return l;case"video":return H({key:n,value:r,valueSpec:o.source_video,style:a,styleSpec:o});case"image":return H({key:n,value:r,valueSpec:o.source_image,style:a,styleSpec:o});case"canvas":return[new e.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:var h;return K({key:`${n}.type`,value:r.type,valueSpec:{values:(h=o).source.reduce((e,i)=>{let r=h[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e},[])},style:a,styleSpec:o})}}function ea(i){let r=i.value,n=i.styleSpec,o=n.light,a=i.style,s=[],l=e.K(r);if(void 0===r)return s;if("object"!==l)return s.concat([new e.V("light",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/),h=i.match(/^(.*)-use-theme$/);s=s.concat(h&&o[h[1]]?ec({key:i,value:r[i],valueSpec:{type:"string"},style:a,styleSpec:n}):l&&o[l[1]]&&o[l[1]].transition?ec({key:i,value:r[i],valueSpec:n.transition,style:a,styleSpec:n}):o[i]?ec({key:i,value:r[i],valueSpec:o[i],style:a,styleSpec:n}):[new e.V(i,r[i],`unknown property "${i}"`)])}return s}function es(i){let r=i.value,n=[];if(!r)return n;let o=e.K(r);if("object"!==o)return n.concat([new e.V("light-3d",r,`object expected, ${o} found`)]);let a=i.styleSpec,s=a["light-3d"],l=i.key,h=i.style,u=i.style.lights;for(let i of["type","id"])if(!(i in r))return n.concat([new e.V("light-3d",r,`missing property ${i} on light`)]);if(r.type&&u)for(let o=0;o<i.arrayIndex;o++){let i=e.M(r.type),a=u[o];e.M(a.type)===i&&n.push(new e.V(l,r.id,`duplicate light type "${r.type}", previously defined at line ${a.id.__line__}`))}let c=`properties_light_${r.type}`;if(!(c in a))return n.concat([new e.V("light-3d",r,`Invalid light type ${r.type}`)]);let d=a[c];for(let o in r)if("properties"===o){let s=r[o],l=e.K(s);if("object"!==l)return n.concat([new e.V("properties",s,`object expected, ${l} found`)]);for(let r in s)n=n.concat(d[r]?ec({key:r,value:s[r],valueSpec:d[r],style:h,styleSpec:a}):[new e.J(i.key,s[r],`unknown property "${r}"`)])}else{let i=o.match(/^(.*)-transition$/),l=o.match(/^(.*)-use-theme$/);n=n.concat(l&&s[l[1]]?ec({key:o,value:r[o],valueSpec:{type:"string"},style:h,styleSpec:a}):i&&s[i[1]]&&s[i[1]].transition?ec({key:o,value:r[o],valueSpec:a.transition,style:h,styleSpec:a}):s[o]?ec({key:o,value:r[o],valueSpec:s[o],style:h,styleSpec:a}):[new e.J(o,r[o],`unknown property "${o}"`)])}return n}function el(i){let r=i.value,n=i.key,o=i.style,a=i.styleSpec,s=a.terrain,l=[],h=e.K(r);if(void 0===r||"null"===h)return l;if("object"!==h)return l.concat([new e.V("terrain",r,`object expected, ${h} found`)]);for(let i in r){let n=i.match(/^(.*)-transition$/),h=i.match(/^(.*)-use-theme$/);l=l.concat(h&&s[h[1]]?ec({key:i,value:r[i],valueSpec:{type:"string"},style:o,styleSpec:a}):n&&s[n[1]]&&s[n[1]].transition?ec({key:i,value:r[i],valueSpec:a.transition,style:o,styleSpec:a}):s[i]?ec({key:i,value:r[i],valueSpec:s[i],style:o,styleSpec:a}):[new e.J(i,r[i],`unknown property "${i}"`)])}if(r.source){let i=o.sources&&o.sources[r.source],a=i&&e.M(i.type);i?"raster-dem"!==a&&l.push(new e.V(n,r.source,`terrain cannot be used with a source of type ${String(a)}, it only be used with a "raster-dem" source type`)):l.push(new e.V(n,r.source,`source "${r.source}" not found`))}else l.push(new e.V(n,r,'terrain is missing required property "source"'));return l}function eh(i){let r=i.value,n=i.style,o=i.styleSpec,a=o.fog,s=[],l=e.K(r);if(void 0===r)return s;if("object"!==l)return s.concat([new e.V("fog",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/),h=i.match(/^(.*)-use-theme$/);s=s.concat(h&&a[h[1]]?ec({key:i,value:r[i],valueSpec:{type:"string"},style:n,styleSpec:o}):l&&a[l[1]]&&a[l[1]].transition?ec({key:i,value:r[i],valueSpec:o.transition,style:n,styleSpec:o}):a[i]?ec({key:i,value:r[i],valueSpec:a[i],style:n,styleSpec:o}):[new e.J(i,r[i],`unknown property "${i}"`)])}return s}let eu={"*":()=>[],array:Z,boolean:function(i){let r=i.value,n=i.key,o=e.K(r);return"boolean"!==o?[new e.V(n,r,`boolean expected, ${o} found`)]:[]},number:W,color:function(i){let r=i.key,n=i.value,o=e.K(n);return"string"!==o?[new e.V(r,n,`color expected, ${o} found`)]:null===e.a0.parseCSSColor(n)?[new e.V(r,n,`color expected, "${n}" found`)]:[]},enum:K,filter:J,function:X,layer:ei,object:H,source:eo,model:e.a4,light:ea,"light-3d":es,terrain:el,fog:eh,string:er,formatted:function(e){return 0===er(e).length?[]:Y(e)},resolvedImage:function(e){return 0===er(e).length?[]:Y(e)},projection:function(i){let r=i.value,n=i.styleSpec,o=n.projection,a=i.style,s=[],l=e.K(r);if("object"===l)for(let e in r)s=s.concat(ec({key:e,value:r[e],valueSpec:o[e],style:a,styleSpec:n}));else"string"!==l&&(s=s.concat([new e.V("projection",r,`object or string expected, ${l} found`)]));return s},import:function(i){let{value:r,styleSpec:n}=i,{data:o,...a}=r;Object.defineProperty(a,"__line__",{value:r.__line__,enumerable:!1});let s=H(e.L({},i,{value:a,valueSpec:n.import}));return""===e.M(a.id)&&s.push(new e.V(`${i.key}.id`,a,"import id can't be an empty string")),o&&(s=s.concat(ep(o,n,{key:`${i.key}.data`}))),s},iconset:function(i){let r=i.value,n=i.key,o=i.styleSpec,a=i.style;if(!r.type)return[new e.V(n,r,'"type" is required')];let s=e.M(r.type),l=[];if(l=l.concat(H({key:n,value:r,valueSpec:o[`iconset_${s}`],style:a,styleSpec:o})),"source"===s&&r.source){let i=a.sources&&a.sources[r.source],o=i&&e.M(i.type);i?"raster-array"!==o&&l.push(new e.V(n,r.source,`iconset cannot be used with a source of type ${String(o)}, it only be used with a "raster-array" source type`)):l.push(new e.V(n,r.source,`source "${r.source}" not found`))}return l}};function ec(i,r=!1){let n=i.value,o=i.valueSpec,a=i.styleSpec;if(o.expression&&e.a2(e.M(n)))return X(i);if(o.expression&&e.S(e.U(n)))return Y(i);if(o.type&&eu[o.type]){let n=eu[o.type](i);return!0===r&&n.length>0&&"array"===e.K(i.value)?Y(i):n}return H(e.L({},i,{valueSpec:o.type?a[o.type]:o}))}function ed(i){let r=i.value,n=i.key,o=er(i);return o.length||(-1===r.indexOf("{fontstack}")&&o.push(new e.V(n,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&o.push(new e.V(n,r,'"glyphs" url must include a "{range}" token'))),o}function ep(i,r=e.a5,n={}){return ec({key:n.key||"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:ed,"*":()=>[]}})}function ef(i,r=e.a5){return eC(ep(i,r))}let em=e=>eC(eo(e)),eg=e=>eC(ea(e)),e_=e=>eC(es(e)),ey=e=>eC(el(e)),ev=e=>eC(eh(e)),ex=i=>eC(function(i){let r=i.value,n=i.style,o=i.styleSpec,a=o.snow,s=[],l=e.K(r);if(void 0===r)return s;if("object"!==l)return s.concat([new e.V("snow",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/);s=s.concat(l&&a[l[1]]&&a[l[1]].transition?ec({key:i,value:r[i],valueSpec:o.transition,style:n,styleSpec:o}):a[i]?ec({key:i,value:r[i],valueSpec:a[i],style:n,styleSpec:o}):[new e.J(i,r[i],`unknown property "${i}"`)])}return s}(i)),eb=i=>eC(function(i){let r=i.value,n=i.style,o=i.styleSpec,a=o.rain,s=[],l=e.K(r);if(void 0===r)return s;if("object"!==l)return s.concat([new e.V("rain",r,`object expected, ${l} found`)]);for(let i in r){let l=i.match(/^(.*)-transition$/);s=s.concat(l&&a[l[1]]&&a[l[1]].transition?ec({key:i,value:r[i],valueSpec:o.transition,style:n,styleSpec:o}):a[i]?ec({key:i,value:r[i],valueSpec:a[i],style:n,styleSpec:o}):[new e.J(i,r[i],`unknown property "${i}"`)])}return s}(i)),ew=e=>eC(ei(e)),eT=e=>eC(J(e)),eS=e=>eC(ee(e)),eE=e=>eC(et(e)),eI=i=>eC(e.a4(i));function eC(e){return e.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function eA(i,r){let n=!1;if(r&&r.length)for(let o of r)o instanceof e.J?e.w(o.message):(i.fire(new e.z(Error(o.message))),n=!0);return n}class eR extends e.E{constructor(i,n="flat"){super(),this._transitionable=new e.a6(r||(r=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(i,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i,r={}){this._validate(eg,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=i)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(i,r,n){return(!n||!1!==n.validate)&&eA(this,i.call(ef,e.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let eM=class extends e.E{constructor(i,r,n,o){super(),this.scope=n,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),n,o),this._transitionable.setTransitionOrValue(i,o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(e,i){this._transitionable.setTransitionOrValue(e,i)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(i){return this._transitioning.possiblyEvaluate(new e.aa(i)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let i=this._transitionable._values.exaggeration;if(!i)return null;let r=i.value.expression;if(!r)return null;let n=-1,o=-1,a=1;for(let i of r.zoomStops)(a=r.evaluate(new e.aa(i)))>.01?(n=i,o=-1):o=i;return a<.01&&n>0&&o>n?[n,o]:null}isZoomDependent(){let i=this._transitionable._values.exaggeration;return null!=i&&null!=i.value&&null!=i.value.expression&&i.value.expression instanceof e.ab}};function eP(i,r,n,o){let a=e.af(45,65,n),[s,l]=eO(i,o),h=1-Math.min(1,Math.exp(-((r-s)/(l-s)*6)));return h*=h*h,(h=Math.min(1,1.00747*h))*a*i.alpha}function eO(e,i){let r=.5/Math.tan(.5*i);return[e.range[0]+r,e.range[1]+r]}function ek(i,r,n,o,a){let s=e.ad([],[r,n,o],a.mercatorFogMatrix);return eP(i,e.ae(s),a.pitch,a._fov)}function eL(i,r,n,o,a,s,l){let h=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let i of[[n,o,0],[a,o,0],[a,s,0],[n,s,0]]){let n=e.ad([],i,r),o=e.ae(n);h=Math.min(h,o),u=Math.max(u,o)}return[eP(i,h,l.pitch,l._fov),eP(i,u,l.pitch,l._fov)]}class eD extends e.E{constructor(i,r,n,o){super();let a=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(a,n,new Map(o)),this.set(i,o),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new e.ag(a),this.scope=n}get state(){let i=this._transform,r="globe"===i.projection.name,n=e.ah(i.zoom),o=this.properties.get("range");return{range:r?[e.ai(.5,o[0],n),e.ai(3,o[1],n)]:o,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,r,n={}){if(this._validate(ev,i,n))return;let o=e.l({},i);for(let i of Object.keys(e.a5.fog))void 0===o[i]&&(o[i]=e.a5.fog[i].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;let r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.af(45,65,i))*r.a}getOpacityAtLatLng(i,r){return this._transform.projection.supportsFog?function(i,r,n){let o=e.ac.fromLngLat(r),a=n.elevation?n.elevation.getAtPointOrZero(o):0;return ek(i,o.x,o.y,a,n)}(this.state,i,r):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];let r=this._transform.calculateFogTileMatrix(i.toUnwrapped());return eL(this.state,r,0,0,e.aj,e.aj,this._transform)}getOpacityForBounds(e,i,r,n,o){return this._transform.projection.supportsFog?eL(this.state,e,i,r,n,o,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?eO(this.state,e):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;for(let r of[4,5,6,7]){let n,o=i.points[r];if(o[2]>=0)n=o;else{let a=i.points[r-4];n=e.ak(a,o,a[2]/(a[2]-o[2]))}if(ek(this.state,n[0],n[1],0,this._transform)>=.05)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(i,r,n){return(!n||!1!==n.validate)&&eA(this,i.call(ef,e.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let ez,eF,eB,eN,ej=class extends e.E{constructor(i,r,n,o){super();let a=ez||(ez=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(a,n,new Map(o)),this.set(i,o),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(a),this.scope=n}get state(){let i=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),o=e.al(n[0]),a=-Math.max(e.al(n[1]),.01),s=[Math.cos(o)*Math.cos(a),Math.sin(o)*Math.cos(a),Math.sin(a)],l=this.properties.get("vignette"),h=this.properties.get("vignette-color");return h.a=l,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(r.r,r.g,r.b,r.a*i),direction:s,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:h}}get(){return this._transitionable.serialize()}set(i,r,n={}){if(this._validate(ex,i,n))return;let o=e.l({},i);for(let i of Object.keys(e.a5.snow))void 0===o[i]&&(o[i]=e.a5.snow[i].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(i,r,n){return(!n||!1!==n.validate)&&eA(this,i.call(ef,e.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},eV=class extends e.E{constructor(i,r,n,o){super();let a=eF||(eF=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(a,n,new Map(o)),this.set(i,o),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(a),this.scope=n}get state(){let i=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),o=e.al(n[0]),a=-Math.max(e.al(n[1]),.01),s=[Math.cos(o)*Math.cos(a),Math.sin(o)*Math.cos(a),Math.sin(a)],l=this.properties.get("vignette-color");return l.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(r.r,r.g,r.b,r.a*i),direction:s,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(i,r,n={}){if(this._validate(eb,i,n))return;let o=e.l({},i);for(let i of Object.keys(e.a5.rain))void 0===o[i]&&(o[i]=e.a5.rain[i].default);this._options=o,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(i,r,n){return(!n||!1!==n.validate)&&eA(this,i.call(ef,e.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class eU extends e.E{constructor(i,r,n,o){super(),this.scope=n,this._options=i,this.properties=new e.ag(r),this._transitionable=new e.a6(r,n,new Map(o)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,i){this._options=e,this._transitionable.setTransitionOrValue(e.properties,i)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class eG{constructor(e,i,r,n){this.screenBounds=e,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(i,r){let n,o;if(i instanceof e.P||"number"==typeof i[0]){let a=e.P.convert(i);n=[a],o=r.isPointAboveHorizon(a)}else{let a=e.P.convert(i[0]),s=e.P.convert(i[1]),l=a.add(s)._div(2);n=[a,s],o=e.ao(a,s).every(e=>r.isPointAboveHorizon(e))&&r.isPointAboveHorizon(l)}return new eG(n,r.getCameraPoint(),o,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return e.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){let r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],o=e.ao(r,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<n.x?o.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?o[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(o[3]=this.cameraPoint)),e.ap(o,i)}bufferedCameraGeometryGlobe(i){let r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],o=e.ao(r,n,i),a=this.cameraPoint.clone();switch(3*((a.y>r.y)+(a.y>n.y))+((a.x>r.x)+(a.x>n.x))){case 0:o[0]=a,o[4]=a.clone();break;case 1:o.splice(1,0,a);break;case 2:o[1]=a;break;case 3:o.splice(4,0,a);break;case 5:o.splice(2,0,a);break;case 6:o[3]=a;break;case 7:o.splice(3,0,a);break;case 8:o[2]=a}return o}containsTile(i,r,n,o=0){var a;let s=i.queryPadding/r._pixelsPerMercatorPixel+1,l=n?this._bufferedCameraMercator(s,r):this._bufferedScreenMercator(s,r),h=i.tileID.wrap+(l.unwrapped?o:0),u=l.polygon.map(r=>e.aq(i.tileTransform,r,h));if(!e.ar(u,0,0,e.aj,e.aj))return;h=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?o:0);let c=this.screenGeometryMercator.polygon.map(r=>e.as(i.tileTransform,r,h)),d=c.map(i=>new e.P(i[0],i[1])),p=r.getFreeCameraOptions().position||new e.ac(0,0,0),f=e.as(i.tileTransform,p,h),m=c.map(i=>{let r=e.at(i,i,f);return e.au(r,r),new e.av(f,r)}),g=e.aw(i,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:d,tilespaceRays:m,bufferedTilespaceGeometry:u,bufferedTilespaceBounds:((a=e.ax(u)).min.x=e.aD(a.min.x,0,e.aj),a.min.y=e.aD(a.min.y,0,e.aj),a.max.x=e.aD(a.max.x,0,e.aj),a.max.y=e.aD(a.max.y,0,e.aj),a),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:g}}_bufferedScreenMercator(e,i){let r=100*e|0;if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n="globe"===i.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),i):{polygon:this.bufferedScreenGeometry(e).map(e=>i.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,i){let r=100*e|0;if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n="globe"===i.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),i):{polygon:this.bufferedCameraGeometry(e).map(e=>i.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(i,r){let n=function(i,r){let n=e.az([],r.pixelMatrix,r.globeMatrix),o=[0,-e.aE,0,1],a=[0,e.aE,0,1],s=[0,0,0,1];e.aA(o,o,n),e.aA(a,a,n),e.aA(s,s,n);let l=new e.P(o[0]/o[3],o[1]/o[3]),h=new e.P(a[0]/a[3],a[1]/a[3]),u=e.aB(i,l)&&o[3]<s[3],c=e.aB(i,h)&&a[3]<s[3];if(!u&&!c)return null;let d=function(e,i,r){for(let n=1;n<e.length;n++){let o=e$(i.pointCoordinate3D(e[n-1]).x),a=e$(i.pointCoordinate3D(e[n]).x);if(r<0){if(o<a)return{idx:n,t:-o/(a-1-o)}}else if(a<o)return{idx:n,t:(1-o)/(a+1-o)}}return null}(i,r,u?-1:1);if(!d)return null;let{idx:p,t:f}=d,m=p>1?eq(i.slice(0,p),r):[],g=p<i.length?eq(i.slice(p),r):[];m=m.map(i=>new e.P(e$(i.x),i.y)),g=g.map(i=>new e.P(e$(i.x),i.y));let _=[...m];0===_.length&&_.push(g[g.length-1]);let y=e.ai(_[_.length-1].y,(0===g.length?m[0]:g[0]).y,f);return _.push(...u?[new e.P(0,y),new e.P(0,0),new e.P(1,0),new e.P(1,y)]:[new e.P(1,y),new e.P(1,1),new e.P(0,1),new e.P(0,y)]),0===g.length?_.push(m[0]):_.push(...g),{polygon:_.map(i=>new e.ac(i.x,i.y)),unwrapped:!1}}(i,r);if(n)return n;let o=function(i,r){let n=!1,o=-1/0,a=0;for(let e=0;e<i.length-1;e++)i[e].x>o&&(o=i[e].x,a=e);for(let e=0;e<i.length-1;e++){let r=(a+e)%(i.length-1),o=i[r],s=i[r+1];Math.abs(o.x-s.x)>.5&&(o.x<s.x?(o.x+=1,0===r&&(i[i.length-1].x+=1)):(s.x+=1,r+1===i.length-1&&(i[0].x+=1)),n=!0)}let s=e.ay(r.center.lng);return n&&s<Math.abs(s-1)&&i.forEach(e=>{e.x-=1}),{polygon:i,unwrapped:n}}(eq(i,r).map(i=>new e.P(e$(i.x),i.y)),r);return{polygon:o.polygon.map(i=>new e.ac(i.x,i.y)),unwrapped:o.unwrapped}}}function eq(i,r){return e.aC(i,e=>{let i=r.pointCoordinate3D(e);e.x=i.x,e.y=i.y},1/256)}function e$(e){return e<0?1+e%1:e%1}function eH(i,r,n,o,a){let s=function(n,o){if(n)return a(n);if(o){if(i.url&&o.tiles&&i.tiles&&delete i.tiles,o.variants){if(!Array.isArray(o.variants))return a(Error("variants must be an array"));for(let i of o.variants){if(null==i||"object"!=typeof i||i.constructor!==Object)return a(Error("variant must be an object"));if(!Array.isArray(i.capabilities))return a(Error("capabilities must be an array"));if(1===i.capabilities.length&&"meshopt"===i.capabilities[0]){o=e.l(o,i);break}}}let n=e.aF(e.l({},o,i),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);n.tiles=r.canonicalizeTileset(n,i.url),a(null,n)}},l=function(e,i,r){if(!e)return null;if(!i&&!r)return e;r=r||e.worldview_default;let n=Object.values(e.language||{});if(0===n.length)return null;let o=Object.values(e.worldview||{});if(0===o.length)return null;let a=n.every(e=>e===i),s=o.every(e=>e===r);return a&&s?e:i in(e.language_options||{})||r in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(i.data,n,o);return l?e.q.frame(()=>s(null,l)):i.url?e.n(r.transformRequest(r.normalizeSourceURL(i.url,null,n,o),e.R.Source),s):e.q.frame(()=>{let{data:e,...r}=i;s(null,r)})}function eZ(i,r){let n=Math.pow(2,r.z),o=Math.floor(e.ay(i.getWest())*n),a=Math.floor(e.aH(i.getNorth())*n),s=Math.ceil(e.ay(i.getEast())*n),l=Math.ceil(e.aH(i.getSouth())*n);return r.x>=o&&r.x<s&&r.y>=a&&r.y<l}class eW{constructor(i,r,n){this.bounds=i?e.aG.convert(this.validateBounds(i)):null,this.minzoom=r||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(i){if(i)for(let r of(this.extraBounds||(this.extraBounds=[]),i))this.extraBounds.push(e.aG.convert(this.validateBounds(r)))}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom||this.bounds&&!eZ(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(let i of this.extraBounds)if(eZ(i,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;let i=new eW(e.bounds,e.minzoom,e.maxzoom);return i.addExtraBounds(e.extra_bounds),i}}class eX extends e.E{constructor(i,r,n,o){if(super(),this.id=i,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.l(this,e.aF(r,["url","scheme","tileSize","promoteId"])),this._options=e.l({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o),this._tileWorkers={},this._deduped=new e.aI}load(i){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=eH(this._options,this.map._requestManager,r,n,(o,a)=>{if(this._tileJSONRequest=null,this._loaded=!0,o)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),n&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.z(o));else if(a){if(e.l(this,a),this.hasWorldviews=!!a.worldview_options,a.worldview_default&&(this.worldviewDefault=a.worldview_default),a.vector_layers)for(let e of(this.vectorLayers=a.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set,a.vector_layers))this.vectorLayerIds.push(e.id),a.worldview&&a.worldview[e.source]&&this.localizableLayerIds.add(e.id);this.tileBounds=eW.fromTileJSON(a),k(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}i&&i(o)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let i=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.l({},this._options)}loadTile(i,r){let n=i.tileID.canonical.url(this.tiles,this.scheme),o=this.map._requestManager.normalizeTileURL(n),a=this.map._requestManager.transformRequest(o,e.R.Tile),s=this.map.style?this.map.style.getLut(this.scope):null,l=s?{image:s.image.clone()}:null,h={request:a,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:l,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&e.f(n)&&(h.worldview=this.map.getWorldview()||this.worldviewDefault,h.localizableLayerIds=this.localizableLayerIds),h.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=r:i.request=i.actor.send("reloadTile",h,u.bind(this));else if(i.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",h,u.bind(this),void 0,!0);else{let r=e.aJ.call({deduped:this._deduped},h,(e,r)=>{e||!r?u.call(this,e):(h.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},i.actor&&i.actor.send("loadTile",h,u.bind(this),void 0,!0))},!0);i.request={cancel:r}}function u(n,o){return delete i.request,i.aborted?r(null):n&&404!==n.status?r(n):(o&&o.resourceTiming&&(i.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&o&&i.setExpiryData(o),i.loadVectorData(o,this.map.painter),e.aK(this.dispatcher),r(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,i){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class eY extends e.E{constructor(i,r,n,o){super(),this.id=i,this.dispatcher=n,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.l({type:"raster"},r),e.l(this,e.aF(r,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._tileJSONRequest=eH(this._options,this.map._requestManager,null,null,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new e.z(r)):n&&(e.l(this,n),n.raster_layers&&(this.rasterLayers=n.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=eW.fromTileJSON(n),k(n.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),i&&i(r)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let i=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return e.l({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(i,r){let n=e.q.devicePixelRatio>=2,o=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);i.request=e.o(this.map._requestManager.transformRequest(o,e.R.Tile),(n,o,a,s)=>(delete i.request,i.aborted?(i.state="unloaded",r(null)):n?(i.state="errored",r(n)):o?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:a,expires:s}),i.setTexture(o,this.map.painter),i.state="loaded",e.aK(this.dispatcher),void r(null)):r(null)))}abortTile(e,i){e.request&&(e.request.cancel(),delete e.request),i&&i()}unloadTile(i,r){i.texture&&i.texture instanceof e.T?(i.destroy(!0),i.texture&&i.texture instanceof e.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class eK extends eY{constructor(i,r,n,o){super(i,r,n,o),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.l({type:"raster-array"},r)}triggerRepaint(e){let i=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);i&&i.enabled&&r&&i._clearRenderCacheForTile(r.id,e.tileID),this.map.triggerRepaint()}loadTile(i,r){let n=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),o=this.map._requestManager.transformRequest(n,e.R.Tile),a={request:o,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};i.source=this.id,i.scope=this.scope,i.requestParams=o,i.actor||(i.actor=this.dispatcher.getActor());let s=(e,n,o,a)=>{if(delete i.request,i.aborted)return i.state="unloaded",r(null);if(e){if("AbortError"===e.name)return;return i.state="errored",r(e)}if(this.map._refreshExpiredTiles&&n&&i.setExpiryData({cacheControl:o,expires:a}),this.partial)i.state="empty";else{if(!n)return r(null);i.state="loaded",i._isHeaderLoaded=!0,i._mrt=n}r(null)};i.request=this.partial?i.fetchHeader(void 0,s.bind(this)):i.actor.send("loadTile",a,s.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,r){let n=i.texture;n&&n instanceof e.T?(i.destroy(!0),this.map.painter.saveTileTexture(n)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,r,n){i._isHeaderLoaded&&("empty"!==i.state&&(i.state="reloading"),i.fetchBand(r,n,(r,n)=>{if(r)return i.state="errored",this.fire(new e.z(r)),void this.triggerRepaint(i);n&&(i._isHeaderLoaded=!0,i.setTexture(n,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(e){if(!this.rasterLayers)return 0;let i=this.rasterLayers.find(({id:i})=>i===e),r=i&&i.fields,n=r&&r.bands&&r.bands;return n?n[0]:0}getTextureDescriptor(i,r,n){if(!i)return;let o=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!o)return;let a=null;r instanceof e.aN?a=r.paint.get("raster-array-band"):r instanceof e.aO&&(a=r.paint.get("raster-particle-array-band"));let s=a||this.getInitialBand(o);if(null!=s)if(i.textureDescriptor){if(!i.updateNeeded(o,s)||n)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,o,s)}getImages(i,r){let n=new Map;for(let o of i)for(let i of r){let[r,a]=i.split("/"),s=o.getLayer(r);if(!s||!s.hasBand(a)||!s.hasDataForBand(a))continue;let{bytes:l,tileSize:h,buffer:u}=s.getBandView(a),c=h+2*u,d={data:new e.r({width:c,height:c},l),pixelRatio:2,sdf:!1,usvg:!1,version:0};n.set(i,d)}return n}}let eJ={vector:eX,raster:eY,"raster-dem":class extends eY{constructor(i,r,n,o){super(i,r,n,o),this.type="raster-dem",this.maxzoom=22,this._options=e.l({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(i,r){let n=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function o(e,n){e&&(i.state="errored",r(e)),n&&(i.dem=n,i.dem.onDeserialize(),i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0,i.state="loaded",r(null))}i.request=e.o(this.map._requestManager.transformRequest(n,e.R.Tile),(function(n,a,s,l){if(delete i.request,i.aborted)i.state="unloaded",r(null);else if(n)i.state="errored",r(n);else if(a){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:s,expires:l});let r=ImageBitmap&&a instanceof ImageBitmap&&e.t(),n=1-(a.width-e.aL(a.width))/2;n<1||i.neighboringTiles||(i.neighboringTiles=this._getNeighboringTiles(i.tileID));let h=r?a:e.q.getImageData(a,n),u={uid:i.uid,tileID:i.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:h,encoding:this.encoding,padding:n};i.actor&&"expired"!==i.state||(i.actor=this.dispatcher.getActor(),i.actor.send("loadTile",u,o.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(i){let r=i.canonical,n=Math.pow(2,r.z),o=(r.x-1+n)%n,a=0===r.x?i.wrap-1:i.wrap,s=(r.x+1+n)%n,l=r.x+1===n?i.wrap+1:i.wrap,h={};return h[new e.aM(i.overscaledZ,a,r.z,o,r.y).key]={backfilled:!1},h[new e.aM(i.overscaledZ,l,r.z,s,r.y).key]={backfilled:!1},r.y>0&&(h[new e.aM(i.overscaledZ,a,r.z,o,r.y-1).key]={backfilled:!1},h[new e.aM(i.overscaledZ,i.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},h[new e.aM(i.overscaledZ,l,r.z,s,r.y-1).key]={backfilled:!1}),r.y+1<n&&(h[new e.aM(i.overscaledZ,a,r.z,o,r.y+1).key]={backfilled:!1},h[new e.aM(i.overscaledZ,i.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},h[new e.aM(i.overscaledZ,l,r.z,s,r.y+1).key]={backfilled:!1}),h}},"raster-array":eK,geojson:class extends e.E{constructor(i,r,n,o){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(o),this._data=r.data,this._options=e.l({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;let a=e.aj/this.tileSize;this.workerOptions=e.l({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:e.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.aj,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(i){if(!this._options.dynamic)return this.fire(new e.z(Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof i&&("Feature"===i.type&&(i={type:"FeatureCollection",features:[i]}),"FeatureCollection"!==i.type))return this.fire(new e.z(Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof i&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){let e=new Map;for(let i of this._data.features)e.set(i.id,i);for(let r of i.features)e.set(r.id,r);this._data.features=[...e.values()]}else this._data=i;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},i),this}getClusterChildren(e,i){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},i),this}getClusterLeaves(e,i,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:i,offset:r},n),this}_updateWorkerData(i=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;let r=e.l({append:i},this.workerOptions);r.scope=this.scope;let n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(e.q.resolveURL(n),e.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(r,n)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new e.z(r));else{let r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(r.resourceTiming=n.resourceTiming[this.id]),i&&(this._partialReload=!0),this.fire(new e.A("data",r)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(i),this._coalesce=!1)})}loaded(){return this._loaded}reload(){let i=e.C(this.id,this.scope);this.map.style.clearSource(i),this._updateWorkerData()}loadTile(i,r){let n=i.actor?"reloadTile":"loadTile";i.actor=this.actor;let o=this.map.style?this.map.style.getLut(this.scope):null,a=o?{image:o.image.clone()}:null,s=this._partialReload,l={type:this.type,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:a,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:s};i.request=this.actor.send(n,l,(e,o)=>s&&!o?(i.state="loaded",r(null)):(delete i.request,i.destroy(),i.aborted?r(null):e?r(e):(i.loadVectorData(o,this.map.painter,"reloadTile"===n),r(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,i){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aP{constructor(e,i,r,n){super(e,i,r,n),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;let i=this.options;for(let r of(this.urls=[],i.urls))this.urls.push(this.map._requestManager.transformRequest(r,e.R.Source).url);e.aQ(this.urls,(i,r)=>{this._loaded=!0,i?this.fire(new e.z(i)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){let r=this.video.seekable;i<r.start(0)||i>r.end(0)?this.fire(new e.z(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let i=this.map.painter.context,r=i.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(i,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(i)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aP,model:class extends e.E{constructor(e,i,r,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){let i=[];for(let r in this._options.models){let n=this._options.models[r],o=e.aS(this.map._requestManager.transformRequest(n.uri,e.R.Model).url).then(i=>{if(!i)return;let o=e.aT(i),a=new e.aU(r,n.position,n.orientation,o);a.computeBoundsAndApplyParent(),this.models.push(a)}).catch(i=>{this.fire(new e.z(Error(`Could not load model ${r} from ${n.uri}: ${i.message}`)))});i.push(o)}Promise.allSettled(i).then(()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new e.z(Error(`Could not load models: ${i.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}},"batched-model":class extends e.E{constructor(e,i,r,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let i=e.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(i){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));let r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=eH(this._options,this.map._requestManager,r,n,(o,a)=>{this._tileJSONRequest=null,this._loaded=!0,o?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.z(o))):a&&(e.l(this,a),a.bounds&&(this.tileBounds=new eW(a.bounds,this.minzoom,this.maxzoom)),k(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(i,r){let n=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),o={request:this.map._requestManager.transformRequest(n,e.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(i.actor&&"expired"!==i.state)if("loading"===i.state)i.reloadCallback=r;else{if(i.buckets){for(let e of Object.values(i.buckets))e.dirty=!0;return void(i.state="loaded")}i.request=i.actor.send("reloadTile",o,a.bind(this))}else i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",o,a.bind(this),void 0,!0);function a(e,n){return i.aborted?r(null):e&&404!==e.status?r(e):(this.map._refreshExpiredTiles&&n&&i.setExpiryData(n),i.loadModelData(n,this.map.painter),i.state="loaded",void r(null))}}serialize(){return e.l({},this._options)}},canvas:class extends e.aP{constructor(i,r,n,o){super(i,r,n,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.z(new e.V(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V(`sources.${i}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.z(new e.V(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V(`sources.${i}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let r=this.map.painter.context;this.texture?!i&&!this._playing||this.texture instanceof e.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(i,r,n,o){super(),this.id=i,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=r,this.setEventedParent(o),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.z(Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new eW(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),e.l(this,e.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(i){this.map=i,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(i),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){let{x:i,y:r,z:n}=e.canonical;return this._implementation.hasTile({x:i,y:r,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,i){let{x:r,y:n,z:o}=e.tileID.canonical,a=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:n,z:o},{signal:a.signal})).then((function(r){return delete e.request,e.aborted?(e.state="unloaded",i(null)):void 0===r?(e.state="errored",i(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",i(null)):r instanceof ImageData||r instanceof HTMLCanvasElement||r instanceof ImageBitmap||r instanceof HTMLImageElement?(this.loadTileData(e,r),e.state="loaded",void i(null)):(e.state="errored",i(Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(r=>{"AbortError"!==r.name&&(e.state="errored",i(r))}),e.request.cancel=()=>a.abort()}loadTileData(e,i){e.setTexture(i,this.map.painter)}unloadTile(i,r){if(i.texture&&i.texture instanceof e.T?(i.destroy(!0),i.texture&&i.texture instanceof e.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),this._implementation.unloadTile){let{x:e,y:r,z:n}=i.tileID.canonical;this._implementation.unloadTile({x:e,y:r,z:n})}r&&r()}abortTile(e,i){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){let i=e.C(this.id,this.scope);this.map.style.clearSource(i)}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))}}},eQ=function(i,r,n,o){let a=new eJ[r.type](i,r,n,o);if(a.id!==i)throw Error(`Expected Source id to be ${i} instead of ${a.id}`);return e.aV(["load","abort","unload","serialize","prepare"],a),a};function e0(e,i,r=""){return`${r}:${i.id||""}:${i.layer.id}:${function(e){if("layerId"in e)return`layer:${e.layerId}`;{let{featuresetId:i,importId:r}=e;return`featureset:${i}${r?`:import:${r}`:""}`}}(e.target)}`}function e1(e,i,r,n=""){if(e.uniqueFeatureID){let o=e0(e,i,n);if(r.has(o))return!0;r.add(o)}return!1}function e2(e,i){let r=e.tileID,n=i.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}function e3(e,i){let r={};if(!i)return r;for(let n of e){let e=n.layerIds.map(e=>i.getLayer(e)).filter(Boolean);if(0!==e.length)for(let i of(n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(i=>e.filter(e=>e.id===i)[0])),e))r[i.fqid]=n}return r}let e5=new Uint16Array(8184);for(let e=0;e<2046;e++){let i=e+2,r=0,n=0,o=0,a=0,s=0,l=0;for(1&i?o=a=s=32:r=n=l=32;(i>>=1)>1;){let e=r+o>>1,h=n+a>>1;1&i?(o=r,a=n,r=s,n=l):(r=o,n=a,o=s,a=l),s=e,l=h}let h=4*e;e5[h+0]=r,e5[h+1]=n,e5[h+2]=o,e5[h+3]=a}let e4=new Uint16Array(2178),e6=new Uint8Array(1089),e8=new Uint16Array(1089);function e9(e){return 0===e?-.03125:.03125*(32===e)}let e7={type:2,extent:e.aj,loadGeometry:()=>[[new e.P(0,0),new e.P(e.aj+1,0),new e.P(e.aj+1,e.aj+1),new e.P(0,e.aj+1),new e.P(0,0)]]};class te{constructor(i,r,n,o,a){this.tileID=i,this.uid=e.a$(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=a,o&&o.style&&(this._lastUpdatedBrightness=o.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",o&&o.transform&&(this.projection=o.transform.projection)}registerFadeDuration(i){let r=i+this.timeAdded;r<e.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,r,n){if(this.unloadVectorData(),this.state="loaded",i){for(let o in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=e3(i.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){let i=this.buckets[o];if(i instanceof e.b1){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let i in this.buckets){let r=this.buckets[i];if(r instanceof e.b1&&r.hasRTLText){this.hasRTLText=!0,e.b2();break}}for(let e in this.queryPadding=0,this.buckets){let i=this.buckets[e],n=r.style.getOwnLayer(e);if(!n)continue;let o=n.queryRadius(i);this.queryPadding=Math.max(this.queryPadding,o)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new e.b0}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,i,r){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,e3(e.buckets,i.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(i){for(let e in this.buckets){let r=this.buckets[e];r.uploadPending()&&r.upload(i)}let r=i.gl,n=this.imageAtlas;n&&!n.uploaded&&(this.imageAtlasTexture=new e.T(i,n.image,r.RGBA8,{useMipmap:!!n.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(i,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(i,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,i,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let n=i.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&.001>Math.abs(this._lastUpdatedBrightness-n)||(this.updateBuckets(i,this._lastUpdatedBrightness!==n),this._lastUpdatedBrightness=n))}queryRenderedFeatures(i,r,n,o,a,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};let l=function(i,r){let n=e.bn([],[.5*i.width,-(.5*i.height),1]);return e.bo(n,n,[1,-1,0]),e.az(n,n,i.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(n)}(a,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:r,pixelPosMatrix:l,transform:o,availableImages:n,tileTransform:this.tileTransform})}querySourceFeatures(i,r){let n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;let o=n.loadVTLayers(),a=r?r.sourceLayer:"",s=o._geojsonTileLayer||o[a];if(!s)return;let l=e.b3(r&&r.filter),{z:h,x:u,y:c}=this.tileID.canonical,d={z:h,x:u,y:c};for(let r=0;r<s.length;r++){let o=s.feature(r);if(l.needGeometry){let i=e.b4(o,!0);if(!l.filter(new e.aa(this.tileID.overscaledZ),i,this.tileID.canonical))continue}else if(!l.filter(new e.aa(this.tileID.overscaledZ),o))continue;let p=n.getId(o,a),f=new e.b5(o,h,u,c,p);f.tile=d,i.push(f)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(i){let r=this.expirationTime;if(i.cacheControl){let r=e.b6(i.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){let e=Date.now(),i=!1;if(this.expirationTime>e)i=!1;else if(r)if(this.expirationTime<r)i=!0;else{let n=this.expirationTime-r;n?this.expirationTime=e+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),0x7fffffff)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}updateBuckets(i,r){if(!this.latestFeatureIndex||!i.style)return;let n=this.latestFeatureIndex.loadVTLayers(),o=i.style.listImages(),a=i.style.getBrightness();for(let s in this.buckets){if(!i.style.hasLayer(s))continue;let l=this.buckets[s],h=l.layers[0],u=h.sourceLayer||"_geojsonTileLayer",c=n[u],d=i.style.getLayerSourceCache(h),p={};d&&(p=d._state.getState(u,void 0));let f=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},m=Object.keys(p).length>0&&!r;(!m||l.stateDependentLayers.length||r)&&l.update(p,c,o,f,m?l.stateDependentLayers:l.layers,r,a),(l instanceof e.b7||l instanceof e.b8)&&i._terrain&&i._terrain.enabled&&d&&l.uploadPending()&&i._terrain._clearRenderCacheForTile(d.id,this.tileID);let g=i&&i.style&&i.style.getOwnLayer(s);g&&(this.queryPadding=Math.max(this.queryPadding,g.queryRadius(l)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=e.q.now()+i}setTexture(i,r){let n=r.context,o=n.gl;this.texture=this.texture||r.getTileTexture(i.width),this.texture&&this.texture instanceof e.T?this.texture.update(i):(this.texture=new e.T(n,i,o.RGBA8,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE))}setDependencies(e,i){let r={};for(let e of i)r[e]=!0;this.dependencies[e]=r}hasDependency(e,i){for(let r of e){let e=this.dependencies[r];if(e){for(let r of i)if(e[r])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;let n=e.b9(e7,this.tileID.canonical,this.tileTransform)[0],o=new e.ba,a=new e.bb;for(let e=0;e<n.length;e++){let{x:i,y:r}=n[e];o.emplaceBack(i,r),a.emplaceBack(e)}a.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(a),this._tileDebugBuffer=i.createVertexBuffer(o,e.bc.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,o.length,a.length)}_makeTileBoundsBuffers(i,r){let n,o;if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;let a=e.b9(e7,this.tileID.canonical,this.tileTransform)[0];if(this.isRaster){let i=function(i,r){let n=e.aW(i,r),o=Math.pow(2,i.z);for(let a=0;a<33;a++)for(let s=0;s<33;s++){let l=e.aX((i.x+(s+e9(s))/32)/o),h=e.aY((i.y+(a+e9(a))/32)/o),u=r.project(l,h),c=33*a+s;e4[2*c+0]=Math.round((u.x*n.scale-n.x)*e.aj),e4[2*c+1]=Math.round((u.y*n.scale-n.y)*e.aj)}e6.fill(0),e8.fill(0);for(let e=2045;e>=0;e--){let i=4*e,r=e5[i+0],n=e5[i+1],o=e5[i+2],a=e5[i+3],s=r+o>>1,l=n+a>>1,h=s+l-n,u=l+r-s,c=33*n+r,d=33*a+o,p=33*l+s,f=Math.hypot((e4[2*c+0]+e4[2*d+0])/2-e4[2*p+0],(e4[2*c+1]+e4[2*d+1])/2-e4[2*p+1])>=16;e6[p]=e6[p]||+!!f,e<1022&&(e6[p]=e6[p]||e6[(n+u>>1)*33+(r+h>>1)]||e6[(a+u>>1)*33+(o+h>>1)])}let a=new e.aZ,s=new e.a_,l=0;function h(i,r){let n=33*r+i;return 0===e8[n]&&(a.emplaceBack(e4[2*n+0],e4[2*n+1],i*e.aj/32,r*e.aj/32),e8[n]=++l),e8[n]-1}function u(e,i,r,n,o,a){let l=e+r>>1,c=i+n>>1;if(Math.abs(e-o)+Math.abs(i-a)>1&&e6[33*c+l])u(o,a,e,i,l,c),u(r,n,o,a,l,c);else{let l=h(e,i),u=h(r,n),c=h(o,a);s.emplaceBack(l,u,c)}}return u(0,0,32,32,32,0),u(32,32,0,0,0,32),{vertices:a,indices:s}}(this.tileID.canonical,r);n=i.vertices,o=i.indices}else{for(let{x:i,y:r}of(n=new e.aZ,o=new e.a_,a))n.emplaceBack(i,r,0,0);let i=e.be(n.int16.subarray(0,4*n.length),void 0,4);for(let e=0;e<i.length;e+=3)o.emplaceBack(i[e],i[e+1],i[e+2])}this._tileBoundsBuffer=i.createVertexBuffer(n,e.bf.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(o),this._tileBoundsSegments=e.bd.simpleSegment(0,0,n.length,o.length)}_makeGlobeTileDebugBuffers(i,r){let n,o=r.projection;if(!o||"globe"!==o.name||r.freezeTileCoverage)return;let a=this.tileID.canonical,s=e.bg(a,r),l=e.bh(s),h=e.ah(r.zoom);h>0&&(n=e.bi(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,a,r,l,n,h),this._makeGlobeTileDebugTextBuffer(i,a,r,l,n,h)}_globePoint(i,r,n,o,a,s,l){let h=e.bj(i,r,n);if(s){let a=1<<n.z,u=e.ay(o.center.lng),c=e.aH(o.center.lat),d=(n.x+.5)/a-u,p=0;d>.5?p=-1:d<-.5&&(p=1);let f=(i/e.aj+n.x)/a+p,m=(r/e.aj+n.y)/a;f=(f-u)*o._pixelsPerMercatorPixel+u,m=(m-c)*o._pixelsPerMercatorPixel+c;let g=[f*o.worldSize,m*o.worldSize,0];e.ad(g,g,s),h=e.bk(h,g,l)}return e.ad(h,h,a)}_makeGlobeTileDebugBorderBuffer(i,r,n,o,a,s){let l=new e.ba,h=new e.bb,u=new e.bl,c=(e,i,c,d,p)=>{let f=(c-e)/(p-1),m=(d-i)/(p-1),g=l.length;for(let c=0;c<p;c++){let d=e+c*f,p=i+c*m;l.emplaceBack(d,p);let _=this._globePoint(d,p,r,n,o,a,s);u.emplaceBack(_[0],_[1],_[2]),h.emplaceBack(g+c)}},d=e.aj;c(0,0,d,0,16),c(d,0,d,d,16),c(d,d,0,d,16),c(0,d,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(h),this._tileDebugBuffer=i.createVertexBuffer(l,e.bc.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(u,e.bm.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugTextBuffer(i,r,n,o,a,s){let l=e.aj/4,h=new e.ba,u=new e.a_,c=new e.bl;u.reserve(32),h.reserve(25),c.reserve(25);let d=(e,i)=>25*e+i;for(let e=0;e<25;e++){let i=e*l;for(let e=0;e<25;e++){let u=e*l;h.emplaceBack(u,i);let d=this._globePoint(u,i,r,n,o,a,s);c.emplaceBack(d[0],d[1],d[2])}}for(let e=0;e<4;e++)for(let i=0;i<4;i++){let r=d(e,i),n=d(e,i+1),o=d(e+1,i),a=d(e+1,i+1);u.emplaceBack(r,n,o),u.emplaceBack(o,n,a)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(u),this._tileDebugTextBuffer=i.createVertexBuffer(h,e.bc.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(c,e.bm.members),this._tileDebugTextSegments=e.bd.simpleSegment(0,0,25,32)}destroy(i=!1){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bp.setPbf(e.bq);class tt extends te{constructor(e,i,r,n,o){super(e,i,r,n,o),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexture(i,r){let n=r.context,o=n.gl;this.texture=this.texture||r.getTileTexture(i.width),this.texture&&this.texture instanceof e.T?this.texture.update(i,{premultiply:!1}):this.texture=new e.T(n,i,o.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,r){let n=this._mrt=new e.bp(30),o=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=e.br(o,(e,o,a,s)=>{if(e)r(e);else try{let e=n.getHeaderLength(o);if(e>i)return void(this.request=this.fetchHeader(e,r));n.parseHeader(o),this._isHeaderLoaded=!0;let l=0;for(let e of Object.values(n.layers))l=Math.max(l,e.dataIndex[e.dataIndex.length-1].lastByte);o.byteLength>=l&&(this.entireBuffer=o),r(null,this.entireBuffer||o,a,s)}catch(e){r(e)}}),this.request}fetchBand(i,r,n){let o,a=this._mrt;if(!this._isHeaderLoaded||!a)return void n(Error("Tile header is not ready"));let s=this.actor;if(!s)return void n(Error("Can't fetch tile band without an actor"));let l=(e,a)=>{o.complete(e,a),e?n(e):(this.updateTextureDescriptor(i,r),n(null,this.textureDescriptor&&this.textureDescriptor.img))},h=(e,i)=>{if(e)return n(e);let r=s.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:i,task:o},l,void 0,!0);this._workQueue.push(()=>{r&&r.cancel(),o.cancel()})},u=a.getLayer(i);if(!u)return void n(Error(`Unknown sourceLayer "${i}"`));if(u.hasDataForBand(r))return this.updateTextureDescriptor(i,r),void n(null,this.textureDescriptor?this.textureDescriptor.img:null);let c=u.getDataRange([r]);if((o=a.createDecodingTask(c))&&!o.tasks.length)n(null);else if(this.flushQueues(),this.entireBuffer)h(null,this.entireBuffer.slice(c.firstByte,c.lastByte+1));else{let i=Object.assign({},this.requestParams,{headers:{Range:`bytes=${c.firstByte}-${c.lastByte}`}}),r=e.br(i,h);this._fetchQueue.push(()=>{r.cancel(),o.cancel()})}}updateNeeded(e,i){return(!this.textureDescriptor||this.textureDescriptor.band!==i||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(i,r){if(!this._mrt)return;let n=this._mrt.getLayer(i);if(!n||!n.hasBand(r)||!n.hasDataForBand(r))return;let{bytes:o,tileSize:a,buffer:s,offset:l,scale:h}=n.getBandView(r),u=a+2*s,c=new e.r({width:u,height:u},o),d=this.texture;d&&d instanceof e.T&&d.update(c,{premultiply:!1}),this.textureDescriptor={layer:i,band:r,img:c,buffer:s,offset:l,tileSize:a,format:n.pixelFormat,mix:[h,256*h,65536*h,0x1000000*h]}}}class ti{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(let e in this.data)for(let i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){let n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);let o={value:i,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout(()=>{this.remove(e,o)},r)),this.data[n].push(o),this.order.push(n),this.order.length>this.max){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){let i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;let r=e.wrapped().key,n=void 0===i?0:this.data[r].indexOf(i),o=this.data[r][n];return this.data[r].splice(n,1),o.timeout&&clearTimeout(o.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(o.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){let i=[];for(let r in this.data)for(let n of this.data[r])e(n.value)||i.push(n);for(let e of i)this.remove(e.value.tileID,e)}}class tr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,r,n){let o=String(r);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][o]=this.stateChanges[i][o]||{},e.l(this.stateChanges[i][o],n),null===this.deletedStates[i])for(let e in this.deletedStates[i]={},this.state[i])e!==o&&(this.deletedStates[i][e]=null);else if(this.deletedStates[i]&&null===this.deletedStates[i][o])for(let e in this.deletedStates[i][o]={},this.state[i][o])n[e]||(this.deletedStates[i][o][e]=null);else for(let e in n)this.deletedStates[i]&&this.deletedStates[i][o]&&null===this.deletedStates[i][o][e]&&delete this.deletedStates[i][o][e]}removeFeatureState(e,i,r){if(null===this.deletedStates[e])return;let n=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==i)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(i,r){let n=this.state[i]||{},o=this.stateChanges[i]||{},a=this.deletedStates[i];if(null===a)return{};if(void 0!==r){let i=String(r),s=e.l({},n[i],o[i]);if(a){let e=a[r];if(null===e)return{};for(let i in e)delete s[i]}return s}let s=e.l({},n,o);if(a)for(let e in a)delete s[e];return s}initializeTileState(e,i){e.refreshFeatureState(i)}coalesceChanges(i,r){let n={};for(let i in this.stateChanges){this.state[i]=this.state[i]||{};let r={};for(let n in this.stateChanges[i])this.state[i][n]||(this.state[i][n]={}),e.l(this.state[i][n],this.stateChanges[i][n]),r[n]=this.state[i][n];n[i]=r}for(let i in this.deletedStates){this.state[i]=this.state[i]||{};let r={};if(null===this.deletedStates[i])for(let e in this.state[i])r[e]={},this.state[i][e]={};else for(let e in this.deletedStates[i]){if(null===this.deletedStates[i][e])this.state[i][e]={};else if(this.state[i][e])for(let r of Object.keys(this.deletedStates[i][e]))delete this.state[i][e][r];r[e]=this.state[i][e]}n[i]=n[i]||{},e.l(n[i],r)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(let e in i)i[e].refreshFeatureState(r)}}class tn extends e.E{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new ti(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tr,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){for(let i in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(to).map(e=>e.key)}getRenderableIds(i,r){let n=[];for(let e in this._tiles)this._isIdRenderable(+e,i,r)&&n.push(this._tiles[e]);return i?n.sort((i,r)=>{let n=i.tileID,o=r.tileID,a=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new e.P(o.canonical.x,o.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x}).map(e=>e.tileID.key):n.map(e=>e.tileID).sort(to).map(e=>e.key)}hasRenderableParent(e){let i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}_reloadTile(e,i){let r=this._tiles[e];r&&("loading"!==r.state&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(i,r,n,o){if(o)if(i.state="errored",404!==o.status)this._source.fire(new e.z(o,{tile:i}));else{if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){let e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=e.q.now(),"expired"===n&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(r,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let i=this.getRenderableIds();for(let n=0;n<i.length;n++){let o=i[n];if(e.neighboringTiles&&e.neighboringTiles[o]){let i=this.getTileByID(o);r(e,i),r(i,e)}}function r(e,i){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=i.tileID.canonical.x-e.tileID.canonical.x,n=i.tileID.canonical.y-e.tileID.canonical.y,o=Math.pow(2,e.tileID.canonical.z),a=i.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+o)?r+=o:1===Math.abs(r-o)&&(r-=o)),i.dem&&e.dem&&(e.dem.backfillBorder(i.dem,r,n),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,n){for(let o in this._tiles){let a=this._tiles[o];if(n[o]||!a.hasData()||a.tileID.overscaledZ<=i||a.tileID.overscaledZ>r)continue;let s=a.tileID;for(;a&&a.tileID.overscaledZ>i+1;){let e=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[e.key])&&a.hasData()&&(s=e)}let l=s;for(;l.overscaledZ>i;)if(e[(l=l.scaledTo(l.overscaledZ-1)).key]){n[s.key]=s;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){let r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){let i=e.scaledTo(r),n=this._getLoadedTile(i);if(n)return n}}_getLoadedTile(e){let i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;let r=Math.floor((Math.ceil(e.width/i)+1)*(Math.ceil(e.height/i)+1)*5),n="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(e){let i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){let e={};for(let r in this._tiles){let n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+i),e[n.tileID.key]=n}for(let i in this._tiles=e,this._timers)clearTimeout(this._timers[i]),delete this._timers[i];for(let e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(i,r,n,o,a){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;this.updateCacheSize(i,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let s="batched-model"===this._source.type,l,h=this._source.maxzoom,u=this.map&&this.map.painter?this.map.painter._terrain:null;if(u&&u.sourceCache===this&&u.attenuationRange()){let e=Math.floor(u.attenuationRange()[0])-Math.log2(u.getDemUpscale());h>e&&(h=e)}if(this.used||this.usedForTerrain){if(this._source.tileID)l=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(i=>new e.aM(i.canonical.z,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y));else if(0!==this.tileCoverLift){let o=i.clone();o.tileCoverLift=this.tileCoverLift,l=o.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:h,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.minzoom<=1&&"globe"===i.projection.name&&(l.push(new e.aM(1,0,1,0,0)),l.push(new e.aM(1,0,1,1,0)),l.push(new e.aM(1,0,1,0,1)),l.push(new e.aM(1,0,1,1,1)))}else if(l=i.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:h,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.hasTile){let e=this._source.hasTile.bind(this._source);l=l.filter(i=>e(i))}}else l=[];if(l.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!ta(this._source.type)){let e=Math.min(i.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),this._source.maxzoom);if(s)for(let r of i.extendTileCover(l,e))l.push(r);else if(a)for(let r of i.extendTileCover(l,e,this.transform._camera.forward()))l.push(r);else if(this.castsShadows&&o)for(let r of i.extendTileCover(l,e,o))this._shadowCasterTiles[r.key]=!0,l.push(r)}let c=this._updateRetainedTiles(l);if(ta(this._source.type)&&0!==l.length){let i={},r={};for(let n of Object.keys(c)){let o=c[n],a=this._tiles[n];if(!a||a.fadeEndTime&&a.fadeEndTime<=e.q.now())continue;let s=this.findLoadedParent(o,Math.max(o.overscaledZ-tn.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),i[s.tileID.key]=s.tileID),r[n]=o}let n=l[l.length-1].overscaledZ;for(let e in this._tiles){let i=this._tiles[e];if(c[e]||!i.hasData())continue;let o=i.tileID;for(;o.overscaledZ>n;){o=o.scaledTo(o.overscaledZ-1);let n=this._tiles[o.key];if(n&&n.hasData()&&r[o.key]){c[e]=i.tileID;break}}}for(let e in i)c[e]||(this._coveredTiles[e]=!0,c[e]=i[e])}for(let e in c)this._tiles[e].clearFadeHold();for(let i of e.bs(this._tiles,c)){let e=this._tiles[i];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+i)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let i={};if(0===e.length)return i;let r={},n=e.reduce((e,i)=>Math.min(e,i.overscaledZ),1/0),o=e[0].overscaledZ,a=Math.max(o-tn.maxOverzooming,this._source.minzoom),s=Math.max(o+tn.maxUnderzooming,this._source.minzoom),l={};for(let r of e){let e=this._addTile(r);i[r.key]=r,e.hasData()||n<this._source.maxzoom&&(l[r.key]=r)}for(let o of(this._retainLoadedChildren(l,n,s,i),e)){let e=this._tiles[o.key];if(e.hasData())continue;if(o.canonical.z>=this._source.maxzoom){let e=o.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){i[e.key]=e;continue}}else{let e=o.children(this._source.maxzoom);if(i[e[0].key]&&i[e[1].key]&&i[e[2].key]&&i[e[3].key])continue}let n=e.wasRequested();for(let s=o.overscaledZ-1;s>=a;--s){let a=o.scaledTo(s);if(r[a.key]||(r[a.key]=!0,(e=this.getTile(a))||!n||(e=this._addTile(a)),e&&(i[a.key]=a,n=e.wasRequested(),e.hasData())))break}}return i}_updateLoadedParentTileCache(){for(let e in this._loadedParentTiles={},this._tiles){let i=[],r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}i.push(n.key);let e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e))break;n=e}for(let e of i)this._loadedParentTiles[e]=r}}_addTile(i){let r=this._tiles[i.key];if(r)return!0!==r.isExtraShadowCaster||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),r;(r=this._cache.getAndRemove(i))&&(this._setTileReloadTimer(i.key,r),r.tileID=i,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,r)));let n=!!r;if(!n){let e=this.map?this.map.painter:null,n=this._source.tileSize*i.overscaleFactor();r="raster-array"===this._source.type?new tt(i,n,this.transform.tileZoom,e,this._isRaster):new te(i,n,this.transform.tileZoom,e,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,i.key,r.state))}return r.uses++,this._tiles[i.key]=r,n||this._source.fire(new e.A("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){let i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state||"empty"===i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){for(let e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,r,n){let o=[],a=this.transform;if(!a)return o;let s="globe"===a.projection.name,l=e.ay(a.center.lng);for(let h in this._tiles){let u,c=this._tiles[h];if(n&&c.clearQueryDebugViz(),!c.holdingForFade()){if(s){let i=c.tileID.canonical;if(0===i.z){let r=[Math.abs(e.aD(l,...ts(i,-1))-l),Math.abs(e.aD(l,...ts(i,1))-l)];u=[0,2*r.indexOf(Math.min(...r))-1]}else{let r=[Math.abs(e.aD(l,...ts(i,-1))-l),Math.abs(e.aD(l,...ts(i,0))-l),Math.abs(e.aD(l,...ts(i,1))-l)];u=[r.indexOf(Math.min(...r))-1]}}else u=[0];for(let e of u){let n=i.containsTile(c,a,r,e);n&&o.push(n)}}}return o}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){let r=this.getRenderableIds(e,i).map(e=>this._tiles[e].tileID),n="globe"===this.transform.projection.name;for(let e of r)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped()),e.expandedProjMatrix=n?this.transform.calculateProjMatrix(e.toUnwrapped(),!1,!0):e.projMatrix;return r}sortCoordinatesByDistance(e){let i=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),o={};for(let e of i){let i=1/(1<<e.canonical.z);o[e.key]=((e.canonical.x+.5)*i+e.wrap-r[0])*n[0]+((e.canonical.y+.5)*i-r[1])*n[1]-r[2]*n[2]}return i.sort((e,i)=>o[e.key]-o[i.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(ta(this._source.type))for(let i in this._tiles){let r=this._tiles[i];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=e.q.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){let n=this._tiles[e];n&&n.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(let r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(i,r){if(!this._sourceLoaded){let e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(i,r))};return void this._source.on("data",e)}let n=new Map,o=Array.isArray(i)?i:[i],a=this.map.painter.terrain,s=this.usedForTerrain&&a?a.getScaledDemTileSize():this._source.tileSize;for(let e of o){for(let i of e.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}))n.set(i.key,i);this.usedForTerrain&&e.updateElevation(!1)}let l=Array.from(n.values());e.bt(l,(e,i)=>{let r=new te(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),i(e,r)})},r)}}function to(e,i){let r=Math.abs(2*e.wrap)-(e.wrap<0),n=Math.abs(2*i.wrap)-(i.wrap<0);return e.overscaledZ-i.overscaledZ||n-r||i.canonical.y-e.canonical.y||i.canonical.x-e.canonical.x}function ta(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function ts(e,i){let r=1<<e.z;return[e.x/r+i,(e.x+1)/r+i]}tn.maxOverzooming=10,tn.maxUnderzooming=3;class tl{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){for(let e in this.layers=[],this.style._mergedLayers){let i=this.style._mergedLayers[e];if("fill-extrusion"===i.type)this.layers.push({layer:i,visible:!1,visibilityChanged:!1});else if("model"===i.type){let e=this.style.getLayerSource(i);e&&"batched-model"===e.type&&this.layers.push({layer:i,visible:!1,visibilityChanged:!1})}}}onNewFrame(e){for(let i of(this.layersGotHidden=!1,this.layers)){let r=i.layer,n=!1;"fill-extrusion"===r.type?n=!r.isHidden(e)&&r.paint.get("fill-extrusion-opacity")>0:"model"===r.type&&(n=!r.isHidden(e)&&r.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!n&&i.visible,i.visible=n}}updateZOffset(e,i){for(let e of(this.currentBuildingBuckets=[],this.layers)){let r=e.layer,n=this.style.getLayerSourceCache(r),o=1;"fill-extrusion"===r.type&&(o=e.visible?r.paint.get("fill-extrusion-vertical-scale"):0);let a=n?n.getTile(i):null;if(!a&&n&&i.canonical.z>n.getSource().minzoom){let e=i.scaledTo(Math.min(n.getSource().maxzoom,i.overscaledZ-1));for(;e.overscaledZ>=n.getSource().minzoom&&!(a=n.getTile(e))&&0!==e.overscaledZ;)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:a?a.getBucket(r):null,tileID:a?a.tileID:i,verticalScale:o})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){let o=e.symbolInstances.get(n),a=o.zOffset,s=this._getHeightAtTileOffset(i,o.tileAnchorX,o.tileAnchorY);o.zOffset=s!==Number.NEGATIVE_INFINITY?s:a,r||a===o.zOffset||(r=!0),e.hasAnyZOffset||0===o.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,r,n,o){let a=r,s=n;if(i.canonical.z!==o.canonical.z){let l=o.canonical,h=1/(1<<i.canonical.z-l.z);a=(r+i.canonical.x*e.aj)*h-l.x*e.aj|0,s=(n+i.canonical.y*e.aj)*h-l.y*e.aj|0}return{tileX:a,tileY:s}}_getHeightAtTileOffset(e,i,r){let n,o;for(let a=0;a<this.layers.length;++a){if("fill-extrusion"!==this.layers[a].layer.type)continue;let{bucket:s,tileID:l,verticalScale:h}=this.currentBuildingBuckets[a];if(!s)continue;let{tileX:u,tileY:c}=this._mapCoordToOverlappingTile(e,i,r,l),d=s.getHeightAtTileCoord(u,c);d&&void 0!==d.height&&(d.hidden?n=d.height:o=Math.max(d.height*h,o||0))}if(void 0!==o)return o;for(let o=0;o<this.layers.length;++o){let a=this.layers[o];if("model"!==a.layer.type||!a.visible)continue;let{bucket:s,tileID:l}=this.currentBuildingBuckets[o];if(!s)continue;let{tileX:h,tileY:u}=this._mapCoordToOverlappingTile(e,i,r,l),c=s.getHeightAtTileCoord(h,u);if(c&&!c.hidden)return void 0===c.height&&void 0!==n?Math.min(c.maxHeight,n)*c.verticalScale:c.height?c.height*c.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function th(i){i=i.slice();let r=Object.create(null);for(let e=0;e<i.length;e++)r[i[e].id]=i[e];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=function(i,r){let n={};for(let e in i)"ref"!==e&&(n[e]=i[e]);return e.bu.forEach(e=>{e in r&&(n[e]=r[e])}),n}(i[n],r[i[n].ref]));return i}let tu={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function tc(e,i,r){r.push({command:tu.addSource,args:[e,i[e]]})}function td(e,i,r){i.push({command:tu.removeSource,args:[e]}),r[e]=!0}function tp(i,r,n,o,a,s){let l;for(l in r=r||{},i=i||{})i.hasOwnProperty(l)&&(e.bv(i[l],r[l])||n.push({command:s,args:[o,l,r[l],a]}));for(l in r)r.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(e.bv(i[l],r[l])||n.push({command:s,args:[o,l,r[l],a]}))}function tf(e){return e.id}function tm(e,i){return e[i.id]=i,e}class tg{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=e.aD(i,0,1);let r=1,n=this._distances[r],o=i*this.paddedLength+this.padding;for(;n<o&&r<this._distances.length;)n=this._distances[++r];let a=r-1,s=this._distances[a],l=n-s,h=l>0?(o-s)/l:0;return this.points[a].mult(1-h).add(this.points[r].mult(h))}}class t_{constructor(e,i,r){let n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(i/r);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,r,n,o){this._forEachCell(i,r,n,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(o)}insertCircle(e,i,r,n){this._forEachCell(i-n,r-n,i+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,i,r,n,o,a){this.boxCells[o].push(a)}_insertCircleCell(e,i,r,n,o,a){this.circleCells[o].push(a)}_query(e,i,r,n,o,a){if(r<0||e>this.width||n<0||i>this.height)return!o&&[];let s=[];if(e<=0&&i<=0&&this.width<=r&&this.height<=n){if(o)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){let i=this.circles[3*e],r=this.circles[3*e+1],n=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:i-n,y1:r-n,x2:i+n,y2:r+n})}return a?s.filter(a):s}return this._forEachCell(e,i,r,n,this._queryCell,s,{hitTest:o,seenUids:{box:{},circle:{}}},a),o?s.length>0:s}_queryCircle(e,i,r,n,o){let a=e-r,s=e+r,l=i-r,h=i+r;if(s<0||a>this.width||h<0||l>this.height)return!n&&[];let u=[];return this._forEachCell(a,l,s,h,this._queryCellCircle,u,{hitTest:n,circle:{x:e,y:i,radius:r},seenUids:{box:{},circle:{}}},o),n?u.length>0:u}query(e,i,r,n,o){return this._query(e,i,r,n,!1,o)}hitTest(e,i,r,n,o){return this._query(e,i,r,n,!0,o)}hitTestCircle(e,i,r,n){return this._queryCircle(e,i,r,!0,n)}_queryCell(e,i,r,n,o,a,s,l){let h=s.seenUids,u=this.boxCells[o];if(null!==u){let o=this.bboxes;for(let c of u)if(!h.box[c]){h.box[c]=!0;let u=4*c;if(e<=o[u+2]&&i<=o[u+3]&&r>=o[u+0]&&n>=o[u+1]&&(!l||l(this.boxKeys[c]))){if(s.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[c],x1:o[u],y1:o[u+1],x2:o[u+2],y2:o[u+3]})}}}let c=this.circleCells[o];if(null!==c){let o=this.circles;for(let u of c)if(!h.circle[u]){h.circle[u]=!0;let c=3*u;if(this._circleAndRectCollide(o[c],o[c+1],o[c+2],e,i,r,n)&&(!l||l(this.circleKeys[u]))){if(s.hitTest)return a.push(!0),!0;{let e=o[c],i=o[c+1],r=o[c+2];a.push({key:this.circleKeys[u],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}}}}}_queryCellCircle(e,i,r,n,o,a,s,l){let h=s.circle,u=s.seenUids,c=this.boxCells[o];if(null!==c){let e=this.bboxes;for(let i of c)if(!u.box[i]){u.box[i]=!0;let r=4*i;if(this._circleAndRectCollide(h.x,h.y,h.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!l||l(this.boxKeys[i])))return a.push(!0),!0}}let d=this.circleCells[o];if(null!==d){let e=this.circles;for(let i of d)if(!u.circle[i]){u.circle[i]=!0;let r=3*i;if(this._circlesCollide(e[r],e[r+1],e[r+2],h.x,h.y,h.radius)&&(!l||l(this.circleKeys[i])))return a.push(!0),!0}}}_forEachCell(e,i,r,n,o,a,s,l){let h=this._convertToXCellCoord(e),u=this._convertToYCellCoord(i),c=this._convertToXCellCoord(r),d=this._convertToYCellCoord(n);for(let p=h;p<=c;p++)for(let h=u;h<=d;h++)if(o.call(this,e,i,r,n,this.xCellCount*h+p,a,s,l))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,r,n,o,a){let s=n-e,l=o-i,h=r+a;return h*h>s*s+l*l}_circleAndRectCollide(e,i,r,n,o,a,s){let l=(a-n)/2,h=Math.abs(e-(n+l));if(h>l+r)return!1;let u=(s-o)/2,c=Math.abs(i-(o+u));if(c>u+r)return!1;if(h<=l||c<=u)return!0;let d=h-l,p=c-u;return d*d+p*p<=r*r}}let ty={unknown:0,flipRequired:1,flipNotRequired:2},tv=Math.tan(85*Math.PI/180);function tx(i,r,n,o,a,s,l){let h=e.bz();if(n)if("globe"===s.name){let i=e.bA(a,r);e.az(h,h,i)}else{let i=e.bB([],l);h[0]=i[0],h[1]=i[1],h[4]=i[2],h[5]=i[3],o||e.by(h,h,a.angle)}else e.az(h,a.labelPlaneMatrix,i);return h}function tb(e,i,r,n,o,a,s){let l=tx(e,i,r,n,o,a,s);return"globe"===a.name&&r||(l[2]=l[6]=l[10]=l[14]=0),l}function tw(i,r,n,o,a,s,l){if(n){if("globe"===s.name){let h=tx(i,r,n,o,a,s,l);return e.bi(h,h),e.az(h,i,h),h}{let r=e.bw(i),n=e.bx([]);return n[0]=l[0],n[1]=l[1],n[4]=l[2],n[5]=l[3],e.az(r,r,n),o||e.by(r,r,-a.angle),r}}return a.glCoordMatrix}function tT(i,r,n,o){let a=[i,r,n,1];n?e.aA(a,a,o):tk(a,a,o);let s=a[3];return a[0]/=s,a[1]/=s,a[2]/=s,a}function tS(e,i){return Math.min(.5+e/i*.5,1.5)}function tE(i,r,n,o,a,s,l,h,u,c){let d=n.transform,p=o?i.textSizeData:i.iconSizeData,f=e.bH(p,n.transform.zoom),m="globe"===d.projection.name,g=[256/n.width*2+1,256/n.height*2+1],_=o?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;_.clear();let y=null;m&&(y=o?i.text.globeExtVertexArray:i.icon.globeExtVertexArray);let v=i.lineVertexArray,x=o?i.text.placedSymbolArray:i.icon.placedSymbolArray,b=n.transform.width/n.transform.height,w,T=!1;for(let o=0;o<x.length;o++){let m=x.get(o),{numGlyphs:S,writingMode:E}=m;if(E!==e.bI.vertical||T||w===e.bI.horizontal||(T=!0),w=E,(m.hidden||E===e.bI.vertical)&&!T){tO(S,_);continue}T=!1;let I=new e.P(m.tileAnchorX,m.tileAnchorY),{x:C,y:A,z:R}=d.projection.projectTilePoint(I.x,I.y,c.canonical);if(u){let[e,i,r]=u(I);C+=e,A+=i,R+=r}let M=[C,A,R,1];if(e.aA(M,M,r),!function(e,i){let r=e[0]/e[3],n=e[1]/e[3];return r>=-i[0]&&r<=i[0]&&n>=-i[1]&&n<=i[1]}(M,g)){tO(S,_);continue}let P=M[3],O=tS(n.transform.getCameraToCenterDistance(d.projection),P),k=e.bJ(p,f,m),L=l?k/O:k*O,D=tT(C,A,R,a);if(D[3]<=0){tO(S,_);continue}let z={},F=Math.cos(e.al(i.layers[0].layout.get("text-max-angle"))),B=l?null:u,N=tA(m,L,!1,h,r,a,s,i.glyphOffsetArray,v,_,y,D,I,z,b,B,d.projection,c,l,F);T=N.useVertical,B&&N.needsFlipping&&(z={}),(N.notEnoughRoom||T||N.needsFlipping&&tA(m,L,!0,h,r,a,s,i.glyphOffsetArray,v,_,y,D,I,z,b,B,d.projection,c,l,F).notEnoughRoom)&&tO(S,_)}o?(i.text.dynamicLayoutVertexBuffer.updateData(_),y&&i.text.globeExtVertexBuffer&&i.text.globeExtVertexBuffer.updateData(y)):(i.icon.dynamicLayoutVertexBuffer.updateData(_),y&&i.icon.globeExtVertexBuffer&&i.icon.globeExtVertexBuffer.updateData(y))}function tI(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_){let{lineStartIndex:y,glyphStartIndex:v,segment:x}=l,b=v+l.numGlyphs,w=y+l.lineLength,T=i.getoffsetX(v),S=i.getoffsetX(b-1),E=tP(e*T,r,n,o,a,s,x,y,w,h,u,c,d,p,!0,f,m,g,_);if(!E)return null;let I=tP(e*S,r,n,o,a,s,x,y,w,h,u,c,d,p,!0,f,m,g,_);return I?{first:E,last:I}:null}function tC(i,r,n,o){return i===e.bI.horizontal&&Math.abs(o)>Math.abs(n)?{useVertical:!0}:i===e.bI.vertical?o>0?{needsFlipping:!0}:null:r!==ty.unknown&&(0===n||Math.abs(o/n)>tv)?r===ty.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function tA(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b){let w=r/24,T=i.lineOffsetX*w,S=i.lineOffsetY*w,{lineStartIndex:E,glyphStartIndex:I,numGlyphs:C,segment:A,writingMode:R,flipState:M}=i,P=E+i.lineLength,O=i=>{if(d){let[r,n,o]=i.up,a=c.length;e.bK(d,a+0,r,n,o),e.bK(d,a+1,r,n,o),e.bK(d,a+2,r,n,o),e.bK(d,a+3,r,n,o)}let[r,n,o]=i.point;e.bL(c,r,n,o,i.angle)};if(C>1){let e=tI(w,h,T,S,n,p,f,i,u,s,m,_,!1,y,v,x,b);if(!e)return{notEnoughRoom:!0};if(o&&!n){let[r,n,o]=e.first.point,[a,s,h]=e.last.point;[r,n]=tT(r,n,o,l),[a,s]=tT(a,s,h,l);let u=tC(R,M,(a-r)*g,s-n);if(i.flipState=u&&u.needsFlipping?ty.flipRequired:ty.flipNotRequired,u)return u}O(e.first);for(let e=I+1;e<I+C-1;e++){let i=tP(w*h.getoffsetX(e),T,S,n,p,f,A,E,P,u,s,m,_,!1,!1,y,v,x,b);if(!i)return c.length-=4*(e-I),{notEnoughRoom:!0};O(i)}O(e.last)}else{if(o&&!n){let r=tT(f.x,f.y,0,a),n=E+A+1,o=new e.P(u.getx(n),u.gety(n)),s=tT(o.x,o.y,0,a),l=s[3]>0?s:tM(f,o,r,1,a,void 0,y,v.canonical),h=tC(R,M,(l[0]-r[0])*g,l[1]-r[1]);if(i.flipState=h&&h.needsFlipping?ty.flipRequired:ty.flipNotRequired,h)return h}let r=tP(w*h.getoffsetX(I),T,S,n,p,f,A,E,P,u,s,m,_,!1,!1,y,v,x,b);if(!r)return{notEnoughRoom:!0};O(r)}return{}}function tR(e,i,r,n,o){let{x:a,y:s,z:l}=n.projectTilePoint(e.x,e.y,i);if(!o)return tT(a,s,l,r);let[h,u,c]=o(e);return tT(a+h,s+u,l+c,r)}function tM(i,r,n,o,a,s,l,h){let u=tR(i.sub(r)._unit()._add(i),h,a,l,s);return e.at(u,n,u),e.au(u,u),e.bF(u,n,u,o)}function tP(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x){let b=o?i-r:i+r,w=b>0?1:-1,T=0;o&&(w*=-1,T=Math.PI),w<0&&(T+=Math.PI);let S=h+l+(w>0?0:1)|0,E=a,I=a,C=0,A=0,R=Math.abs(b),M=[],P=[],O=s,k=O,L=e.bC([]),D=()=>tM(k,O,I,R-C+1,d,f,_,y.canonical);for(;C+A<=R;){if((S+=w)<h||S>=u)return null;if(I=E,k=O,M.push(I),m&&P.push(k),O=new e.P(c.getx(S),c.gety(S)),!(E=p[S])){let e=tR(O,y.canonical,d,_,f);E=e[3]>0?p[S]=e:D()}C+=A;let i=e.at([],E,I),r=e.bD(I,E);if(n&&r>0&&A>0&&e.bE(L,i)/(A*r)<x)return null;A=r,L=i}g&&f&&(p[S]&&(E=D(),A=e.bD(I,E),L=e.at([],E,I)),p[S]=E);let z=(R-C)/A,F=O.sub(k)._mult(z)._add(k),B=e.bF([],I,L,z),N=[0,0,1],j=L[0],V=L[1];if(v&&(0!==(N=_.upVector(y.canonical,F.x,F.y))[0]||0!==N[1]||1!==N[2])){let i=[N[2],0,-N[0]],r=e.bG([],N,i);e.au(i,i),e.au(r,r),j=e.bE(L,i),V=e.bE(L,r)}if(n){let i=e.bG([],N,L);e.au(i,i),e.bF(B,B,i,n*w)}let U=T+Math.atan2(V,j);return M.push(B),m&&P.push(F),{point:B,angle:U,path:M,tilePath:P,up:N}}function tO(e,i){let r=i.length,n=r+4*e;i.resize(n),i.float32.fill(-1/0,4*r,4*n)}function tk(e,i,r){let n=i[0],o=i[1];return e[0]=r[0]*n+r[4]*o+r[12],e[1]=r[1]*n+r[5]*o+r[13],e[3]=r[3]*n+r[7]*o+r[15],e}class tL{constructor(e,i,r=new t_(e.width+200,e.height+200,25),n=new t_(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=i}placeCollisionBox(e,i,r,n,o,a,s,l){let h=r.projectedAnchorX,u=r.projectedAnchorY,c=r.projectedAnchorZ,d=r.elevation,p=r.tileID,f=e.getProjection();if(d&&p){let[e,i,n]=f.upVector(p.canonical,r.tileAnchorX,r.tileAnchorY),o=f.upVectorScale(p.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=e*d*o,u+=i*d*o,c+=n*d*o}let m=this.projectAndGetPerspectiveRatio(s,h,u,c,r.tileID,"globe"===f.name||!!d||this.transform.pitch>0,f),g=a*m.perspectiveRatio,_=(r.x1*i+n.x-r.padding)*g+m.point.x,y=(r.y1*i+n.y-r.padding)*g+m.point.y,v=(r.x2*i+n.x+r.padding)*g+m.point.x,x=(r.y2*i+n.y+r.padding)*g+m.point.y,b=m.perspectiveRatio<=.55||m.occluded;return!this.isInsideGrid(_,y,v,x)||!o&&this.grid.hitTest(_,y,v,x,l)||b?{box:[],offscreen:!1,occluded:m.occluded}:{box:[_,y,v,x],offscreen:this.isOffscreen(_,y,v,x),occluded:!1}}placeCollisionCircles(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g){let _=[],y=this.transform.elevation,v=i.getProjection(),x=y?y.getAtTileOffsetFunc(g,this.transform.center.lat,this.transform.worldSize,v):null,b=new e.P(n.tileAnchorX,n.tileAnchorY),{x:w,y:T,z:S}=v.projectTilePoint(b.x,b.y,g.canonical);if(x){let[e,i,r]=x(b);w+=e,T+=i,S+=r}let E="globe"===v.name,I=this.projectAndGetPerspectiveRatio(l,w,T,S,g,E||!!y||this.transform.pitch>0,v),{perspectiveRatio:C}=I,A=(d?s/C:s*C)/e.bO,R=tT(w,T,S,h),M=n.lineOffsetX*A,P=n.lineOffsetY*A,O=Math.cos(e.al(i.layers[0].layout.get("text-max-angle"))),k=I.signedDistanceFromCamera>0?tI(A,a,M,P,!1,R,b,n,o,h,{},y&&!d?x:null,d&&!!y,v,g,d,O):null,L=!1,D=!1,z=!0;if(k&&!I.occluded){let i=.5*f*C+m,n=new e.P(-100,-100),o=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new tg,{first:s,last:l}=k,h=s.path.length,d=[];for(let e=h-1;e>=1;e--)d.push(s.path[e]);for(let e=1;e<l.path.length;e++)d.push(l.path[e]);let g=2.5*i;u&&(d=d.map(([e,i,r],n)=>(x&&!E&&(r=x(n<h-1?s.tilePath[h-1-n]:l.tilePath[n-h+2])[2]),tT(e,i,r,u)))).some(e=>e[3]<=0)&&(d=[]);let y=[];if(d.length>0){let i=1/0,r=-1/0,a=1/0,s=-1/0;for(let e of d)i=Math.min(i,e[0]),a=Math.min(a,e[1]),r=Math.max(r,e[0]),s=Math.max(s,e[1]);r>=n.x&&i<=o.x&&s>=n.y&&a<=o.y&&(y=[d.map(i=>new e.P(i[0],i[1]))],(i<n.x||r>o.x||a<n.y||s>o.y)&&(y=e.bM(y,n.x,n.y,o.x,o.y)))}for(let e of y){a.reset(e,.25*i);let n=0;n=a.length<=.5*i?1:Math.ceil(a.paddedLength/g)+1;for(let e=0;e<n;e++){let o=e/Math.max(n-1,1),s=a.lerp(o),l=s.x+100,h=s.y+100;_.push(l,h,i,0);let u=l-i,d=h-i,f=l+i,m=h+i;if(z=z&&this.isOffscreen(u,d,f,m),D=D||this.isInsideGrid(u,d,f,m),!r&&this.grid.hitTestCircle(l,h,i,p)&&(L=!0,!c))return{circles:[],offscreen:!1,collisionDetected:L,occluded:!1}}}}return{circles:(c||!L)&&D?_:[],offscreen:z,collisionDetected:L,occluded:I.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let r=[],n=1/0,o=1/0,a=-1/0,s=-1/0;for(let l of i){let i=new e.P(l.x+100,l.y+100);n=Math.min(n,i.x),o=Math.min(o,i.y),a=Math.max(a,i.x),s=Math.max(s,i.y),r.push(i)}let l=this.grid.query(n,o,a,s).concat(this.ignoredGrid.query(n,o,a,s)),h={},u={};for(let i of l){let n=i.key;if(void 0===h[n.bucketInstanceId]&&(h[n.bucketInstanceId]={}),h[n.bucketInstanceId][n.featureIndex])continue;let o=[new e.P(i.x1,i.y1),new e.P(i.x2,i.y1),new e.P(i.x2,i.y2),new e.P(i.x1,i.y2)];e.bN(r,o)&&(h[n.bucketInstanceId][n.featureIndex]=!0,void 0===u[n.bucketInstanceId]&&(u[n.bucketInstanceId]=[]),u[n.bucketInstanceId].push(n.featureIndex))}return u}insertCollisionBox(e,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,r,n,o){let a=i?this.ignoredGrid:this.grid,s={bucketInstanceId:r,featureIndex:n,collisionGroupID:o};for(let i=0;i<e.length;i+=4)a.insertCircle(s,e[i],e[i+1],e[i+2])}projectAndGetPerspectiveRatio(i,r,n,o,a,s,l){let h=[r,n,o,1],u=!1;o||this.transform.pitch>0?(e.aA(h,h,i),this.fogState&&a&&"globe"!==l.name&&(u=function(i,r,n,o,a,s){let l=s.calculateFogTileMatrix(a),h=[r,n,o];return e.ad(h,h,l),eP(i,e.ae(h),s.pitch,s._fov)}(this.fogState,r,n,o,a.toUnwrapped(),this.transform)>.9)):tk(h,h,i);let c=h[3];return{point:new e.P((h[0]/c+1)/2*this.transform.width+100,(-h[1]/c+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(l)/c*.5,1.5),signedDistanceFromCamera:c,occluded:s&&h[2]>c||u}}isOffscreen(e,i,r,n){return r<100||e>=this.screenRightBoundary||n<100||i>this.screenBottomBoundary}isInsideGrid(e,i,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let i=e.bx([]);return e.bo(i,i,[-100,-100,0]),i}}function tD(i,r,n){let o=r.createTileMatrix(i,i.worldSize,n.toUnwrapped());return e.az(new Float32Array(16),i.projMatrix,o)}function tz(e,i,r){return i.name===r.projection.name?e.projMatrix:tD(r,i,e)}class tF{constructor(e,i,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class tB{constructor(e,i,r,n,o,a=!1){this.text=new tF(e?e.text:null,i,r,o),this.icon=new tF(e?e.icon:null,i,n,o),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tN{constructor(e,i,r,n=!1){this.text=e,this.icon=i,this.skipFade=r,this.clipped=n}}class tj{constructor(){this.invProjMatrix=e.bz(),this.viewportMatrix=e.bz(),this.circles=[]}}class tV{constructor(e,i,r,n,o){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=o}}class tU{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:e=>e.collisionGroupID===i}}return this.collisionGroups[e]}}function tG(i,r,n,o,a){let{horizontalAlign:s,verticalAlign:l}=e.bV(i),h=e.bU(i,o);return new e.P(-(s-.5)*r+h[0]*a,-(l-.5)*n+h[1]*a)}function tq(i,r,n,o,a){let s=new e.P(i,r);return n&&s._rotate(o?a:-a),s}class t${constructor(e,i,r,n,o,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new tL(this.transform,o),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new tU(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,r,n,o,a=1){var s,l,h;let u=n.getBucket(r),c=n.latestFeatureIndex;if(!u||!c||r.fqid!==u.layerIds[0])return;let d=u.layers[0].layout,p=u.layers[0].paint,f=n.collisionBoxArray,m=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),g=n.tileSize/e.aj,_=n.tileID.toUnwrapped();this.transform.setProjection(u.projection);let y=(s=n.tileID,l=u.getProjection(),h=this.transform,l.name===this.projection?h.calculateProjMatrix(s.toUnwrapped()):tD(h,l,s)),v="map"===d.get("text-pitch-alignment"),x="map"===d.get("text-rotation-alignment");r.compileFilter(r.options);let b=r.dynamicFilter(),w=r.dynamicFilterNeedsFeature(),T=this.transform.calculatePixelsToTileUnitsMatrix(n),S=tb(y,n.tileID.canonical,v,x,this.transform,u.getProjection(),T),E=null;if(v){let i=tw(y,n.tileID.canonical,v,x,this.transform,u.getProjection(),T);E=e.az([],this.transform.labelPlaneMatrix,i)}let I=null;b&&n.latestFeatureIndex&&(I={unwrappedTileID:_,dynamicFilter:b,dynamicFilterNeedsFeature:w}),this.retainedQueryData[u.bucketInstanceId]=new tV(u.bucketInstanceId,c,u.sourceLayerIndex,u.index,n.tileID);let[C,A]=u.layers[0].layout.get("text-size-scale-range"),R=e.aD(a,C,A),[M,P]=d.get("icon-size-scale-range"),O=e.aD(a,M,P),k={bucket:u,layout:d,paint:p,posMatrix:y,textLabelPlaneMatrix:S,labelToScreenMatrix:E,clippingData:I,scale:m,textPixelRatio:g,holdingForFade:n.holdingForFade(),collisionBoxArray:f,partiallyEvaluatedTextSize:e.bH(u.textSizeData,this.transform.zoom,R),partiallyEvaluatedIconSize:e.bH(u.iconSizeData,this.transform.zoom,O),collisionGroup:this.collisionGroups.get(u.sourceID),latestFeatureIndex:n.latestFeatureIndex};if(o)for(let e of u.sortKeyRanges){let{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:o}=e;i.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:o,parameters:k})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:u.symbolInstances.length,parameters:k})}attemptAnchorPlacement(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y){let{textOffset0:v,textOffset1:x,crossTileID:b}=d,w=[v,x],T=tG(e,r,n,w,o),S=this.collisionIndex.placeCollisionBox(f,o,i,tq(T.x,T.y,a,s,this.transform.angle),c,l,h,u.predicate);if(g){let e=f.getSymbolInstanceIconSize(y,this.transform.zoom,d.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(f,e,g,tq(T.x,T.y,a,s,this.transform.angle),c,l,h,u.predicate).box.length)return}if(S.box.length>0){let i;return this.prevPlacement&&this.prevPlacement.variableOffsets[b]&&this.prevPlacement.placements[b]&&this.prevPlacement.placements[b].text&&(i=this.prevPlacement.variableOffsets[b].anchor),this.variableOffsets[b]={textOffset:w,width:r,height:n,anchor:e,textScale:o,prevAnchor:i},this.markUsedJustification(f,e,d,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,d),this.placedOrientations[b]=m),{shift:T,placedGlyphBoxes:S}}}placeLayerBucketPart(i,r,n,o,a=1){let{bucket:s,layout:l,paint:h,posMatrix:u,textLabelPlaneMatrix:c,labelToScreenMatrix:d,clippingData:p,textPixelRatio:f,holdingForFade:m,collisionBoxArray:g,partiallyEvaluatedTextSize:_,partiallyEvaluatedIconSize:y,collisionGroup:v,latestFeatureIndex:x}=i.parameters,b=l.get("text-optional"),w=l.get("icon-optional"),T=l.get("text-allow-overlap"),S=l.get("icon-allow-overlap"),E="map"===l.get("text-rotation-alignment"),I="map"===l.get("text-pitch-alignment"),C=h.get("symbol-z-offset"),A="sea"===l.get("symbol-elevation-reference"),[R,M]=l.get("text-size-scale-range"),[P,O]=l.get("icon-size-scale-range"),k=e.aD(a,R,M),L=e.aD(a,P,O);this.transform.setProjection(s.projection);let D=T&&(S||!s.hasIconData()||w),z=S&&(T||!s.hasTextData()||b),F=!C.isConstant();!s.collisionArrays&&g&&s.deserializeCollisionBoxes(g),n&&o&&s.updateCollisionDebugBuffers(this.transform.zoom,g,k,L);let B=(i,o,h)=>{let{crossTileID:g,numVerticalGlyphVertices:R}=i,M=null;if(p&&p.dynamicFilterNeedsFeature||F){let e=this.retainedQueryData[s.bucketInstanceId];M=x.loadFeature({featureIndex:i.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(p&&!(0,p.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},M,this.retainedQueryData[s.bucketInstanceId].tileID.canonical,new e.P(i.tileAnchorX,i.tileAnchorY),this.transform.calculateDistanceTileData(p.unwrappedTileID)))return this.placements[g]=new tN(!1,!1,!1,!0),void r.add(g);let P=C.evaluate(M,{});if(r.has(g))return;if(m)return void(this.placements[g]=new tN(!1,!1,!1));let O=!1,k=!1,L=!0,B=!1,N=!1,j=null,V={box:null,offscreen:null,occluded:null},U={box:null,offscreen:null,occluded:null},G=null,q=null,$=null,H=0,Z=0,W=0;h.textFeatureIndex?H=h.textFeatureIndex:i.useRuntimeCollisionCircles&&(H=i.featureIndex),h.verticalTextFeatureIndex&&(Z=h.verticalTextFeatureIndex);let X=e=>{e.tileID=this.retainedQueryData[s.bucketInstanceId].tileID;let r=this.transform.elevation;e.elevation=A?P:P+(r?r.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=i.zOffset},Y=h.textBox;if(Y){X(Y);let r=r=>{let n=e.bI.horizontal;if(s.allowVerticalPlacement&&!r&&this.prevPlacement){let e=this.prevPlacement.placedOrientations[g];e&&(this.placedOrientations[g]=e,n=e,this.markUsedOrientation(s,n,i))}return n},n=(i,r)=>{if(s.allowVerticalPlacement&&R>0&&h.verticalTextBox){for(let n of s.writingModes)if(n===e.bI.vertical?U=V=r():V=i(),V&&V.box&&V.box.length)break}else V=i()};if(l.get("text-variable-anchor")){let a=l.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[g]){let e=this.prevPlacement.variableOffsets[g];a.indexOf(e.anchor)>0&&(a=a.filter(i=>i!==e.anchor)).unshift(e.anchor)}let c=(e,r,n)=>{let l=s.getSymbolInstanceTextSize(_,i,this.transform.zoom,o),h=(e.x2-e.x1)*l+2*e.padding,c=(e.y2-e.y1)*l+2*e.padding,d=i.hasIconTextFit&&!S?r:null;d&&X(d);let p={box:[],offscreen:!1,occluded:!1},m=T?2*a.length:a.length;for(let r=0;r<m;++r){let m=this.attemptAnchorPlacement(a[r%a.length],e,h,c,l,E,I,f,u,v,r>=a.length,i,o,s,n,d,_,y);if(m&&(p=m.placedGlyphBoxes)&&p.box&&p.box.length){O=!0,j=m.shift;break}}return p};n(()=>c(Y,h.iconBox,e.bI.horizontal),()=>{let i=h.verticalTextBox;return i&&X(i),s.allowVerticalPlacement&&!(V&&V.box&&V.box.length)&&R>0&&i?c(i,h.verticalIconBox,e.bI.vertical):{box:null,offscreen:null,occluded:null}}),V&&(O=V.box,L=V.offscreen,B=V.occluded);let d=r(!(!V||!V.box));if(!O&&this.prevPlacement){let e=this.prevPlacement.variableOffsets[g];e&&(this.variableOffsets[g]=e,this.markUsedJustification(s,e.anchor,i,d))}}else{let l=(r,n)=>{let l=s.getSymbolInstanceTextSize(_,i,this.transform.zoom,o,a),h=this.collisionIndex.placeCollisionBox(s,l,r,new e.P(0,0),T,f,u,v.predicate);return h&&h.box&&h.box.length&&(this.markUsedOrientation(s,n,i),this.placedOrientations[g]=n),h};n(()=>l(Y,e.bI.horizontal),()=>{let i=h.verticalTextBox;return s.allowVerticalPlacement&&R>0&&i?(X(i),l(i,e.bI.vertical)):{box:null,offscreen:null,occluded:null}}),r(!!(V&&V.box&&V.box.length))}}if(O=(G=V)&&G.box&&G.box.length>0,L=G&&G.offscreen,B=G&&G.occluded,i.useRuntimeCollisionCircles){let r=s.text.placedSymbolArray.get(i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex),o=e.bJ(s.textSizeData,_,r),a=l.get("text-padding");q=this.collisionIndex.placeCollisionCircles(s,T,r,s.lineVertexArray,s.glyphOffsetArray,o,u,c,d,n,I,v.predicate,i.collisionCircleDiameter*o/e.bO,a,this.retainedQueryData[s.bucketInstanceId].tileID),O=T||q.circles.length>0&&!q.collisionDetected,L=L&&q.offscreen,B=q.occluded}if(h.iconFeatureIndex&&(W=h.iconFeatureIndex),h.iconBox){let r=r=>{X(r);let n=i.hasIconTextFit&&j?tq(j.x,j.y,E,I,this.transform.angle):new e.P(0,0),o=s.getSymbolInstanceIconSize(y,this.transform.zoom,i.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(s,o,r,n,S,f,u,v.predicate)};k=U&&U.box&&U.box.length&&h.verticalIconBox?($=r(h.verticalIconBox)).box.length>0:($=r(h.iconBox)).box.length>0,L=L&&$.offscreen,N=$.occluded}let K=b||0===i.numHorizontalGlyphVertices&&0===R,J=w||0===i.numIconVertices;if(K||J?J?K||(k=k&&O):O=k&&O:k=O=k&&O,O&&G&&G.box&&this.collisionIndex.insertCollisionBox(G.box,l.get("text-ignore-placement"),s.bucketInstanceId,U&&U.box&&Z?Z:H,v.ID),k&&$&&this.collisionIndex.insertCollisionBox($.box,l.get("icon-ignore-placement"),s.bucketInstanceId,W,v.ID),q&&(O&&this.collisionIndex.insertCollisionCircles(q.circles,l.get("text-ignore-placement"),s.bucketInstanceId,H,v.ID),n)){let e=s.bucketInstanceId,i=this.collisionCircleArrays[e];void 0===i&&(i=this.collisionCircleArrays[e]=new tj);for(let e=0;e<q.circles.length;e+=4)i.circles.push(q.circles[e+0]),i.circles.push(q.circles[e+1]),i.circles.push(q.circles[e+2]),i.circles.push(+!!q.collisionDetected)}let Q="globe"!==s.projection.name;D=D&&(Q||!B),z=z&&(Q||!N),this.placements[g]=new tN(O||D,k||z,L||s.justReloaded),r.add(g)};if("offset"===s.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(s,this.retainedQueryData[s.bucketInstanceId].tileID),"road"===s.elevationType&&s.updateRoadElevation(),s.updateZOffset(),s.sortFeaturesByY){let i=s.getSortedSymbolIndexes(this.transform.angle);for(let e=i.length-1;e>=0;--e){let r=i[e];B(s.symbolInstances.get(r),r,s.collisionArrays[r])}s.hasAnyZOffset&&e.w(`${s.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(s.hasAnyZOffset){let e=s.getSortedIndexesByZOffset();for(let i=0;i<e.length;++i){let r=e[i];B(s.symbolInstances.get(r),r,s.collisionArrays[r])}}else for(let e=i.symbolInstanceStart;e<i.symbolInstanceEnd;e++)B(s.symbolInstances.get(e),e,s.collisionArrays[e]);if(n&&s.bucketInstanceId in this.collisionCircleArrays){let i=this.collisionCircleArrays[s.bucketInstanceId];e.bi(i.invProjMatrix,u),i.viewportMatrix=this.collisionIndex.getViewportMatrix()}s.justReloaded=!1}markUsedJustification(i,r,n,o){let{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:h,crossTileID:u}=n,c=e.bT(r),d=o===e.bI.vertical?h:"left"===c?a:"center"===c?s:"right"===c?l:-1;a>=0&&(i.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:u),s>=0&&(i.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:u),l>=0&&(i.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:u),h>=0&&(i.text.placedSymbolArray.get(h).crossTileID=d>=0&&h!==d?0:u)}markUsedOrientation(i,r,n){let o=r===e.bI.horizontal||r===e.bI.horizontalOnly?r:0,a=r===e.bI.vertical?r:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:l,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:u}=n,c=i.text.placedSymbolArray;s>=0&&(c.get(s).placedOrientation=o),l>=0&&(c.get(l).placedOrientation=o),h>=0&&(c.get(h).placedOrientation=o),u>=0&&(c.get(u).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,r=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let n=i?i.symbolFadeChange(e):1,o=i?i.opacities:{},a=i?i.variableOffsets:{},s=i?i.placedOrientations:{};for(let e in this.placements){let i=this.placements[e],a=o[e];a?(this.opacities[e]=new tB(a,n,i.text,i.icon,null,i.clipped),r=r||i.text!==a.text.placed||i.icon!==a.icon.placed):(this.opacities[e]=new tB(null,n,i.text,i.icon,i.skipFade,i.clipped),r=r||i.text||i.icon)}for(let e in o){let i=o[e];if(!this.opacities[e]){let o=new tB(i,n,!1,!1);o.isHidden()||(this.opacities[e]=o,r=r||i.text.placed||i.icon.placed)}}for(let e in a)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=a[e]);for(let e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i,r,n){let o=new Set;for(let a of i){let i=a.getBucket(e);i&&a.latestFeatureIndex&&e.fqid===i.layerIds[0]&&(this.updateBucketOpacities(i,o,a,a.collisionBoxArray,r,n,a.tileID,e.scope),"offset"===i.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(i,a.tileID),"road"===i.elevationType&&i.updateRoadElevation(),i.updateZOffset())}}updateBucketOpacities(i,r,n,o,a,s,l,h){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();let u=i.layers[0].layout,c=i.layers[0].paint,d=!!i.layers[0].dynamicFilter(),p=new tB(null,0,!1,!1,!0),f=u.get("text-allow-overlap"),m=u.get("icon-allow-overlap"),g=u.get("text-variable-anchor"),_="map"===u.get("text-rotation-alignment"),y="map"===u.get("text-pitch-alignment"),v=c.get("symbol-z-offset"),x="sea"===u.get("symbol-elevation-reference"),b=!v.isConstant(),w=new tB(null,0,f&&(m||!i.hasIconData()||u.get("icon-optional")),m&&(f||!i.hasTextData()||u.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);let T=(e,i,r)=>{for(let n=0;n<i/4;n++)e.opacityVertexArray.emplaceBack(r)},S=0;s&&i.updateReplacement(l,s);for(let o=0;o<i.symbolInstances.length;o++){let u=i.symbolInstances.get(o),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:f,crossTileID:m,numIconVertices:E,tileAnchorX:I,tileAnchorY:C}=u,A=null,R=this.retainedQueryData[i.bucketInstanceId];b&&u&&R&&(A=n.latestFeatureIndex.loadFeature({featureIndex:u.featureIndex,bucketIndex:R.bucketIndex,sourceLayerIndex:R.sourceLayerIndex,layoutVertexArrayOffset:0}));let M=v.evaluate(A,{}),P=r.has(m),O=this.opacities[m];P?O=p:O||(O=w,this.opacities[m]=O),r.add(m);let k=c>0||f>0,L=E>0,D=this.placedOrientations[m],z=D===e.bI.vertical,F=D===e.bI.horizontal||D===e.bI.horizontalOnly;!k&&!L||O.isHidden()||S++;let B=!1;if((k||L)&&s)for(let r of i.activeReplacements){if(e.bP(r,a,e.bQ.Symbol,h)||r.min.x>I||I>r.max.x||r.min.y>C||C>r.max.y)continue;let i=e.bR(I,C,l.canonical,r.footprintTileId.canonical);if(B=e.bS(i,r.footprint))break}if(k){let e=B?tW:tZ(O.text);T(i.text,c,z?tW:e),T(i.text,f,F?tW:e);let r=O.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:s}=u,l=i.text.placedSymbolArray,h=r||z?1:0;n>=0&&(l.get(n).hidden=h),o>=0&&(l.get(o).hidden=h),a>=0&&(l.get(a).hidden=h),s>=0&&(l.get(s).hidden=r||F?1:0);let d=this.variableOffsets[m];d&&this.markUsedJustification(i,d.anchor,u,D);let p=this.placedOrientations[m];p&&(this.markUsedJustification(i,"left",u,p),this.markUsedOrientation(i,p,u))}if(L){let e=B?tW:tZ(O.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:n}=u,o=i.icon.placedSymbolArray,a=+!!O.icon.isHidden();r>=0&&(T(i.icon,E,z?tW:e),o.get(r).hidden=a),n>=0&&(T(i.icon,u.numVerticalIconVertices,F?tW:e),o.get(n).hidden=a)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){let r=i.collisionArrays[o];if(r){let n=new e.P(0,0),o=!0;if(r.textBox||r.verticalTextBox){if(g){let e=this.variableOffsets[m];e?(n=tG(e.anchor,e.width,e.height,e.textOffset,e.textScale),_&&n._rotate(y?this.transform.angle:-this.transform.angle)):o=!1}d&&(o=!O.clipped),r.textBox&&tH(i.textCollisionBox.collisionVertexArray,O.text.placed,!o||z,M,x,n.x,n.y),r.verticalTextBox&&tH(i.textCollisionBox.collisionVertexArray,O.text.placed,!o||F,M,x,n.x,n.y)}let a=o&&!!(!F&&r.verticalIconBox);r.iconBox&&tH(i.iconCollisionBox.collisionVertexArray,O.icon.placed,a,M,x,u.hasIconTextFit?n.x:0,u.hasIconTextFit?n.y:0),r.verticalIconBox&&tH(i.iconCollisionBox.collisionVertexArray,O.icon.placed,!a,M,x,u.hasIconTextFit?n.x:0,u.hasIconTextFit?n.y:0)}}}if(i.fullyClipped=0===S,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){let e=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=e.invProjMatrix,i.placementViewportMatrix=e.viewportMatrix,i.collisionCircleArray=e.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){let r=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function tH(e,i,r,n,o,a,s){e.emplaceBack(+!!i,+!!r,a||0,s||0,n,+!!o),e.emplaceBack(+!!i,+!!r,a||0,s||0,n,+!!o),e.emplaceBack(+!!i,+!!r,a||0,s||0,n,+!!o),e.emplaceBack(+!!i,+!!r,a||0,s||0,n,+!!o)}function tZ(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 0xffffffff;let i=+!!e.placed,r=Math.floor(127*e.opacity);return 0x2000000*r+0x1000000*i+131072*r+65536*i+512*r+256*i+2*r+i}let tW=0;class tX{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,i,r,n,o,a){let s=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(s,n,e[this._currentTileIndex],this._sortAcrossTiles,a),this._currentTileIndex++,o())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((e,i)=>e.sortKey-i.sortKey));this._currentPartIndex<s.length;){let e=s[this._currentPartIndex];if(i.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart,a),this._currentPartIndex++,o())return!0}return!1}}class tY{constructor(e,i,r,n,o,a,s,l,h){this.placement=new t$(e,o,a,s,l,h),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(i,r,n,o,a){let s=e.q.now(),l=()=>{let i=e.q.now()-s;return!this._forceFullPlacement&&i>2};for(;this._currentPlacementIndex>=0;){let s=r[i[this._currentPlacementIndex]],h=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=h)&&(!s.maxzoom||s.maxzoom>h)){let i=s.layout.get("symbol-z-elevate"),r=void 0!==s.layout.get("symbol-sort-key").constantOr(1),h=s.layout.get("symbol-z-order"),u="viewport-y"===h||"auto"===h&&!("viewport-y"!==h&&r),c=s.layout.get("text-allow-overlap")||s.layout.get("icon-allow-overlap")||s.layout.get("text-ignore-placement")||s.layout.get("icon-ignore-placement"),d=u&&c,p=this._inProgressLayer=this._inProgressLayer||new tX(s),f=e.C(s.source,s.scope);if(p.continuePlacement(i||d?o[f]:n[f],this.placement,this._showCollisionBoxes,s,l,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let tK=512/e.aj/2;class tJ{constructor(i,r,n){this.tileID=i,this.bucketInstanceId=n,this.index=new e.bW(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let o=i.canonical.x*e.aj,a=i.canonical.y*e.aj;for(let e=0;e<r.length;e++){let{key:i,crossTileID:n,tileAnchorX:s,tileAnchorY:l}=r.get(e),h=Math.floor((o+s)*tK),u=Math.floor((a+l)*tK);this.index.add(h,u),this.keys.push(i),this.crossTileIDs.push(n)}this.index.finish()}findMatches(i,r,n){let o=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),a=tK/Math.pow(2,r.canonical.z-this.tileID.canonical.z),s=r.canonical.x*e.aj,l=r.canonical.y*e.aj;for(let e=0;e<i.length;e++){let r=i.get(e);if(r.crossTileID)continue;let{key:h,tileAnchorX:u,tileAnchorY:c}=r,d=Math.floor((s+u)*a),p=Math.floor((l+c)*a);for(let e of this.index.range(d-o,p-o,d+o,p+o).sort((e,i)=>e-i)){let i=this.crossTileIDs[e];if(this.keys[e]===h&&!n.has(i)){n.add(i),r.crossTileID=i;break}}}}}class tQ{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class t0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let i=Math.round((e-this.lng)/360);if(0!==i)for(let e in this.indexes){let r=this.indexes[e],n={};for(let e in r){let o=r[e];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+i),n[o.tileID.key]=o}this.indexes[e]=n}this.lng=e}addBucket(e,i,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<i.symbolInstances.length;e++)i.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);let n=this.usedCrossTileIDs[e.overscaledZ];for(let r in this.indexes){let o=this.indexes[r];if(Number(r)>e.overscaledZ)for(let r in o){let a=o[r];a.tileID.isChildOf(e)&&a.findMatches(i.symbolInstances,e,n)}else{let a=o[e.scaledTo(Number(r)).key];a&&a.findMatches(i.symbolInstances,e,n)}}for(let e=0;e<i.symbolInstances.length;e++){let o=i.symbolInstances.get(e);o.crossTileID||(o.crossTileID=r.generate(),n.add(o.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new tJ(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(let r of i.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let i=!1;for(let r in this.indexes){let n=this.indexes[r];for(let o in n)e[n[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[o]),delete n[o],i=!0)}return i}}class t1{constructor(){this.layerIndexes={},this.crossTileIDs=new tQ,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,r,n){let o=this.layerIndexes[e.fqid];void 0===o&&(o=this.layerIndexes[e.fqid]=new t0);let a=!1,s={};for(let l of("globe"!==n.name&&o.handleWrapJump(r),i)){let i=l.getBucket(e);i&&e.fqid===i.layerIds[0]&&(i.bucketInstanceId||(i.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(l.tileID,i,this.crossTileIDs)&&(a=!0),s[i.bucketInstanceId]=!0)}return o.removeStaleBuckets(s)&&(a=!0),a}pruneUnusedLayers(e){let i={};for(let r in e.forEach(e=>{i[e]=!0}),this.layerIndexes)i[r]||delete this.layerIndexes[r]}}class t2{constructor(e,i,r,n){this.blendFunction=e,this.blendColor=i,this.mask=r,this.blendEquation=n}}t2.Replace=[1,0,1,0],t2.disabled=new t2(t2.Replace,e.am.transparent,[!1,!1,!1,!1]),t2.unblended=new t2(t2.Replace,e.am.transparent,[!0,!0,!0,!0]),t2.alphaBlended=new t2([1,771,1,771],e.am.transparent,[!0,!0,!0,!0]),t2.alphaBlendedNonPremultiplied=new t2([770,771,770,771],e.am.transparent,[!0,!0,!0,!0]),t2.multiply=new t2([774,0,774,0],e.am.transparent,[!0,!0,!0,!0]);class t3{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}t3.ReadOnly=!1,t3.ReadWrite=!0,t3.disabled=new t3(519,t3.ReadOnly,[0,1]);class t5{constructor(e,i,r,n,o,a){this.test=e,this.ref=i,this.mask=r,this.fail=n,this.depthFail=o,this.pass=a}}t5.disabled=new t5({func:519,mask:0},0,0,7680,7680,7680);class t4{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}function t6(i,r){let n=e.c1(i,3);e.c3(i,r),e.c7(i,3,n)}function t8(i,r){let n=e.bY([]);return e.bZ(n,n,-r),e.b_(n,n,-i),n}function t9(i,r){let n=[i[0],i[1],0],o=[r[0],r[1],0];if(e.ae(n)>=1e-15){let i=e.au([],n);e.b$(o,i,e.bE(o,i)),r[0]=o[0],r[1]=o[1]}let a=e.bG([],r,i);if(1e-15>e.c0(a))return null;let s=Math.atan2(-a[1],a[0]);return t8(Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2]),s)}t4.disabled=new t4(!1,1029,2305),t4.backCCW=new t4(!0,1029,2305),t4.backCW=new t4(!0,1029,2304),t4.frontCW=new t4(!0,1028,2304),t4.frontCCW=new t4(!0,1028,2305);class t7{constructor(e,i){this.position=e,this.orientation=i}get position(){return this._position}set position(i){if(i){let r=i instanceof e.ac?i:new e.ac(i[0],i[1],i[2]);this._renderWorldCopies&&(r.x=e.bX(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(i,r){if(this.orientation=null,!this.position)return;let n=this.position,o=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(i)):0,a=e.ac.fromLngLat(i,o),s=[a.x-n.x,a.y-n.y,a.z-n.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=t9(s,r)}setPitchBearing(i,r){this.orientation=t8(e.al(i),e.al(-r))}}class ie{constructor(i,r){this._transform=e.bx([]),this.orientation=r,this.position=i}get mercatorPosition(){let i=this.position;return new e.ac(i[0],i[1],i[2])}get position(){let i=e.c1(this._transform,3);return[i[0],i[1],i[2]]}set position(i){i&&e.c7(this._transform,3,[i[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||e.bY([]),i&&t6(this._transform,this._orientation)}getPitchBearing(){let e=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,i){this._orientation=t8(e,i),t6(this._transform,this._orientation)}forward(){let i=e.c1(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){let i=e.c1(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){let i=e.c1(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,r){let n=new Float64Array(16);return e.bi(n,this.getWorldToCamera(i,r)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,r,n){let o=this.position;e.b$(o,o,-i);let a=new Float64Array(16);return e.bn(a,[n,n,n]),e.bo(a,a,o),a[10]*=r,a}getWorldToCamera(i,r){let n=new Float64Array(16),o=new Float64Array(4),a=this.position;return e.c2(o,this._orientation),e.b$(a,a,-i),e.c3(n,o),e.bo(n,n,a),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r,n}getCameraToClipPerspective(i,r,n,o){let a=new Float64Array(16);return e.c4(a,i,r,n,o),a}getCameraToClipOrthographic(i,r,n,o,a,s){let l=new Float64Array(16);return e.c5(l,i,r,n,o,a,s),l}getDistanceToElevation(i,r=!1){let n=0===i?0:e.c6(i,r?e.aY(this.position[1]):this.position[1]),o=this.forward();return(n-this.position[2])/o[2]}clone(){return new ie([...this.position],[...this.orientation])}}let it={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ii{constructor(e=0,i=0,r=0,n=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0||isNaN(n)||n<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=r,this.right=n}interpolate(i,r,n){return null!=r.top&&null!=i.top&&(this.top=e.ai(i.top,r.top,n)),null!=r.bottom&&null!=i.bottom&&(this.bottom=e.ai(i.bottom,r.bottom,n)),null!=r.left&&null!=i.left&&(this.left=e.ai(i.left,r.left,n)),null!=r.right&&null!=i.right&&(this.right=e.ai(i.right,r.right,n)),this}getCenter(i,r){let n=e.aD((this.left+i-this.right)/2,0,i),o=e.aD((this.top+r-this.bottom)/2,0,r);return new e.P(n,o)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ii(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ir{constructor(i,r,n,o,a,s,l){this.tileSize=512,this._renderWorldCopies=void 0===a||a,this._minZoom=i||0,this._maxZoom=r||22,this._minPitch=n??0,this._maxPitch=o??60,this.setProjection(s),this.setMaxBounds(l),this.width=0,this.height=0,this._center=new e.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ii,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ie,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){let e=new ir(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,i=!1){let r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return e.aF(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};let r=this.projection?this.getProjection():void 0;this.projection=e.ce(this.projectionOptions);let n=this.getProjection(),o=!e.bv(r,n);return o&&this._calcMatrices(),this.mercatorFromTransition=!1,o}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){let i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.ce({name:"mercator"});let r=i!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bX(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(i){let r=-i*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=e.cf(),e.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){let r=e.aD(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=e.al(i),this._calcMatrices())}get fovX(){return this._fov}get fovY(){let e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){let i=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){let e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let r=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration():this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let i=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop(),o=0,a=0;for(let s=0;s<r.length;s++){let l=new e.P(r[s][0]*this.width,n+r[s][1]*(this.height-n)),h=i.pointCoordinate(l);if(!h)continue;let u=1/Math.hypot(h[0]-this._camera.position[0],h[1]-this._camera.position[1]);o+=h[3]*u,a+=u}return 0===a?NaN:o/a}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;let e=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*i,n=Math.max(this._mercatorZfromZoom(e)-r,this._mercatorZfromZoom(this._maxZoom));this._setZoom(this._zoomFromMercatorZ(n))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(i){let r,n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));r=i.z<this._camera.position[2]?[n.x,n.y,n.z]:[i.x,i.y,i.z];let o=e.ae(e.at([],this._camera.position,r));return e.aD(this._zoomFromMercatorZ(o),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let r=!1;if(i.orientation&&!e.ch(i.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(i.orientation)),i.position){let n=[i.position.x,i.position.y,i.position.z];e.ci(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let i=this._camera.position,r=new t7;return r.position=new e.ac(i[0],i[1],i[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(i){if(!e.cj(i))return!1;e.ck(i,i);let r=e.cl([],[0,0,-1],i),n=e.cl([],[0,-1,0],i);if(n[2]<0)return!1;let o=t9(r,n);return!!o&&(this._camera.orientation=o,!0)}_setCameraPosition(i){let r=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,o=this.cameraToCenterDistance;i[2]=e.aD(i[2],o/n,o/r),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,r){this._unmodified=!1,this._edgeInsets.interpolate(e,i,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){return Math.max(0,(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize)))}getVisibleUnwrappedCoordinates(i){let r=[new e.cm(0,i)];if(this.renderWorldCopies){let n=this.pointCoordinate(new e.P(0,0)),o=this.pointCoordinate(new e.P(this.width,0)),a=this.pointCoordinate(new e.P(this.width,this.height)),s=this.pointCoordinate(new e.P(0,this.height)),l=Math.floor(Math.min(n.x,o.x,a.x,s.x)),h=Math.floor(Math.max(n.x,o.x,a.x,s.x));for(let n=l-1;n<=h+1;n++)0!==n&&r.push(new e.cm(n,i))}return r}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,r,n){let o=[],a=null!=n,s=!a;if(s&&this.zoom<r||a&&0===n[0]&&0===n[1])return o;let l=new Set,h=(i,r,n,a,s)=>{let h=e.cK(r,i,n,a,s);l.has(h)||(o.push(new e.aM(i,r,n,a,s)),l.add(h))};for(let e=0;e<i.length;e++){let o=i[e];if(s&&o.canonical.z!==r)continue;let l=o.canonical,u=o.overscaledZ,c=o.wrap,d=1<<l.z,p=l.x+1<d,f=l.x>0,m=l.y+1<d,g=l.y>0,_=o.wrap-!f,y=o.wrap+ +!p,v=f?l.x-1:d-1,x=p?l.x+1:0;if(a)n[0]<0?(h(u,y,l.z,x,l.y),n[1]<0&&m&&(h(u,c,l.z,l.x,l.y+1),h(u,y,l.z,x,l.y+1)),n[1]>0&&g&&(h(u,c,l.z,l.x,l.y-1),h(u,y,l.z,x,l.y-1))):n[0]>0?(h(u,_,l.z,v,l.y),n[1]<0&&m&&(h(u,c,l.z,l.x,l.y+1),h(u,_,l.z,v,l.y+1)),n[1]>0&&g&&(h(u,c,l.z,l.x,l.y-1),h(u,_,l.z,v,l.y-1))):n[1]<0&&m?h(u,c,l.z,l.x,l.y+1):g&&h(u,c,l.z,l.x,l.y-1);else{let e=o.visibleQuadrants;1&e&&(h(u,_,l.z,v,l.y),g&&(h(u,c,l.z,l.x,l.y-1),h(u,_,l.z,v,l.y-1))),2&e&&(h(u,y,l.z,x,l.y),g&&(h(u,c,l.z,l.x,l.y-1),h(u,y,l.z,x,l.y-1))),4&e&&(h(u,_,l.z,v,l.y),m&&(h(u,c,l.z,l.x,l.y+1),h(u,_,l.z,v,l.y+1))),8&e&&(h(u,y,l.z,x,l.y),m&&(h(u,c,l.z,l.x,l.y+1),h(u,y,l.z,x,l.y+1)))}}let u=[];for(let e of o)o.some(i=>e.isChildOf(i))||u.push(e);if(o=u.filter(e=>!i.some(i=>!!(e.overscaledZ<r&&i.isChildOf(e))||e.equals(i)||e.isChildOf(i))),s){let e=1<<r,i="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),n=[e*i.x,e*i.y];o=o.filter(e=>{let i=e.canonical.x+.5-n[0],r=e.canonical.y+.5-n[1];return i*i+r*r<16})}return o}coveringTiles(i){let r,n=this.coveringZoomLevel(i),o=n,a=this.elevation&&this.elevation.exaggeration(),s=a&&!i.isTerrainDEM,l="mercator"===this.projection.name;if(void 0!==i.minzoom&&n<i.minzoom)return[];void 0!==i.maxzoom&&n>i.maxzoom&&(n=i.maxzoom);let h=this.locationCoordinate(this.center),u=this.center.lat,c=1<<n,d=[c*h.x,c*h.y,0],p="globe"===this.projection.name,f=!p,m=e.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,f),g=p?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),_=c*e.c6(1,this.center.lat),y=this._camera.position[2]/e.c6(1,this.center.lat),v=[c*g.x,c*g.y,y*(f?1:_)],x=p||a,b=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),w=this.isLODDisabled(!0)?n:0;if(this._elevation&&i.isTerrainDEM)r=1e4*this._elevation.exaggeration();else if(this._elevation){let e=this._elevation.getMinMaxForVisibleTiles();r=e?e.max:this._centerAltitude}else r=this._centerAltitude;let T=i.isTerrainDEM?-r:this._elevation?this._elevation.getMinElevationBelowMSL():0,S=this.projection.isReprojectedInTileSpace?e.co(this):1,E=i=>{let r=1/4e4,n=new e.ac(i.x+r,i.y,i.z),o=new e.ac(i.x,i.y+r,i.z),a=i.toLngLat(),s=n.toLngLat(),l=o.toLngLat(),h=this.locationCoordinate(a),u=this.locationCoordinate(s),c=this.locationCoordinate(l);return Math.sqrt(Math.hypot(u.x-h.x,u.y-h.y)*Math.hypot(c.x-h.x,c.y-h.y))*S/r},I=i=>{let n=r;return{aabb:e.cr(this,c,0,0,0,i,T,n,this.projection),zoom:0,x:0,y:0,minZ:T,maxZ:n,wrap:i,fullyVisible:!1}},C=[],A=[],R=n,M=i.reparseOverscaled?o:n,P=(y-this._centerAltitude)*_,O=e=>{if(!this._elevation||!e.tileID||!l)return;let i=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;i?(r.min[2]=i.min,r.max[2]=i.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=L(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},k=(e,i)=>{if(.707*i<e)return 1;let r=i/e;return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)},L=i=>{if(i.zoom<w)return!0;if(i.zoom===R)return!1;if(null!=i.shouldSplit)return i.shouldSplit;let r=i.aabb.distanceX(v),n=i.aabb.distanceY(v),a=P,h=1;if(p){a=i.aabb.distanceZ(v);let r=Math.pow(2,i.zoom),n=Math.min(Math.max(u,e.aY((i.y+1)/r)),e.aY(i.y/r)),o=e.cP(n)/e.cP(u);if(h=n===u?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=e.cL&&i.zoom===R-1&&o>=.9)return!0}else if(s&&(a=i.aabb.distanceZ(v)*_),this.projection.isReprojectedInTileSpace&&o<=5){let r=Math.pow(2,i.zoom),n=E(new e.ac((i.x+.5)/r,(i.y+.5)/r));h=n>.85?1:n}if(!l){let e=Math.sqrt(r*r+n*n+a*a),o=(1<<R-i.zoom)*b*h;return o*=k(Math.max(a,P),e),e<o}let c=Number.MAX_VALUE,f=0,m=i.aabb.getCorners(),g=[];for(let i of m){e.at(g,i,v),p||(s?g[2]*=_:g[2]=P);let r=e.bE(g,this._camera.forward());r<c&&(c=r,f=Math.abs(g[2]))}let y=(1<<R-i.zoom)*b*h;if(y*=k(Math.max(f,P),c),c<y)return!0;let x=i.aabb.closestPoint(d);return x[0]===d[0]&&x[1]===d[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)C.push(I(-e)),C.push(I(e));for(C.push(I(0));C.length>0;){let r=C.pop(),o=r.x,a=r.y,h=r.fullyVisible,u=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!h){let i=x?r.aabb.intersects(m):r.aabb.intersectsFlat(m);if(0===i&&u()){let n=new e.cp(r.zoom,o,a);i=e.cq(this,c,n,!0).intersects(m)}if(0===i)continue;h=2===i}if(r.zoom!==R&&L(r))for(let i=0;i<4;i++){let n=(o<<1)+i%2,u=(a<<1)+(i>>1),d={aabb:l?r.aabb.quadrant(i):e.cr(this,c,r.zoom+1,n,u,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:n,y:u,wrap:r.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};s&&!p&&(d.tileID=new e.aM(r.zoom+1===R?M:r.zoom+1,r.wrap,r.zoom+1,n,u),O(d)),C.push(d)}else{let s=r.zoom===R?M:r.zoom;if(i.minzoom&&i.minzoom>s)continue;let l=0;if(!h){let n=x?r.aabb.intersectsPrecise(m):r.aabb.intersectsPreciseFlat(m);if(0===n&&u()){let i=new e.cp(r.zoom,o,a);n=e.cq(this,c,i,!0).intersectsPrecise(m)}if(0===n)continue;if(i.calculateQuadrantVisibility)if(m.containsPoint(r.aabb.center))l=15;else for(let e=0;e<4;e++)0!==r.aabb.quadrant(e).intersects(m)&&(l|=1<<e)}let p=d[0]-(.5+o+(r.wrap<<r.zoom))*(1<<n-r.zoom),f=d[1]-.5-a,g=r.tileID?r.tileID:new e.aM(s,r.wrap,r.zoom,o,a);i.calculateQuadrantVisibility&&(g.visibleQuadrants=l),A.push({tileID:g,distanceSq:p*p+f*f})}}if(this.fogCullDistSq){let n=this.fogCullDistSq,o=this.horizonLineFromTop();A=A.filter(a=>{let s=[0,0,0,1],l=[e.aj,e.aj,0,1],h=this.calculateFogTileMatrix(a.tileID.toUnwrapped());e.aA(s,s,h),e.aA(l,l,h);let u=e.cs([],s,l),c=e.ct([],s,l),d=e.cM(u,c);if(0===d)return!0;let p=!1,f=this._elevation;if(f&&d>n&&0!==o){let n,s=this.calculateProjMatrix(a.tileID.toUnwrapped());i.isTerrainDEM||(n=f.getMinMaxForTile(a.tileID)),n||(n={min:T,max:r});let l=e.cu(this.rotation),h=[l[0]*e.aj,l[1]*e.aj,n.max];e.ad(h,h,s),p=(1-h[1])*this.height*.5<o}return d<n||p})}return A.sort((e,i)=>e.distanceSq-i.distanceSq).map(e=>e.tileID)}resize(e,i){this.width=e,this.height=i,this.pixelsToGLUnits=[2/e,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(i){let r=e.aD(i.lat,-e.cv,e.cv),n=this.projection.project(i.lng,r);return new e.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,r){let n,o,a=this.centerPoint;if("globe"===this.projection.name){let e=this.worldSize;n=(r.x-a.x)/e,o=(r.y-a.y)/e}else{let e=this.pointCoordinate(r),i=this.pointCoordinate(a);n=e.x-i.x,o=e.y-i.y}let s=this.locationCoordinate(i);this.setLocation(new e.ac(s.x-n,s.y-o))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,i){return this.projection.locationPoint(this,e,i)}locationPoint3D(e,i){return this.projection.locationPoint(this,e,i,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,i){return this.coordinateLocation(this.pointCoordinate3D(e,i))}locationCoordinate(i,r){let n=r?e.c6(r,i.lat):void 0,o=this.projection.project(i.lng,i.lat);return new e.ac(o.x,o.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(i,r){let n=null!=r?r:this._centerAltitude,o=[i.x,i.y,0,1],a=[i.x,i.y,1,1];e.aA(o,o,this.pixelMatrixInverse),e.aA(a,a,this.pixelMatrixInverse);let s=a[3];e.cw(o,o,1/o[3]),e.cw(a,a,1/s);let l=o[2],h=a[2];return{p0:o,p1:a,t:l===h?0:(n-l)/(h-l)}}screenPointToMercatorRay(i){let r=[i.x,i.y,0,1],n=[i.x,i.y,1,1];return e.aA(r,r,this.pixelMatrixInverse),e.aA(n,n,this.pixelMatrixInverse),e.cw(r,r,1/r[3]),e.cw(n,n,1/n[3]),r[2]=e.c6(r[2],this._center.lat)*this.worldSize,n[2]=e.c6(n[2],this._center.lat)*this.worldSize,e.cw(r,r,1/this.worldSize),e.cw(n,n,1/this.worldSize),new e.av([r[0],r[1],r[2]],e.au([],e.at([],n,r)))}rayIntersectionCoordinate(i){let{p0:r,p1:n,t:o}=i,a=e.c6(r[2],this._center.lat),s=e.c6(n[2],this._center.lat);return new e.ac(e.ai(r[0],n[0],o)/this.worldSize,e.ai(r[1],n[1],o)/this.worldSize,e.ai(a,s,o))}pointCoordinate(e,i=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,i)}pointCoordinate3D(i,r){if(!this.elevation)return this.pointCoordinate(i,r);let n=this.projection.pointCoordinate3D(this,i.x,i.y);if(n)return new e.ac(n[0],n[1],n[2]);let o=0,a=this.horizonLineFromTop();if(i.y>a)return this.pointCoordinate(i,r);let s=.02*a,l=i.clone();for(let i=0;i<10&&a-o>s;i++){l.y=e.ai(o,a,.66);let i=this.projection.pointCoordinate3D(this,l.x,l.y);i?(a=l.y,n=i):o=l.y}return n?new e.ac(n[0],n[1],n[2]):this.pointCoordinate(i)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=e.cx)return!this.isPointAboveHorizon(i);let r=this.pointCoordinate(i);return r.y>=0&&r.y<=1}_coordinatePoint(i,r){let n=r&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,o=[i.x*this.worldSize,i.y*this.worldSize,n+i.toAltitude(),1];return e.aA(o,o,this.pixelMatrix),o[3]>0?new e.P(o[0]/o[3],o[1]/o[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:i,left:r}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=this.pointLocation3D(new e.P(r,i)),s=this.pointLocation3D(new e.P(o,i)),l=this.pointLocation3D(new e.P(o,n)),h=this.pointLocation3D(new e.P(r,n)),u=Math.min(a.lng,s.lng,l.lng,h.lng),c=Math.max(a.lng,s.lng,l.lng,h.lng),d=Math.min(a.lat,s.lat,l.lat,h.lat),p=Math.max(a.lat,s.lat,l.lat,h.lat),f=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,g=(i,r,n,o,a)=>{let s=(i+n)/2,l=(r+o)/2,h=new e.P(s,l),{lng:_,lat:y}=this.pointLocation3D(h),v=Math.max(0,u-_,d-y,_-c,y-p);u=Math.min(u,_),c=Math.max(c,_),d=Math.min(d,y),p=Math.max(p,y),(a<m||v>f)&&(g(i,r,s,l,a+1),g(s,l,n,o,a+1))};if(g(r,i,o,i,1),g(o,i,o,n,1),g(o,n,r,n,1),g(r,n,r,i,1),"globe"===this.projection.name){let[i,r]=e.cy(this);i?(p=90,c=180,u=-180):r&&(d=-90,c=180,u=-180)}return new e.aG(new e.cd(u,d),new e.cd(c,p))}_getBoundsRectangular(i,r){let{top:n,left:o}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,l=new e.P(o,n),h=new e.P(s,n),u=new e.P(s,a),c=new e.P(o,a),d=this.pointCoordinate(l,i),p=this.pointCoordinate(h,i),f=this.pointCoordinate(u,r),m=this.pointCoordinate(c,r),g=(e,i)=>(i.y-e.y)/(i.x-e.x);return d.y>1&&p.y>=0?d=new e.ac((1-m.y)/g(m,d)+m.x,1):d.y<0&&p.y<=1&&(d=new e.ac(-m.y/g(m,d)+m.x,0)),p.y>1&&d.y>=0?p=new e.ac((1-f.y)/g(f,p)+f.x,1):p.y<0&&d.y<=1&&(p=new e.ac(-f.y/g(f,p)+f.x,0)),(new e.aG).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(f))}_getBoundsRectangularTerrain(){let e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);let i=e.visibleDemTiles.reduce((e,i)=>{if(i.dem){let r=i.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*e.exaggeration(),i.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){let i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-i*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-e.cv,this.maxLat=e.cv,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.ay(this.minLng)*this.tileSize,this.worldMaxX=e.ay(this.maxLng)*this.tileSize,this.worldMinY=e.aH(this.maxLat)*this.tileSize,this.worldMaxY=e.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,i){return this.projection.createTileMatrix(this,i,e)}calculateDistanceTileData(i){let r=i.key,n=this._distanceTileDataCache;if(n[r])return n[r];let o=i.canonical,a=1/this.height,s=this.cameraWorldSize,l=s/this.zoomScale(o.z),h=(o.x+Math.pow(2,o.z)*i.wrap)*l,u=o.y*l,c=this.point;c.x*=s/this.worldSize,c.y*=s/this.worldSize;let d=this.angle,p=Math.sin(-d),f=-Math.cos(-d);return n[r]={bearing:[p,f],center:[(c.x-h)*a,(c.y-u)*a],scale:l/e.aj*a},n[r]}calculateFogTileMatrix(i){let r=i.key,n=this._fogTileMatrixCache;if(n[r])return n[r];let o=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return e.az(o,this.worldToFogMatrix,o),n[r]=new Float32Array(o),n[r]}calculateProjMatrix(i,r=!1,n=!1){let o,a,s=i.key;if((o=n?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache)[s])return o[s];let l=this.calculatePosMatrix(i,this.worldSize);return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,e.az(l,a,l),o[s]=new Float32Array(l),o[s]}calculatePixelsToTileUnitsMatrix(i){let r=i.tileID.key,n=this._pixelsToTileUnitsCache;if(n[r])return n[r];let o=e.cz(i,this);return n[r]=o,n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){let i=1/this.worldSize,r=e.bn([],[i,i,i]);return e.az(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;let i=this._elevation;this._updateCameraState();let r=e.c6(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),o=this._camera.forward(),a=e.c6(1,this._center.lat);n[2]/=a,o[2]/=a,e.au(o,o);let s=i.raycast(n,o,i.exaggeration());if(s){let i=e.bF([],n,o,s),r=new e.ac(i[0],i[1],e.c6(i[2],e.aY(i[1]))),l=(r.z+e.ae([r.x-n[0],r.y-n[1],r.z-n[2]*a]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(l),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;let r=this._elevation,n=e.c6(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(n),a=r.getAtPointOrZero(new e.ac(...o)),s=this.pixelsPerMeter/this.worldSize*a,l=this._minimumHeightOverTerrain(),h=o[2]-s;if(h<=l)if(h<0||i){let i=this.locationCoordinate(this._center,this._centerAltitude),r=[o[0],o[1],i.z-o[2]],n=e.ae(r);r[2]-=(l-h)/this._pixelsPerMercatorPixel;let a=e.ae(r);if(0===a)return;e.b$(r,r,n/a*this._pixelsPerMercatorPixel),this._camera.position=[o[0],o[1],i.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){let r=this.center;return r.lat=e.aD(r.lat,this.minLat,this.maxLat),!this.maxBounds&&(this.renderWorldCopies||i)||(r.lng=e.aD(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}let r=this._unmodified,{x:n,y:o}=this.point,a=0,s=n,l=o,h=this.width/2,u=this.height/2,c=this.worldMinY*this.scale,d=this.worldMaxY*this.scale;if(o-u<c&&(l=c+u),o+u>d&&(l=d-u),d-c<this.height&&(a=Math.max(a,this.height/(d-c)),l=(d+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let e=this.worldMinX*this.scale,i=this.worldMaxX*this.scale,r=this.worldSize/2-(e+i)/2;(s=(n+r+this.worldSize)%this.worldSize-r)-h<e&&(s=e+h),s+h>i&&(s=i-h),i-e<this.width&&(a=Math.max(a,this.width/(i-e)),s=(i+e)/2)}s===n&&l===o||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(s,l))),a&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(a)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){let i;if(!this.height)return;let r=this.centerOffset,n="globe"===this.projection.name,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.c6(1,this.center.lat)/e.c6(1,e.cN));let a=e.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let s="meters"===this.projection.zAxisUnit?o:1,l=this._camera.getWorldToCamera(this.worldSize,s),h=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(h[8]=-(2*r.x)/this.width,h[9]=2*r.y/this.height,this.isOrthographic){let n=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),o=n*this.aspect,a=-o,s=-n;o-=r.x,a-=r.x,n+=r.y,s+=r.y,((i,r,n,o)=>{for(let a=0;a<16;a++)i[a]=e.ai(r[a],n[a],o)})(i=this._camera.getCameraToClipOrthographic(a,o,s,n,this._nearZ,this._farZ),i,h,e.cO(this.pitch>=15?1:this.pitch/15))}else i=h;let u=e.cB([],h,l),c=e.cB([],i,l);if(this.projection.isReprojectedInTileSpace){let i=this.locationCoordinate(this.center),r=e.bx([]);e.bo(r,r,[i.x*this.worldSize,i.y*this.worldSize,0]),e.az(r,r,e.cC(this)),e.bo(r,r,[-i.x*this.worldSize,-i.y*this.worldSize,0]),e.az(c,c,r),e.az(u,u,r),this.inverseAdjustmentMatrix=e.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cE([],c,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=c,this.invProjMatrix=e.bi(new Float64Array(16),this.projMatrix),n){let i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=-(2*r.x)/this.width,i[9]=2*r.y/this.height,this.expandedFarZProjMatrix=e.cB([],i,l)}else this.expandedFarZProjMatrix=this.projMatrix;let d=e.bi([],i);this.frustumCorners=e.cF.fromInvProjectionMatrix(d,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);let p=new Float32Array(16);e.bx(p),e.cE(p,p,[1,-1,1]),e.cG(p,p,this._pitch),e.by(p,p,this.angle);let f=e.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bw(f);let m=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;f[8]=-(2*r.x)/this.width,f[9]=2*(r.y+m)/this.height,this.skyboxMatrix=e.az(p,f,p);let g=this.point,_=g.x,y=g.y,v=this.width%2/2,x=this.height%2/2,b=Math.cos(this.angle),w=Math.sin(this.angle),T=_-Math.round(_)+b*v+w*x,S=y-Math.round(y)+b*x+w*v,E=new Float64Array(c);if(e.bo(E,E,[T>.5?T-1:T,S>.5?S-1:S,0]),this.alignedProjMatrix=E,c=e.bz(),e.cE(c,c,[this.width/2,-this.height/2,1]),e.bo(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=e.bz(),e.cE(c,c,[1,-1,1]),e.bo(c,c,[-1,-1,0]),e.cE(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=e.az(new Float64Array(16),this.labelPlaneMatrix,u),this._calcFogMatrices(),this._distanceTileDataCache={},!(c=e.bi(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");if(this.pixelMatrixInverse=c,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cH(this);let i=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad(i,i,l),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let i=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,n=this._camera.position,o=1/this.height/this._pixelsPerMercatorPixel,a=[i,i,r];e.b$(a,a,o),e.b$(n,n,-1),e.cI(n,n,a);let s=e.bz();e.bo(s,s,n),e.cE(s,s,a),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,r,o)}_computeCameraPosition(e){let i=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,o=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*o,n.y/this.worldSize-r[1]*o,e/this.worldSize*this._centerAltitude-r[2]*o]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){let r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],o=i[2],a=1;this.projection.wrap&&(this.center=this.center.wrap()),o>0&&(a=Math.min((r-n)/o,1)),this._camera.position=e.bF([],this._camera.position,i,a),this._updateStateFromCamera()}_updateStateFromCamera(){let i=this._camera.position,r=this._camera.forward(),{pitch:n,bearing:o}=this._camera.getPitchBearing(),a=e.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.al(this._maxPitch)),l=Math.max((i[2]-a)/Math.cos(n),s),h=this._zoomFromMercatorZ(l);e.bF(i,i,r,l),this._pitch=e.aD(n,e.al(this.minPitch),e.al(this.maxPitch)),this.angle=e.bX(o,-Math.PI,Math.PI),this._setZoom(e.aD(h,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){let e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(i){let r=0,n=e.cx,o=0,a=1/0;for(;n-r>1e-6&&n>r;){let e=r+.5*(n-r),s=this.tileSize*Math.pow(2,e),l=this.getCameraToCenterDistance(this.projection,e,s),h=this.scaleZoom(l/(i*this.tileSize)),u=Math.abs(e-h);u<a&&(a=u,o=e),e<h?r=e:n=e}return o}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,r){let n=Math.min(i.x,r.x),o=Math.max(i.x,r.x),a=Math.min(i.y,r.y),s=Math.max(i.y,r.y);if(a<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;let l=[new e.P(n,a),new e.P(o,s),new e.P(n,s),new e.P(o,a)],h=this.renderWorldCopies?-3:0,u=this.renderWorldCopies?4:1;for(let e of l){let i=this.pointRayIntersection(e);if(i.t<0)return!0;let r=this.rayIntersectionCoordinate(i);if(r.x<h||r.y<0||r.x>u||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(i,r){let n=e.ae(e.at([],this._camera.position,i)),o=this._zoomFromMercatorZ(n)+r;return n-this._mercatorZfromZoom(o)}getCameraPoint(){if("globe"===this.projection.name){let i=function([i,r,n],o){let a=[i,r,n,1];e.aA(a,a,o);let s=a[3]=Math.max(a[3],1e-6);return a[0]/=s,a[1]/=s,a[2]/=s,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(i[0],i[1])}{let i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,i))}}getCameraToCenterDistance(i,r=this.zoom,n=this.worldSize){let o=e.cA(i,r,this.width,this.height,1024),a=i.pixelSpaceConversion(this.center.lat,n,o),s=.5/Math.tan(.5*this._fov)*this.height*a;return this.isOrthographic&&(s=e.ai(1,s,e.cO(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){let i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.az(i,i,this.globeMatrix),i}getFrustum(i){return e.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,"meters"===this.projection.zAxisUnit)}}let io=(i,r)=>{if(r>0&&i.terrain&&e.w("Cutoff is currently disabled on terrain"),r<=0||i.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let n=i.transform,o=Math.max(Math.abs(n._zoom-(i.minCutoffZoom-1)),1),a=n.isLODDisabled(!1)?e.af(60,45,n.pitch):e.af(30,15,n.pitch),s=n._farZ-n._nearZ,l=r*n.height,h=((1-a)*n.cameraToCenterDistance+a*(n._farZ+l))*o;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(h-n._nearZ)/s,(h-l-n._nearZ)/s]}}},ia={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class is{constructor(e,i){this.aabb=e,this.lastCascade=i}}class il{add(e,i){let r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],i.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],i.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],i.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],i.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],i.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],i.max[2])):this.receivers[e.key]=new is(i,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(i,r,n){let o=e.cV.fromPoints(i.points),a=0;for(let i in this.receivers){let s=this.receivers[i];if(!s||!o.intersectsAabb(s.aabb))continue;s.aabb.min=o.closestPoint(s.aabb.min),s.aabb.max=o.closestPoint(s.aabb.max);let l=s.aabb.getCorners();for(let i=0;i<n.length;i++){let o=!0;for(let a of l){let s=[a[0]*r,a[1]*r,a[2]];if(e.ad(s,s,n[i].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){o=!1;break}}if(s.lastCascade=i,a=Math.max(a,i),o)break}}return a+1}}class ih{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new il,this._depthMode=new t3(e.context.gl.LEQUAL,t3.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),e.tp.registerParameter(ia,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(ia,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(ia,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,r){let n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;let o=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||o<=0||(this._shadowLayerCount=n.style.order.reduce((e,r)=>{let o=n.style._mergedLayers[r];return e+(o.hasShadowPass()&&!o.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let a=n.context,s=ia.shadowMapResolution,l=ia.shadowMapResolution;if(0===this._cascades.length||ia.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let i=0;i<ia.cascadeCount;++i){let i=n._shadowMapDebug,r=a.gl,o=a.createFramebuffer(s,l,i,"texture"),h=new e.T(a,{width:s,height:l,data:null},r.DEPTH_COMPONENT16);if(o.depthAttachment.set(h.texture),i){let i=new e.T(a,{width:s,height:l,data:null},r.RGBA8);o.colorAttachment.set(i.texture)}this._cascades.push({framebuffer:o,texture:h,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cn,scale:0})}}this.shadowDirection=ic(r);let h=0;if(i.elevation){let e=i.elevation,r=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{let i=e.dem.tree;r[0]=Math.min(r[0],i.minimums[0]),r[1]=Math.max(r[1],i.maximums[0])}),1e4!==r[0]&&(h=(r[1]-r[0])*e.exaggeration())}let u=1.5*i.cameraToCenterDistance,c=3*u,d=new Float64Array(16);for(let r=0;r<this._cascades.length;++r){let n=this._cascades[r],o=i.height/50,a=1;1===ia.cascadeCount?a=c:0===r?a=u:(o=u,a=c);let[s,l]=function(i,r,n,o,a,s){let l,h,u=i.zoom,c=i.scale,d=i.worldSize,p=1/d,f=i.aspect,m=Math.sqrt(1+f*f)*Math.tan(.5*i.fovX),g=m*m,_=o-n,y=o+n;g>_/y?(l=o,h=o*m):(l=.5*y*(1+g),h=.5*Math.sqrt(_*_+2*(o*o+n*n)*g+y*y*g*g));let v=i.projection.pixelsPerMeter(i.center.lat,d),x=i._camera.getCameraToWorldMercator(),b=[0,0,-l*p];e.ad(b,b,x);let w=h*p,T=i._edgeInsets;if((0!==T.left||0!==T.top||0!==T.right||0!==T.bottom)&&(T.left!==T.right||T.top!==T.bottom)){let r=i._camera.getWorldToCamera(i.worldSize,"meters"===i.projection.zAxisUnit?v:1),a=i._camera.getCameraToClipPerspective(i._fov,i.width/i.height,n,o);a[8]=-(2*i.centerOffset.x)/i.width,a[9]=2*i.centerOffset.y/i.height;let s=new Float64Array(16);e.cB(s,a,r);let l=new Float64Array(16);for(let r of(e.bi(l,s),e.cn.fromInvProjectionMatrix(l,d,u,!0).points)){let n=(r[0]/=c,r[1]/=c,r[2]=e.c6(r[2],i._center.lat),r);w=Math.max(w,e.c0(e.cY([],b,n)))}}w*=a/(a-1);let S=Math.acos(r[2]),E=Math.atan2(-r[0],-r[1]),I=new ie;I.position=b,I.setPitchBearing(S,E);let C=I.getWorldToCamera(d,v),A=w*d,R=Math.min(-(i._mercatorZfromZoom(17)*d*2),-2*A),M=I.getCameraToClipOrthographic(-A,A,-A,A,R,(A+s*v)/r[2]),P=new Float64Array(16);e.az(P,M,C);let O=e.cS(Math.floor(1e6*b[0])/1e6*d,Math.floor(1e6*b[1])/1e6*d,0),k=.5*a,L=[0,0,0];e.ad(L,O,P),e.b$(L,L,k);let D=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],z=[0,0,0];e.at(z,L,D),e.b$(z,z,-1/k);let F=new Float64Array(16);return e.bx(F),e.bo(F,F,z),e.az(P,F,P),[P,A]}(i,this.shadowDirection,o,a,ia.shadowMapResolution,h);n.scale=i.scale,n.matrix=s,n.boundingSphereRadius=l,e.bi(d,n.matrix),n.frustum=e.cn.fromInvProjectionMatrix(d,1,0,!0),n.far=a}let p=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[p].far,this._cascades[p].far],this._uniformValues.u_shadow_intensity=o,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ia.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ia.shadowMapResolution,this._uniformValues.u_shadowmap_0=it.ShadowMap0,this._uniformValues.u_shadowmap_1=it.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let f=n.transform.elevation;for(let e of this._groundShadowTiles){let i={min:0,max:0};if(f){let r=f.getMinMaxForTile(e);r&&(i=r)}this.addShadowReceiver(e.toUnwrapped(),i.min,i.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(i,r){if(!this.enabled)return;let n=this.painter,o=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),o.viewport.set([0,0,ia.shadowMapResolution,ia.shadowMapResolution]);for(let a=0;a<this._numCascadesToRender;++a)for(let s of(n.currentShadowCascade=a,o.bindFramebuffer.set(this._cascades[a].framebuffer.framebuffer),o.clear({color:e.am.white,depth:1}),i.order)){let e=i._mergedLayers[s];if(!e.hasShadowPass()||e.isHidden(n.transform.zoom))continue;let o=i.getLayerSourceCache(e),a=o?r[o.id]:void 0;("model"===e.type||a&&a.length)&&n.renderLayer(n,o,e,a)}n.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let e=this.painter,i=e.style,r=e.context,n=i.directionalLight,o=i.ambientLight;if(!n||!o)return;let a=[],s=io(e,e.longestCutoffRange);s.shouldRenderCutoff&&a.push("RENDER_CUTOFF"),a.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&a.push("NORMAL_OFFSET");let l=id(i,n,o),h=new t3(r.gl.LEQUAL,t3.ReadOnly,e.depthRangeFor3D);for(let i of this._groundShadowTiles){let n=i.toUnwrapped(),o=e.isTileAffectedByFog(i),u=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:o});this.setupShadows(n,u),e.uploadCommonUniforms(r,u,n,null,s);let c={u_matrix:e.transform.calculateProjMatrix(n),u_ground_shadow_factor:l};u.draw(e,r.gl.TRIANGLES,h,t5.disabled,t2.multiply,t4.disabled,c,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t2.unblended:t2.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){let r=this.painter.transform,n=r.calculatePosMatrix(i,r.worldSize);return e.az(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(i){return e.az(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,r,n,o=0){if(!this.enabled)return;let a=this.painter.transform,s=this.painter.context,l=s.gl,h=this._uniformValues,u=new Float64Array(16),c=a.calculatePosMatrix(i,a.worldSize);for(let i=0;i<this._cascades.length;i++)e.az(u,this._cascades[i].matrix,c),h[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(u),s.activeTexture.set(l.TEXTURE0+it.ShadowMap0+i),this._cascades[i].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){let r=e.cT(i.canonical),s=2/a.tileSize*e.aj/ia.shadowMapResolution,l=s*this._cascades[0].boundingSphereRadius,u=s*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===n?1:3)/Math.pow(2,o-i.canonical.z-(1-a.zoom+Math.floor(a.zoom)));h.u_shadow_normal_offset=[r,l*c,u*c],h.u_shadow_bias=[6e-5,.0012,.012]}else h.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(s,h)}setupShadowsFromMatrix(i,r,n=!1){if(!this.enabled)return;let o=this.painter.context,a=o.gl,s=this._uniformValues,l=new Float64Array(16);for(let r=0;r<ia.cascadeCount;r++)e.az(l,this._cascades[r].matrix,i),s[0===r?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(a.TEXTURE0+it.ShadowMap0+r),this._cascades[r].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){let e=ia.normalOffset;s.u_shadow_normal_offset=[1,e,e],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(o,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,r,n,o){if(o[2]>=0)return{};let a=(function(i,r,n){let o=n/(1<<i.canonical.z);return new e.cV([i.canonical.x*o+i.wrap*n,i.canonical.y*o+i.wrap*n,0],[(i.canonical.x+1)*o+i.wrap*n,(i.canonical.y+1)*o+i.wrap*n,r])})(i,r,n).getCorners(),s=-(r/o[2]);o[0]<0?(e.cU(a[0],a[0],[o[0]*s,0,0]),e.cU(a[3],a[3],[o[0]*s,0,0])):o[0]>0&&(e.cU(a[1],a[1],[o[0]*s,0,0]),e.cU(a[2],a[2],[o[0]*s,0,0])),o[1]<0?(e.cU(a[0],a[0],[0,o[1]*s,0]),e.cU(a[1],a[1],[0,o[1]*s,0])):o[1]>0&&(e.cU(a[2],a[2],[0,o[1]*s,0]),e.cU(a[3],a[3],[0,o[1]*s,0]));let l={};return l.vertices=a,l.planes=[iu(a[1],a[0],a[4]),iu(a[2],a[1],a[5]),iu(a[3],a[2],a[6]),iu(a[0],a[3],a[7])],l}addShadowReceiver(i,r,n){this._receivers.add(i,e.cV.fromTileIdAndHeight(i,r,n))}getMaxCascadeForTile(e){let i=this._receivers.get(e);return i&&i.lastCascade?i.lastCascade:0}}function iu(i,r,n){let o=e.at([],n,r),a=e.at([],i,r),s=e.bG([],o,a),l=e.ae(s);return 0===l?[0,0,1,0]:(e.b$(s,s,1/l),[s[0],s[1],s[2],-e.bE(s,r)])}function ic(i){let r=i.properties.get("direction"),n=e.cR(r.x,r.y,r.z);n[2]=e.aD(n[2],0,75);let o=e.cW([n[0],n[1],n[2]]);return e.cS(o.x,o.y,o.z)}function id(i,r,n){let o="none"===r.properties.get("color-use-theme"),a=r.properties.get("color"),s=r.properties.get("intensity"),l=r.properties.get("direction"),h=[l.x,l.y,l.z],u="none"===n.properties.get("color-use-theme"),c=n.properties.get("color"),d=n.properties.get("intensity"),p=Math.max(e.bE([0,0,1],h),0),f=[0,0,0];e.b$(f,c.toRenderColor(u?null:i.getLut(r.scope)).toArray01Linear().slice(0,3),d);let m=[0,0,0];return e.b$(m,a.toRenderColor(o?null:i.getLut(n.scope)).toArray01Linear().slice(0,3),p*s),e.cX([f[0]>0?f[0]/(f[0]+m[0]):0,f[1]>0?f[1]/(f[1]+m[1]):0,f[2]>0?f[2]/(f[2]+m[2]):0])}class ip extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(i,r){return e.aS(this.requestManager.transformRequest(r,e.R.Model).url).then(r=>{if(!r)return;let n=e.aT(r),o=new e.aU(i,void 0,void 0,n);return o.computeBoundsAndApplyParent(),o}).catch(n=>{if(n&&404===n.status)return null;this.fire(new e.z(Error(`Could not load model ${i} from ${r}: ${n.message}`)))})}load(i,r,n={forceReload:!1}){this.models[r]||(this.models[r]={});let o=Object.keys(i),a=[],s=[];for(let e of o){let o=i[e];this.hasURLBeenRequested(o)&&!n.forceReload||(this.modelByURL[o]={modelId:e,scope:r},a.push(this.loadModel(e,o)),s.push(e)),this.models[r][e]||(this.models[r][e]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+s.length,Promise.allSettled(a).then(i=>{for(let e=0;e<i.length;e++){let{status:n}=i[e];if("rejected"===n)continue;let{value:o}=i[e];this.models[r][s[e]]||(this.models[r][s[e]]={model:null,numReferences:1}),this.models[r][s[e]].model=o}this.numModelsLoading[r]-=s.length,this.fire(new e.A("data",{dataType:"style"}))}).catch(i=>{this.fire(new e.z(Error(`Could not load models: ${i.message}`)))})}isLoaded(){for(let e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,i,r={exactIdMatch:!1}){return!!(r.exactIdMatch?this.getModel(e,i):this.getModelByURL(this.modelUris[i][e]))}getModel(e,i){return this.models[i]||(this.models[i]={}),this.models[i][e]?this.models[i][e].model:void 0}getModelByURL(e){if(!e)return null;let i=this.modelByURL[e];return i?this.models[i.scope][i.modelId].model:null}hasModelBeenAdded(e,i){return this.models[i]&&void 0!==this.models[i][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,i,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});let n=this.requestManager.normalizeModelURL(i);if((this.hasModel(e,r,{exactIdMatch:!0})||this.hasModelBeenAdded(e,r))&&this.modelUris[r][e]===n)this.models[r][e].numReferences++;else if(this.hasURLBeenRequested(n)){let{scope:e,modelId:i}=this.modelByURL[n];this.models[e][i].numReferences++}else this.modelUris[r][e]=n,this.load({[e]:this.modelUris[r][e]},r)}addModelURLs(e,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});let r=this.modelUris[i];for(let i in e)r[i]=this.requestManager.normalizeModelURL(e[i])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(i,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});let n={};for(let o of i)this.hasModel(o,r,{exactIdMatch:!0})||this.hasURLBeenRequested(o)?this.models[r][o].numReferences++:this.modelUris[r][o]&&!this.hasURLBeenRequested(o)?n[o]=this.modelUris[r][o]:!this.hasURLBeenRequested(o)&&e.cZ(o,!1)&&(this.modelUris[r][o]=this.requestManager.normalizeModelURL(o),n[o]=this.modelUris[r][o]);this.load(n,r)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,i,r=!1){if(this.models[i]&&this.models[i][e]&&(this.models[i][e].numReferences--,0===this.models[i][e].numReferences)){let n=this.modelUris[i][e];r||delete this.modelUris[i][e],delete this.modelByURL[n];let o=this.models[i][e].model;o&&(delete this.models[i][e],o.destroy())}}destroy(){for(let e of Object.keys(this.models))for(let i of Object.keys(this.models[e])){let r=this.models[e][i].model;delete this.models[e][i],r&&r.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,i){for(let r in this.models[i]||(this.models[i]={}),this.models[i])this.models[i][r].model&&this.models[i][r].model.upload(e.context)}}let im=new e.a7({data:new e.a8(e.a5.colorTheme.data)}),ig={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function i_(e){return Object.assign(e=e||{},ig)}class iy extends e.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},e.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new e.z(Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:e=>(e.feature&&e.feature.properties.floorplan&&this.selectFloorplan(e.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(e,i){let[r,n]=e,{center:o,radius:a}=i,[s,l]=o,h=Math.abs(r-s);return Math.sqrt((h>180?360-h:h)**2+(n-l)**2)<=a}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new e.A("floorplangone")));let r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},n=new e.P(this._map.transform.width/2,this._map.transform.height/2),o=[new e.P(0,0),new e.P(this._map.transform.width,this._map.transform.height)],a=this._map.queryRenderedFeatures(i?o:n,r);a.length>0&&(this._selectedFloorplan&&a[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=a[0],this._floorplanSelected(!1)))}_floorplanSelected(i){let r;this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(e){let[[i,r],[n,o]]=e,a=(n-i+360)%360,s=a>180?360-a:a;return{center:[(i+s/2+360)%360,(r+o)/2],radius:Math.sqrt(s**2+(o-r)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});let n=this._floorplanStates[this._indoorData.id].selectedBuilding,o=this._floorplanStates[this._indoorData.id].selectedLevel;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(let e of this._indoorData.levels)e.id===this._selectedLevel.id&&(r=e.id);if(this.fire(new e.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:r})),n){let e=this._indoorData.buildings.find(e=>e.id===n);this._buildingSelected(e,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(o){let e=this._indoorData.levels.find(e=>e.id===o);this._updateLevels(e,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,r){r&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;let n=this._indoorData.levels.filter(e=>i.levels.includes(e.id));this.fire(new e.A("buildingselected",{buildingId:i.id,levels:n}))}_levelSelected(i){if("overview"===i)this._updateLevels(void 0,!0);else{let e=this._indoorData.levels.find(e=>e.id===i);this._updateLevels(e,!0)}this.fire(new e.A("levelselected",{levelId:"overview"===i?void 0:i}))}_updateLevels(e,i){if(!e)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(i&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function r(e){let i=e.indexOf("/floor/");if(-1===i)return e;let r=i+7,n=e.indexOf("/",r);return -1===n?e.slice(r):e.slice(r,n)}this._selectedLevel=e,this._floorplanStates[this._indoorData.id].selectedLevel=e?e.id:void 0;let n=[],o={},a={},s={},l={};for(let i of this._indoorData.levels)if(n.push(i.id),o[i.id]=i.height,a[i.id]=i.base,e){if(this.mergeFloors){let n=r(e.id),o=r(i.id);s[i.id]=o===n?"true":"false"}else s[i.id]=i.id===e.id?"true":"false";l[i.id]=i.base<e.base?"true":"false"}else l[i.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",n]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",o]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",a]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",s]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",l]),e&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!e.isUnderground),i&&e.extent)){let i=this._map.cameraForBounds(e.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),r=this._map.getZoom(),n=i.zoom?Math.abs(r-i.zoom):0;this._map.fitBounds(e.extent,n>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:r})}}selectFloorplan(i){let r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},n=[new e.P(0,0),new e.P(this._map.transform.width,this._map.transform.height)],o=this._map.queryRenderedFeatures(n,r);if(o.length>0){for(let e of o)if(JSON.parse(e.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=e,this._floorplanSelected(!0);break}}}selectBuilding(e){let i=this._indoorData.buildings.find(i=>i.id===e);this._buildingSelected(i,!0)}selectLevel(e){this._levelSelected(e)}}function iv(i){if(i)return i.map(([i,r])=>[i*e.q.devicePixelRatio,r*e.q.devicePixelRatio])}class ix{constructor(e,i,r){this.id=e,this.scope=i,this.sourceCache=r,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){let i=new Map;if(!this.sourceCache.loaded())return i;let r=this.sourceCache.getVisibleCoordinates();if(0===r.length)return i;let n=this.sourceCache.getSource();if(!(n instanceof eK))return i;let o=r.map(e=>this.sourceCache.getTile(e));for(let[r,a]of n.getImages(o,Array.from(this.pendingRequests)))i.set(e.I.from({name:r,iconsetId:this.id}),a),this.pendingRequests.delete(r);for(let e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),i}}let ib=(e,i)=>eA(e,i&&i.filter(e=>"source.canvas"!==e.identifier)),iw=e.aF(tu,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),iT=e.aF(tu,["setCenter","setZoom","setBearing","setPitch"]),iS=new Set(["background","sky","slot","custom"]),iE={version:8,layers:[],sources:{}},iI={duration:300,delay:0};class iC extends e.E{constructor(i,r={}){super(),this.map=i,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=e.l({},iI),this._buildingIndex=new tl(this),this.crossTileSymbolIndex=new t1,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new q,this.dispatcher=r.dispatcher?r.dispatcher:new e.D(e.d0(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new $(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new e.d1(i._requestManager,r.localFontFamily?e.d2.all:r.localIdeographFontFamily?e.d2.ideographs:e.d2.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new ip(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",e.d3());let n=this;this._rtlTextPluginCallback=iC.registerForPluginStateChange(i=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:i.pluginStatus,pluginURL:i.pluginURL},(i,r)=>{if(e.d4(i),r&&r.every(e=>e))for(let e in n._sourceCaches){let i=n._sourceCaches[e],r=i.getSource().type;"vector"!==r&&"geojson"!==r||i.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;let i=this.getOwnSource(e.sourceId);if(i&&i.vectorLayerIds)for(let e in this._layers){let r=this._layers[e];r.source===i.id&&this._validateLayer(r)}})}load(e){return e&&("string"==typeof e?this.loadURL(e):this.loadJSON(e)),this}_getGlobalId(i){if(!i)return null;if("string"==typeof i){if(e.f(i))return i;let r=e.d5(i);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch(e){}return r}return`json://${e.d6(JSON.stringify(i))}`}_diffStyle(i,r,n){this.globalId=this._getGlobalId(i);let o=(e,i)=>{try{i(null,this.setState(e,n))}catch(e){i(e,!1)}};if("string"==typeof i){let n=this.map._requestManager.normalizeStyleURL(i),a=this.map._requestManager.transformRequest(n,e.R.Style);e.n(a,(i,n)=>{i?this.fire(new e.z(i)):n&&o(n,r)})}else"object"==typeof i&&o(i,r)}loadURL(i,r={}){this.fire(new e.A("dataloading",{dataType:"style"}));let n="boolean"==typeof r.validate?r.validate:!e.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,r.accessToken),this.resolvedImports.add(i);let o=this.importsCache.get(i);if(o)return this._load(o,n);let a=this.map._requestManager.transformRequest(i,e.R.Style);this._request=e.n(a,(r,o)=>{if(this._request=null,r)this.fire(new e.z(r));else if(o)return this.importsCache.set(i,o),this._load(o,n)})}loadJSON(i,r={}){this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=e.q.frame(()=>{this._request=null,this._load(i,!1!==r.validate)})}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(iE,!1)}_loadImports(i,r,n){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let o=[];for(let e of i){let i=this._createFragmentStyle(e),a=new Promise(e=>{i.once("style.import.load",e),i.once("error",e)}).then(()=>this.mergeAll());if(o.push(a),this.resolvedImports.has(e.url)){i.loadEmpty();continue}let s=e.data||this.importsCache.get(e.url);s?(i.loadJSON(s,{validate:r}),this._isInternalStyle(s)&&(i.globalId=null)):e.url?i.loadURL(e.url,{validate:r}):i.loadEmpty();let l={style:i,id:e.id,config:e.config};if(n){let e=this.fragments.findIndex(({id:e})=>e===n);this.fragments=this.fragments.slice(0,e).concat(l).concat(this.fragments.slice(e))}else this.fragments.push(l)}return Promise.allSettled(o)}getImportGlobalIds(e=this,i=new Set){for(let r of e.fragments)r.style.globalId&&i.add(r.style.globalId),this.getImportGlobalIds(r.style,i);return[...i.values()]}_createFragmentStyle(i){let r,n=this.scope?e.C(i.id,this.scope):i.id,o=this._initialConfig&&this._initialConfig[n];(i.config||o)&&(r=e.l({},i.config,o));let a=new iC(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return a.setEventedParent(this.map,{style:a}),a}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(i,r){let n=i.indoor?i_(i.schema):i.schema;if(this._isInternalStyle(i)){let n=e.l({},iE,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(n,r)}if(this.updateConfig(this._config,n),r&&ib(this,ef(i)))return;this._loaded=!0,this.stylesheet=e.d7(i);let o=()=>{for(let e in i.sources)this.addSource(e,i.sources[e],{validate:!1,isInitialLoad:!0});if(i.iconsets)for(let e in i.iconsets)this.addIconset(e,i.iconsets[e]);i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(i.glyphs);let n=th(this.stylesheet.layers);if(this._order=n.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){let e=this.stylesheet.lights[0];this.light=new eR(e.properties,e.id)}else this.setLights(this.stylesheet.lights);for(let i of(this.light||(this.light=new eR(this.stylesheet.light)),this._layers={},n)){let r=e.dc(i,this.scope,this._styleColorTheme.lut,this.options);0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r;let n=this.getOwnLayerSourceCache(r),o=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&r.canCastShadows()&&o&&(n.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);let o=this.stylesheet.terrain;o&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));let a=this.isRootStyle();i.imports?this._loadImports(i.imports,r).then(()=>{this._reloadImports(),this.fire(new e.A(a?"style.load":"style.import.load"))}).catch(i=>{this.fire(new e.z(Error("Failed to load imports",i))),this.fire(new e.A(a?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.A(a?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];let a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(a){let i=this._evaluateColorThemeData(a);this._loadColorTheme(i).then(()=>{o()}).catch(i=>{e.w(`Couldn't load color theme from the stylesheet: ${i}`),o()})}else this._styleColorTheme.lut=null,o()}isRootStyle(){return 0===this.importDepth}mergeAll(){let i,r,n,o,a,s,l,h,u,c,d={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(e=>{if(e.stylesheet){if(null!=e.light&&(i=e.light),e.stylesheet.lights)for(let i of e.stylesheet.lights)"ambient"===i.type&&null!=e.ambientLight&&(r=e.ambientLight),"directional"===i.type&&null!=e.directionalLight&&(n=e.directionalLight);o=this._prioritizeTerrain(o,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(a=e.fog),e.stylesheet.snow&&null!=e.snow&&(s=e.snow),e.stylesheet.rain&&null!=e.rain&&(l=e.rain),null!=e.stylesheet.camera&&(c=e.stylesheet.camera),null!=e.stylesheet.projection&&(h=e.stylesheet.projection),null!=e.stylesheet.transition&&(u=e.stylesheet.transition),d[e.scope]=e._styleColorTheme}}),this.light=i,this.ambientLight=r,this.directionalLight=n,this.fog=a,this.snow=s,this.rain=l,this._styleColorThemeForScope=d,null===o?delete this.terrain:this.terrain=o,this.camera=c||{"camera-projection":"perspective"},this.projection=h||{name:"mercator"},this.transition=e.l({},iI,u),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){let i=r=>{for(let e of r.fragments)i(e.style);e(r)};i(this)}_prioritizeTerrain(e,i,r){let n=e&&0===e.drapeRenderMode;return null===r?i&&0===i.drapeRenderMode?i:n?e:null:null!=i&&(!e||n||i&&1===i.drapeRenderMode)?i:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{e=this._prioritizeTerrain(e,i.terrain,i.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(i=>{null!=i.stylesheet.projection&&(e=i.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){let i={},r={},n={};this.forEachFragmentStyle(o=>{for(let r in o._sourceCaches)i[e.C(r,o.scope)]=o._sourceCaches[r];for(let i in o._otherSourceCaches)r[e.C(i,o.scope)]=o._otherSourceCaches[i];for(let i in o._symbolSourceCaches)n[e.C(i,o.scope)]=o._symbolSourceCaches[i]}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=n}mergeLayers(){let i={},r=[],n={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(n=>{for(let o of n._order){let a=n._layers[o];if("slot"===a.type){let r=e.d8(o);if(i[r])continue;i[r]=[]}a.slot&&i[a.slot]?i[a.slot].push(a):r.push(a)}}),this._mergedOrder=[];let o=(r=[])=>{for(let a of r)if("slot"===a.type){let r=e.d8(a.id);i[r]&&o(i[r]),this._mergedSlots.push(r)}else{let i=e.C(a.id,a.scope);this._mergedOrder.push(i),n[i]=a,a.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===a.type&&(this._hasCircleLayers=!0),"symbol"===a.type&&(this._hasSymbolLayers=!0),"clip"===a.type&&(this._clipLayerPresent=!0)}};o(r),this._mergedOrder.sort((e,i)=>{let r=n[e],o=n[i];return r.hasInitialOcclusionOpacityProperties?+!!o.is3D(!!this.terrain):r.is3D(!!this.terrain)&&o.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=e.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?(function(i,r,n){let o=e.l({},r);for(let i of Object.keys(e.a5.colorTheme))void 0===o[i]&&(o[i]=e.a5.colorTheme[i].default);let a=new e.a6(im,i,new Map(n));return a.setTransitionOrValue(o,n),a.untransitioned().possiblyEvaluate(new e.aa(0))})(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((n,o)=>{let a="data:image/png;base64,";if(!i||0===i.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void n();let s=i;s.startsWith(a)||(s=a+s);let l=e.I.from("mapbox-reserved-lut"),h=new Image;h.src=s,h.onerror=()=>{this._styleColorTheme.lutLoading=!1,o(Error("Failed to load image data"))},h.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void n();this._styleColorTheme.lutLoading=!1;let{width:a,height:s,data:u}=e.q.getImageData(h);if(s>32)return void o(Error("The height of the image must be less than or equal to 32 pixels."));if(a!==s*s)return void o(Error("The width of the image must be equal to the height squared."));this.getImage(l)&&this.removeImage(l),this.addImage(l,{data:new e.r({width:a,height:s},u),pixelRatio:1,sdf:!1,usvg:!1,version:0});let c=this.imageManager.getImage(l,this.scope);c?(this._styleColorTheme.lut={image:c.data,data:i},n()):o(Error("Missing LUT image."))}})}getLut(e){let i=this._styleColorThemeForScope[e];return i?i.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(i,r,n){let o,a,s,l=e.q.devicePixelRatio>1?"@2x":"",h=e.n(r.transformRequest(r.normalizeSpriteURL(i,l,".json"),e.R.SpriteJSON),(e,i)=>{h=null,s||(s=e,o=i,c())}),u=e.o(r.transformRequest(r.normalizeSpriteURL(i,l,".png"),e.R.SpriteImage),(e,i)=>{u=null,s||(s=e,a=i,c())});function c(){if(s)n(s);else if(o&&a){let i=e.q.getImageData(a),r={};for(let n in o){let{width:a,height:s,x:l,y:h,sdf:u,pixelRatio:c,stretchX:d,stretchY:p,content:f}=o[n],m=new e.r({width:a,height:s});e.r.copy(i,m,{x:l,y:h},{x:0,y:0},{width:a,height:s},null),r[n]={data:m,pixelRatio:c,sdf:u,stretchX:d,stretchY:p,content:f,usvg:!1}}n(null,r)}}return{cancel(){h&&(h.cancel(),h=null),u&&(u.cancel(),u=null)}}}(i,this.map._requestManager,(i,r)=>{if(this._spriteRequest=null,i)this.fire(new e.z(i));else if(r){let i=new Map;for(let n in r)i.set(e.I.from(n),r[n]);this.addImages(i)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))})}addIconset(i,r){if("sprite"===r.type)return void this._loadSprite(r.url);let n=this.getOwnSourceCache(r.source);if(!n)return void this.fire(new e.z(Error(`Source "${r.source}" as specified by iconset "${i}" does not exist and cannot be used as an iconset source`)));let o=n.getSource();if("raster-array"!==o.type)return void this.fire(new e.z(Error(`Source "${r.source}" as specified by iconset "${i}" is not a "raster-array" source and cannot be used as an iconset source`)));o.partial=!1;let a=new ix(i,this.scope,n);this.imageManager.addImageProvider(a,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(i){var r,n;if(!e.f(i)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(i);let o="auto"===this.map._spriteFormat;this._spriteRequest=(n=(r,n)=>{if(this._spriteRequest=null,r)o?this._loadSprite(i):this.fire(new e.z(r));else if(n){let i=new Map;for(let r in n)i.set(e.I.from(r),n[r]);this.addImages(i)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}))},e.br((r=this.map._requestManager).transformRequest(r.normalizeIconsetURL(i),e.R.Iconset),(i,r)=>{if(i)return void n(i);let o={};for(let i of e.c_(new e.bq(r)).icons){let r={version:1,pixelRatio:e.q.devicePixelRatio,content:function(i){if(!i.metadata||!i.metadata.content_area)return;let r=e.q.devicePixelRatio,{left:n,top:o,width:a,height:s}=i.metadata.content_area,l=n*r,h=o*r;return[l,h,l+a*r,h+s*r]}(i),stretchX:i.metadata?iv(i.metadata.stretch_x_areas):void 0,stretchY:i.metadata?iv(i.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:i};o[i.name]=r}n(null,o)}))}_validateLayer(i){let r=this.getOwnSource(i.source);if(!r)return;let n=i.sourceLayer;n&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new e.z(Error(`Source layer "${n}" does not exist on source "${r.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,i)=>{let r=this.fragments[i];return r&&r.style&&(e.data=r.style.serialize()),e})}_serializeSources(){let e={};for(let i in this._sourceCaches){let r=this._sourceCaches[i].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){let i=[];for(let r of e){let e=this._layers[r];e&&"custom"!==e.type&&i.push(e.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(let e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading")}_checkLayer(i){let r=this.getOwnLayer(i);if(r)return r;this.fire(new e.z(Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){let r=this.getOwnSource(i);if(r)return r;this.fire(new e.z(Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(e,i){let r=this.map.painter;if(r)for(let n=e.minzoom||0;n<(e.maxzoom||25.5);n++){let n=e.getProgramIds();if(n)for(let o of n){let n=e.getDefaultProgramParams(o,i.zoom,this._styleColorTheme.lut);n&&(r.style=this,this.fog&&(r._fogVisible=!0,n.overrideFog=!0,r.getOrCreateProgram(o,n)),r._fogVisible=!1,n.overrideFog=!1,r.getOrCreateProgram(o,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,r.getOrCreateProgram(o,n)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);let r=this.calculateLightsBrightness();i.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));let n=this._changes.isDirty(),o=!1;if(this._changes.isDirty()){let e=this._changes.getLayerUpdatesByScope();for(let i in e){let{updatedIds:r,removedIds:n}=e[i];(r||n)&&(this._updateWorkerLayers(i,r,n),o=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}let a={};for(let e in this._mergedSourceCaches){let i=this._mergedSourceCaches[e];a[e]=i.used,i.used=!1,i.tileCoverLift=0}for(let e of this._mergedOrder){let r=this._mergedLayers[e];if(r.recalculate(i,this._availableImages),!r.isHidden(i.zoom)){let e=this.getLayerSourceCache(r);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,r.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(r,i)}):this.precompilePrograms(r,i))}for(let e of(this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&o&&this.mergeLayers(),this.imageManager.getPendingImageProviders()))e.sourceCache.used=!0;for(let i in a){let r=this._mergedSourceCaches[i];a[i]!==r.used&&r.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:r.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),n&&this.fire(new e.A("data",{dataType:"style"}))}updateImageProviders(){for(let e of this.imageManager.getPendingImageProviders()){let i=e.resolvePendingRequests(),r=this.getFragmentStyle(e.scope);r&&r.addImages(i)}}_updateTilesForChangedImages(){let e={};for(let i in this._mergedSourceCaches){let r=this._mergedSourceCaches[i].getSource().scope;e[r]=e[r]||this._changes.getUpdatedImages(r),0!==e[r].length&&this._mergedSourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e[r])}for(let i in e)this._changes.resetUpdatedImages(i)}_updateWorkerLayers(e,i,r){let n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:i?n._serializeLayers(i):[],scope:e,removedIds:r||[],options:n.options})}setState(i,r){if(this._checkLoaded(),ib(this,ef(i)))return!1;(i=e.d7(i)).layers=th(i.layers);let n=(function(i,r){if(!i)return[{command:tu.setStyle,args:[r]}];let n=[];try{if(!e.bv(i.version,r.version)||(e.bv(i.center,r.center)||n.push({command:tu.setCenter,args:[r.center]}),e.bv(i.zoom,r.zoom)||n.push({command:tu.setZoom,args:[r.zoom]}),e.bv(i.bearing,r.bearing)||n.push({command:tu.setBearing,args:[r.bearing]}),e.bv(i.pitch,r.pitch)||n.push({command:tu.setPitch,args:[r.pitch]}),e.bv(i.sprite,r.sprite)||n.push({command:tu.setSprite,args:[r.sprite]}),e.bv(i.glyphs,r.glyphs)||n.push({command:tu.setGlyphs,args:[r.glyphs]}),e.bv(i.imports,r.imports)||function(i=[],r=[],n){let o,a,s,l;r=r||[];let h=(i=i||[]).map(tf),u=r.map(tf),c=i.reduce(tm,{}),d=r.reduce(tm,{}),p=h.slice();for(o=0,a=0;o<h.length;o++)s=h[o],d.hasOwnProperty(s)?a++:(n.push({command:tu.removeImport,args:[s]}),p.splice(p.indexOf(s,a),1));for(o=0,a=0;o<u.length;o++)s=u[u.length-1-o],p[p.length-1-o]!==s&&(c.hasOwnProperty(s)?(n.push({command:tu.removeImport,args:[s]}),p.splice(p.lastIndexOf(s,p.length-a),1)):a++,l=p[p.length-o],n.push({command:tu.addImport,args:[d[s],l]}),p.splice(p.length-o,0,s));for(let i of r){let r=c[i.id];r&&!e.bv(r,i)&&n.push({command:tu.updateImport,args:[i.id,i]})}}(i.imports,r.imports,n),e.bv(i.transition,r.transition)||n.push({command:tu.setTransition,args:[r.transition]}),e.bv(i.light,r.light)||n.push({command:tu.setLight,args:[r.light]}),e.bv(i.fog,r.fog)||n.push({command:tu.setFog,args:[r.fog]}),e.bv(i.snow,r.snow)||n.push({command:tu.setSnow,args:[r.snow]}),e.bv(i.rain,r.rain)||n.push({command:tu.setRain,args:[r.rain]}),e.bv(i.projection,r.projection)||n.push({command:tu.setProjection,args:[r.projection]}),e.bv(i.lights,r.lights)||n.push({command:tu.setLights,args:[r.lights]}),e.bv(i.camera,r.camera)||n.push({command:tu.setCamera,args:[r.camera]}),e.bv(i.iconsets,r.iconsets)||function(i,r,n){let o;for(o in r=r||{},i=i||{})i.hasOwnProperty(o)&&(r.hasOwnProperty(o)||n.push({command:tu.removeIconset,args:[o]}));for(o in r){if(!r.hasOwnProperty(o))continue;let a=r[o];i.hasOwnProperty(o)?e.bv(i[o],a)||(n.push({command:tu.removeIconset,args:[o]}),n.push({command:tu.addIconset,args:[o,a]})):n.push({command:tu.addIconset,args:[o,a]})}}(i.iconsets,r.iconsets,n),!e.bv(i["color-theme"],r["color-theme"])))return[{command:tu.setStyle,args:[r]}];let o={},a=[];!function(i,r,n,o){let a;for(a in r=r||{},i=i||{})i.hasOwnProperty(a)&&(r.hasOwnProperty(a)||td(a,n,o));for(a in r){var s;if(!r.hasOwnProperty(a))continue;let l=r[a];i.hasOwnProperty(a)?e.bv(i[a],l)||("geojson"===i[a].type&&"geojson"===l.type&&function(i,r,n){let o;for(o in i[n])if(i[n].hasOwnProperty(o)&&"data"!==o&&!e.bv(i[n][o],r[n][o]))return!1;for(o in r[n])if(r[n].hasOwnProperty(o)&&"data"!==o&&!e.bv(i[n][o],r[n][o]))return!1;return!0}(i,r,a)?n.push({command:tu.setGeoJSONSourceData,args:[a,l.data]}):(s=r,td(a,n,o),tc(a,s,n))):tc(a,r,n)}}(i.sources,r.sources,a,o);let s=[];i.layers&&i.layers.forEach(e=>{e.source&&o[e.source]?n.push({command:tu.removeLayer,args:[e.id]}):s.push(e)});let l=i.terrain;l&&o[l.source]&&(n.push({command:tu.setTerrain,args:[void 0]}),l=void 0),n=n.concat(a),e.bv(l,r.terrain)||n.push({command:tu.setTerrain,args:[r.terrain]}),function(i,r,n){let o,a,s,l,h,u,c;r=r||[];let d=(i=i||[]).map(tf),p=r.map(tf),f=i.reduce(tm,{}),m=r.reduce(tm,{}),g=d.slice(),_=Object.create(null);for(o=0,a=0;o<d.length;o++)s=d[o],m.hasOwnProperty(s)?a++:(n.push({command:tu.removeLayer,args:[s]}),g.splice(g.indexOf(s,a),1));for(o=0,a=0;o<p.length;o++)s=p[p.length-1-o],g[g.length-1-o]!==s&&(f.hasOwnProperty(s)?(n.push({command:tu.removeLayer,args:[s]}),g.splice(g.lastIndexOf(s,g.length-a),1)):a++,u=g[g.length-o],n.push({command:tu.addLayer,args:[m[s],u]}),g.splice(g.length-o,0,s),_[s]=!0);for(o=0;o<p.length;o++)if(l=f[s=p[o]],h=m[s],!_[s]&&!e.bv(l,h))if(e.bv(l.source,h.source)&&e.bv(l["source-layer"],h["source-layer"])&&e.bv(l.type,h.type)){for(c in tp(l.layout,h.layout,n,s,null,tu.setLayoutProperty),tp(l.paint,h.paint,n,s,null,tu.setPaintProperty),e.bv(l.slot,h.slot)||n.push({command:tu.setSlot,args:[s,h.slot]}),e.bv(l.filter,h.filter)||n.push({command:tu.setFilter,args:[s,h.filter]}),e.bv(l.minzoom,h.minzoom)&&e.bv(l.maxzoom,h.maxzoom)||n.push({command:tu.setLayerZoomRange,args:[s,h.minzoom,h.maxzoom]}),l)l.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&"slot"!==c&&(0===c.indexOf("paint.")?tp(l[c],h[c],n,s,c.slice(6),tu.setPaintProperty):e.bv(l[c],h[c])||n.push({command:tu.setLayerProperty,args:[s,c,h[c]]}));for(c in h)h.hasOwnProperty(c)&&!l.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&"slot"!==c&&(0===c.indexOf("paint.")?tp(l[c],h[c],n,s,c.slice(6),tu.setPaintProperty):e.bv(l[c],h[c])||n.push({command:tu.setLayerProperty,args:[s,c,h[c]]}))}else n.push({command:tu.removeLayer,args:[s]}),u=g[g.lastIndexOf(s)+1],n.push({command:tu.addLayer,args:[h,u]})}(s,r.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:tu.setStyle,args:[r]}]}return n})(this.serialize(),i).filter(e=>!(e.command in iT));if(0===n.length)return!1;let o=n.filter(e=>!(e.command in iw));if(o.length>0)throw Error(`Unimplemented: ${o.map(e=>e.command).join(", ")}.`);let a=[];return n.forEach(e=>{a.push(this[e.command](...e.args))}),r&&Promise.all(a).then(r).catch(r),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(i){for(let[r,n]of i.entries()){if(this.getImage(r))return this.fire(new e.z(Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,n),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this}addImage(i,r){return this.getImage(i)?this.fire(new e.z(Error(`An image with the name "${i.name}" already exists.`))):(this.imageManager.addImage(i,this.scope,r),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(i,r,n=!1){this.imageManager.updateImage(i,this.scope,r),n&&(this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(i){return this.modelManager.addModelURLs(i,this.scope),this._updateWorkerModels(),this.fire(new e.A("data",{dataType:"style"})),this}addModel(i,r,n={}){return this._checkLoaded(),this._validate(eI,`models.${i}`,r,null,n)||(this.modelManager.addModel(i,r,this.scope),this.fire(new e.A("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,r,n={}){if(this._checkLoaded(),void 0!==this.getOwnSource(i))throw Error(`There is already a source with ID "${i}".`);if(!r.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(em,`sources.${i}`,r,null,n))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);let o=eQ(i,r,this.dispatcher,this);o.scope=this.scope,o.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o.id),source:o.serialize(),sourceId:o.id}));let a=i=>{let r=(i?"symbol:":"other:")+o.id,n=e.C(r,this.scope),a=this._sourceCaches[r]=new tn(n,o,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[o.id]=a,a.onAdd(this.map)};a(!1),"vector"!==r.type&&"geojson"!==r.type||a(!0),o.onAdd&&o.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();let r=this.getOwnSource(i);if(!r)throw Error("There is no source with this ID");for(let r in this._layers)if(this._layers[r].source===i)return this.fire(new e.z(Error(`Source "${i}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new e.z(Error(`Source "${i}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){let r=Object.entries(this.stylesheet.iconsets).find(([e,r])=>"source"===r.type&&r.source===i);if(r)return this.fire(new e.z(Error(`Source "${i}" cannot be removed while iconset "${r[0]}" is using it.`)))}for(let r of this.getOwnSourceCaches(i)){let i=e.d8(r.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(r.id),r.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,i){this._checkLoaded(),this.getOwnSource(e).setData(i),this._changes.setDirty()}getOwnSource(e){let i=this.getOwnSourceCache(e);return i&&i.getSource()}getOwnSources(){let e=[];for(let i in this._otherSourceCaches){let r=this.getOwnSourceCache(i);r&&e.push(r.getSource())}return e}areTilesLoaded(){let e=this._mergedSourceCaches;for(let i in e){let r=e[i]._tiles;for(let e in r){let i=r[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;let r=this._getTransitionParameters();for(let n of i){if(this._validate(e_,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){let e=this.ambientLight;e.set(n),e.updateTransitions(r)}else this.ambientLight=new eU(n,eB||(eB=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let e=this.directionalLight;e.set(n),e.updateTransitions(r)}else this.directionalLight=new eU(n,eN||(eN=new e.a7({direction:new e.an(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let n=new e.aa(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let i=this.directionalLight,r=this.ambientLight;if(!i||!r)return;let n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),o=i.properties.get("color").toRenderColor(null).toArray01(),a=i.properties.get("intensity"),s=i.properties.get("direction"),l=1-e.cR(s.x,s.y,s.z)[2]/90,h=n(o)*a*l,u=r.properties.get("color").toRenderColor(null).toArray01(),c=r.properties.get("intensity");return Number(((h+n(u)*c)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(null==i||""===i&&this.isRootStyle())return this;if(e.d9(i)){let r=e.da(i),n=this.fragments.find(({id:e})=>e===r);if(!n)return;let o=e.d8(i);return n.style.getFragmentStyle(o)}{let e=this.fragments.find(({id:e})=>e===i);return e?e.style:void 0}}setFeaturesetSelectors(i){if(!i)return;let r={},n=(e,i="")=>`${e}::${i}`;for(let o in this._featuresetSelectors={},i){let a=this._featuresetSelectors[o]=[];for(let s of i[o].selectors){let i;if(s.featureNamespace){let i=this.getOwnLayer(s.layer);if(!i){e.w(`Layer is undefined for selector: ${s.layer}`);continue}let a=n(i.source,i.sourceLayer);if(a in r&&r[a]!==s.featureNamespace){e.w(`"featureNamespace ${s.featureNamespace} of featureset ${o}'s selector is not associated to the same source, skip this selector`);continue}r[a]=s.featureNamespace}if(s.properties)for(let r in s.properties){let n=e.X(s.properties[r]);"success"===n.result&&((i=i||{})[r]=n.value)}a.push({layerId:s.layer,namespace:s.featureNamespace,properties:i,uniqueFeatureID:s._uniqueFeatureID})}}}getFeaturesetDescriptors(e){let i=this.getFragmentStyle(e);if(!i||!i.stylesheet.featuresets)return[];let r=[];for(let e in i.stylesheet.featuresets)r.push({featuresetId:e,importId:i.scope?i.scope:void 0});return r}getFeaturesetLayers(i,r){let n=this.getFragmentStyle(r),o=n.stylesheet.featuresets;if(!o||!o[i])return this.fire(new e.z(Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];let a=[];for(let e of o[i].selectors){let i=n.getOwnLayer(e.layer);i&&a.push(i)}return a}getConfigProperty(i,r){let n=this.getFragmentStyle(i);if(!n)return null;let o=e.C(r,n.scope),a=n.options.get(o),s=a?a.value||a.default:null;return s?s.serialize():null}setConfigProperty(i,r,n){let o,a=this.getFragmentStyle(i);if(!a)return;let s=a.stylesheet.indoor?i_(a.stylesheet.schema):a.stylesheet.schema;if(!s||!s[r])return;let l=e.X(n);if("success"!==l.result)return void ib(this,l.value);let h=l.value.expression,u=e.C(r,a.scope),c=a.options.get(u);if(!c)return;let{minValue:d,maxValue:p,stepValue:f,type:m,values:g}=s[r],_=e.X(s[r].default);"success"===_.result&&(o=_.value.expression),o?(this.options.set(u,Object.assign({},c,{value:h,default:o,minValue:d,maxValue:p,stepValue:f,type:m,values:g})),this.updateConfigDependencies(r)):this.fire(new e.z(Error(`No schema defined for the config option "${r}" in the "${i}" fragment.`)))}getConfig(i){let r=this.getFragmentStyle(i);if(!r)return null;let n=r.stylesheet.schema;if(!n)return null;let o={};for(let i in n){let n=e.C(i,r.scope),a=r.options.get(n),s=a?a.value||a.default:null;o[i]=s?s.serialize():null}return o}setConfig(e,i){let r=this.getFragmentStyle(e);r&&(r.updateConfig(i,r.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){let i=this.getFragmentStyle(e);return i?i.stylesheet.schema:null}setSchema(e,i){let r=this.getFragmentStyle(e);r&&(r.stylesheet.schema=i,r.updateConfig(r._config,i),this.updateConfigDependencies())}updateConfig(i,r){if(this._config=i,i||r)if(r)for(let n in r){let o,a,s=e.X(r[n].default);if("success"===s.result&&(o=s.value.expression),i&&void 0!==i[n]){let r=e.X(i[n]);"success"===r.result&&(a=r.value.expression)}let{minValue:l,maxValue:h,stepValue:u,type:c,values:d}=r[n];if(o){let i=e.C(n,this.scope);this.options.set(i,{default:o,value:a,minValue:l,maxValue:h,stepValue:u,type:c,values:d})}else this.fire(new e.z(Error(`No schema defined for config option "${n}".`)))}else this.fire(new e.z(Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(e){for(let i of this._configDependentLayers){let r=this.getLayer(i);if(r){if(e&&!r.configDependencies.has(e))continue;r.possiblyEvaluateVisibility(),this._updateLayer(r)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{let i=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(i){let r=e._evaluateColorThemeData(i);(!e._styleColorTheme.lut&&""!==r||e._styleColorTheme.lut&&r!==e._styleColorTheme.lut.data)&&e.setColorTheme(i)}}),this._changes.setDirty()}addLayer(i,r,n={}){let o;this._checkLoaded();let a=i.id;if(this._layers[a])return void this.fire(new e.z(Error(`Layer with id "${a}" already exists on this map`)));if("custom"===i.type){if(ib(this,e.db(i)))return;o=e.dc(i,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof i.source&&(this.addSource(a,i.source),i=e.d7(i),i=e.l(i,{source:a})),this._validate(ew,`layers.${a}`,i,{arrayIndex:-1},n))return;o=e.dc(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:a}})}0!==o.configDependencies.size&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(r){let i=this._order.indexOf(r);if(-1===i)return void this.fire(new e.z(Error(`Layer with id "${r}" does not exist on this map.`)));o.slot===this._layers[r].slot?s=i:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,a),this._layerOrderChanged=!0,this._layers[a]=o;let l=this.getOwnLayerSourceCache(o),h=!!this.directionalLight&&this.directionalLight.shadowsEnabled();l&&o.canCastShadows()&&h&&(l.castsShadows=!0);let u=this._changes.getRemovedLayer(o);if(u&&o.source&&l&&"custom"!==o.type){this._changes.discardLayerRemoval(o);let i=e.C(o.source,o.scope);u.type!==o.type?this._changes.updateSourceCache(i,"clear"):(this._changes.updateSourceCache(i,"reload"),l.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(i,r){this._checkLoaded();let n=this._checkLayer(i);if(!n||i===r)return;let o=this._order.indexOf(i);this._order.splice(o,1);let a=this._order.length;if(r){let i=this._order.indexOf(r);if(-1===i)return void this.fire(new e.z(Error(`Layer with id "${r}" does not exist on this map.`)));n.slot===this._layers[r].slot?a=i:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();let i=this._checkLayer(e);if(!i)return;i.setEventedParent(null);let r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);let n=this.getOwnLayerSourceCache(i);if(n&&n.castsShadows){let e=!1;for(let r in this._layers)if(this._layers[r].source===i.source&&this._layers[r].canCastShadows()){e=!0;break}n.castsShadows=e}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(let i in this._layers)if(this._layers[i].type===e)return!0;return!1}setLayerZoomRange(e,i,r){this._checkLoaded();let n=this._checkLayer(e);n&&(n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,i){this._checkLoaded();let r=this._checkLayer(e);r&&r.slot!==i&&(r.slot=i,this._updateLayer(r))}setFilter(i,r,n={}){this._checkLoaded();let o=this._checkLayer(i);if(o&&!e.bv(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(eT,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=e.d7(r),this._updateLayer(o)))}getFilter(i){let r=this._checkLayer(i);if(r)return e.d7(r.filter)}setLayoutProperty(i,r,n,o={}){this._checkLoaded();let a=this._checkLayer(i);if(a&&!e.bv(a.getLayoutProperty(r),n)){if(null!=n&&(!o||!1!==o.validate)&&ib(a,eE.call(ef,{key:`layers.${i}.layout.${r}`,layerType:a.type,objectKey:r,value:n,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;a.setLayoutProperty(r,n),0!==a.configDependencies.size&&this._configDependentLayers.add(a.fqid),this._updateLayer(a)}}getLayoutProperty(e,i){let r=this._checkLayer(e);if(r)return r.getLayoutProperty(i)}setPaintProperty(i,r,n,o={}){this._checkLoaded();let a=this._checkLayer(i);if(!a||e.bv(a.getPaintProperty(r),n)||null!=n&&(!o||!1!==o.validate)&&ib(a,eS.call(ef,{key:`layers.${i}.paint.${r}`,layerType:a.type,objectKey:r,value:n,styleSpec:e.a5})))return;let s=a.setPaintProperty(r,n);0!==a.configDependencies.size&&this._configDependentLayers.add(a.fqid),s&&this._updateLayer(a),this._changes.updatePaintProperties(a)}getPaintProperty(e,i){let r=this._checkLayer(e);if(r)return r.getPaintProperty(i)}setFeatureState(i,r){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){let{featuresetId:e,importId:n}=i.target,o=this.getFragmentStyle(n);for(let{source:n,sourceLayer:a}of o.getFeaturesetLayers(e))o.setFeatureState({id:i.id,source:n,sourceLayer:a},r)}else if("layerId"in i.target){let{layerId:e}=i.target,n=this.getLayer(e);this.setFeatureState({id:i.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}let n=i.source,o=i.sourceLayer,a=this._checkSource(n);if(!a)return;let s=a.type;if("geojson"===s&&o)return void this.fire(new e.z(Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!o)return void this.fire(new e.z(Error("The sourceLayer parameter must be provided for vector source types.")));for(let a of(void 0===i.id&&this.fire(new e.z(Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)))a.setFeatureState(o,i.id,r)}removeFeatureState(i,r){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){let{featuresetId:e,importId:n}=i.target,o=this.getFragmentStyle(n);for(let{source:n,sourceLayer:a}of o.getFeaturesetLayers(e))o.removeFeatureState({id:i.id,source:n,sourceLayer:a},r)}else if("layerId"in i.target){let{layerId:e}=i.target,n=this.getLayer(e);this.removeFeatureState({id:i.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}let n=i.source,o=this._checkSource(n);if(!o)return;let a=o.type,s="vector"===a?i.sourceLayer:void 0;if("vector"===a&&!s)return void this.fire(new e.z(Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new e.z(Error("A feature id is required to remove its specific state property.")));for(let e of this.getOwnSourceCaches(n))e.removeFeatureState(s,i.id,r)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let r;if("featuresetId"in i.target){let{featuresetId:n,importId:o}=i.target,a=this.getFragmentStyle(o);for(let{source:o,sourceLayer:s}of a.getFeaturesetLayers(n)){let n=a.getFeatureState({id:i.id,source:o,sourceLayer:s});if(n&&!r)r=n;else if(!e.bv(r,n))return void this.fire(new e.z(Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){let{layerId:e}=i.target,n=this.getLayer(e);r=this.getFeatureState({id:i.id,source:n.source,sourceLayer:n.sourceLayer})}return r}let r=i.source,n=i.sourceLayer,o=this._checkSource(r);if(o){if("vector"!==o.type||n)return void 0===i.id&&this.fire(new e.z(Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(n,i.id);this.fire(new e.z(Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=e.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return e.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let i=this.getTerrain(),r=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return e.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(let i of Object.values(this._mergedLayers))e(i)&&this._updateLayer(i)}_updateLayer(i){this._changes.updateLayer(i);let r=this.getLayerSourceCache(i),n=e.C(i.source,i.scope),o=this._changes.getUpdatedSourceCaches();i.source&&!o[n]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(n,"reload"),r.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){let i=e=>this._mergedLayers[e].is3D(!!this.terrain),r=this.order,n={},o=[];for(let a=r.length-1;a>=0;a--){let s=r[a];if(i(s))for(let i of(n[s]=a,e)){let e=i[s];if(e)for(let i of e)o.push(i)}}o.sort((e,i)=>i.intersectionZ-e.intersectionZ);let a=[];for(let s=r.length-1;s>=0;s--){let l=r[s];if(i(l))for(let e=o.length-1;e>=0;e--){let i=o[e].feature;if(i.layer&&n[i.layer.id]<s)break;a.push(i),o.pop()}else for(let i of e){let e=i[l];if(e)for(let i of e)a.push(i.feature)}}return a}queryRenderedFeatures(i,r,n){let o;r&&!Array.isArray(r)&&r.filter&&(this._validate(eT,"queryRenderedFeatures.filter",r.filter,null,r),o=e.b3(r.filter));let a={},s=e=>{if(iS.has(e.type))return;let i=this.getOwnLayerSourceCache(e),r=a[i.id]=a[i.id]||{sourceCache:i,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(r.has3DLayers=!0),r.layers[e.fqid]=r.layers[e.fqid]||{styleLayer:e,targets:[]},r.layers[e.fqid].targets.push({filter:o})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.z(Error("parameters.layers must be an Array."))),[];for(let i of r.layers){let r=this._layers[i];if(!r)return this.fire(new e.z(Error(`The layer '${i}' does not exist in the map's style and cannot be queried for features.`))),[];s(r)}}else for(let e in this._layers)s(this._layers[e]);let l=this._queryRenderedFeatures(i,a,n),h=this._flattenAndSortRenderedFeatures(l),u=[];for(let i of h)e.de(i.layer.id)===this.scope&&u.push(i);return u}queryRenderedFeatureset(i,r,n){let o;r&&!Array.isArray(r)&&r.filter&&(this._validate(eT,"queryRenderedFeatures.filter",r.filter,null,r),o=e.b3(r.filter));let a="mock",s=[];if(r&&r.target)s.push(Object.assign({},r,{targetId:a,filter:o}));else{for(let e of this.getFeaturesetDescriptors())s.push({targetId:a,filter:o,target:e});for(let{style:e}of this.fragments)for(let i of e.getFeaturesetDescriptors())s.push({targetId:a,filter:o,target:i})}let l=this.queryRenderedTargets(i,s,n),h=[],u=new Set;for(let i of l)for(let r of i.variants[a])e1(r,i,u)||h.push(new e.df(i,r));return h}queryRenderedTargets(i,r,n){let o={},a=(e,i,r,n)=>{let a=o[i.id]=o[i.id]||{sourceCache:i,layers:{},has3DLayers:!1};if(a.layers[e.fqid]=a.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(a.has3DLayers=!0),!n)return r.uniqueFeatureID=!1,void a.layers[e.fqid].targets.push(r);a.layers[e.fqid].targets.push(Object.assign({},r,{namespace:n.namespace,properties:n.properties,uniqueFeatureID:n.uniqueFeatureID}))};for(let i of r)if("featuresetId"in i.target){let{featuresetId:r,importId:n}=i.target,o=this.getFragmentStyle(n);if(!o||!o._featuresetSelectors)continue;let s=o._featuresetSelectors[r];if(!s){this.fire(new e.z(Error(`The featureset '${r}' does not exist in the map's style and cannot be queried for features.`)));continue}for(let e of s){let r=o.getOwnLayer(e.layerId);r&&!iS.has(r.type)&&a(r,o.getOwnLayerSourceCache(r),i,e)}}else if("layerId"in i.target){let{layerId:e}=i.target,r=this.getLayer(e);if(!r||iS.has(r.type))continue;a(r,this.getLayerSourceCache(r),i)}let s=this._queryRenderedFeatures(i,o,n);return this._flattenAndSortRenderedFeatures(s)}_queryRenderedFeatures(e,i,r){let n=[],o=!!this.map._showQueryGeometry,a=eG.createFromScreenPoints(e,r);for(let e in i){let s=function(e,i,r,n,o=!1){let a=i.sourceCache.transform,s=i.sourceCache.tilesIn(e,i.has3DLayers,o);s.sort(e2);let l=[];for(let e of s){let s=e.tile.queryRenderedFeatures(i,e,r,n,a,o);Object.keys(s).length&&l.push({wrappedTileID:e.tile.tileID.wrapped().key,queryResults:s})}return 0===l.length?{}:function(e){let i={},r={};for(let n of e){let e=n.queryResults,o=n.wrappedTileID,a=r[o]=r[o]||{};for(let r in e){let n=e[r],o=a[r]=a[r]||{},s=i[r]=i[r]||[];for(let e of n)o[e.featureIndex]||(o[e.featureIndex]=!0,s.push(e))}}return i}(l)}(a,i[e],this._availableImages,r,o);Object.keys(s).length&&n.push(s)}if(this.placement)for(let e in i){if(!i[e].sourceCache._onlySymbols)continue;let r=function(e,i,r,n,o){let a={},s=n.queryRenderedSymbols(e),l=[];for(let e of Object.keys(s).map(Number))l.push(o[e]);for(let e of(l.sort(e2),l)){let n=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,i,r);for(let i in n){let r=a[i]=a[i]||[],o=n[i];for(let i of(o.sort((i,r)=>{let n=e.featureSortOrder;if(n){let e=n.indexOf(i.featureIndex);return n.indexOf(r.featureIndex)-e}return r.featureIndex-i.featureIndex}),o))r.push(i)}}return a}(a.screenGeometry,i[e],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(r).length&&n.push(r)}return n}querySourceFeatures(e,i){let r=i&&i.filter;r&&this._validate(eT,"querySourceFeatures.filter",r,null,i);let n=[];for(let r of this.getOwnSourceCaches(e))n=n.concat(function(e,i){let r=e.getRenderableIds().map(i=>e.getTileByID(i)),n=[],o={};for(let e=0;e<r.length;e++){let a=r[e],s=a.tileID.canonical.key;o[s]||(o[s]=!0,a.querySourceFeatures(n,i))}return n}(r,i));return n}addSourceType(e,i,r){return iC.getSourceType(e)?r(Error(`A source type called "${e}" already exists.`)):(iC.setSourceType(e,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:i.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,r,n={}){this._checkLoaded();let o=this.light.getLight(),a=!1;for(let r in i)if(!e.bv(i[r],o[r])){a=!0;break}if(!a)return;let s=this._getTransitionParameters();this.light.setLight(i,r,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,r=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===r&&delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=i,o=null==i.source;if(1===r){if(this.disableElevatedTerrain)return;if("object"==typeof n.source){let i="terrain-dem-src";this.addSource(i,n.source),n=e.d7(n),n=e.l(n,{source:i})}let i=e.l({},n),r={};if(this.terrain&&o){i.source=this.terrain.get().source;let e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(r.style=e.serialize())}if(this._validate(ey,"terrain",i,r))return}if(this.terrain&&(this.terrain.scope===this.scope||o)&&(!this.terrain||r===this.terrain.drapeRenderMode)){let r=this.terrain,o=r.get();for(let i of Object.keys(e.a5.terrain))!n.hasOwnProperty(i)&&e.a5.terrain[i].default&&(n[i]=e.a5.terrain[i].default);for(let n in i)if(!e.bv(i[n],o[n])){r.set(i,this.options),this.stylesheet.terrain=i;let n=this._getTransitionParameters({duration:0});r.updateTransitions(n),this.fire(new e.A("data",{dataType:"style"}));break}}else{if(!n)return;this._createTerrain(n,r),this.fire(new e.A("data",{dataType:"style"}))}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){let i=this.fog=new eD(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=i.get();let r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_createSnow(e){let i=this.snow=new ej(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=i.get();let r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_createRain(e){let i=this.rain=new eV(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=i.get();let r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(let e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let r=this.fog;if(!e.bv(r.get(),i)){r.set(i,this.options),this.stylesheet.fog=r.get();let e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){let r=this.snow;if(!e.bv(r.get(),i)){r.set(i,this.options),this.stylesheet.snow=r.get();let e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){let r=this.rain;if(!e.bv(r.get(),i)){r.set(i,this.options),this.stylesheet.rain=r.get();let e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){let i=()=>{for(let e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(let e in this._sourceCaches)this._sourceCaches[e].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void i();let n=this._evaluateColorThemeData(r);this._loadColorTheme(n).then(()=>{this.fire(new e.A("colorthemeset")),i()}).catch(i=>{e.w(`Couldn't set color theme: ${i}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(e,i){let r=this.getFragmentStyle(e);r&&(r._styleColorTheme.colorThemeOverride=i,r._reloadColorTheme())}_getTransitionParameters(i){return{now:e.q.now(),transition:e.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;let e=[],i=[];for(let r of this._mergedOrder)this.isLayerDraped(this._mergedLayers[r])?e.push(r):i.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...i)}_createTerrain(e,i){let r=this.terrain=new eM(e,i,this.scope,this.options);1===i&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(let e in this._layers){let i=this._layers[e];"fill-extrusion"===i.type&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(let e in this._layers){let i=this._layers[e];"symbol"===i.type&&this._updateLayer(i)}}_validate(i,r,n,o,a={}){if(a&&!1===a.validate)return!1;let s=e.l({},this.serialize());return ib(this,i.call(ef,e.l({key:r,style:s,value:n,styleSpec:e.a5},o)))}_remove(){for(let i in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.dg.off("pluginStateChange",this._rtlTextPluginCallback),this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){for(let i of this.getSourceCaches(e))i.clearTiles()}clearSources(){for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){for(let i of this.getSourceCaches(e))i.resume(),i.reload()}reloadSources(){for(let e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let i;this.directionalLight&&(i=ic(this.directionalLight));let r=new Set;for(let e in this._mergedLayers){let i=this._mergedLayers[e];i.hasElevation()&&!r.has(i.source)&&r.add(i.source)}for(let n in this._mergedSourceCaches){let o=this._mergedSourceCaches[n],a=r.has(o._source.id);o.update(e,void 0,void 0,i,a)}}_generateCollisionBoxes(){for(let e in this._sourceCaches){let i=this._sourceCaches[e];i.resume(),i.reload()}}_updatePlacement(i,r,n,o,a,s,l=!1){let h=!1,u=!1,c={},d={};for(let i of this._mergedOrder){let n=this._mergedLayers[i];if("symbol"!==n.type)continue;let o=e.C(n.source,n.scope),a=c[o];if(!a){let e=this.getLayerSourceCache(n);if(!e)continue;let i=e.getRenderableIds(!0).map(i=>e.getTileByID(i));d[o]=i.slice(),a=c[o]=i.sort((e,i)=>i.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(i.tileID)?-1:1))}let s=this.crossTileSymbolIndex.addLayer(n,a,r.center.lng,r.projection);h=h||s}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||0===o,this._layerOrderChanged&&this.fire(new e.A("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),r.zoom))&&(this.pauseablePlacement=new tY(r,this._mergedOrder,l,n,o,a,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,c,d,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),u=!0),h&&this.pauseablePlacement.placement.setStale()),u||h){this._buildingIndex.onNewFrame(r.zoom);for(let i=0;i<this._mergedOrder.length;i++){let r=this._mergedLayers[this._mergedOrder[i]];if("symbol"!==r.type)continue;let n=this.isLayerClipped(r);this.placement.updateLayerOpacities(r,c[e.C(r.source,r.scope)],i,n?s:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(let e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(i,r){this._checkLoaded();let n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex(({id:e})=>e===i.id))return void this.fire(new e.z(Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!r)return n.push(i),this._loadImports([i],!0);let o=n.findIndex(({id:e})=>e===r);return -1===o&&this.fire(new e.z(Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=n.slice(0,o).concat(i).concat(n.slice(o)),this._loadImports([i],!0,r)}updateImport(i,r){this._checkLoaded();let n=this.stylesheet.imports||[],o=this.getImportIndex(i);return -1===o||("string"==typeof r?this.setImportUrl(i,r):(r.url&&r.url!==n[o].url&&this.setImportUrl(i,r.url),e.bv(r.config,n[o].config)||this.setImportConfig(i,r.config,r.data.schema),e.bv(r.data,n[o].data)||this.setImportData(i,r.data))),this}moveImport(e,i){this._checkLoaded();let r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;let o=this.getImportIndex(i);if(-1===o)return this;let a=r[n],s=this.fragments[n];return r=r.filter(({id:i})=>i!==e),this.fragments=this.fragments.filter(({id:i})=>i!==e),this.stylesheet.imports=r.slice(0,o).concat(a).concat(r.slice(o)),this.fragments=this.fragments.slice(0,o).concat(s).concat(this.fragments.slice(o)),this.mergeLayers(),this}setImportUrl(e,i){this._checkLoaded();let r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;r[n].url=i;let o=this.fragments[n];return o.style=this._createFragmentStyle(r[n]),o.style.on("style.import.load",()=>this.mergeAll()),o.style.loadURL(i),this}setImportData(e,i){this._checkLoaded();let r=this.getImportIndex(e),n=this.stylesheet.imports||[];return -1===r?this:i?(this.fragments[r].style.setState(i),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,i,r){this._checkLoaded();let n=this.getImportIndex(e),o=this.stylesheet.imports||[];if(-1===n)return this;i?o[n].config=i:delete o[n].config;let a=this.fragments[n];r&&a.style.stylesheet&&(a.style.stylesheet.schema=r);let s=a.style.stylesheet&&a.style.stylesheet.schema;return a.config=i,a.style.updateConfig(i,s),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();let i=this.stylesheet.imports||[],r=this.getImportIndex(e);-1!==r&&(i.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports())}getImportIndex(i){let r=(this.stylesheet.imports||[]).findIndex(e=>e.id===i);return -1===r&&this.fire(new e.z(Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),r}getLayer(e){return this._mergedLayers[e]}getSources(){let e=[];for(let i in this._mergedOtherSourceCaches){let r=this._mergedOtherSourceCaches[i];r&&e.push(r.getSource())}return e}getSource(e,i){let r=this.getSourceCache(e,i);return r&&r.getSource()}getLayerSource(e){let i=this.getLayerSourceCache(e);return i&&i.getSource()}getSourceCache(i,r){let n=e.C(i,r);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(i){let r=e.C(i.source,i.scope);return"symbol"===i.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);let i=[];return this._mergedOtherSourceCaches[e]&&i.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&i.push(this._mergedSymbolSourceCaches[e]),i}updateSourceCaches(){let e=this._changes.getUpdatedSourceCaches();for(let i in e){let r=e[i];"reload"===r?this.reloadSource(i):"clear"===r&&this.clearSource(i)}}updateLayers(e){for(let i of this._changes.getUpdatedPaintProperties()){let r=this.getLayer(i);r&&r.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e,this.scope)}getImages(i,r,n){this.imageManager.getImages(r.images,r.scope,n),this._updateTilesForChangedImages();let o=i=>{if(i){let n=r.images.map(i=>e.I.toString(i));i.setDependencies(r.tileID.key,r.type,n)}},a=e.C(r.source,r.scope);o(this._mergedOtherSourceCaches[a]),o(this._mergedSymbolSourceCaches[a])}rasterizeImages(e,i,r){this.imageManager.rasterizeImages(i,r)}getGlyphs(e,i,r){this.glyphManager.getGlyphs(i.stacks,i.scope,r)}getResource(i,r,n){return e.dh(r,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){let i=[];return this._otherSourceCaches[e]&&i.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&i.push(this._symbolSourceCaches[e]),i}_isSourceCacheLoaded(i){let r=this.getOwnSourceCaches(i);return 0===r.length?(this.fire(new e.z(Error(`There is no source with ID '${i}'`))),!1):r.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,i){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type)return!1;let r="fill-extrusion"===e.type&&"building"===e.sourceLayer;if(e.is3D(!!this.terrain)){if(r||i&&"batched-model"===i.type||"model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}iC.getSourceType=function(e){return eJ[e]},iC.setSourceType=function(e,i){eJ[e]=i},iC.registerForPluginStateChange=e.c$;var iA="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",iR="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",iM="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",iP="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",iO="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",ik="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",iL="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",iD="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",iz="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",iF="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",iB="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef TEXTURE_GATHER\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";let iN=[];iq(iA,iN),iq(iM,iN),iq(iR,iN);let ij={"_prelude_fog.vertex.glsl":ik,"_prelude_terrain.vertex.glsl":iO,"_prelude_shadow.vertex.glsl":iF,"_prelude_fog.fragment.glsl":iL,"_prelude_shadow.fragment.glsl":iB,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":iD,"_prelude_raster_particle.glsl":iz},iV={};i$("",iO),i$(iL,ik),i$(iB,iF),i$(iD,""),i$(iz,"");let iU=i$(iR,iM);var iG={background:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in highp vec3 v_normal;in highp float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_height);\n#endif\nglFragColor=vec4(linearTosRGB(color.rgb),color.a);\n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),buildingDepth:i$("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:i$("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:i$('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:i$("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:i$("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:i$("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:i$("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:i$("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:i$("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvoid main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,normal);\n#endif\nif (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:i$("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:i$('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:i$("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:i$("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:i$("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:i$("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:i$('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:i$('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef Z_OFFSET\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n#endif\n}'),terrainRaster:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:i$("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:i$('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',iP),skyboxGradient:i$('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',iP),skyboxCapture:i$("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:i$('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:i$('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:i$("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:i$("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:i$("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:i$("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:i$("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:i$("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function iq(e,i){for(let r of e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n"))if("#"===(r=r.trim())[0]&&r.includes("if")&&!r.includes("endif"))for(let e of(r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim()).split(" "))i.includes(e)||i.push(e)}function i$(e,i){let r=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,o=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);o&&(o=[...new Set(o=o.map(e=>{let i=e.split(" ");return i[i.length-1]}))]);let a={},s=[],l=[];if(e=e.replace(r,(e,i)=>(l.push(i),"")),(i=i.replace(r,(e,i)=>(s.push(i),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let h=[...iN];for(let r of(iq(e,h),iq(i,h),[...s,...l]))ij[r]||console.error(`Undefined include: ${r}`),iV[r]||(iV[r]=[],iq(ij[r],iV[r])),h=[...h,...iV[r]];return{fragmentSource:e=e.replace(n,(e,i,r,n,o)=>(a[o]=!0,"define"===i?`
#ifndef HAS_UNIFORM_u_${o}
in ${r} ${n} ${o};
#else
uniform ${r} ${n} u_${o};
#endif
`:"initialize"===i?`
#ifdef HAS_UNIFORM_u_${o}
    ${r} ${n} ${o} = u_${o};
#endif
`:"define-attribute"===i?`
#ifdef HAS_ATTRIBUTE_a_${o}
    in ${r} ${n} ${o};
#endif
`:"initialize-attribute"===i?"":void 0)),vertexSource:i=i.replace(n,(e,i,r,n,o)=>{let s="float"===n?"vec2":n,l=o.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===i?`
#ifdef HAS_ATTRIBUTE_a_${o}
in ${r} ${n} a_${o};
#endif
`:a[o]?"define"===i?`
#ifndef HAS_UNIFORM_u_${o}
uniform lowp float u_${o}_t;
in ${r} ${s} a_${o};
out ${r} ${n} ${o};
#else
uniform ${r} ${n} u_${o};
#endif
`:"initialize"===i?"vec4"===l?`
#ifndef HAS_UNIFORM_u_${o}
    ${o} = a_${o};
#else
    ${r} ${n} ${o} = u_${o};
#endif
`:`
#ifndef HAS_UNIFORM_u_${o}
    ${o} = unpack_mix_${l}(a_${o}, u_${o}_t);
#else
    ${r} ${n} ${o} = u_${o};
#endif
`:"define-attribute"===i?`
#ifdef HAS_ATTRIBUTE_a_${o}
    in ${r} ${n} a_${o};
    out ${r} ${n} ${o};
#endif
`:"initialize-attribute"===i?`
#ifdef HAS_ATTRIBUTE_a_${o}
    ${o} = a_${o};
#endif
`:void 0:"define"===i?`
#ifndef HAS_UNIFORM_u_${o}
uniform lowp float u_${o}_t;
in ${r} ${s} a_${o};
#else
uniform ${r} ${n} u_${o};
#endif
`:"define-instanced"===i?"mat4"===l?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${o}0;
in vec4 a_${o}1;
in vec4 a_${o}2;
in vec4 a_${o}3;
#else
uniform ${r} ${n} u_${o};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${r} ${s} a_${o};
#else
uniform ${r} ${n} u_${o};
#endif
`:"initialize-attribute-custom"===i?`
#ifdef HAS_ATTRIBUTE_a_${o}
    ${r} ${n} ${o} = a_${o};
#endif
`:"vec4"===l?`
#ifndef HAS_UNIFORM_u_${o}
    ${r} ${n} ${o} = a_${o};
#else
    ${r} ${n} ${o} = u_${o};
#endif
`:`
#ifndef HAS_UNIFORM_u_${o}
    ${r} ${n} ${o} = unpack_mix_${l}(a_${o}, u_${o}_t);
#else
    ${r} ${n} ${o} = u_${o};
#endif
`}),staticAttributes:o,usedDefines:h,vertexIncludes:s,fragmentIncludes:l}}class iH{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,i,r,n,o,a,s,l){this.context=e;let h=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!h&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(h=!0);let u=this.boundDynamicVertexBuffers.length!==s.length;for(let e=0;!u&&e<s.length;e++)this.boundDynamicVertexBuffers[e]!==s[e]&&(u=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==r||h||u||this.boundIndexBuffer!==o||this.boundVertexOffset!==a)this.freshBind(i,r,n,o,a,s,l);else{for(let r of(e.bindVertexArrayOES.set(this.vao),s))r&&(r.bind(),l&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,i,l));o&&o.dynamicDraw&&o.bind()}}freshBind(e,i,r,n,o,a,s){let l=e.numAttributes,h=this.context,u=h.gl;for(let s of(this.vao&&this.destroy(),this.vao=h.gl.createVertexArray(),h.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=o,this.boundDynamicVertexBuffers=a,i.enableAttributes(u,e),i.bind(),i.setVertexAttribPointers(u,e,o),r))s.enableAttributes(u,e),s.bind(),s.setVertexAttribPointers(u,e,o);for(let i of a)i&&(i.enableAttributes(u,e),i.bind(),i.setVertexAttribPointers(u,e,o),s&&i.instanceCount&&i.setVertexAttribDivisor(u,e,s));n&&n.bind(),h.currentNumAttributes=l}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function iZ(i,r,n){if(!r.needsDEMTextureUpload)return;let o=i.context,a=o.gl;o.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||i.getTileTexture(n.stride);let s=n.getPixels();r.demTexture?r.demTexture.update(s,{premultiply:!1}):r.demTexture=new e.T(o,s,a.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}class iW{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class iX extends iW{getDefault(){return e.am.transparent}set(e){let i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class iY extends iW{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class iK extends iW{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class iJ extends iW{getDefault(){return[!0,!0,!0,!0]}set(e){let i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class iQ extends iW{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class i0 extends iW{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class i1 extends iW{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class i2 extends iW{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class i3 extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class i5 extends iW{getDefault(){return[0,1]}set(e){let i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class i4 extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class i6 extends iW{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class i8 extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class i9 extends iW{getDefault(){let e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){let i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class i7 extends iW{getDefault(){return e.am.transparent}set(e){let i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class re extends iW{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class rt extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class ri extends iW{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class rr extends iW{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let rn=class extends iW{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ro extends iW{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ra extends iW{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class rs extends iW{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class rl extends iW{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rh extends iW{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ru extends iW{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rc extends iW{getDefault(){return null}set(e){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rd extends iW{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class rp extends iW{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class rf extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class rm extends iW{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class rg extends iW{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class r_ extends rg{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ry extends rg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class rv extends rg{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class rx extends ry{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let rb=(e,i,r)=>({u_matrix:e,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:r}),rw=(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:r,u_zoom_transition:o,u_merc_center:a,u_image0:0,u_frustum_tl:s,u_frustum_tr:l,u_frustum_br:h,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:d,u_viewport:p,u_grid_matrix:g?Float32Array.from(g):new Float32Array(9),u_skirt_height:f,u_far_z_cutoff:m});function rT(e,i){return null!=e&&null!=i&&!(!e.hasData()||!i.hasData())&&null!=e.demTexture&&null!=i.demTexture&&e.tileID.key!==i.tileID.key}let rS=new class{constructor(){this.operations={}}newMorphing(e,i,r,n,o){if(e in this.operations){let i=this.operations[e];i.to.tileID.key!==r.tileID.key&&(i.queued=r)}else this.operations[e]={startTime:n,phase:0,duration:o,from:i,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;let i=this.operations[e];return{from:i.from,to:i.to,phase:i.phase}}update(e){for(let i in this.operations){let r=this.operations[i];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[i];break}}}_nextOp(e,i){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=i,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},rE={0:null,1:"TERRAIN_VERTEX_MORPHING"};function rI(e,i,r){return 0===i?0:6*Math.pow(1.5,22-e)*Math.max(i,1)*(i<1&&514===r?.25/i:1)}let rC=e=>({u_matrix:e});function rA(i,r,n,o,a){if(a>0){let s=e.q.now(),l=(s-i.timeAdded)/a,h=r?(s-r.timeAdded)/a:-1,u=n.getSource(),c=o.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!r||Math.abs(r.tileID.overscaledZ-c)>Math.abs(i.tileID.overscaledZ-c),p=d&&i.refreshedUponExpiration?1:e.aD(d?l:1-h,0,1);return i.refreshedUponExpiration&&l>=1&&(i.refreshedUponExpiration=!1),r?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}class rR extends tn{constructor(i){let r=eQ("mock-dem",{type:"raster-dem",maxzoom:i.transform.maxZoom},new e.D(e.d0(),null),i.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,i){e.state="loaded",i(null)}}class rM extends tn{constructor(i){let r=eQ("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new e.D(e.d0(),null),i.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,r){if(e.freezeTileCoverage)return;this.transform=e;let n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){let i=new te(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i},{});for(let e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){let i=this.proxyCachedFBO[e];if(void 0!==i){let r=Object.values(i);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class rP extends e.aM{constructor(e,i,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=i,this.projMatrix=r}}class rO extends e.dt{constructor(i,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[n,o,a]=function(i){let r=new e.ba,n=new e.a_;r.reserve(17161),n.reserve(33800);let o=e.aj/128,a=e.aj+o/2,s=a+o;for(let i=-o;i<s;i+=o)for(let n=-o;n<s;n+=o){let o=24575*(n<0||n>a||i<0||i>a),s=e.aD(Math.round(n),0,e.aj),l=e.aD(Math.round(i),0,e.aj);r.emplaceBack(s+o,l)}let l=(e,i)=>{let r=131*i+e;n.emplaceBack(r+1,r,r+131),n.emplaceBack(r+131,r+131+1,r+1)};for(let e=1;e<129;e++)for(let i=1;i<129;i++)l(i,e);return[0,129].forEach(e=>{for(let i=0;i<130;i++)l(i,e),l(e,i)}),[r,n,32768]}(),s=i.context;this.gridBuffer=s.createVertexBuffer(n,e.bc.members),this.gridIndexBuffer=s.createIndexBuffer(o),this.gridSegments=e.bd.simpleSegment(0,0,n.length,o.length),this.gridNoSkirtSegments=e.bd.simpleSegment(0,0,n.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new rM(r.map),this.orthoMatrix=e.bz(),e.c5(this.orthoMatrix,.015*("globe"===this.painter.transform.projection.name),e.aj,0,e.aj,0,1);let l=s.gl;this._overlapStencilMode=new t5({func:l.GEQUAL,mask:255},0,255,l.KEEP,l.KEEP,l.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new rR(r.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,r,n){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);let o=i.terrain.properties,a=0===i.terrain.drapeRenderMode,s=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();let l=i.terrain&&i.terrain.scope,h=o.get("source"),u=a?this._mockSourceCache:i.getSourceCache(h,l);if(!u)return void e.w(`Couldn't find terrain source "${h}".`);if(this.sourceCache=u,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=s?this.calculateExaggeration(r):o.get("exaggeration"),!r.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;let c=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let i=this.getScaledDemTileSize();this.sourceCache.update(r,i,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),r.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);let r=this._previousCameraAltitude,n=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=n;let o=null!=r?n-r:Number.MAX_VALUE;if(2>Math.abs(o))return this._exaggeration;let a=i.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(a);let l=a-this._previousZoom,h=this._previousUpdateTimestamp,u=a;null!=this._evaluationZoom&&(Math.abs(a-(u=this._evaluationZoom))>.5&&(l=.5*(a-u+l)),l*o<0&&(u+=l)),this._evaluationZoom=u;let c=s.getExaggeration(u),d=c===s.getExaggeration(Math.max(0,u-.1));if(d&&.01>Math.abs(c-this._exaggeration))return c;let p=Math.min(.1,.00375*(this._updateTimestamp-h));return(d||c<.1||1e-4>Math.abs(l))&&(p=Math.min(.2,4*p)),e.ai(this._exaggeration,c,p)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let r=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);let o=this.proxyCoords=r.getIds().map(e=>{let i=r.getTileByID(e).tileID;return i.projMatrix=n.calculateProjMatrix(i.toUnwrapped()),i});var a=this.painter;let s=a.transform.pointCoordinate(a.transform.getCameraPoint()),l=new e.P(s.x,s.y);o.sort((i,r)=>{if(r.overscaledZ-i.overscaledZ)return r.overscaledZ-i.overscaledZ;let n=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=new e.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),a=l.mult(1<<i.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(n)-a.distSqr(o)});let h=this.proxyToSource||{};this.proxyToSource={},o.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};let u=this._style._mergedSourceCaches;for(let e in u){let r=u[e];if(!r.used||(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,i[e],h),r.usedForTerrain))continue;let n=i[e];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[r.id]=o.map(e=>new rP(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(o),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(h),this.renderingToTexture=!1;let c={};for(let e of(this._visibleDemTiles=[],this.proxyCoords)){let i=this.terrainTileForTile[e.key];if(!i)continue;let r=i.tileID.key;r in c||(this._visibleDemTiles.push(i),c[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;let i=this._findTileCoveringTileID(e,this.sourceCache);i&&(this.terrainTileForTile[e.key]=i)})}_prepareDEMTextures(){let e=this.painter.context,i=e.gl;for(let r in this.terrainTileForTile){let n=this.terrainTileForTile[r],o=n.dem;o&&(!n.demTexture||n.needsDEMTextureUpload)&&(e.activeTexture.set(i.TEXTURE1),iZ(this.painter,n,o))}}_prepareDemTileUniforms(e,i,r,n){if(!i||null==i.demTexture)return!1;let o=e.tileID.canonical,a=Math.pow(2,i.tileID.canonical.z-o.z),s=n||"";return r[`u_dem_tl${s}`]=[o.x*a%1,o.y*a%1],r[`u_dem_scale${s}`]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0,i=this._visibleDemTiles.reduce((i,r)=>{if(!r.dem)return i;let n=r.dem.tree.minimums[0];return n>0&&e++,i+n},0);return e?i/e:0}_updateEmptyDEMTexture(){let i=this.painter.context,r=i.gl;i.activeTexture.set(r.TEXTURE2);let n=this._getLoadedAreaMinimum(),o=new e.du({width:1,height:1},new Float32Array([n]));this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(o,{premultiply:!1}):a=this._emptyDEMTexture=new e.T(i,o,r.R32F,{premultiply:!1}),a}setupElevationDraw(i,r,n){var o;let a=this.painter.context,s=a.gl,l={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};l.u_exaggeration=this.exaggeration();let h=null,u=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){let e=n.morphing.srcDemTile,r=n.morphing.dstDemTile;c=n.morphing.phase,e&&r&&(this._prepareDemTileUniforms(i,e,l,"_prev")&&(u=e),this._prepareDemTileUniforms(i,r,l)&&(h=r))}let d=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST,p=null;if(this.enabled?u&&h?(p=h.demTexture,a.activeTexture.set(s.TEXTURE4),u.demTexture.bind(d(u),s.CLAMP_TO_EDGE),l.u_dem_lerp=c):(h=this.terrainTileForTile[i.tileID.key],p=this._prepareDemTileUniforms(i,h,l)?h.demTexture:this.emptyDEMTexture):p=this.emptyDEMTexture,a.activeTexture.set(s.TEXTURE2),p&&(l.u_dem_size=1===(o=p).size[0]?1:o.size[0]-2,p.bind(d(h),s.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(n&&n.useDepthForOcclusion,r,l),n&&n.useMeterToDem&&h&&(l.u_meter_to_dem=(1<<h.tileID.canonical.z)*e.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize),n&&n.labelPlaneMatrixInv&&(l.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),r.setTerrainUniformValues(a,l),"globe"===this.painter.transform.projection.name){let e=this.globeUniformValues(this.painter.transform,i.tileID.canonical,n&&n.useDenormalizedUpVectorScale);r.setGlobeUniformValues(a,e)}}globeUniformValues(i,r,n){let o=i.projection;return{u_tile_tl_up:o.upVector(r,0,0),u_tile_tr_up:o.upVector(r,e.aj,0),u_tile_br_up:o.upVector(r,e.aj,e.aj),u_tile_bl_up:o.upVector(r,0,e.aj),u_tile_up_scale:n?e.dv(1):o.upVectorScale(r,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){let r=this.painter,n=this.painter.context;0!==i.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(i,r,n,o,a){if("globe"===i.transform.projection.name)!function(i,r,n,o,a){let s,l,h=i.context,u=h.gl,c=i.transform,d=e.dl(i,h,c),p=(e,r)=>{if(l===r)return;let n=[rE[r],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING");let o=i.isTileAffectedByFog(e);s=i.getOrCreateProgram("globeRaster",{defines:n,overrideFog:o}),l=r},f=i.colorModeForRenderPass(),m=new t3(u.LEQUAL,t3.ReadWrite,i.depthRangeFor3D);rS.update(a);let g=e.dm(c),_=[e.ay(c.center.lng),e.aH(c.center.lat)],y=i.globeSharedBuffers,v=[c.width*e.q.devicePixelRatio,c.height*e.q.devicePixelRatio],x=Float32Array.from(c.globeMatrix),b={useDenormalizedUpVectorScale:!0};{let c=i.transform,d=rI(c.zoom,r.exaggeration(),r.sourceCache._source.tileSize);l=-1;let w=u.TRIANGLES;for(let l of o){let o=n.getTile(l),T=t5.disabled,S=r.prevTerrainTileForTile[l.key],E=r.terrainTileForTile[l.key];rT(S,E)&&rS.newMorphing(l.key,S,E,a,250),h.activeTexture.set(u.TEXTURE0),o.texture&&o.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);let I=rS.getMorphValuesForProxy(l.key),C=+!!I;I&&e.L(b,{morphing:{srcDemTile:I.from,dstDemTile:I.to,phase:e.dk(I.phase)}});let A=e.dn(l.canonical),R=e.dp(A.getCenter().lat),M=e.dq(l.canonical,A,R,c.worldSize/c._pixelsPerMercatorPixel),P=e.bh(e.dr(l.canonical)),O=rw(c.expandedFarZProjMatrix,x,g,P,e.ah(c.zoom),_,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,v,d,c._farZ,M);if(p(l,C),s&&(r.setupElevationDraw(o,s,b),i.uploadCommonUniforms(h,s,l.toUnwrapped()),y)){let[e,r,n]=y.getGridBuffers(R,0!==d);s.draw(i,w,m,T,f,t4.backCCW,O,"globe_raster",e,r,n)}}}if(y&&(i.renderDefaultNorthPole||i.renderDefaultSouthPole)){let a=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];for(let l of(d&&a.push("CUSTOM_ANTIALIASING"),s=i.getOrCreateProgram("globeRaster",{defines:a}),o)){let{x:o,y:a,z:d}=l.canonical,p=0===a,g=a===(1<<d)-1,[x,w,T,S]=y.getPoleBuffers(d,!1);if(S&&(p||g)){let a=n.getTile(l);h.activeTexture.set(u.TEXTURE0),a.texture&&a.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);let y=e.ds(d,o,c),E=e.bh(e.dr(l.canonical)),I=(e,r)=>e.draw(i,u.TRIANGLES,m,t5.disabled,f,t4.disabled,rw(c.expandedFarZProjMatrix,y,y,E,0,_,c.frustumCorners.TL,c.frustumCorners.TR,c.frustumCorners.BR,c.frustumCorners.BL,c.globeCenterInViewSpace,c.globeRadius,v,0,c._farZ),"globe_pole_raster",r,T,S);r.setupElevationDraw(a,s,b),i.uploadCommonUniforms(h,s,l.toUnwrapped()),p&&i.renderDefaultNorthPole&&I(s,x),g&&i.renderDefaultSouthPole&&(y=e.cE(e.bz(),y,[1,-1,1]),I(s,w))}}}}(i,r,n,o,a);else{let s,l,h=i.context,u=h.gl,c=i.shadowRenderer,d=io(i,i.longestCutoffRange),p=e=>{if(l===e)return;let r=[];r.push(rE[e]),d.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),c&&(r.push("RENDER_SHADOWS","DEPTH_TEXTURE"),c.useNormalOffset&&r.push("NORMAL_OFFSET")),s=i.getOrCreateProgram("terrainRaster",{defines:r}),l=e},f=i.colorModeForRenderPass(),m=new t3(u.LEQUAL,t3.ReadWrite,i.depthRangeFor3D);rS.update(a);let g=i.transform,_=rI(g.zoom,r.exaggeration(),r.sourceCache._source.tileSize),y=[0,0,0];if(c){let e=i.style.directionalLight,r=i.style.ambientLight;e&&r&&(y=id(i.style,e,r))}{l=-1;let v=u.TRIANGLES,[x,b]=[r.gridIndexBuffer,r.gridSegments];for(let l of o){let o,w=n.getTile(l),T=t5.disabled,S=r.prevTerrainTileForTile[l.key],E=r.terrainTileForTile[l.key];rT(S,E)&&rS.newMorphing(l.key,S,E,a,250),h.activeTexture.set(u.TEXTURE0),w.texture&&w.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE);let I=rS.getMorphValuesForProxy(l.key),C=+!!I;I&&(o={morphing:{srcDemTile:I.from,dstDemTile:I.to,phase:e.dk(I.phase)}});let A=rb(l.projMatrix,!function(e,i){let r=1<<e.z;return!i&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}(l.canonical,g.renderWorldCopies)?_:_/10,y);if(p(C),!s)continue;r.setupElevationDraw(w,s,o);let R=l.toUnwrapped();c&&c.setupShadows(R,s),i.uploadCommonUniforms(h,s,R,null,d),s.draw(i,v,m,T,f,t4.backCCW,A,"terrain_raster",r.gridBuffer,x,b)}}}}(r,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;let r=this.painter,n=this.painter.context,o=this.proxySourceCache,a=this.proxiedCoords[o.id],s=this._drapedRenderBatches.shift(),l=r.style.order,h=[],u=0;for(let c of a){let a,d=o.getTileByID(c.proxyTileKey),p=o.proxyCachedFBO[c.key]?o.proxyCachedFBO[c.key][i]:void 0,f=void 0!==p?o.renderCache[p]:this.pool[u++],m=void 0!==p;if(d.texture=f.tex,m&&!f.dirty){h.push(d.tileID);continue}n.bindFramebuffer.set(f.fb.framebuffer),this.renderedToTile=!1,f.dirty&&(n.clear({color:e.am.transparent,stencil:0}),f.dirty=!1);for(let e=s.start;e<=s.end;++e){let i=r.style._mergedLayers[l[e]];if(i.isHidden(r.transform.zoom))continue;let o=r.style.getLayerSourceCache(i),s=o?this.proxyToSource[c.key][o.id]:[c];s&&(n.viewport.set([0,0,f.fb.width,f.fb.height]),a!==(o?o.id:null)&&(this._setupStencil(f,s,i,o),a=o?o.id:null),r.renderLayer(r,o,i,s))}if(0===this._drapedRenderBatches.length)for(let e of this._pendingGroundEffectLayers){let i=r.style._mergedLayers[l[e]];if(i.isHidden(r.transform.zoom))continue;let o=r.style.getLayerSourceCache(i),s=o?this.proxyToSource[c.key][o.id]:[c];s&&(n.viewport.set([0,0,f.fb.width,f.fb.height]),a!==(o?o.id:null)&&(this._setupStencil(f,s,i,o),a=o?o.id:null),r.renderLayer(r,o,i,s))}this.renderedToTile?(f.dirty=!0,h.push(d.tileID)):m||--u,5===u&&(u=0,this.renderToBackBuffer(h))}return this.renderToBackBuffer(h),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),s.end+1}postRender(){}isLayerOrderingCorrect(e){let i=e.order.length,r=-1,n=i;for(let o=0;o<i;++o)this._style.isLayerDraped(e._mergedLayers[e.order[o]])?r=Math.max(r,o):n=Math.min(n,o);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(i=>{e=Math.min(e,i.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,i,r){if(!this._visibleDemTiles)return null;let n=this._visibleDemTiles.filter(e=>e.dem).map(n=>{let o=n.tileID,a=1<<o.overscaledZ,{x:s,y:l}=o.canonical,h=s/a,u=(s+1)/a,c=l/a,d=(l+1)/a;return{minx:h,miny:c,maxx:u,maxy:d,t:n.dem.tree.raycastRoot(h,c,u,d,e,i,r),tile:n}});for(let o of(n.sort((e,i)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==i.t?i.t:Number.MAX_VALUE)),n)){if(null==o.t)break;let n=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,e,i,r);if(null!=n)return n}return null}_createFBO(){let i=this.painter.context,r=i.gl,n=this.drapeBufferSize;i.activeTexture.set(r.TEXTURE0);let o=new e.T(i,{width:n[0],height:n[1],data:null},r.RGBA8);o.bind(r.LINEAR,r.CLAMP_TO_EDGE);let a=i.createFramebuffer(n[0],n[1],!0,null);return a.colorAttachment.set(o.texture),a.depthAttachment=new rx(i,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:a,tex:o,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{let i=this._style._mergedLayers[e],r=i.isHidden(this.painter.transform.zoom);return"hillshade"===i.type||"custom"===i.type?!r&&i.shouldRedrape():!r&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(let e of this._style.getSources())if(e instanceof eX){i=!0;break}if(!i)return;let r={};for(let i=0;i<this._style.order.length;++i){let n=this._style._mergedLayers[this._style.order[i]],o=this._style.getLayerSourceCache(n);if(o&&!r[o.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof e.ab)for(let e of(r[o.id]=!0,this.proxyCoords)){let i=this.proxyToSource[e.key][o.id];if(i)for(let e of i)this._clearRenderCacheForTile(o.id,e)}}}_clearRasterLayersFromRenderCache(){let e=!1;for(let i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof eY){e=!0;break}if(!e)return;let i={};for(let e=0;e<this._style.order.length;++e){let r=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(r);if(!n||i[n.id]||r.isHidden(this.painter.transform.zoom)||"raster"!==r.type)continue;let o=r.paint.get("raster-fade-duration");for(let e of this.proxyCoords){let i=this.proxyToSource[e.key][n.id];if(i)for(let e of i){let i=rA(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,o);(1!==i.opacity||0!==i.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();let i=this._style.order,r=i.length;if(0===r)return;let n=[];this._pendingGroundEffectLayers=[];let o,a=0,s=this._style._mergedLayers[i[a]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++a<r;)s=this._style._mergedLayers[i[a]];for(;a<r;++a){let e=this._style._mergedLayers[i[a]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===o&&(o=a):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(a),void 0!==o&&(n.push({start:o,end:a-1}),o=void 0)))}if(void 0!==o&&n.push({start:o,end:a-1}),0!==n.length){let i=n[n.length-1];this._pendingGroundEffectLayers.every(e=>e>i.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){let i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){let e=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let r=0;r<e.length;++r){let n=Object.values(e[r]);i.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();let r=this.proxyCoords,n=this._tilesDirty;for(let o=r.length-1;o>=0;o--){let a=r[o];if(i.getTileByID(a.key),void 0!==i.proxyCachedFBO[a.key]){let r=e[a.key],o=this.proxyToSource[a.key],s=0;for(let e in o){let i=o[e],a=r[e];if(!a||a.length!==i.length||i.some((i,r)=>i!==a[r]||n[e]&&n[e].hasOwnProperty(i.key))){s=-1;break}++s}for(let e in i.proxyCachedFBO[a.key])i.renderCache[i.proxyCachedFBO[a.key][e]].dirty=s<0||s!==Object.values(r).length}}let o=[...this._drapedRenderBatches];for(let e of(o.sort((e,i)=>i.end-i.start-(e.end-e.start)),o))for(let n of r){if(i.proxyCachedFBO[n.key])continue;let r=i.renderCachePool.pop();void 0===r&&i.renderCache.length<50&&(r=i.renderCache.length,i.renderCache.push(this._createFBO())),void 0!==r&&(i.proxyCachedFBO[n.key]={},i.proxyCachedFBO[n.key][e.start]=r,i.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,i,r,n){let o;if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let a=this.painter.context,s=a.gl;if(i.length<=1)return void(this._overlapStencilType=!1);if(r.isTileClipped())o=i.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(a.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t5.disabled}_renderTileClippingMasks(e,i){let r=this.painter,n=this.painter.context,o=n.gl;r._tileClippingMaskIDs={},n.setColorMode(t2.disabled),n.setDepthMode(t3.disabled);let a=r.getOrCreateProgram("clippingMask");for(let n of e){let e=r._tileClippingMaskIDs[n.key]=--i;a.draw(r,o.TRIANGLES,t3.disabled,new t5({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t2.disabled,t4.disabled,rC(n.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(i){let r=this.painter.transform;if(i.x<0||i.x>r.width||i.y<0||i.y>r.height)return null;let n=[i.x,i.y,1,1];e.aA(n,n,r.pixelMatrixInverse),e.cw(n,n,1/n[3]),n[0]/=r.worldSize,n[1]/=r.worldSize;let o=r._camera.position,a=e.c6(1,r.center.lat),s=[o[0],o[1],o[2]/a,0],l=e.cY([],n.slice(0,3),s);e.au(l,l);let h=this.raycast(s,l,this._exaggeration);return null!==h&&h?(e.bF(s,s,l,h),s[3]=s[2],s[2]*=a,s):null}_setupProxiedCoordsForOrtho(i,r,n){if(i.getSource()instanceof e.aP)return this._setupProxiedCoordsForImageSource(i,r,n);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};let o=this.proxiedCoords[i.id]=[],a=this.proxyCoords;for(let e=0;e<a.length;e++){let r=a[e],s=this._findTileCoveringTileID(r,i);if(s){let e=this._createProxiedId(r,s,n[r.key]&&n[r.key][i.id]);o.push(e),this.proxyToSource[r.key][i.id]=[e]}}let s=!1,l=new Set;for(let e=0;e<r.length;e++){let a=i.getTile(r[e]);if(!a||!a.hasData())continue;let h=this._findTileCoveringTileID(a.tileID,this.proxySourceCache);if(h&&h.tileID.canonical.z!==a.tileID.canonical.z){let e=this.proxyToSource[h.tileID.key][i.id],r=this._createProxiedId(h.tileID,a,n[h.tileID.key]&&n[h.tileID.key][i.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[h.tileID.key][i.id]=[r];let u=this.proxyToSource[h.tileID.key][i.id];l.has(u)||l.add(u),o.push(r),s=!0}}if(this._sourceTilesOverlap[i.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(let e of l)e.sort((e,i)=>i.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(i,r,n){if(!i.getSource().loaded())return;let o=this.proxiedCoords[i.id]=[],a=this.proxyCoords,s=i.getSource(),l=s.tileID;if(!l)return;let h=new e.P(l.x,l.y)._div(1<<l.z),u=s.coordinates.map(e.ac.fromLngLat).reduce((e,i)=>(e.min.x=Math.min(e.min.x,i.x-h.x),e.min.y=Math.min(e.min.y,i.y-h.y),e.max.x=Math.max(e.max.x,i.x-h.x),e.max.y=Math.max(e.max.y,i.y-h.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(i,r)=>{let n=i.wrap+i.canonical.x/(1<<i.canonical.z),o=i.canonical.y/(1<<i.canonical.z),a=e.aj/(1<<i.canonical.z),s=r.wrap+r.canonical.x/(1<<r.canonical.z),l=r.canonical.y/(1<<r.canonical.z);return n+a<s+u.min.x||n>s+u.max.x||o+a<l+u.min.y||o>l+u.max.y};for(let e=0;e<a.length;e++){let s=a[e];for(let e=0;e<r.length;e++){let a=i.getTile(r[e]);if(!a||!a.hasData()||c(s,a.tileID))continue;let l=this._createProxiedId(s,a,n[s.key]&&n[s.key][i.id]),h=this.proxyToSource[s.key][i.id];h?h.push(l):this.proxyToSource[s.key][i.id]=[l],o.push(l)}}}_createProxiedId(i,r,n){let o=this.orthoMatrix;if(n){let e=n.find(e=>e.key===r.tileID.key);if(e)return e}if(r.tileID.key!==i.key){let n,a,s,l=i.canonical.z-r.tileID.canonical.z;o=e.bz();let h=r.tileID.wrap-i.wrap<<i.overscaledZ;l>0?(a=(n=e.aj>>l)*((r.tileID.canonical.x<<l)-i.canonical.x+h),s=n*((r.tileID.canonical.y<<l)-i.canonical.y)):(n=e.aj<<-l,a=e.aj*(r.tileID.canonical.x-(i.canonical.x+h<<-l)),s=e.aj*(r.tileID.canonical.y-(i.canonical.y<<-l))),e.c5(o,0,n,0,n,0,1),e.bo(o,o,[a,s,0])}return new rP(r.tileID,i.key,o)}_findTileCoveringTileID(i,r){let n=r.getTile(i);if(n&&n.hasData())return n;let o=this._findCoveringTileCache[r.id],a=o[i.key];if((n=a?r.getTileByID(a):null)&&n.hasData()||null===a)return n;let s=n?n.tileID:i,l=s.overscaledZ,h=r.getSource().minzoom,u=[];if(!a){let o=r.getSource().maxzoom;if(i.canonical.z>=o){let n=i.canonical.z-o;r.getSource().reparseOverscaled?(l=Math.max(i.canonical.z+2,r.transform.tileZoom),s=new e.aM(l,i.wrap,o,i.canonical.x>>n,i.canonical.y>>n)):0!==n&&(l=o,s=new e.aM(l,i.wrap,o,i.canonical.x>>n,i.canonical.y>>n))}s.key!==i.key&&(u.push(s.key),n=r.getTile(s))}let c=e=>{u.forEach(i=>{o[i]=e}),u.length=0};for(l-=1;l>=h&&(!n||!n.hasData());l--){n&&c(n.tileID.key);let e=s.calculateScaledKey(l);if((n=r.getTileByID(e))&&n.hasData())break;let i=o[e];if(null===i)break;void 0===i?u.push(e):n=r.getTileByID(i)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,i){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[i.key]=!0}}let rk=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],rL=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class rD{static cacheKey(e,i,r,n){let o=`${i}${n?n.cacheKey:""}`;for(let i of r)e.usedDefines.includes(i)&&(o+=`/${i}`);return o}constructor(i,r,n,o,a,s){let l=i.gl;this.program=l.createProgram(),this.configuration=o,this.name=r,this.fixedDefines=[...s];let h=o?o.getBinderAttributes():[],u=(n.staticAttributes||[]).concat(h),c=o?o.defines():[];c=c.concat(s.map(e=>`#define ${e}`));let d="#version 300 es\n",p=d+c.concat("precision mediump float;",iA,iU.fragmentSource).join("\n");for(let e of n.fragmentIncludes)p+=`
${ij[e]}`;p+=`
${n.fragmentSource}`;let f=d+c.concat("precision highp float;",iA,iU.vertexSource).join("\n");for(let e of n.vertexIncludes)f+=`
${ij[e]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&-1!==n.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(f+="\nuniform int u_instanceID;\n"),f+=`
${n.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(f=f.replaceAll("gl_InstanceID","u_instanceID"));let m=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())return void(this.failedToCreate=!0);l.shaderSource(m,p),l.compileShader(m),l.attachShader(this.program,m);let g=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(g,f),l.compileShader(g),l.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)if(u[e]){let i=u[e].startsWith("a_")?u[e]:`a_${u[e]}`;l.bindAttribLocation(this.program,e,i),this.attributes[i]=e}l.linkProgram(this.program),l.deleteShader(g),l.deleteShader(m),this.fixedUniforms=a(i),this.binderUniforms=o?o.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms={u_instanceID:new e.cc(i)}),(s.includes("TERRAIN")||-1!==r.indexOf("symbol")||-1!==r.indexOf("circle"))&&(this.terrainUniforms={u_dem:new e.cc(i),u_dem_prev:new e.cc(i),u_dem_tl:new e.c9(i),u_dem_scale:new e.cb(i),u_dem_tl_prev:new e.c9(i),u_dem_scale_prev:new e.cb(i),u_dem_size:new e.cb(i),u_dem_lerp:new e.cb(i),u_exaggeration:new e.cb(i),u_depth:new e.cc(i),u_depth_size_inv:new e.c9(i),u_depth_range_unpack:new e.c9(i),u_occluder_half_size:new e.cb(i),u_occlusion_depth_offset:new e.cb(i),u_meter_to_dem:new e.cb(i),u_label_plane_matrix_inv:new e.c8(i)}),s.includes("GLOBE")&&(this.globeUniforms={u_tile_tl_up:new e.ca(i),u_tile_tr_up:new e.ca(i),u_tile_br_up:new e.ca(i),u_tile_bl_up:new e.ca(i),u_tile_up_scale:new e.cb(i)}),s.includes("FOG")&&(this.fogUniforms={u_fog_matrix:new e.c8(i),u_fog_range:new e.c9(i),u_fog_color:new e.cQ(i),u_fog_horizon_blend:new e.cb(i),u_fog_vertical_limit:new e.c9(i),u_fog_temporal_offset:new e.cb(i),u_frustum_tl:new e.ca(i),u_frustum_tr:new e.ca(i),u_frustum_br:new e.ca(i),u_frustum_bl:new e.ca(i),u_globe_pos:new e.ca(i),u_globe_radius:new e.cb(i),u_globe_transition:new e.cb(i),u_is_globe:new e.cc(i),u_viewport:new e.c9(i)}),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms={u_cutoff_params:new e.cQ(i)}),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms={u_lighting_ambient_color:new e.ca(i),u_lighting_directional_dir:new e.ca(i),u_lighting_directional_color:new e.ca(i),u_ground_radiance:new e.ca(i)}),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms={u_light_matrix_0:new e.c8(i),u_light_matrix_1:new e.c8(i),u_fade_range:new e.c9(i),u_shadow_normal_offset:new e.ca(i),u_shadow_intensity:new e.cb(i),u_shadow_texel_size:new e.cb(i),u_shadow_map_resolution:new e.cb(i),u_shadow_direction:new e.ca(i),u_shadow_bias:new e.ca(i),u_shadowmap_0:new e.cc(i),u_shadowmap_1:new e.cc(i)})}}setTerrainUniformValues(e,i){if(!this.terrainUniforms)return;let r=this.terrainUniforms;if(!this.failedToCreate)for(let n in e.program.set(this.program),i)r[n]&&r[n].set(this.program,n,i[n])}setGlobeUniformValues(e,i){if(!this.globeUniforms)return;let r=this.globeUniforms;if(!this.failedToCreate)for(let n in e.program.set(this.program),i)r[n]&&r[n].set(this.program,n,i[n])}setFogUniformValues(e,i){if(!this.fogUniforms)return;let r=this.fogUniforms;if(!this.failedToCreate)for(let n in e.program.set(this.program),i)r[n].set(this.program,n,i[n])}setCutoffUniformValues(e,i){if(!this.cutoffUniforms)return;let r=this.cutoffUniforms;if(!this.failedToCreate)for(let n in e.program.set(this.program),i)r[n].set(this.program,n,i[n])}setLightsUniformValues(e,i){if(!this.lightsUniforms)return;let r=this.lightsUniforms;if(!this.failedToCreate)for(let n in e.program.set(this.program),i)r[n].set(this.program,n,i[n])}setShadowUniformValues(e,i){if(this.failedToCreate||!this.shadowUniforms)return;let r=this.shadowUniforms;for(let n in e.program.set(this.program),i)r[n].set(this.program,n,i[n])}_drawDebugWireframe(i,r,n,o,a,s,l,h,u,c){let d=i.options.wireframe;if(!1===d.terrain&&!1===d.layers2D&&!1===d.layers3D)return;let p=i.context;if(!(!(!d.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!d.layers2D||i._terrain&&i._terrain.renderingToTexture||!rk.includes(this.name))||!(!d.layers3D||!rL.includes(this.name))))return;let f=p.gl,m=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,a,p);if(!m)return;let g=[...this.fixedDefines];g.push("DEBUG_WIREFRAME");let _=i.getOrCreateProgram(this.name,{config:this.configuration,defines:g});p.program.set(_.program);let y=(e,i,r)=>{if(i[e]&&r[e])for(let n in i[e])r[e][n]&&r[e][n].set(r.program,n,i[e][n].current)};u&&u.setUniforms(_.program,p,_.binderUniforms,l,{zoom:h}),y("fixedUniforms",this,_),y("terrainUniforms",this,_),y("globeUniforms",this,_),y("fogUniforms",this,_),y("lightsUniforms",this,_),y("shadowUniforms",this,_),m.bind(),p.setColorMode(new t2([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE],e.am.transparent,[!0,!0,!0,!1])),p.setDepthMode(new t3(r.func===f.LESS?f.LEQUAL:r.func,t3.ReadOnly,r.range)),p.setStencilMode(t5.disabled);let v=3*s.primitiveLength*2,x=3*s.primitiveOffset*4;if(this.forceManualRenderingForInstanceIDShaders){let e=c||1;for(let i=0;i<e;++i)_.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",i),f.drawElements(f.LINES,v,f.UNSIGNED_SHORT,x)}else c&&c>1?f.drawElementsInstanced(f.LINES,v,f.UNSIGNED_SHORT,x,c):f.drawElements(f.LINES,v,f.UNSIGNED_SHORT,x);a.bind(),p.program.set(this.program),p.setDepthMode(r),p.setStencilMode(n),p.setColorMode(o)}checkUniforms(e,i,r){if(this.fixedDefines.includes(i)){for(let n of Object.keys(r))if(!r[n].initialized)throw Error(`Program '${this.name}', from draw '${e}': uniform ${n} not set but required by ${i} being defined`)}}draw(e,i,r,n,o,a,s,l,h,u,c,d,p,f,m,g){let _=e.context,y=_.gl;if(this.failedToCreate)return;for(let e of(_.program.set(this.program),_.setDepthMode(r),_.setStencilMode(n),_.setColorMode(o),_.setCullFace(a),Object.keys(this.fixedUniforms)))this.fixedUniforms[e].set(this.program,e,s[e]);f&&f.setUniforms(this.program,_,this.binderUniforms,d,{zoom:p});let v={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[i];this.checkUniforms(l,"RENDER_SHADOWS",this.shadowUniforms);let x=g&&g>0?1:void 0;for(let a of c.get()){let s=a.vaos||(a.vaos={});if((s[l]||(s[l]=new iH)).bind(_,this,h,f?f.getPaintVertexBuffers():[],u,a.vertexOffset,m||[],x),this.forceManualRenderingForInstanceIDShaders){let e=g||1;for(let r=0;r<e;++r)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",r),u?y.drawElements(i,a.primitiveLength*v,y.UNSIGNED_SHORT,a.primitiveOffset*v*2):y.drawArrays(i,a.vertexOffset,a.vertexLength)}else g&&g>1?y.drawElementsInstanced(i,a.primitiveLength*v,y.UNSIGNED_SHORT,a.primitiveOffset*v*2,g):u?y.drawElements(i,a.primitiveLength*v,y.UNSIGNED_SHORT,a.primitiveOffset*v*2):y.drawArrays(i,a.vertexOffset,a.vertexLength);i===y.TRIANGLES&&u&&this._drawDebugWireframe(e,r,n,o,u,a,d,p,f,g)}}}function rz(i,r,n=0){let o=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,i.transform.tileZoom)/o,s=a*(r.tileID.canonical.x+r.tileID.wrap*o),l=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.aw(r,1,i.transform.tileZoom),u_pixel_coord_upper:[s>>16,l>>16],u_pixel_coord_lower:[65535&s,65535&l],u_pattern_transition:n}}let rF={terrain:0,flat:1},rB=e.bz(),rN=(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v)=>{let x=r.style.light,b=x.properties.get("position"),w=[b.x,b.y,b.z],T=e.dx();"viewport"===x.properties.get("anchor")&&(e.dy(T,-r.transform.angle),e.dz(w,w,T));let S=x.properties.get("color"),E=r.transform,I={u_matrix:i,u_lightpos:w,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:o,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rB,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:rF[c],u_base_type:rF[d],u_ao:a,u_edge_radius:s,u_width_scale:l,u_flood_light_color:g,u_vertical_scale:_,u_flood_light_intensity:y,u_ground_shadow_factor:v};return"globe"===E.projection.name&&(I.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],I.u_zoom_transition=p,I.u_inv_rot_matrix=m,I.u_merc_center=f,I.u_up_dir=E.projection.upVector(new e.cp(0,0,0),f[0]*e.aj,f[1]*e.aj),I.u_height_lift=u),I},rj=(e,i,r,n,o,a)=>({u_matrix:e,u_edge_radius:i,u_width_scale:r,u_vertical_scale:n,u_height_type:rF[o],u_base_type:rF[a]}),rV=(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v)=>{let x=rN(i,r,n,o,a,s,l,h,c,d,p,f,m,g,_,y,1,[0,0,0]),b={u_height_factor:-Math.pow(2,h.overscaledZ)/u.tileSize/8};return e.l(x,rz(r,u,v),b)},rU=(e,i,r)=>({u_matrix:e,u_emissive_strength:i,u_ground_shadow_factor:r}),rG=(i,r,n,o,a,s=0)=>e.l(rU(i,r,a),rz(n,o,s)),rq=(e,i,r,n)=>({u_matrix:e,u_world:r,u_emissive_strength:i,u_ground_shadow_factor:n}),r$=(i,r,n,o,a,s,l=0)=>e.l(rG(i,r,n,o,s,l),{u_world:a}),rH=(e,i)=>({u_matrix:e,u_ground_shadow_factor:i}),rZ=(e,i,r,n,o)=>({u_matrix:e,u_camera_pos:[i[0],i[1],i[2]],u_depth_bias:r,u_height_scale:n,u_reset_depth:o}),rW=(i,r,n,o)=>{let a=e.aj/n.tileSize;return{u_matrix:i,u_camera_to_center_distance:r.getCameraToCenterDistance(o),u_extrude_scale:[r.pixelsToGLUnits[0]/a,r.pixelsToGLUnits[1]/a]}},rX=(e,i,r=1)=>({u_matrix:e,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),rY=e.bz(),rK=(i,r,n,o,a,s,l)=>{let h=i.transform,u="globe"===h.projection.name,c=u?e.dA(h.zoom,r.canonical)*h._pixelsPerMercatorPixel:e.aw(n,1,s),d={u_matrix:r.projMatrix,u_extrude_scale:c,u_intensity:l,u_inv_rot_matrix:rY,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(u){d.u_inv_rot_matrix=o,d.u_merc_center=a,d.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],d.u_zoom_transition=e.ah(h.zoom);let i=a[0]*e.aj,n=a[1]*e.aj;d.u_up_dir=h.projection.upVector(new e.cp(0,0,0),i,n)}return d};function rJ(e,[i,r,n,o],[a,s]){if(a===s)return[0,0,0,0];let l=255*(e-1)/(e*(s-a));return[i*l,r*l,n*l,o*l]}function rQ(e,i,[r,n]){return r===n?0:.5/e+(i-r)*(e-1)/(e*(n-r))}let r0=(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w)=>({u_matrix:i,u_normalize_matrix:r,u_globe_matrix:n,u_merc_matrix:o,u_grid_matrix:a,u_tl_parent:s,u_scale_parent:c,u_fade_t:d.mix,u_opacity:d.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:e.dB(p.paint.get("raster-saturation")),u_contrast_factor:e.dC(p.paint.get("raster-contrast")),u_spin_weights:function(e){let i=Math.sin(e*=Math.PI/180),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*i-r+1)/3,(Math.sqrt(3)*i-r+1)/3]}(p.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_raster_elevation:m,u_zoom_transition:l,u_merc_center:h,u_cutoff_params:u,u_colorization_mix:rJ(e.dD,_,v),u_colorization_offset:rQ(e.dD,y,v),u_color_ramp:g,u_texture_offset:[b/(x+2*b),x/(x+2*b)],u_texture_res:[x+2*b,x+2*b],u_emissive_strength:w}),r1=(e,i,r,n,o,a,s,l,h,u,c,d)=>({u_matrix:e,u_normalize_matrix:i,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:a,u_scale_parent:u,u_fade_t:c.mix,u_opacity:c.opacity,u_image0:0,u_image1:1,u_raster_elevation:d,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:h}),r2=(e,i,r,n,o,a,s,l,h,u)=>({u_particle_texture:e,u_particle_texture_side_len:i,u_tile_offset:r,u_velocity:n,u_color_ramp:a,u_velocity_res:o,u_max_speed:s,u_uv_offset:l,u_data_scale:[255*h[0],255*h[1]],u_data_offset:u,u_particle_pos_scale:1.1,u_particle_pos_offset:[.05,.05]}),r3=(e,i,r,n,o,a,s,l,h,u)=>({u_particle_texture:e,u_particle_texture_side_len:i,u_velocity:r,u_velocity_res:n,u_max_speed:o,u_speed_factor:a,u_reset_rate:s,u_rand_seed:Math.random(),u_uv_offset:l,u_data_scale:[255*h[0],255*h[1]],u_data_offset:u,u_particle_pos_scale:1.1,u_particle_pos_offset:[.05,.05]}),r5=e.bz(),r4=(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x,b,w,T,S)=>{let E=a.transform,I={u_is_size_zoom_constant:+("constant"===i||"source"===i),u_is_size_feature_constant:+("constant"===i||"camera"===i),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:E.getCameraToCenterDistance(x),u_rotate_symbol:+n,u_aspect_ratio:E.width/E.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:l,u_coord_matrix:h,u_is_text:+c,u_elevation_from_sea:+!!u,u_pitch_with_map:+o,u_texsize:d,u_texsize_icon:p,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:r5,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:r5,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:T||0,u_gamma_scale:o?a.transform.getCameraToCenterDistance(x)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:+f,u_scale_factor:S||1,u_ground_shadow_factor:b,u_inv_matrix:e.bi(e.bz(),l)};return"globe"===x.name&&(I.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],I.u_zoom_transition=g,I.u_inv_rot_matrix=y,I.u_merc_center=_,I.u_camera_forward=E._camera.forward(),I.u_ecef_origin=e.dE(E.globeMatrix,m.toUnwrapped()),I.u_tile_matrix=Float32Array.from(E.globeMatrix),I.u_up_vector=v),I},r6=(e,i,r,n)=>({u_matrix:e,u_emissive_strength:i,u_opacity:r,u_color:n}),r8=(i,r,n,o,a,s,l,h,u)=>e.l(function(i,r,n,o,a,s){let{width:l,height:h}=o.imageManager.getPixelSize(r),u=Math.pow(2,s.tileID.overscaledZ),c=s.tileSize*Math.pow(2,o.transform.tileZoom)/u,d=c*(s.tileID.canonical.x+s.tileID.wrap*u),p=c*s.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[l,h],u_pattern_size:n.displaySize,u_pattern_units_to_pixels:a?[o.transform.width,-1*o.transform.height]:[1/e.aw(s,1,o.transform.tileZoom),1/e.aw(s,1,o.transform.tileZoom)],u_pixel_coord_upper:[d>>16,p>>16],u_pixel_coord_lower:[65535&d,65535&p]}}(0,s,l,o,h,u),{u_matrix:i,u_emissive_strength:r,u_opacity:n}),r9=new Float32Array(e.bx([])),r7=(i,r,n,o,a,s,l,h,u,c,d,p,f,m=[0,0,0],g)=>{let _=a.style.light,y=_.properties.get("position"),v=[-y.x,-y.y,y.z],x=e.dx();"viewport"===_.properties.get("anchor")&&(e.dy(x,-a.transform.angle),e.dz(v,v,x));let b="MASK"===d.alphaMode,w=_.properties.get("color").toRenderColor(null),T=f.paint.get("model-ambient-occlusion-intensity"),S=f.paint.get("model-color").constantOr(e.am.white).toRenderColor(null),E=f.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:i,u_lighting_matrix:r,u_normal_matrix:n,u_node_matrix:o||r9,u_lightpos:v,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[w.r,w.g,w.b],u_camera_pos:m,u_opacity:s,u_baseTextureIsAlpha:0,u_alphaMask:+b,u_alphaCutoff:d.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[h[0],h[1],h[2],1],u_metallicFactor:u,u_roughnessFactor:c,u_baseColorTexture:it.BaseColor,u_metallicRoughnessTexture:it.MetallicRoughness,u_normalTexture:it.Normal,u_occlusionTexture:it.Occlusion,u_emissionTexture:it.Emission,u_lutTexture:it.LUT,u_color_mix:[S.r,S.g,S.b,E],u_aoIntensity:T,u_emissive_strength:p,u_occlusionTextureTransform:g||[0,0,0,0]}},ne=(e,i=r9,r=r9)=>({u_matrix:e,u_instance:i,u_node_matrix:r}),nt={fillExtrusion:i=>({u_matrix:new e.c8(i),u_lightpos:new e.ca(i),u_lightintensity:new e.cb(i),u_lightcolor:new e.ca(i),u_vertical_gradient:new e.cb(i),u_opacity:new e.cb(i),u_edge_radius:new e.cb(i),u_width_scale:new e.cb(i),u_ao:new e.c9(i),u_height_type:new e.cc(i),u_base_type:new e.cc(i),u_tile_id:new e.ca(i),u_zoom_transition:new e.cb(i),u_inv_rot_matrix:new e.c8(i),u_merc_center:new e.c9(i),u_up_dir:new e.ca(i),u_height_lift:new e.cb(i),u_flood_light_color:new e.ca(i),u_vertical_scale:new e.cb(i),u_flood_light_intensity:new e.cb(i),u_ground_shadow_factor:new e.ca(i)}),fillExtrusionDepth:i=>({u_matrix:new e.c8(i),u_edge_radius:new e.cb(i),u_width_scale:new e.cb(i),u_vertical_scale:new e.cb(i),u_height_type:new e.cc(i),u_base_type:new e.cc(i)}),fillExtrusionPattern:i=>({u_matrix:new e.c8(i),u_lightpos:new e.ca(i),u_lightintensity:new e.cb(i),u_lightcolor:new e.ca(i),u_vertical_gradient:new e.cb(i),u_height_factor:new e.cb(i),u_edge_radius:new e.cb(i),u_width_scale:new e.cb(i),u_ao:new e.c9(i),u_height_type:new e.cc(i),u_base_type:new e.cc(i),u_tile_id:new e.ca(i),u_zoom_transition:new e.cb(i),u_inv_rot_matrix:new e.c8(i),u_merc_center:new e.c9(i),u_up_dir:new e.ca(i),u_height_lift:new e.cb(i),u_image:new e.cc(i),u_texsize:new e.c9(i),u_pixel_coord_upper:new e.c9(i),u_pixel_coord_lower:new e.c9(i),u_tile_units_to_pixels:new e.cb(i),u_opacity:new e.cb(i),u_pattern_transition:new e.cb(i)}),fillExtrusionGroundEffect:i=>({u_matrix:new e.c8(i),u_opacity:new e.cb(i),u_ao_pass:new e.cb(i),u_meter_to_tile:new e.cb(i),u_ao:new e.c9(i),u_flood_light_intensity:new e.cb(i),u_flood_light_color:new e.ca(i),u_attenuation:new e.cb(i),u_edge_radius:new e.cb(i),u_fb:new e.cc(i),u_fb_size:new e.cb(i),u_dynamic_offset:new e.cb(i)}),fill:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_ground_shadow_factor:new e.ca(i)}),fillPattern:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_image:new e.cc(i),u_texsize:new e.c9(i),u_pixel_coord_upper:new e.c9(i),u_pixel_coord_lower:new e.c9(i),u_tile_units_to_pixels:new e.cb(i),u_ground_shadow_factor:new e.ca(i),u_pattern_transition:new e.cb(i)}),fillOutline:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_world:new e.c9(i),u_ground_shadow_factor:new e.ca(i)}),fillOutlinePattern:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_world:new e.c9(i),u_image:new e.cc(i),u_texsize:new e.c9(i),u_pixel_coord_upper:new e.c9(i),u_pixel_coord_lower:new e.c9(i),u_tile_units_to_pixels:new e.cb(i),u_ground_shadow_factor:new e.ca(i),u_pattern_transition:new e.cb(i)}),building:i=>({u_matrix:new e.c8(i),u_normal_matrix:new e.c8(i),u_opacity:new e.cb(i)}),buildingDepth:i=>({u_matrix:new e.c8(i)}),elevatedStructuresDepth:i=>({u_matrix:new e.c8(i),u_depth_bias:new e.cb(i)}),elevatedStructures:i=>({u_matrix:new e.c8(i),u_ground_shadow_factor:new e.ca(i)}),elevatedStructuresDepthReconstruct:i=>({u_matrix:new e.c8(i),u_camera_pos:new e.ca(i),u_depth_bias:new e.cb(i),u_height_scale:new e.cb(i),u_reset_depth:new e.cb(i)}),circle:e.dF,collisionBox:i=>({u_matrix:new e.c8(i),u_camera_to_center_distance:new e.cb(i),u_extrude_scale:new e.c9(i)}),collisionCircle:i=>({u_matrix:new e.c8(i),u_inv_matrix:new e.c8(i),u_camera_to_center_distance:new e.cb(i),u_viewport_size:new e.c9(i)}),debug:i=>({u_color:new e.di(i),u_matrix:new e.c8(i),u_overlay:new e.cc(i),u_overlay_scale:new e.cb(i)}),clippingMask:i=>({u_matrix:new e.c8(i)}),heatmap:i=>({u_extrude_scale:new e.cb(i),u_intensity:new e.cb(i),u_matrix:new e.c8(i),u_inv_rot_matrix:new e.c8(i),u_merc_center:new e.c9(i),u_tile_id:new e.ca(i),u_zoom_transition:new e.cb(i),u_up_dir:new e.ca(i)}),heatmapTexture:i=>({u_image:new e.cc(i),u_color_ramp:new e.cc(i),u_opacity:new e.cb(i)}),hillshade:i=>({u_matrix:new e.c8(i),u_image:new e.cc(i),u_latrange:new e.c9(i),u_light:new e.c9(i),u_shadow:new e.di(i),u_highlight:new e.di(i),u_emissive_strength:new e.cb(i),u_accent:new e.di(i)}),hillshadePrepare:i=>({u_matrix:new e.c8(i),u_image:new e.cc(i),u_dimension:new e.c9(i),u_zoom:new e.cb(i)}),line:e.dG,linePattern:e.dH,raster:i=>({u_matrix:new e.c8(i),u_normalize_matrix:new e.c8(i),u_globe_matrix:new e.c8(i),u_merc_matrix:new e.c8(i),u_grid_matrix:new e.dj(i),u_tl_parent:new e.c9(i),u_scale_parent:new e.cb(i),u_fade_t:new e.cb(i),u_opacity:new e.cb(i),u_image0:new e.cc(i),u_image1:new e.cc(i),u_brightness_low:new e.cb(i),u_brightness_high:new e.cb(i),u_saturation_factor:new e.cb(i),u_contrast_factor:new e.cb(i),u_spin_weights:new e.ca(i),u_perspective_transform:new e.c9(i),u_raster_elevation:new e.cb(i),u_zoom_transition:new e.cb(i),u_merc_center:new e.c9(i),u_cutoff_params:new e.cQ(i),u_colorization_mix:new e.cQ(i),u_colorization_offset:new e.cb(i),u_color_ramp:new e.cc(i),u_texture_offset:new e.c9(i),u_texture_res:new e.c9(i),u_emissive_strength:new e.cb(i)}),rasterParticle:i=>({u_matrix:new e.c8(i),u_normalize_matrix:new e.c8(i),u_globe_matrix:new e.c8(i),u_merc_matrix:new e.c8(i),u_grid_matrix:new e.dj(i),u_tl_parent:new e.c9(i),u_scale_parent:new e.cb(i),u_fade_t:new e.cb(i),u_opacity:new e.cb(i),u_image0:new e.cc(i),u_image1:new e.cc(i),u_raster_elevation:new e.cb(i),u_zoom_transition:new e.cb(i),u_merc_center:new e.c9(i),u_cutoff_params:new e.cQ(i)}),rasterParticleTexture:i=>({u_texture:new e.cc(i),u_opacity:new e.cb(i)}),rasterParticleDraw:i=>({u_particle_texture:new e.cc(i),u_particle_texture_side_len:new e.cb(i),u_tile_offset:new e.c9(i),u_velocity:new e.cc(i),u_color_ramp:new e.cc(i),u_velocity_res:new e.c9(i),u_max_speed:new e.cb(i),u_uv_offset:new e.c9(i),u_data_scale:new e.c9(i),u_data_offset:new e.cb(i),u_particle_pos_scale:new e.cb(i),u_particle_pos_offset:new e.c9(i)}),rasterParticleUpdate:i=>({u_particle_texture:new e.cc(i),u_particle_texture_side_len:new e.cb(i),u_velocity:new e.cc(i),u_velocity_res:new e.c9(i),u_max_speed:new e.cb(i),u_speed_factor:new e.cb(i),u_reset_rate:new e.cb(i),u_rand_seed:new e.cb(i),u_uv_offset:new e.c9(i),u_data_scale:new e.c9(i),u_data_offset:new e.cb(i),u_particle_pos_scale:new e.cb(i),u_particle_pos_offset:new e.c9(i)}),symbol:i=>({u_is_size_zoom_constant:new e.cc(i),u_is_size_feature_constant:new e.cc(i),u_size_t:new e.cb(i),u_size:new e.cb(i),u_camera_to_center_distance:new e.cb(i),u_rotate_symbol:new e.cc(i),u_aspect_ratio:new e.cb(i),u_fade_change:new e.cb(i),u_matrix:new e.c8(i),u_label_plane_matrix:new e.c8(i),u_coord_matrix:new e.c8(i),u_is_text:new e.cc(i),u_elevation_from_sea:new e.cc(i),u_pitch_with_map:new e.cc(i),u_texsize:new e.c9(i),u_texsize_icon:new e.c9(i),u_texture:new e.cc(i),u_texture_icon:new e.cc(i),u_gamma_scale:new e.cb(i),u_device_pixel_ratio:new e.cb(i),u_tile_id:new e.ca(i),u_zoom_transition:new e.cb(i),u_inv_rot_matrix:new e.c8(i),u_merc_center:new e.c9(i),u_camera_forward:new e.ca(i),u_tile_matrix:new e.c8(i),u_up_vector:new e.ca(i),u_ecef_origin:new e.ca(i),u_is_halo:new e.cc(i),u_icon_transition:new e.cb(i),u_color_adj_mat:new e.c8(i),u_scale_factor:new e.cb(i),u_ground_shadow_factor:new e.ca(i),u_inv_matrix:new e.c8(i)}),background:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_opacity:new e.cb(i),u_color:new e.di(i)}),backgroundPattern:i=>({u_matrix:new e.c8(i),u_emissive_strength:new e.cb(i),u_opacity:new e.cb(i),u_image:new e.cc(i),u_pattern_tl:new e.c9(i),u_pattern_br:new e.c9(i),u_texsize:new e.c9(i),u_pattern_size:new e.c9(i),u_pixel_coord_upper:new e.c9(i),u_pixel_coord_lower:new e.c9(i),u_pattern_units_to_pixels:new e.c9(i)}),terrainRaster:i=>({u_matrix:new e.c8(i),u_image0:new e.cc(i),u_skirt_height:new e.cb(i),u_ground_shadow_factor:new e.ca(i)}),skybox:i=>({u_matrix:new e.c8(i),u_sun_direction:new e.ca(i),u_cubemap:new e.cc(i),u_opacity:new e.cb(i),u_temporal_offset:new e.cb(i)}),skyboxGradient:i=>({u_matrix:new e.c8(i),u_color_ramp:new e.cc(i),u_center_direction:new e.ca(i),u_radius:new e.cb(i),u_opacity:new e.cb(i),u_temporal_offset:new e.cb(i)}),skyboxCapture:i=>({u_matrix_3f:new e.dj(i),u_sun_direction:new e.ca(i),u_sun_intensity:new e.cb(i),u_color_tint_r:new e.cQ(i),u_color_tint_m:new e.cQ(i),u_luminance:new e.cb(i)}),globeRaster:i=>({u_proj_matrix:new e.c8(i),u_globe_matrix:new e.c8(i),u_normalize_matrix:new e.c8(i),u_merc_matrix:new e.c8(i),u_zoom_transition:new e.cb(i),u_merc_center:new e.c9(i),u_image0:new e.cc(i),u_grid_matrix:new e.dj(i),u_skirt_height:new e.cb(i),u_far_z_cutoff:new e.cb(i),u_frustum_tl:new e.ca(i),u_frustum_tr:new e.ca(i),u_frustum_br:new e.ca(i),u_frustum_bl:new e.ca(i),u_globe_pos:new e.ca(i),u_globe_radius:new e.cb(i),u_viewport:new e.c9(i)}),globeAtmosphere:i=>({u_frustum_tl:new e.ca(i),u_frustum_tr:new e.ca(i),u_frustum_br:new e.ca(i),u_frustum_bl:new e.ca(i),u_horizon:new e.cb(i),u_transition:new e.cb(i),u_fadeout_range:new e.cb(i),u_color:new e.cQ(i),u_high_color:new e.cQ(i),u_space_color:new e.cQ(i),u_temporal_offset:new e.cb(i),u_horizon_angle:new e.cb(i)}),model:i=>({u_matrix:new e.c8(i),u_lighting_matrix:new e.c8(i),u_normal_matrix:new e.c8(i),u_node_matrix:new e.c8(i),u_lightpos:new e.ca(i),u_lightintensity:new e.cb(i),u_lightcolor:new e.ca(i),u_camera_pos:new e.ca(i),u_opacity:new e.cb(i),u_baseColorFactor:new e.cQ(i),u_emissiveFactor:new e.cQ(i),u_metallicFactor:new e.cb(i),u_roughnessFactor:new e.cb(i),u_baseTextureIsAlpha:new e.cc(i),u_alphaMask:new e.cc(i),u_alphaCutoff:new e.cb(i),u_baseColorTexture:new e.cc(i),u_metallicRoughnessTexture:new e.cc(i),u_normalTexture:new e.cc(i),u_occlusionTexture:new e.cc(i),u_emissionTexture:new e.cc(i),u_lutTexture:new e.cc(i),u_color_mix:new e.cQ(i),u_aoIntensity:new e.cb(i),u_emissive_strength:new e.cb(i),u_occlusionTextureTransform:new e.cQ(i)}),modelDepth:i=>({u_matrix:new e.c8(i),u_instance:new e.c8(i),u_node_matrix:new e.c8(i)}),groundShadow:i=>({u_matrix:new e.c8(i),u_ground_shadow_factor:new e.ca(i)}),stars:i=>({u_matrix:new e.c8(i),u_up:new e.ca(i),u_right:new e.ca(i),u_intensity_multiplier:new e.cb(i)}),snowParticle:i=>({u_modelview:new e.c8(i),u_projection:new e.c8(i),u_time:new e.cb(i),u_cam_pos:new e.ca(i),u_velocityConeAperture:new e.cb(i),u_velocity:new e.cb(i),u_horizontalOscillationRadius:new e.cb(i),u_horizontalOscillationRate:new e.cb(i),u_boxSize:new e.cb(i),u_billboardSize:new e.cb(i),u_simpleShapeParameters:new e.c9(i),u_screenSize:new e.c9(i),u_thinningCenterPos:new e.c9(i),u_thinningShape:new e.ca(i),u_thinningAffectedRatio:new e.cb(i),u_thinningParticleOffset:new e.cb(i),u_particleColor:new e.cQ(i),u_direction:new e.ca(i)}),rainParticle:i=>({u_modelview:new e.c8(i),u_projection:new e.c8(i),u_time:new e.cb(i),u_cam_pos:new e.ca(i),u_texScreen:new e.cc(i),u_velocityConeAperture:new e.cb(i),u_velocity:new e.cb(i),u_boxSize:new e.cb(i),u_rainDropletSize:new e.c9(i),u_distortionStrength:new e.cb(i),u_rainDirection:new e.ca(i),u_color:new e.cQ(i),u_screenSize:new e.c9(i),u_thinningCenterPos:new e.c9(i),u_thinningShape:new e.ca(i),u_thinningAffectedRatio:new e.cb(i),u_thinningParticleOffset:new e.cb(i),u_shapeDirectionalPower:new e.cb(i),u_shapeNormalPower:new e.cb(i),u_mode:new e.cb(i)}),vignette:i=>({u_vignetteShape:new e.ca(i),u_vignetteColor:new e.cQ(i)}),occlusion:i=>({u_matrix:new e.c8(i),u_anchorPos:new e.ca(i),u_screenSizePx:new e.c9(i),u_occluderSizePx:new e.c9(i),u_color:new e.cQ(i)})};class ni{constructor(e,i,r,n){this.id=ni.uniqueIdxCounter,ni.uniqueIdxCounter++,this.context=e;let o=e.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||n||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=ni.uniqueIdxCounter,ni.uniqueIdxCounter++;let i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ni.uniqueIdxCounter=0;let nr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nn{constructor(e,i,r,n,o,a){this.length=i.length,this.attributes=r,this.itemSize=i.bytesPerElement,this.dynamicDraw=n,this.instanceCount=a,this.context=e;let s=e.gl;this.buffer=s.createBuffer(),e.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||o||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let r=0;r<this.attributes.length;r++){let n=i.attributes[this.attributes[r].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,i,r){for(let n=0;n<this.attributes.length;n++){let o=this.attributes[n],a=i.attributes[o.name];void 0!==a&&e.vertexAttribPointer(a,o.components,e[nr[o.type]],!1,this.itemSize,o.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,i,r){for(let n=0;n<this.attributes.length;n++){let o=i.attributes[this.attributes[n].name];void 0!==o&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(o,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class no{constructor(e,i,r,n,o){this.context=e,this.width=i,this.height=r;let a=this.framebuffer=e.gl.createFramebuffer();n&&(this.colorAttachment=new r_(e,a)),o&&(this.depthAttachmentType=o,this.depthAttachment="renderbuffer"===o?new ry(e,a):new rv(e,a))}destroy(){let e=this.context.gl;if(this.colorAttachment){let i=this.colorAttachment.get();i&&e.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){let i=this.depthAttachment.get();i&&e.deleteRenderbuffer(i)}else{let i=this.depthAttachment.get();i&&e.deleteTexture(i)}e.deleteFramebuffer(this.framebuffer)}}class na{constructor(e,i){this.gl=e,this.clearColor=new iX(this),this.clearDepth=new iY(this),this.clearStencil=new iK(this),this.colorMask=new iJ(this),this.depthMask=new iQ(this),this.stencilMask=new i0(this),this.stencilFunc=new i1(this),this.stencilOp=new i2(this),this.stencilTest=new i3(this),this.depthRange=new i5(this),this.depthTest=new i4(this),this.depthFunc=new i6(this),this.blend=new i8(this),this.blendFunc=new i9(this),this.blendColor=new i7(this),this.blendEquation=new re(this),this.cullFace=new rt(this),this.cullFaceSide=new ri(this),this.frontFace=new rr(this),this.program=new rn(this),this.activeTexture=new ro(this),this.viewport=new ra(this),this.bindFramebuffer=new rs(this),this.bindRenderbuffer=new rl(this),this.bindTexture=new rh(this),this.bindVertexBuffer=new ru(this),this.bindElementBuffer=new rc(this),this.bindVertexArrayOES=new rd(this),this.pixelStoreUnpack=new rp(this),this.pixelStoreUnpackPremultiplyAlpha=new rf(this),this.pixelStoreUnpackFlipY=new rm(this),this.options=i?Object.assign({},i):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=i&&!!i.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i,r){return new ni(this,e,i,r)}createVertexBuffer(e,i,r,n,o){return new nn(this,e,i,r,n,o)}createRenderbuffer(e,i,r){let n=this.gl,o=n.createRenderbuffer();return this.bindRenderbuffer.set(o),n.renderbufferStorage(n.RENDERBUFFER,e,i,r),this.bindRenderbuffer.set(null),o}createFramebuffer(e,i,r,n){return new no(this,e,i,r,n)}clear({color:e,depth:i,stencil:r,colorMask:n}){let o=this.gl,a=0;e&&(a|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==i&&(a|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),void 0!==r&&(a|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),o.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){e.bv(i.blendFunction,t2.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}function ns(i,r,o,a,s,l,h){let u=i.context,c=u.gl,d=i.transform,p=i.getOrCreateProgram("collisionBox"),f=[],m=0,g=0;for(let n=0;n<a.length;n++){let u=a[n],_=r.getTile(u),y=_.getBucket(o);if(!y)continue;let v=function(e,i,r){if(i.projection.name===r.projection.name)return e.projMatrix;let n=r.clone();return n.setProjection(i.projection),tD(n,i.getProjection(),e)}(u,y,d),x=v;0===s[0]&&0===s[1]||(x=i.translatePosMatrix(v,_,s,l));let b=h?y.textCollisionBox:y.iconCollisionBox,w=y.collisionCircleArray;if(w.length>0){let i=e.bz(),r=x;e.cB(i,y.placementInvProjMatrix,d.glCoordMatrix),e.cB(i,i,y.placementViewportMatrix),f.push({circleArray:w,circleOffset:g,transform:r,invTransform:i,projection:y.getProjection()}),m+=w.length/4,g=m}b&&(i.terrain&&i.terrain.setupElevationDraw(_,p),p.draw(i,c.LINES,t3.disabled,t5.disabled,i.colorModeForRenderPass(),t4.disabled,rW(x,d,_,y.getProjection()),o.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,d.zoom,null,[b.collisionVertexBuffer,b.collisionVertexBufferExt]))}if(!h||!f.length)return;let _=i.getOrCreateProgram("collisionCircle"),y=new e.dI;y.resize(4*m),y._trim();let v=0;for(let e of f)for(let i=0;i<e.circleArray.length/4;i++){let r=4*i,n=e.circleArray[r+0],o=e.circleArray[r+1],a=e.circleArray[r+2],s=e.circleArray[r+3];y.emplace(v++,n,o,a,s,0),y.emplace(v++,n,o,a,s,1),y.emplace(v++,n,o,a,s,2),y.emplace(v++,n,o,a,s,3)}(!n||n.length<2*m)&&(n=function(i){let r=2*i,n=new e.a_;n.resize(r),n._trim();for(let e=0;e<r;e++){let i=6*e;n.uint16[i+0]=4*e+0,n.uint16[i+1]=4*e+1,n.uint16[i+2]=4*e+2,n.uint16[i+3]=4*e+2,n.uint16[i+4]=4*e+3,n.uint16[i+5]=4*e+0}return n}(m));let x=u.createIndexBuffer(n,!0),b=u.createVertexBuffer(y,e.dJ.members,!0);for(let r of f){let n={u_matrix:r.transform,u_inv_matrix:r.invTransform,u_camera_to_center_distance:d.getCameraToCenterDistance(r.projection),u_viewport_size:[d.width,d.height]};_.draw(i,c.TRIANGLES,t3.disabled,t5.disabled,i.colorModeForRenderPass(),t4.disabled,n,o.id,b,x,e.bd.simpleSegment(0,2*r.circleOffset,r.circleArray.length,r.circleArray.length/2),null,d.zoom)}b.destroy(),x.destroy()}let nl=e.bz();function nh(i){let r=i._camera.getWorldToCamera(i.worldSize,1),n=e.az([],r,i.globeMatrix);e.bi(n,n);let o=[0,0,0],a=[0,1,0,0];return e.aA(a,a,n),o[0]=a[0],o[1]=a[1],o[2]=a[2],e.au(o,o),o}function nu(i,r,n,o,a,s,l={}){let h=n.paint.get("icon-translate"),u=n.paint.get("text-translate"),c=n.paint.get("icon-translate-anchor"),d=n.paint.get("text-translate-anchor"),p=n.layout.get("icon-rotation-alignment"),f=n.layout.get("text-rotation-alignment"),m=n.layout.get("icon-pitch-alignment"),g=n.layout.get("text-pitch-alignment"),_=n.layout.get("icon-keep-upright"),y=n.layout.get("text-keep-upright"),v=n.paint.get("icon-color-saturation"),x=n.paint.get("icon-color-contrast"),b=n.paint.get("icon-color-brightness-min"),w=n.paint.get("icon-color-brightness-max"),T="sea"===n.layout.get("symbol-elevation-reference"),S=i.context,E=S.gl,I=i.transform,C="map"===p,A="map"===f,R="map"===m,M="map"===g,P=void 0!==n.layout.get("symbol-sort-key").constantOr(1),O=!1,k=i.depthModeForSublayer(0,t3.ReadOnly),L=new t3(i.context.gl.LEQUAL,t3.ReadOnly,i.depthRangeFor3D),D=[e.ay(I.center.lng),e.aH(I.center.lat)],z=n.layout.get("text-variable-anchor"),F="globe"===I.projection.name,B=[],N=[0,-1,0];for(let a of o){let o=r.getTile(a),s=o.getBucket(n);if(!s||"mercator"===s.projection.name&&F||s.fullyClipped)continue;let p="globe"===s.projection.name,f=p?e.ah(I.zoom):0,m=tz(a,s.getProjection(),I),g=I.calculatePixelsToTileUnitsMatrix(o),S=z&&s.hasTextData(),j=s.hasIconTextFit()&&S&&s.hasIconData(),V="road"===s.elevationType?L:k,U=s.getProjection().createInversionMatrix(I,a.canonical),G=i.shadowRenderer,q="road"===s.elevationType&&!!G&&G.enabled,$=[0,0,0];if(q){let e=i.style.directionalLight,r=i.style.ambientLight;e&&r&&($=id(i.style,e,r))}let H=e=>{I.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||i.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},Z=()=>{let r=C&&"point"!==n.layout.get("symbol-placement"),l=[];H(l);let u=r||j,d=n.paint.get("icon-image-cross-fade");i.terrainRenderModeElevated()&&R&&l.push("PITCH_WITH_MAP_TERRAIN"),p&&(l.push("PROJECTION_GLOBE_VIEW"),u&&l.push("PROJECTED_POS_ON_VIEWPORT")),d>0&&l.push("ICON_TRANSITION"),s.icon.zOffsetVertexBuffer&&l.push("Z_OFFSET"),0===v&&0===x&&0===b&&1===w||l.push("COLOR_ADJUSTMENT"),s.sdfIcons&&l.push("RENDER_SDF"),q&&l.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let y=s.icon.programConfigurations.get(n.id),S=i.getOrCreateProgram("symbol",{config:y,defines:l}),A=o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],M=s.iconSizeData,P=e.bH(M,I.zoom),O=R||0!==I.pitch,k=tx(m,o.tileID.canonical,R,C,I,s.getProjection(),g),L=tw(m,o.tileID.canonical,R,C,I,s.getProjection(),g),z=i.translatePosMatrix(L,o,h,c,!0),B=i.translatePosMatrix(m,o,h,c),G=u?nl:k,Z=C&&!R&&!r,W=N;(F||I.mercatorFromTransition)&&!C&&(W=nh(I));let X=p?W:N,Y=n.getColorAdjustmentMatrix(v,x,b,w),K=r4(M.kind,P,Z,R,i,B,G,z,T,!1,A,[0,0],!0,a,f,D,U,X,s.getProjection(),$,Y,d),J=o.imageAtlasTexture?o.imageAtlasTexture:null,Q=1!==n.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,ee=s.sdfIcons||i.options.rotating||i.options.zooming||Q||O?E.LINEAR:E.NEAREST,et=s.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),ei=i.terrain&&R&&r?e.bi(e.bz(),k):nl;if(r&&s.icon){let e=I.elevation,r=e?e.getAtTileOffsetFunc(a,I.center.lat,I.worldSize,s.getProjection()):null,n=tb(m,o.tileID.canonical,R,C,I,s.getProjection(),g);tE(s,m,i,!1,n,L,R,_,r,a)}return{program:S,buffers:s.icon,uniformValues:K,atlasTexture:J,atlasTextureIcon:null,atlasInterpolation:ee,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:et,depthMode:V,tile:o,renderWithShadows:q,labelPlaneMatrixInv:ei}},W=()=>{let r=A&&"point"!==n.layout.get("symbol-placement"),l=[],h=r||z||j;i.terrainRenderModeElevated()&&M&&l.push("PITCH_WITH_MAP_TERRAIN"),p&&(l.push("PROJECTION_GLOBE_VIEW"),h&&l.push("PROJECTED_POS_ON_VIEWPORT")),s.text.zOffsetVertexBuffer&&l.push("Z_OFFSET"),s.iconsInText&&l.push("RENDER_TEXT_AND_SYMBOL"),l.push("RENDER_SDF"),q&&l.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),H(l);let c=s.text.programConfigurations.get(n.id),_=i.getOrCreateProgram("symbol",{config:c,defines:l}),v,x=[0,0],b=null,w=s.textSizeData;s.iconsInText&&(x=o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],b=o.imageAtlasTexture?o.imageAtlasTexture:null,v=M||0!==I.pitch||i.options.rotating||i.options.zooming||"composite"===w.kind||"camera"===w.kind?E.LINEAR:E.NEAREST);let S=o.glyphAtlasTexture?o.glyphAtlasTexture.size:[0,0],C=n.layout.get("text-size-scale-range"),R=e.aD(i.scaleFactor,C[0],C[1]),P=e.bH(w,I.zoom,R),O=tx(m,o.tileID.canonical,M,A,I,s.getProjection(),g),k=tw(m,o.tileID.canonical,M,A,I,s.getProjection(),g),L=i.translatePosMatrix(k,o,u,d,!0),B=i.translatePosMatrix(m,o,u,d),G=h?nl:O,Z=A&&!M&&!r,W=N;(F||I.mercatorFromTransition)&&!A&&(W=nh(I));let X=r4(w.kind,P,Z,M,i,B,G,L,T,!0,S,x,!0,a,f,D,U,p?W:N,s.getProjection(),$,null,null,R),Y=o.glyphAtlasTexture?o.glyphAtlasTexture:null,K=E.LINEAR,J=0!==n.paint.get("text-halo-width").constantOr(1),Q=i.terrain&&M&&r?e.bi(e.bz(),O):nl;if(r&&s.text){let e=I.elevation,r=e?e.getAtTileOffsetFunc(a,I.center.lat,I.worldSize,s.getProjection()):null,n=tb(m,o.tileID.canonical,M,A,I,s.getProjection(),g);tE(s,m,i,!0,n,k,M,y,r,a)}return{program:_,buffers:s.text,uniformValues:X,atlasTexture:Y,atlasTextureIcon:b,atlasInterpolation:K,atlasInterpolationIcon:v,isSDF:!0,hasHalo:J,depthMode:V,tile:o,renderWithShadows:q,labelPlaneMatrixInv:Q}},X=s.icon.segments.get().length,Y=s.text.segments.get().length,K=X&&!l.onlyText?Z():null,J=Y&&!l.onlyIcons?W():null,Q=n.paint.get("icon-opacity").constantOr(1),ee=n.paint.get("text-opacity").constantOr(1);if(P&&s.canOverlap){O=!0;let i=Q&&!l.onlyText?s.icon.segments.get():[],r=ee&&!l.onlyIcons?s.text.segments.get():[];for(let r of i)B.push({segments:new e.bd([r]),sortKey:r.sortKey,state:K});for(let i of r)B.push({segments:new e.bd([i]),sortKey:i.sortKey,state:J})}else l.onlyText||B.push({segments:Q?s.icon.segments:new e.bd([]),sortKey:0,state:K}),l.onlyIcons||B.push({segments:ee?s.text.segments:new e.bd([]),sortKey:0,state:J})}for(let e of(O&&B.sort((e,i)=>e.sortKey-i.sortKey),B)){let r=e.state;if(r)if(i.terrain?i.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:I.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}):i.setupDepthForOcclusion(I.depthOcclusionForSymbolsAndCircles,r.program),S.activeTexture.set(E.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,E.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(S.activeTexture.set(E.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,E.CLAMP_TO_EDGE,!0)),r.renderWithShadows&&i.shadowRenderer.setupShadows(r.tile.tileID.toUnwrapped(),r.program,"vector-tile",r.tile.tileID.overscaledZ),i.uploadCommonLightUniforms(i.context,r.program),r.hasHalo){let o=r.uniformValues;o.u_is_halo=1,nc(r.buffers,e.segments,n,i,r.program,r.depthMode,a,s,o,2),o.u_is_halo=0}else{if(r.isSDF){let o=r.uniformValues;r.hasHalo&&(o.u_is_halo=1,nc(r.buffers,e.segments,n,i,r.program,r.depthMode,a,s,o,1)),o.u_is_halo=0}nc(r.buffers,e.segments,n,i,r.program,r.depthMode,a,s,r.uniformValues,1)}}}function nc(e,i,r,n,o,a,s,l,h,u){let c=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];o.draw(n,n.context.gl.TRIANGLES,a,s,l,t4.disabled,h,r.id,e.layoutVertexBuffer,e.indexBuffer,i,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),c,u)}function nd(i,r,n,o,a){if(!n.layout||"none"===n.layout.get("fill-elevation-reference"))return;let s=i.context.gl,l=new t3(i.context.gl.LEQUAL,t3.ReadWrite,i.depthRangeFor3D),h=new t3(i.context.gl.GREATER,t3.ReadWrite,i.depthRangeFor3D),u=function(i){let r=e.cJ(i.pitch),n=.01;return i.isOrthographic&&(n=e.ai(1e-4,n,e.cO(r>=15?1:r/15))),2*n}(i.transform),c=i.transform.getFreeCameraOptions().position,d="elevatedStructuresDepthReconstruct",p=i.getOrCreateProgram(d,{defines:["DEPTH_RECONSTRUCTION"]}),f=i.getOrCreateProgram(d);for(let d of o){let o,m,g,_,y=r.getTile(d),v=y.getBucket(n);if(!v)continue;let x=v.elevatedStructures;if(!x)continue;let b=v.elevationBufferData.heightRange,w=function(i,r){let n=1<<i.canonical.z,o=(r.x*n-i.canonical.x-i.wrap*n)*e.aj,a=(r.y*n-i.canonical.y)*e.aj,s=e.dS(r.z,r.y);return e.cS(o,a,s)}(d.toUnwrapped(),c),T=i.translatePosMatrix(d.projMatrix,y,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if("initialize"===a){if(!b||b.min>=1||0===x.depthSegments.segments[0].primitiveLength)continue;o=rZ(T,w,u,1,0),m=l,g=x.depthSegments,_=p}else if("reset"===a){if(!b||b.min>=0||0===x.maskSegments.segments[0].primitiveLength)continue;o=rZ(T,w,0,0,1),m=h,g=x.maskSegments,_=p}else if("geometry"===a){if(0===x.depthSegments.segments[0].primitiveLength)continue;o=rZ(T,w,u,1,0),m=l,g=x.depthSegments,_=f}_.draw(i,s.TRIANGLES,m,t5.disabled,t2.disabled,t4.disabled,o,n.id,x.vertexBuffer,x.indexBuffer,g,n.paint,i.transform.zoom)}}function np(i,r,n){let{painter:o,sourceCache:a,layer:s,coords:l,colorMode:h,elevationType:u,terrainEnabled:c,pass:d}=i,p=o.context.gl,f=s.paint.get("fill-pattern"),m=s.paint.get("fill-pattern-cross-fade"),g=f.constantOr(null),_=u;"road"!==u||r&&!c||(_="none");let y="road"===_,v=i.painter.shadowRenderer,x=y&&!!v&&v.enabled,b=new t3(o.context.gl.LEQUAL,t3.ReadOnly,o.depthRangeFor3D),w=[0,0,0];if(x){let e=o.style.directionalLight,i=o.style.ambientLight;e&&i&&(w=id(o.style,e,i))}let T=f&&f.constantOr(1),S=(i,d)=>{let f,_,S,E,I;for(let C of(d?(f=T&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",S=p.LINES):(f=T?"fillPattern":"fill",S=p.TRIANGLES),l)){let l=a.getTile(C);if(T&&!l.patternsLoaded())continue;let A=l.getBucket(s);if(!A)continue;let R=r?A.elevationBufferData:A.bufferData;if(R.isEmpty())continue;o.prepareDrawTile();let M=R.programConfigurations.get(s.id),P=o.isTileAffectedByFog(C),O=[],k=[];y&&(O.push("ELEVATED_ROADS"),k.push(R.elevatedLayoutVertexBuffer)),x&&O.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),T&&(o.context.activeTexture.set(p.TEXTURE0),l.imageAtlasTexture&&l.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),M.updatePaintBuffers());let L=!1;if(g&&l.imageAtlas){let i=l.imageAtlas,r=e.dN.from(g),n=r.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),o=r.getSecondary(),a=i.patternPositions.get(n),s=o?i.patternPositions.get(o.scaleSelf(e.q.devicePixelRatio).toString()):null;L=!!a&&!!s,a&&M.setConstantPatternPositions(a,s)}m>0&&(L||M.getPatternTransitionVertexBuffer("fill-pattern"))&&O.push("FILL_PATTERN_TRANSITION");let D=o.getOrCreateProgram(f,{config:M,overrideFog:P,defines:O}),z=o.translatePosMatrix(C.projMatrix,l,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));x&&v.setupShadows(l.tileID.toUnwrapped(),D,"vector-tile",l.tileID.overscaledZ);let F=s.paint.get("fill-emissive-strength");if(d){E=R.lineIndexBuffer,I=R.lineSegments;let e=o.terrain&&o.terrain.renderingToTexture?o.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];_="fillOutlinePattern"===f&&T?r$(z,F,o,l,e,w,m):rq(z,F,e,w)}else E=R.indexBuffer,I=R.triangleSegments,_=T?rG(z,F,o,l,w,m):rU(z,F,w);o.uploadCommonUniforms(o.context,D,C.toUnwrapped());let B=i;("road"!==u||c)&&"offset"!==u||(B=b),D.draw(o,S,B,n||o.stencilModeForClipping(C),h,t4.disabled,_,s.id,R.layoutVertexBuffer,E,I,s.paint,o.transform.zoom,M,k)}};o.renderPass===d&&S(o.depthModeForSublayer(1,"opaque"===o.renderPass?t3.ReadWrite:t3.ReadOnly),!1),"none"===_&&"translucent"===o.renderPass&&s.paint.get("fill-antialias")&&S(o.depthModeForSublayer(2*!!s.getPaintProperty("fill-outline-color"),t3.ReadOnly),!0)}function nf(i,r,n,o,a,s,l,h){let u;n.resetLayerRenderingStats(i);let c=i.context,d=c.gl,p=i.transform,f=n.paint.get("fill-extrusion-pattern"),m=n.paint.get("fill-extrusion-pattern-cross-fade"),g=f.constantOr(null),_=f.constantOr(1),y=n.paint.get("fill-extrusion-opacity"),v=i.style.enable3dLights(),x=n.paint.get(v&&!_?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),b=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),x],w=n.layout.get("fill-extrusion-edge-radius"),T=w>0&&!n.paint.get("fill-extrusion-rounded-roof"),S=T?0:w,E="globe"===p.projection.name?e.dT():0,I="globe"===p.projection.name,C=I?e.ah(p.zoom):0,A=[e.ay(p.center.lng),e.aH(p.center.lat)],R="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),M=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(R?null:n.lut).toArray01().slice(0,3),P=n.paint.get("fill-extrusion-flood-light-intensity"),O=n.paint.get("fill-extrusion-vertical-scale"),k=0!==n.paint.get("fill-extrusion-line-width").constantOr(1),L=n.paint.get("fill-extrusion-height-alignment"),D=n.paint.get("fill-extrusion-base-alignment"),z=io(i,n.paint.get("fill-extrusion-cutoff-fade-range")),F=[];I&&F.push("PROJECTION_GLOBE_VIEW"),b[0]>0&&F.push("FAUX_AO"),T&&F.push("ZERO_ROOF_RADIUS"),h&&F.push("HAS_CENTROID"),P>0&&F.push("FLOOD_LIGHT"),z.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),k&&F.push("RENDER_WALL_MODE");let B="shadow"===i.renderPass,N=i.shadowRenderer,j=B&&!!N,V=B?t4.disabled:t4.backCCW;i.shadowRenderer&&(i.shadowRenderer.useNormalOffset=!0);let U=[0,0,0];if(N){let e=i.style.directionalLight,r=i.style.ambientLight;e&&r&&(U=id(i.style,e,r)),B||(F.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&F.push("NORMAL_OFFSET")),u=F.concat(["SHADOWS_SINGLE_CASCADE"])}let G=j?"fillExtrusionDepth":_?"fillExtrusionPattern":"fillExtrusion",q=n.getLayerRenderingStats();for(let f of o){let o,v=r.getTile(f),x=v.getBucket(n);if(!x||x.projection.name!==p.projection.name)continue;let w=!1;N&&(w=0===N.getMaxCascadeForTile(f.toUnwrapped()));let T=i.isTileAffectedByFog(f),R=x.programConfigurations.get(n.id),j=!1;if(g&&v.imageAtlas){let i=v.imageAtlas,r=e.dN.from(g),n=r.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),o=r.getSecondary(),a=i.patternPositions.get(n),s=o?i.patternPositions.get(o.scaleSelf(e.q.devicePixelRatio).toString()):null;j=!!a&&!!s,a&&R.setConstantPatternPositions(a,s)}m>0&&(j||R.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&F.push("FILL_EXTRUSION_PATTERN_TRANSITION");let $=i.getOrCreateProgram(G,{config:R,defines:w?u:F,overrideFog:T});if(i.terrain&&i.terrain.setupElevationDraw(v,$,{useMeterToDem:!0}),!x.centroidVertexBuffer){let e=$.attributes.a_centroid_pos;void 0!==e&&d.vertexAttrib2f(e,0,0)}!B&&N&&N.setupShadows(v.tileID.toUnwrapped(),$,"vector-tile",v.tileID.overscaledZ),_&&(i.context.activeTexture.set(d.TEXTURE0),v.imageAtlasTexture&&v.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),R.updatePaintBuffers());let H=n.paint.get("fill-extrusion-vertical-gradient"),Z=1/x.tileToMeter;if(B&&N){if(function(i,r,n){let o=n.transform,a=n.shadowRenderer;if(!a)return!0;let s=i.toUnwrapped(),l=o.tileSize*a._cascades[n.currentShadowCascade].scale,h=r.maxHeight;if(o.elevation){let e=o.elevation.getMinMaxForTile(i);e&&(h+=e.max)}let u=[...a.shadowDirection];u[2]=-u[2];let c=a.computeSimplifiedTileShadowVolume(s,h,l,u);if(!c)return!1;let d=[ng,n_,ny,u,[u[0],0,u[2]],[0,u[1],u[2]]],p="globe"===o.projection.name,f=o.scaleZoom(l),m=e.cn.fromInvProjectionMatrix(o.invProjMatrix,o.worldSize,f,!p),g=a.getCurrentCascadeFrustum();return 0===m.intersectsPrecise(c.vertices,c.planes,d)||0===g.intersectsPrecise(c.vertices,c.planes,d)}(v.tileID,x,i))continue;o=rj(N.calculateShadowPassMatrixFromTile(v.tileID.toUnwrapped()),S,Z,O,L,D)}else{let e=i.translatePosMatrix(f.expandedProjMatrix,v,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=p.projection.createInversionMatrix(p,f.canonical);o=_?rV(e,i,H,y,b,S,Z,f,v,E,L,D,C,A,r,M,O,m):rN(e,i,H,y,b,S,Z,f,E,L,D,C,A,r,M,O,P,U)}i.uploadCommonUniforms(c,$,f.toUnwrapped(),null,z);let W=x.segments;if("mercator"===p.projection.name&&!B&&!(W=x.getVisibleSegments(v.tileID,i.terrain,i.transform.getFrustum(0))).get().length)continue;if(q)if(B)for(let e of W.get())q.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(let e of W.get())q.numRenderedVerticesInTransparentPass+=e.primitiveLength;let X=[];(i.terrain||h)&&X.push(x.centroidVertexBuffer),I&&X.push(x.layoutVertexExtBuffer),k&&X.push(x.wallVertexBuffer),$.draw(i,c.gl.TRIANGLES,a,s,l,V,o,n.id,x.layoutVertexBuffer,x.indexBuffer,W,n.paint,i.transform.zoom,R,X)}i.shadowRenderer&&(i.shadowRenderer.useNormalOffset=!1)}function nm(i,r,n,o,a,s,l,h,u,c,d,p,f,m,g,_,y,v,x){let b=i.context,w=b.gl,T=i.transform,S=i.transform.zoom,E=[],I=io(i,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===c?(E.push("CLEAR_SUBPASS"),x&&(E.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===c&&E.push("SDF_SUBPASS"),y&&E.push("HAS_CENTROID"),I.shouldRenderCutoff&&E.push("RENDER_CUTOFF");let C=n.layout.get("fill-extrusion-edge-radius"),A=(e,r,o,c,v)=>{let w=r.programConfigurations.get(n.id),T=i.isTileAffectedByFog(e),A=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:w,defines:E,overrideFog:T}),R={u_matrix:c,u_opacity:d,u_ao_pass:+!!u,u_meter_to_tile:v,u_ao:[p,f*v],u_flood_light_intensity:m,u_flood_light_color:g,u_attenuation:_,u_edge_radius:S>=17?0:C*v,u_fb:0,u_fb_size:x?x.size[0]:0,u_dynamic_offset:1},M=[];y&&M.push(r.hiddenByLandmarkVertexBuffer),i.uploadCommonUniforms(b,A,e.toUnwrapped(),null,I),A.draw(i,b.gl.TRIANGLES,a,s,l,h,R,n.id,r.vertexBuffer,r.indexBuffer,o,n.paint,S,w,M)};for(let a of o){let o=r.getTile(a),s=o.getBucket(n);if(!s||s.projection.name!==T.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;let l=s.groundEffect,h=1/s.tileToMeter;{let e=i.translatePosMatrix(a.projMatrix,o,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=l.getDefaultSegment();A(a,l,r,e,h)}if(v)for(let s=0;s<4;s++){let l,u,c=e.dU[s](a),d=r.getTile(c);if(!d)continue;let p=d.getBucket(n);if(!p||p.projection.name!==T.projection.name||!p.groundEffect||p.groundEffect&&!p.groundEffect.hasData())continue;let f=p.groundEffect;0===s?(l=[-e.aj,0,0],u=1):1===s?(l=[e.aj,0,0],u=0):2===s?(l=[0,-e.aj,0],u=3):(l=[0,e.aj,0],u=2);let m=f.regionSegments[u];if(!m)continue;let g=new Float32Array(16);e.bo(g,a.projMatrix,l),A(a,f,m,i.translatePosMatrix(g,o,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),h)}}}let ng=[1,0,0],n_=[0,1,0],ny=[0,0,1];function nv(i){return[i[0]*e.dZ,i[1]*e.dZ,i[2]*e.dZ,0]}function nx(i,r,n,o,a,s,l,h,u){let c,d,p,f,m,g,_,y,v=o.getSource(),x=n.globeSharedBuffers;if(!x||(r&&(c=o.getTile(r)),v instanceof e.aP?(d=v.texture,p=e.ds(0,0,n.transform)):c&&r&&(d=c.texture,p=e.ds(r.canonical.z,r.canonical.x,n.transform)),!d||!p))return;i||(p=e.cE(e.bz(),p,[1,-1,1]));let b=n.context,w=b.gl,T="nearest"===a.paint.get("raster-resampling")?w.NEAREST:w.LINEAR,S=n.colorModeForDrapableLayerRenderPass(s),E=l.defines;E.push("GLOBE_POLES");let I=new t3(w.LEQUAL,t3.ReadWrite,n.depthRangeFor3D),C=Float32Array.from(n.transform.expandedFarZProjMatrix),A=Float32Array.from(e.bh(e.dr(new e.cp(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),b.activeTexture.set(w.TEXTURE0),d.bind(T,w.CLAMP_TO_EDGE),b.activeTexture.set(w.TEXTURE1),d.bind(T,w.CLAMP_TO_EDGE),"useMipmap"in d&&b.extTextureFilterAnisotropic&&n.transform.pitch>20&&w.texParameterf(w.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax);let[R,M,P,O]=r?x.getPoleBuffers(r.canonical.z,!1):x.getPoleBuffers(0,!0),k=a.paint.get("raster-elevation");i?(f=R,n.renderDefaultNorthPole=0!==k):(f=M,n.renderDefaultSouthPole=0!==k);let L=nv(l.mix),D=(m=p,g=e.ah(n.transform.zoom),_=l.offset,y=l.range,r0(C,A,m,new Float32Array(16),new Float32Array(9),[0,0],g,[0,0],[0,0,0,0],1,{opacity:1,mix:0},a,[0,0],k,2,L,_,y,1,0,s)),z=n.getOrCreateProgram("raster",{defines:E});n.uploadCommonUniforms(b,z,null),z.draw(n,w.TRIANGLES,I,u,S,h,D,a.id,f,P,O)}var nb=e.d_([{name:"a_index",type:"Int16",components:1}]);class nw{constructor(i,r,n,o){let a={width:n[0],height:n[1],data:null},s=i.gl;this.targetColorTexture=new e.T(i,a,s.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(i,a,s.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(r,o),this.lastInvalidatedAt=0}updateParticleTexture(i,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let n=this.context.gl,o=r.width*r.height;this.particleTexture0=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1});let a=new e.d$;a.reserve(o);for(let e=0;e<o;e++)a.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(a,nb.members,!0),this.particleSegment=e.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}let nT=new e.am(1,0,0,1),nS=new e.am(0,1,0,1),nE=new e.am(0,0,1,1),nI=new e.am(1,0,1,1),nC=new e.am(0,1,1,1);function nA(i,r,n,o,a,s,l){let h=i.context,u=i.transform,c=h.gl,d="globe"===u.projection.name,p=e.bw(n.projMatrix);if(d&&e.ah(u.zoom)>0){let i=e.bg(n.canonical,u),r=e.e1(i);p=e.az(new Float32Array(16),u.globeMatrix,r),e.az(p,u.projMatrix,p)}let f=e.bz();f[12]+=2*a/(e.q.devicePixelRatio*u.width),f[13]+=2*s/(e.q.devicePixelRatio*u.height),e.az(p,f,p);let m=i.getOrCreateProgram("debug",{defines:d?["PROJECTION_GLOBE_VIEW"]:[]}),g=r.getTileByID(n.key);i.terrain&&i.terrain.setupElevationDraw(g,m);let _=t3.disabled,y=t5.disabled,v=i.colorModeForRenderPass(),x="$debug";h.activeTexture.set(c.TEXTURE0),i.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),d?g._makeGlobeTileDebugBuffers(i.context,u):g._makeDebugTileBoundsBuffers(i.context,u.projection);let b=g._tileDebugBuffer||i.debugBuffer,w=g._tileDebugIndexBuffer||i.debugIndexBuffer,T=g._tileDebugSegments||i.debugSegments;if(m.draw(i,c.LINE_STRIP,_,y,v,t4.disabled,rX(p,o),x,b,w,T,null,null,null,[g._globeTileDebugBorderBuffer]),l){let e=g.latestRawTileData,r=Math.floor((e&&e.byteLength||0)/1024),o=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(o+=` => ${n.overscaledZ}`),o+=` ${g.state}`,function(e,i){e.initDebugOverlayCanvas();let r=e.debugOverlayCanvas,n=e.context.gl,o=e.debugOverlayCanvas.getContext("2d");o.clearRect(0,0,r.width,r.height),o.shadowColor="white",o.shadowBlur=2,o.lineWidth=1.5,o.strokeStyle="white",o.textBaseline="top",o.font="bold 36px Open Sans, sans-serif",o.fillText(i,5,5),o.strokeText(i,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(i,o+=` ${r}kb`)}let S=512/Math.min(r.getTile(n).tileSize,512)*(n.overscaledZ/u.zoom)*.5,E=g._tileDebugTextBuffer||i.debugBuffer,I=g._tileDebugTextIndexBuffer||i.quadTriangleIndexBuffer,C=g._tileDebugTextSegments||i.debugSegments;m.draw(i,c.TRIANGLES,_,y,t2.alphaBlended,t4.disabled,rX(p,e.am.transparent,S),x,E,I,C,null,null,null,[g._globeTileDebugTextBuffer])}function nR(e,i,r,n){nP(e,0,i+r/2,e.transform.width,r,n)}function nM(e,i,r,n){nP(e,i-r/2,0,r,e.transform.height,n)}function nP(i,r,n,o,a,s){let l=i.context,h=l.gl;h.enable(h.SCISSOR_TEST),h.scissor(r*e.q.devicePixelRatio,n*e.q.devicePixelRatio,o*e.q.devicePixelRatio,a*e.q.devicePixelRatio),l.clear({color:s}),h.disable(h.SCISSOR_TEST)}let{members:nO}=e.d_([{name:"a_pos_3f",components:3,type:"Float32"}]);function nk(e,i,r,n){e.emplaceBack(i,r,n)}class nL{constructor(i){this.vertexArray=new e.e2,this.indices=new e.a_,nk(this.vertexArray,-1,-1,1),nk(this.vertexArray,1,-1,1),nk(this.vertexArray,-1,1,1),nk(this.vertexArray,1,1,1),nk(this.vertexArray,-1,-1,-1),nk(this.vertexArray,1,-1,-1),nk(this.vertexArray,-1,1,-1),nk(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,nO),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=e.bd.simpleSegment(0,0,36,12)}}function nD(i,r,n,o,a,s){let l,h=i.context.gl,u=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),d=r.paint.get("sky-atmosphere-sun-intensity"),p=(l=e.e4(e.dx(),o),{u_matrix_3f:l,u_sun_direction:a,u_sun_intensity:d,u_color_tint_r:[u.r,u.g,u.b,u.a],u_color_tint_m:[c.r,c.g,c.b,c.a],u_luminance:5e-5});h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+s,r.skyboxTexture,0),n.draw(i,h.TRIANGLES,t3.disabled,t5.disabled,t2.unblended,t4.frontCW,p,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}let nz=e.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class nF{constructor(i){let r=new e.e5;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);let n=new e.a_;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(r,nz.members),this.indexBuffer=i.createIndexBuffer(n),this.segments=e.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let nB=e.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nN{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class nj{constructor(i){this.colorModeAlphaBlendedWriteRGB=new t2([1,771,1,771],e.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t2([1,0,1,0],e.am.transparent,[!1,!1,!1,!0]),this.params=new nN,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){let r=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new nF(r);let i=this.params.sizeRange,n=this.params.intensityRange,o=function(i){let r=e.ea(30),n=[];for(let o=0;o<i;++o){let i=2*Math.PI*r(),o=Math.acos(1-2*r())-.5*Math.PI;n.push(e.cS(Math.cos(o)*Math.cos(i),Math.cos(o)*Math.sin(i),Math.sin(o)))}return n}(this.params.starsCount),a=e.ea(300),s=new e.e6,l=new e.a_,h=0;for(let r=0;r<o.length;++r){let u=e.b$([],o[r],200),c=Math.max(0,1+.01*i*(a()-.5)),d=Math.max(0,1+.01*n*(a()-.5));s.emplaceBack(u[0],u[1],u[2],-1,-1,c,d),s.emplaceBack(u[0],u[1],u[2],1,-1,c,d),s.emplaceBack(u[0],u[1],u[2],1,1,c,d),s.emplaceBack(u[0],u[1],u[2],-1,1,c,d),l.emplaceBack(h+0,h+1,h+2),l.emplaceBack(h+0,h+2,h+3),h+=4}this.starsVx=r.createVertexBuffer(s,nB.members),this.starsIdx=r.createIndexBuffer(l),this.starsSegments=e.bd.simpleSegment(0,0,s.length,l.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,r){let n=i.context,o=n.gl,a=i.transform,s=new t3(o.LEQUAL,t3.ReadOnly,[0,1]),l=e.ah(a.zoom),h=i.style.getLut(r.scope),u="none"===r.properties.get("color-use-theme"),c=r.properties.get("color").toRenderColor(u?null:h).toArray01(),d="none"===r.properties.get("high-color-use-theme"),p=r.properties.get("high-color").toRenderColor(d?null:h).toArray01(),f="none"===r.properties.get("space-color-use-theme"),m=r.properties.get("space-color").toRenderColor(f?null:h).toArray01PremultipliedAlpha(),g=e.e7(r.properties.get("horizon-blend"),0,1,5e-4,.25),_=e.dl(i,n,a)&&5e-4===g?a.worldSize/(2*Math.PI*1.025)-1:a.globeRadius,y=i.frameCounter/1e3%1,v=e.ae(a.globeCenterInViewSpace),x=Math.acos(Math.sqrt(Math.pow(v,2)-Math.pow(_,2))/v),b=e=>{let r,h,u,d,f="globe"===a.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&f.push("ALPHA_PASS");let _=i.getOrCreateProgram("globeAtmosphere",{defines:f}),v=(r=a.frustumCorners.TL,h=a.frustumCorners.TR,u=a.frustumCorners.BR,d=a.frustumCorners.BL,{u_frustum_tl:r,u_frustum_tr:h,u_frustum_br:u,u_frustum_bl:d,u_horizon:a.frustumCorners.horizon,u_transition:l,u_fadeout_range:g,u_color:c,u_high_color:p,u_space_color:m,u_temporal_offset:y,u_horizon_angle:x});i.uploadCommonUniforms(n,_);let b=this.atmosphereBuffer;b&&_.draw(i,o.TRIANGLES,s,t5.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t4.backCW,v,e?"atmosphere_glow_alpha":"atmosphere_glow",b.vertexBuffer,b.indexBuffer,b.segments)};b(!1),b(!0)}drawStars(i,r){let n=e.aD(r.properties.get("star-intensity"),0,1);if(0===n)return;let o=i.context,a=o.gl,s=i.transform,l=i.getOrCreateProgram("stars"),h=e.bY([]);e.b_(h,h,-s._pitch),e.bZ(h,h,-s.angle),e.b_(h,h,e.al(s._center.lat)),e.e8(h,h,-e.al(s._center.lng));let u=e.c3(new Float32Array(16),h),c=e.az([],s.starsProjMatrix,u),d=e.e4([],u),p=e.e9([],d),f=[0,1,0];e.dz(f,f,p),e.b$(f,f,this.params.sizeMultiplier);let m=[1,0,0];e.dz(m,m,p),e.b$(m,m,this.params.sizeMultiplier);let g={u_matrix:Float32Array.from(c),u_up:f,u_right:m,u_intensity_multiplier:n};i.uploadCommonUniforms(o,l),this.starsVx&&this.starsIdx&&l.draw(i,a.TRIANGLES,t3.disabled,t5.disabled,this.colorModeAlphaBlendedWriteRGB,t4.disabled,g,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function nV(i,r){let n=[...i],o=r.cameraWorldSizeForFog/r.worldSize,a=e.bx([]);return e.cE(a,a,[o,o,1]),e.az(n,a,n),e.az(n,r.worldToFogMatrix,n),n}function nU(i,r,n,o,a){let s=n.material,l=o.context,{baseColorTexture:h,metallicRoughnessTexture:u}=s.pbrMetallicRoughness,{normalTexture:c,occlusionTexture:d,emissionTexture:p}=s;function f(e,r,n){if(e&&(i.push(r),l.activeTexture.set(l.gl.TEXTURE0+n),e.gfxTexture)){let{minFilter:i,magFilter:r,wrapS:n,wrapT:o}=e.sampler;e.gfxTexture.bindExtraParam(i,r,n,o)}}f(h,"HAS_TEXTURE_u_baseColorTexture",it.BaseColor),f(u,"HAS_TEXTURE_u_metallicRoughnessTexture",it.MetallicRoughness),f(c,"HAS_TEXTURE_u_normalTexture",it.Normal),f(d,"HAS_TEXTURE_u_occlusionTexture",it.Occlusion),f(p,"HAS_TEXTURE_u_emissionTexture",it.Emission),a&&(a.texture||(a.texture=new e.ed(o.context,a.image,[a.image.height,a.image.height,a.image.height],l.gl.RGBA8)),l.activeTexture.set(l.gl.TEXTURE0+it.LUT),a.texture&&a.texture.bind(l.gl.LINEAR,l.gl.CLAMP_TO_EDGE),i.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(i.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(n.texcoordBuffer)),n.colorBuffer&&(i.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(n.colorBuffer)),n.normalBuffer&&(i.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(n.normalBuffer)),n.pbrBuffer&&(i.push("HAS_ATTRIBUTE_a_pbr"),i.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(n.pbrBuffer)),"OPAQUE"!==s.alphaMode&&"MASK"!==s.alphaMode||i.push("UNPREMULT_TEXTURE_IN_SHADER"),s.defined||i.push("DIFFUSE_SHADED");let m=o.shadowRenderer;m&&(i.push("RENDER_SHADOWS","DEPTH_TEXTURE"),m.useNormalOffset&&i.push("NORMAL_OFFSET"))}function nG(i,r,n,o,a,s){let l,h=n.paint.get("model-opacity").constantOr(1),u=r.context,c=new t3(r.context.gl.LEQUAL,t3.ReadWrite,r.depthRangeFor3D),d=r.transform,p=i.mesh,f=p.material,m=f.pbrMetallicRoughness,g=r.style.fog;l="pixels"===r.transform.projection.zAxisUnit?[...i.nodeModelMatrix]:e.az([],o.zScaleMatrix,i.nodeModelMatrix),e.az(l,o.negCameraPosMatrix,l);let _=e.bi([],l);e.ee(_,_);let y="none"===n.paint.get("model-color-use-theme").constantOr("default"),v=n.paint.get("model-emissive-strength").constantOr(0),x=r7(new Float32Array(i.worldViewProjection),new Float32Array(l),new Float32Array(_),null,r,h,m.baseColorFactor.toRenderColor(null),f.emissiveFactor,m.metallicFactor,m.roughnessFactor,f,v,n),b={defines:[]},w=[],T=r.shadowRenderer;T&&(T.useNormalOffset=!1),nU(b.defines,w,p,r,y?null:n.lut);let S=null;if(g){let e=nV(i.nodeModelMatrix,r.transform);if(S=new Float32Array(e),"globe"!==d.projection.name){let i=p.aabb.min,r=p.aabb.max,[n,o]=g.getOpacityForBounds(e,i[0],i[1],r[0],r[1]);b.overrideFog=n>=.05||o>=.05}}let E=io(r,n.paint.get("model-cutoff-fade-range"));E.shouldRenderCutoff&&b.defines.push("RENDER_CUTOFF");let I=r.getOrCreateProgram("model",b);r.uploadCommonUniforms(u,I,null,S,E),"shadow"!==r.renderPass&&T&&T.setupShadowsFromMatrix(i.nodeModelMatrix,I),I.draw(r,u.gl.TRIANGLES,c,a,s,p.material.doubleSided?t4.disabled:t4.backCCW,x,n.id,p.vertexBuffer,p.indexBuffer,p.segments,n.paint,r.transform.zoom,void 0,w)}function nq(e,i,r,n){let o=r.shadowRenderer;if(!o)return;let a=o.getShadowPassDepthMode(),s=o.getShadowPassColorMode(),l=ne(o.calculateShadowPassMatrixFromMatrix(i));r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,a,t5.disabled,s,t4.backCCW,l,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,r.transform.zoom,void 0,void 0)}let n$={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.cV([0,0,0],[e.aj,e.aj,0])},nH=[1,-1,1];class nZ{}class nW{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,r,n){{let e=this._storage.get(r.id);if(e)return e.lastUsedFrameIdx=i,e.buf}let o=n.gl,a=o.getBufferParameter(o.ELEMENT_ARRAY_BUFFER,o.BUFFER_SIZE),s=new ArrayBuffer(a),l=new Int16Array(s);o.getBufferSubData(o.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));let h=new e.en;for(let e=0;e<a/2;e+=3){let i=l[e],r=l[e+1],n=l[e+2];h.emplaceBack(i,r),h.emplaceBack(r,n),h.emplaceBack(n,i)}let u=n.bindVertexArrayOES.current,c=new nZ;return c.buf=new ni(n,h),c.lastUsedFrameIdx=i,this._storage.set(r.id,c),n.bindVertexArrayOES.set(u),c.buf}update(e){for(let[i,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(i))}destroy(){for(let[e,i]of this._storage)i.buf.destroy(),this._storage.delete(e)}}class nX{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}let nY=e.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class nK{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class nJ{constructor(e,i){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...i,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...i,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}let nQ=e.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class n0{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,r){var n;let o=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){let r=new e.eo,n=new e.a_;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1),n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(r,nQ.members),this.vignetteIdx=i.context.createIndexBuffer(n)}let a=e.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,o);let e={u_vignetteShape:(n={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:n.vignetteColor};o.draw(i,i.context.gl.TRIANGLES,t3.disabled,t5.disabled,t2.alphaBlended,t4.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,a)}}}class n1{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,r){let n=i.getFreeCameraOptions().position,o=n.toAltitude(),a=n.toLngLat(),s=e.al(a.lng),l=e.al(a.lat),h=i.pixelsPerMeter/r,u=s*e.eq,c=e.eq*Math.log(Math.tan(Math.PI/4+l/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{let e=-this._offsetYPrev+c,i=-this._elevationPrev+o;this._accumulatedOffsetX+=(-this._offsetXPrev+u)*h,this._accumulatedOffsetY+=e*h,this._accumulatedElevation+=i*h,this._offsetXPrev=u,this._offsetYPrev=c,this._elevationPrev=o}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function n2(e,i){return[-(e[0]-Math.floor(e[0]/i)*i),-(e[1]-Math.floor(e[1]/i)*i),-(e[2]-Math.floor(e[2]/i)*i)]}function n3(i){let r=e.ea(0x134104da55e),n=[];for(let o=0;o<i;++o){let i=2*r()-1,o=2*r()-1,a=2*r()-1;n.push(e.cS(i,o,a))}return n}function n5(i,r,n,o,a){let s=e.aD((a-n)/(o-n),0,1);return(1-s)*i+s*r}class n4{constructor(e){this._movement=new n1,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new n0,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,r){let n=i.transform;this._movement.update(n,this._ppmScaleFactor);let o=n.starsProjMatrix,a=e.bY([]);e.b_(a,a,e.al(90)-n._pitch),e.bZ(a,a,-n.angle);let s=e.c3(new Float32Array(16),a),l=e.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),h=e.ee([],l),u=e.az([],h,s),c=Date.now()/1e3;return this._accumulatedTimeFromStart+=(c-this._prevTime)*r,this._prevTime=c,{projectionMatrix:o,modelviewMatrix:u}}}class n6 extends n4{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new nJ(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){let r=i.context;if(!this.particlesVx){let i=n3(this.particlesCount),n=new e.er,o=new e.a_,a=0,s=e.ea(0x134104da55e);for(let e=0;e<i.length;++e){let r=i[e],l=[2*s()-1,s(),s(),s()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...l),n.emplaceBack(r[0],r[1],r[2],1,-1,...l),n.emplaceBack(r[0],r[1],r[2],1,1,...l),n.emplaceBack(r[0],r[1],r[2],-1,1,...l),o.emplaceBack(a+0,a+1,a+2),o.emplaceBack(a+0,a+2,a+3),a+=4}this.particlesVx=r.createVertexBuffer(n,nY.members),this.particlesIdx=r.createIndexBuffer(o)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;let r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},n=i.transform.zoom;if(r.revealStart>n)return;let o=n5(0,1,r.revealStart,r.revealStart+r.revealRange,n);if(!this.particlesVx||!this.particlesIdx)return;let a=structuredClone(this._params),s=[-a.direction.x,a.direction.y,-100];e.au(s,s);let l=structuredClone(this._vignetteParams);l.strength*=o,a.overrideStyleParameters||(a.intensity=i.style.rain.state.density,a.timeFactor=i.style.rain.state.intensity,a.color=structuredClone(i.style.rain.state.color),s=structuredClone(i.style.rain.state.direction),a.screenThinning.intensity=i.style.rain.state.centerThinning,a.dropletSizeX=i.style.rain.state.dropletSize[0],a.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],a.distortionStrength=100*i.style.rain.state.distortionStrength,l.strength=1,l.color=structuredClone(i.style.rain.state.vignetteColor));let h=this.updateOnRender(i,a.timeFactor),u=i.context,c=u.gl,d=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new e.T(u,{width:i.width,height:i.height,data:null},c.RGBA8)),a.distortionStrength>0&&(u.activeTexture.set(c.TEXTURE0),this.screenTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.copyTexSubImage2D(c.TEXTURE_2D,0,0,0,0,0,i.width,i.height));let p=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(u,p),u.activeTexture.set(c.TEXTURE0),this.screenTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE);let f=[a.color.r,a.color.g,a.color.b,a.color.a],m=(r,n)=>{var o;let l=n2(this._movement.getPosition(),r),u=a.dropletSizeX,m=a.dropletSizeX*a.dropletSizeYScale,g=i.width/2,_=i.height/2,y=n5(0,a.screenThinning.start,0,1,a.screenThinning.intensity),v=n5(.001,a.screenThinning.range,0,1,a.screenThinning.intensity),x=n5(0,a.screenThinning.particleOffset,0,1,a.screenThinning.intensity),b=(o={modelview:h.modelviewMatrix,projection:h.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:l,velocityConeAperture:a.velocityConeAperture,velocity:a.velocity,boxSize:r,rainDropletSize:[u,m],distortionStrength:a.distortionStrength,rainDirection:s,color:f,screenSize:[d.width,d.height],thinningCenterPos:[g,_],thinningShape:[y,v,Math.pow(10,a.screenThinning.fadePower)],thinningAffectedRatio:a.screenThinning.affectedRatio,thinningParticleOffset:x,shapeDirectionalPower:a.shapeDirPower,shapeNormalPower:a.shapeNormalPower,mode:+!n},{u_modelview:Float32Array.from(o.modelview),u_projection:Float32Array.from(o.projection),u_time:o.time,u_cam_pos:o.camPos,u_texScreen:0,u_velocityConeAperture:o.velocityConeAperture,u_velocity:o.velocity,u_boxSize:o.boxSize,u_rainDropletSize:o.rainDropletSize,u_distortionStrength:o.distortionStrength,u_rainDirection:o.rainDirection,u_color:o.color,u_screenSize:o.screenSize,u_thinningCenterPos:o.thinningCenterPos,u_thinningShape:o.thinningShape,u_thinningAffectedRatio:o.thinningAffectedRatio,u_thinningParticleOffset:o.thinningParticleOffset,u_shapeDirectionalPower:o.shapeDirectionalPower,u_shapeNormalPower:o.shapeNormalPower,u_mode:o.mode}),w=Math.round(a.intensity*this.particlesCount),T=e.bd.simpleSegment(0,0,4*w,2*w);p.draw(i,c.TRIANGLES,t3.disabled,t5.disabled,t2.alphaBlended,t4.disabled,b,"rain_particles",this.particlesVx,this.particlesIdx,T)};a.distortionStrength>0&&m(a.boxSize,!0),m(a.boxSize,!1),this._vignette.draw(i,l)}}let n8=e.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class n9 extends n4{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new nJ(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){let r=i.context;if(!this.particlesVx){let i=n3(this.particlesCount),n=new e.es,o=new e.a_,a=0,s=e.ea(0x134104da55e);for(let e=0;e<i.length;++e){let r=i[e],l=s(),h=s(),u=s(),c=[e/i.length,l,h,u],d=[s(),s()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...c,...d),n.emplaceBack(r[0],r[1],r[2],1,-1,...c,...d),n.emplaceBack(r[0],r[1],r[2],1,1,...c,...d),n.emplaceBack(r[0],r[1],r[2],-1,1,...c,...d),o.emplaceBack(a+0,a+1,a+2),o.emplaceBack(a+0,a+2,a+3),a+=4}this.particlesVx=r.createVertexBuffer(n,n8.members),this.particlesIdx=r.createIndexBuffer(o)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;let r=structuredClone(this._params),n=[-r.direction.x,r.direction.y,-100];e.au(n,n);let o=structuredClone(this._vignetteParams),a=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},s=i.transform.zoom;if(a.revealStart>s)return;let l=n5(0,1,a.revealStart,a.revealStart+a.revealRange,s);o.strength*=l,r.overrideStyleParameters||(r.intensity=i.style.snow.state.density,r.timeFactor=i.style.snow.state.intensity,r.color=structuredClone(i.style.snow.state.color),n=structuredClone(i.style.snow.state.direction),r.screenThinning.intensity=i.style.snow.state.centerThinning,r.billboardSize=2.79*i.style.snow.state.flakeSize,o.strength=1,o.color=structuredClone(i.style.snow.state.vignetteColor));let h=this.updateOnRender(i,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;let u=i.context,c=u.gl,d=i.transform,p=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(u,p),((r,o,a)=>{var s;let l=n2(this._movement.getPosition(),r),u=d.width/2,f=d.height/2,m=n5(0,a.screenThinning.start,0,1,a.screenThinning.intensity),g=n5(.001,a.screenThinning.range,0,1,a.screenThinning.intensity),_=n5(0,a.screenThinning.particleOffset,0,1,a.screenThinning.intensity),y=(s={modelview:h.modelviewMatrix,projection:h.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:l,velocityConeAperture:a.velocityConeAperture,velocity:a.velocity,horizontalOscillationRadius:a.horizontalOscillationRadius,horizontalOscillationRate:a.horizontalOscillationRate,boxSize:r,billboardSize:+a.billboardSize,simpleShapeParameters:[a.shapeFadeStart,a.shapeFadePower],screenSize:[d.width,d.height],thinningCenterPos:[u,f],thinningShape:[m,g,Math.pow(10,a.screenThinning.fadePower)],thinningAffectedRatio:a.screenThinning.affectedRatio,thinningParticleOffset:_,color:[a.color.r,a.color.g,a.color.b,a.color.a],direction:n},{u_modelview:Float32Array.from(s.modelview),u_projection:Float32Array.from(s.projection),u_time:s.time,u_cam_pos:s.camPos,u_velocityConeAperture:s.velocityConeAperture,u_velocity:s.velocity,u_horizontalOscillationRadius:s.horizontalOscillationRadius,u_horizontalOscillationRate:s.horizontalOscillationRate,u_boxSize:s.boxSize,u_billboardSize:s.billboardSize,u_simpleShapeParameters:s.simpleShapeParameters,u_screenSize:s.screenSize,u_thinningCenterPos:s.thinningCenterPos,u_thinningShape:s.thinningShape,u_thinningAffectedRatio:s.thinningAffectedRatio,u_thinningParticleOffset:s.thinningParticleOffset,u_particleColor:s.color,u_direction:s.direction}),v=Math.round(a.intensity*this.particlesCount),x=e.bd.simpleSegment(0,0,4*v,2*v);this.particlesVx&&this.particlesIdx&&p.draw(i,c.TRIANGLES,t3.disabled,t5.disabled,t2.alphaBlended,t4.disabled,y,"snow_particles",this.particlesVx,this.particlesIdx,x)})(r.boxSize,0,r),this._vignette.draw(i,o)}}let n7={symbol:function(i,r,n,o,a){if("translucent"!==i.renderPass)return;let s=t5.disabled,l=i.colorModeForRenderPass(),h=n.layout.get("text-variable-anchor"),u=n.layout.get("text-size-scale-range"),c=e.aD(i.scaleFactor,u[0],u[1]);h&&function(i,r,n,o,a,s,l,h){let u=r.transform,c="map"===a,d="map"===s;for(let r of i){let i=o.getTile(r),a=i.getBucket(n);if(!a||!a.text||!a.text.segments.get().length)continue;let s=e.bH(a.textSizeData,u.zoom,h),p=tz(r,a.getProjection(),u),f=u.calculatePixelsToTileUnitsMatrix(i),m=tx(p,i.tileID.canonical,d,c,u,a.getProjection(),f),g=a.hasIconTextFit()&&a.hasIconData();s&&function(i,r,n,o,a,s,l,h,u,c){let d=i.text.placedSymbolArray,p=i.text.dynamicLayoutVertexArray,f=i.icon.dynamicLayoutVertexArray,m={},g=i.getProjection(),_=tz(l,g,a),y=a.elevation,v=g.upVectorScale(l.canonical,a.center.lat,a.worldSize).metersToTile;p.clear();for(let f=0;f<d.length;f++){let x=d.get(f),{tileAnchorX:b,tileAnchorY:w,numGlyphs:T}=x,S=x.hidden||!x.crossTileID||i.allowVerticalPlacement&&!x.placedOrientation?null:o[x.crossTileID];if(S){let o=0,d=0,f=0;if(y){let e=y?y.getAtTileOffset(l,b,w):0,[i,r,n]=g.upVector(l.canonical,b,w);o=e*i*v,d=e*r*v,f=e*n*v}let[E,I,C,A]=tT(x.projectedAnchorX+o,x.projectedAnchorY+d,x.projectedAnchorZ+f,n?_:s),R=tS(a.getCameraToCenterDistance(g),A),M=e.bJ(i.textSizeData,u,x)*R/e.bO;n&&(M*=i.tilePixelRatio/h);let P=function({width:i,height:r,anchor:n,textOffset:o,textScale:a},s){let{horizontalAlign:l,verticalAlign:h}=e.bV(n),u=e.bU(n,o);return new e.P((-(l-.5)*i/a+u[0])*s,(-(h-.5)*r/a+u[1])*s)}(S,M);n?({x:E,y:I,z:C}=g.projectTilePoint(b+P.x,w+P.y,l.canonical),[E,I,C]=tT(E+o,I+d,C+f,s)):(r&&P._rotate(-a.angle),E+=P.x,I+=P.y,C=0);let O=i.allowVerticalPlacement&&x.placedOrientation===e.bI.vertical?Math.PI/2:0;for(let i=0;i<T;i++)e.bL(p,E,I,C,O);c&&x.associatedIconIndex>=0&&(m[x.associatedIconIndex]={x:E,y:I,z:C,angle:O})}else tO(T,p)}if(c){f.clear();let r=i.icon.placedSymbolArray;for(let i=0;i<r.length;i++){let n=r.get(i),{numGlyphs:o}=n,a=m[i];if(n.hidden||!a)tO(o,f);else{let{x:i,y:r,z:n,angle:s}=a;for(let a=0;a<o;a++)e.bL(f,i,r,n,s)}}i.icon.dynamicLayoutVertexBuffer.updateData(f)}i.text.dynamicLayoutVertexBuffer.updateData(p)}(a,c,d,l,u,m,r,Math.pow(2,u.zoom-i.tileID.overscaledZ),s,g)}}(o,i,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a,c);let d=0!==n.paint.get("icon-opacity").constantOr(1),p=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(d||p)?nu(i,r,n,o,s,l):(d&&nu(i,r,n,o,s,l,{onlyIcons:!0}),p&&nu(i,r,n,o,s,l,{onlyText:!0})),r.map.showCollisionBoxes&&(ns(i,r,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),ns(i,r,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(i,r,n,o){if("translucent"!==i.renderPass)return;let a=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),l=n.paint.get("circle-stroke-opacity"),h=void 0!==n.layout.get("circle-sort-key").constantOr(1),u=n.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===s.constantOr(1)||0===l.constantOr(1)))return;let c=i.context,d=c.gl,p=i.transform,f=i.depthModeForSublayer(0,t3.ReadOnly),m=t5.disabled,g=i.colorModeForDrapableLayerRenderPass(u),_="globe"===p.projection.name,y=[e.ay(p.center.lng),e.aH(p.center.lat)],v=[];for(let a=0;a<o.length;a++){let s=o[a],l=r.getTile(s),u=l.getBucket(n);if(!u||u.projection.name!==p.projection.name)continue;let c=u.programConfigurations.get(n.id),d=e.dK(n),f=i.isTileAffectedByFog(s);_&&d.push("PROJECTION_GLOBE_VIEW"),d.push("DEPTH_D24"),i.terrain&&p.depthOcclusionForSymbolsAndCircles&&d.push("DEPTH_OCCLUSION");let m=i.getOrCreateProgram("circle",{config:c,defines:d,overrideFog:f}),g=u.layoutVertexBuffer,x=u.globeExtVertexBuffer,b=u.indexBuffer,w=p.projection.createInversionMatrix(p,s.canonical),T={programConfiguration:c,program:m,layoutVertexBuffer:g,globeExtVertexBuffer:x,indexBuffer:b,uniformValues:e.dL(i,s,l,w,y,n),tile:l};if(h)for(let i of u.segments.get())v.push({segments:new e.bd([i]),sortKey:i.sortKey,state:T});else v.push({segments:u.segments,sortKey:0,state:T})}h&&v.sort((e,i)=>e.sortKey-i.sortKey);let x={useDepthForOcclusion:p.depthOcclusionForSymbolsAndCircles};for(let e of v){let{programConfiguration:r,program:o,layoutVertexBuffer:a,globeExtVertexBuffer:s,indexBuffer:l,uniformValues:h,tile:u}=e.state,_=e.segments;i.terrain&&i.terrain.setupElevationDraw(u,o,x),i.uploadCommonUniforms(c,o,u.tileID.toUnwrapped()),o.draw(i,d.TRIANGLES,f,m,g,t4.disabled,h,n.id,a,l,_,n.paint,p.zoom,r,[s])}},heatmap:function(i,r,n,o){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===i.renderPass){let a=i.context,s=a.gl,l=t5.disabled,h=new t2([s.ONE,s.ONE,s.ONE,s.ONE],e.am.transparent,[!0,!0,!0,!0]);!function(e,i,r,n){let o=e.gl,a=i.width*n,s=i.height*n;e.activeTexture.set(o.TEXTURE1),e.viewport.set([0,0,a,s]);let l=r.heatmapFbo;if(!l||l&&(l.width!==a||l.height!==s)){l&&l.destroy();let i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),l=r.heatmapFbo=e.createFramebuffer(a,s,!0,null),function(e,i,r,n,o,a){let s=e.gl;s.texImage2D(s.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,o,a,0,s.RGBA,e.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),n.colorAttachment.set(r)}(e,0,i,l,a,s)}else o.bindTexture(o.TEXTURE_2D,l.colorAttachment.get()),e.bindFramebuffer.set(l.framebuffer)}(a,i,n,"globe"===i.transform.projection.name?.5:.25),a.clear({color:e.am.transparent});let u=i.transform,c="globe"===u.projection.name,d=c?["PROJECTION_GLOBE_VIEW"]:[],p=c?t4.frontCCW:t4.disabled,f=[e.ay(u.center.lng),e.aH(u.center.lat)];for(let e=0;e<o.length;e++){let m=o[e];if(r.hasRenderableParent(m))continue;let g=r.getTile(m),_=g.getBucket(n);if(!_||_.projection.name!==u.projection.name)continue;let y=i.isTileAffectedByFog(m),v=_.programConfigurations.get(n.id),x=i.getOrCreateProgram("heatmap",{config:v,defines:d,overrideFog:y}),{zoom:b}=i.transform;i.terrain&&i.terrain.setupElevationDraw(g,x),i.uploadCommonUniforms(a,x,m.toUnwrapped());let w=u.projection.createInversionMatrix(u,m.canonical);x.draw(i,s.TRIANGLES,t3.disabled,l,h,p,rK(i,m,g,w,f,b,n.paint.get("heatmap-intensity")),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,i.transform.zoom,v,c?[_.globeExtVertexBuffer]:null)}a.viewport.set([0,0,i.width,i.height])}else"translucent"===i.renderPass&&(i.context.setColorMode(i.colorModeForRenderPass()),function(i,r){let n=i.context,o=n.gl,a=r.heatmapFbo;if(!a)return;n.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.colorAttachment.get()),n.activeTexture.set(o.TEXTURE1);let s=r.colorRampTexture;s||(s=r.colorRampTexture=new e.T(n,r.colorRamp,o.RGBA8)),s.bind(o.LINEAR,o.CLAMP_TO_EDGE),i.getOrCreateProgram("heatmapTexture").draw(i,o.TRIANGLES,t3.disabled,t5.disabled,i.colorModeForRenderPass(),t4.disabled,{u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")},r.id,i.viewportBuffer,i.quadTriangleIndexBuffer,i.viewportSegments,r.paint,i.transform.zoom)}(i,n))},line:function(i,r,n,o){let a;if("translucent"!==i.renderPass)return;let s=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(0===s.constantOr(1)||0===l.constantOr(1))return;let h=n.paint.get("line-emissive-strength"),u=n.paint.get("line-occlusion-opacity"),c=n.layout.get("line-elevation-reference"),d="meters"===n.layout.get("line-width-unit"),p="sea"===c,f=!(!i.terrain||!i.terrain.enabled),m=i.context,g=m.gl;if(n.hasElevatedBuckets&&"globe"===i.transform.projection.name)return;let _=n.layout.get("line-cross-slope"),y=i.colorModeForDrapableLayerRenderPass(h),v=i.terrain&&i.terrain.renderingToTexture,x=v?1:e.q.devicePixelRatio,b=n.paint.get("line-dasharray"),w=b.constantOr(1),T=n.layout.get("line-cap"),S=b.constantOr(null),E=T.constantOr(null),I=n.paint.get("line-pattern"),C=I.constantOr(1),A=n.paint.get("line-pattern-cross-fade"),R=I.constantOr(null),M=n.paint.get("line-opacity").constantOr(1),P=!C&&1!==M||i.depthOcclusion&&u>0&&u<1,O=n.paint.get("line-gradient"),k=C?"linePattern":"line",L=e.dM(n);if(v&&i.terrain&&i.terrain.clipOrMaskOverlapStencilType()&&(P=!1),0!==u&&i.depthOcclusion){let i=n.paint._values["line-opacity"];i&&i.value&&"constant"===i.value.kind?a=i.value:e.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==l.value.kind&&!1===l.value.isLineProgressConstant&&L.push("VARIABLE_LINE_WIDTH");let D=(o,s,l,h,c,f)=>{for(let _ of o){let o=r.getTile(_);if(C&&!o.patternsLoaded())continue;let b=o.getBucket(n);if(!b||"none"!==b.elevationType&&!c||"none"===b.elevationType&&c)continue;i.prepareDrawTile();let T=[...s],I=i.shadowRenderer,L="road"===b.elevationType&&!!I&&I.enabled,D=[0,0,0];if(L){let e=i.style.directionalLight,r=i.style.ambientLight;e&&r&&(D=id(i.style,e,r)),T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}let z=b.programConfigurations.get(n.id),F=!1;if(R&&o.imageAtlas){let i=e.dN.from(R),r=i.getPrimary().scaleSelf(x).toString(),n=o.imageAtlas.patternPositions.get(r),a=i.getSecondary(),s=a?o.imageAtlas.patternPositions.get(a.scaleSelf(x).toString()):null;F=!!n&&!!s,n&&z.setConstantPatternPositions(n,s)}A>0&&(F||z.getPatternTransitionVertexBuffer("line-pattern"))&&T.push("LINE_PATTERN_TRANSITION");let B=i.isTileAffectedByFog(_),N=i.getOrCreateProgram(k,{config:z,defines:T,overrideFog:B,overrideRtt:!c&&void 0});if(!C&&S&&E&&o.lineAtlas){let e=o.lineAtlas.getDash(S,E);e&&z.setConstantPatternPositions(e)}L&&I.setupShadows(o.tileID.toUnwrapped(),N,"vector-tile",o.tileID.overscaledZ);let[j,V]=n.paint.get("line-trim-offset");("round"===E||"square"===E)&&j!==V&&(0===j&&(j-=1),1===V&&(V+=1));let U=v?_.projMatrix:null,G=d?1/b.tileToMeter/e.aw(o,1,i.transform.zoom):1,q=d?1/b.tileToMeter/e.aw(o,1,Math.floor(i.transform.zoom)):1,$=C?e.dO(i,o,n,U,x,G,q,[j,V],D,A):e.dP(i,o,n,U,b.lineClipsArray.length,x,G,q,[j,V],D);if(O){let o=b.gradients[n.id],a=o.texture;if(n.gradientVersion!==o.version){let s=256;if(n.stepInterpolant){let n=r.getSource().maxzoom,o=_.canonical.z===n?Math.ceil(1<<i.transform.maxZoom-_.canonical.z):1;s=e.aD(e.dQ(b.maxLineLength/e.aj*1024*o),256,m.maxTextureSize)}o.gradient=e.dR({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:o.gradient||void 0,clips:b.lineClipsArray}),o.texture?o.texture.update(o.gradient):o.texture=new e.T(m,o.gradient,g.RGBA8),o.version=n.gradientVersion,a=o.texture}m.activeTexture.set(g.TEXTURE1),a.bind(n.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}w&&(m.activeTexture.set(g.TEXTURE0),o.lineAtlasTexture&&o.lineAtlasTexture.bind(g.LINEAR,g.REPEAT),z.updatePaintBuffers()),C&&(m.activeTexture.set(g.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),z.updatePaintBuffers()),c&&!p&&i.terrain.setupElevationDraw(o,N),i.uploadCommonUniforms(m,N,_.toUnwrapped());let H=e=>{null!=a&&(a.value=M*u),N.draw(i,g.TRIANGLES,l,e,y,t4.disabled,$,n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,n.paint,i.transform.zoom,z,[b.layoutVertexBuffer2,b.patternVertexBuffer,b.zOffsetVertexBuffer]),null!=a&&(a.value=M)};if(P&&!c){let e=i.stencilModeForClipping(_).ref;0===e&&v&&m.clear({stencil:0});let r={func:g.EQUAL,mask:255};$.u_alpha_discard_threshold=.8,H(new t5(r,e,255,g.KEEP,g.KEEP,g.INVERT)),$.u_alpha_discard_threshold=0,H(new t5(r,e,255,g.KEEP,g.KEEP,g.KEEP))}else $.u_alpha_discard_threshold=P&&c&&f?.8:0,H(c?h:i.stencilModeForClipping(_))}},z=i.depthModeForSublayer(0,t3.ReadOnly),F=new t3(i.depthOcclusion?g.GREATER:g.LEQUAL,t3.ReadOnly,i.depthRangeFor3D);if(n.hasNonElevatedBuckets){let r=!v&&i.terrain;0!==u&&r?e.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):r?e.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):D(o,L,z,t5.disabled,!1,!0)}if(n.hasElevatedBuckets){"hd-road-markup"===c?f||(z=F,L.push("ELEVATED_ROADS")):(L.push("ELEVATED"),z=F,void 0!==_&&L.push(_<1?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),p&&L.push("ELEVATION_REFERENCE_SEA"));let e=P?i.stencilModeFor3D():t5.disabled;i.forceTerrainMode=!0,D(o,L,z,e,!0,!0),P&&D(o,L,z,e,!0,!1),i.forceTerrainMode=!1}P&&(i.resetStencilClippingMasks(),v&&m.clear({stencil:0})),0===u||i.depthOcclusion||v||i.layersWithOcclusionOpacity.push(i.currentLayer)},fill:function(i,r,n,o){let a=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;let l=n.paint.get("fill-emissive-strength"),h=i.colorModeForDrapableLayerRenderPass(l),u=n.paint.get("fill-pattern"),c=i.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(e.am.transparent).a&&1===s.constantOr(0)?"opaque":"translucent",d="none";"none"!==n.layout.get("fill-elevation-reference")?d="road":0!==n.paint.get("fill-z-offset").constantOr(1)&&(d="offset");let p=!(!i.terrain||!i.terrain.enabled),f={painter:i,sourceCache:r,layer:n,coords:o,colorMode:h,elevationType:d,terrainEnabled:p,pass:c};if("shadow"!==i.renderPass)if("offset"!==d){if(np(f,!1),"road"===d){let e=!p&&"translucent"===i.renderPass;e&&nd(i,r,n,o,"geometry"),np(f,!0,t5.disabled),e&&function(e){let{painter:i,sourceCache:r,layer:n,coords:o,colorMode:a}=e,s=i.context.gl,l=e.painter.shadowRenderer,h=!!l&&l.enabled,u=new t3(i.context.gl.LEQUAL,t3.ReadOnly,i.depthRangeFor3D),c=[0,0,0];if(h){let e=i.style.directionalLight,r=i.style.ambientLight;e&&r&&(c=id(i.style,e,r))}for(let e of o){let o=r.getTile(e),d=o.getBucket(n);if(!d)continue;let p=d.elevatedStructures;if(!p||!p.renderableSegments||0===p.renderableSegments.segments[0].primitiveLength)continue;i.prepareDrawTile();let f=d.bufferData.programConfigurations.get(n.id),m=i.isTileAffectedByFog(e),g=[];h&&g.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");let _=i.getOrCreateProgram("elevatedStructures",{config:f,overrideFog:m,defines:g}),y=i.translatePosMatrix(e.projMatrix,o,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));h&&l.setupShadows(o.tileID.toUnwrapped(),_,"vector-tile",o.tileID.overscaledZ);let v=rH(y,c);i.uploadCommonUniforms(i.context,_,e.toUnwrapped()),_.draw(i,s.TRIANGLES,u,t5.disabled,a,t4.backCCW,v,n.id,p.vertexBuffer,p.indexBuffer,p.renderableSegments,n.paint,i.transform.zoom,f,[p.vertexBufferNormal])}}(f)}}else np(f,!1,i.stencilModeFor3D());else i.shadowRenderer&&"road"===d&&!p&&function(e){let{painter:i,sourceCache:r,layer:n,coords:o}=e,a=i.context.gl,s=e.painter.shadowRenderer;for(let e of o){let o=r.getTile(e),l=o.getBucket(n);if(!l)continue;let h=l.elevatedStructures;if(!h||!h.shadowCasterSegments||0===h.shadowCasterSegments.segments[0].primitiveLength)continue;i.prepareDrawTile();let u=l.bufferData.programConfigurations.get(n.id),c=i.isTileAffectedByFog(e),d=i.getOrCreateProgram("elevatedStructuresDepth",{config:u,overrideFog:c}),p=s.calculateShadowPassMatrixFromTile(o.tileID.toUnwrapped());i.uploadCommonUniforms(i.context,d,e.toUnwrapped());let f={u_matrix:p,u_depth_bias:.001};d.draw(i,a.TRIANGLES,s.getShadowPassDepthMode(),t5.disabled,s.getShadowPassColorMode(),t4.disabled,f,n.id,h.vertexBuffer,h.indexBuffer,h.shadowCasterSegments,n.paint,i.transform.zoom,u)}}(f)},"fill-extrusion":function(i,r,n,o){let a=n.paint.get("fill-extrusion-opacity"),s=i.context,l=s.gl,h=i.terrain,u=h&&h.renderingToTexture;if(0===a)return;let c=i.conflationActive&&i.style.isLayerClipped(n,r.getSource()),d=i.style.order.indexOf(n.fqid);if(c&&function(e,i,r,n,o){for(let a of n){let n=i.getTile(a).getBucket(r);n&&(n.updateReplacement(a,e.replacementSource,o),n.uploadCentroid(e.context))}}(i,r,n,o,d),h||c)for(let a of o){let o=r.getTile(a).getBucket(n);o&&function(i,r,n,o,a,s,l){0===o.centroidVertexArray.length&&o.createCentroidsBuffer();let h=s?s.findDEMTileFor(n):null;if(!(h&&h.dem||l))return;s&&h&&h.dem&&o.selfDEMTileTimestamp!==h.dem._timestamp&&(o.borderDoneWithNeighborZ=[-1,-1,-1,-1],o.selfDEMTileTimestamp=h.dem._timestamp);let u=i=>new e.P(Math.ceil((i+e.dX)*e.dY),0),c=e=>{let i=r.getSource().minzoom,n=e=>{let i=r.getTileByID(e);if(i&&i.hasData())return i.getBucket(a)};for(let r of[0,-1,1]){if(e.overscaledZ+r<i)continue;let o=n(e.calculateScaledKey(e.overscaledZ+r));if(o)return o}},d=[0,0,0],p=(i,r)=>(d[0]=Math.min(i.min.y,r.min.y),d[1]=Math.max(i.max.y,r.max.y),d[2]=e.aj-r.min.x>i.max.x?r.min.x-e.aj:i.max.x,d),f=(i,r)=>(d[0]=Math.min(i.min.x,r.min.x),d[1]=Math.max(i.max.x,r.max.x),d[2]=e.aj-r.min.y>i.max.y?r.min.y-e.aj:i.max.y,d),m=[(e,i)=>p(e,i),(e,i)=>p(i,e),(e,i)=>f(e,i),(e,i)=>f(i,e)],g=(i,r,o,a,l,u,c)=>{if(!s)return 0;let d=[[u?o:i,u?i:o,0],[u?o:r,u?r:o,0]],p=c<0?e.aj+c:c,f=[u?p:(i+r)/2,u?(i+r)/2:p,0];return 0===o&&c<0||0!==o&&c>0?s.getForTilePoints(l,[f],!0,a):d.push(f),s.getForTilePoints(n,d,!0,h),Math.max(d[0][2],d[1][2],f[2])/s.exaggeration()};for(let i=0;i<4;i++){let r=o.borderFeatureIndices[i];if(0===r.length)continue;let a=e.dU[i](n),h=c(a);if(!(h&&h instanceof e.dV))continue;let d=s?s.findDEMTileFor(a):null;if(!(d&&d.dem||l)||(s&&d&&d.dem&&o.borderDEMTileTimestamp[i]!==d.dem._timestamp&&(o.borderDoneWithNeighborZ[i]=-1,o.borderDEMTileTimestamp[i]=d.dem._timestamp),o.borderDoneWithNeighborZ[i]===h.canonical.z))continue;0===h.centroidVertexArray.length&&h.createCentroidsBuffer();let p=(i<2?1:5)-i,f=h.borderDoneWithNeighborZ[p]!==o.canonical.z,_=h.borderFeatureIndices[p],y=0;if(o.canonical.z!==h.canonical.z){for(let e of r)o.showCentroid(o.featuresOnBorder[e]);if(f)for(let e of _)h.showCentroid(h.featuresOnBorder[e]);o.borderDoneWithNeighborZ[i]=h.canonical.z,h.borderDoneWithNeighborZ[p]=o.canonical.z}for(let n of r){let r,s=o.featuresOnBorder[n],c=o.centroidData[s.centroidDataIndex],f=s.borders[i];for(;y<_.length;){let e=(r=h.featuresOnBorder[_[y]]).borders[p];if(e[1]>f[0]+3||e[0]>f[0]-3)break;h.showCentroid(r),y++}if(r&&y<_.length){let n=y,v=0;for(;!(r.borders[p][0]>f[1]-3)&&(v++,++y!==_.length);)r=h.featuresOnBorder[_[y]];r=h.featuresOnBorder[_[n]];let x=!1;if(v>=1){let e=r.borders[p];3>Math.abs(f[0]-e[0])&&3>Math.abs(f[1]-e[1])&&(v=1,x=!0,y=n+1)}else if(0===v){o.showCentroid(s);continue}let b=h.centroidData[r.centroidDataIndex];l&&x&&((c.flags|b.flags)&e.dW?(c.flags|=e.dW,b.flags|=e.dW):(c.flags&=~e.dW,b.flags&=~e.dW));let w=s.intersectsCount()>1||r.intersectsCount()>1;if(v>1)y=n,c.centroidXY=b.centroidXY=new e.P(0,0);else if(d&&d.dem&&!w){let r=m[i](c,b),n=i%2?e.aj-1:0;c.centroidXY=b.centroidXY=u(g(r[0],Math.min(e.aj-1,r[1]),n,d,a,i<2,r[2]))}else w?c.centroidXY=b.centroidXY=new e.P(0,0):(c.centroidXY=o.encodeBorderCentroid(s),b.centroidXY=h.encodeBorderCentroid(r));o.writeCentroidToBuffer(c),h.writeCentroidToBuffer(b)}else o.showCentroid(s)}o.borderDoneWithNeighborZ[i]=h.canonical.z,h.borderDoneWithNeighborZ[p]=o.canonical.z}(o.needsCentroidUpdate||!o.centroidVertexBuffer&&0!==o.centroidVertexArray.length)&&o.uploadCentroid(i)}(i.context,r,a,o,n,h,c)}if("shadow"===i.renderPass&&i.shadowRenderer){let s=i.shadowRenderer;if(h&&a<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;let l=s.getShadowPassDepthMode(),u=s.getShadowPassColorMode();nf(i,r,n,o,l,t5.disabled,u,c)}else if("translucent"===i.renderPass){let d=!n.paint.get("fill-extrusion-pattern").constantOr(1),p=n.paint.get("fill-extrusion-color").constantOr(e.am.white);if(!u&&0!==p.a){let e=new t3(i.context.gl.LEQUAL,t3.ReadWrite,i.depthRangeFor3D);1===a&&d?nf(i,r,n,o,e,t5.disabled,t2.unblended,c):(nf(i,r,n,o,e,t5.disabled,t2.disabled,c),nf(i,r,n,o,e,i.stencilModeFor3D(),i.colorModeForRenderPass(),c),i.resetStencilClippingMasks())}if(i.style.enable3dLights()&&d&&(!h&&"globe"!==i.transform.projection.name||u)){let a=n.paint.get("fill-extrusion-opacity"),d=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),p=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=n.paint.get("fill-extrusion-flood-light-intensity"),m="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),g=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(m?null:n.lut).toArray01().slice(0,3),_=d>0&&p>0,y=f>0,v=(e,i,r)=>(1-r)*e+r*i,x=s=>{let h=i.depthModeForSublayer(1,t3.ReadOnly,l.LEQUAL,!0),u=v(.1,3,n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation")),m=i._showOverdrawInspector;m||nm(i,r,n,o,h,new t5({func:l.ALWAYS,mask:255},255,255,l.KEEP,l.KEEP,l.REPLACE),new t2([l.ONE,l.ONE,l.ONE,l.ONE],e.am.transparent,[!1,!1,!1,!0],l.MIN),t4.disabled,s,"sdf",a,d,p,f,g,u,c,!1);{let _=m?t5.disabled:new t5({func:l.EQUAL,mask:255},255,255,l.KEEP,l.DECR,l.DECR),y=m?i.colorModeForRenderPass():new t2([l.ONE_MINUS_DST_ALPHA,l.DST_ALPHA,l.ONE,l.ONE],e.am.transparent,[!0,!0,!0,!0]);nm(i,r,n,o,h,_,y,t4.disabled,s,"color",a,d,p,f,g,u,c,!1)}};if(u){let u=(s,h,u)=>{let m=i.depthModeForSublayer(1,t3.ReadOnly,l.LEQUAL,!1),_=v(.1,3,n.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"));{let u=new t2([l.ONE,l.ONE,l.ONE,l.ONE],e.am.transparent,[!1,!1,!1,!0]);nm(i,r,n,o,m,t5.disabled,u,t4.disabled,s,"clear",a,d,p,f,g,_,c,h)}nm(i,r,n,o,m,new t5({func:l.ALWAYS,mask:255},255,255,l.KEEP,l.KEEP,l.REPLACE),new t2([l.ONE,l.ONE,l.ONE,l.ONE],e.am.transparent,[!1,!1,!1,!0],l.MIN),t4.disabled,s,"sdf",a,d,p,f,g,_,c,h);{let u=s?l.ZERO:l.ONE_MINUS_DST_ALPHA;nm(i,r,n,o,m,new t5({func:l.EQUAL,mask:255},255,255,l.KEEP,l.DECR,l.DECR),new t2([u,l.DST_ALPHA,l.ONE_MINUS_DST_ALPHA,l.ZERO],e.am.transparent,[!0,!0,!0,!0]),t4.disabled,s,"color",a,d,p,f,g,_,c,h)}{let y=new t2([l.ONE,l.ONE,l.ONE,s?l.ZERO:l.ONE],e.am.transparent,[!1,!1,!1,!0],s?l.FUNC_ADD:l.MAX);nm(i,r,n,o,m,t5.disabled,y,t4.disabled,s,"clear",a,d,p,f,g,_,c,h,u)}};if(_||y){let r;if(i.prepareDrawTile(),h){let i=h.drapeBufferSize[0],n=h.drapeBufferSize[1];(r=h.framebufferCopyTexture)&&(!r||r.size[0]===i&&r.size[1]===n)||(r&&r.destroy(),r=h.framebufferCopyTexture=new e.T(s,new e.r({width:i,height:n}),l.RGBA8)),r.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.copyTexSubImage2D(l.TEXTURE_2D,0,0,0,0,0,i,n)}_&&u(!0,!1,r),y&&u(!1,!0,r)}}else _&&x(!0),y&&x(!1),(_||y)&&i.resetStencilClippingMasks()}}},hillshade:function(i,r,n,o){if("offscreen"!==i.renderPass&&"translucent"!==i.renderPass||i.style.disableElevatedTerrain)return;let a=i.context,s=i.terrain&&i.terrain.renderingToTexture,[l,h]="translucent"!==i.renderPass||s?[{},o]:i.stencilConfigForOverlap(o);for(let o of h){let a=r.getTile(o);if(a.needsHillshadePrepare&&"offscreen"===i.renderPass)!function(i,r,n){let o=i.context,a=o.gl;if(!r.dem)return;let s=r.dem;if(o.activeTexture.set(a.TEXTURE1),iZ(i,r,s),!r.demTexture)return;r.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);let l=s.dim;o.activeTexture.set(a.TEXTURE0);let h=r.hillshadeFBO;if(!h){let i=new e.T(o,{width:l,height:l,data:null},a.RGBA8);i.bind(a.LINEAR,a.CLAMP_TO_EDGE),(h=r.hillshadeFBO=o.createFramebuffer(l,l,!0,"renderbuffer")).colorAttachment.set(i.texture)}o.bindFramebuffer.set(h.framebuffer),o.viewport.set([0,0,l,l]);let{tileBoundsBuffer:u,tileBoundsIndexBuffer:c,tileBoundsSegments:d}=i.getMercatorTileBoundsBuffers(),p=[];i.linearFloatFilteringSupported()&&p.push("TERRAIN_DEM_FLOAT_FORMAT"),i.getOrCreateProgram("hillshadePrepare",{defines:p}).draw(i,a.TRIANGLES,t3.disabled,t5.disabled,t2.unblended,t4.disabled,((i,r)=>{let n=r.stride,o=e.bz();return e.c5(o,0,e.aj,-e.aj,0,0,1),e.bo(o,o,[0,-e.aj,0]),{u_matrix:o,u_image:1,u_dimension:[n,n],u_zoom:i.overscaledZ}})(r.tileID,s),n.id,u,c,d),r.needsHillshadePrepare=!1}(i,a,n);else if("translucent"===i.renderPass){let r=i.depthModeForSublayer(0,t3.ReadOnly),h=n.paint.get("hillshade-emissive-strength"),u=i.colorModeForDrapableLayerRenderPass(h),c=s&&i.terrain?i.terrain.stencilModeForRTTOverlap(o):l[o.overscaledZ];!function(i,r,n,o,a,s,l){let h=i.context,u=h.gl,c=n.hillshadeFBO;if(!c)return;i.prepareDrawTile();let d=i.isTileAffectedByFog(r),p=i.getOrCreateProgram("hillshade",{overrideFog:d});h.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());let f=((i,r,n,o)=>{let a=n.paint.get("hillshade-shadow-color"),s="none"===n.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),l=n.paint.get("hillshade-highlight-color"),h="none"===n.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),u=n.paint.get("hillshade-accent-color"),c="none"===n.paint.get("hillshade-accent-color-use-theme").constantOr("default"),d=n.paint.get("hillshade-emissive-strength"),p=e.al(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))p-=i.transform.angle;else if(i.style&&i.style.enable3dLights()&&i.style.directionalLight){let r=i.style.directionalLight.properties.get("direction"),n=e.cR(r.x,r.y,r.z);p=e.al(n[1])}let f=!i.options.moving;return{u_matrix:o||i.transform.calculateProjMatrix(r.tileID.toUnwrapped(),f),u_image:0,u_latrange:function(i,r){let n=Math.pow(2,r.canonical.z),o=r.canonical.y;return[new e.ac(0,o/n).toLngLat().lat,new e.ac(0,(o+1)/n).toLngLat().lat]}(0,r.tileID),u_light:[n.paint.get("hillshade-exaggeration"),p],u_shadow:a.toRenderColor(s?null:n.lut),u_highlight:l.toRenderColor(h?null:n.lut),u_emissive_strength:d,u_accent:u.toRenderColor(c?null:n.lut)}})(i,n,o,i.terrain?r.projMatrix:null);i.uploadCommonUniforms(h,p,r.toUnwrapped());let{tileBoundsBuffer:m,tileBoundsIndexBuffer:g,tileBoundsSegments:_}=i.getTileBoundsBuffers(n);p.draw(i,u.TRIANGLES,a,s,l,t4.disabled,f,o.id,m,g,_)}(i,o,a,n,r,c,u)}}a.viewport.set([0,0,i.width,i.height]),i.resetStencilClippingMasks()},raster:function(i,r,n,o,a,s){if("translucent"!==i.renderPass||0===n.paint.get("raster-opacity"))return;let l="globe"===i.transform.projection.name,h=0!==n.paint.get("raster-elevation"),u=h&&l;if(i.renderElevatedRasterBackface&&!u)return;let c=i.context,d=c.gl,p=r.getSource(),f=function(i,r,n,o){let a=r.paint.get("raster-color"),s="raster-array"===i.type,l=[],h=r.paint.get("raster-resampling"),u=r.paint.get("raster-color-mix"),c=r.paint.get("raster-color-range"),d=[u[0],u[1],u[2],0],p=u[3],f="nearest"===h?o.NEAREST:o.LINEAR;if(s&&(l.push("RASTER_ARRAY"),a||l.push("RASTER_COLOR"),"linear"===h&&l.push("RASTER_ARRAY_LINEAR"),f=o.NEAREST,!c&&i.rasterLayers)){let e=i.rasterLayers.find(({id:e})=>e===r.sourceLayer);e&&e.fields&&e.fields.range&&(c=e.fields.range)}if(c=c||[0,1],a){l.push("RASTER_COLOR"),n.activeTexture.set(o.TEXTURE2),r.updateColorRamp(c);let i=r.colorRampTexture;i||(i=r.colorRampTexture=new e.T(n,r.colorRamp,o.RGBA8)),i.bind(o.LINEAR,o.CLAMP_TO_EDGE)}return{mix:d,range:c,offset:p,defines:l,resampling:f}}(p,n,c,d);if(p instanceof e.aP&&!o.length&&!l)return;let m=n.paint.get("raster-emissive-strength"),g=i.colorModeForDrapableLayerRenderPass(m),_=i.terrain&&i.terrain.renderingToTexture,y=!i.options.moving,v="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(p instanceof e.aP&&!o.length&&(p.onNorthPole||p.onSouthPole)){let e=h?i.stencilModeFor3D():t5.disabled;return void nx(!!p.onNorthPole,null,i,r,n,m,f,t4.disabled,e)}if(!o.length)return;let[x,b]=p instanceof e.aP||_?[{},o]:i.stencilConfigForOverlap(o),w=b[b.length-1].overscaledZ;u&&f.defines.push("PROJECTION_GLOBE_VIEW"),h&&f.defines.push("RENDER_CUTOFF");let T=(o,a,b)=>{for(let T of o){let o,S,E,I,C,A=T.toUnwrapped(),R=r.getTile(T);if(_&&(!R||!R.hasData()))continue;c.activeTexture.set(d.TEXTURE0);let M=function(e,i,r,n){if(e)return i instanceof eK&&e instanceof tt?i.getTextureDescriptor(e,r,!0):{texture:e.texture,mix:nv(n.mix),offset:n.offset,buffer:0,tileSize:1}}(R,p,n,f);if(!M||!M.texture)continue;let{texture:P,mix:O,offset:k,tileSize:L,buffer:D}=M;_?(o=t3.disabled,S=T.projMatrix):h?(o=new t3(d.LEQUAL,t3.ReadWrite,i.depthRangeFor3D),S=l?Float32Array.from(i.transform.expandedFarZProjMatrix):i.transform.calculateProjMatrix(A,y)):(o=i.depthModeForSublayer(T.overscaledZ-w,1===n.paint.get("raster-opacity")?t3.ReadWrite:t3.ReadOnly,d.LESS),S=i.transform.calculateProjMatrix(A,y));let z=i.terrain&&_?i.terrain.stencilModeForRTTOverlap(T):x[T.overscaledZ],F=s?0:n.paint.get("raster-fade-duration");R.registerFadeDuration(F);let B=r.findLoadedParent(T,0),N=rA(R,B,r,i.transform,F);i.terrain&&i.terrain.prepareDrawTile(),c.activeTexture.set(d.TEXTURE0),P.bind(v,d.CLAMP_TO_EDGE),c.activeTexture.set(d.TEXTURE1),B?(B.texture&&B.texture.bind(v,d.CLAMP_TO_EDGE),E=Math.pow(2,B.tileID.overscaledZ-R.tileID.overscaledZ),I=[R.tileID.canonical.x*E%1,R.tileID.canonical.y*E%1]):P.bind(v,d.CLAMP_TO_EDGE),"useMipmap"in P&&c.extTextureFilterAnisotropic&&i.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax);let j=i.transform,V=h?function(e){let i=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-i,o=.2*e.height,a=i+o;return[i,r,(a-o-i)/n,(a-i)/n]}(j):[0,0,0,0],U,G,q,$,H,Z=0;if(u&&p instanceof e.aP&&p.coordinates.length>3)U=Float32Array.from(e.bh(e.dr(new e.cp(0,0,0)))),G=Float32Array.from(j.globeMatrix),q=Float32Array.from(e.dm(j)),$=[e.ay(j.center.lng),e.aH(j.center.lat)],C=p.elevatedGlobePerspectiveTransform,H=p.elevatedGlobeGridMatrix||new Float32Array(9);else if(u){let i=e.dn(T.canonical);Z=e.dp(i.getCenter().lat),U=Float32Array.from(e.bh(e.dr(T.canonical))),G=Float32Array.from(j.globeMatrix),q=Float32Array.from(e.dm(j)),$=[e.ay(j.center.lng),e.aH(j.center.lat)],C=[0,0],H=Float32Array.from(e.dq(T.canonical,i,Z,j.worldSize/j._pixelsPerMercatorPixel))}else C=p instanceof e.aP?p.perspectiveTransform:[0,0],U=new Float32Array(16),G=new Float32Array(9),q=new Float32Array(16),$=[0,0],H=new Float32Array(9);let W=r0(S,U,G,q,H,I||[0,0],e.ah(i.transform.zoom),$,V,E||1,N,n,C,h?n.paint.get("raster-elevation"):0,2,O,k,f.range,L,D,m),X=i.isTileAffectedByFog(T),Y=i.getOrCreateProgram("raster",{defines:f.defines,overrideFog:X});if(i.uploadCommonUniforms(c,Y,A),p instanceof e.aP){let r=p.elevatedGlobeVertexBuffer,s=p.elevatedGlobeIndexBuffer;if(_||!l)p.boundsBuffer&&p.boundsSegments&&Y.draw(i,d.TRIANGLES,o,t5.disabled,g,t4.disabled,W,n.id,p.boundsBuffer,i.quadTriangleIndexBuffer,p.boundsSegments);else if(r&&s){let l=j.zoom<=e.cL?p.elevatedGlobeSegments:p.getSegmentsForLongitude(j.center.lng);l&&Y.draw(i,d.TRIANGLES,o,t5.disabled,g,a,W,n.id,r,s,l)}}else if(u){o=new t3(d.LEQUAL,t3.ReadOnly,i.depthRangeFor3D);let e=i.globeSharedBuffers;if(e){let[r,s,l]=e.getGridBuffers(Z,!1);Y.draw(i,d.TRIANGLES,o,b||z,i.colorModeForRenderPass(),a,W,n.id,r,s,l)}}else{let{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:a}=i.getTileBoundsBuffers(R);Y.draw(i,d.TRIANGLES,o,z,g,t4.disabled,W,n.id,e,r,a)}}if(!(p instanceof e.aP)&&u)for(let e of o){let o=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&nx(!0,e,i,r,n,m,f,a,b||t5.disabled),o&&nx(!1,e,i,r,n,m,f,a===t4.frontCW?t4.backCW:t4.frontCW,b||t5.disabled)}};u?T(b,i.renderElevatedRasterBackface?t4.backCW:t4.frontCW,i.stencilModeFor3D()):T(b,t4.disabled,void 0),i.resetStencilClippingMasks()},"raster-particle":function(i,r,n,o,a,s){"offscreen"===i.renderPass&&function(i,r,n,o){if(!o.length)return;let a=i.context,s=a.gl,l=r.getSource();if(!(l instanceof eK))return;let h=Math.ceil(Math.sqrt(n.paint.get("raster-particle-count"))),u=n.particlePositionRGBAImage;if(!u||u.width!==h){let i=function(e){let i=e*e,r=new Uint8Array(4*i),n=function(e){return e|=0,((e=Math.imul((e=Math.imul((e=Math.imul(0xa3c59ac3^e,0x9e3779b9))^e>>>16,0x9e3779b9))^e>>>16,0x9e3779b9))>>>0)/0x100000000},o=1/1.1;for(let e=0;e<i;e++){let i=o*(n(2*e+0)+.05),a=o*(n(2*e+1)+.05),s=255*i%1,l=255*a%1,h=a-l/255;r[4*e+0]=255*(i-s/255),r[4*e+1]=255*s,r[4*e+2]=255*h,r[4*e+3]=255*l}return r}(h);u=n.particlePositionRGBAImage=new e.r({width:h,height:h},i)}let c=n.particleFramebuffer;c?c.width!==h&&(c.destroy(),c=n.particleFramebuffer=a.createFramebuffer(h,h,!0,null)):c=n.particleFramebuffer=a.createFramebuffer(h,h,!0,null);let d=[];for(let i of o){let o=r.getTile(i);if(!(o instanceof tt))continue;let s=function(i,r,n){if(!i)return null;let o=r.getTextureDescriptor(i,n,!0);if(!o)return null;let{texture:a,mix:s,offset:l,tileSize:h,buffer:u,format:c}=o;if(!a||!c)return null;let d=!1;return"uint32"===c&&(d=!0,s[3]=0,s=rJ(e.e0,s,[0,n.paint.get("raster-particle-max-speed")]),l=rQ(e.e0,l,[0,n.paint.get("raster-particle-max-speed")])),{texture:a,textureOffset:[u/(h+2*u),h/(h+2*u)],tileSize:h,scalarData:d,scale:s,offset:l,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[c]]}}(o,l,n);if(!s)continue;let c=[o.tileSize,o.tileSize],p=n.tileFramebuffer;p||(p=n.tileFramebuffer=a.createFramebuffer(c[0],c[1],!0,null));let f=o.rasterParticleState;f||(f=o.rasterParticleState=new nw(a,i,c,u));let m=f.update(n.lastInvalidatedAt);f.particleTextureDimension!==h&&f.updateParticleTexture(i,u);let g=f.targetColorTexture;f.targetColorTexture=f.backgroundColorTexture,f.backgroundColorTexture=g;let _=f.particleTexture0;f.particleTexture0=f.particleTexture1,f.particleTexture1=_,d.push([i,s,f,m])}if(0===d.length)return;let p=e.q.now(),f=n.previousDrawTimestamp?.001*(p-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=p,n.hasColorMap()){a.activeTexture.set(s.TEXTURE0+2);let i=n.colorRampTexture;i||(i=n.colorRampTexture=new e.T(a,n.colorRamp,s.RGBA8)),i.bind(s.LINEAR,s.CLAMP_TO_EDGE)}a.bindFramebuffer.set(n.tileFramebuffer.framebuffer),function(i,r,n){var o;let a=i.context,s=a.gl,l=r.tileFramebuffer;a.activeTexture.set(s.TEXTURE0);let h={u_texture:0,u_opacity:1.05*(o=r.paint.get("raster-particle-fade-opacity-factor"))/(o+.05)},u=i.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});for(let o of n){let[,,n,c]=o;l.colorAttachment.set(n.targetColorTexture.texture),a.viewport.set([0,0,l.width,l.height]),a.clear({color:e.am.transparent}),c&&(n.backgroundColorTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),u.draw(i,s.TRIANGLES,t3.disabled,t5.disabled,t2.alphaBlended,t4.disabled,h,r.id,i.viewportBuffer,i.quadTriangleIndexBuffer,i.viewportSegments))}}(i,n,d),function(i,r,n,o){let a=i.context,s=a.gl,l=n.tileFramebuffer,h="globe"===i.transform.projection.name,u=n.paint.get("raster-particle-max-speed");for(let c of o){let[o,d,p]=c;a.activeTexture.set(s.TEXTURE0+0),d.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),l.colorAttachment.set(p.targetColorTexture.texture);let f=i.getOrCreateProgram("rasterParticleDraw",{defines:d.defines,overrideFog:!1});a.activeTexture.set(s.TEXTURE0+1);let m=d.scalarData?[]:[0,1,2,3].map(i=>e.dU[i](o));m.push(o);let g=o.canonical.x,_=o.canonical.y;for(let e of m){let a=r.getTile(h?e.wrapped():e);if(!a)continue;let l=a.rasterParticleState;if(!l)continue;let c=e.canonical.x+(1<<e.canonical.z)*(e.wrap-o.wrap),p=e.canonical.y;l.particleTexture0.bind(s.NEAREST,s.CLAMP_TO_EDGE);let m=r2(1,l.particleTexture0.size[0],[c-g,p-_],0,d.texture.size,2,u,d.textureOffset,d.scale,d.offset);f.draw(i,s.POINTS,t3.disabled,t5.disabled,t2.alphaBlended,t4.disabled,m,n.id,l.particleIndexBuffer,void 0,l.particleSegment)}}}(i,r,n,d),a.bindFramebuffer.set(n.particleFramebuffer.framebuffer),function(i,r,n,o){let a=i.context,s=a.gl,l=r.paint.get("raster-particle-max-speed"),h=o*r.paint.get("raster-particle-speed-factor")*.15,u=Math.pow(.01+ +r.paint.get("raster-particle-reset-rate-factor"),6),c=r.particleFramebuffer;for(let o of(a.viewport.set([0,0,c.width,c.height]),n)){let[,n,d]=o;a.activeTexture.set(s.TEXTURE0+0),n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),a.activeTexture.set(s.TEXTURE0+1);let p=d.particleTexture0;p.bind(s.NEAREST,s.CLAMP_TO_EDGE);let f=r3(1,p.size[0],0,n.texture.size,l,h,u,n.textureOffset,n.scale,n.offset);c.colorAttachment.set(d.particleTexture1.texture),a.clear({color:e.am.transparent}),i.getOrCreateProgram("rasterParticleUpdate",{defines:n.defines}).draw(i,s.TRIANGLES,t3.disabled,t5.disabled,t2.unblended,t4.disabled,f,r.id,i.viewportBuffer,i.quadTriangleIndexBuffer,i.viewportSegments)}}(i,n,d,f)}(i,r,n,o),"translucent"===i.renderPass&&(function(i,r,n,o,a){let s=i.context,l=s.gl,h=r.getSource().tileSize,u=5*(1-e.af(e.cx,e.cx+1,i.transform.zoom))*h+n.paint.get("raster-particle-elevation"),c=!i.options.moving,d="globe"===i.transform.projection.name;if(!o.length)return;let[p,f]=i.stencilConfigForOverlap(o),m=[];d&&m.push("PROJECTION_GLOBE_VIEW");let g=i.stencilModeFor3D();for(let o of f){let a,h,f,_,y,v,x,b=o.toUnwrapped(),w=r.getTile(o);if(!w.rasterParticleState)continue;let T=w.rasterParticleState;w.registerFadeDuration(100);let S=r.findLoadedParent(o,0),E=rA(w,S,r,i.transform,100);i.terrain&&i.terrain.prepareDrawTile(),s.activeTexture.set(l.TEXTURE0),T.targetColorTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),S&&S.rasterParticleState?(S.rasterParticleState.targetColorTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),a=Math.pow(2,S.tileID.overscaledZ-w.tileID.overscaledZ),h=[w.tileID.canonical.x*a%1,w.tileID.canonical.y*a%1]):T.targetColorTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE);let I=d?Float32Array.from(i.transform.expandedFarZProjMatrix):i.transform.calculateProjMatrix(b,c),C=i.transform,A=function(e){let i=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-i,o=.2*e.height,a=i+o;return[i,r,(a-o-i)/n,(a-i)/n]}(C),R=e.dn(o.canonical),M=e.dp(R.getCenter().lat);d?(f=Float32Array.from(e.bh(e.dr(o.canonical))),_=Float32Array.from(C.globeMatrix),y=Float32Array.from(e.dm(C)),v=[e.ay(C.center.lng),e.aH(C.center.lat)],x=Float32Array.from(e.dq(o.canonical,R,M,C.worldSize/C._pixelsPerMercatorPixel))):(f=new Float32Array(16),_=new Float32Array(9),y=new Float32Array(16),v=[0,0],x=new Float32Array(9));let P=r1(I,f,_,y,x,h||[0,0],e.ah(i.transform.zoom),v,A,a||1,E,u),O=i.isTileAffectedByFog(o),k=i.getOrCreateProgram("rasterParticle",{defines:m,overrideFog:O});if(i.uploadCommonUniforms(s,k,b),d){let e=new t3(l.LEQUAL,t3.ReadOnly,i.depthRangeFor3D),r=i.globeSharedBuffers;if(r){let[o,a,s]=r.getGridBuffers(M,!1);k.draw(i,l.TRIANGLES,e,g,t2.alphaBlended,i.renderElevatedRasterBackface?t4.frontCCW:t4.backCCW,P,n.id,o,a,s)}}else{let e=i.depthModeForSublayer(0,t3.ReadOnly),r=p[o.overscaledZ],{tileBoundsBuffer:a,tileBoundsIndexBuffer:s,tileBoundsSegments:h}=i.getTileBoundsBuffers(w);k.draw(i,l.TRIANGLES,e,r,t2.alphaBlended,t4.disabled,P,n.id,a,s,h)}}i.resetStencilClippingMasks()}(i,r,n,o),i.style.map.triggerRepaint())},background:function(i,r,n,o){let a,s=n.paint.get("background-color"),l="none"===n.paint.get("background-color-use-theme").constantOr("default"),h=n.paint.get("background-opacity"),u=n.paint.get("background-emissive-strength"),c="viewport"===n.paint.get("background-pitch-alignment");if(0===h)return;let d=i.context,p=d.gl,f=i.transform,m=f.tileSize,g=n.paint.get("background-pattern");if(void 0!==g&&(null===g||!(a=i.imageManager.getPattern(e.I.from(g.toString()),n.scope,i.style.getLut(n.scope)))))return;let _=!g&&1===s.a&&1===h&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass!==_)return;let y=t5.disabled,v=i.depthModeForSublayer(0,"opaque"===_?t3.ReadWrite:t3.ReadOnly),x=i.colorModeForDrapableLayerRenderPass(u),b=g?"backgroundPattern":"background",w,T=o;if(T||(T=Object.values(w=i.getBackgroundTiles()).map(e=>e.tileID)),g&&(d.activeTexture.set(p.TEXTURE0),i.imageManager.bind(i.context,n.scope)),c){let r=i.getOrCreateProgram(b,{overrideFog:!1,overrideRtt:!0}),o=new Float32Array(e.bx([])),d=new e.aM(0,0,0,0,0),f=g?r8(o,u,h,i,0,n.scope,a,c,{tileID:d,tileSize:m}):r6(o,u,h,s.toRenderColor(l?null:n.lut));r.draw(i,p.TRIANGLES,v,y,x,t4.disabled,f,n.id,i.viewportBuffer,i.quadTriangleIndexBuffer,i.viewportSegments)}else for(let e of T){let _=i.isTileAffectedByFog(e),T=i.getOrCreateProgram(b,{overrideFog:_}),S=e.toUnwrapped(),E=o?e.projMatrix:i.transform.calculateProjMatrix(S);i.prepareDrawTile();let I=r?r.getTile(e):w?w[e.key]:new te(e,m,f.zoom,i),C=g?r8(E,u,h,i,0,n.scope,a,c,{tileID:e,tileSize:m}):r6(E,u,h,s.toRenderColor(l?null:n.lut));i.uploadCommonUniforms(d,T,S);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:R,tileBoundsSegments:M}=i.getTileBoundsBuffers(I);T.draw(i,p.TRIANGLES,v,y,x,t4.disabled,C,n.id,A,R,M)}},sky:function(i,r,n){let o=i._atmosphere?e.ah(i.transform.zoom):1,a=n.paint.get("sky-opacity")*o;if(0===a)return;let s=i.context,l=n.paint.get("sky-type"),h=new t3(s.gl.LEQUAL,t3.ReadOnly,[0,1]),u=i.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===i.renderPass?n.needsSkyboxCapture(i)&&(function(i,r,n,o){let a=i.context,s=a.gl,l=r.skyboxFbo;if(!l){l=r.skyboxFbo=a.createFramebuffer(32,32,!0,null),r.skyboxGeometry=new nL(a),r.skyboxTexture=a.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,r.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(l.framebuffer),a.viewport.set([0,0,32,32]);let h=r.getCenter(i,!0),u=i.getOrCreateProgram("skyboxCapture"),c=new Float64Array(16);e.bx(c),e.e3(c,c,-(.5*Math.PI)),nD(i,r,u,c,h,0),e.bx(c),e.e3(c,c,.5*Math.PI),nD(i,r,u,c,h,1),e.bx(c),e.cG(c,c,-(.5*Math.PI)),nD(i,r,u,c,h,2),e.bx(c),e.cG(c,c,.5*Math.PI),nD(i,r,u,c,h,3),e.bx(c),nD(i,r,u,c,h,4),e.bx(c),e.e3(c,c,Math.PI),nD(i,r,u,c,h,5),a.viewport.set([0,0,i.width,i.height])}(i,n),n.markSkyboxValid(i)):"sky"===i.renderPass&&function(e,i,r,n,o){let a,s=e.context,l=s.gl,h=e.transform,u=e.getOrCreateProgram("skybox");s.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_CUBE_MAP,i.skyboxTexture);let c=(a=h.skyboxMatrix,{u_matrix:a,u_sun_direction:i.getCenter(e,!1),u_cubemap:0,u_opacity:n,u_temporal_offset:o});e.uploadCommonUniforms(s,u),u.draw(e,l.TRIANGLES,r,t5.disabled,e.colorModeForRenderPass(),t4.backCW,c,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(i,n,h,a,u):"gradient"===l&&"sky"===i.renderPass&&function(i,r,n,o,a){let s,l,h,u=i.context,c=u.gl,d=i.transform,p=i.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new nL(u)),u.activeTexture.set(c.TEXTURE0);let f=r.colorRampTexture;f||(f=r.colorRampTexture=new e.T(u,r.colorRamp,c.RGBA8)),f.bind(c.LINEAR,c.CLAMP_TO_EDGE);let m=(s=d.skyboxMatrix,l=r.getCenter(i,!1),h=r.paint.get("sky-gradient-radius"),{u_matrix:s,u_color_ramp:0,u_center_direction:l,u_radius:e.al(h),u_opacity:o,u_temporal_offset:a});i.uploadCommonUniforms(u,p),p.draw(i,c.TRIANGLES,n,t5.disabled,i.colorModeForRenderPass(),t4.backCW,m,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(i,n,h,a,u)},debug:function(i,r,n,o,a,s){for(let l=0;l<n.length;l++)if(a){let a=new e.am(.8*o.r,.8*o.g,.8*o.b,1);nA(i,r,n[l],o,-1,-1,s),nA(i,r,n[l],o,-1,1,s),nA(i,r,n[l],o,1,1,s),nA(i,r,n[l],o,1,-1,s),nA(i,r,n[l],a,0,0,s)}else nA(i,r,n[l],o,0,0,s)},custom:function(i,r,n,o){let a=i.context,s=n.implementation;if(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes("custom")||i.terrain&&(i.terrain.renderingToTexture||"offscreen"===i.renderPass)&&n.isDraped(r)){if("offscreen"===i.renderPass){let r=s.prerender;if(r){if(i.setCustomLayerDefaults(),a.setColorMode(i.colorModeForRenderPass()),"globe"===i.transform.projection.name){let n=i.transform.pointMerc;r.call(s,a.gl,i.transform.customLayerMatrix(),i.transform.getProjection(),i.transform.globeToMercatorMatrix(),e.ah(i.transform.zoom),[n.x,n.y],i.transform.pixelsPerMeterRatio)}else r.call(s,a.gl,i.transform.customLayerMatrix());a.setDirty(),i.setBaseState()}}else if("translucent"===i.renderPass){if(i.terrain&&i.terrain.renderingToTexture){let e=s.renderToTile;if(e){let r=o[0].canonical,n={x:r.x+o[0].wrap*(s.wrapTileId?0:1<<r.z),y:r.y,z:r.z};a.setDepthMode(t3.disabled),a.setStencilMode(t5.disabled),a.setColorMode(i.colorModeForRenderPass()),i.setCustomLayerDefaults(),e.call(s,a.gl,n),a.setDirty(),i.setBaseState()}return}i.setCustomLayerDefaults(),a.setColorMode(i.colorModeForRenderPass()),a.setStencilMode(t5.disabled);let r="3d"===s.renderingMode?new t3(i.context.gl.LEQUAL,t3.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,t3.ReadOnly);if(a.setDepthMode(r),"globe"===i.transform.projection.name){let r=i.transform.pointMerc;s.render(a.gl,i.transform.customLayerMatrix(),i.transform.getProjection(),i.transform.globeToMercatorMatrix(),e.ah(i.transform.zoom),[r.x,r.y],i.transform.pixelsPerMeterRatio)}else s.render(a.gl,i.transform.customLayerMatrix());a.setDirty(),i.setBaseState(),a.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(i,r,n,o){if("opaque"===i.renderPass)return;let a=n.paint.get("model-opacity").constantOr(1);if(0===a)return;let s=n.paint.get("model-cast-shadows");if("shadow"===i.renderPass&&(!s||i.terrain&&a<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab))return;let l=i.shadowRenderer,h=n.paint.get("model-receive-shadows");l&&(l.useNormalOffset=!0,h||(l.enabled=!1));let u=()=>{l&&(l.useNormalOffset=!0,h||(l.enabled=!0))},c=r.getSource();if("light-beam"===i.renderPass&&"batched-model"!==c.type)return;if("vector"===c.type||"geojson"===c.type)return function(i,r,n,o,a){let s=i.transform;if("mercator"!==s.projection.name)return e.w(`Drawing 3D models for ${s.projection.name} projection is not yet implemented`);let l=s.getFreeCameraOptions().position;if(!i.modelManager)return;let h=i.modelManager;n.modelManager=h;let u=i.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let c=n._unevaluatedLayout._values["model-id"],d=Object.assign({},n.layout.get("model-id").parameters),p=i.style.order.indexOf(n.fqid);for(let f of o){let o=r.getTile(f).getBucket(n);if(!o||o.projection.name!==s.projection.name)continue;let m=o.getModelUris();m&&!o.modelsRequested&&(h.addModelsFromBucket(m,a),o.modelsRequested=!0),d.zoom=function(i,r){let n=1<<i.canonical.z,o=r.getFreeCameraOptions().position,a=r.elevation,s=i.canonical.x/n,l=(i.canonical.x+1)/n,h=i.canonical.y/n,u=(i.canonical.y+1)/n,c=r._centerAltitude;if(a){let e=a.getMinMaxForTile(i);e&&e.max>c&&(c=e.max)}let d=e.aD(o.x,s,l)-o.x,p=e.aD(o.y,h,u)-o.y,f=e.c6(c,r.center.lat)-o.z;return r._zoomFromMercatorZ(Math.sqrt(d*d+p*p+f*f))}(f,s);let g=c.possiblyEvaluate(d);if(function(i,r,n){let o=r.updateZoomBasedPaintProperties(),a=function(i,r,n){let o,a,s,l=i.terrain?i.terrain.exaggeration():0;if(i.terrain&&l>0){let r=i.terrain,a=r.findDEMTileFor(n);a&&a.dem?o=e.el.create(r,n,a):l=0}if(0===l&&(r.terrainElevationMin=0,r.terrainElevationMax=0),l===r.validForExaggeration&&(0===l||o&&o._demTile&&o._demTile.tileID===r.validForDEMTile.id&&o._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(let e in r.instancesPerModel){let i=r.instancesPerModel[e];for(let e=0;e<i.instancedDataArray.length;++e){let n=(o?l*o.getElevationAt(0|i.instancedDataArray.float32[16*e],0|i.instancedDataArray.float32[16*e+1],!0,!0):0)+i.instancesEvaluatedElevation[e];i.instancedDataArray.float32[16*e+6]=n,a=a?Math.min(r.terrainElevationMin,n):n,s=s?Math.max(r.terrainElevationMax,n):n}}return r.terrainElevationMin=a||0,r.terrainElevationMax=s||0,r.validForExaggeration=l,r.validForDEMTile=o&&o._demTile?{id:o._demTile.tileID,timestamp:o._dem._timestamp}:{id:void 0,timestamp:0},!0}(i,r,n);(o||a)&&(r.uploaded=!1,r.upload(i.context))}(i,o,f),n$.shadowUniformsInitialized=!1,n$.useSingleShadowCascade=!!u&&0===u.getMaxCascadeForTile(f.toUnwrapped()),"shadow"===i.renderPass&&u){if(1===i.currentShadowCascade&&o.isInsideFirstShadowMapFrustum)continue;let r=s.calculatePosMatrix(f.toUnwrapped(),s.worldSize);if(n$.tileMatrix.set(r),n$.shadowTileMatrix=Float32Array.from(u.calculateShadowPassMatrixFromMatrix(r)),n$.aabb.min.fill(0),n$.aabb.max[0]=n$.aabb.max[1]=e.aj,n$.aabb.max[2]=0,function(i,r,n,o){if(!n.modelManager)return!0;let a=n.modelManager;if(!n.shadowRenderer)return!0;let s=n.shadowRenderer,l=r.aabb,h=!0,u=i.maxHeight;if(0===u){let e=0;for(let r in i.instancesPerModel){let i=a.getModel(r,o);i?e=Math.max(e,Math.max(Math.max(i.aabb.max[0],i.aabb.max[1]),i.aabb.max[2])):h=!1}u=i.maxScale*e*1.41+i.maxVerticalOffset,h&&(i.maxHeight=u)}l.max[2]=u,l.min[2]+=i.terrainElevationMin,l.max[2]+=i.terrainElevationMax,e.ad(l.min,l.min,r.tileMatrix),e.ad(l.max,l.max,r.tileMatrix);let c=l.intersects(s.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(i.isInsideFirstShadowMapFrustum=2===c),0===c}(o,n$,i,n.scope))continue}let _=1<<f.canonical.z,y=[((l.x-f.wrap)*_-f.canonical.x)*e.aj,(l.y*_-f.canonical.y)*e.aj,l.z*_*e.aj];for(let e in i.conflationActive&&Object.keys(o.instancesPerModel).length>0&&i.style.isLayerClipped(n,r.getSource())&&o.updateReplacement(f,i.replacementSource,p,a)&&(o.uploaded=!1,o.upload(i.context)),o.instancesPerModel){let r=o.instancesPerModel[e];r.features.length>0&&(e=g.evaluate(r.features[0].feature,{}));let s=h.getModel(e,a);if(s||h.hasURLBeenRequested(e)||o.modelUris.includes(e)||(o.modelUris.push(e),o.modelsRequested=!1),s&&s.uploaded)for(let e of s.nodes)!function e(i,r,n,o,a,s,l){let h=i.context,u="shadow"===i.renderPass,c=i.shadowRenderer,d=u&&c?c.getShadowPassDepthMode():new t3(h.gl.LEQUAL,t3.ReadWrite,i.depthRangeFor3D),p=i.isTileAffectedByFog(s);if(n.meshes)for(let e of n.meshes){let f,m,g,_=["MODEL_POSITION_ON_GPU"],y=[];o.instancedDataArray.length>20&&_.push("INSTANCED_ARRAYS");let v=io(i,r.paint.get("model-cutoff-fade-range"));if(v.shouldRenderCutoff&&_.push("RENDER_CUTOFF"),u&&c)f=i.getOrCreateProgram("modelDepth",{defines:_}),m=ne(l.shadowTileMatrix,l.shadowTileMatrix,Float32Array.from(n.matrix)),g=c.getShadowPassColorMode();else{nU(_,y,e,i,"none"===r.paint.get("model-color-use-theme").constantOr("default")?null:r.lut),f=i.getOrCreateProgram("model",{defines:_,overrideFog:p});let o=e.material,u=o.pbrMetallicRoughness,d=r.paint.get("model-opacity").constantOr(1),x=r.paint.get("model-emissive-strength").constantOr(0);m=r7(s.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,i,d,u.baseColorFactor.toRenderColor(null),o.emissiveFactor,u.metallicFactor,u.roughnessFactor,o,x,r,a),c&&(l.shadowUniformsInitialized?f.setShadowUniformValues(h,c.getShadowUniformValues()):(c.setupShadows(s.toUnwrapped(),f,"model-tile",s.overscaledZ),l.shadowUniformsInitialized=!0)),g=v.shouldRenderCutoff||d<1||"OPAQUE"!==o.alphaMode?t2.alphaBlended:t2.unblended}i.uploadCommonUniforms(h,f,s.toUnwrapped(),null,v);let x=e.material.doubleSided?t4.disabled:t4.backCCW;if(o.instancedDataArray.length>20)y.push(o.instancedDataBuffer),f.draw(i,h.gl.TRIANGLES,d,t5.disabled,g,x,m,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,y,o.instancedDataArray.length);else{let n=u?"u_instance":"u_normal_matrix";for(let a=0;a<o.instancedDataArray.length;++a)m[n]=new Float32Array(o.instancedDataArray.arrayBuffer,64*a,16),f.draw(i,h.gl.TRIANGLES,d,t5.disabled,g,x,m,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,y)}}if(n.children)for(let h of n.children)e(i,r,h,o,a,s,l)}(i,n,e,r,y,f,n$)}}}(i,r,n,o,"vector"===c.type?n.scope:""),void u();if(!c.loaded())return;if("batched-model"===c.type)return function(i,r,n,o){n.resetLayerRenderingStats(i);let a=i.context,s=i.transform,l=i.style.fog,h=i.shadowRenderer;if("mercator"!==s.projection.name)return e.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);let u=i.transform.getFreeCameraOptions().position,c=e.b$([],[u.x,u.y,u.z],i.transform.worldSize),d=e.eb([],c),p=e.bx([]),f=e.ec(s.center.lat,s.zoom),m=e.bn([],[1,1,1/f]);e.bo(p,p,d);let g=n.paint.get("model-opacity").constantOr(1),_=new t3(a.gl.LEQUAL,t3.ReadWrite,i.depthRangeFor3D),y=new t3(a.gl.LEQUAL,t3.ReadOnly,i.depthRangeFor3D),v=new e.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),x="shadow"===i.renderPass,b=x&&h?h.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),w=n.paint.get("model-front-cutoff"),T=w[2]<1,S=io(i,n.paint.get("model-cutoff-fade-range")),E=n.getLayerRenderingStats();(function(e,i,r,n){let o=e.terrain?e.terrain.exaggeration():0,a=e.transform.zoom;for(let s of n){let n=i.getTile(s).getBucket(r);n&&(n.setFilter(r.filter),e.conflationActive&&n.updateReplacement(s,e.replacementSource),n.evaluateScale(e,r),e.terrain&&o>0&&n.elevationUpdate(e.terrain,o,s,r.source),n.needsReEvaluation(e,a,r)&&n.evaluate(r))}})(i,r,n,o),function(){let u,d,I;T?(u=o.length-1,d=-1,I=-1):(u=0,d=o.length,I=1);let C=new Float64Array(16),A=e.eg(),R=new e.P(0,0);for(let M=u;M!==d;M+=I){let u=o[M],d=r.getTile(u).getBucket(n);if(!d||!d.uploaded)continue;let I=!1;h&&(I=0===h.getMaxCascadeForTile(u.toUnwrapped()));let P=s.calculatePosMatrix(u.toUnwrapped(),s.worldSize),O=d.modelTraits;!x&&T&&(e.bi(C,P),e.ad(A,c,C),R.x=A[0],R.y=A[1]);let k=[];for(let r of(d.setFilter(n.filter),d.getNodesInfo())){if(r.hiddenByReplacement||!r.node.meshes)continue;let n=r.node,o=0;i.terrain&&n.elevation&&(o=n.elevation*i.terrain.exaggeration());let a=(()=>{let i=r.aabb;return v.min=[...i.min],v.max=[...i.max],v.min[2]+=o,v.max[2]+=o,e.ad(v.min,v.min,P),e.ad(v.max,v.max,P),v})(),l=r.evaluatedScale;if(l[0]<=1&&l[1]<=1&&l[2]<=1&&0===a.intersects(b))continue;if(!x&&T){let i=1/6;r.cameraCollisionOpacity=c[0]>a.min[0]&&c[0]<a.max[0]&&c[1]>a.min[1]&&c[1]<a.max[1]&&c[2]*f<a.max[2]&&n.footprint&&e.bS(R,n.footprint)?Math.max(r.cameraCollisionOpacity-i,0):Math.min(1,r.cameraCollisionOpacity+i)}let h=[...P],u=n.anchor?n.anchor[0]:0,d=n.anchor?n.anchor[1]:0;e.bo(h,h,[u*(l[0]-1),d*(l[1]-1),o]),e.ci(l,e.eh)||e.cE(h,h,l);let p=e.az([],h,n.matrix),m=e.az([],s.expandedFarZProjMatrix,p),_=e.az([],s.expandedFarZProjMatrix,h),y=e.aA([],[u,d,o,1],m)[2];n.hidden=!1;let E=g;x||(T&&(E*=r.cameraCollisionOpacity*function(i,r,n,o){if(r.pitch<20)return 1;let a=r.getWorldToCameraMatrix();e.az(a,a,i);let s=e.ei(n.min[0],n.min[1],n.min[2],1),l=e.aA(e.ej(),s,a),h=l,u=l;s[1]=n.max[1],h=(l=e.aA(e.ej(),s,a))[1]<h[1]?l:h,u=l[1]>u[1]?l:u,s[0]=n.max[0],h=(l=e.aA(e.ej(),s,a))[1]<h[1]?l:h,u=l[1]>u[1]?l:u,s[1]=n.min[1],h=(l=e.aA(e.ej(),s,a))[1]<h[1]?l:h,u=l[1]>u[1]?l:u;let c=e.aD(o[0],0,1),d=100*r.pixelsPerMeter*e.aD(o[1],0,1),p=e.aD(o[2],0,1),f=e.ek(e.ej(),h,u,c),m=Math.tan(.5*r.fovX),g=-f[2]*m;if(0===d)return f[1]<-Math.abs(g)?p:1;let _=(-Math.abs(g)-f[1])/d,y=(e,i,r)=>(1-r)*e+r*i,v=e.aD(y(1,p,_),p,1);return y(1,v,e.aD((r.pitch-20)/20,0,1))}(h,s,r.aabb,w)),E*=function(i,r){let n=i.uniformValues.u_cutoff_params[0],o=i.uniformValues.u_cutoff_params[1],a=i.uniformValues.u_cutoff_params[2],s=i.uniformValues.u_cutoff_params[3];return o===n||s===a?1:e.aD(((r-n)/(o-n)-a)/(s-a),0,1)}(S,y)),0!==E?k.push({nodeInfo:r,depth:y,opacity:E,wvpForNode:m,wvpForTile:_,nodeModelMatrix:p,tileModelMatrix:h}):n.hidden=!0}for(let r of(x||k.sort((e,i)=>T&&(1!==e.opacity||1!==i.opacity)?1===e.opacity?-1:1===i.opacity?1:e.depth>i.depth?-1:1:e.depth<i.depth?-1:1),k)){let o=r.nodeInfo,u=o.node,c=e.az([],m,r.tileModelMatrix);e.az(c,p,c);let d=e.bi([],c);e.ee(d,d),e.cE(d,d,nH),c=e.az(c,c,u.matrix);let f="light-beam"===i.renderPass,g="none"===n.paint.get("model-color-use-theme").constantOr("default"),v=O&e.em.HasMapboxMeshFeatures,b=v?0:o.evaluatedRMEA[0][2];for(let e=0;e<u.meshes.length;++e){let p,m=u.meshes[e],w=e===u.lightMeshIndex,T=r.wvpForNode;if(w){if(!f&&!i.terrain&&i.shadowRenderer){i.currentLayer<i.firstLightBeamLayer&&(i.firstLightBeamLayer=i.currentLayer);continue}T=r.wvpForTile}else if(f)continue;let S={defines:[]},C=[];if(!x&&h&&(h.useNormalOffset=!!m.normalBuffer),nU(S.defines,C,m,i,g?null:n.lut),v||S.defines.push("DIFFUSE_SHADED"),I&&S.defines.push("SHADOWS_SINGLE_CASCADE"),E&&(x?E.numRenderedVerticesInShadowPass+=m.vertexArray.length:E.numRenderedVerticesInTransparentPass+=m.vertexArray.length),x){nq(m,r.nodeModelMatrix,i,n);continue}let A=null;if(l){let e=nV(r.nodeModelMatrix,i.transform);if(A=new Float32Array(e),"globe"!==s.projection.name){let i=m.aabb.min,r=m.aabb.max,[n,o]=l.getOpacityForBounds(e,i[0],i[1],r[0],r[1]);S.overrideFog=n>=.05||o>=.05}}let R=m.material;R.occlusionTexture&&R.occlusionTexture.offsetScale&&(p=R.occlusionTexture.offsetScale,S.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let M=i.getOrCreateProgram("model",S);!x&&h&&h.setupShadowsFromMatrix(r.tileModelMatrix,M,h.useNormalOffset),i.uploadCommonUniforms(a,M,null,A);let P=R.pbrMetallicRoughness;P.metallicFactor=.9,P.roughnessFactor=.5;let O=r7(new Float32Array(T),new Float32Array(c),new Float32Array(d),new Float32Array(u.matrix),i,r.opacity,P.baseColorFactor.toRenderColor(null),R.emissiveFactor,P.metallicFactor,P.roughnessFactor,R,b,n,[0,0,0],p);!w&&(o.hasTranslucentParts||r.opacity<1)&&M.draw(i,a.gl.TRIANGLES,_,t5.disabled,t2.disabled,t4.backCCW,O,n.id,m.vertexBuffer,m.indexBuffer,m.segments,n.paint,i.transform.zoom,void 0,C),M.draw(i,a.gl.TRIANGLES,w?y:_,t5.disabled,w||r.opacity<1||o.hasTranslucentParts?t2.alphaBlended:t2.unblended,t4.backCCW,O,n.id,m.vertexBuffer,m.indexBuffer,m.segments,n.paint,i.transform.zoom,void 0,C)}}}}()}(i,r,n,o),void u();if("model"!==c.type)return;let d=c.getModels(),p=[],f=i.transform.getFreeCameraOptions().position,m=e.b$([],[f.x,f.y,f.z],i.transform.worldSize);e.eb(m,m);let g=[],_=[],y=0;for(let r of d){let o=n.paint.get("model-rotation").constantOr(null),a=n.paint.get("model-scale").constantOr(null),s=n.paint.get("model-translation").constantOr(null);r.computeModelMatrix(i,o,a,s,!0,!0,!1);let l=e.bx([]),h=e.ec(r.position.lat,i.transform.zoom),u=e.bn([],[1,1,1/h]);for(let n of(e.bo(l,l,m),p.push({zScaleMatrix:u,negCameraPosMatrix:l}),r.nodes))!function i(r,n,o,a,s,l,h){let u;u="globe"===r.projection.name?e.ef(o,r):[...o],e.az(u,u,n.matrix);let c=e.az([],a,u);if(n.meshes)for(let i of n.meshes){if("BLEND"!==i.material.alphaMode){h.push({mesh:i,depth:0,modelIndex:s,worldViewProjection:c,nodeModelMatrix:u});continue}let n=e.ad([],i.centroid,c);!r.isOrthographic&&n[2]<=0||l.push({mesh:i,depth:n[2],modelIndex:s,worldViewProjection:c,nodeModelMatrix:u})}if(n.children)for(let e of n.children)i(r,e,o,a,s,l,h)}(i.transform,n,r.matrix,i.transform.expandedFarZProjMatrix,y,g,_);y++}if(g.sort((e,i)=>i.depth-e.depth),"shadow"!==i.renderPass){if(1===a)for(let e of _)nG(e,i,n,p[e.modelIndex],t5.disabled,i.colorModeForRenderPass());else{for(let e of _)nG(e,i,n,p[e.modelIndex],t5.disabled,t2.disabled);for(let e of _)nG(e,i,n,p[e.modelIndex],i.stencilModeFor3D(),i.colorModeForRenderPass());i.resetStencilClippingMasks()}for(let e of g)nG(e,i,n,p[e.modelIndex],t5.disabled,i.colorModeForRenderPass());u()}else{for(let e of _)nq(e.mesh,e.nodeModelMatrix,i,n);for(let e of g)nq(e.mesh,e.nodeModelMatrix,i,n);u()}}},oe={line:function(e,i,r){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(i)for(let r of i.getVisibleCoordinates()){let n=i.getTile(r).getBucket(e);if(n&&("none"!==n.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}else e.hasNonElevatedBuckets=!0},model:function(e,i,r){let n=i.getSource();if(n.loaded()){if("vector"===n.type||"geojson"===n.type)return void(r.modelManager&&r.modelManager.upload(r,"vector"===n.type?e.scope:""));if("batched-model"!==n.type&&"model"===n.type)for(let e of n.getModels())e.upload(r.context)}},raster:function(e,i,r){let n=i.getSource();if(!(n instanceof eK&&n.loaded()))return;let o=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!o)return;let a=e.paint.get("raster-array-band")||n.getInitialBand(o);if(null!=a)for(let e of i.getIds().map(e=>i.getTileByID(e)))e.updateNeeded(o,a)&&n.prepareTile(e,o,a)},"raster-particle":function(e,i,r){let n=i.getSource();if(!(n instanceof eK&&n.loaded()))return;let o=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!o)return;let a=e.paint.get("raster-particle-array-band")||n.getInitialBand(o);if(null!=a)for(let e of i.getIds().map(e=>i.getTileByID(e)))e.updateNeeded(o,a)&&n.prepareTile(e,o,a)}},ot={fill:nd};class oi{constructor(i,r,n,o,a){this.context=new na(i,r),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=a,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let s=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let e of s)this._debugParams.enabledLayers[e]=!0;for(let e of(a.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),a.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),a.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),a.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),a.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),a.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200}),s))a.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new nX(a),this.setup(),this.numSublayers=tn.maxUnderzooming+tn.maxOverzooming+1,this.depthEpsilon=1/65536,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ih(this),this._wireframeDebugCache=new nW,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let l=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,l,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=o}updateTerrain(e,i){let r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rO(this,e));let n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,i),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){let i=e.fog;if(!i||"globe"===this.transform.projection.name||1>i.getOpacity(this.transform.pitch)||.03>i.properties.get("horizon-blend"))return void(this.transform.fogCullDistSq=null);let[r,n]=i.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);let o=r+.78*(n-r);this.transform.fogCullDistSq=o*o}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new rO(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,r){if(this.width=i*e.q.devicePixelRatio,this.height=r*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let e of this.style.order)this.style._mergedLayers[e].resize()}setup(){let i=this.context,r=new e.ba;r.emplaceBack(0,0),r.emplaceBack(e.aj,0),r.emplaceBack(0,e.aj),r.emplaceBack(e.aj,e.aj),this.tileExtentBuffer=i.createVertexBuffer(r,e.bc.members),this.tileExtentSegments=e.bd.simpleSegment(0,0,4,2);let n=new e.ba;n.emplaceBack(0,0),n.emplaceBack(e.aj,0),n.emplaceBack(0,e.aj),n.emplaceBack(e.aj,e.aj),this.debugBuffer=i.createVertexBuffer(n,e.bc.members),this.debugSegments=e.bd.simpleSegment(0,0,4,5);let o=new e.ba;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(-1,1),o.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(o,e.bc.members),this.viewportSegments=e.bd.simpleSegment(0,0,4,2);let a=new e.aZ;a.emplaceBack(0,0,0,0),a.emplaceBack(e.aj,0,e.aj,0),a.emplaceBack(0,e.aj,0,e.aj),a.emplaceBack(e.aj,e.aj,e.aj,e.aj),this.mercatorBoundsBuffer=i.createVertexBuffer(a,e.bf.members),this.mercatorBoundsSegments=e.bd.simpleSegment(0,0,4,2);let s=new e.a_;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(s);let l=new e.bb;for(let e of[0,1,3,2,0])l.emplaceBack(e);this.debugIndexBuffer=i.createIndexBuffer(l),this.emptyTexture=new e.T(i,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=e.bz();let h=this.context.gl;this.stencilClearMode=new t5({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,t3.disabled,this.stencilClearMode,t2.disabled,t4.disabled,rC(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,r){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(let i of r)if(void 0===this._tileClippingMaskIDs[i.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;let n=this.context,o=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(t2.disabled),n.setDepthMode(t3.disabled);let a=this.getOrCreateProgram("clippingMask");for(let e of(this._tileClippingMaskIDs={},r)){let r=i.getTile(e),n=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:l,tileBoundsSegments:h}=this.getTileBoundsBuffers(r);a.draw(this,o.TRIANGLES,t3.disabled,new t5({func:o.ALWAYS,mask:0},n,255,o.KEEP,o.KEEP,o.REPLACE),t2.disabled,t4.disabled,rC(e.projMatrix),"$clipping",s,l,h)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,i=this.context.gl;return new t5({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);let i=this.context.gl;return new t5({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){let i=this.context.gl,r=e.sort((e,i)=>i.overscaledZ-e.overscaledZ),n=r[r.length-1].overscaledZ,o=r[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();let e={};for(let r=0;r<o;r++)e[r+n]=new t5({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[e,r]}return[{[n]:t5.disabled},r]}colorModeForRenderPass(){let i=this.context.gl;if(this._showOverdrawInspector){let r=1/8;return new t2([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new e.am(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t2.unblended:t2.alphaBlended}colorModeForDrapableLayerRenderPass(i){let r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&"translucent"===this.renderPass?new t2([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new e.am(0,0,0,void 0===i?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,i,r,n=!1){if(this.depthOcclusion)return new t3(this.context.gl.GREATER,t3.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return t3.disabled;let o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t3(r||this.context.gl.LEQUAL,i,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let i=this.context.gl,r=Math.ceil(this.width),n=Math.ceil(this.height),o=this.context.bindFramebuffer.get(),a=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===n||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==r&&0!==n&&(this.depthFBO=new no(this.context,r,n,!1,"texture"),this.depthTexture=new e.T(this.context,{width:r,height:n,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(o),i.bindTexture(i.TEXTURE_2D,a),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,r,n,0,0,r,n,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,i)=>e+i/this._fpsHistory.length,0))}render(i,r){let n=e.q.now();this._dt=n-this._timeStamp,this._timeStamp=n,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=r;let o=this.style._mergedLayers,a=!(!this.terrain||!this.terrain.enabled),s=()=>this.style._getOrder(a).filter(e=>{let i=o[e];return!(i.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[i.type]}),l=s(),h=!1,u=!1;for(let e of l){let i=o[e];"circle"===i.type&&(h=!0),"symbol"===i.type&&(i.hasInitialOcclusionOpacityProperties?u=!0:h=!0)}let c=l.map(e=>o[e]),d=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let p=0,f=!1;for(let e in d){let i=d[e];i.used&&(i.prepare(this.context),i.getSource().usedInConflation&&++p)}let m=!1;for(let e of c)e.isHidden(this.transform.zoom)||("clip"===e.type&&(m=!0),this.prepareLayer(e));let g={},_={},y={},v={},x={};for(let e in d){let i=d[e];g[e]=i.getVisibleCoordinates(),_[e]=g[e].slice().reverse(),y[e]=i.getVisibleCoordinates(!0).reverse(),v[e]=i.getShadowCasterCoordinates(),x[e]=i.sortCoordinatesByDistance(g[e])}let b=e=>{let i=this.style.getLayerSourceCache(e);return i&&i.used?i.getSource():null};if(p||m||this._clippingActiveLastFrame){let i=[],r=[],n=0;for(let e of c)this.isSourceForClippingOrConflation(e,b(e))&&(i.push(e),r.push(n)),n++;if(i&&(m||i.length>1)||this._clippingActiveLastFrame){m=!1;let n=[];for(let o=0;o<i.length;o++){let a=i[o],s=r[o],l=this.style.getLayerSourceCache(a);if(!l||!l.used||!l.getSource().usedInConflation&&"clip"!==a.type)continue;let h=e.ev,u=e.bQ.None,c=[],d=!0;if("clip"===a.type){for(let i of(h=s,a.layout.get("clip-layer-types")))u|="model"===i?e.bQ.Model:"symbol"===i?e.bQ.Symbol:e.bQ.FillExtrusion;for(let e of a.layout.get("clip-layer-scope"))c.push(e);a.isHidden(this.transform.zoom)?d=!1:m=!0}d&&n.push({layer:a.fqid,cache:l,order:h,clipMask:u,clipScope:c})}this.replacementSource.setSources(n),f=!0}}this._clippingActiveLastFrame=m,f||this.replacementSource.clear(),this.conflationActive=f,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<c.length;e++){let i=c[e],r=i.cutoffRange();if(this.longestCutoffRange=Math.max(r,this.longestCutoffRange),r>0){let e=b(i);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),i.minzoom&&(this.minCutoffZoom=Math.max(i.minzoom,this.minCutoffZoom))}i.is3D(a)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}let w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,c=(l=s()).map(e=>o[e]));let T=this._shadowRenderer;if(T)for(let e in T.updateShadowParameters(this.transform,this.style.directionalLight),d)for(let i of g[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(i)||e),T.addShadowReceiver(i.toUnwrapped(),e.min,e.max)}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new nj(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);let S=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),E=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(S&&!this._snow&&(this._snow=new n9(this)),!S&&this._snow&&(this._snow.destroy(),delete this._snow),E&&!this._rain&&(this._rain=new n6(this)),!E&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!U.has(this.context.gl))return;for(let e of(this.renderPass="offscreen",c)){let r=i.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;let n=r?_[r.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||n&&n.length)&&this.renderLayer(this,r,e,n)}this.depthRangeFor3D=[0,1-(c.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let I="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),C=(()=>{if(r.showOverdrawInspector)return e.am.black;let i=this.style.fog;if(i&&this.transform.projection.supportsFog){let r=this.style.getLut(i.scope);if(!I){let n="none"===i.properties.get("color-use-theme"),o=i.properties.get("color").toRenderColor(n?null:r).toArray01();return new e.am(...o)}if(I){let n="none"===i.properties.get("space-color-use-theme"),o=i.properties.get("space-color").toRenderColor(n?null:r).toArray01();return new e.am(...o)}}return e.am.transparent})();if(this.context.clear({color:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){let e=c[this.currentLayer],r=i.getLayerSourceCache(e);if(e.isSky())continue;let n=r?(e.is3D(a)?x:_)[r.id]:void 0;this._renderTileClippingMasks(e,r,n),this.renderLayer(this,r,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){let e=c[this.currentLayer],r=i.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,r,e,r?_[r.id]:void 0)}function A(e,i){let r;return i&&(r=("symbol"===e.type?y:e.is3D(a)?x:_)[i.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<l.length;){let e=c[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){let r=i.getLayerSourceCache(e);this.renderLayer(this,r,e,A(e,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let R=0;T&&(R=T.getShadowCastingLayerCount());let M=!1,P=-1;for(let e=0;e<l.length;++e){let i=c[e];i.isHidden(this.transform.zoom)||i.is3D(a)&&(P=e)}u&&-1===P&&(h=!0);let O=!1;for(;this.currentLayer<l.length;){let e=c[this.currentLayer],r=i.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!O&&e.is3D(a)&&!a){let e=this.currentLayer,i=e=>{for(this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){let i=c[this.currentLayer];if(ot[i.type]){let r=this.style.getLayerSourceCache(i);ot[i.type](this,r,i,A(i,r),e)}}};i("initialize"),i("reset"),this.currentLayer=e,O=!0}if(h&&!M&&this.terrain&&!this.transform.isOrthographic&&(M=!0,this.blitDepth()),u&&-1!==P&&this.currentLayer===P+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,r,r?g[r.id]:void 0),this.renderLayer(this,r,e,A(e,r)),!this.terrain&&T&&R>0&&e.hasShadowPass()&&0==--R&&(T.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){let e=c[this.currentLayer];if(!e.hasLightBeamPass())continue;let r=i.getLayerSourceCache(e);this.renderLayer(this,r,e,r?_[r.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let e=this.currentLayer;for(let e of(this.depthOcclusion=!0,this.layersWithOcclusionOpacity)){this.currentLayer=e;let r=c[this.currentLayer],n=i.getLayerSourceCache(r),o=n?_[n.id]:void 0;this.terrain||this._renderTileClippingMasks(r,n,n?g[n.id]:void 0),this.renderLayer(this,n,r,o)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;c.forEach(e=>{let n=i.getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<n.getSource().maxzoom)&&(r=n)}),r&&this.options.showTileBoundaries&&n7.debug(this,r,r.getVisibleCoordinates(),e.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&n7.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){var i,r;let n=e.transform.padding;nR(e,e.transform.height-(n.top||0),3,nT),nR(e,n.bottom||0,3,nS),nM(e,n.left||0,3,nE),nM(e,e.transform.width-(n.right||0),3,nI);let o=e.transform.centerPoint;i=o.x,r=e.transform.height-o.y,nP(e,i-1,r-10,2,20,nC),nP(e,i-10,r-1,20,2,nC)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),f||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);let{unsupportedLayers:i}=this.transform.projection,r=!i||!i.includes(e.type);if(oe[e.type]&&(r||this.terrain&&"custom"===e.type)){let i=this.style.getLayerSourceCache(e);oe[e.type](e,i,this)}this.gpuTimingEnd()}renderLayer(e,i,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(r.type)&&(!e.terrain||"custom"!==r.type)||"clip"===r.type||n7[r.type](e,i,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery,r=this.context.gl,n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(i.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let e=this.context.extTimerQuery,i=this.context.gl,r=i.createQuery();this.deferredRenderGpuTimeQueries.push(r),i.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){let e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){let i={};for(let r in e){let n=e[r],o=this.context.extTimerQuery,a=o.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;o.deleteQueryEXT(n.query),i[r]=a}return i}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;let i=this.context.gl,r=0;for(let n of e)r+=i.getQueryParameter(n,i.QUERY_RESULT)/1e6,i.deleteQuery(n);return r}translatePosMatrix(i,r,n,o,a){if(!n[0]&&!n[1])return i;let s=a?"map"===o?this.transform.angle:0:"viewport"===o?-this.transform.angle:0;if(s){let e=Math.sin(s),i=Math.cos(s);n=[n[0]*i-n[1]*e,n[0]*e+n[1]*i]}let l=[a?n[0]:e.aw(r,n[0],this.transform.zoom),a?n[1]:e.aw(r,n[1],this.transform.zoom),0],h=new Float32Array(16);return e.bo(h,i,l),h}saveTileTexture(e){let i=e.size[0],r=this._tileTextures[i];r?r.push(e):this._tileTextures[i]=[e]}getTileTexture(e){let i=this._tileTextures[e];return i&&i.length>0?i.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,i,r){let n=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||o.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&o.push("GLOBE"),this._fogVisible&&!n&&(void 0===i||i)&&o.push("FOG","FOG_DITHERING"),n&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(e,i){this.cache=this.cache||{};let r=i&&i.defines||[],n=i&&i.config,o=this.currentGlobalDefines(e,i&&i.overrideFog,i&&i.overrideRtt).concat(r),a=rD.cacheKey(iG[e],e,o,n);return this.cache[a]||(this.cache[a]=new rD(this.context,e,iG[e],n,nt[e],o)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,r){if(this.style.enable3dLights()){let n=this.style.directionalLight,o=this.style.ambientLight;if(n&&o){let a=((i,r,n)=>{let o=i.properties.get("direction"),a="none"===i.properties.get("color-use-theme"),s=i.properties.get("color").toRenderColor(a?null:n.getLut(i.scope)).toArray01(),l=i.properties.get("intensity"),h="none"===r.properties.get("color-use-theme"),u=r.properties.get("color").toRenderColor(h?null:n.getLut(r.scope)).toArray01(),c=r.properties.get("intensity"),d=[o.x,o.y,o.z],p=e.dw(u,c),f=e.dw(s,l);return{u_lighting_ambient_color:p,u_lighting_directional_dir:d,u_lighting_directional_color:f,u_ground_radiance:function(i,r,n){let o=function(i,r,n){let o=e.bE(r,i),a=e.bE(n,[.2126,.7152,.0722]),s=(e,i,r)=>(1-r)*e+r*i,l=s(1-.3*Math.min(a,1),1,Math.min(o+1,1));return s(.92,1,Math.asin(e.aD(r[2],-1,1))/Math.PI+.5)*l}(i,[0,0,1],r),a=[0,0,0];e.b$(a,n.slice(0,3),o);let s=[0,0,0];e.b$(s,r.slice(0,3),i[2]);let l=[0,0,0];return e.cU(l,a,s),e.cX(l)}(d,f,p)}})(n,o,this.style);r.setLightsUniformValues(i,a)}}}uploadCommonUniforms(i,r,n,o,a){if(this.uploadCommonLightUniforms(i,r),this.terrain&&this.terrain.renderingToTexture)return;let s=this.style.fog;if(s){let a=s.getOpacity(this.transform.pitch),l=((i,r,n,o,a,s,l,h,u,c,d,p)=>{let f=i.transform,m="none"===r.properties.get("color-use-theme"),g=r.properties.get("color").toRenderColor(m?null:i.style.getLut(r.scope)).toArray01();g[3]=o;let _=i.frameCounter/1e3%1,[y,v]=r.properties.get("vertical-range");return{u_fog_matrix:n?f.calculateFogTileMatrix(n):p||i.identityMat,u_fog_range:r.getFovAdjustedRange(f._fov),u_fog_color:g,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(y,v),v],u_fog_temporal_offset:_,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:h,u_globe_pos:u,u_globe_radius:c,u_viewport:d,u_globe_transition:e.ah(f.zoom),u_is_globe:+("globe"===f.projection.name)}})(this,s,n,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],o);r.setFogUniformValues(i,l)}a&&r.setCutoffUniformValues(i,a.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){let e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){let e=this.context.gl,i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){let e=this._backgroundTiles,i=this._backgroundTiles={};for(let r of this.transform.coveringTiles({tileSize:512}))i[r.key]=e[r.key]||new te(r,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,i){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer)&&(!i||"batched-model"!==i.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let i=this._cachedTileFogOpacities[e.key];return i||(this._cachedTileFogOpacities[e.key]=i=this.style.fog.getOpacityForTile(e)),i[0]>=.05||i[1]>=.05}setupDepthForOcclusion(e,i,r){var n;let o=this.context,a=o.gl,s=!!r;r||(r={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),o.activeTexture.set(a.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),r.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],r.u_depth_range_unpack=[2/((n=this.depthRangeFor3D)[1]-n[0]),-1-2*n[0]/(n[1]-n[0])],r.u_occluder_half_size=.5*this.occlusionParams.occluderSize,r.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE0),s||i.setTerrainUniformValues(o,r)}}function or(e,i){let r=!1,n=null,o=()=>{n=null,r&&(e(),n=setTimeout(o,i),r=!1)};return()=>(r=!0,n||o(),n)}class on{constructor(i){this._hashName=i&&encodeURIComponent(i),e.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=or(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map&&(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0),this}getHashString(){let e=this._map;if(!e)return"";let i=oo(e);if(this._hashName){let e=this._hashName,r=!1,n=location.hash.slice(1).split("&").map(n=>{let o=n.split("=")[0];return o===e?(r=!0,`${o}=${i}`):n}).filter(e=>e);return r||n.push(`${e}=${i}`),`#${n.join("&")}`}return`#${i}`}_getCurrentHash(){let e=location.hash.replace("#","");if(this._hashName){let i;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(i=e)}),(i&&i[1]||"").split("/")}return e.split("/")}_onHashChange(){let e=this._map;if(!e)return!1;let i=this._getCurrentHash();if(i.length>=3&&!i.some(e=>isNaN(Number(e)))){let r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(i[3]||0):e.getBearing();return e.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:r,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function oo(e,i){let r=e.getCenter(),n=Math.round(100*e.getZoom())/100,o=Math.pow(10,Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10)),a=Math.round(r.lng*o)/o,s=Math.round(r.lat*o)/o,l=e.getBearing(),h=e.getPitch(),u=i?`/${a}/${s}/${n}`:`${n}/${s}/${a}`;return(l||h)&&(u+="/"+Math.round(10*l)/10),h&&(u+=`/${Math.round(h)}`),u}let oa={linearity:.3,easing:e.ew(0,0,.3,1)},os=e.l({deceleration:2500,maxSpeed:1400},oa),ol=e.l({deceleration:20,maxSpeed:1400},oa),oh=e.l({deceleration:1e3,maxSpeed:360},oa),ou=e.l({deceleration:1e3,maxSpeed:90},oa);class oc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:i})}_drainInertiaBuffer(){let i=this._inertiaBuffer,r=e.q.now();for(;i.length>0&&r-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);let n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,o={};if(r.pan.mag()){let a=op(r.pan.mag(),n,e.l({},os,i||{}));o.offset=r.pan.mult(a.amount/r.pan.mag()),o.center=this._map.transform.center,od(o,a)}if(r.zoom){let e=op(r.zoom,n,ol);o.zoom=this._map.transform.zoom+e.amount,od(o,e)}if(r.bearing){let i=op(r.bearing,n,oh);o.bearing=this._map.transform.bearing+e.aD(i.amount,-179,179),od(o,i)}if(r.pitch){let e=op(r.pitch,n,ou);o.pitch=this._map.transform.pitch+e.amount,od(o,e)}if(o.zoom||o.bearing){let e=void 0===r.pinchAround?r.around:r.pinchAround;o.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),o.noMoveStart=!0,o}}function od(e,i){(!e.duration||e.duration<i.duration)&&(e.duration=i.duration,e.easing=i.easing)}function op(i,r,n){let{maxSpeed:o,linearity:a,deceleration:s}=n,l=e.aD(i*a/(r/1e3),-o,o),h=Math.abs(l)/(s*a);return{easing:n.easing,duration:1e3*h,amount:h/2*l}}class of extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,r,n,o={}){let a=x(r.getCanvasContainer(),n);super(i,e.l({point:a,lngLat:r.unproject(a),originalEvent:n},o)),this._defaultPrevented=!1,this.target=r}}class om extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,r,n){let o="touchend"===i?n.changedTouches:n.touches,a=b(r.getCanvasContainer(),o),s=a.map(e=>r.unproject(e)),l=a.reduce((e,i,r,n)=>e.add(i.div(n.length)),new e.P(0,0));super(i,{points:a,point:l,lngLats:s,lngLat:r.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class og extends e.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i){super("wheel",{originalEvent:i}),this._defaultPrevented=!1}}class o_{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new og(this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new of(e.type,this._map,e))}mouseup(e){this._map.fire(new of(e.type,this._map,e))}preclick(i){let r=e.l({},i);r.type="preclick",this._map.fire(new of(r.type,this._map,r))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(e),this._map.fire(new of(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new of(e.type,this._map,e))}mouseover(e){this._map.fire(new of(e.type,this._map,e))}mouseout(e){this._map.fire(new of(e.type,this._map,e))}touchstart(e){return this._firePreventable(new om(e.type,this._map,e))}touchmove(e){this._map.fire(new om(e.type,this._map,e))}touchend(e){this._map.fire(new om(e.type,this._map,e))}touchcancel(e){this._map.fire(new om(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oy{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new of(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new of("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new of(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ov{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&0===e.button&&(g(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;let r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=d("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));let o=Math.min(r.x,i.x),a=Math.max(r.x,i.x),s=Math.min(r.y,i.y),l=Math.max(r.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${o}px,${s}px)`,this._box.style.width=a-o+"px",this._box.style.height=l-s+"px")})}mouseupWindow(i,r){if(!this._active)return;let n=this._startPos;if(n&&0===i.button){if(this.reset(),v(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:i})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_(),delete this._startPos,delete this._lastPos}_fireEvent(i,r){return this._map.fire(new e.A(i,{originalEvent:r}))}}function ox(e,i){let r={};for(let n=0;n<e.length;n++)r[e[n].identifier]=i[n];return r}class ob{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),n.length===this.numTouches&&(this.centroid=function(i){let r=new e.P(0,0);for(let e of i)r._add(e);return r.div(i.length)}(r),this.touches=ox(n,r)))}touchmove(e,i,r){if(this.aborted||!this.centroid)return;let n=ox(r,i);for(let e in this.touches){let i=n[e];(!i||i.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,i,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){let e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class ow{constructor(e){this.singleTap=new ob(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,i,r){this.singleTap.touchstart(e,i,r)}touchmove(e,i,r){this.singleTap.touchmove(e,i,r)}touchend(e,i,r){let n=this.singleTap.touchend(e,i,r);if(n){let i=e.timeStamp-this.lastTime<500,r=!this.lastTap||30>this.lastTap.dist(n);if(i&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class oT{constructor(){this._zoomIn=new ow({numTouches:1,numTaps:2}),this._zoomOut=new ow({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,r){this._zoomIn.touchstart(e,i,r),this._zoomOut.touchstart(e,i,r)}touchmove(e,i,r){this._zoomIn.touchmove(e,i,r),this._zoomOut.touchmove(e,i,r)}touchend(e,i,r){let n=this._zoomIn.touchend(e,i,r),o=this._zoomOut.touchend(e,i,r);return n?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:i=>i.easeTo({duration:300,zoom:i.getZoom()+1,around:i.unproject(n)},{originalEvent:e})}):o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:i=>i.easeTo({duration:300,zoom:i.getZoom()-1,around:i.unproject(o)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let oS={0:1,2:2},oE={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class oI{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,i){return!1}_move(e,i){return{}}mousedown(e,i){if(this._lastPoint)return;let r=w(e);this._correctButton(e,r)&&(this._lastPoint=i,this._eventButton=r)}mousemoveWindow(e,i){let r=this._lastPoint;if(r){if(e.preventDefault(),null!=this._eventButton&&function(e,i){let r=oS[i];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(i.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(r,i)}}mouseupWindow(e){this._lastPoint&&w(e)===this._eventButton&&(this._moved&&v(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oC extends oI{mousedown(e,i){super.mousedown(e,i),this._lastPoint&&(this._active=!0)}_correctButton(e,i){return 0===i&&!e.ctrlKey}_move(e,i){return{around:i,panDelta:i.sub(e)}}}class oA extends oI{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?oE[e.pitchRotateKey]:void 0}_correctButton(e,i){return this._pitchRotateKey?0===i&&e[this._pitchRotateKey]:0===i&&e.ctrlKey||2===i}_move(e,i){let r=.8*(i.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class oR extends oI{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?oE[e.pitchRotateKey]:void 0}_correctButton(e,i){return this._pitchRotateKey?0===i&&e[this._pitchRotateKey]:0===i&&e.ctrlKey||2===i}_move(e,i){let r=-.5*(i.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class oM{constructor(i,r){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),e.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,i,r){return this._calculateTransform(e,i,r)}touchmove(i,r,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.ex())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,r,n)}}touchend(e,i,r){this._calculateTransform(e,i,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,r,n){n.length>0&&(this._active=!0);let o=ox(n,r),a=new e.P(0,0),s=new e.P(0,0),l=0;for(let e in o){let i=o[e],r=this._touches[e];r&&(a._add(i),s._add(i.sub(r)),l++,o[e]=i)}if(this._touches=o,l<this._minTouches||!s.mag())return;let h=s.div(l);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(l),panDelta:h}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class oP{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,i,r){return{}}touchstart(e,i,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,r){let n=this._firstTwoTouches;if(!n)return;e.preventDefault();let[o,a]=n,s=oO(r,i,o),l=oO(r,i,a);if(!s||!l)return;let h=this._aroundCenter?null:s.add(l).div(2);return this._move([s,l],h,e)}touchend(e,i,r){if(!this._firstTwoTouches)return;let[n,o]=this._firstTwoTouches,a=oO(r,i,n),s=oO(r,i,o);a&&s||(this._active&&v(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function oO(e,i,r){for(let n=0;n<e.length;n++)if(e[n].identifier===r)return i[n]}function ok(e,i){return Math.log(e/i)/Math.LN2}class oL extends oP{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){let r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(.1>Math.abs(ok(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:ok(this._distance,r),pinchAround:i}}}function oD(e,i){return 180*e.angleWith(i)/Math.PI}class oz extends oP{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i){let r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:oD(this._vector,r),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let i=25/(Math.PI*this._minDiameter)*360,r=this._startVector;return!!r&&Math.abs(oD(e,r))<i}}function oF(e){return Math.abs(e.y)>Math.abs(e.x)}class oB extends oP{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,oF(e[0].sub(e[1]))&&(this._valid=!1)}_move(i,r,n){let o=this._lastPoints;if(!o)return;let a=i[0].sub(o[0]),s=i[1].sub(o[1]);return this._map._cooperativeGestures&&!e.ex()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(a,s,n.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:-((a.y+s.y)/2*.5)})}gestureBeginsVertically(e,i,r){if(void 0!==this._valid)return this._valid;let n=e.mag()>=2,o=i.mag()>=2;if(!n&&!o)return;if(!n||!o)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;let a=e.y>0==i.y>0;return oF(e)&&oF(i)&&a}}let oN=100,oj=15,oV=10;class oU{constructor(){this._panStep=oN,this._bearingStep=oj,this._pitchStep=oV,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,r=0,n=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:s=>{let l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:oG,zoom:i?Math.round(l)+i*(e.shiftKey?2:1):l,bearing:s.getBearing()+r*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-o*this._panStep,-a*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function oG(e){return e*(2-e)}let oq=1/450;class o${constructor(i,r){this._map=i,this._el=i.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=oq,e.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||e.ex()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,n=e.q.now(),o=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&4>Math.abs(r)?this._type="trackpad":o>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=200>Math.abs(o*r)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),i.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=i,this._delta-=r,this._active||this._start(i)),i.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=x(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let r=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){let e="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);let o=r(),a=Math.pow(2,o),s="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=o,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let n="number"==typeof this._targetZoom?this._targetZoom:r(),o=this._startZoom,a=this._easing,s,l=!1;if("wheel"===this._type&&o&&a){let i=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),r=a(i);s=e.ai(o,n,r),i<1?this._frameId||(this._frameId=!0):l=!0}else s=n,l=!0;this._active=!0,l&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let h=s-r();return h*this._lastDelta<0&&(h=0),{noInertia:!0,needsRenderFrame:!l,zoomDelta:h,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let r=e.ey;if(this._prevEase){let i=this._prevEase,n=(e.q.now()-i.start)/i.duration,o=i.easing(n+.01)-i.easing(n),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);r=e.ew(a,s,.25,1)}return this._prevEase={start:e.q.now(),duration:i,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class oH{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class oZ{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,i){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oW{constructor(){this._tap=new ow({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,i,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=i[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,i,r))}touchmove(e,i,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;let n=i[0],o=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:o/128}}}else this._tap.touchmove(e,i,r)}touchend(e,i,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,i,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oX{constructor(e,i,r){this._el=e,this._mousePan=i,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class oY{constructor(e,i,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=i,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oK{constructor(e,i,r,n){this._el=e,this._touchZoom=i,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let oJ=e=>e.zoom||e.drag||e.pitch||e.rotate;class oQ extends e.A{}class o0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,r){let n=e.at([],r,i);this.radius=e.ae(n[2]<0?e.eA([],n,this.constants):[n[0],n[1],0])}projectRay(i){e.eA(i,i,this.constants),e.au(i,i),e.eB(i,i,this.constants);let r=e.b$([],i,this.radius);if(r[2]>0){let i=e.b$([],[0,0,1],e.bE(r,[0,0,1])),n=e.b$([],e.au([],[r[0],r[1],0]),this.radius),o=e.cU([],r,e.b$([],e.at([],e.cU([],n,i),r),2));r[0]=o[0],r[1]=o[1]}return r}}function o1(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class o2{constructor(i,r){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new oc(i),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new o0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.aV(["handleEvent","handleWindowEvent"],this);let n=this._el;for(let[e,i,r]of(this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]],this._listeners)){let n=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(i,n,r)}}destroy(){for(let[e,i,r]of this._listeners){let n=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(i,n,r)}}_addDefaultHandlers(e){let i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new o_(i,e));let n=i.boxZoom=new ov(i,e);this._add("boxZoom",n);let o=new oT,a=new oZ;i.doubleClickZoom=new oH(a,o),this._add("tapZoom",o),this._add("clickZoom",a);let s=new oW;this._add("tapDragZoom",s);let l=i.touchPitch=new oB(i);this._add("touchPitch",l);let h=new oA(e),u=new oR(e);i.dragRotate=new oY(e,h,u),this._add("mouseRotate",h,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);let c=new oC(e),d=new oM(i,e);i.dragPan=new oX(r,c,d),this._add("mousePan",c),this._add("touchPan",d,["touchZoom","touchRotate"]);let p=new oz,f=new oL;i.touchZoomRotate=new oK(r,f,p,s),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new oy(i));let m=i.scrollZoom=new o$(i,this);this._add("scrollZoom",m,["mousePan"]);let g=i.keyboard=new oU;for(let r of(this._add("keyboard",g),["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"]))e.interactive&&e[r]&&i[r].enable(e[r])}_add(e,i,r){this._handlers.push({handlerName:e,handler:i,allowed:r}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(let{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oJ(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,i,r){for(let n in e)if(n!==r&&(!i||0>i.indexOf(n)))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){let i=[];for(let r of e)this._el.contains(r.target)&&i.push(r);return i}handleEvent(e,i){this._updatingCamera=!0;let r="renderFrame"===e.type,n=r?void 0:e,o={needsRenderFrame:!1},a={},s={},l=e.touches?this._getMapTouches(e.touches):void 0,h=l?b(this._el,l):r?void 0:x(this._el,e);for(let{handlerName:r,handler:u,allowed:c}of this._handlers){let d;u.isEnabled()&&(this._blockedByActive(s,c,r)?u.reset():u[i||e.type]&&(d=u[i||e.type](e,h,l),this.mergeHandlerResult(o,a,d,r,n),d&&d.needsRenderFrame&&this._triggerRenderFrame()),(d||u.isActive())&&(s[r]=u))}let u={};for(let e in this._previousActiveHandlers)s[e]||(u[e]=n);this._previousActiveHandlers=s,(Object.keys(u).length||o1(o))&&(this._changes.push([o,a,u]),this._triggerRenderFrame()),(Object.keys(s).length||o1(o))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:c}=o;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))}mergeHandlerResult(i,r,n,o,a){if(!n)return;e.l(i,n);let s={handlerName:o,originalEvent:n.originalEvent||a};void 0!==n.zoomDelta&&(r.zoom=s),void 0!==n.panDelta&&(r.drag=s),void 0!==n.pitchDelta&&(r.pitch=s),void 0!==n.bearingDelta&&(r.rotate=s)}_applyChanges(){let i={},r={},n={};for(let[o,a,s]of this._changes)o.panDelta&&(i.panDelta=(i.panDelta||new e.P(0,0))._add(o.panDelta)),o.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+o.pitchDelta),void 0!==o.around&&(i.around=o.around),void 0!==o.aroundCoord&&(i.aroundCoord=o.aroundCoord),void 0!==o.pinchAround&&(i.pinchAround=o.pinchAround),o.noInertia&&(i.noInertia=o.noInertia),e.l(r,a),e.l(n,s);this._updateMapTransform(i,r,n),this._changes=[]}_updateMapTransform(i,r,n){let o,a=this._map,s=a.transform,l=e=>[e.x,e.y,e.z];if((e=>{let i=this._eventsInProgress.drag;return i&&!this._handlersById[i.handlerName].isActive()})()&&!o1(i)){let e=s.zoom;s.cameraElevationReference="sea",null!=this._originalZoom&&s._orthographicProjectionAtLowPitch&&"globe"!==s.projection.name&&0===s.pitch?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),e!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&a._stop(!0),!o1(i))return void this._fireEvents(r,n,!0);let{panDelta:h,zoomDelta:u,bearingDelta:c,pitchDelta:d,around:p,aroundCoord:f,pinchAround:m}=i;s._isCameraConstrained&&(u>0&&(u=0),s._isCameraConstrained=!1),void 0!==m&&(p=m),(u||r[o="drag"]&&!this._eventsInProgress[o])&&p&&(this._dragOrigin=l(s.pointCoordinate3D(p)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",a._stop(!0),p=p||a.transform.centerPoint,c&&(s.bearing+=c),d&&(s.pitch+=d),s._updateCameraState();let g=[0,0,0];if(h)if("mercator"===s.projection.name){let e=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(p).dir),i=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(p.sub(h)).dir);g[0]=i[0]-e[0],g[1]=i[1]-e[1]}else{let i=s.pointCoordinate(p);if("globe"===s.projection.name){h=h.rotate(-s.angle);let r=s._pixelsPerMercatorPixel/s.worldSize;g[0]=-h.x*e.ez(e.aY(i.y))*r,g[1]=-h.y*e.ez(s.center.lat)*r}else{let e=s.pointCoordinate(p.sub(h));i&&e&&(g[0]=e.x-i.x,g[1]=e.y-i.y)}}let _=s.zoom,y=[0,0,0];if(u){let i=l(f||s.pointCoordinate3D(p)),r={dir:e.au([],e.at([],i,s._camera.position))};if(r.dir[2]<0){let n=s.zoomDeltaToMovement(i,u);e.b$(y,r.dir,n)}}let v=e.cU(g,g,y);s._translateCameraConstrained(v),u&&Math.abs(s.zoom-_)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(r,n,!0)}_fireEvents(i,r,n){let o,a=oJ(this._eventsInProgress),s=oJ(i),l={};for(let e in i){let{originalEvent:r}=i[e];this._eventsInProgress[e]||(l[`${e}start`]=r),this._eventsInProgress[e]=i[e]}for(let e in!a&&s&&this._fireEvent("movestart",s.originalEvent),l)this._fireEvent(e,l[e]);for(let e in s&&this._fireEvent("move",s.originalEvent),i){let{originalEvent:r}=i[e];this._fireEvent(e,r)}let h={};for(let e in this._eventsInProgress){let{handlerName:i,originalEvent:n}=this._eventsInProgress[e];this._handlersById[i].isActive()||(delete this._eventsInProgress[e],o=r[i]||n,h[`${e}end`]=o)}for(let e in h)this._fireEvent(e,h[e]);let u=oJ(this._eventsInProgress);if(n&&(a||s)&&!u){this._updatingCamera=!0;let i=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;i?(r(i.bearing||this._map.getBearing())&&(i.bearing=0),this._map.easeTo(i,{originalEvent:o})):(this._map.fire(new e.A("moveend",{originalEvent:o})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,r){this._map.fire(new e.A(i,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new oQ("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}let o3="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class o5 extends e.E{constructor(i,r){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,e.aV(["_renderFrameCallback"],this)}getCenter(){return new e.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}panBy(i,r,n){return i=e.P.convert(i).mult(-1),this.panTo(this.transform.center,e.l({offset:i},r),n)}panTo(i,r,n){return this.easeTo(e.l({center:i},r),n)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(i,r,n){return this.easeTo(e.l({zoom:i},r),n)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(i,r,n){return this.easeTo(e.l({bearing:i},r),n)}resetNorth(i,r){return this.rotateTo(0,e.l({duration:1e3},i),r),this}resetNorthPitch(i,r){return this.easeTo(e.l({bearing:0,pitch:0,duration:1e3},i),r),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}cameraForBounds(i,r){i=e.aG.convert(i);let n=r&&r.bearing||0,o=r&&r.pitch||0,a=i.getNorthWest(),s=i.getSouthEast();return this._cameraForBounds(this.transform,a,s,n,o,r)}_extendPadding(i){let r={top:0,right:0,bottom:0,left:0};return null==i?e.l({},r,this.transform.padding):"number"==typeof i?{top:i,bottom:i,right:i,left:i}:e.l({},r,i)}_extendCameraOptions(i){return(i=e.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(e,i){let r=i.max[0]-i.min[0],n=i.max[1]-i.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(i,r,n,o,a,s){let l=i.clone(),h=this._extendCameraOptions(s);l.bearing=o,l.pitch=a;let u=e.cd.convert(r),c=e.cd.convert(n),d=.5*(u.lat+c.lat),p=.5*(u.lng+c.lng),f=e.eC(d,p),m=e.au([],f),g=e.au([],e.bG([],m,[0,1,0])),_=e.bG([],g,m),y=[g[0],g[1],g[2],0,_[0],_[1],_[2],0,m[0],m[1],m[2],0,0,0,0,1],v=[f,e.eC(u.lat,u.lng),e.eC(c.lat,u.lng),e.eC(c.lat,c.lng),e.eC(u.lat,c.lng),e.eC(d,u.lng),e.eC(d,c.lng),e.eC(u.lat,p),e.eC(c.lat,p)],x=e.cV.fromPoints(v.map(i=>[e.bE(g,i),e.bE(_,i),e.bE(m,i)])),b=e.ad([],x.center,y);0===e.eD(b)&&e.eE(b,0,0,1),e.au(b,b),e.b$(b,b,e.aE),l.center=e.eF(b);let w=l.getWorldToCameraMatrix(),T=e.bi(new Float64Array(16),w);x=e.cV.applyTransform(x,e.az([],w,y));let S=this._extendAABB(x,l,h,o);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=S,e.ad(b,b,w);let E=.5*(x.max[2]-x.min[2]),I=this._minimumAABBFrustumDistance(l,x),C=e.b$([],[0,0,1],E),A=e.cU(C,b,C),R=I+(0===l.pitch?0:e.bD(b,A)),M=l.globeCenterInViewSpace,P=e.at([],b,[M[0],M[1],M[2]]);e.au(P,P),e.b$(P,P,R);let O=e.cU([],b,P);e.ad(O,O,T);let k=e.eq/e.aE,L=e.ae(O),D=e.c6(Math.max(L*k-e.eq,Number.EPSILON),0),z=Math.min(l.zoomFromMercatorZAdjusted(D),h.maxZoom);return z>.5*(e.cL+e.cx)?(l.setProjection({name:"mercator"}),l.zoom=z,this._cameraForBounds(l,r,n,o,a,s)):{center:l.center,zoom:z,bearing:o,pitch:a}}_extendAABB(i,r,n,o){let a=.5*((n.padding.left||0)+(n.padding.right||0)),s=.5*((n.padding.top||0)+(n.padding.bottom||0)),l=r.width-(a+a),h=r.height-(s+s),u=e.at([],i.max,i.min),c=Math.min(l/u[0],h/u[1]),d=Math.min(r.scaleZoom(r.scale*c),n.maxZoom);if(isNaN(d))return null;let p=r.scale/r.zoomScale(d),f=new e.cV([i.min[0]-a*p,i.min[1]-s*p,i.min[2]],[i.max[0]+a*p,i.max[1]+s*p,i.max[2]]),m=("number"==typeof n.offset.x&&"number"==typeof n.offset.y?new e.P(n.offset.x,n.offset.y):e.P.convert(n.offset)).rotate(-e.al(o));return f.center[0]-=m.x*p,f.center[1]+=m.y*p,f}queryTerrainElevation(i,r){let n=this.transform.elevation;return n?(r=e.l({},{exaggerated:!0},r),n.getAtPoint(e.ac.fromLngLat(i),null,r.exaggerated)):null}_cameraForBounds(i,r,n,o,a,s){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,r,n,o,a,s);let l=i.clone(),h=this._extendCameraOptions(s);l.bearing=o,l.pitch=a;let u=e.cd.convert(r),c=e.cd.convert(n),d=new e.cd(u.lng,c.lat),p=new e.cd(c.lng,u.lat),f=l.project(u),m=l.project(c),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(c),y=this.queryTerrainElevation(d),v=this.queryTerrainElevation(p),x=[[f.x,f.y,Math.min(g||0,_||0,y||0,v||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,v||0)]],b=e.cV.fromPoints(x),w=l.getWorldToCameraMatrix(),T=e.bi(new Float64Array(16),w);b=e.cV.applyTransform(b,w);let S=this._extendAABB(b,l,h,o);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");b=S;let E=.5*e.at([],b.max,b.min)[2],I=this._minimumAABBFrustumDistance(l,b),C=[0,0,1,0];e.aA(C,C,w),e.eG(C,C);let A=e.b$([],C,I+E),R=e.cU([],b.center,A);e.ad(b.center,b.center,T),e.ad(R,R,T);let M=l.unproject(new e.P(b.center[0],b.center[1])),P=Math.pow(2,e.eH(l.projection,M)),O=Math.min(l._zoomFromMercatorZ(R[2]*l.pixelsPerMeter*P/l.worldSize),h.maxZoom);return l.mercatorFromTransition&&O<.5*(e.cL+e.cx)?(l.setProjection({name:"globe"}),l.zoom=O,this._cameraForBounds(l,r,n,o,a,s)):{center:M,zoom:O,bearing:o,pitch:a}}fitBounds(e,i,r){let n=this.cameraForBounds(e,i);return this._fitInternal(n,i,r)}fitScreenCoordinates(i,r,n,o,a){let s=e.P.convert(i),l=e.P.convert(r),h=new e.P(Math.min(s.x,l.x),Math.min(s.y,l.y)),u=new e.P(Math.max(s.x,l.x),Math.max(s.y,l.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,l))return this;let c=this.transform.pointLocation3D(h),d=this.transform.pointLocation3D(u),p=this.transform.pointLocation3D(new e.P(h.x,u.y)),f=this.transform.pointLocation3D(new e.P(u.x,h.y)),m=[Math.min(c.lng,d.lng,p.lng,f.lng),Math.min(c.lat,d.lat,p.lat,f.lat)],g=[Math.max(c.lng,d.lng,p.lng,f.lng),Math.max(c.lat,d.lat,p.lat,f.lat)],_=o&&o.pitch?o.pitch:this.getPitch(),y=this._cameraForBounds(this.transform,m,g,n,_,o);return this._fitInternal(y,o,a)}_fitInternal(i,r,n){return i?(r=e.l(i,r)).linear?this.easeTo(r,n):this.flyTo(r,n):this}jumpTo(i,r){this.stop();let n=i.preloadOnly?this.transform.clone():this.transform,o=!1,a=!1,s=!1;"zoom"in i&&n.zoom!==+i.zoom&&(o=!0,n.zoom=+i.zoom),void 0!==i.center&&(n.center=e.cd.convert(i.center)),"bearing"in i&&n.bearing!==+i.bearing&&(a=!0,n.bearing=+i.bearing),"pitch"in i&&n.pitch!==+i.pitch&&(s=!0,n.pitch=+i.pitch);let l="number"==typeof i.padding?this._extendPadding(i.padding):i.padding;if(null!=i.padding&&!n.isPaddingEqual(l))if(!1===i.retainPadding){let e=n.clone();e.padding=l,n.setLocationAtPoint(n.center,e.centerPoint)}else n.padding=l;return i.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.A("movestart",r)).fire(new e.A("move",r)),o&&this.fire(new e.A("zoomstart",r)).fire(new e.A("zoom",r)).fire(new e.A("zoomend",r)),a&&this.fire(new e.A("rotatestart",r)).fire(new e.A("rotate",r)).fire(new e.A("rotateend",r)),s&&this.fire(new e.A("pitchstart",r)).fire(new e.A("pitch",r)).fire(new e.A("pitchend",r)),this.fire(new e.A("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(o3),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,r){let n=this.transform;if(!n.projection.supportsFreeCamera)return e.w(o3),this;this.stop();let o=n.zoom,a=n.pitch,s=n.bearing;n.setFreeCameraOptions(i);let l=o!==n.zoom,h=a!==n.pitch,u=s!==n.bearing;return this.fire(new e.A("movestart",r)).fire(new e.A("move",r)),l&&this.fire(new e.A("zoomstart",r)).fire(new e.A("zoom",r)).fire(new e.A("zoomend",r)),u&&this.fire(new e.A("rotatestart",r)).fire(new e.A("rotate",r)).fire(new e.A("rotateend",r)),h&&this.fire(new e.A("pitchstart",r)).fire(new e.A("pitch",r)).fire(new e.A("pitchend",r)),this.fire(new e.A("moveend",r)),this}easeTo(i,r){let n,o,a,s,l;this._stop(!1,i.easeId),(!1===(i=e.l({offset:[0,0],duration:500,easing:e.ey},i)).animate||this._prefersReducedMotion(i))&&(i.duration=0);let h=this.transform,u=this.getZoom(),c=this.getBearing(),d=this.getPitch(),p=this.getPadding(),f="zoom"in i?+i.zoom:u,m="bearing"in i?this._normalizeBearing(i.bearing,c):c,g="pitch"in i?+i.pitch:d,_=this._extendPadding(i.padding),y=e.P.convert(i.offset);if("globe"===h.projection.name){let r=e.ac.fromLngLat(h.center),s=y.rotate(-h.angle);r.x+=s.x/h.worldSize,r.y+=s.y/h.worldSize;let l=r.toLngLat(),u=e.cd.convert(i.center||l);this._normalizeCenter(u),n=h.centerPoint.add(s),o=new e.P(r.x,r.y).mult(h.worldSize),a=new e.P(e.ay(u.lng),e.aH(u.lat)).mult(h.worldSize).sub(o)}else{n=h.centerPoint.add(y);let r=h.pointLocation(n),s=e.cd.convert(i.center||r);this._normalizeCenter(s),o=h.project(r),a=h.project(s).sub(o)}let v=h.zoomScale(f-u);i.around&&(s=e.cd.convert(i.around),l=h.locationPoint(s));let x=this._zooming||f!==u,b=this._rotating||c!==m,w=this._pitching||g!==d,T=!h.isPaddingEqual(_),S=!1===i.retainPadding?h.clone():h,E=h=>E=>{if(x&&(h.zoom=e.ai(u,f,E)),b&&(h.bearing=e.ai(c,m,E)),w&&(h.pitch=e.ai(d,g,E)),T&&(S.interpolatePadding(p,_,E),n=S.centerPoint.add(y)),s)h.setLocationAtPoint(s,l);else{let e=h.zoomScale(h.zoom-u),i=Math.pow(f>u?Math.min(2,v):Math.max(.5,v),1-E),r=h.unproject(o.add(a.mult(E*i)).mult(e));h.setLocationAtPoint(h.renderWorldCopies?r.wrap():r,n)}return i.preloadOnly||this._fireMoveEvents(r),h};if(i.preloadOnly){let e=this._emulate(E,i.duration,h);return this._preloadTiles(e),this}let I={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=x,this._rotating=b,this._pitching=w,this._padding=T,this._easeId=i.easeId,this._prepareEase(r,i.noMoveStart,I),this._ease(E(h),e=>{"sea"===h.cameraElevationReference&&h.recenterOnTerrain(),this._afterEase(r,e)},i),this}_prepareEase(i,r,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||n.moving||this.fire(new e.A("movestart",i)),this._zooming&&!n.zooming&&this.fire(new e.A("zoomstart",i)),this._rotating&&!n.rotating&&this.fire(new e.A("rotatestart",i)),this._pitching&&!n.pitching&&this.fire(new e.A("pitchstart",i))}_fireMoveEvents(i){this.fire(new e.A("move",i)),this._zooming&&this.fire(new e.A("zoom",i)),this._rotating&&this.fire(new e.A("rotate",i)),this._pitching&&this.fire(new e.A("pitch",i))}_afterEase(i,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let n=this._zooming,o=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.A("zoomend",i)),o&&this.fire(new e.A("rotateend",i)),a&&this.fire(new e.A("pitchend",i)),this.fire(new e.A("moveend",i))}flyTo(i,r){if(this._prefersReducedMotion(i)){let n=e.aF(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(n,r)}this.stop(),i=e.l({offset:[0,0],speed:1.2,curve:1.42,easing:e.ey},i);let n=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),l=this.getPadding(),h="zoom"in i?e.aD(+i.zoom,n.minZoom,n.maxZoom):o,u="bearing"in i?this._normalizeBearing(i.bearing,a):a,c="pitch"in i?+i.pitch:s,d=this._extendPadding(i.padding),p=n.zoomScale(h-o),f=e.P.convert(i.offset),m=n.centerPoint.add(f),g=n.pointLocation(m),_=e.cd.convert(i.center||g);this._normalizeCenter(_);let y=n.project(g),v=n.project(_).sub(y),x=i.curve,b=Math.max(n.width,n.height),w=b/p,T=v.mag();if("minZoom"in i){let r=e.aD(Math.min(i.minZoom,o,h),n.minZoom,n.maxZoom);x=Math.sqrt(b/n.zoomScale(r-o)/T*2)}let S=x*x;function E(e){let i=(w*w-b*b+(e?-1:1)*S*S*T*T)/(2*(e?w:b)*S*T);return Math.log(Math.sqrt(i*i+1)-i)}function I(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}let A=E(0),R=function(e){return C(A)/C(A+x*e)},M=function(e){var i;return b*((C(A)*(I(i=A+x*e)/C(i))-I(A))/S)/T},P=(E(1)-A)/x;if(1e-6>Math.abs(T)||!isFinite(P)){if(1e-6>Math.abs(b-w))return this.easeTo(i,r);let e=w<b?-1:1;P=Math.abs(Math.log(w/b))/x,M=function(){return 0},R=function(i){return Math.exp(e*x*i)}}i.duration="duration"in i?+i.duration:1e3*P/("screenSpeed"in i?i.screenSpeed/x:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);let O=a!==u,k=c!==s,L=!n.isPaddingEqual(d),D=!1===i.retainPadding?n.clone():n,z=n=>p=>{let g=p*P,x=1/R(g);n.zoom=1===p?h:o+n.scaleZoom(x),O&&(n.bearing=e.ai(a,u,p)),k&&(n.pitch=e.ai(s,c,p)),L&&(D.interpolatePadding(l,d,p),m=D.centerPoint.add(f));let b=1===p?_:n.unproject(y.add(v.mult(M(g))).mult(x));return n.setLocationAtPoint(n.renderWorldCopies?b.wrap():b,m),n._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(r),n};if(i.preloadOnly){let e=this._emulate(z,i.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=O,this._pitching=k,this._padding=L,this._prepareEase(r,!1),this._ease(z(n),()=>this._afterEase(r),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,i)}if(!e){let e=this.handlers;e&&e.stop(!1)}return this}_ease(i,r,n){!1===n.animate||0===n.duration?(i(1),r()):(this._easeStart=e.q.now(),this._easeOptions=n,this._onEaseFrame=i,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let i=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,r){let n=Math.abs((i=e.bX(i,-180,180))-r);return Math.abs(i-360-r)<n&&(i-=360),Math.abs(i+360-r)<n&&(i+=360),i}_normalizeCenter(e){let i=this.transform;if(i.maxBounds||"globe"!==i.projection.name&&!i.renderWorldCopies)return;let r=e.lng-i.center.lng;e.lng+=r>180?-360:360*(r<-180)}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(e,i,r){let n=Math.ceil(15*i/1e3),o=[],a=e(r.clone());for(let e=0;e<=n;e++){let i=a(e/n);o.push(i.clone())}return o}_preloadTiles(e,i){}}class o4{constructor(i={}){this.options=i,e.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){let i=this.options&&this.options.compact,r=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=d("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",r);let n=d("span","mapboxgl-ctrl-icon",this._compactButton);return n.setAttribute("aria-hidden","true"),n.setAttribute("title",r),this._innerContainer=d("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));let r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(i){let n=r.reduce((e,i,n)=>(i.value&&(e+=`${i.key}=${i.value}${n<r.length-1?"&":""}`),e),"?");i.href=`${e.e.FEEDBACK_URL}/${n}#${oo(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(e){e&&("metadata"===e.sourceDataType||"visibility"===e.sourceDataType||"style"===e.dataType)&&(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){let e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}let i=this._map.style._mergedSourceCaches;for(let r in i){let n=i[r];if(n.used){let i=n.getSource();i.attribution&&0>e.indexOf(i.attribution)&&e.push(i.attribution)}}e.sort((e,i)=>e.length-i.length),e=e.filter((i,r)=>{for(let n=r+1;n<e.length;n++)if(e[n].indexOf(i)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));let r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class o6{constructor(){e.aV(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=d("div","mapboxgl-ctrl");let i=d("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(let i in e){let r=e[i].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){let e=this._container.children;if(e.length){let i=e[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class o8{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){let i=this._currentlyRunning;for(let r of i?this._queue.concat(i):this._queue)if(r.id===e)return void(r.cancelled=!0)}run(e=0){let i=this._currentlyRunning=this._queue;for(let r of(this._queue=[],i))if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class o9{constructor(e){this.jumpTo(e)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;let r=e.dk((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,i,r){this._start=this.getValue(i),this._end=e,this._startTime=i,this._endTime=i+r}}let o7={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use â + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ae extends e.A{constructor(e,i,r,n){let{point:o,lngLat:a,originalEvent:s,target:l}=e;super(e.type,{point:o,lngLat:a,originalEvent:s,target:l}),this.preventDefault=()=>{e.preventDefault()},this.id=i,this.interaction=r,this.feature=n}}class at{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,r){if(this.typeById.has(i))throw Error(`Interaction id "${i}" already exists.`);let n=r.filter,o=r.type;n&&this.filters.set(i,e.b3(n)),"mouseover"===o&&(o="mouseenter"),"mouseout"===o&&(o="mouseleave");let a=this.interactionsByType.get(o)||new Map;"mouseenter"===o||"mouseleave"===o?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,r)):0===a.size&&this.map.on(o,this.handleType),0===a.size&&this.interactionsByType.set(o,a),a.set(i,r),this.typeById.set(i,o)}get(e){let i=this.typeById.get(e);if(!i)return;let r=this.interactionsByType.get(i);return r?r.get(e):void 0}remove(e){let i=this.typeById.get(e);if(!i)return;this.typeById.delete(e),this.filters.delete(e);let r=this.interactionsByType.get(i);r&&(r.delete(e),"mouseenter"===i||"mouseleave"===i?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===r.size&&this.map.off(i,this.handleType))}queryTargets(e,i){let r=[];for(let[e,n]of i)n.target&&r.push({targetId:e,target:n.target,filter:this.filters.get(e)});return this.map.style.queryRenderedTargets(e,r,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;let i=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());i.length&&(e.type="mouseenter",this.handleType(e,i));let r=new Map;for(let[e,{feature:i}]of this.prevHoveredFeatures)this.hoveredFeatures.has(e)||r.set(i.id,i);r.size&&(e.type="mouseleave",this.handleType(e,Array.from(r.values())))}handleOut(e){let i=Array.from(this.hoveredFeatures.values()).map(({feature:e})=>e);i.length&&(e.type="mouseleave",this.handleType(e,i)),this.hoveredFeatures.clear()}handleType(i,r){let n=Array.from(this.interactionsByType.get(i.type)).reverse(),o=!!r;r=r||this.queryTargets(i.point,n);let a="mouseenter"===i.type,s=!1,l=new Set;for(let h of r){for(let[r,u]of n){if(!u.target)continue;let n=h.variants?h.variants[r]:null;if(n){for(let c of n){if(e1(c,h,l,r))continue;let n=new e.df(h,c),d=e0(c,h,r);o&&(n.state=this.map.getFeatureState(n));let p=a?this.prevHoveredFeatures.get(d):null,f=new ae(i,r,u,n),m=p?p.stop:u.handler(f);if(a&&this.hoveredFeatures.set(d,{feature:h,stop:m}),!1!==m){s=!0;break}}if(s)break}}if(s)break}if(!s)for(let[e,r]of n){let{handler:n,target:o}=r;if(!o&&!1!==n(new ae(i,e,r,null)))break}}}let ai={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ar={showCompass:!0,showZoom:!0,visualizePitch:!1};class an{constructor(i,r,n=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new oA({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,n&&(this.mousePitch=new oR({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),e.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(e,i){this.mouseRotate.mousedown(e,i),this.mousePitch&&this.mousePitch.mousedown(e,i),g()}move(e,i){let r=this.map,n=this.mouseRotate.mousemoveWindow(e,i),o=n&&n.bearingDelta;if(o&&r.setBearing(r.getBearing()+o),this.mousePitch){let n=this.mousePitch.mousemoveWindow(e,i),o=n&&n.pitchDelta;o&&r.setPitch(r.getPitch()+o)}}off(){let e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(e.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),x(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,x(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=b(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=b(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ao(i,r,n){if(i=new e.cd(i.lng,i.lat),r){let o=new e.cd(i.lng-360,i.lat),a=new e.cd(i.lng+360,i.lat),s=360*Math.ceil(Math.abs(i.lng-n.center.lng)/360),l=n.locationPoint3D(i).distSqr(r),h=r.x<0||r.y<0||r.x>n.width||r.y>n.height;n.locationPoint3D(o).distSqr(r)<l&&(h||Math.abs(o.lng-n.center.lng)<s)?i=o:n.locationPoint3D(a).distSqr(r)<l&&(h||Math.abs(a.lng-n.center.lng)<s)&&(i=a)}for(;Math.abs(i.lng-n.center.lng)>180;){let e=n.locationPoint3D(i);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;i.lng>n.center.lng?i.lng-=360:i.lng+=360}return i}let aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},as={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class al extends e.E{constructor(i,r){super(),(i instanceof HTMLElement||r)&&(i=e.l({element:i},r)),e.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);let{anchor:n="center",color:o="#3FB1CE",scale:a=1,draggable:s=!1,clickTolerance:l=0,rotation:h=as.rotation,rotationAlignment:u=as.rotationAlignment,pitchAlignment:c=as.pitchAlignment,occludedOpacity:d=as.occludedOpacity,altitude:p=as.altitude}=i||{};this._anchor=n,this._color=o,this._scale=a,this._draggable=s,this._clickTolerance=l,this._rotation=h,this._rotationAlignment=u,this._pitchAlignment=c,this._occludedOpacity=d,this._altitude=p,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),i&&i.element?(this._element=i.element,this._offset=e.P.convert(i&&i.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(i&&i.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});let f=this._element.classList;for(let e in aa)f.remove(`mapboxgl-marker-anchor-${e}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let m=i&&i.className?i.className.trim().split(/\s+/):[];f.add(...m),this._popup=null}_createDefaultMarker(){let e=d("div"),i=p("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){let e=p("radialGradient",{id:"shadowGradient"},p("defs",{},i));p("stop",{offset:"10%","stop-opacity":.4},e),p("stop",{offset:"100%","stop-opacity":.05},e),p("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i)}return p("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),p("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),p("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){let e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=e.cd.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||as.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let i=Math.sqrt(91.125);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[i,-1*(24.6+i)],"bottom-right":[-i,-1*(24.6+i)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){let i=e.code,r=e.charCode||e.keyCode;"Space"!==i&&"Enter"!==i&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){let i=e.originalEvent.target,r=this._element;this._popup&&(i===r||r.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e&&(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true"))),this}_behindTerrain(){let e=this._map,i=this._pos;if(!e||!i)return!1;let r=e.unproject(i,this._altitude),n=e.getFreeCameraOptions();if(!n.position)return!1;let o=n.position.toLngLat();return o.distanceTo(r)<.9*o.distanceTo(this._lngLat)}_evaluateOpacity(){let i,r=this._map;if(!r)return;let n=this._pos;if(!n||n.x<0||n.x>r.transform.width||n.y<0||n.y>r.transform.height)return void this._clearFadeTimer();let o=r.unproject(n,this._altitude);r._showingGlobe()&&e.eK(r.transform,this._lngLat)?i=0:(i=1-r._queryFogOpacity(o),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity=`${i}`,this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let e=this._pos;if(!e||!this._map)return;let i=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${e.x}px,${e.y}px)
            ${aa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${i.x}px,${i.y}px)
        `}_calculateXYTransform(){let i=this._pos,r=this._map,n=this.getPitchAlignment();if(!r||!i||"map"!==n)return"";if(!r._showingGlobe()){let e=r.getPitch();return e?`rotateX(${e}deg)`:""}let o=e.cJ(e.eL(r.transform,this._lngLat)),a=i.sub(e.eM(r.transform)),s=Math.abs(a.x)+Math.abs(a.y);if(0===s)return"";let l=o/s;return`rotateX(${-a.y*l}deg) rotateY(${a.x*l}deg)`}_calculateZTransform(){let i=this._pos,r=this._map;if(!r||!i)return"";let n=0,o=this.getRotationAlignment();if("map"===o)if(r._showingGlobe()){let i=r.project(new e.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),o=r.project(new e.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(i);n=e.cJ(Math.atan2(o.y,o.x))-90}else n=-r.getBearing();else if("horizon"===o){let o=e.af(4,6,r.getZoom()),a=e.eM(r.transform);a.y+=o*r.transform.height;let s=i.sub(a),l=e.cJ(Math.atan2(s.y,s.x));n=(l>90?l-270:l+90)*(1-o)}return(n+=this._rotation)?`rotateZ(${n}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);let i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=ao(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=e.P.convert(i),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(i){let r=this._map;if(!r)return;let n=this._pointerdownPos,o=this._positionDelta;if(n&&o){if(!this._isDragging){let e=this._clickTolerance||r._clickTolerance;if(i.point.dist(n)<e)return;this._isDragging=!0}this._pos=i.point.sub(o),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive"}_addDragHandler(e){let i=this._map,r=this._pos;i&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;let i=this._map;return i&&(e?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||as.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||as.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||as.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||as.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let ah={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},au={maxWidth:100,unit:"metric"},ac={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ad={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0};function ap(i=new e.P(0,0),r="bottom"){if("number"==typeof i){let n=Math.round(Math.sqrt(.5*Math.pow(i,2)));switch(r){case"top":return new e.P(0,i);case"top-left":return new e.P(n,n);case"top-right":return new e.P(-n,n);case"bottom":return new e.P(0,-i);case"bottom-left":return new e.P(n,-n);case"bottom-right":return new e.P(-n,-n);case"left":return new e.P(i,0);case"right":return new e.P(-i,0)}return new e.P(0,0)}return i instanceof e.P||Array.isArray(i)?e.P.convert(i):e.P.convert(i[r]||[0,0])}return{version:o,supported:c.supported,setRTLTextPlugin:e.eN,getRTLTextPluginStatus:e.eO,Map:class extends o5{constructor(i){s.mark(a.create);let r=i;if(null!=(i=e.l({},ai,i)).minZoom&&null!=i.maxZoom&&i.minZoom>i.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=i.minPitch&&null!=i.maxPitch&&i.minPitch>i.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=i.minPitch&&i.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=i.maxPitch&&i.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(i.antialias&&e.eI(window)&&(i.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ir(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies,null,null),i),this._repaint=!!i.repaint,this._interactive=i.interactive,this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=i.preserveDrawingBuffer,this._antialias=i.antialias,this._trackResize=i.trackResize,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles,this._fadeDuration=i.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=i.crossSourceCollisions,this._collectResourceTiming=i.collectResourceTiming,this._language=this._parseLanguage(i.language),this._worldview=i.worldview,this._renderTaskQueue=new o8,this._domRenderTaskQueue=new o8,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.a$(),this._locale=e.l({},o7,i.locale),this._clickTolerance=i.clickTolerance,this._cooperativeGestures=i.cooperativeGestures,this._performanceMetricsCollection=i.performanceMetricsCollection,this._tessellationStep=i.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=i.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new o9(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=i.scaleFactor,this._requestManager=new E(i.transformRequest,i.accessToken,i.testMode),this._silenceAuthErrors=!!i.testMode,this._contextCreateOptions=i.contextCreateOptions?Object.assign({},i.contextCreateOptions):{},"string"==typeof i.container){let e=document.getElementById(i.container);if(!e)throw Error(`Container '${i.container.toString()}' not found.`);this._container=e}else{if(!(i.container instanceof HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),i.maxBounds&&this.setMaxBounds(i.maxBounds),this._spriteFormat=i.spriteFormat,e.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new nK),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new o2(this,i),this._localFontFamily=i.localFontFamily,this._localIdeographFontFamily=i.localIdeographFontFamily,(i.style||!i.testMode)&&this.setStyle(i.style||e.e.DEFAULT_STYLE,{config:i.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),i.projection&&this.setProjection(i.projection),this.indoor=new iy(this),i.hash&&(this._hash=new on("string"==typeof i.hash&&i.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch});let n=i.bounds;n&&(this.resize(),this.fitBounds(n,e.l({},i.fitBoundsOptions,{duration:0})))}this.resize(),i.attributionControl&&this.addControl(new o4({customAttribution:i.customAttribution})),this._logoControl=new o6,this.addControl(this._logoControl,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new e.A(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new e.A(`${i.dataType}dataloading`,i))}),this._interactions=new at(this)}_getMapId(){return this._mapId}addControl(i,r){if(void 0===r&&(r=i.getDefaultPosition?i.getDefaultPosition():"top-right"),!i||!i.onAdd)return this.fire(new e.z(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=i.onAdd(this);this._controls.push(i);let o=this._controlPositions[r];return -1!==r.indexOf("bottom")?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(i){if(!i||!i.onRemove)return this.fire(new e.z(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let r=this._controls.indexOf(i);return r>-1&&this._controls.splice(r,1),i.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(i){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let r=!this._moving;return r&&this.fire(new e.A("movestart",i)).fire(new e.A("move",i)),this.fire(new e.A("resize",i)),r&&this.fire(new e.A("moveend",i)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(i){return this.transform.setMaxBounds(e.aG.convert(i)),this._update()}setMinZoom(i){if((i=i??-2)>=-2&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this._update(),this.getZoom()<i?this.setZoom(i):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(i){if((i=i??22)>=this.transform.minZoom)return this.transform.maxZoom=i,this._update(),this.getZoom()>i?this.setZoom(i):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(i){if((i=i??0)<0)throw Error("minPitch must be greater than or equal to 0");if(i>=0&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this._update(),this.getPitch()<i?this.setPitch(i):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(i){if((i=i??85)>85)throw Error("maxPitch must be less than or equal to 85");if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this._update(),this.getPitch()>i?this.setPitch(i):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){let i=this._parseLanguage(e);if(!this.style||i===this._language)return this;for(let e of(this._language=i,this.style.reloadSources(),this._controls))e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview&&(this._worldview=e,this.style.reloadSources()),this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){let i;if("globe"!==this.getProjection().name)return;let r=this.transform,n=r.projection.name;"globe"===n&&r.zoom>=e.cx?(r.setMercatorFromTransition(),i=!0):"mercator"===n&&r.zoom<e.cx&&(r.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,i){return this._updateProjection(e||i||{name:"mercator"})}_updateProjection(i){let r;return r="globe"===i.name&&this.transform.zoom>=e.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(i),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(i,r){return this.transform.locationPoint3D(e.cd.convert(i),r)}unproject(i,r){return this.transform.pointLocation3D(e.P.convert(i),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,i,r){let n=e=>{let r=[];if(Array.isArray(i)){let n=i.filter(e=>this.getLayer(e));r=n.length?this.queryRenderedFeatures(e,{layers:n}):[]}else r=this.queryRenderedFeatures(e,{target:i});return r};if("mouseenter"===e||"mouseover"===e){let o=!1;return{listener:r,targets:i,delegates:{mousemove:i=>{let a=n(i.point);a.length?o||(o=!0,r.call(this,new of(e,this,i.originalEvent,{features:a}))):o=!1},mouseout:()=>{o=!1}}}}if("mouseleave"===e||"mouseout"===e){let o=!1;return{listener:r,targets:i,delegates:{mousemove:i=>{n(i.point).length?o=!0:o&&(o=!1,r.call(this,new of(e,this,i.originalEvent)))},mouseout:i=>{o&&(o=!1,r.call(this,new of(e,this,i.originalEvent)))}}}}return{listener:r,targets:i,delegates:{[e]:e=>{let i=n(e.point);i.length&&(e.features=i,r.call(this,e),delete e.features)}}}}on(e,i,r){if("function"==typeof i||void 0===r)return super.on(e,i);if("string"==typeof i&&(i=[i]),!this._areTargetsValid(i))return this;let n=this._createDelegatedListener(e,i,r);for(let i in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n),n.delegates)this.on(i,n.delegates[i]);return this}once(e,i,r){if("function"==typeof i||void 0===r)return super.once(e,i);if("string"==typeof i&&(i=[i]),!this._areTargetsValid(i))return this;let n=this._createDelegatedListener(e,i,r);for(let e in n.delegates)this.once(e,n.delegates[e]);return this}off(i,r,n){if("function"==typeof r||void 0===n)return super.off(i,r);if("string"==typeof r&&(r=[r]),!this._areTargetsValid(r))return this;let o=this._delegatedListeners?this._delegatedListeners[i]:void 0;return o&&(i=>{for(let o=0;o<i.length;o++){let a=i[o];if(a.listener===n&&function(i,r){if(Array.isArray(i)&&Array.isArray(r)){let e=new Set(i),n=new Set(r);return e.size===n.size&&i.every(e=>n.has(e))}return e.bv(i,r)}(a.targets,r)){for(let e in a.delegates)this.off(e,a.delegates[e]);return i.splice(o,1),this}}})(o),this}queryRenderedFeatures(i,r){if(!this.style)return[];if(void 0===i||i instanceof e.P||Array.isArray(i)||void 0!==r||(r=i,i=void 0),i=i||[[0,0],[this.transform.width,this.transform.height]],!r){let e=this.style.queryRenderedFeatures(i,void 0,this.transform),r=this.style.queryRenderedFeatureset(i,void 0,this.transform);return e.concat(r)}let n=!0;if(r.target&&(n=this._isTargetValid(r.target))&&!r.layers)return this.style.queryRenderedFeatureset(i,r,this.transform);let o=!0;if(r.layers&&Array.isArray(r.layers)){for(let e of r.layers)if(!this._isValidId(e)){o=!1;break}if(o&&!r.target)return this.style.queryRenderedFeatures(i,r,this.transform)}let a=[];return o&&(a=a.concat(this.style.queryRenderedFeatures(i,r,this.transform))),n&&(a=a.concat(this.style.queryRenderedFeatureset(i,r,this.transform))),a}querySourceFeatures(e,i){return e&&("string"!=typeof e||this._isValidId(e))?this.style.querySourceFeatures(e,i):[]}isPointOnSurface(i){let{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&e.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(i))}addInteraction(e,i){return this._interactions.add(e,i),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(i,r){return r=e.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&i&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(i,(n,o)=>{if(n){let o="string"==typeof n?n:n instanceof Error?n.message:n.error;e.w(`Unable to perform style diff: ${o}. Rebuilding the style from scratch.`),this._updateStyle(i,r)}else o&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(i,r))}_getUIString(e){let i=this._locale[e];if(null==i)throw Error(`Missing UI string '${e}'`);return i}_updateStyle(i,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),i){let n=e.l({},r);r&&r.config&&(n.initialConfig=r.config,delete n.config),this.style=new iC(this,n).load(i),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new iC(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(i){return null==i?(this.fire(new e.z(Error("IDs can't be empty."))),!1):!e.d9(i)||(this.fire(new e.z(Error(`IDs can't contain special symbols: "${i}".`))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(let i of e)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(e)}addSource(e,i){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,i),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,i,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,i,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(i,r,{pixelRatio:n=1,sdf:o=!1,stretchX:a,stretchY:s,content:l}={}){this._lazyInitEmptyStyle();let h=e.I.from(i);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){let{width:i,height:u,data:c}=e.q.getImageData(r);this.style.addImage(h,{data:new e.r({width:i,height:u},c),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,version:0,usvg:!1})}else if(void 0===r.width||void 0===r.height)this.fire(new e.z(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:u,height:c}=r;this.style.addImage(h,{data:new e.r({width:u,height:c},new Uint8Array(r.data)),pixelRatio:n,stretchX:a,stretchY:s,content:l,sdf:o,usvg:!1,version:0,userImage:r}),r.onAdd&&r.onAdd(this,i)}}updateImage(i,r){this._lazyInitEmptyStyle();let n=e.I.from(i),o=this.style.getImage(n);if(!o)return void this.fire(new e.z(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let{width:a,height:s,data:l}=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?e.q.getImageData(r):r;if(void 0===a||void 0===s)return void this.fire(new e.z(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==(o.usvg?o.icon.usvg_tree.width:o.data.width)||s!==(o.usvg?o.icon.usvg_tree.height:o.data.height))return void this.fire(new e.z(Error(`The width and height of the updated image (${a}, ${s})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));let h=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap),u=!1;o.usvg?(o.data=new e.r({width:a,height:s},new Uint8Array(l)),o.usvg=!1,o.icon=void 0,u=!0):o.data.replace(l,h),this.style.updateImage(n,o,u)}hasImage(i){return i?!!this.style&&!!this.style.getImage(e.I.from(i)):(this.fire(new e.z(Error("Missing required image id"))),!1)}removeImage(i){this.style.removeImage(e.I.from(i))}loadImage(i,r){e.o(this._requestManager.transformRequest(i,e.R.Image),(i,n)=>{r(i,n instanceof HTMLImageElement?e.q.getImageData(n):n)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,i){this._lazyInitEmptyStyle(),this.style.addModel(e,i)}hasModel(i){return i?this.style.hasModel(i):(this.fire(new e.z(Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,i){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,i),this._update(!0)):this}getSlot(e){let i=this.getLayer(e);return i&&i.slot||null}setSlot(e,i){return this.style.setSlot(e,i),this.style.mergeLayers(),this._update(!0)}addImport(i,r){return this.style.addImport(i,r).catch(i=>this.fire(new e.z(Error("Failed to add import",i)))),this}updateImport(e,i){return"string"!=typeof i&&i.id!==e?(this.removeImport(e),this.addImport(i)):(this.style.updateImport(e,i),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,i){return this.style.moveImport(e,i),this._update(!0)}moveLayer(e,i){return this._isValidId(e)?(this.style.moveLayer(e,i),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;let i=this.style.getOwnLayer(e);return i?"custom"===i.type?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,i,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,i,r),this._update(!0)):this}setFilter(e,i,r={}){return this._isValidId(e)?(this.style.setFilter(e,i,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,i,r,n={}){return this._isValidId(e)?(this.style.setPaintProperty(e,i,r,n),this._update(!0)):this}getPaintProperty(e,i){return this._isValidId(e)?this.style.getPaintProperty(e,i):null}setLayoutProperty(e,i,r,n={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,i,r,n),this._update(!0)):this}getLayoutProperty(e,i){return this._isValidId(e)?this.style.getLayoutProperty(e,i):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,i){return this.style.setSchema(e,i),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,i){return this.style.setConfig(e,i),this._update(!0)}getConfigProperty(e,i){return this.style.getConfigProperty(e,i)}setConfigProperty(e,i,r){return this.style.setConfigProperty(e,i,r),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){let i=e[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,i),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(i){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.cd.convert(i),this.transform):0}setFeatureState(e,i){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,i),this._update())}removeFeatureState(e,i){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,i),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;let e=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300,r,n,o,a=this._container;for(;a&&(!n||!o);){let e=window.getComputedStyle(a).transform;e&&"none"!==e&&((r=e.match(/matrix.*\((.+)\)/)[1].split(", "))[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),a=a.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=d("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();let i=this._canvasContainer=d("div","mapboxgl-canvas-container",e);this._canvas=d("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let r=this._controlContainer=d("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{n[e]=d("div",`mapboxgl-ctrl-${e}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(i,r){let n=e.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(i),this._canvas.height=n*Math.ceil(r),this._canvas.style.width=`${i}px`,this._canvas.style.height=`${r}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){let i=this._markers.indexOf(e);-1!==i&&this._markers.splice(i,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){let i=this._popups.indexOf(e);-1!==i&&this._popups.splice(i,1)}_setupPainter(){let i=e.l({},c.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",i);r?(G(r,!0),this.painter=new oi(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.m.testSupport(r)):this.fire(new e.z(Error("Failed to initialize WebGL")))}_contextLost(i){i.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:i}))}_contextRestored(i){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:i}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(i){let r;this.fire(new e.A("renderstart")),++this._frameId;let n=this.painter.context.extTimerQuery,o=e.q.now(),l=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=l.createQuery(),l.beginQuery(n.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(i),this._domRenderTaskQueue.run(i),this._removed)return;this._updateProjectionTransition();let h=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let i=this.transform.zoom,r=this.transform.pitch,n=e.q.now(),o=new e.aa(i,{now:n,fadeDuration:h,pitch:r,transition:this.style.transition});this.style.update(o)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let u=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),u=this._updateAverageElevation(o),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):u=this._updateAverageElevation(o);let c=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,h,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),c&&(this._placementDirty=c.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:h,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.mark(a.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){let i=e.q.now()-o;l.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{let n=l.getQueryParameter(r,l.QUERY_RESULT)/1e6;l.deleteQuery(r),this.fire(new e.A("gpu-timing-frame",{cpuTime:i,gpuTime:n}))},50)}if(this.listens("gpu-timing-layer")){let i=this.painter.collectGpuTimers();setTimeout(()=>{let r=this.painter.queryGpuTimers(i);this.fire(new e.A("gpu-timing-layer",{layerTimes:r}))},50)}if(this.listens("gpu-timing-deferred-render")){let i=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let r=this.painter.queryGpuTimeDeferredRender(i);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:r}))},50)}let d=this._sourcesDirty||this._styleDirty||this._placementDirty||u;if(d||this._repaint)this.triggerRepaint();else{let i=this.idle();if(i&&(u=this._updateAverageElevation(o,!0)),u)this.triggerRepaint();else if(this._triggerFrame(!1),i&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let i=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:i})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,s.mark(a.fullLoad),this._performanceMetricsCollection&&N(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(let i of this._markers)e&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(let i of this._popups)!e||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(e,i=!1){let r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);let n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(i||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){let i=this.transform.averageElevation,o=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(o)?o=0:this._averageElevationLastSampledAt=e;let a=Math.abs(i-o);if(a>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(o),r(o);this._averageElevation.easeTo(o,e,300)}else if(a>1e-4)return this._averageElevation.jumpTo(o),r(o)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){V(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,i=>{if(i&&(i.message===S||401===i.status)){let i=this.painter.context.gl;G(i,!1),this._logoControl instanceof o6&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),D(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&F(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){let e=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());let r=this.painter.context.gl,n=r.createFramebuffer();function o(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);let i=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,i),i}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(o(e),i.canvasCopies.map(o),i.timeStamps)}_canvasPixelComparison(e,i,r){let n=r[1]-r[0],o=e.length/4;for(let a=0;a<i.length;a++){let s=i[a],l=0;for(let i=0;i<s.length;i+=4)s[i]===e[i]&&s[i+1]===e[i+1]&&s[i+2]===e[i+2]&&s[i+3]===e[i+3]&&(l+=1);n+=(r[a+2]-r[a+1])*(1-l/o)}return n}remove(){for(let e of(this._hash&&this._hash.remove(),this._controls))e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),U.delete(this.painter.context.gl),j.remove(),L.remove(),this._removed=!0,this.fire(new e.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(i){this._renderNextFrame=this._renderNextFrame||i,this.style&&!this._frame&&(this._frame=e.q.frame(e=>{let i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(e)}))}_preloadTiles(i){let r=this.style?this.style.getSourceCaches():[];return e.bt(r,(e,r)=>e._preloadTiles(i,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(i,r){e.eJ(i,r)}get version(){return o}},NavigationControl:class{constructor(i={}){this.options=e.l({},ar,i),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{let i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:e}):i.resetNorth({},{originalEvent:e}))}),this._compassIcon=d("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let e=this._map;if(!e)return;let i=e.getZoom(),r=i===e.getMaxZoom(),n=i===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){let e=this._map;if(!e)return;let i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new an(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){let e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,i){let r=d("button",e,this._container);return r.type="button",r.addEventListener("click",i),r}_setButtonTitle(e,i){if(!this._map)return;let r=this._map._getUIString(`NavigationControl.${i}`);e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends e.E{constructor(i={}){super();let r=navigator.geolocation;this.options=e.l({geolocation:r},ah,i),e.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=or(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){let i=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,e(i)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>i("denied"!==e.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(e){let i=this._map.getMaxBounds(),r=e.coords;return!!i&&(r.longitude<i.getWest()||r.longitude>i.getEast()||r.latitude<i.getSouth()||r.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(i){if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(i),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(i),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",i)),this._finish()}}_updateCamera(i){let r=new e.cd(i.coords.longitude,i.coords.latitude),n=i.coords.accuracy,o=this._map.getBearing(),a=e.l({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),a,{geolocateSource:!0})}_updateMarker(i){if(i){let r=new e.cd(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let i=this._map.transform,r=e.c6(1,i._center.lat)*i.worldSize,n=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(i){if(this._map){if(this.options.trackUserLocation)if(1===i.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===i.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",i)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(i){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=d("button","mapboxgl-ctrl-geolocate",this._container),d("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===i){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{let e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d("div","mapboxgl-user-location"),this._dotElement.appendChild(d("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(d("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new al({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=d("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:o4,ScaleControl:class{constructor(i={}){this.options=e.l({},au,i),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let e=this.options.maxWidth||100,i=this._map,r=i._containerHeight/2,n=i._containerWidth/2-e/2,o=i.unproject([n,r]),a=i.unproject([n+e,r]),s=o.distanceTo(a);if("imperial"===this.options.unit){let i=3.2808*s;i>5280?this._setScale(e,i/5280,"mile"):this._setScale(e,i,"foot")}else"nautical"===this.options.unit?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,i,r){this._map._requestDomTask(()=>{let n=function(e){let i=Math.pow(10,`${Math.floor(e)}`.length-1),r=e/i;return i*(r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){let i=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*i)/i}(r))}(i),o=n/i;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(n):`${n}&nbsp;${ac[r]}`,this._container.style.width=e*o+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(i={}){this._fullscreen=!1,i&&i.container&&(i.container instanceof HTMLElement?this._container=i.container:e.w("Full screen control 'container' must be a DOM element.")),e.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let e=this._fullscreenButton=d("button","mapboxgl-ctrl-fullscreen",this._controlContainer);d("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(i){super(),this.options=e.l(Object.create(ad),i),this._altitude=this.options.altitude,e.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(i&&i.className?i.className.trim().split(/\s+/):[])}addTo(i){return this._map&&this.remove(),this._map=i,this.options.closeOnClick&&i.on("preclick",this._onClose),this.options.closeOnMove&&i.on("move",this._onClose),i.on("remove",this.remove),this._update(),i._addPopup(this),this._focusFirstElement(),this._trackPointer?(i.on("mousemove",this._onMouseEvent),i.on("mouseup",this._onMouseEvent),i._canvasContainer.classList.add("mapboxgl-track-pointer")):i.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let i=this._map;return i&&(i.off("move",this._update),i.off("move",this._onClose),i.off("preclick",this._onClose),i.off("click",this._onClose),i.off("remove",this.remove),i.off("mousemove",this._onMouseEvent),i.off("mouseup",this._onMouseEvent),i.off("drag",this._onMouseEvent),i._canvasContainer&&i._canvasContainer.classList.remove("mapboxgl-track-pointer"),i._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(i){this._lngLat=e.cd.convert(i),this._pos=null,this._trackPointer=!1,this._update();let r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){let i,r=document.createDocumentFragment(),n=document.createElement("body");for(n.innerHTML=e;i=n.firstChild;)r.appendChild(i);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=d("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(e),this.options.closeButton){let e=this._closeButton=d("button","mapboxgl-popup-close-button",i);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let i;return this._classList.delete(e)?i=!1:(this._classList.add(e),i=!0),this._updateClassList(),i}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;let i=this._map,r=this._container,n=this._pos;if(!i||!r||!n)return"bottom";let o=r.offsetWidth,a=r.offsetHeight,s=n.x<o/2,l=n.x>i.transform.width-o/2;if(n.y+e<a)return s?"top-left":l?"top-right":"top";if(n.y>i.transform.height-a){if(s)return"bottom-left";if(l)return"bottom-right"}return s?"left":l?"right":"bottom"}_updateClassList(){let e=this._container;if(!e)return;let i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),e.className=i.join(" ")}_update(i){let r=this._map,n=this._content;if(!r||!this._lngLat&&!this._trackPointer||!n)return;let o=this._container;if(o||(o=this._container=d("div","mapboxgl-popup",r.getContainer()),this._tip=d("div","mapboxgl-popup-tip",o),o.appendChild(n)),this.options.maxWidth&&o.style.maxWidth!==this.options.maxWidth&&(o.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ao(this._lngLat,this._pos,r.transform)),!this._trackPointer||i){let n=this._pos=this._trackPointer&&i instanceof e.P?i:r.project(this._lngLat,this._altitude),o=ap(this.options.offset),a=this._anchor=this._getAnchor(o.y),s=ap(this.options.offset,a),l=n.add(s).round();r._requestDomTask(()=>{this._container&&a&&(this._container.style.transform=`${aa[a]} translate(${l.x}px,${l.y}px)`)})}if(!this._marker&&r._showingGlobe()){let i=+!e.eK(r.transform,this._lngLat);this._setOpacity(i)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:al,Style:iC,LngLat:e.cd,LngLatBounds:e.aG,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:t7,Evented:e.E,config:e.e,prewarm:e.eP,clearPrewarmedResources:e.eQ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.eR.workerCount},set workerCount(t){e.eR.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(i){e.eS(i)},get workerUrl(){return e.eT.workerUrl},set workerUrl(t){e.eT.workerUrl=t},get workerClass(){return e.eT.workerClass},set workerClass(t){e.eT.workerClass=t},get workerParams(){return e.eT.workerParams},set workerParams(t){e.eT.workerParams=t},get dracoUrl(){return e.eU()},set dracoUrl(t){e.eV(t)},get meshoptUrl(){return e.eW()},set meshoptUrl(t){e.eX(t)},setNow:e.q.setNow,restoreNow:e.q.restoreNow}}),r}();var ua={},us={},ul={},uh={};uh=function(){for(var e={},i=0;i<arguments.length;i++){var r=arguments[i];for(var n in r)uu.call(r,n)&&(e[n]=r[n])}return e};var uu=Object.prototype.hasOwnProperty,uc={};uc=eG={},eG.simpleFilter=function(e,i){return i.filter(function(i){return eG.test(e,i)})},eG.test=function(e,i){return null!==eG.match(e,i)},eG.match=function(e,i,r){r=r||{};var n,o=0,a=[],s=i.length,l=0,h=0,u=r.pre||"",c=r.post||"",d=r.caseSensitive&&i||i.toLowerCase();e=r.caseSensitive&&e||e.toLowerCase();for(var p=0;p<s;p++)n=i[p],d[p]===e[o]?(n=u+n+c,o+=1,h+=1+h):h=0,l+=h,a[a.length]=n;return o===e.length?(l=d===e?1/0:l,{rendered:a.join(""),score:l}):null},eG.filter=function(e,i,r){return i&&0!==i.length?"string"!=typeof e?i:(r=r||{},i.reduce(function(i,n,o,a){var s=n;r.extract&&(s=r.extract(n));var l=eG.match(e,s,r);return null!=l&&(i[i.length]={string:l.rendered,score:l.score,index:o,original:n}),i},[]).sort(function(e,i){var r=i.score-e.score;return r||e.index-i.index})):[]};var ud={},up=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};up.prototype.show=function(){this.element.style.display="block"},up.prototype.hide=function(){this.element.style.display="none"},up.prototype.add=function(e){this.items.push(e)},up.prototype.clear=function(){this.items=[],this.active=0},up.prototype.isEmpty=function(){return!this.items.length},up.prototype.isVisible=function(){return"block"===this.element.style.display},up.prototype.draw=function(){if(this.element.innerHTML="",0===this.items.length)return void this.hide();for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()},up.prototype.drawItem=function(e,i){var r=document.createElement("li"),n=document.createElement("a");i&&(r.className+=" active"),n.innerHTML=e.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))},up.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},up.prototype.move=function(e){this.active=e,this.draw()},up.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},up.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},up.prototype.drawError=function(e){var i=document.createElement("li");i.innerHTML=e,this.element.appendChild(i),this.show()},ud=up;var uf=function(e,i,r){return r=r||{},this.options=uh({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=e,this.data=i||[],this.list=new ud(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(e){this.handleKeyUp(e.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(e){this.handleKeyDown(e)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(e){this.handlePaste(e)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};uf.prototype.handleKeyUp=function(e){40!==e&&38!==e&&27!==e&&13!==e&&9!==e&&this.handleInputChange(this.el.value)},uf.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},uf.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},uf.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var i=this;setTimeout(function(){i.handleInputChange(e.target.value)},100)}},uf.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength)return void this.list.draw();this.getCandidates((function(e){for(var i=0;i<e.length&&(this.list.add(e[i]),i!==this.options.limit-1);i++);this.list.draw()}).bind(this))},uf.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},uf.prototype.update=function(e){this.data=e,this.handleKeyUp()},uf.prototype.clear=function(){this.data=[],this.list.clear()},uf.prototype.normalize=function(e){return e=e.toLowerCase()},uf.prototype.match=function(e,i){return e.indexOf(i)>-1},uf.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent("change",!0,!1),this.el.dispatchEvent(i)}else this.el.fireEvent("onchange")},uf.prototype.getCandidates=function(e){var i,r={pre:"<strong>",post:"</strong>",extract:(function(e){return this.getItemValue(e)}).bind(this)};e(this.options.filter?uc.filter(this.query,this.data,r).map((function(e){return{original:e.original,string:this.render(e.original,e.string)}}).bind(this)):this.data.map((function(e){var i=this.render(e);return{original:e,string:i}}).bind(this)))},uf.prototype.getItemValue=function(e){return e},uf.prototype.render=function(e,i){if(i)return i;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(r),o=n.lastIndexOf(this.query);o>-1;){var a=o+this.query.length;r=r.slice(0,o)+"<strong>"+r.slice(o,a)+"</strong>"+r.slice(a),o=n.slice(0,o).lastIndexOf(this.query)}return r},uf.prototype.renderError=function(e){this.list.drawError(e)},us=ul=uf,"undefined"!=typeof window&&(window.Suggestions=ul);var um={},ug=0/0,u_=/^\s+|\s+$/g,uy=/^[-+]0x[0-9a-f]+$/i,uv=/^0b[01]+$/i,ux=/^0o[0-7]+$/i,ub=parseInt,uw="object"==typeof eQ&&eQ&&eQ.Object===Object&&eQ,uT="object"==typeof self&&self&&self.Object===Object&&self,uS=uw||uT||Function("return this")(),uE=Object.prototype.toString,uI=Math.max,uC=Math.min,uA=function(){return uS.Date.now()};function uR(e){var i=typeof e;return!!e&&("object"==i||"function"==i)}function uM(e){if("number"==typeof e)return e;if("symbol"==typeof(i=e)||i&&"object"==typeof i&&"[object Symbol]"==uE.call(i))return ug;if(uR(e)){var i,r="function"==typeof e.valueOf?e.valueOf():e;e=uR(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(u_,"");var n=uv.test(e);return n||ux.test(e)?ub(e.slice(2),n?2:8):uy.test(e)?ug:+e}um=function(e,i,r){var n,o,a,s,l,h,u=0,c=!1,d=!1,p=!0;if("function"!=typeof e)throw TypeError("Expected a function");function f(i){var r=n,a=o;return n=o=void 0,u=i,s=e.apply(a,r)}function m(e){var r=e-h,n=e-u;return void 0===h||r>=i||r<0||d&&n>=a}function g(){var e,r,n,o=uA();if(m(o))return _(o);l=setTimeout(g,(e=o-h,r=o-u,n=i-e,d?uC(n,a-r):n))}function _(e){return(l=void 0,p&&n)?f(e):(n=o=void 0,s)}function y(){var e,r=uA(),a=m(r);if(n=arguments,o=this,h=r,a){if(void 0===l)return u=e=h,l=setTimeout(g,i),c?f(e):s;if(d)return l=setTimeout(g,i),f(h)}return void 0===l&&(l=setTimeout(g,i)),s}return i=uM(i)||0,uR(r)&&(c=!!r.leading,a=(d="maxWait"in r)?uI(uM(r.maxWait)||0,i):a,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==l&&clearTimeout(l),u=0,n=h=o=l=void 0},y.flush=function(){return void 0===l?s:_(uA())},y};var uP={},uO="object"==typeof Reflect?Reflect:null,uk=uO&&"function"==typeof uO.apply?uO.apply:function(e,i,r){return Function.prototype.apply.call(e,i,r)};eJ=uO&&"function"==typeof uO.ownKeys?uO.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var uL=Number.isNaN||function(e){return e!=e};function uD(){uD.init.call(this)}(uP=uD).once=function(e,i){return new Promise(function(r,n){var o,a,s;function l(r){e.removeListener(i,h),n(r)}function h(){"function"==typeof e.removeListener&&e.removeListener("error",l),r([].slice.call(arguments))}u$(e,i,h,{once:!0}),"error"!==i&&(o=e,a=l,s={once:!0},"function"==typeof o.on&&u$(o,"error",a,s))})},uD.EventEmitter=uD,uD.prototype._events=void 0,uD.prototype._eventsCount=0,uD.prototype._maxListeners=void 0;var uz=10;function uF(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function uB(e){return void 0===e._maxListeners?uD.defaultMaxListeners:e._maxListeners}function uN(e,i,r,n){if(uF(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",i,r.listener?r.listener:r),a=e._events),s=a[i]),void 0===s)s=a[i]=r,++e._eventsCount;else if("function"==typeof s?s=a[i]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=uB(e))>0&&s.length>o&&!s.warned){s.warned=!0;var o,a,s,l=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=i,l.count=s.length,console&&console.warn&&console.warn(l)}return e}function uj(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function uV(e,i,r){var n={fired:!1,wrapFn:void 0,target:e,type:i,listener:r},o=uj.bind(n);return o.listener=r,n.wrapFn=o,o}function uU(e,i,r){var n=e._events;if(void 0===n)return[];var o=n[i];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var i=Array(e.length),r=0;r<i.length;++r)i[r]=e[r].listener||e[r];return i}(o):uq(o,o.length)}function uG(e){var i=this._events;if(void 0!==i){var r=i[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function uq(e,i){for(var r=Array(i),n=0;n<i;++n)r[n]=e[n];return r}function u$(e,i,r,n){if("function"==typeof e.on)n.once?e.once(i,r):e.on(i,r);else if("function"==typeof e.addEventListener)e.addEventListener(i,function o(a){n.once&&e.removeEventListener(i,o),r(a)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(uD,"defaultMaxListeners",{enumerable:!0,get:function(){return uz},set:function(e){if("number"!=typeof e||e<0||uL(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");uz=e}}),uD.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},uD.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||uL(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},uD.prototype.getMaxListeners=function(){return uB(this)},uD.prototype.emit=function(e){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if(i.length>0&&(a=i[0]),a instanceof Error)throw a;var a,s=Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)uk(l,this,i);else for(var h=l.length,u=uq(l,h),r=0;r<h;++r)uk(u[r],this,i);return!0},uD.prototype.addListener=function(e,i){return uN(this,e,i,!1)},uD.prototype.on=uD.prototype.addListener,uD.prototype.prependListener=function(e,i){return uN(this,e,i,!0)},uD.prototype.once=function(e,i){return uF(i),this.on(e,uV(this,e,i)),this},uD.prototype.prependOnceListener=function(e,i){return uF(i),this.prependListener(e,uV(this,e,i)),this},uD.prototype.removeListener=function(e,i){var r,n,o,a,s;if(uF(i),void 0===(n=this._events)||void 0===(r=n[e]))return this;if(r===i||r.listener===i)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||i));else if("function"!=typeof r){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===i||r[a].listener===i){s=r[a].listener,o=a;break}if(o<0)return this;0===o?r.shift():function(e,i){for(;i+1<e.length;i++)e[i]=e[i+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||i)}return this},uD.prototype.off=uD.prototype.removeListener,uD.prototype.removeAllListeners=function(e){var i,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var o,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(o=a[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(i=r[e]))this.removeListener(e,i);else if(void 0!==i)for(n=i.length-1;n>=0;n--)this.removeListener(e,i[n]);return this},uD.prototype.listeners=function(e){return uU(this,e,!0)},uD.prototype.rawListeners=function(e){return uU(this,e,!1)},uD.listenerCount=function(e,i){return"function"==typeof e.listenerCount?e.listenerCount(i):uG.call(e,i)},uD.prototype.listenerCount=uG,uD.prototype.eventNames=function(){return this._eventsCount>0?eJ(this._events):[]};var uH=uP.EventEmitter,uZ={};uZ={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};var uW={},uX={},uY={},uK={},uJ={};function uQ(e,i){this.request=e,this.headers=i.headers,this.rawBody=i.body,this.statusCode=i.statusCode;try{this.body=JSON.parse(i.body||"{}")}catch(e){this.body=i.body}this.links=uJ(this.headers.link)}uJ=function(e){return e?e.split(/,\s*</).reduce(function(e,i){var r=function(e){var i=e.match(/<?([^>]*)>(.*)/);if(!i)return null;var r=i[1],n=i[2].split(";"),o=null,a=n.reduce(function(e,i){var r,n=(r=i.match(/\s*(.+)\s*=\s*"?([^"]+)"?/))?{key:r[1],value:r[2]}:null;return n&&("rel"===n.key?o||(o=n.value):e[n.key]=n.value),e},{});return o?{url:r,rel:o,params:a}:null}(i);return r&&r.rel.split(/\s+/).forEach(function(i){e[i]||(e[i]={url:r.url,params:r.params})}),e},{}):{}},uQ.prototype.hasNextPage=function(){return!!this.links.next},uQ.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},uK=uQ;var u0={},u1={};u1={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},u0=function(e){var i,r=e.type||u1.ERROR_HTTP;if(e.body)try{i=JSON.parse(e.body)}catch(r){i=e.body}else i=null;var n=e.message||null;n||("string"==typeof i?n=i:i&&"string"==typeof i.message?n=i.message:r===u1.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=r,this.statusCode=e.statusCode||null,this.request=e.request,this.body=i};var u2={};u2=function(e){var i={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(e){var r,n=(r=e.indexOf(":"),{name:e.substring(0,r).trim().toLowerCase(),value:e.substring(r+1).trim()});i[n.name]=n.value}),i};var u3={};function u5(e){var i=e.total,r=e.loaded;return{total:i,transferred:r,percent:100*r/i}}function u4(e,i){return new Promise(function(r,n){i.onprogress=function(i){e.emitter.emit(u1.EVENT_PROGRESS_DOWNLOAD,u5(i))};var o=e.file;o&&(i.upload.onprogress=function(i){e.emitter.emit(u1.EVENT_PROGRESS_UPLOAD,u5(i))}),i.onerror=function(e){n(e)},i.onabort=function(){n(new u0({request:e,type:u1.ERROR_REQUEST_ABORTED}))},i.onload=function(){if(delete u3[e.id],i.status<200||i.status>=400)return void n(new u0({request:e,body:i.response,statusCode:i.status}));r(i)};var a=e.body;"string"==typeof a?i.send(a):a?i.send(JSON.stringify(a)):o?i.send(o):i.send(),u3[e.id]=i}).then(function(i){return new uK(e,{body:i.response,headers:u2(i.getAllResponseHeaders()),statusCode:i.status})})}function u6(e,i){var r=e.url(i),n=new window.XMLHttpRequest;return n.open(e.method,r),Object.keys(e.headers).forEach(function(i){n.setRequestHeader(i,e.headers[i])}),n}uY={browserAbort:function(e){var i=u3[e.id];i&&(i.abort(),delete u3[e.id])},sendRequestXhr:u4,browserSend:function(e){return Promise.resolve().then(function(){var i=u6(e,e.client.accessToken);return u4(e,i)})},createRequestXhr:u6};var u8={},u9={},u7=e5("f9AGe"),ce={};function ct(e,i){return Object.prototype.hasOwnProperty.call(e,i)}u9=function(e){if(ce[e])return ce[e];var i=e.split("."),r=i[0],n=i[1];if(!n)throw Error("Invalid token");var o=function(e){try{return JSON.parse(u7.decode(e))}catch(e){throw Error("Invalid token")}}(n),a={usage:r,user:o.u};return ct(o,"a")&&(a.authorization=o.a),ct(o,"exp")&&(a.expires=1e3*o.exp),ct(o,"iat")&&(a.created=1e3*o.iat),ct(o,"scopes")&&(a.scopes=o.scopes),ct(o,"client")&&(a.client=o.client),ct(o,"ll")&&(a.lastLogin=o.ll),ct(o,"iu")&&(a.impersonator=o.iu),ce[e]=a,a};var ci={},cr={},cn=Object.prototype.hasOwnProperty,co="~";function ca(){}function cs(e,i,r){this.fn=e,this.context=i,this.once=r||!1}function cl(e,i,r,n,o){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new cs(r,n||e,o),s=co?co+i:i;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],a]:e._events[s].push(a):(e._events[s]=a,e._eventsCount++),e}function ch(e,i){0==--e._eventsCount?e._events=new ca:delete e._events[i]}function cu(){this._events=new ca,this._eventsCount=0}Object.create&&(ca.prototype=Object.create(null),new ca().__proto__||(co=!1)),cu.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)cn.call(e,i)&&r.push(co?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},cu.prototype.listeners=function(e){var i=co?co+e:e,r=this._events[i];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=Array(o);n<o;n++)a[n]=r[n].fn;return a},cu.prototype.listenerCount=function(e){var i=co?co+e:e,r=this._events[i];return r?r.fn?1:r.length:0},cu.prototype.emit=function(e,i,r,n,o,a){var s=co?co+e:e;if(!this._events[s])return!1;var l,h,u=this._events[s],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,i),!0;case 3:return u.fn.call(u.context,i,r),!0;case 4:return u.fn.call(u.context,i,r,n),!0;case 5:return u.fn.call(u.context,i,r,n,o),!0;case 6:return u.fn.call(u.context,i,r,n,o,a),!0}for(h=1,l=Array(c-1);h<c;h++)l[h-1]=arguments[h];u.fn.apply(u.context,l)}else{var d,p=u.length;for(h=0;h<p;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),c){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,i);break;case 3:u[h].fn.call(u[h].context,i,r);break;case 4:u[h].fn.call(u[h].context,i,r,n);break;default:if(!l)for(d=1,l=Array(c-1);d<c;d++)l[d-1]=arguments[d];u[h].fn.apply(u[h].context,l)}}return!0},cu.prototype.on=function(e,i,r){return cl(this,e,i,r,!1)},cu.prototype.once=function(e,i,r){return cl(this,e,i,r,!0)},cu.prototype.removeListener=function(e,i,r,n){var o=co?co+e:e;if(!this._events[o])return this;if(!i)return ch(this,o),this;var a=this._events[o];if(a.fn)a.fn!==i||n&&!a.once||r&&a.context!==r||ch(this,o);else{for(var s=0,l=[],h=a.length;s<h;s++)(a[s].fn!==i||n&&!a[s].once||r&&a[s].context!==r)&&l.push(a[s]);l.length?this._events[o]=1===l.length?l[0]:l:ch(this,o)}return this},cu.prototype.removeAllListeners=function(e){var i;return e?(i=co?co+e:e,this._events[i]&&ch(this,i)):(this._events=new ca,this._eventsCount=0),this},cu.prototype.off=cu.prototype.removeListener,cu.prototype.addListener=cu.prototype.on,cu.prefixed=co,cu.EventEmitter=cu,cr=cu;var cc={};function cd(e){return Array.isArray(e)?e.map(encodeURIComponent).join(","):encodeURIComponent(String(e))}function cp(e,i,r){if(!1===r||null===r)return e;var n=/\?/.test(e)?"&":"?",o=encodeURIComponent(i);return void 0!==r&&""!==r&&!0!==r&&(o+="="+cd(r)),""+e+n+o}cc={appendQueryObject:function(e,i){if(!i)return e;var r=e;return Object.keys(i).forEach(function(e){var n=i[e];void 0!==n&&(Array.isArray(n)&&(n=n.filter(function(e){return null!=e}).join(",")),r=cp(r,e,n))}),r},appendQueryParam:cp,prependOrigin:function(e,i){if(!i||"http"===e.slice(0,4))return e;var r="/"===e[0]?"":"/";return""+i.replace(/\/$/,"")+r+e},interpolateRouteParams:function(e,i){return i?e.replace(/\/:([a-zA-Z0-9]+)/g,function(e,r){var n=i[r];if(void 0===n)throw Error("Unspecified route parameter "+r);return"/"+cd(n)}):e}};var cf=1;function cm(e,i){if(!e)throw Error("MapiRequest requires a client");if(!i||!i.path||!i.method)throw Error("MapiRequest requires an options object with path and method properties");var r={};i.body&&(r["content-type"]="application/json");var n=uh(r,i.headers),o=Object.keys(n).reduce(function(e,i){return e[i.toLowerCase()]=n[i],e},{});this.id=cf++,this._options=i,this.emitter=new cr,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=i.path,this.method=i.method,this.origin=i.origin||e.origin,this.query=i.query||{},this.params=i.params||{},this.body=i.body||null,this.file=i.file||null,this.encoding=i.encoding||"utf8",this.sendFileAs=i.sendFileAs||null,this.headers=o}function cg(e){if(!e||!e.accessToken)throw Error("Cannot create a client without an access token");u9(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||u1.API_ORIGIN}function c_(e){u8.call(this,e)}cm.prototype.url=function(e){var i=cc.prependOrigin(this.path,this.origin);i=cc.appendQueryObject(i,this.query);var r=this.params,n=null==e?this.client.accessToken:e;if(n){i=cc.appendQueryParam(i,"access_token",n);var o=u9(n).user;r=uh({ownerId:o},r)}return cc.interpolateRouteParams(i,r)},cm.prototype.send=function(){var e=this;if(e.sent)throw Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(i){return e.response=i,e.emitter.emit(u1.EVENT_RESPONSE,i),i},function(i){throw e.error=i,e.emitter.emit(u1.EVENT_ERROR,i),i})},cm.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},cm.prototype.eachPage=function(e){var i=this;function r(r){e(null,r,function(){delete i._nextPageRequest;var e=r.nextPage();e&&(i._nextPageRequest=e,o(e))})}function n(i){e(i,null,function(){})}function o(e){e.send().then(r,n)}o(this)},cm.prototype.clone=function(){return this._extend()},cm.prototype._extend=function(e){var i=uh(this._options,e);return new cm(this.client,i)},ci=cm,cg.prototype.createRequest=function(e){return new ci(this,e)},c_.prototype=Object.create((u8=cg).prototype),c_.prototype.constructor=c_,c_.prototype.sendRequest=uY.browserSend,c_.prototype.abortRequest=uY.browserAbort,uW=uX=function(e){return new c_(e)};var cy={},cv={},cx={},cb={},cw=Object.prototype.toString;cb=function(e){var i;return"[object Object]"===cw.call(e)&&(null===(i=Object.getPrototypeOf(e))||i===Object.getPrototypeOf({}))};var cT="value",cS={};function cE(e){var i=Array.isArray(e);return function(r){var n,o=cI(cS.plainArray,r);if(o)return o;if(i&&r.length!==e.length)return"an array with "+e.length+" items";for(var a=0;a<r.length;a++)if(o=cI((n=a,i?e[n]:e),r[a]))return[a].concat(o)}}function cI(e,i){if(null!=i||e.hasOwnProperty("__required")){var r=e(i);if(r)return Array.isArray(r)?r:[r]}}function cC(e,i){var r,n=e.length,o=e[n-1],a=e.slice(0,n-1);return 0===a.length&&(a=[cT]),i=uh(i,{path:a}),"function"==typeof o?o(i):cA(i,"must be "+(r=o,/^an? /.test(r)?r:/^[aeiou]/i.test(r)?"an "+r:/^[a-z]/i.test(r)?"a "+r:r)+".")}function cA(e,i){return(cR(e.path)?"Item at position ":"")+(e.path.join(".")+" "+i)}function cR(e){return"number"==typeof e[e.length-1]||"number"==typeof e[0]}cS.assert=function(e,i){return i=i||{},function(r){var n=cI(e,r);if(n){var o=cC(n,i);throw i.apiName&&(o=i.apiName+": "+o),Error(o)}}},cS.shape=function(e){var i,r=Object.keys((i=e)||{}).map(function(e){return{key:e,value:i[e]}});return function(e){var i,n=cI(cS.plainObject,e);if(n)return n;for(var o=[],a=0;a<r.length;a++)i=r[a].key,(n=cI(r[a].value,e[i]))&&o.push([i].concat(n));return o.length<2?o[0]:function(e){o=o.map(function(i){return"- "+i[0]+": "+cC(i,e).split("\n").join("\n  ")});var i=e.path.join(".");return"The following properties"+(i===cT?"":" of "+i)+" have invalid values:\n  "+o.join("\n  ")}}},cS.strictShape=function(e){var i=cS.shape(e);return function(r){var n=i(r);if(n)return n;var o=Object.keys(r).reduce(function(i,r){return void 0===e[r]&&i.push(r),i},[]);if(0!==o.length)return function(){return"The following keys are invalid: "+o.join(", ")}}},cS.arrayOf=function(e){return cE(e)},cS.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return cE(e)},cS.required=function(e){function i(i){return null==i?function(e){return cA(e,cR(e.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return i.__required=!0,i},cS.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(i){var r,n=e.map(function(e){return cI(e,i)}).filter(Boolean);if(n.length===e.length){return n.every(function(e){return 1===e.length&&"string"==typeof e[0]})?(r=n.map(function(e){return e[0]})).length<2?r[0]:2===r.length?r.join(" or "):r.slice(0,-1).join(", ")+", or "+r.slice(-1):n.reduce(function(e,i){return i.length>e.length?i:e})}}},cS.equal=function(e){return function(i){if(i!==e)return JSON.stringify(e)}},cS.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),i=e.map(function(e){return cS.equal(e)});return cS.oneOfType.apply(this,i)},cS.range=function(e){var i=e[0],r=e[1];return function(e){if(cI(cS.number,e)||e<i||e>r)return"number between "+i+" & "+r+" (inclusive)"}},cS.any=function(){},cS.boolean=function(e){if("boolean"!=typeof e)return"boolean"},cS.number=function(e){if("number"!=typeof e)return"number"},cS.plainArray=function(e){if(!Array.isArray(e))return"array"},cS.plainObject=function(e){if(!cb(e))return"object"},cS.string=function(e){if("string"!=typeof e)return"string"},cS.func=function(e){if("function"!=typeof e)return"function"},cS.validate=cI,cS.processMessage=cC,cv=uh(cx=cS,{file:function(e){if("undefined"!=typeof window){if(e instanceof eQ.Blob||e instanceof eQ.ArrayBuffer)return;return"Blob or ArrayBuffer"}if("string"!=typeof e&&void 0===e.pipe)return"Filename or Readable stream"},date:function(e){var i="date";if("boolean"==typeof e)return i;try{var r=new Date(e);if(r.getTime&&isNaN(r.getTime()))return i}catch(e){return i}},coordinates:function(e){return cx.tuple(cx.number,cx.number)(e)},assertShape:function(e,i){return cx.assert(cx.strictShape(e),i)}});var cM={};cM=function(e,i){var r=function(e,r){return -1!==i.indexOf(e)&&void 0!==r};return"function"==typeof i&&(r=i),Object.keys(e).filter(function(i){return r(i,e[i])}).reduce(function(i,r){return i[r]=e[r],i},{})};var cP={},cO={};cO=function(e,i){return Object.keys(e).reduce(function(r,n){return r[n]=i(n,e[n]),r},{})},cP=function(e){return cO(e,function(e,i){return"boolean"==typeof i?JSON.stringify(i):i})};var ck={};ck=function(e){return function(i){var r=u8.prototype.isPrototypeOf(i)?i:uX(i),n=Object.create(e);return n.client=r,n}};var cL={},cD=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];cL.forwardGeocode=function(e){cv.assertShape({query:cv.required(cv.string),mode:cv.oneOf("mapbox.places","mapbox.places-permanent"),countries:cv.arrayOf(cv.string),proximity:cv.oneOf(cv.coordinates,"ip"),types:cv.arrayOf(cv.oneOf(cD)),autocomplete:cv.boolean,bbox:cv.arrayOf(cv.number),limit:cv.number,language:cv.arrayOf(cv.string),routing:cv.boolean,fuzzyMatch:cv.boolean,worldview:cv.string,session_token:cv.string})(e),e.mode=e.mode||"mapbox.places";var i=cP(uh({country:e.countries},cM(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:cM(e,["mode","query"]),query:i})},cL.reverseGeocode=function(e){cv.assertShape({query:cv.required(cv.coordinates),mode:cv.oneOf("mapbox.places","mapbox.places-permanent"),countries:cv.arrayOf(cv.string),types:cv.arrayOf(cv.oneOf(cD)),bbox:cv.arrayOf(cv.number),limit:cv.number,language:cv.arrayOf(cv.string),reverseMode:cv.oneOf("distance","score"),routing:cv.boolean,worldview:cv.string,session_token:cv.string})(e),e.mode=e.mode||"mapbox.places";var i=cP(uh({country:e.countries},cM(e,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:cM(e,["mode","query"]),query:i})},cy=ck(cL);var cz={},cF=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,i)=>((i&=63)<36?e+=i.toString(36):i<62?e+=(i-26).toString(36).toUpperCase():i>62?e+="-":e+="_",e),"");function cB(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=[],this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}cB.prototype={select:function(e,i){var r=this.getEventPayload("search.select",i,{selectedFeature:e});if(r&&(r.resultIndex!==this.lastSentIndex||r.queryString!==this.lastSentInput)&&-1!=r.resultIndex)return this.lastSentIndex=r.resultIndex,this.lastSentInput=r.queryString,this.push(r)},start:function(e){var i=this.getEventPayload("search.start",e);if(i)return this.push(i)},keyevent:function(e,i){if(e.key&&!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)){var r=this.getEventPayload("search.keystroke",i,{key:e.key});if(r)return this.push(r)}},send:function(e,i){if(!this.enableEventLogging)return i?i():void 0;var r=this.getRequestOptions(e);this.request(r,(function(e){return e?this.handleError(e,i):i?i():void 0}).bind(this))},getRequestOptions:function(e){return Array.isArray(e)||(e=[e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},getEventPayload:function(e,i,r={}){if("search.select"===e&&!r.selectedFeature||"search.keystroke"===e&&!r.key)return null;if(i.options.proximity)if("object"==typeof i.options.proximity)n=[i.options.proximity.longitude,i.options.proximity.latitude];else if("ip"===i.options.proximity){var n,o=i._headers?i._headers["ip-proximity"]:null;n=o&&"string"==typeof o?o.split(",").map(parseFloat):[999,999]}else n=i.options.proximity;else n=null;var a=i._map?i._map.getZoom():void 0,s={event:e,version:this.getEventSchemaVersion(e),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:i.options.autocomplete,fuzzyMatch:i.options.fuzzyMatch,proximity:n,limit:i.options.limit,routing:i.options.routing,worldview:i.options.worldview,mapZoom:a,keyboardLocale:this.locale};if("search.select"===e?s.queryString=i.inputString:"search.select"!=e&&i._inputEl?s.queryString=i._inputEl.value:s.queryString=i.inputString,["search.keystroke","search.select"].includes(e)&&(s.path="geocoding/v5/mapbox.places"),"search.keystroke"===e&&r.key)s.lastAction=r.key;else if("search.select"===e&&r.selectedFeature){var l=r.selectedFeature;if(s.resultIndex=this.getSelectedIndex(l,i),s.resultPlaceName=l.place_name,s.resultId=l.id,l.properties&&(s.resultMapboxId=l.properties.mapbox_id),i._typeahead){var h=i._typeahead.data;h&&h.length>0&&(s.suggestionIds=this.getSuggestionIds(h),s.suggestionNames=this.getSuggestionNames(h),s.suggestionTypes=this.getSuggestionTypes(h),s.suggestionSources=this.getSuggestionSources(h))}}return this.validatePayload(s)?s:null},request:function(e,i){var r=new XMLHttpRequest;for(var n in r.onreadystatechange=function(){if(4==this.readyState)if(204==this.status)return i(null);else return i(this.statusText)},r.open(e.method,e.host+"/"+e.path,!0),e.headers){var o=e.headers[n];r.setRequestHeader(n,o)}r.send(e.body)},handleError:function(e,i){if(i)return i(e)},generateSessionID:function(){return cF()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,i){if(i._typeahead){var r=i._typeahead.data,n=e.id;return r.map(function(e){return e.id}).indexOf(n)}},getSuggestionIds:function(e){return e.map(function(e){return e.properties?e.properties.mapbox_id||"":e.id||""})},getSuggestionNames:function(e){return e.map(function(e){return e.place_name||""})},getSuggestionTypes:function(e){return e.map(function(e){return e.place_type&&Array.isArray(e.place_type)&&e.place_type[0]||""})},getSuggestionSources:function(e){return e.map(function(e){return e._source||""})},getEventSchemaVersion:function(e){return["search.keystroke","search.select"].includes(e)?"2.2":"2.0"},validatePayload:function(e){if(!e||!e.event)return!1;var i=e.event;return"search.start"===i?this.objectHasRequiredProps(e,["event","created","sessionIdentifier","queryString"]):"search.keystroke"===i?this.objectHasRequiredProps(e,["event","created","sessionIdentifier","queryString","lastAction"]):"search.select"!==i||this.objectHasRequiredProps(e,["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"])},objectHasRequiredProps:function(e,i){return i.every(function(i){return"queryString"===i?"string"==typeof e[i]&&e[i].length>0:void 0!==e[i]})},shouldEnableLogging:function(e){return!1!==e.enableEventLogging&&(!e.origin||"https://api.mapbox.com"===e.origin)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=[]),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,i){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||i)&&this.flush()},remove:function(){this.flush()}},cz=cB;var cN={};cN={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"×××¤×©",ja:"ãµã¼ã",lv:"MeklÄt",pt:"Procurar",sr:"ÐÑÐµÑÑÐ°Ð³Ð°",zh:"æç´¢",cs:"VyhledÃ¡vÃ¡nÃ­",hu:"KeresÃ©s",ka:"á«áááá",nb:"SÃ¸ke",sk:"VyhÄ¾adÃ¡vanie",th:"à¸à¹à¸à¸«à¸²",fi:"Hae",is:"Leita",ko:"ìì",pl:"Szukaj",sl:"Iskanje",fa:"Ø¬Ø³ØªØ¬Ù",ru:"ÐÐ¾Ð¸ÑÐº"}};var cj={};eq=cj,e$=function(){var e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(i){return i.match(e)||[]}function r(e){return{language:(e=i(e))[1]||"",extlang:e[2]||"",script:e[3]||"",region:e[4]||""}}function n(e,i,r){Object.defineProperty(e,i,{value:r,enumerable:!0})}function o(e,o,a){function s(r){return i(r)[e]||""}n(s,"pattern",o),n(r,a,s)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),n(r,"split",function(e){return i(e).filter(function(e,i){return e&&i})}),r},cj?cj=e$():eq.subtag=e$();var cV={};function cU(){}cU.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){let e={enableHighAccuracy:!0};return new Promise(function(i,r){window.navigator.geolocation.getCurrentPosition(i,r,e)})}},cV=cU;var cG={};function cq(e){let i=e.address||"",r=e.text||"",n=e.place_name||"",o={address:n.split(",")[0],houseNumber:i,street:r,placeName:n};return e.context.forEach(function(e){o[e.id.split(".")[0]]=e.text}),o}cG={transformFeatureToGeolocationText:function(e,i){var r;let n=cq(e),o=["address","street","place","country"];if("function"==typeof i)return i(n);let a=o.indexOf(i);return(-1===a?o:o.slice(a)).reduce(function(e,i){return n[i]?(""!==e&&(e+=", "),e+n[i]):e},"")},getAddressInfo:cq,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/};const c$={FORWARD:0,LOCAL:1,REVERSE:2};function cH(e){this._eventEmitter=new uH,this.options=uh({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new cV}cH.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var i=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+i[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+i.splice(1,i.length).join(",")+"</div></div>"}},_headers:{},addTo:function(e){function i(e,i){if(!document.body.contains(i))throw Error("Element provided to #addTo() exists, but is not in the DOM");let r=e.onAdd();i.appendChild(r)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)i(this,e);else if("string"==typeof e){let r=document.querySelectorAll(e);if(0===r.length)throw Error("Element ",e,"not found.");if(r.length>1)throw Error("Geocoder can only be added to a single html element");i(this,r[0])}else throw Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&"string"!=typeof e&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=cy(uW({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new cz(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var i,r=this.container=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",um(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(e){this.eventManager.keyevent(e,this)}).bind(this));var o=document.createElement("div");o.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),o.appendChild(this._clearEl),o.appendChild(this._loadingEl),r.appendChild(n),r.appendChild(this._inputEl),r.appendChild(o),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var s=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(s),o.appendChild(this._geolocateEl),this._showGeolocateButton()}var l=this._typeahead=new us(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),l.getItemValue=this.options.getItemValue;var h=l.list.draw,u=this._footerNode=((i=document.createElement("div")).className="mapboxgl-ctrl-geocoder--powered-by",i.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',i);return l.list.draw=function(){h.call(this),u.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),u.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(u)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),r},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(e){this._hideLoadingIcon();let i={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(i),this._fly(i),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(i),this._showClearButton(),this.fresh=!1;let r={limit:1,language:[this.options.language],query:i.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){let e=i.geometry.coordinates[0]+","+i.geometry.coordinates[1];this._setInputValue(e),this._eventEmitter.emit("result",{result:i})}else this.geocoderService.reverseGeocode(r).send().then((function(e){let r=e.body.features[0];if(r){let e=cG.transformFeatureToGeolocationText(r,this.options.addressAccuracy);this._setInputValue(e),r.user_coordinates=i.geometry.coordinates,this._eventEmitter.emit("result",{result:r})}else this._eventEmitter.emit("result",{result:{user_coordinates:i.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(e){1===e.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(e,i){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=i,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(e){var i=(e.clipboardData||window.clipboardData).getData("text");i.length>=this.options.minLength&&this._geocode(i)},_onKeyDown:function(e){if(27===e.keyCode&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var i=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target;if(!(i?i.value:""))return this.fresh=!0,9!==e.keyCode&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)&&i.value.length>=this.options.minLength&&this._geocode(i.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var i;if(e.properties&&uZ[e.properties.short_code])i=uh({},this.options.flyTo),this._map&&this._map.fitBounds(uZ[e.properties.short_code].bbox,i);else if(e.bbox){var r=e.bbox;i=uh({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],i)}else{var n={zoom:this.options.zoom};i=uh({},n,this.options.flyTo),e.center?i.center=e.center:e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&(i.center=e.geometry.coordinates),this._map&&this._map.flyTo(i)}},_requestType:function(e,i){var r;return e.localGeocoderOnly?c$.LOCAL:e.reverseGeocode&&cG.REVERSE_GEOCODE_COORD_RGX.test(i)?c$.REVERSE:c$.FORWARD},_setupConfig:function(e,i){let r=/[\s,]+/;var n=this,o=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(e,i){if(void 0===n.options[i]||null===n.options[i])return e;["countries","types","language"].indexOf(i)>-1?e[i]=n.options[i].split(r):e[i]=n.options[i];let o="number"==typeof n.options[i].longitude&&"number"==typeof n.options[i].latitude;if("proximity"===i&&o){let r=n.options[i].longitude,o=n.options[i].latitude;e[i]=[r,o]}return e},{});switch(e){case c$.REVERSE:var a=i.split(r).map(function(e){return parseFloat(e,10)});n.options.flipCoordinates||a.reverse(),o.types&&o.types[0],o=uh(o,{query:a,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(e){e in o&&delete o[e]});break;case c$.FORWARD:{let e=i.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(e)&&(i=i.replace(/,/g," ")),o=uh(o,{query:i})}}return o.session_token=this.eventManager.getSessionId(),o},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});let i=this._requestType(this.options,e),r=this._setupConfig(i,e);switch(i){case c$.LOCAL:n=Promise.resolve();break;case c$.FORWARD:n=this.geocoderService.forwardGeocode(r).send();break;case c$.REVERSE:n=this.geocoderService.reverseGeocode(r).send()}var n,o=this.options.localGeocoder&&this.options.localGeocoder(e)||[],a=[],s=null;return n.catch((function(e){s=e}).bind(this)).then((function(i){this._hideLoadingIcon();var n={};return(i?"200"==i.statusCode&&((n=i.body).request=i.request,n.headers=i.headers,this._headers=i.headers):n={type:"FeatureCollection",features:[]},n.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),n.features&&n.features.length&&n.features.map(function(e){e._source="mapbox"}),n.features=n.features?o.concat(n.features):o,this.options.externalGeocoder)?(a=this.options.externalGeocoder(e,n.features)||Promise.resolve([])).then(function(e){return n.features=n.features?e.concat(n.features):e,n},function(){return n}):n}).bind(this)).then((function(e){if(s)throw s;this.options.filter&&e.features.length&&(e.features=e.features.filter(this.options.filter)),e.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",e),this._typeahead.update(e.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",e))}).bind(this)).catch((function(e){this._hideLoadingIcon(),this._hideAttribution(),o.length&&this.options.localGeocoder||a.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(o)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:o}),this._eventEmitter.emit("error",{error:e})}).bind(this)),n},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){e.relatedTarget&&this._clear(e)},_onQueryResult:function(e){var i=e.body;if(i.features.length){var r=i.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],i=cj.language(e),r=cN.placeholder[i];if(r)return r}return"Search"},setInput:function(e,i){return void 0===i&&(i=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(i?this._geocode(e):this._onChange()),this},setProximity:function(e,i=!0){return this.options.proximity=e,i&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&"function"==typeof e&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var i=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||i,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=cy(uW({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=cy(uW({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var i=uh({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(i),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,i){return this._eventEmitter.on(e,i),this},off:function(e,i){return this._eventEmitter.removeListener(e,i),this.eventManager.remove(),this}},ua=cH,i_=ia("EPSG:4326");let cZ=null,cW=[];const cX={},{coords:cY,state:cK}=function(){switch(Intl.DateTimeFormat().resolvedOptions().timeZone){case"Australia/Melbourne":return{coords:[144.9631,-37.9136],state:"VIC"};case"Australia/Sydney":return{coords:[151.2093,-33.4688],state:"NSW"};case"Australia/Adelaide":return{coords:[138.61387,-34.92504],state:"SA"};default:return{coords:[115.832409,-31.9295999],state:"WA"}}}(),cJ={ALL:4,WA:9.5,NSW:7,SA:10,VIC:10};function cQ(e,i){return`
    <a href="${e.link||"#"}" class="pr-8 w-fit outline-none text-2xl text-left font-bold text-brandRed hover:underline" tabindex="0">${i}</a>
    <div class="flex flex-col gap-2 text-xs sm:text-sm">
      <div class="flex gap-2">
        <svg class="flex-shrink-0 mt-1" xmlns="http://www.w3.org/2000/svg" width="15" height="12.75" viewBox="0 0 15 12.75"><path d="M7.5,15V10.5h3V15h3.75V9H16.5L9,2.25,1.5,9H3.75v6Z" transform="translate(-1.5 -2.25)" fill="#1a171b"></path></svg>
        <span class="font-medium">${e.acf?.custom_address||""}</span>
      </div>
      <div class="flex items-center gap-2.5">
        <svg class="flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="13.5" height="13.5" viewBox="0 0 13.5 13.5"><path d="M2.25,3.75v3h1.5v-3h3V2.25h-3A1.5,1.5,0,0,0,2.25,3.75Zm1.5,7.5H2.25v3a1.5,1.5,0,0,0,1.5,1.5h3v-1.5h-3Zm10.5,3h-3v1.5h3a1.5,1.5,0,0,0,1.5-1.5v-3h-1.5Zm0-12h-3v1.5h3v3h1.5v-3A1.5,1.5,0,0,0,14.25,2.25Z" transform="translate(-2.25 -2.25)" fill="#1a171b"></path></svg>
        <span class="font-medium">${e.acf?.size||""}</span>
      </div>
      <div class="flex items-center gap-2.5">
        <svg class="flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="13.5" height="13.5" viewBox="0 0 13.5 13.5"><path d="M4.965,8.093a11.361,11.361,0,0,0,4.943,4.943l1.65-1.65a.746.746,0,0,1,.765-.18A8.555,8.555,0,0,0,15,11.632a.752.752,0,0,1,.75.75V15a.752.752,0,0,1-.75.75A12.749,12.749,0,0,1,2.25,3,.752.752,0,0,1,3,2.25H5.625a.752.752,0,0,1,.75.75A8.52,8.52,0,0,0,6.8,5.677a.753.753,0,0,1-.187.765Z" transform="translate(-2.25 -2.25)" fill="#1a171b"></path></svg>
        <a href="tel:${e.acf?.phone||"1300 738 638"}" class="font-medium">${e.acf?.phone||"1300 738 638"}</a>
      </div>
      <div class="flex items-center gap-2.5">
        <svg class="flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="15" height="12" viewBox="0 0 15 12"><path d="M15,3H3A1.5,1.5,0,0,0,1.507,4.5l-.007,9A1.5,1.5,0,0,0,3,15H15a1.5,1.5,0,0,0,1.5-1.5v-9A1.5,1.5,0,0,0,15,3Zm0,3L9,9.75,3,6V4.5L9,8.25,15,4.5Z" transform="translate(-1.5 -3)" fill="#1a171b"></path></svg>
        <a href="mailto:${(e.title?.rendered||"").toLowerCase().replace(/\s+/g,"")}@revofitness.com.au" class="font-medium">${(e.title?.rendered||"").toLowerCase().replace(/\s+/g,"")}@revofitness.com.au</a>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 gap-2.5">
      <img src="${e.acf?.gallery?.[0]?.url||""}" alt="" class="aspect-16/9 sm:aspect-4/3 object-cover rounded-md w-full pointer-events-none">
      <img src="${e.acf?.gallery?.[1]?.url||""}" alt="" class="aspect-16/9 sm:aspect-4/3 object-cover rounded-md w-full pointer-events-none">
    </div>
  `}function c0(r){let n=document.getElementById("gym-list");n&&(r.sort((e,i)=>{let r=e.title?.rendered?.toLowerCase()||"",n=i.title?.rendered?.toLowerCase()||"";return r.localeCompare(n)}),n.innerHTML=r.map(e=>{let i=e.title?.rendered||"Unnamed Gym",r=e.acf?.custom_address||"",n=e.acf?.map_link||"#",o=e.link||"#",a=e.acf?.size||"N/A",s=i.toLowerCase().replace(/\s+/g,"").replace(/[^\w-]/g,""),l=e.class_list?.find(e=>e.startsWith("state-"))?.replace("state-","").toUpperCase()||"",h=e.acf?.is_presale,u=e.acf?.studio_available,c=h?`<div class="presale relative w-full xl:relative xl:w-auto xl:absolute xl:top-0 xl:right-0 flex flex-row xl:flex-col bg-brandPink rounded-bl-none rounded-br-none xl:rounded-bl-3xl xl:rounded-br-3xl items-center justify-center p-3.5 gap-1.5 h-fit xl:px-5 xl:ml-auto">
          <svg xmlns="http://www.w3.org/2000/svg" width="70" height="54" fill="none" viewBox="0 0 70 54" class="">
            <path fill="#F392BD" d="M68.809 23.509c-1.224-1.532-2.896-2.22-4.237-2.773-.134-.056-.28-.117-.436-.179.877-1.09 2.029-2.57 2.062-4.65v-.257l-.033-.257c-.296-2.158-1.727-3.79-3.924-4.472-1.274-.396-2.65-.436-3.862-.475-.347-.01-.782-.022-1.163-.05.09-.939.18-2.27-.424-3.622l-.079-.173-.039-.073c-.922-1.772-2.677-2.789-4.807-2.789-1.553 0-3.08.537-4.192.928l-.318.112c-.235.09-.425.156-.581.2a18.98 18.98 0 0 1-.364-.76l-.039-.077C44.914 1.152 42.997.386 41.64.268a6.756 6.756 0 0 0-.475-.022c-2.426 0-4.092 1.503-5.193 2.498-.212.19-.497.447-.715.62-.313-.212-.743-.592-1.034-.843-1.129-.978-2.677-2.326-4.796-2.326-3.431 0-5.097 3.343-5.74 4.768-.324-.078-.715-.195-1.034-.29-.693-.207-1.481-.442-2.325-.587a8.124 8.124 0 0 0-1.548-.157c-2.158 0-3.88 1.057-4.712 2.895-.52 1.152-.565 2.342-.598 3.298 0 .095-.006.185-.011.28-.414.044-.922.05-1.448.061-1.442.022-3.23.045-4.974.866l-.218.101-.202.129c-1.704 1.112-2.252 2.515-2.414 3.498-.386 2.365 1.04 4.164 2.085 5.478l-.285.112c-1.13.447-2.41.956-3.483 1.81-1.945 1.555-2.576 3.83-1.688 6.076l.118.296.173.269c1.274 2.012 3.309 2.822 4.79 3.415.151.061.302.123.453.179-.078.1-.151.195-.213.28-.206.267-.402.53-.58.776-1.242 1.727-1.566 3.711-.884 5.45.654 1.676 2.146 2.873 4.108 3.297 1.174.302 2.32.325 3.337.347.425.011.911.022 1.32.056v.072c0 .789-.006 1.772.318 2.806.665 2.169 2.593 3.516 5.036 3.516.553 0 1.14-.067 1.744-.201.687-.123 1.369-.33 2.029-.531.34-.106.788-.24 1.168-.336.072.14.14.286.2.403.761 1.537 2.175 4.399 5.428 4.399 1.006 0 2.023-.308 3.018-.911.783-.453 1.414-1.007 1.979-1.493.235-.201.548-.475.788-.654.296.201.688.52.978.755 1.112.9 2.493 2.023 4.349 2.236.212.027.43.044.642.044 2.868 0 4.466-2.38 5.165-3.8l.056-.112.044-.118c.13-.318.235-.547.325-.72.302.072.665.178.967.268.665.19 1.414.408 2.325.603a8.35 8.35 0 0 0 1.677.185c2.515 0 4.449-1.47 5.052-3.834v-.029c.218-.855.224-1.665.23-2.313v-.224c.458-.04 1.073-.05 1.497-.056 1.437-.017 3.063-.033 4.572-.699 1.454-.58 2.521-1.67 3.013-3.08.509-1.47.319-3.079-.53-4.549-.386-.727-.878-1.325-1.331-1.861.173-.073.335-.14.475-.201 1.162-.487 2.476-1.029 3.482-2.001 1.006-.884 1.649-2.119 1.766-3.415a4.837 4.837 0 0 0-1.112-3.56l.006.022Z"></path>
            <path fill="#FFCB05" stroke="#333132" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.34" d="M53.667 8.166c.637 1.42-.587 3.454.61 4.712 1.699 2.012 8.054-.341 8.506 2.979-.033 2.13-3.376 3.717-2.61 5.924 1.135 2.04 4.555 2.052 5.986 3.885.632.738.386 1.733-.33 2.308-1.335 1.403-5.477 1.817-5.835 3.985-.05 1.61 1.85 2.896 2.544 4.243.726 1.207.385 2.37-.816 2.822-2.102.973-6.037-.307-7.602 1.554-.872 1.118-.374 2.812-.682 4.075-.335 1.308-1.476 1.414-2.739 1.151-3.951-.844-5.673-2.549-7.472 1.917-.459.934-1.219 2.046-2.326 1.878-1.755-.173-3.41-2.76-5.354-3.107-2.018-.296-3.331 1.827-4.896 2.716-2.94 1.822-3.349-2.576-4.88-4.024-1.28-1.185-4.12.296-5.891.587-1.42.324-2.532.09-2.862-.978-.475-1.504.397-3.7-1.157-4.701-1.85-.995-4.348-.369-6.288-.894-1.878-.375-2.353-1.9-1.235-3.443 1.14-1.61 3.398-3.812.956-5.36-1.599-1.13-4.192-1.359-5.293-3.102-1.062-2.678 3.722-3.248 5.27-4.427 4.125-2.627-4.454-6.053-.804-8.44 1.81-.85 4.096-.33 6.025-.727 1.062-.167 2-.782 2.241-1.9.397-2.113-.564-5.025 2.968-4.349 2.8.481 5.623 2.47 6.987-.86 3.359-7.658 5.628 2.14 9.826 0 1.615-.788 2.906-3.074 4.823-2.912.872.072 1.57 1.196 1.95 1.973 1.225 2.671 1.968 3.577 5.26 2.325 1.683-.587 4.187-1.57 5.081.14l.028.061.011-.011Z"></path>
            <path fill="#EF4136" stroke="#333132" stroke-miterlimit="10" stroke-width="1.34" d="M46.178 39.103h-6.551a.976.976 0 0 1-.81-.436l-4.863-7.322a.975.975 0 0 0-.81-.436h-1.398a.973.973 0 0 0-.973.972v6.25a.973.973 0 0 1-.972.972h-5.6a.973.973 0 0 1-.973-.973v-4.013a.99.99 0 0 1 .184-.57l6.668-9.172a.974.974 0 0 1 .783-.403h4.577c2.102 0 3.304-.96 3.304-2.632v-.073c0-1.576-.878-2.437-2.678-2.632h-.016a.973.973 0 0 1-.682-1.537l3.387-4.656a.979.979 0 0 1 1.056-.364c4.159 1.213 6.545 4.455 6.545 8.893v.073c0 3.454-1.425 6.176-4.069 7.858a.965.965 0 0 0-.285 1.364l4.964 7.31a.97.97 0 0 1-.805 1.516l.017.01Z"></path>
          </svg>
          <span class="supertitle uppercase font-extrabold text-center !text-sm !text-brandBlack">Presale</span>
        </div>`:"",d=u?`<svg width="96" height="27" viewBox="0 0 96 27" fill="none" xmlns="http://www.w3.org/2000/svg" class="">
        <rect x="1.10919" y="1.47955" width="93.4182" height="24.9679" rx="12.4839" stroke="black" stroke-width="1.08556"></rect>
        <path d="M24.8879 20.5512L24.4041 19.5144C24.1844 19.0478 24.0234 18.7847 24.0234 18.5216C24.0234 18.2438 24.2138 18.0981 24.4041 18.0981C24.5945 18.0981 24.7554 18.2291 24.9605 18.4336C25.8387 19.2806 26.9376 20.0543 28.1524 20.0543C28.9285 20.0543 29.3828 19.6601 29.3828 19.1926C29.3828 18.55 28.5184 18.4189 27.3625 18.1568C25.7808 17.8066 24.1853 17.208 24.1853 15.6899C24.1853 14.3763 25.3863 13.4569 26.9828 13.4569C27.8178 13.4569 28.4762 13.6907 28.7401 13.6907C29.0335 13.6907 29.0335 13.3992 29.3701 13.3992C29.7066 13.3992 29.8528 13.677 30.0442 13.9685L30.5858 14.8155C30.7909 15.1217 30.9665 15.4435 30.9665 15.6626C30.9665 15.8817 30.8056 16.0274 30.6299 16.0274C30.4101 16.0274 30.2492 15.867 30.0589 15.7066C29.2386 15.0209 28.1995 14.4663 27.2909 14.4663C26.7051 14.4663 26.3097 14.7441 26.3097 15.1383C26.3097 15.7369 27.0711 15.868 28.2721 16.1604C29.9127 16.5399 31.5081 17.0358 31.5081 18.6712C31.5081 20.2186 30.0294 21.0794 28.1691 21.0794C27.1437 21.0794 26.5285 20.8172 26.2508 20.8172C25.8848 20.8172 25.8554 21.1967 25.4894 21.1967C25.1822 21.1967 25.0203 20.8466 24.8889 20.5541L24.8879 20.5512ZM37.9782 19.5144C37.9782 19.7482 37.8173 20.0103 37.6122 20.2147C37.1 20.74 36.3671 21.1058 35.3427 21.1058C34.0975 21.1058 33.1458 20.3908 33.1458 19.5144C33.1458 19.2082 33.2046 18.0844 33.2046 17.0769V14.7118H32.4285C32.1067 14.7118 31.8869 14.5367 31.8869 14.259C31.8869 13.9675 32.0772 13.8208 32.3843 13.6457C33.3214 13.1635 33.7904 12.6969 34.2732 11.6894C34.6097 11.1495 34.7422 10.9157 35.0346 10.9157C35.2544 10.9157 35.4006 11.0615 35.4006 11.441V13.6163H37.4651C37.6996 13.6163 37.831 13.7337 37.831 13.9665C37.831 14.0839 37.8016 14.258 37.7869 14.346C37.7427 14.5944 37.626 14.7108 37.3915 14.7108H35.3996V18.3455C35.3996 19.4694 35.7656 19.7618 36.2788 19.7618C36.63 19.7618 36.8793 19.5868 37.1864 19.3237C37.2884 19.2366 37.4209 19.1192 37.5965 19.1192C37.8458 19.1192 37.9772 19.309 37.9772 19.5134L37.9782 19.5144ZM47.7737 19.9966C47.7737 20.4054 47.4224 20.5365 46.1919 20.7996C45.3569 20.9894 45.0645 21.0334 44.9036 21.0334C44.5671 21.0334 44.4346 20.7556 44.4346 20.4348V19.6464C43.9656 20.4201 43.1315 21.0911 41.9011 21.0911C40.3636 21.0911 39.3676 20.0983 39.3676 18.2888V16.0264C39.3676 15.107 38.2834 15.3838 38.2834 14.7862C38.2834 14.4213 38.6347 14.2609 39.7768 13.8814C40.7433 13.5459 40.9631 13.5019 41.0946 13.5019C41.49 13.5019 41.5636 13.8667 41.5636 14.2169V17.6765C41.5636 18.859 41.9737 19.443 42.8813 19.443C43.628 19.443 44.4336 18.9177 44.4336 17.4721V16.0274C44.4336 15.108 43.2032 15.4141 43.2032 14.7871C43.2032 14.437 43.5692 14.2766 44.8428 13.8677C45.7651 13.5616 46.0438 13.5029 46.1753 13.5029C46.5854 13.5029 46.6296 13.897 46.6296 14.2179V18.6556C46.6296 19.5897 47.7717 19.4586 47.7717 19.9986L47.7737 19.9966ZM57.5995 19.8499C57.5995 20.2 57.2335 20.3751 56.1208 20.7409C55.2132 21.0618 54.9934 21.1058 54.8472 21.1058C54.4371 21.1058 54.3929 20.6823 54.3929 20.3908V19.7188C53.8513 20.5218 52.9437 21.1498 51.6985 21.1498C49.8676 21.1498 48.3742 19.7628 48.3742 17.3987C48.3742 15.0346 50.0579 13.3845 52.2696 13.3845C53.1625 13.3845 53.8807 13.6623 54.3929 14.0995V12.3477C54.3929 11.4136 53.2655 11.8655 53.2655 11.1798C53.2655 10.859 53.6315 10.6683 54.7736 10.2017C55.7548 9.80754 55.9893 9.77819 56.1355 9.77819C56.5015 9.77819 56.5898 10.099 56.5898 10.4785V18.595C56.5898 19.5144 57.6005 19.2522 57.6005 19.8499H57.5995ZM54.3929 17.5728V17.0622C54.3929 15.5882 53.4559 14.4937 52.402 14.4937C51.3482 14.4937 50.7036 15.3554 50.7036 16.7708C50.7036 18.5226 51.6995 19.6171 52.7101 19.6171C53.6178 19.6171 54.3939 18.8287 54.3939 17.5728H54.3929ZM58.3158 20.5512C58.3158 19.9673 59.1802 20.2881 59.1802 19.2082V16.1281C59.1802 15.194 58.2138 15.6029 58.2138 14.9603C58.2138 14.6394 58.5797 14.435 59.6198 13.9821C60.5863 13.5439 60.762 13.4999 60.9229 13.4999C61.2741 13.4999 61.3772 13.7914 61.3772 14.2003V19.2073C61.3772 20.2871 62.2416 19.9663 62.2416 20.5502C62.2416 20.74 62.0954 20.9591 61.7579 20.9591C61.4203 20.9591 61.0112 20.915 60.2792 20.915C59.5472 20.915 59.1665 20.9591 58.8152 20.9591C58.464 20.9591 58.3178 20.7546 58.3178 20.5502L58.3158 20.5512ZM58.6818 11.5593C58.6818 10.8297 59.4579 10.0413 60.4686 10.0413C61.0838 10.0413 61.6107 10.4355 61.6107 11.0194C61.6107 11.7344 60.761 12.4798 59.765 12.4798C59.1204 12.4798 58.6818 12.1149 58.6818 11.5603V11.5593ZM62.9579 17.3684C62.9579 15.0473 64.8173 13.3248 67.4244 13.3248C70.0315 13.3248 71.6132 14.9896 71.6132 17.1786C71.6132 19.5437 69.6949 21.2075 67.1467 21.2075C64.5985 21.2075 62.9579 19.5437 62.9579 17.3684ZM69.2406 17.7772C69.2406 16.3032 68.3909 14.435 67.0152 14.435C65.9467 14.435 65.3315 15.2967 65.3315 16.7708C65.3315 18.2448 66.1665 20.0993 67.5568 20.0993C68.6401 20.0993 69.2406 19.2376 69.2406 17.7782V17.7772ZM25.7572 8.36774H25.1195V10.4648C25.1195 11.0361 25.2205 11.2385 25.8377 11.2385C25.9172 11.2385 25.9682 11.2385 25.9682 11.3686C25.9682 11.5349 25.5404 11.5711 25.3304 11.5711C24.8879 11.5711 24.518 11.4772 24.518 10.6458V8.36872H24.1834C24.0745 8.36872 24.0234 8.32569 24.0234 8.24548C24.0234 8.14376 24.1255 8.0792 24.2118 8.03616C24.5454 7.86304 24.6465 7.71827 24.7054 7.28399C24.7417 7.03848 24.7417 6.85753 24.9154 6.85753C25.0674 6.85753 25.1185 6.88687 25.1185 7.07467V8.01464H25.8877C25.9525 8.01464 26.0035 8.03616 26.0035 8.12322C26.0035 8.31101 25.8514 8.36872 25.7572 8.36872V8.36774ZM29.5575 11.5564H28.8971C28.7951 11.5564 28.6283 11.5202 28.6283 11.3755C28.6283 11.3393 28.6498 11.2816 28.7225 11.2816C28.8235 11.2816 28.9256 11.2816 28.9256 10.9343V9.34391C28.9256 8.75801 28.8382 8.38926 28.3457 8.38926C27.7148 8.38926 27.3596 9.08373 27.3596 9.71266V10.9343C27.3596 11.2816 27.4538 11.2816 27.5558 11.2816C27.6353 11.2816 27.6578 11.3393 27.6578 11.3755C27.6578 11.5202 27.5342 11.5564 27.39 11.5564H26.7296C26.6207 11.5564 26.4617 11.5202 26.4617 11.3755C26.4617 11.3393 26.4833 11.2816 26.5559 11.2816C26.658 11.2816 26.7591 11.2816 26.7591 10.9343V6.95143C26.7591 6.64039 26.6864 6.6042 26.5559 6.6042C26.4833 6.6042 26.4617 6.55333 26.4617 6.50247C26.4617 6.36554 26.6217 6.32935 26.7375 6.32935H27.1947C27.3615 6.32935 27.3615 6.52497 27.3615 6.66875V8.76584C27.6225 8.27385 28.1808 7.92661 28.6086 7.92661C29.1748 7.92661 29.53 8.12908 29.53 9.03287V10.9343C29.53 11.2816 29.6242 11.2816 29.7262 11.2816C29.8057 11.2816 29.8283 11.3393 29.8283 11.3755C29.8283 11.5202 29.7047 11.5564 29.5594 11.5564H29.5575ZM33.082 9.77819H31.0293C31.0293 10.4648 31.2618 11.2532 32.0743 11.2532C32.5453 11.2532 32.7778 11.0507 32.9956 10.7612C33.0251 10.7103 33.083 10.638 33.1624 10.638C33.2351 10.638 33.3077 10.681 33.3077 10.768C33.3077 10.8404 33.3008 10.8698 33.2714 10.9197C33.0467 11.3676 32.5462 11.6503 31.9438 11.6503C31.0303 11.6503 30.3768 11.0214 30.3768 9.84275C30.3768 8.59956 30.993 7.92661 31.9212 7.92661C32.8494 7.92661 33.3499 8.55554 33.3499 9.3801C33.3499 9.7195 33.2046 9.77819 33.082 9.77819ZM31.8996 8.23863C31.1745 8.23863 31.0362 8.99765 31.0362 9.32337C31.0362 9.4603 31.0577 9.4603 31.1735 9.4603H32.4432C32.6532 9.4603 32.6826 9.40944 32.6826 9.18545C32.6826 8.76584 32.5011 8.23863 31.8996 8.23863Z" fill="#333132"></path>
      </svg>`:"";return`<div id="${s}" data-gym="${i}" data-state="${l}" class="max-lg:snap-center max-lg:w-full max-lg:flex-shrink-0 max-md:px-6 mb-4 ml-4 mr-4">
      <div class="relative rounded-2xl bg-white overflow-hidden bg-brandOffWhite">
        ${c}
        <div class="flex flex-col text-brandBlack">
          <div class="flex gap-10">
            <div class="w-full flex flex-col gap-2 font-semibold text-sm px-5 pt-5">
              <div class="flex gap-4 mb-1 max-sm:justify-between">
                <span class="is-h5 font-bold text-left text-black">${i}</span>
                ${d}
              </div>
              <div class="flex gap-3 text-left xl:gap-6">
                <div class="flex items-center justify-center w-6 h-6 flex-shrink-0 rounded-full border border-brandBlack">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="12" fill="none" viewBox="0 0 14 12">
                    <path fill="#333132" stroke="#333132" stroke-width=".2" d="M11.182 11.812H8.558a.684.684 0 0 1-.682-.682V7.142a.115.115 0 0 0-.115-.115h-1.59a.115.115 0 0 0-.115.115v3.988a.683.683 0 0 1-.682.682H2.75a.684.684 0 0 1-.682-.682V5.829h-.577a.514.514 0 0 1-.493-.352.514.514 0 0 1 .17-.582L6.499.69a.756.756 0 0 1 .941 0l5.329 4.205c.176.141.245.37.17.582a.518.518 0 0 1-.492.352h-.578v5.3a.683.683 0 0 1-.682.683h-.004Zm-5.01-5.354h1.59c.374 0 .681.307.681.682v3.988c0 .063.051.115.115.115h2.624a.115.115 0 0 0 .115-.115V5.782c0-.288.234-.522.522-.522h.497L7.088 1.13a.192.192 0 0 0-.24 0L1.622 5.26h.496c.288 0 .522.234.522.522v5.346c0 .063.052.115.115.115h2.624a.115.115 0 0 0 .115-.115V7.14c0-.377.305-.682.682-.682h-.004Z"></path>
                  </svg>
                </div>
                <a href="${n}" target="_blank" class="!text-sm underline max-w-[290px]">${r}</a>
              </div>
              <div class="flex items-center gap-3 xl:gap-6">
                <div class="flex items-center justify-center w-6 h-6 flex-shrink-0 rounded-full border border-brandBlack">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="13" fill="none" viewBox="0 0 14 13">
                    <path fill="#333132" stroke="#333132" stroke-width=".2" d="M5.27 11.04H2.784a.685.685 0 0 1-.686-.686V7.866a.309.309 0 1 1 .618 0v2.488c0 .037.03.067.068.067H5.27a.309.309 0 1 1 0 .618ZM9.794 11.04H6.78a.309.309 0 1 1 0-.618h3.015a.309.309 0 1 1 0 .617Z"></path>
                    <path fill="#333132" stroke="#333132" stroke-width=".2" d="M8.663 12.169a.309.309 0 0 1-.218-.527l.913-.912-.913-.91a.308.308 0 1 1 .436-.437l1.132 1.13a.31.31 0 0 1 0 .436L8.88 12.078c-.06.06-.139.09-.218.09ZM2.406 6.667a.309.309 0 0 1-.309-.309V3.342a.309.309 0 1 1 .618 0v3.016a.31.31 0 0 1-.309.31Z"></path>
                    <path fill="#333132" stroke="#333132" stroke-width=".2" d="M3.535 4.78a.308.308 0 0 1-.218-.09l-.91-.913-.912.913a.308.308 0 1 1-.436-.437l1.129-1.131a.31.31 0 0 1 .437 0l1.129 1.131a.309.309 0 0 1-.219.527ZM12.283 11.04h-.98a.309.309 0 1 1 0-.618h.98c.037 0 .067-.03.067-.068v-9.5a.067.067 0 0 0-.067-.067h-9.5a.067.067 0 0 0-.068.067v.98a.309.309 0 1 1-.618 0v-.98c0-.379.307-.685.686-.685h9.5c.378 0 .685.306.685.685v9.5a.685.685 0 0 1-.685.686ZM3.703 9.332V7.408c0-.037.03-.067.067-.067h.555c.033 0 .063.016.063.072l.016.207a.649.649 0 0 1 .576-.328c.251 0 .454.12.572.344a.696.696 0 0 1 .63-.344c.448 0 .727.316.727.853v1.19c0 .036-.03.067-.068.067H6.27a.067.067 0 0 1-.067-.068v-1.02c0-.248-.084-.374-.275-.374-.19 0-.274.126-.274.374v1.02c0 .037-.03.068-.067.068h-.562c-.047 0-.077-.03-.077-.068v-1.02c0-.248-.08-.374-.27-.374-.176 0-.274.126-.274.374v1.02c0 .037-.03.068-.067.068h-.572a.067.067 0 0 1-.067-.068l.005-.002Z"></path>
                    <path fill="#333132" stroke="#333132" stroke-width=".2" d="M7.248 7.961v-.265c0-.016.005-.03.016-.046l.504-.495c.06-.058.186-.17.186-.314 0-.118-.086-.197-.218-.197-.121 0-.195.072-.26.153-.021.026-.038.019-.058-.002l-.189-.188a.043.043 0 0 1-.007-.054.652.652 0 0 1 .551-.286c.344 0 .583.226.583.537 0 .26-.17.411-.225.467l-.393.381h.581c.02 0 .04.016.04.04v.27a.04.04 0 0 1-.04.039H7.285a.04.04 0 0 1-.04-.04h.003Z"></path>
                  </svg>
                </div>
                <span class="!text-sm">${a} sq/m</span>
              </div>
            </div>
          </div>
          <div class="grid mt-auto gap-4 max-sm:pt-3 p-5">
            <div class="grid sm:grid-cols-2 gap-2 sm:gap-4">
              <span class="is-button after:!hidden text-sm px-4 py-2 w-full justify-center view-map-button" data-slug="${s}">View On Map</span>
              <a href="${o}" class="is-button-outline after:!hidden text-sm px-4 py-2 w-full justify-center">Gym Info</a>
            </div>
          </div>
        </div>
      </div>
    </div>`}).join(""),document.querySelectorAll(".view-map-button").forEach(r=>{r.addEventListener("click",()=>{let n=cX[r.getAttribute("data-slug")];if(!n)return;let o=n.getGeometry().getCoordinates();i.animate({center:o,zoom:13,duration:800}),cZ&&(e.removeOverlay(cZ),cZ=null);let a=document.createElement("div");a.setAttribute("data-info-window",n.get("name")),a.className="p-2.5 pt-0 flex flex-col gap-4 max-w-[350px] bg-white",a.innerHTML=cQ(n.get("data"),n.get("name")),cZ=new rn({element:a,positioning:"bottom-center",stopEvent:!0,offset:[0,-10]}),e.addOverlay(cZ),cZ.setPosition(o)})}))}document.addEventListener("DOMContentLoaded",()=>{var r,n;e1(uo).accessToken="pk.eyJ1IjoibWF0aGV3LXJldm8iLCJhIjoiY21icm53MWIwMDk2ZDJrc2RlNjJ5cXJ0YSJ9.eOxkjOrS1wBPNM3GA6fDtg",(e=new(e1(uo)).Map({container:"map",style:"mapbox://styles/mathew-revo/cmbzuv84g006b01soe92r8kg8",center:cY,zoom:cJ[cK],pitch:60,bearing:-20,antialias:!0})).addControl(new(e1(uo)).NavigationControl),e.on("load",()=>{let i=e.getStyle().layers.find(e=>"symbol"===e.type&&e.layout?.["text-field"]).id;e.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","min_height"],"fill-extrusion-opacity":.6}},i)});let o=new(e1(ua))({accessToken:e1(uo).accessToken,placeholder:"Search address",mapboxgl:e1(uo),marker:!1,flyTo:!1});document.getElementById("search-container").appendChild(o.onAdd()),o.on("result",i=>{e.flyTo({center:i.result.center,zoom:14})}),r=e,n=`https://api.mapbox.com/styles/v1/mathew-revo/cmbzuv84g006b01soe92r8kg8?access_token=${e1(uo).accessToken}`,e1(uo).accessToken,e1(uo).accessToken,("string"==typeof r||r instanceof HTMLElement)&&(r=new lI({target:r})),setTimeout(function(){!function(e,i){var r,n="",o="",a="",s="";if(("string"==typeof e||e instanceof HTMLElement)&&(e=new lI({target:e})),"string"==typeof i){var l=i.match(h6);l&&(o=l[1],n=l.length>2?l[2]:""),new Promise(function(r,l){fetch(i,{credentials:"same-origin"}).then(function(e){return e.json()}).then(function(h){var u=document.createElement("A");u.href=i;var c=u.href;s=u.pathname.split("/").slice(0,-1).join("/")+"/",a=c.substr(0,c.indexOf(s)),ur(h,e,o,a,s,n).then(function(){r(e)}).catch(l)}).catch(function(e){l(Error("Could not load ".concat(i,": ").concat(e.message)))})})}else new Promise(function(r,n){ur(i,e).then(function(){r(e)}).catch(n)})}(r,n)},0),function(){let e=document.getElementById("state-buttons");if(!e)return;let r={ALL:{coords:[135,-20.734],zoom:4},WA:{coords:[115.832409,-31.9295999],zoom:10},NSW:{coords:[151.2093,-33.8688],zoom:7},SA:{coords:[138.61387,-34.92504],zoom:9.5},VIC:{coords:[144.9631,-37.9136],zoom:10}};e.querySelectorAll("button[data-state]").forEach(n=>{n.addEventListener("click",function(){let n=document.getElementById("gym-list");if(n){let e=n.getBoundingClientRect().top+window.scrollY-150;window.scrollTo({top:e,behavior:"smooth"})}let o=this.getAttribute("data-state"),a=r[o];e.querySelectorAll("button").forEach(e=>e.classList.remove("selected")),this.classList.add("selected"),a&&i.animate({center:a.coords,zoom:a.zoom,duration:800}),c0("ALL"===o?cW:cW.filter(e=>{let i=e.class_list?.find(e=>e.startsWith("state-"));return(i?i.replace("state-","").toUpperCase():"")===o}))})})}(),function(i="ALL"){fetch("https://revofitness.test/wp-json/wp/v2/gyms?acf_format=standard&per_page=70").then(e=>e.json()).then(r=>{cW=r;let n="ALL"===i?r:r.filter(e=>{let r=e.class_list?.find(e=>e.startsWith("state-"));return(r?r.replace("state-","").toUpperCase():"")===i}),o=new oA({source:new o$({features:r.map(e=>{let i=parseFloat(e.acf?.latitude),r=parseFloat(e.acf?.longitude);if(e.title?.rendered?.toLowerCase().includes("modbury")&&(i=-34.82960547422781,r=138.69172072516687),!i||!r)return null;let n=e.title?.rendered.toLowerCase().replace(/\s+/g,"").replace(/[^\w-]/g,""),o=new oZ({geometry:new oK([r,i]),name:e.title?.rendered||"Unnamed Gym",data:e});return o.setStyle(new nn({image:new oy({anchor:[.5,.9],anchorXUnits:"fraction",anchorYUnits:"pixels",src:"https://revofitness.com.au/wp-content/uploads/2025/06/revo-map-pin-50x50-1.png"})})),cX[n]=o,o}).filter(Boolean)})});e.addLayer(o),c0(n),e.on("singleclick",i=>{let r=!1;e.forEachFeatureAtPixel(i.pixel,i=>{if(r)return;r=!0;let n=i.get("data"),o=i.getGeometry().getCoordinates(),a=i.get("name"),s=document.createElement("div");s.setAttribute("data-info-window",a),s.className="p-2.5 pt-0 flex flex-col gap-4 max-w-[350px] bg-white",s.innerHTML=cQ(n,a),cZ&&e.removeOverlay(cZ),cZ=new rn({element:s,positioning:"bottom-center",stopEvent:!0,offset:[0,-10]}),e.addOverlay(cZ),cZ.setPosition(o)})})})}(cK)});